<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Category: 鬼故事 | Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Morris&#39; Blog">
<meta property="og:url" content="http://morris821028.github.io/categories/工作應用/鬼故事/index.html">
<meta property="og:site_name" content="Morris&#39; Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris&#39; Blog">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
  <link rel="import" href="/bower_components/app-layout/app-layout.html"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          
          <section id="main">
  
    <article id="post-work/company-ghost-story-9" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/01/30/work/company-ghost-story-9/" class="article-date">
  <time datetime="2021-01-30T04:00:00.000Z" itemprop="datePublished">2021-01-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/工作應用/">工作應用</a>/<a class="article-category-link" href="/categories/工作應用/鬼故事/">鬼故事</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/01/30/work/company-ghost-story-9/">Company Ghost Story 公司鬼故事 9</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2021/01/30/work/company-ghost-story-9/" data-id="ckkj23o7i02e6n0vr9kxpn91n" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2021/01/30/work/company-ghost-story-9/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/鬼故事/">鬼故事</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><h3 id="BufferWriter-StringBuilder"><a href="#BufferWriter-StringBuilder" class="headerlink" title="BufferWriter/StringBuilder"></a>BufferWriter/StringBuilder</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeLong</span><span class="params">(<span class="keyword">long</span> v)</span> </span>&#123;</div><div class="line">    StringBuilder sb = <span class="keyword">new</span> StringBuilder(<span class="number">8192</span>); <span class="comment">// ?</span></div><div class="line">    sb.append(Long.toString(v));</div><div class="line">    writer.write(sb.toString());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>每一次轉換，別浪費額外的空間 8192 的 <code>StringBuilder</code>。如果真的需要這種 IO 的緩衝區，可以直接宣告在 <code>BufferWriter</code> 給定預設大小的緩衝區。</p>
<h3 id="BufferWriter-StringBuilder-1"><a href="#BufferWriter-StringBuilder-1" class="headerlink" title="BufferWriter/StringBuilder"></a>BufferWriter/StringBuilder</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> String <span class="title">writeTwo</span><span class="params">(String token0, String token1)</span> </span>&#123;</div><div class="line">    writer.write(token0 + token1); <span class="comment">// why not write separately without intermediate result.</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>既然都知道了字串串接會有中間結果，我們可以直接分開寫 <code>writer.write(token0);</code> 和 <code>writer.write(token1);</code> 來達到相同效果。</p>
<h3 id="StringBuilder-Helper"><a href="#StringBuilder-Helper" class="headerlink" title="StringBuilder Helper"></a>StringBuilder Helper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> StringBuilder <span class="title">append</span><span class="params">(StringBuilder sb, String... tokens)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (String t : tokens)</div><div class="line">        sb.append(t);</div><div class="line">    <span class="keyword">return</span> sb;</div><div class="line">&#125;</div><div class="line"></div><div class="line">append(sb, <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>).append(<span class="string">"d"</span>, <span class="string">"e"</span>);</div><div class="line"><span class="comment">// if performance it critical, please write all statements without sugar syntax</span></div><div class="line">append(ab, <span class="string">"a"</span> + <span class="string">"b"</span>, <span class="string">"c"</span>);</div><div class="line"><span class="comment">// ... why?</span></div></pre></td></tr></table></figure>
<p>這種可變參數的寫法會額外產生一個陣列，對於效能來說會很傷。</p>
<h3 id="Math-Getter-Setter"><a href="#Math-Getter-Setter" class="headerlink" title="Math Getter/Setter"></a>Math Getter/Setter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// convert x' = a x + b</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">convert</span><span class="params">(Point p)</span> </span>&#123;</div><div class="line">    p.setX(p.getX() * a);</div><div class="line">    p.setX(p.getX() + b); <span class="comment">// why not p.setX(p.getX() * a + b);</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>別中毒於 Java 或者是 OOP 的寫法。</p>
<h3 id="Lookup-by-Key"><a href="#Lookup-by-Key" class="headerlink" title="Lookup by Key"></a>Lookup by Key</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> T <span class="title">getSelected</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (T c : candidates) &#123;</div><div class="line">        <span class="keyword">if</span> (Objects.equals(c.toKey(), mSelected))</div><div class="line">            <span class="keyword">return</span> c;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSelected</span><span class="params">(T s)</span> </span>&#123;</div><div class="line">    mSelected = s.toKey(); <span class="comment">// why not store `s` directly?</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在大多數的狀況下都可以直接存原本的物件。除非是在一些特定的序列化，或者是橫跨兩個不同 domain 的交互資料，這時候我們必須採用字串作為中介對象。</p>
<h3 id="Default-Value-by-Wrapper-Class"><a href="#Default-Value-by-Wrapper-Class" class="headerlink" title="Default Value by Wrapper Class"></a>Default Value by Wrapper Class</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> Boolean mirror = <span class="keyword">false</span>; <span class="comment">// why use wrapper class here?</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMirror</span><span class="params">(<span class="keyword">boolean</span> m)</span> </span>&#123;</div><div class="line">    mirror = m;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (mirror != <span class="keyword">null</span>) &#123; <span class="comment">// why?</span></div><div class="line">        <span class="comment">// must do here</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>多餘的寫法。如果 wrapper class 有預設值，而且還不能被設置 null。那必然有些地方出錯。</p>
<h3 id="Constant-Value-by-Wrapper-Class"><a href="#Constant-Value-by-Wrapper-Class" class="headerlink" title="Constant Value by Wrapper Class"></a>Constant Value by Wrapper Class</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Double SIZE = <span class="number">50L</span>; <span class="comment">// ...</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exec</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">long</span> v = SIZE.longValue(); <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>這傢伙到底在宣告什麼？想用什麼？</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-work/company-ghost-story-8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/08/work/company-ghost-story-8/" class="article-date">
  <time datetime="2020-11-08T10:00:00.000Z" itemprop="datePublished">2020-11-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/工作應用/">工作應用</a>/<a class="article-category-link" href="/categories/工作應用/鬼故事/">鬼故事</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/08/work/company-ghost-story-8/">Company Ghost Story 公司鬼故事 8</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2020/11/08/work/company-ghost-story-8/" data-id="ckkj23o7202drn0vr68t23zwa" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2020/11/08/work/company-ghost-story-8/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/鬼故事/">鬼故事</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><h3 id="Format-String"><a href="#Format-String" class="headerlink" title="Format String"></a>Format String</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">String.format(<span class="string">"ABC%s"</span>, <span class="string">"D"</span>); <span class="comment">// const string should be written directly</span></div><div class="line">String.format(<span class="string">"%s.%s"</span>, A.class.getName(), <span class="string">"C"</span>);</div></pre></td></tr></table></figure>
<p>對於可以直接計算得到的，應該直接展開。</p>
<h3 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">double</span> theta = dx != <span class="number">0</span> ? Math.atan(dy/dx) : (dy &lt; <span class="number">0</span> ? ... : ...);</div><div class="line"></div><div class="line"><span class="comment">// or</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> (dx &lt; <span class="number">0</span>) &#123;</div><div class="line">    <span class="keyword">if</span> (dy &lt; <span class="number">0</span>)</div><div class="line">        ...</div><div class="line">&#125; <span class="keyword">else</span> (dx == <span class="number">0</span>) &#123;</div><div class="line">    <span class="keyword">if</span> (dy &lt; <span class="number">0</span>)</div><div class="line">        ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// why not be simple?</span></div><div class="line"><span class="keyword">double</span> theta = Math.atan2(dy, dx);</div></pre></td></tr></table></figure>
<p>數學很重要，可以減少很多分支判斷。</p>
<h3 id="Variable-Name"><a href="#Variable-Name" class="headerlink" title="Variable Name"></a>Variable Name</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">List&lt;T&gt; set = <span class="keyword">new</span> LinkedList&lt;&gt;(); <span class="comment">// what does `set` means?</span></div><div class="line"><span class="comment">// perhaps, I need to ask what does `list` means for you.</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">TextField okBtn; <span class="comment">// why name button for text field?</span></div><div class="line">enableCancelButton(okBtn); <span class="comment">// are you sure about it?</span></div></pre></td></tr></table></figure>
<p>命名盡量貼切型態，不然有時候真的會有很奇怪。</p>
<h3 id="Initialize-Member"><a href="#Initialize-Member" class="headerlink" title="Initialize Member"></a>Initialize Member</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MPanel</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> JButton mButton;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MPanel</span><span class="params">()</span> </span>&#123; <span class="comment">// consturctor</span></div><div class="line">        ...</div><div class="line">        mButton = <span class="keyword">new</span> JButton(<span class="string">"A"</span>); <span class="comment">// what?</span></div><div class="line">        panel.add(mButton);</div><div class="line">        mButton = <span class="keyword">new</span> JButton(<span class="string">"B"</span>); <span class="comment">// what?</span></div><div class="line">        panel.add(mButton);</div><div class="line">        <span class="comment">// finally, which result you want to express mButton?</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在建構子中，每一個成員變數盡量只存放一次，採用 <code>final</code> 對每個成員變數檢查只初始化一次。</p>
<h3 id="Lambda-with-Final"><a href="#Lambda-with-Final" class="headerlink" title="Lambda with Final"></a>Lambda with Final</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">process</span><span class="params">(...)</span> </span>&#123;</div><div class="line">    String s = <span class="string">"default"</span>;</div><div class="line">    <span class="keyword">if</span> (isA())</div><div class="line">        s = <span class="string">"A"</span>;</div><div class="line">    <span class="keyword">final</span> String _s = s;		<span class="comment">// shut up, don't explain</span></div><div class="line">    blackhole(() -&gt; map(_s));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Lambda 函數抓取的時候都要抓取可推斷出 <code>final</code> 的變數。為了 lambda 而額外宣告一個變數作為 final 的話，應該要額外宣告一個 getter 函數去抓取，不然觀感上會覺得代碼有點多餘。</p>
<h3 id="Method-Name"><a href="#Method-Name" class="headerlink" title="Method Name"></a>Method Name</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span> </span>&#123; <span class="comment">// why is noun?</span></div><div class="line">    i++;</div><div class="line">    i++;  <span class="comment">// why call it twice?</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>函數盡量使用動詞開頭，名詞有點奇怪。</p>
<h3 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">enableA</span><span class="params">()</span> </span>&#123;</div><div class="line">    a = <span class="keyword">true</span>;</div><div class="line">    b = <span class="keyword">true</span>;  <span class="comment">// why is b here?</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">disableA</span><span class="params">()</span> </span>&#123;</div><div class="line">    a = <span class="keyword">false</span>; <span class="comment">// wait ... where is B?</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>當名稱對應到成員變數時，就應該一件事情對應一個操作。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-work/company-ghost-story-7" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/01/work/company-ghost-story-7/" class="article-date">
  <time datetime="2020-11-01T10:00:00.000Z" itemprop="datePublished">2020-11-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/工作應用/">工作應用</a>/<a class="article-category-link" href="/categories/工作應用/鬼故事/">鬼故事</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/01/work/company-ghost-story-7/">Company Ghost Story 公司鬼故事 7</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2020/11/01/work/company-ghost-story-7/" data-id="ckkj23o7802dyn0vr1wyzu77g" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2020/11/01/work/company-ghost-story-7/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/鬼故事/">鬼故事</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><h3 id="try-catch-exception"><a href="#try-catch-exception" class="headerlink" title="try-catch-exception"></a>try-catch-exception</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function">Object <span class="title">getSomething</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> Exception abort = <span class="keyword">new</span> RuntimeException();</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        <span class="keyword">if</span> (e == abort)</div><div class="line">            <span class="comment">// fine</span></div><div class="line">        <span class="keyword">else</span></div><div class="line">            e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>每次呼叫這個函數都要先建立一個例外，然後看裡面會不會丟出來，這個其實很浪費空間和時間建立。可以考慮建立一個特殊 <code>AbortException</code> 來取代預先建立的例外，或者建立一個全局的靜態例外物件來使用。</p>
<h3 id="Double-Brace-Initialization"><a href="#Double-Brace-Initialization" class="headerlink" title="Double Brace Initialization"></a>Double Brace Initialization</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> Set&lt;String&gt; set = <span class="keyword">new</span> HashSet&lt;&gt; &#123;</div><div class="line">    &#123;</div><div class="line">        add(<span class="string">"A"</span>);</div><div class="line">        add(<span class="string">"B"</span>);</div><div class="line">        add(<span class="string">"C"</span>);</div><div class="line">    &#125; <span class="comment">// no more</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// why not?</span></div><div class="line">set.add(<span class="string">"A"</span>);</div><div class="line">set.add(<span class="string">"B"</span>);</div><div class="line">set.add(<span class="string">"C"</span>);</div></pre></td></tr></table></figure>
<p>這會額外建立匿名類別。如果宣告在一般的成員方法中，還會捕抓成員變數，造成內存洩漏而無法回收的狀況。</p>
<h3 id="No-More-Inheritance"><a href="#No-More-Inheritance" class="headerlink" title="No More Inheritance"></a>No More Inheritance</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> <span class="keyword">extends</span> <span class="title">Pair</span>&lt;<span class="title">Integer</span>, <span class="title">Integer</span>&gt; </span>&#123;</div><div class="line">    Point(<span class="keyword">int</span> x, <span class="keyword">int</span> y) &#123;</div><div class="line">        <span class="keyword">super</span>(x, y);</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Point) &#123;</div><div class="line">            Point p = (Point) o;</div><div class="line">            <span class="keyword">return</span> first == p.first &amp;&amp; second == p.second; <span class="comment">// wrong</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>別忘了，Java 中的 wrapper class 可是一個物件，光靠 <code>==</code> 是不能比較相同與否。雖然對於數值小於某個定值的時候，他們會在常數內存池中取得，讓你覺得一切都好像沒事。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-work/company-ghost-story-6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/24/work/company-ghost-story-6/" class="article-date">
  <time datetime="2020-10-24T10:00:00.000Z" itemprop="datePublished">2020-10-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/工作應用/">工作應用</a>/<a class="article-category-link" href="/categories/工作應用/鬼故事/">鬼故事</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/24/work/company-ghost-story-6/">Company Ghost Story 公司鬼故事 6</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2020/10/24/work/company-ghost-story-6/" data-id="ckkj23o9202fbn0vr8d3h1v2o" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2020/10/24/work/company-ghost-story-6/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/鬼故事/">鬼故事</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><h3 id="Observer-vs-Inheritor"><a href="#Observer-vs-Inheritor" class="headerlink" title="Observer vs. Inheritor"></a>Observer vs. Inheritor</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Tool tool = <span class="keyword">new</span> Tool() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">fireSomething</span><span class="params">(T t)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.fireSomething(t);</div><div class="line">        updateProcess(t);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateProcess</span><span class="params">(T t)</span> </span>&#123;...&#125;</div></pre></td></tr></table></figure>
<p>當觀察者模式 (observer pattern) 的介面應優先考量 attach/addListener，不應該以繼承的方式覆寫 update/fireListener/notify 等函數。</p>
<h3 id="WhatIf"><a href="#WhatIf" class="headerlink" title="WhatIf?"></a>WhatIf?</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (isA()) &#123;</div><div class="line">    <span class="comment">// something</span></div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (isA() &amp;&amp; isB()) &#123;</div><div class="line">    <span class="comment">// dead code</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>第二個 else-if 並不會執行到。</p>
<h3 id="Equals-vs"><a href="#Equals-vs" class="headerlink" title="Equals vs. =="></a>Equals vs. ==</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (a == b &amp;&amp; a.equals(b)) &#123;...&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (a == b || a.equals(b)) &#123;...&#125;</div></pre></td></tr></table></figure>
<p>對 Java 而言，有 <code>Objects.equals</code> 可以替代呼叫，又或者在 <code>boolean equals(Object)</code> 中包含 <code>==</code> 才對。</p>
<h3 id="String-format"><a href="#String-format" class="headerlink" title="String.format"></a>String.format</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String.format(<span class="string">"Move %s"</span>, fromObj, toObj);</div></pre></td></tr></table></figure>
<p>對上參數數量是很重要的。</p>
<h3 id="Mapper-Function"><a href="#Mapper-Function" class="headerlink" title="Mapper Function"></a>Mapper Function</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> T <span class="title">a2b</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">    Map&lt;String, T&gt; mapper = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">    mapper.put(<span class="string">"..."</span>, ...);</div><div class="line">    mapper.put(<span class="string">"..."</span>, ...);</div><div class="line">    mapper.put(<span class="string">"..."</span>, ...);</div><div class="line">    mapper.put(<span class="string">"..."</span>, ...);</div><div class="line">    <span class="keyword">return</span> mapper.get(key);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>手動做 if-else 比較快的，建立 hash 可不是這麼簡單，記憶體宣告等因素需要考慮。而它也不屬於只宣告一次的靜態變數，因此並不適合這樣處理。</p>
<h3 id="Comparable"><a href="#Comparable" class="headerlink" title="Comparable"></a>Comparable</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(T other)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span>[] c = &#123;fa.compareTo(other.fa), fb.compareTo(other.fb) ...&#125;;</div><div class="line">    <span class="keyword">return</span> firstNotZero(c);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>if-else 不應該這樣被偷懶的，整個效能都爛了。</p>
<h3 id="Argument-vs-Method-Name"><a href="#Argument-vs-Method-Name" class="headerlink" title="Argument vs. Method Name"></a>Argument vs. Method Name</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">doExpand</span><span class="params">(<span class="keyword">boolean</span> isExpand)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!isExpand)</div><div class="line">        doCollapse();</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>好的命名決定品質。</p>
<h3 id="Switch"><a href="#Switch" class="headerlink" title="Switch"></a>Switch</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">enableAListener</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">removeAListener</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addBListener</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">stopBListener</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setCListener</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">disableCListener</span><span class="params">()</span> </span>&#123;</div><div class="line">    sListeners.remove(sAListener);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>有一種被玩弄的感覺 …</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-work/company-ghost-story-5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/30/work/company-ghost-story-5/" class="article-date">
  <time datetime="2020-09-30T12:00:00.000Z" itemprop="datePublished">2020-09-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/工作應用/">工作應用</a>/<a class="article-category-link" href="/categories/工作應用/鬼故事/">鬼故事</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/30/work/company-ghost-story-5/">Company Ghost Story 公司鬼故事 5</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2020/09/30/work/company-ghost-story-5/" data-id="ckkj23o9602ffn0vr4bxhnxg7" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2020/09/30/work/company-ghost-story-5/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/鬼故事/">鬼故事</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><h3 id="Duplicate-Field"><a href="#Duplicate-Field" class="headerlink" title="Duplicate Field"></a>Duplicate Field</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> A a;</div><div class="line">    <span class="keyword">final</span> A b;</div><div class="line">    C(A a) &#123;</div><div class="line">        <span class="keyword">this</span>.a = a;</div><div class="line">        <span class="keyword">this</span>.b = a; <span class="comment">// why?</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>為什麼要做出兩個相同意義的欄位？</p>
<h3 id="Strange-Method-Name"><a href="#Strange-Method-Name" class="headerlink" title="Strange Method Name"></a>Strange Method Name</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UIComponent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDisable</span><span class="params">(<span class="keyword">boolean</span> d)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isDisable</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isDisabled</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>英文不好的我，一度慘死。</p>
<h3 id="Strange-Method-Name-II"><a href="#Strange-Method-Name-II" class="headerlink" title="Strange Method Name II"></a>Strange Method Name II</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UIComponent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnabled</span><span class="params">(<span class="keyword">boolean</span> e)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">getEnabled</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>拜託決定一種風格做一件事情。</p>
<h3 id="Inefficient-Listener"><a href="#Inefficient-Listener" class="headerlink" title="Inefficient Listener"></a>Inefficient Listener</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(Component c)</span> </span>&#123;</div><div class="line">    c.addFocusListener(...);</div><div class="line">    c.addChangeListener(...);</div><div class="line">    c.addSelectListener(...);</div><div class="line">    c.setSelect(...); <span class="comment">// trigger listener ...</span></div><div class="line">    c.setFocus(...); <span class="comment">// trigger listener ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>初始化的優先順序很重要，多次觸發有可能發生，造成重複處理。</p>
<h3 id="Override-Method"><a href="#Override-Method" class="headerlink" title="Override Method"></a>Override Method</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uninstall</span><span class="params">()</span> </span>&#123;</div><div class="line">    uninstallMe();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="title">uninstallMe</span><span class="params">()</span> </span>&#123; <span class="comment">// why not write into uninstall()?</span></div><div class="line">    <span class="comment">// something ...</span></div><div class="line">    <span class="keyword">super</span>.uninstall();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>函數這麼簡單，為什麼 <code>super.method</code> 寫在原本的函數外部。出現不同於 <code>@Override</code> 的函數中實在少見。</p>
<h3 id="Empty-Listener"><a href="#Empty-Listener" class="headerlink" title="Empty Listener"></a>Empty Listener</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">c.addWindowListener(<span class="keyword">new</span> WindowAdapter() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">windowClosed</span><span class="params">(WindowEvent e)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.windowClosed(e);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>不要註冊一堆空操作。</p>
<h3 id="Override-Empty"><a href="#Override-Empty" class="headerlink" title="Override Empty"></a>Override Empty</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">install</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// please add comment here if remove parent processing</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>這不知道在寫什麼，也沒叫 <code>super.install()</code>，該觸發事件的都沒觸發，真的沒事嗎？應該是寫錯了吧</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-work/company-ghost-story-4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/26/work/company-ghost-story-4/" class="article-date">
  <time datetime="2020-09-26T02:00:00.000Z" itemprop="datePublished">2020-09-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/工作應用/">工作應用</a>/<a class="article-category-link" href="/categories/工作應用/鬼故事/">鬼故事</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/26/work/company-ghost-story-4/">Company Ghost Story 公司鬼故事 4</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2020/09/26/work/company-ghost-story-4/" data-id="ckkj23o8x02f8n0vr80ogq1dx" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2020/09/26/work/company-ghost-story-4/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/鬼故事/">鬼故事</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="SVN"><a href="#SVN" class="headerlink" title="SVN"></a>SVN</h2><h3 id="Commit-File"><a href="#Commit-File" class="headerlink" title="Commit File"></a>Commit File</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ svn status</div><div class="line">  .DS_Store</div><div class="line">  import.csv$</div><div class="line">  export.txt~</div><div class="line">  test_result.txt</div><div class="line">  golden.txt</div><div class="line">? test_result.log</div></pre></td></tr></table></figure>
<ul>
<li>別建立隱藏檔案格式，以小數點 <code>.</code> 開頭的在 Linux 可是隱藏檔案的意思</li>
<li>別上傳 <code>.DS_Store</code> 那個是 Mac 平台上的隱藏檔案，並不需要</li>
<li>別上傳 <code>xxx.csv$</code>那個是 Microsoft 平台上的 lock 檔案，並不需要</li>
<li>別上傳 <code>xxx.txt~</code> 那個是 emacs, nano, vim 等製造的備份檔案，並不需要</li>
<li>別上傳測試結果，如 <code>test_result.txt</code>，正常來講會覆寫，傳上去結果沒產生怎麼辦，比對還會過呢。</li>
<li>別上傳空資料夾</li>
</ul>
<h3 id="Commit-Log"><a href="#Commit-Log" class="headerlink" title="Commit Log"></a>Commit Log</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ svn <span class="built_in">log</span> golden.txt</div><div class="line">------------------------------------------------------------------------</div><div class="line">r32 | product_bot | 2003-01-13 00:43:13 -0600 (Mon, 13 Jan 2003) | 1 line</div><div class="line"></div><div class="line">Update golden</div></pre></td></tr></table></figure>
<p>拜託用自己的帳號上傳，不小心用到 <code>product_bot</code> 這種全自動的帳號，不曉得是誰修改的內容。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-work/company-ghost-story-3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/20/work/company-ghost-story-3/" class="article-date">
  <time datetime="2020-09-20T06:00:00.000Z" itemprop="datePublished">2020-09-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/工作應用/">工作應用</a>/<a class="article-category-link" href="/categories/工作應用/鬼故事/">鬼故事</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/20/work/company-ghost-story-3/">Company Ghost Story 公司鬼故事 3</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2020/09/20/work/company-ghost-story-3/" data-id="ckkj23o6x02dnn0vrngzgs1o4" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2020/09/20/work/company-ghost-story-3/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/鬼故事/">鬼故事</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><h3 id="Setter-Getter"><a href="#Setter-Getter" class="headerlink" title="Setter/Getter"></a>Setter/Getter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parser</span> </span>&#123;</div><div class="line">    <span class="function">X <span class="title">getX</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">x</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">readX</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">parseX</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">X</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>Java 特性預設都是透過 setter/getter 的概念來完成成員變數的存取。為了擴充使用不建議直接存取變數。</p>
</blockquote>
<p>這毫無設計的函數是發生甚麼事情？名字這麼像是想害死誰啊，而且還都是不同邏輯。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parser</span> </span>&#123;</div><div class="line">    <span class="function">X <span class="title">eX</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">aX</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">sX</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pX</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>不是這樣子說完，就用奇怪的前綴解決。把整個動詞完整描述出來會讓你打字很痛苦嗎？</p>
<h3 id="Inner-Anonymous-Class"><a href="#Inner-Anonymous-Class" class="headerlink" title="Inner/Anonymous Class"></a>Inner/Anonymous Class</h3><p>現在我們用一個指令去搜尋建立的 class files。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ find ./bin -name <span class="string">"*\$[0-9]*.class"</span></div><div class="line">xxxx<span class="variable">$1</span><span class="variable">$1</span>.class</div><div class="line">xxxx<span class="variable">$64</span><span class="variable">$1</span>.class</div><div class="line">...</div><div class="line">xxxx<span class="variable">$64</span><span class="variable">$64</span>.class</div></pre></td></tr></table></figure>
<p>居然發現了非常非常多的匿名類別，而且還是爆炸性的嵌套。這意味者當改變一個 class 檔案時，編譯會一次可能產生上百個檔案。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">getToken</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Token &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="string">"here we are"</span>; &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>這也是常常在調適函數時，不知道為什麼會有 IDE 崩潰的情況發生。其實都是上述的寫法氾濫，連帶的內存洩漏問題也很嚴重。事實上，大部分的匿名類別都可以額外地用功能去描述類別，請重新宣告並且命名好。</p>
<h3 id="Long-Name-Method"><a href="#Long-Name-Method" class="headerlink" title="Long Name Method"></a>Long Name Method</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">addXXXsToAdjacentYYYsSetSoItWillNotAAABBBWhereMMM</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">setXInDatabaseAAABBBField</span><span class="params">()</span></span>;</div></pre></td></tr></table></figure>
<p>這種命名函數比惡名昭彰的匈牙利還兇殘，直接把文件描述寫在函數上，這時候又願意打字了。</p>
<p>請找個稍微中立一點描述方法，等到哪天換了連帶功能，所有相關函數都要重新做過。</p>
<h3 id="Create-Context"><a href="#Create-Context" class="headerlink" title="Create Context"></a>Create Context</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        readPartA();</div><div class="line">        externalCall();</div><div class="line">    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">        setCacheEnabled(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">readPartA</span><span class="params">()</span> </span>&#123;</div><div class="line">    setCacheEnabled(<span class="keyword">false</span>); <span class="comment">// why not place it in read()?</span></div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// in external.xxx</span></div><div class="line">java::setCacheEnabled(<span class="keyword">false</span>); <span class="comment">// what are you doing?</span></div><div class="line">...</div><div class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</div></pre></td></tr></table></figure>
<p>建立 context 的習慣是要寫在同一個檔案中，而且盡可能寫在同一個函數內。</p>
<p>跳來跳去，有時候只有下文，有時候只有上文，不覺得很可怕嗎？萬一中間執行失敗，直接萬劫不復。</p>
<h3 id="Create-Context-II"><a href="#Create-Context-II" class="headerlink" title="Create Context II"></a>Create Context II</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">    db.setDbCheckEnabled(<span class="keyword">false</span>);</div><div class="line">    ...</div><div class="line">    <span class="comment">// where's your setDbCheckEnabled(true);, can I trust you more?</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>直接把所有重要檢查通通關閉，卻忘了開起來，直接出逃啦。</p>
<h3 id="Create-Context-III"><a href="#Create-Context-III" class="headerlink" title="Create Context III"></a>Create Context III</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        db.setDbCheckAEnabled(<span class="keyword">false</span>);</div><div class="line">        db.setDbCheckBEnabled(<span class="keyword">false</span>);</div><div class="line">        ...</div><div class="line">    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">        db.setDbCheckAEnabled(<span class="keyword">true</span>); <span class="comment">// setDbCheckBEnabled() first, please</span></div><div class="line">        db.setDbCheckBEnabled(<span class="keyword">true</span>); <span class="comment">// setDbCheckAEnabled() last, please</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>大部分都不會錯，但建議採用堆疊的順序撰寫。因為有些保護機制會造成重複工作。</p>
<h3 id="Create-Context-IV"><a href="#Create-Context-IV" class="headerlink" title="Create Context IV"></a>Create Context IV</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        db.setDbCheckAEnabled(<span class="keyword">false</span>);</div><div class="line">        db.setDbCheckBEnabled(<span class="keyword">false</span>);</div><div class="line">        ...</div><div class="line">        db.setDbCheckBEnabled(<span class="keyword">true</span>); <span class="comment">// I don't know.jpg</span></div><div class="line">        ...</div><div class="line">    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">        db.setDbCheckBEnabled(<span class="keyword">true</span>);</div><div class="line">        db.setDbCheckAEnabled(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我不知道.jpg。</p>
<h2 id="Regression-Test"><a href="#Regression-Test" class="headerlink" title="Regression Test"></a>Regression Test</h2><h3 id="Create-Test-Folder"><a href="#Create-Test-Folder" class="headerlink" title="Create Test Folder"></a>Create Test Folder</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ tree Regression/FunctionA</div><div class="line">├─testBBBB</div><div class="line">│  └─testCCCC</div><div class="line">│    └─testDDDD</div><div class="line">│      └─test.sh</div><div class="line">...</div></pre></td></tr></table></figure>
<p>為什麼需要前綴 test？請給我一個理由。</p>
<h3 id="Create-Test-Folder-II"><a href="#Create-Test-Folder-II" class="headerlink" title="Create Test Folder II"></a>Create Test Folder II</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ tree Regression/FunctionA</div><div class="line">├─DoNotThrowNoSuchElementException</div><div class="line">│  └─test.sh</div><div class="line">...</div></pre></td></tr></table></figure>
<p>如果是預期丟出錯誤的測試就算了，但錯誤的實例也是會變動的，這樣的資料夾名字不具有太深遠的意義。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-work/company-ghost-story-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/13/work/company-ghost-story-2/" class="article-date">
  <time datetime="2020-09-13T06:00:00.000Z" itemprop="datePublished">2020-09-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/工作應用/">工作應用</a>/<a class="article-category-link" href="/categories/工作應用/鬼故事/">鬼故事</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/13/work/company-ghost-story-2/">Company Ghost Story 公司鬼故事 2</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2020/09/13/work/company-ghost-story-2/" data-id="ckkj23o6u02dkn0vr8h31ue4k" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2020/09/13/work/company-ghost-story-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/鬼故事/">鬼故事</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="C-C"><a href="#C-C" class="headerlink" title="C/C++"></a>C/C++</h2><h3 id="Overprotection"><a href="#Overprotection" class="headerlink" title="Overprotection"></a>Overprotection</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">find_intersect</span><span class="params">(<span class="built_in">list</span>&lt;shape&gt; a, tree b, shape c)</span> </span>&#123;</div><div class="line">   <span class="keyword">if</span> (b == null)</div><div class="line">       b = <span class="keyword">new</span> tree(a);</div><div class="line">   <span class="keyword">return</span> b.find_intersect(c);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>過度保護，造成最後沒人知道 a 和 b 的關係。結果有時候 b 不是由 a 建立的，整串都不知道在做什麼。</p>
<h3 id="Evil-Comma"><a href="#Evil-Comma" class="headerlink" title="Evil Comma"></a>Evil Comma</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (str[<span class="number">0</span>] == <span class="string">'-'</span>);</div><div class="line">str = str.substr(<span class="number">1</span>);</div></pre></td></tr></table></figure>
<p>排版已經告訴你可能發生了問題，但看起來還是救不了下面那一行。似乎沒有發生意外，但是非常恐怖。</p>
<h3 id="Export"><a href="#Export" class="headerlink" title="Export"></a>Export</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">string</span> x = <span class="string">""</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">    x = x + pts[i].str();</div><div class="line"><span class="comment">//  x += pts[i].str();</span></div></pre></td></tr></table></figure>
<p>組成不是大問題，串起來就崩潰 $O(n^2)$。請善用 in-place 的串接。</p>
<h3 id="Test-Script"><a href="#Test-Script" class="headerlink" title="Test Script"></a>Test Script</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// testXXX.cpp</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    ... <span class="comment">// 100,000+ lines</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">g++ testXXX.cpp -O3</div></pre></td></tr></table></figure>
<p>浪費生命從編譯時間著手，拜託開 <code>-O0</code> 就好，這樣就近乎線性時間的編譯速度。開到 <code>-O3</code> 會有平方層級的編譯時間，$(10^5)^2$ 雖然也不是很多，但突然從幾秒變成幾個小時是有可能的。</p>
<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><h3 id="List-vs-Hash"><a href="#List-vs-Hash" class="headerlink" title="List vs Hash"></a>List vs Hash</h3><blockquote>
<p>List 比 Hash 快，不用計算雜湊值，直接比對更快。</p>
</blockquote>
<p>數量一大是不是要平行去找了啊，小伙子。</p>
<h2 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h2><h3 id="Degree-vs-Radian"><a href="#Degree-vs-Radian" class="headerlink" title="Degree vs Radian"></a>Degree vs Radian</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">rotate90</span><span class="params">(<span class="keyword">double</span> deg)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> Math.toRadian(deg + <span class="number">90</span>) % <span class="number">90</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>不會弧度記算沒關係，晚點我們再檢查一下還有哪一段混著算吧。希望都沒事。</p>
<h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><h3 id="linter"><a href="#linter" class="headerlink" title="linter"></a>linter</h3><blockquote>
<p>不要 format code，因為 <code>git blame</code> 不好看。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line"><span class="keyword">try</span> </div><div class="line">&#123;</div><div class="line">    Data rowData = data.getRow(i);</div><div class="line">&#125;</div><div class="line"><span class="keyword">catch</span> (Exception e)</div><div class="line">&#123;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>心靜自然涼，再多的 try-catch 我也可以接受。沒事，我不會受到傷害。</p>
<h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><h3 id="Set-Env-Variable"><a href="#Set-Env-Variable" class="headerlink" title="Set Env Variable"></a>Set Env Variable</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">1. 我的電腦 &gt; 內容 &gt; 進階內容設定 &gt; 環境變數</div><div class="line">2. 重新開機 // ?????</div></pre></td></tr></table></figure>
<p>在大部分情況是不用重新開機，重新開啟 shell 即可。</p>
<h2 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h2><h3 id="Build-Artifacts"><a href="#Build-Artifacts" class="headerlink" title="Build Artifacts"></a>Build Artifacts</h3><blockquote>
<p>每一次建置結果都保存下來，用定時刪除。</p>
</blockquote>
<p>大部分的建置結果只需要保留進 25 次就差不多，如果每一次建置就要耗掉 1 GB 的硬碟空間，那在一天內上傳了好幾次，就會看到 1 TB 硬碟直接死去。</p>
<p>請不要說買硬碟解決問題，這並沒有解決根本問題。</p>
<h3 id="Build-Pipeline"><a href="#Build-Pipeline" class="headerlink" title="Build Pipeline"></a>Build Pipeline</h3><blockquote>
<p>充分運用硬體資源，全部平行。</p>
</blockquote>
<p>有些工作是需要整台伺服器的計算資源，如果安排兩個以上的工作時，會造成另一個工作結果不穩定。而有些工作會需要大量的硬碟 IO，兩個以上甚至會造成卡死的狀態。</p>
<p>請不要說買更多的機器或 CPU 解決問題，這只要開一個有平行工作，另一個工作沒設計好就會自動失敗。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-work/company-ghost-story-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/13/work/company-ghost-story-1/" class="article-date">
  <time datetime="2020-09-13T05:00:00.000Z" itemprop="datePublished">2020-09-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/工作應用/">工作應用</a>/<a class="article-category-link" href="/categories/工作應用/鬼故事/">鬼故事</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/13/work/company-ghost-story-1/">Company Ghost Story 公司鬼故事 1</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2020/09/13/work/company-ghost-story-1/" data-id="ckkj23o7502dvn0vrfunegc4i" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2020/09/13/work/company-ghost-story-1/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/鬼故事/">鬼故事</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <p>以下出現的問題，都是在公司遇到的事件，以類比的方式來描述遇到的狀況。</p>
<h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><h3 id="Unique"><a href="#Unique" class="headerlink" title="Unique"></a>Unique</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DbObj</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.compareTo((DbObj) obj) == <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>對於唯一存在的物件，別用 <code>compareTo()</code> 來實作 <code>equals()</code>，它們可以直接用 <code>==</code> 判定。而且大部分的 <code>compareTo</code> 是比較慢的線性實作。如下述的物件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyString</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;...&#125;; <span class="comment">// possible O(n)</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>結果就是變得超慢。</p>
<h3 id="toString-in-Comparison"><a href="#toString-in-Comparison" class="headerlink" title="toString in Comparison"></a><code>toString</code> in Comparison</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CompositeClass</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">CompositeClass</span>&gt; </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(CompositeClass other)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> toString().compareTo(other.toString()); <span class="comment">// ???????</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>千萬別這麼幹，當我們對類別增加成員時，同時修改 <code>toString()</code> 後，運行結果也不同。這也會帶來嚴重的效能問題，試想著排序的時候，產生一大堆的字串用於比較，那麼垃圾回收就會佔有大部分的時間。</p>
<h3 id="toString-in-Key"><a href="#toString-in-Key" class="headerlink" title="toString() in Key"></a><code>toString()</code> in Key</h3><p>當需要對 <code>enum</code> 或者其他相關物件進行反序列時，避開 <code>toString()</code>，因為這個函數很容易被其他人覆寫。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span> SomeType &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">super</span>.toString() + <span class="string">"..."</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">SomeType.valueOf(type.toString()); <span class="comment">// ?????</span></div></pre></td></tr></table></figure>
<p>有人會說這個函數不該被覆寫，但能操作就可能出事。</p>
<h3 id="It-is-not-in-C"><a href="#It-is-not-in-C" class="headerlink" title="It is not in C++"></a>It is not in C++</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">sameLocation</span><span class="params">(Point a, Point b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> a == b; <span class="comment">// ?????, Objects.equals(a, b)</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>抱歉，您使用的是 Java，並沒有 <code>operator==</code> 的語法，所有的 <code>==</code> 都是比較相同物件，並不會實作對應的 <code>equals()</code>。</p>
<h3 id="Numeric-Comparison"><a href="#Numeric-Comparison" class="headerlink" title="Numeric Comparison"></a>Numeric Comparison</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> Comparator&lt;Point&gt; compareX =</div><div class="line">    (a, b) -&gt; a.getX() - b.getX(); <span class="comment">// X, Long.compare(a.getX(), b.getX());</span></div></pre></td></tr></table></figure>
<p>這種容易發生 overflow/underflow 的寫法，並不建議模仿 C/C++ 的習慣，請多用內建的函數比較。</p>
<h3 id="this-in-Constructor"><a href="#this-in-Constructor" class="headerlink" title="this in Constructor"></a><code>this</code> in Constructor</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> Point &#123;</div><div class="line">    Point(<span class="keyword">long</span> x, <span class="keyword">long</span> y) &#123;</div><div class="line">       mX = x;</div><div class="line">       mY = y;</div><div class="line">    &#125;</div><div class="line">    Point() &#123;</div><div class="line">       mX = <span class="number">0</span>; <span class="comment">// X, this(0, 0);</span></div><div class="line">       mY = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>請盡量使用建構子，各自獨立容易漏掉一些共同的檢查。</p>
<h3 id="Initialization"><a href="#Initialization" class="headerlink" title="Initialization"></a>Initialization</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function">Point <span class="title">copy</span><span class="params">()</span> </span>&#123;</div><div class="line">    Point pt = <span class="keyword">new</span> Point();</div><div class="line">    pt.setX(getX());</div><div class="line">    pt.setY(getY());</div><div class="line">    <span class="keyword">return</span> pt; <span class="comment">// new Point(getX(), getY());</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>能使用建構子完成的事情就盡量使用，分次使用可能會造成過多額外的檢查或調整，效能就會往下掉。</p>
<h3 id="Find-the-Minimum-Maximum-Element"><a href="#Find-the-Minimum-Maximum-Element" class="headerlink" title="Find the Minimum/Maximum Element"></a>Find the Minimum/Maximum Element</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function">Point <span class="title">getMax</span><span class="params">(List&lt;Point&gt; testList)</span> </span>&#123;</div><div class="line">    Collections.sort(testList);</div><div class="line">    <span class="keyword">return</span> testList.get(testList.size() - <span class="number">1</span>); <span class="comment">// Collections.max(testList);</span></div><div class="line">&#125;</div><div class="line"><span class="function">Point <span class="title">getMin</span><span class="params">(List&lt;Point&gt; testList)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> testList.stream().sorted().getFirst().orElse(<span class="keyword">null</span>);</div><div class="line">    <span class="comment">// testList.stream().min().orElse(null);</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>排序很簡單，但也不能亂寫。</p>
<p>排序複雜度大部分為 $O(n \log n)$，事實上找最小值只需要 $O(n)$。當 <span>$n = 10^6$</span><!-- Has MathJax --> 時，效率就可能差到 20 倍。</p>
<h3 id="Computed-Getter"><a href="#Computed-Getter" class="headerlink" title="Computed Getter"></a>Computed Getter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> Comparator&lt;CPoint&gt; compateLocation = </div><div class="line"> (CPoint ca, CPoint cb) -&gt; &#123;</div><div class="line">     <span class="keyword">long</span> p0x = ca.getCPt().getX();</div><div class="line">     <span class="keyword">long</span> p1x = cb.getCPt().getX();</div><div class="line">     <span class="keyword">long</span> p0y = ca.getCPt().getY();</div><div class="line">     <span class="keyword">long</span> p1y = cb.getCPt().getY();</div><div class="line">     ... <span class="comment">// X, return ca.getCPt().compareTo(cb.getCPt());</span></div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>請不要這麼寫，排版好看行數很多並不是好藉口，這呼叫了好幾次 <code>getCPt()</code>，如果牽涉到好幾步複雜運算，整個效率就慢上了好幾倍。</p>
<h3 id="Computed-If-Else"><a href="#Computed-If-Else" class="headerlink" title="Computed If-Else"></a>Computed If-Else</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (getA() != <span class="keyword">null</span> &amp;&amp;</div><div class="line">    getA().getB() != <span class="keyword">null</span> &amp;&amp;</div><div class="line">    getA().getB().getC() != <span class="keyword">null</span>) &#123;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>寫在同一個 if-statement 很方便，卻造成效能嚴重退化。不如蠢一點的寫法，或者透過 <code>Optional&lt;&gt;</code> 來描述回傳型態。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">A a = getA();</div><div class="line"><span class="keyword">if</span> (a != <span class="keyword">null</span>) &#123;</div><div class="line">    B b = a.getB();</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line">getA().ifPresent(a -&gt; &#123;</div><div class="line">    a.getB().ifPresent(...)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="List-Getter"><a href="#List-Getter" class="headerlink" title="List Getter"></a>List Getter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">LinkedList&lt;Long&gt; X;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">doSomething</span><span class="params">(List&lt;Long&gt; X)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; X.size(); i++) &#123;</div><div class="line">        <span class="keyword">long</span> x = X.get(i);</div><div class="line">        ...</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>別鬧了，這會出大事。效能殺手就是你。<code>LinkedList</code> 的 <code>get(index)</code> 可是 $O(n)$ 的。</p>
<h3 id="Immutable-Methods"><a href="#Immutable-Methods" class="headerlink" title="Immutable Methods"></a>Immutable Methods</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">parse</span><span class="params">(String elem)</span> </span>&#123;</div><div class="line">    elem.trim(); <span class="comment">// ??????, elem = elem.trim();</span></div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>記得把回傳值接起來，請不要陡增效能問題。</p>
<h3 id="Method-Reference"><a href="#Method-Reference" class="headerlink" title="Method Reference"></a>Method Reference</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Map&lt;Long, List&lt;Point&gt;&gt; map;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(Point a)</span> </span>&#123;</div><div class="line">    List&lt;Point&gt; list =</div><div class="line">        map.computeIfAbsent(a.mX, key -&gt; <span class="keyword">new</span> LinkedList&lt;&gt;()); <span class="comment">// X, Point::prepare</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> List&lt;Point&gt; <span class="title">prepare</span><span class="params">(Long key)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LinkedList&lt;&gt;();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>盡量使用 method reference，防止 memory leak，也降低 lambda metafactory desugar 的花費。</p>
<h3 id="Boxing"><a href="#Boxing" class="headerlink" title="Boxing"></a>Boxing</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function">Double <span class="title">getRotate</span><span class="params">()</span> </span>&#123; <span class="comment">// X, double</span></div><div class="line">    <span class="keyword">double</span> r = ...;</div><div class="line">    <span class="keyword">return</span> r;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">getMirror</span><span class="params">()</span> </span>&#123;...&#125;;</div><div class="line">Boolean isMirror = getMirror(); <span class="comment">// X, boolean</span></div></pre></td></tr></table></figure>
<p>既然有預設值也確保不會發生 <code>null</code>，請不要過度包裝。拆拆裝裝的狀況會造成垃圾過多。</p>
<h3 id="Exception-is-NOT-a-Return-Value"><a href="#Exception-is-NOT-a-Return-Value" class="headerlink" title="Exception is NOT a Return Value"></a>Exception is NOT a Return Value</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getFileExt</span><span class="params">(File f)</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        String token = parseExt(f);</div><div class="line">        <span class="keyword">return</span> <span class="string">"."</span> + token;</div><div class="line">    &#125; <span class="keyword">catch</span> (NullPointerException e) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>請別接收這麼奇怪的 runtime exception。在 Java 中，exception 很昂貴的，造價就是整個 call stack。</p>
<p>也別這樣追蹤物件的建立，大量物件會造成內存不足。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Throwable trace = <span class="keyword">new</span> Throwable();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Lightweight-Exit"><a href="#Lightweight-Exit" class="headerlink" title="Lightweight Exit"></a>Lightweight Exit</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">process</span><span class="params">(Point p)</span> </span>&#123;</div><div class="line">   List&lt;Long&gt; array = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">10000</span>); <span class="comment">// ?????</span></div><div class="line">   <span class="keyword">if</span> (p == <span class="keyword">null</span>)</div><div class="line">       <span class="keyword">return</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>別急著建立一堆用不著垃圾，有可能在後續判斷中直接返回。盡量縮小變數的生命週期，快用到的時候再準備計算資源。</p>
<h3 id="If-Elif-Else"><a href="#If-Elif-Else" class="headerlink" title="If-Elif-Else"></a>If-Elif-Else</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (token.equals(<span class="string">"a"</span>))</div><div class="line">&#123;</div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> (token.equals(<span class="string">"b"</span>))</div><div class="line">&#123;</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (token.equals(<span class="string">"c"</span>))</div><div class="line">&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>別說排版不重要，那一定是沒看過有人不小心漏了什麼。在大部分情況不太會出事，只是多判斷了幾次造成效能退化。</p>
<h3 id="Dead-instanceof"><a href="#Dead-instanceof" class="headerlink" title="Dead instanceof"></a>Dead <code>instanceof</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span></span>;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Poly</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rect</span> <span class="keyword">extends</span> <span class="title">Poly</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(Shape shape)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (shape <span class="keyword">instanceof</span> Poly) &#123;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shape <span class="keyword">instanceof</span> Rect) &#123;</div><div class="line">      <span class="comment">// ?????, unsearchable</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>凡事有先後，請注意繼承關係。</p>
<h3 id="Observer-Pattern"><a href="#Observer-Pattern" class="headerlink" title="Observer Pattern"></a>Observer Pattern</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> List&lt;ObsListener&gt; list = <span class="keyword">new</span> LinkedList&lt;&gt;();</div><div class="line"><span class="keyword">private</span> Set&lt;ObsListener&gt; list = <span class="keyword">new</span> HashSet&lt;&gt;();</div></pre></td></tr></table></figure>
<p>當訂閱者數量不少，且容易進進出出，請不要用線性的 <code>LinkedList</code>。當你需要嚴格地再現 BUG，就不要使用不穩定順序的 <code>HashSet</code>，請使用 <code>LinkedHashSet</code> 是一種保守的選擇。</p>
<h3 id="Remove-Observer"><a href="#Remove-Observer" class="headerlink" title="Remove Observer"></a>Remove Observer</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateUI</span> <span class="keyword">extends</span> <span class="title">Dialog</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CreateUI</span><span class="params">()</span> </span>&#123;</div><div class="line">        db.addListener(mChangeListener);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// where is your db.removeListener</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>別忘記移除掛載到資料庫的觀察者，這樣往往覆覆操作，越來越慢真的不能怪人。</p>
<h3 id="Opposite-Behavior"><a href="#Opposite-Behavior" class="headerlink" title="Opposite Behavior"></a>Opposite Behavior</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">assert</span> pathA.endsWith(pathB) == </div><div class="line">       pathB.isEndOf(pathA); <span class="comment">// fail ??????</span></div></pre></td></tr></table></figure>
<p>英文函數命名上，操作對稱就該對稱。英文不好要先說，邏輯不好也先說一聲，大家可以幫忙的。</p>
<h3 id="Global-Garbage"><a href="#Global-Garbage" class="headerlink" title="Global Garbage"></a>Global Garbage</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> List&lt;DbObj&gt; tmp;</div><div class="line"></div><div class="line"><span class="function">List&lt;DbObj&gt; <span class="title">getXXX</span><span class="params">()</span> </span>&#123;</div><div class="line">   tmp = <span class="keyword">new</span> LinkedList&lt;&gt;();</div><div class="line">   parallel...</div><div class="line">   <span class="keyword">return</span> tmp;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>別擠壓到下一個人的生存空間，要是沒有使用 <code>getXXX</code>，會看到一堆資料庫物件被卡在全區變數裡頭。</p>
<h3 id="Useless-Argument"><a href="#Useless-Argument" class="headerlink" title="Useless Argument"></a>Useless Argument</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Path</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">startsWith</span><span class="params">(Path p)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">startsWith</span><span class="params">(Path p, Object a)</span></span>; <span class="comment">// new one</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>別因為不想改動原本的，建立一個一模一樣名字的函數，而且第二個參數並沒有使用到，overloading 不是這樣子設計的。</p>
<h3 id="Count"><a href="#Count" class="headerlink" title="Count"></a>Count</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getPointCount</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> mPoints.parallelStream().count();</div><div class="line">    <span class="comment">// return mPoints.size();</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以覺得慢，但不要總是開平行解決事情。這種計數問題，通常都有相關的方法可以呼叫。如果沒有，請聯絡相關人士。</p>
<h3 id="Tooltip"><a href="#Tooltip" class="headerlink" title="Tooltip"></a>Tooltip</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">String tooltip = <span class="string">""</span>; <span class="comment">// should StringBuilder</span></div><div class="line"><span class="keyword">for</span> (DbObj t : db.getObjects(XXX.class))</div><div class="line">    tooltip = tooltip + t.toString();</div></pre></td></tr></table></figure>
<p>沒人說這樣不好，除了串接消耗 $O(n^2)$，一般也不會把所有東西拉出來。</p>
<h3 id="Convert-Set-to-Array"><a href="#Convert-Set-to-Array" class="headerlink" title="Convert Set to Array"></a>Convert Set to Array</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function">List&lt;Point&gt; <span class="title">toArray</span><span class="params">(Set&lt;Point&gt; set)</span> </span>&#123;</div><div class="line">    List&lt;Point&gt; arr = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">for</span> (Point e : set)</div><div class="line">        arr.add(e);</div><div class="line">    <span class="keyword">return</span> arr; <span class="comment">// return new ArrayList&lt;&gt;(set);</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>建構子更方便，別這麼辛苦，效能至少慢了兩倍。</p>
<p>演算法還是有它的極限在的，常數的確不是很重要，但是數量一大的時候，均攤造成額外操作造成的垃圾，在 Java 中會變得相當明顯。</p>
<h3 id="Error-Message"><a href="#Error-Message" class="headerlink" title="Error Message"></a>Error Message</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function">Integer <span class="title">parseInteger</span><span class="params">(String x)</span> </span>&#123;</div><div class="line">    String errMsg = x + <span class="string">"is an invalid integer format..."</span>;</div><div class="line">    errMsg = attachCurrentLineMessage(errMsg);</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">       Integer n = Integer.parseInt(x);</div><div class="line">       <span class="keyword">return</span> n;</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">       System.err.println(errMsg);</div><div class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>人家還沒出錯，先別急著準備錯誤訊息。提前準備的字串複雜度比處理的複雜度還高，這絕不允許。</p>
<h3 id="New-Option"><a href="#New-Option" class="headerlink" title="New Option"></a>New Option</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">import</span><span class="params">(<span class="keyword">boolean</span> a)</span></span>;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">import</span><span class="params">(<span class="keyword">boolean</span> a, <span class="keyword">boolean</span> b)</span></span>;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">import</span><span class="params">(<span class="keyword">boolean</span> a, <span class="keyword">boolean</span> b, <span class="keyword">int</span> c)</span></span>;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">import</span><span class="params">(<span class="keyword">boolean</span> a, <span class="keyword">boolean</span> b, <span class="keyword">int</span> c, String d)</span></span>;</div><div class="line">...</div></pre></td></tr></table></figure>
<p>別再為了新參數往上疊，請用更容易看出參數意義的 builder 的寫法。</p>
<p>越來越多的參數，造成容易寫錯傳參的順序的悲劇，這時候 BUG</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
</section>
          
          
            <aside id="sidebar">
  <!-- <div id="ukagaka_panel"></div> -->
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">115</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算機圖學/">計算機圖學</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/">工作應用</a><span class="category-list-count">19</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Java/">Java</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/可持久化/">可持久化</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/鬼故事/">鬼故事</a><span class="category-list-count">9</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">633</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">483</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">77</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">45</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2021/01/30/work/company-ghost-story-9/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 9</a>
          </li>
        
          <li>
            <a class="text" href="/2020/12/12/java/java-jni-tls-error/">
              
                <i class="icon-file-o"></i> 
              
            Java JNI Thread Error (EINVAL)</a>
          </li>
        
          <li>
            <a class="text" href="/2020/11/08/work/company-ghost-story-8/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 8</a>
          </li>
        
          <li>
            <a class="text" href="/2020/11/01/work/company-ghost-story-7/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 7</a>
          </li>
        
          <li>
            <a class="text" href="/2020/10/31/lesson/ada-2020-hw1-p3/">
              
                <i class="icon-file-o"></i> 
              
            ADA 2020 Fall P3. ADA Party</a>
          </li>
        
          <li>
            <a class="text" href="/2020/10/31/lesson/ada-2020-hw1-p2/">
              
                <i class="icon-file-o"></i> 
              
            ADA 2020 Fall P2. Bomb Game</a>
          </li>
        
          <li>
            <a class="text" href="/2020/10/25/diary-202010/">
              
                <i class="icon-file-o"></i> 
              
            資訊科學的偏科生 面試者篇</a>
          </li>
        
          <li>
            <a class="text" href="/2020/10/24/work/company-ghost-story-6/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 6</a>
          </li>
        
          <li>
            <a class="text" href="/2020/09/30/work/company-ghost-story-5/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 5</a>
          </li>
        
          <li>
            <a class="text" href="/2020/09/26/work/company-ghost-story-4/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 4</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
<script type="text/javascript">
  $('#ukagaka_panel').ukagaka();
</script>
  
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2021 Shiang-Yun Yang 
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>