<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Category: 學校課程 | Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Morris&#39; Blog">
<meta property="og:url" content="http://morris821028.github.io/categories/學校課程/page/11/index.html">
<meta property="og:site_name" content="Morris&#39; Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris&#39; Blog">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
  <!-- <link rel="import" href="/bower_components/app-layout/app-layout.html"> --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          
          <section id="main">
  
    <article id="post-lesson/hw-ci-paper" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/09/lesson/hw-ci-paper/" class="article-date">
  <time datetime="2014-06-09T00:58:48.000Z" itemprop="datePublished">2014-06-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/img/1402224682465.jpg" rel="gallery_cksb6ga5r02erd8vnnhf20wc7">
        <img src="/img/1402224682465.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/09/lesson/hw-ci-paper/">論文選讀 Building optimal regression tree by ant colony system ...</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/06/09/lesson/hw-ci-paper/" data-id="cksb6ga5r02erd8vnnhf20wc7" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/06/09/lesson/hw-ci-paper/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/螞蟻算法/">螞蟻算法</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="前文"><a href="#前文" class="headerlink" title="前文"></a>前文</h1><p>課程 <strong> 計算型智慧 </strong> 報告，這是一門碩班課程，因此聽了許多學長的報告，雖然有難有易，牽扯的領域相當繁雜且艱深，例如影像分析、電機、醫學領域 … 等，很多都是有聽沒有懂，但是多少能明白一些些道理，即使後來挑選幾個進行實作，發現自己根本沒有理解，或者只是單純實作能力不足。</p>
<p>其中最常見到的報告內容是 B*-tree with floor plan，對於電子電路的配置擺放，要求最小化面積的操作。當然其中也有幾個跟我報告的預測性有關。對於影響分析就不多述了，其中也有幾個電費電流調控也挺有意思的，總之報告內容相當多元。</p>
<p>報告的時候，教授就在台下緊盯，而我剛好是在教授開會的時候報告，這學期僅我一個在教授不在的情況下報告。</p>
<ul>
<li>One Exam: 30%<br>只有一次期中考，而且還是人腦仿電腦考試，但是題目沒有講清楚，考炸了不少，題目理解上把常數搞錯意思，但是這不影響廣義型算法，希望助教給點分！例如：在基因算法中交配的兩兩交配，難道就不能與自己交配嗎？而在粒子算法中，只給兩個參數，難道就不能只模仿全局最佳點和自己嗎？如果只有兩個參數，而且加總為一，您叫我如何模仿鄰居和自己，看來只能二選一。</li>
<li>Homework: 40% (3 programs)</li>
<li>Presentation: 30%<br>教授不在的情況下仍可以報告，所以成績是由助教評定嗎？</li>
<li>Questions: 3<br>本課程一定要問三個問題，否則視如無效修課，但是問題我總是在課堂中發問，對於學長報告的內容有點作噁不明白。</li>
</ul>
<p>論文挑選為「Building optimal regression tree by ant colony system – genetic algorithm Application to modeling of melting points」這是一篇化學期刊上的運用，不是在計算機領域的論文。</p>
<h1 id="開始"><a href="#開始" class="headerlink" title="開始"></a>開始</h1><h2 id="從一個最簡單的應用開始"><a href="#從一個最簡單的應用開始" class="headerlink" title="從一個最簡單的應用開始"></a>從一個最簡單的應用開始</h2><p>在二十個問題內，能猜出心中想的目標角色。這一類的遊戲相當多，在很多遊戲或者是心理測驗中都會用到，用來預測你大概會是哪一種類型的人、或者正在想什麼。<br><a href="http://en.akinator.com/" target="_blank" rel="external">http://en.akinator.com/</a></p>
<h2 id="決策樹"><a href="#決策樹" class="headerlink" title="決策樹"></a>決策樹</h2><p>決策樹的分類</p>
<ul>
<li>Classification Tree：分類樹<br>分類，輸出 “類型”</li>
<li>Regression Tree：回歸樹<br>關係程度，輸出 “數值”</li>
<li>CART (Classification And Regression Tree) 即上述兩個的總稱</li>
</ul>
<h3 id="關於-CART"><a href="#關於-CART" class="headerlink" title="關於 CART"></a>關於 CART</h3><ul>
<li>大量數據可以快速算出結果</li>
<li>易於理解 和 解釋</li>
<li>可以用統計數據驗證模型</li>
<li>最優 CART 是 NP 問題。</li>
<li>能力有限，只能對有限數據屬性操作</li>
<li>機器學習 Machine Learning 領域常用</li>
</ul>
<h2 id="論文實驗資料"><a href="#論文實驗資料" class="headerlink" title="論文實驗資料"></a>論文實驗資料</h2><ul>
<li>4173 種化合物，分類屬性有 202 種描述方式。在 4173 種化合物中，3000 種用來訓練，1173 種用來驗證。</li>
<li>與另外一組經由 277 種藥物進行熔點預測的 CART 相比。(另外一篇論文做的結果)</li>
<li>目標預測更加準確。</li>
</ul>
<h2 id="CART–ACS–GA-理論"><a href="#CART–ACS–GA-理論" class="headerlink" title="CART–ACS–GA 理論"></a>CART–ACS–GA 理論</h2><ul>
<li>將 ACS – GA 算法，套用在 CART 的建造上。</li>
<li>先說說 <a href="#ACS-GA" title="蟻群遺傳混合算法">ACS – GA</a> 算法運作</li>
</ul>
<h2 id="ACS-GA"><a href="#ACS-GA" class="headerlink" title="ACS-GA"></a>ACS-GA</h2><p>ACS–GA 算法 (蟻群遺傳混合算法)，基於 ACS 的缺點 – 收斂慢，加入 GA 算法來加快。</p>
<ul>
<li>為什麼不單純使用 GA 算法就好？</li>
<li>對問題編碼的困難 (轉 DNA 的問題)，突變效果可能不好</li>
</ul>
<p>螞蟻基因也有好壞問題</p>
<ul>
<li>如何反應基因好壞</li>
<li>對費洛蒙決策的方式</li>
<li>對費洛蒙的敏感度 … 等</li>
</ul>
<p>換句話說，將螞蟻的能力也各自數據化，對於產生較好解的螞蟻，繁殖、交配、突變，接著談論如何運用在 CART！</p>
<h2 id="CART-建造"><a href="#CART-建造" class="headerlink" title="CART 建造"></a>CART 建造</h2><p>假解亂做前，如何隨機？CART 是一棵二分樹<br>How we do ?</p>
<ul>
<li>基於深度優先的方式，直到某個葉節點的分類種數 &lt; 30 或深度大於某個值，就退回。</li>
<li>每一層必須決定 “依據哪個屬性分類” Age ? Gender ? Last R ?</li>
<li>分類時，又要按照什麼 數值 進行分割。&lt; 30 ? &gt; 30 ? = 30 ?</li>
</ul>
<p>假設 CART 有 m 個節點，n 個分類描述。在此篇中，化合物有 202 種描述，即 n = 202。</p>
<ul>
<li>為了表示螞蟻的判斷能力，到達某個節點 i 時，採用下一個分類方式 k 的費洛蒙 M[i][k]<br>i &lt; m, k &lt; n</li>
<li>這樣可以決定分類方式。對於某個節點 i，i 可以是目前累計完成的節點個數，或者是其他。</li>
</ul>
<p>上面決定了分類方式，但沒決定分割點 ( cut point ) 的選擇方式。</p>
<ul>
<li>假設用 10 種決策方式，來對應分類到節點內有的所有項目屬性，進行統計分類。<ul>
<li>決策方式 1：平均、眾數、權重、 ID3、C4.5 (熵理論和訊息增益) … 等分割策略</li>
<li>決策方式 2 : 用 10 個常數對於屬性最大最小值 <code>f(min, max) = x0 * min + x1 * max + x2 * min * max</code></li>
<li>決策方式 3：最大最小值之間切 10 等分。</li>
</ul>
</li>
<li>費洛蒙將會有 10 × n × m，即 M[10][n][m]。</li>
</ul>
<h2 id="關於適應函數"><a href="#關於適應函數" class="headerlink" title="關於適應函數"></a>關於適應函數</h2><h3 id="對於葉節點"><a href="#對於葉節點" class="headerlink" title="對於葉節點"></a>對於葉節點</h3><p>Partial least squares method 不同於 “最小平方法”</p>
<ul>
<li>多因變數 對 多自變數 的回歸建模方法</li>
<li>對於每一個葉節點的所有資料分別做偏最小二乘法，會得到分類的相聯性，也就是 相關係數 (correlation coefficient)</li>
<li>相關係數總和大小 與 適應力高低 成正比，用 驗證集 找到相關係數。</li>
</ul>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><ul>
<li>對於下次迭代，偏向於好的切割屬性</li>
<li>對於切割屬性，可以得到好的分割點</li>
<li>排除單一分割策略的形式</li>
</ul>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/hw-nachos4-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/30/lesson/hw-nachos4-2/" class="article-date">
  <time datetime="2014-05-30T05:34:19.000Z" itemprop="datePublished">2014-05-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/作業系統/">作業系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/30/lesson/hw-nachos4-2/">向 NachOS 4.0 作業進發 (2)</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/30/lesson/hw-nachos4-2/" data-id="cksb6ga5g02ecd8vn8x1ia3bf" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/30/lesson/hw-nachos4-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NachOS/">NachOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/作業系統/">作業系統</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="接續"><a href="#接續" class="headerlink" title="接續"></a>接續</h1><p>接續上一篇的 <a href="http://morris821028.github.io/2014/05/24/hw-nachos4/">向 NachOS 4.0 作業進發 (1)</a>，我們繼續完成排程處理，在原始的 NachOS 4.0 中，基礎排程是 Round-robin，它的運作方式藉由定時呼叫 <code>threads/alarm.h</code> 中的 <code>Alarm::CallBack()</code>，而呼叫的時脈來源設定為 <code>machine/stats.h</code> 中的 <code>const int TimerTicks = 100;</code> 決定，數值越小表示呼叫頻率越高，置換的次數就會上升。</p>
<h1 id="目標-Scheduler"><a href="#目標-Scheduler" class="headerlink" title="目標 Scheduler"></a>目標 Scheduler</h1><ul>
<li>FIFO (FCFS) 先來先服務</li>
<li>SJF     最短工作優先</li>
<li>Priority 最小優先權優先</li>
<li>RR    (Round-robin)</li>
<li>multi-level queue <strong> 最後的大魔王 </strong></li>
</ul>
<h1 id="開始"><a href="#開始" class="headerlink" title="開始"></a>開始</h1><h2 id="第一步-測試"><a href="#第一步-測試" class="headerlink" title="第一步 - 測試"></a>第一步 - 測試</h2><p>先來說說怎麼測試自己的寫的代碼正確性，不然怎麼寫都只是理論腦補，雖然會動，但是不知道是否寫對。</p>
<ul>
<li><p>第一種方式為下達 </p>
<pre><code>$ ./nachos -e ../test/test1 -e ../test/test2 ... 多個
</code></pre><p>  這樣必須自己設置優先權、Burst Time，這方面撰寫方式有兩種，其一是來亂，其二是較為正式，而在 Burst Time 的計算又分成兩種，一是執行前已知、二是執行時猜測。</p>
<ul>
<li><p>其一來亂寫法，</p>
<pre><code>$ ./nachos -e ../test/test1 -e ../test/test2 ... 多個
</code></pre><p>  不改變原本的的執行方式，直接在代碼中決策 thread fork 出來時所擁有的優先權和 Burst Time。<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> testPriority = <span class="number">0</span>;</div><div class="line"><span class="keyword">void</span> </div><div class="line">Thread::Fork(VoidFunctionPtr func, <span class="keyword">void</span> *arg)</div><div class="line">&#123;</div><div class="line"><span class="comment">// morris add</span></div><div class="line">    testPriority++;</div><div class="line">    <span class="keyword">if</span>(testPriority == <span class="number">1</span>)</div><div class="line">        setPriority(<span class="number">64</span>);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(testPriority == <span class="number">2</span>)</div><div class="line">        setPriority(<span class="number">128</span>);</div><div class="line">    <span class="keyword">else</span></div><div class="line">        setPriority(<span class="number">64</span>);</div><div class="line"><span class="comment">// end morris add</span></div></pre></td></tr></table></figure><br>  因此，您可能會寫出以上的代碼，當然我不建議這麼寫，雖然是一種測試方式，但這並不好，一開始就這麼錯得相當離譜。</p>
</li>
<li><p>其二寫法，增加下達參數，不過這些參數格式要去查閱一下他們的參數傳遞建造，我想會寫成大概的樣子為</p>
<pre><code>$ ./nachos -e ../test/test1 -pw 64 -e ../test/test2  -pw 128 ... 
</code></pre><p>  多個為了不增加工作量，這裡就沒有親自去實作。某方面來說，可能要寫很多 small program 進行測試，並且撰寫時還要預測會跑多久，這難度會稍微提高。</p>
</li>
</ul>
</li>
<li><p>第二種方式按照軟工的寫法<br>  來寫 test code 吧！如果細心一點，就會看到相關的 <code>Class::SelfTest()</code> 在很多 class 都有的，因此我們需要把 test code 寫到 SelfTest 中被呼叫。因此，不需要有實體的 process 運行，只是單純地測試我們寫的 scheduler 的排程順序是否正確。<figure class="highlight cpp"><figcaption><span>threads/thread.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span></div><div class="line">threadBody() &#123;</div><div class="line">    Thread *thread = kernel-&gt;currentThread;</div><div class="line">    <span class="keyword">while</span> (thread-&gt;getBurstTime() &gt; <span class="number">0</span>) &#123;</div><div class="line">        thread-&gt;setBurstTime(thread-&gt;getBurstTime() - <span class="number">1</span>);</div><div class="line">        kernel-&gt;interrupt-&gt;OneTick();</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%s: remaining %d\n"</span>, kernel-&gt;currentThread-&gt;getName(), kernel-&gt;currentThread-&gt;getBurstTime());</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span></div><div class="line">Thread::SchedulingTest()</div><div class="line">&#123;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> thread_num = <span class="number">4</span>;</div><div class="line">    <span class="keyword">char</span> *name[thread_num] = &#123;<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>, <span class="string">"D"</span>&#125;;</div><div class="line">    <span class="keyword">int</span> thread_priority[thread_num] = &#123;<span class="number">5</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>&#125;;</div><div class="line">    <span class="keyword">int</span> thread_burst[thread_num] = &#123;<span class="number">3</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">3</span>&#125;;</div><div class="line">    </div><div class="line">    Thread *t;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; thread_num; i ++) &#123;</div><div class="line">        t = <span class="keyword">new</span> Thread(name[i]);</div><div class="line">        t-&gt;setPriority(thread_priority[i]);</div><div class="line">        t-&gt;setBurstTime(thread_burst[i]);</div><div class="line">        t-&gt;Fork((VoidFunctionPtr) threadBody, (<span class="keyword">void</span> *)<span class="literal">NULL</span>);</div><div class="line">    &#125;</div><div class="line">    kernel-&gt;currentThread-&gt;Yield();</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>  請自行在 <code>class Thread</code> 增加 <code>setPriority()</code>, <code>setBurstTime()</code>, <code>SchedulingTest()</code> … 等 method header and body。<figure class="highlight cpp"><figcaption><span>threads/thread.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Thread</span> &#123;</span></div><div class="line">  <span class="keyword">private</span>:</div><div class="line">   ...</div><div class="line"></div><div class="line">  <span class="keyword">public</span>:</div><div class="line">   ...</div><div class="line">    <span class="comment">// morris add</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setBurstTime</span><span class="params">(<span class="keyword">int</span> t)</span>	</span>&#123;burstTime = t;&#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getBurstTime</span><span class="params">()</span>		</span>&#123;<span class="keyword">return</span> burstTime;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setStartTime</span><span class="params">(<span class="keyword">int</span> t)</span>	</span>&#123;startTime = t;&#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getStartTime</span><span class="params">()</span>		</span>&#123;<span class="keyword">return</span> startTime;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setPriority</span><span class="params">(<span class="keyword">int</span> t)</span>	</span>&#123;execPriority = t;&#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getPriority</span><span class="params">()</span>		</span>&#123;<span class="keyword">return</span> execPriority;&#125;</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SchedulingTest</span><span class="params">()</span></span>;</div><div class="line">  <span class="keyword">private</span>:</div><div class="line">    <span class="comment">// some of the private data for this class is listed above</span></div><div class="line"></div><div class="line">    <span class="comment">// morris add</span></div><div class="line">    <span class="keyword">int</span> burstTime;	<span class="comment">// predicted burst time</span></div><div class="line">    <span class="keyword">int</span> startTime;	<span class="comment">// the start time of the thread</span></div><div class="line">    <span class="keyword">int</span> execPriority;	<span class="comment">// the execute priority of the thread</span></div><div class="line">    ...</div><div class="line">&#125;;</div></pre></td></tr></table></figure><br>  接著是需要 call testcode 加入到 ThreadedKernel 中。<figure class="highlight cpp"><figcaption><span>threads/kernel.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span></div><div class="line">ThreadedKernel::SelfTest() &#123;</div><div class="line">   Semaphore *semaphore;</div><div class="line">   SynchList&lt;<span class="keyword">int</span>&gt; *synchList;</div><div class="line">   </div><div class="line">   LibSelfTest();		<span class="comment">// test library routines</span></div><div class="line">   </div><div class="line">   currentThread-&gt;SelfTest();	<span class="comment">// test thread switching</span></div><div class="line">   Thread::SchedulingTest();   </div><div class="line">   				<span class="comment">// test semaphore operation</span></div><div class="line">   semaphore = <span class="keyword">new</span> Semaphore(<span class="string">"test"</span>, <span class="number">0</span>);</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>  因此我們可以利用單一 module 就能進行檢查。</p>
<pre><code>$ cd code/threads
$ ./nachos
</code></pre><p>  但是這種方式，並沒有決定我們要測試哪一種類型的 scheduler，額外需要設定參數，讓其選擇建造哪一種的 <code>readyList(Thread*)</code></p>
<pre><code>$ cd code/threads
$ ./nachos FCFS
$ ./nachos SJF
$ ./nachos Priority
$ ./nachos RR
</code></pre><p>  預計要修成如上述的測試方式。<figure class="highlight cpp"><figcaption><span>threads/main.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span></div><div class="line">main(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</div><div class="line">&#123;</div><div class="line">    ...</div><div class="line">    debug = <span class="keyword">new</span> Debug(debugArg);</div><div class="line">    </div><div class="line">    DEBUG(dbgThread, <span class="string">"Entering main"</span>);</div><div class="line"><span class="comment">//</span></div><div class="line">    SchedulerType type = RR;</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">"FCFS"</span>) == <span class="number">0</span>) &#123;</div><div class="line">    type = FIFO;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">"SJF"</span>) == <span class="number">0</span>) &#123;</div><div class="line">    type = SJF;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">"PRIORITY"</span>) == <span class="number">0</span>) &#123;</div><div class="line">    type = Priority;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">"RR"</span>) == <span class="number">0</span>) &#123;</div><div class="line">    type = RR;</div><div class="line">    &#125;</div><div class="line"><span class="comment">//</span></div><div class="line">    kernel = <span class="keyword">new</span> KernelType(argc, argv);</div><div class="line">    kernel-&gt;Initialize(type);</div><div class="line">    </div><div class="line">    CallOnUserAbort(Cleanup);		<span class="comment">// if user hits ctl-C</span></div><div class="line"></div><div class="line">    kernel-&gt;SelfTest();</div><div class="line">    kernel-&gt;Run();</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</li>
</ul>
<blockquote>
<p>第一步測試撰寫就這麼結束，比起撰寫新的 code，不會進行測試也是徒勞。</p>
<p>雖然這麼說，實際運作也是先寫 code 再寫 test code，因為當時還不太懂這些，所以如果已經先寫了一些也不用難過，大家都是這麼走過來的。</p>
<p>如果不知道怎麼執行，哪還有什麼撰寫的欲望，如果不知道怎麼測試，那就是在黑暗中漫步。</p>
</blockquote>
<h2 id="第二步-撰寫"><a href="#第二步-撰寫" class="headerlink" title="第二步 - 撰寫"></a>第二步 - 撰寫</h2><p>在撰寫開始前，如果使用走第一種測試方式的人，需要將實體記憶體用大一點，否則需要實作虛擬記憶體的 context-swith。</p>
<figure class="highlight cpp"><figcaption><span>machine/machine.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> NumPhysPages = <span class="number">64</span>;  <span class="comment">// morris modify, old value=32</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MemorySize = (NumPhysPages * PageSize);</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> TLBSize = <span class="number">4</span>;			<span class="comment">// if there is a TLB, make it small</span></div></pre></td></tr></table></figure>
<p>若完成以上的修改，在 <code>/userprog</code> 下，執行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./nachos -e ../test/test1 -e ../test/test2 -e ../test/test1</div></pre></td></tr></table></figure></p>
<p>就不會跑出 segment fault 。<br><figure class="highlight cpp"><figcaption><span>threads/scheduler.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span> SchedulerType &#123;</div><div class="line">        RR,     <span class="comment">// Round Robin</span></div><div class="line">        SJF,</div><div class="line">        Priority,</div><div class="line">        FIFO</div><div class="line">&#125;;</div><div class="line">...</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Scheduler</span> &#123;</span></div><div class="line">  <span class="keyword">public</span>:</div><div class="line">    Scheduler();</div><div class="line">    Scheduler(SchedulerType type);		<span class="comment">// Initialize list of ready threads </span></div><div class="line">    ...</div><div class="line">    	<span class="comment">// morris add</span></div><div class="line">    <span class="function">SchedulerType <span class="title">getSchedulerType</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> schedulerType;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setSchedulerType</span><span class="params">(SchedulerType t)</span> </span>&#123;schedulerType = t;&#125;</div><div class="line">  <span class="keyword">private</span>:</div><div class="line">    ...</div><div class="line">&#125;;</div></pre></td></tr></table></figure><br>如果有機會查閱其他代碼，很常見會把 <code>List&lt;Thread *&gt; *readyList;</code> 改成 <code>SortedList&lt;Thread *&gt; *readyList;</code> 但是其實不用的，可以利用多形來完成，畢竟 <code>SortedList</code> 繼承 <code>List</code>。因此是不需要更動的。</p>
<p>接著，我們使用多形，在建構子中決定要用哪一種類型的排程，並且宣告相對應的 <code>compare function</code>，參照如下。<br><figure class="highlight cpp"><figcaption><span>threads/scheduler.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">SJFCompare</span><span class="params">(Thread *a, Thread *b)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(a-&gt;getBurstTime() == b-&gt;getBurstTime())</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">return</span> a-&gt;getBurstTime() &gt; b-&gt;getBurstTime() ? <span class="number">1</span> : <span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">PriorityCompare</span><span class="params">(Thread *a, Thread *b)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(a-&gt;getPriority() == b-&gt;getPriority())</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">return</span> a-&gt;getPriority() &gt; b-&gt;getPriority() ? <span class="number">1</span> : <span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">FIFOCompare</span><span class="params">(Thread *a, Thread *b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//----------------------------------------------------------------------</span></div><div class="line"><span class="comment">// Scheduler::Scheduler</span></div><div class="line"><span class="comment">// 	Initialize the list of ready but not running threads.</span></div><div class="line"><span class="comment">//	Initially, no ready threads.</span></div><div class="line"><span class="comment">//----------------------------------------------------------------------</span></div><div class="line">Scheduler::Scheduler() &#123;</div><div class="line">    Scheduler(RR);</div><div class="line">&#125;</div><div class="line">Scheduler::Scheduler(SchedulerType type)</div><div class="line">&#123;</div><div class="line">    schedulerType = type;</div><div class="line">    <span class="keyword">switch</span>(schedulerType) &#123;</div><div class="line">    <span class="keyword">case</span> RR:</div><div class="line">        readyList = <span class="keyword">new</span> List&lt;Thread *&gt;;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> SJF:</div><div class="line">        readyList = <span class="keyword">new</span> SortedList&lt;Thread *&gt;(SJFCompare);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> Priority:</div><div class="line">        readyList = <span class="keyword">new</span> SortedList&lt;Thread *&gt;(PriorityCompare);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> FIFO:</div><div class="line">        readyList = <span class="keyword">new</span> SortedList&lt;Thread *&gt;(FIFOCompare);</div><div class="line">    &#125;</div><div class="line">    toBeDestroyed = <span class="literal">NULL</span>;</div><div class="line">&#125; </div></pre></td></tr></table></figure><br>上述的寫法是因為沒有辦法宣告 default argument value for class。</p>
<p>如果需要搶先 (Preemptive) 設計，則在 <code>Alarm::CallBack()</code> 決定是否要呼叫 <code>interrupt-&gt;YieldOnReturn()</code> 查看是否有更需要優先的 process 要執行。<br><figure class="highlight cpp"><figcaption><span>threads/alarm.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> </div><div class="line">Alarm::CallBack() </div><div class="line">&#123;</div><div class="line">    Interrupt *interrupt = kernel-&gt;interrupt;</div><div class="line">    MachineStatus status = interrupt-&gt;getStatus();</div><div class="line">    <span class="keyword">bool</span> woken = _bedroom.MorningCall();</div><div class="line"></div><div class="line">    kernel-&gt;currentThread-&gt;setPriority(kernel-&gt;currentThread-&gt;getPriority() - <span class="number">1</span>);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (status == IdleMode &amp;&amp; !woken &amp;&amp; _bedroom.IsEmpty()) &#123;<span class="comment">// is it time to quit?</span></div><div class="line">        <span class="keyword">if</span> (!interrupt-&gt;AnyFutureInterrupts()) &#123;</div><div class="line">        timer-&gt;Disable();	<span class="comment">// turn off the timer</span></div><div class="line">    &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;			<span class="comment">// there's someone to preempt</span></div><div class="line">    <span class="keyword">if</span>(kernel-&gt;scheduler-&gt;getSchedulerType() == RR ||</div><div class="line">        kernel-&gt;scheduler-&gt;getSchedulerType() == Priority ) &#123;</div><div class="line"><span class="comment">//		interrupt-&gt;YieldOnReturn();</span></div><div class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"=== interrupt-&gt;YieldOnReturn ==="</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">        interrupt-&gt;YieldOnReturn();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在 Burst Time 計算上，如果採用運行時估計，可以在以下代碼中進行計算。<code>kernel-&gt;stats-&gt;userTicks</code> 是執行 user program 的時間累加器 (也存有一個 system program 的時間累加器，運行 thread context-free, thread scheduling … 等時間用途。)<br><figure class="highlight cpp"><figcaption><span>threads/alarm.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> </div><div class="line">Alarm::WaitUntil(<span class="keyword">int</span> x) &#123;</div><div class="line">    IntStatus oldLevel = kernel-&gt;interrupt-&gt;SetLevel(IntOff);</div><div class="line">    Thread* t = kernel-&gt;currentThread;</div><div class="line"></div><div class="line">    <span class="comment">// burst time</span></div><div class="line">    <span class="keyword">int</span> worktime = kernel-&gt;stats-&gt;userTicks - t-&gt;getStartTime();</div><div class="line">    t-&gt;setBurstTime(t-&gt;getBurstTime() + worktime);</div><div class="line">    t-&gt;setStartTime(kernel-&gt;stats-&gt;userTicks);</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Alarm::WaitUntil go sleep"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    _bedroom.PutToBed(t, x);</div><div class="line">    kernel-&gt;interrupt-&gt;SetLevel(oldLevel);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其實到這裡已經完成，接下來就放幾張測試結果。</p>
<p><img src="/img/multiprogramming.png" alt="multi-programming"></p>
<p><img src="/img/FCFS-1.png" alt="FCFS(1)"><br><img src="/img/FCFS-2.png" alt="FCFS(2)"></p>
<p><img src="/img/RR-1.png" alt="RR(1)"><br><img src="/img/RR-2.png" alt="RR(2)"></p>
<p><img src="/img/SJF-1.png" alt="SJF(1)"><br><img src="/img/SJF-2.png" alt="SJF(2)"></p>
<p><img src="/img/Priority-1.png" alt="Priority(1)"><br><img src="/img/Priority-2.png" alt="Priority(1)"></p>
<h1 id="最後"><a href="#最後" class="headerlink" title="最後"></a>最後</h1><p>如果在<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ cd code</div><div class="line">$ make</div></pre></td></tr></table></figure></p>
<p>編譯時發生錯誤，想必是兩個地方的 <code>Initialize()</code> 發生錯誤，所以請參照以下代碼進行修改。這問題是發生於我們在 <code>/threads</code> 下修改 main.cc 的關係，所以必須在每一個 kernel 宣告地方都給一個決定 scheduler 類型的參數。</p>
<p>其一,<br><figure class="highlight cpp"><figcaption><span>userprog/userkernel.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../threads/scheduler.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SynchDisk</span>;</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProgKernel</span> :</span> <span class="keyword">public</span> ThreadedKernel &#123;</div><div class="line">  <span class="keyword">public</span>:</div><div class="line">  	...</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Initialize</span><span class="params">()</span></span>;		<span class="comment">// initialize the kernel </span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Initialize</span><span class="params">(SchedulerType type)</span></span>;</div><div class="line">    ...</div></pre></td></tr></table></figure><br>其二,<br><figure class="highlight cpp"><figcaption><span>userprog/userkernel.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span></div><div class="line">UserProgKernel::Initialize()</div><div class="line">&#123;</div><div class="line">    Initialize(RR);</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span></div><div class="line">UserProgKernel::Initialize(SchedulerType type)</div><div class="line">&#123;</div><div class="line">    ThreadedKernel::Initialize(type);	<span class="comment">// init multithreading</span></div><div class="line"></div><div class="line">    machine = <span class="keyword">new</span> Machine(debugUserProg);</div><div class="line">    fileSystem = <span class="keyword">new</span> FileSystem();</div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> FILESYS</span></div><div class="line">    synchDisk = <span class="keyword">new</span> SynchDisk(<span class="string">"New SynchDisk"</span>);</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// FILESYS</span></span></div><div class="line">&#125;</div></pre></td></tr></table></figure><br>其三,<br><figure class="highlight cpp"><figcaption><span>network/netkernel.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../threads/scheduler.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostOfficeInput</span>;</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostOfficeOutput</span>;</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetKernel</span> :</span> <span class="keyword">public</span> UserProgKernel &#123;</div><div class="line">  <span class="keyword">public</span>:</div><div class="line">    ...</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Initialize</span><span class="params">()</span></span>;		<span class="comment">// initialize the kernel </span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Initialize</span><span class="params">(SchedulerType)</span></span>;</div><div class="line">    ...</div></pre></td></tr></table></figure><br>其四,<br><figure class="highlight cpp"><figcaption><span>network/netkernel.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> </div><div class="line">NetKernel::Initialize() &#123;</div><div class="line">    Initialize(RR);</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span></div><div class="line">NetKernel::Initialize(SchedulerType type)</div><div class="line">&#123;</div><div class="line">    UserProgKernel::Initialize(type);	<span class="comment">// init other kernel data structs</span></div><div class="line"></div><div class="line">    postOfficeIn = <span class="keyword">new</span> PostOfficeInput(<span class="number">10</span>);</div><div class="line">    postOfficeOut = <span class="keyword">new</span> PostOfficeOutput(reliability, <span class="number">10</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="致網路資源"><a href="#致網路資源" class="headerlink" title="致網路資源"></a>致網路資源</h1><p>感謝網路上前人們所遺留的遺產。雖然在看不懂的文字中摸索，但仍抓到了一點線索。</p>
<blockquote>
<p>我一無所有，直到見到了你們。</p>
</blockquote>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/hw-multiprocess-and-multithread" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/25/lesson/hw-multiprocess-and-multithread/" class="article-date">
  <time datetime="2014-05-25T12:15:47.000Z" itemprop="datePublished">2014-05-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/作業系統/">作業系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/25/lesson/hw-multiprocess-and-multithread/">作業系統 multiprocess &amp; multithread 作業</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/25/lesson/hw-multiprocess-and-multithread/" data-id="cksb6ga6402fad8vnr07477nq" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/25/lesson/hw-multiprocess-and-multithread/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/multiprocess/">multiprocess</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/multithread/">multithread</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="A-班程式要求"><a href="#A-班程式要求" class="headerlink" title="A 班程式要求"></a>A 班程式要求</h1><p>請使用所熟悉的程式開發環境設計單一行程產生子行程 ( Child Process ) 與 多執行緒 ( Multi-Thread) 的程式，意即完成下列傳統 for loop 之列印工作，將其改寫成多行程與多執行緒，由不同的行程與執行緒列印不同 i 值。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"output i = %d\n"</span>, i);</div></pre></td></tr></table></figure>
<h1 id="注意事項"><a href="#注意事項" class="headerlink" title="注意事項"></a>注意事項</h1><ul>
<li><strong> 嚴禁從網路抄襲作業 </strong>。每份程式作業將被程式比對軟體檢查，一旦發現抄襲，該份作業以零分計，並且這學期作業系統作業成績以零分計。</li>
<li>後略</li>
</ul>
<blockquote>
<p>這種作業不抄來抄去也難。但是作業格式不清楚，所以也有不同理解方式就是了。</p>
</blockquote>
<h1 id="開始動手"><a href="#開始動手" class="headerlink" title="開始動手"></a>開始動手</h1><p>對於將 for 迴圈改寫，我們必須認知到幾項</p>
<ul>
<li>是否要按照順序輸出？</li>
<li>平台 M$, Linux, or Max OS？</li>
</ul>
<blockquote>
<p>此篇假設目標是一模一樣的輸出</p>
</blockquote>
<h2 id="multiprocess"><a href="#multiprocess" class="headerlink" title="multiprocess"></a>multiprocess</h2><p><code>child process</code> 屬於 multiprocess 中的一種方式。為什麼這麼說呢？multiprocess 只是要求一個 CPU 中有多個工作同時在進行，藉由排程器去進行工作分配。</p>
<p>先不管這些，要實作 <code>child process</code> 看起來只有走向 <code>fork()</code> 一途。而之前 inker 大神則是走非 child process 使用類似 <code>./nachos -e ../test/test1 -e ../test/test1</code> 的方式去運行。</p>
<p>為了實作按照順序輸出，我們需要 process 共同擁有的 shared memory，這個 shared memory 將要紀錄原本 for 裡面的 <code>i</code> 值和一個 <code>sem_t</code>，來保證 process 和 process 之間不會同時搶先動作，<code>sem_t</code> 也許是不需要的，這裡留給實驗者去測試。</p>
<p>為了使輸出一致，在 <code>fork()</code> 完之後，使用 <code>wait()</code> 來等待所有子程序結束。這樣會造成當 for loop 需要跑 n 次，就會總共 n 個 process，也就是一整條鏈下去。</p>
<ul>
<li>思考 <code>wait()</code> 和 <code>sem_t</code> 都不是這麼必要？// 這個要看寫法</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;semaphore.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span>  MAP_ANONYMOUS</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span>  MAP_ANON</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAP_ANONYMOUS MAP_ANON</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> *glob_var;</div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> n = <span class="number">32</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    glob_var = (<span class="keyword">int</span> *)mmap(<span class="literal">NULL</span>, <span class="keyword">sizeof</span> *glob_var, PROT_READ | PROT_WRITE,</div><div class="line">                    MAP_SHARED | MAP_ANONYMOUS, <span class="number">-1</span>, <span class="number">0</span>);</div><div class="line">    </div><div class="line">    <span class="keyword">sem_t</span> *sema = (<span class="keyword">sem_t</span> *)mmap(<span class="literal">NULL</span>, <span class="keyword">sizeof</span>(sema),</div><div class="line">                       PROT_READ |PROT_WRITE,MAP_SHARED|MAP_ANONYMOUS,</div><div class="line">                       <span class="number">-1</span>, <span class="number">0</span>);</div><div class="line">    sem_init(sema, <span class="number">1</span>, <span class="number">0</span>);</div><div class="line">    *glob_var = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> (*glob_var &lt; n) &#123;</div><div class="line">        sem_wait(sema);</div><div class="line">        <span class="keyword">int</span> pid = fork();</div><div class="line">        <span class="keyword">int</span> output = (*glob_var)++;</div><div class="line">        <span class="keyword">if</span> (output &lt; n)</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d, pid = %d\n"</span>, output, pid);</div><div class="line">        sem_post(sema);</div><div class="line">        <span class="keyword">int</span> wpid, status = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> ((wpid = wait(&amp;status)) &gt; <span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="comment">//printf("Exit status of %d was %d (%s)\n", (int)wpid, status, (status &gt; 0) ? "accept" : "reject");</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    munmap(glob_var, <span class="keyword">sizeof</span> *glob_var);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="multithread"><a href="#multithread" class="headerlink" title="multithread"></a>multithread</h2><p>Thread 就相當簡單，因為它們是共用同一個記憶體區段，因此沒有 share memory 的問題。<br>雖然使用 <code>sem_wait(&amp;sem)</code> 和 <code>sem_post(&amp;sem)</code> 來保證區域內的代碼不會同時有多個 thread 在運行，但仍遇到 <code>i = 0</code> 同時在多個 Thread 噴出的情況，這一點百思不得其解，為了解決這一切問題，使用課本提到的 <code>Producer–consumer problem</code> 寫法。</p>
<p>希望能從代碼中看懂。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;semaphore.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></div><div class="line"><span class="keyword">int</span> i = <span class="number">0</span>, n = <span class="number">16</span>;</div><div class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line"><span class="keyword">sem_t</span> sem;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_THREAD = <span class="number">4</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> *<span class="title">Producer</span><span class="params">(<span class="keyword">void</span> *arg)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n;) &#123;</div><div class="line">        sem_wait(&amp;sem);</div><div class="line">        <span class="keyword">if</span>(count == <span class="number">1</span>) &#123;</div><div class="line">            sem_post(&amp;sem);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        count++;</div><div class="line">        <span class="comment">// printf("\nProducer is :%d\n", count);</span></div><div class="line">        sem_post(&amp;sem);</div><div class="line">        i++;</div><div class="line">    &#125;</div><div class="line">    pthread_exit(<span class="literal">NULL</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> *<span class="title">runPrint</span><span class="params">(<span class="keyword">void</span> *arg)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> id = *((<span class="keyword">int</span> *) arg);</div><div class="line">    <span class="keyword">for</span> (; i &lt; n ;) &#123;</div><div class="line">        sem_wait(&amp;sem);</div><div class="line">        <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</div><div class="line">            sem_post(&amp;sem);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        count--;</div><div class="line">        i++;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"loop i = %d, thread id %d\n"</span>, i, id);</div><div class="line">        sem_post(&amp;sem);</div><div class="line">    &#125;</div><div class="line">    pthread_exit(<span class="literal">NULL</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">pthread_t</span> *threads;</div><div class="line">    sem_init(&amp;sem, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    threads = (<span class="keyword">pthread_t</span> *) <span class="built_in">malloc</span>(MAX_THREAD * <span class="keyword">sizeof</span>(<span class="keyword">pthread_t</span>));</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_THREAD; i++) &#123;</div><div class="line">        <span class="keyword">int</span> *p = (<span class="keyword">int</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</div><div class="line">        *p = i;</div><div class="line">        pthread_create(&amp;threads[i], <span class="literal">NULL</span>, runPrint, (<span class="keyword">void</span> *)(p));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">pthread_t</span> producer;</div><div class="line">    <span class="keyword">int</span> *p = (<span class="keyword">int</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</div><div class="line">    *p = <span class="number">-1</span>;</div><div class="line">    pthread_create(&amp;producer, <span class="literal">NULL</span>, Producer, (<span class="keyword">void</span> *)(p));</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; MAX_THREAD; i++) &#123;</div><div class="line">        pthread_join(threads[i], <span class="literal">NULL</span>);</div><div class="line">    &#125;</div><div class="line">    sem_destroy(&amp;sem);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="後記"><a href="#後記" class="headerlink" title="後記"></a>後記</h2><p>代碼沒有寫得很完整，也就是能達到輸出相同且用符合需求，這一點是有很多漏洞的，前人也是鑽漏洞交作業的。相較之下，我們 B 班的作業略顯兇殘，但是網路上資料還真是少呢，雖然還是找地方抄和理解。</p>
<p>測試的時候，為了保證輸出是穩定的，記得得多測試幾次，並且把數字範圍作變調，當然能不能讓一個 create thread 跑完整個迴圈呢？畢竟加上 main thread 就算是 multithread？haha</p>
<h1 id="執行"><a href="#執行" class="headerlink" title="執行"></a>執行</h1><h2 id="編譯"><a href="#編譯" class="headerlink" title="編譯"></a>編譯</h2><ul>
<li><p>Mac OSX</p>
<pre><code>$ clang -pthread x.cpp -o x
</code></pre></li>
<li><p>Linux</p>
<pre><code>$ gcc -lpthread x.cpp -o x
</code></pre><h2 id="運行"><a href="#運行" class="headerlink" title="運行"></a>運行</h2></li>
<li><p>Linux &amp; Max OSX</p>
<pre><code>$ ./x
</code></pre></li>
</ul>
<h1 id="Mac-運行問題"><a href="#Mac-運行問題" class="headerlink" title="Mac 運行問題"></a>Mac 運行問題</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#ifndef  MAP_ANONYMOUS</div><div class="line">#ifdef  MAP_ANON</div><div class="line">#define MAP_ANONYMOUS MAP_ANON</div><div class="line">#endif</div><div class="line">#endif</div></pre></td></tr></table></figure>
<p>不知道為什麼 clang 中沒有定義 <code>MAP_ANONYMOUS</code>，增加上述代碼後正確運行。</p>
<h1 id="其他作業"><a href="#其他作業" class="headerlink" title="其他作業"></a>其他作業</h1><p><a href="http://morris821028.github.io/2014/05/18/operating-system-hw-thread/">B 班程式作業 1</a><br><a href="http://morris821028.github.io/2014/05/24/hw-nachos4/">B 班程式作業 2</a></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/consumption-item-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/25/lesson/consumption-item-1/" class="article-date">
  <time datetime="2014-05-25T06:22:22.000Z" itemprop="datePublished">2014-05-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/通識課程/">通識課程</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/img/sungirl3.jpg" rel="gallery_cksb6ga4n02ded8vno82cfhpv">
        <img src="/img/sungirl3.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/25/lesson/consumption-item-1/">當代消費文化與社會 (2)</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/25/lesson/consumption-item-1/" data-id="cksb6ga4n02ded8vno82cfhpv" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/25/lesson/consumption-item-1/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/通識/">通識</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="母親節篇"><a href="#母親節篇" class="headerlink" title="母親節篇"></a>母親節篇</h2><ol>
<li>請簡述母親節與消費文化的關聯性 ?<br>母親節與消費文化原本是扯不上邊的，後來商人們藉由這些推銷的活動，給予不知道母親節要怎麼犒勞養育辛勞的兒女們一項消費選擇，因此提供了相關的優惠活動方便消費者，母親節就逐漸跟情人節送禮一樣的氣氛。</li>
<li>舉例說明母親節有哪些消費現象 ?<br>相關女性用品優惠，對於餐飲業而言就是雙人、多人套餐，而觀光景點就是帶著母親出遊享優惠 … 等等。</li>
<li>您決定購買什麼禮物送媽媽及其理由 ?<br>身為一個程序猿，買禮物卻沒有思路，寫卡片卻沒有語言，在這樣的情況下，按照自己最常做的事情下手設計，但最近還有其他程序要趕，大概是趕不上這個母親節專案了。</li>
</ol>
<h2 id="血色月灣"><a href="#血色月灣" class="headerlink" title="血色月灣"></a>血色月灣</h2><div class="video-container"><iframe src="//www.youtube.com/embed/ypeW6lSeUFc" frameborder="0" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=ypeW6lSeUFc" target="_blank" rel="external">Youtube</a></p>
<p>在這場被隱藏的殺戮中，繼上次壽司造成的魚類問題，沒想到日本又在海洋造成了更大的傷害，不管是不是海豚，也許有人會因為海豚可愛而在這一次的血色海灣而保護它，在我們不喜歡的動物上，說不定也有類似的問題。</p>
<p>最令人訝異的是，即使在國際會議中，也有隱瞞事實的大人物在，果然要執行某些事情，不是會議或者是組織所為，而是來自個人的發起。這句話有額外的啟發，為了背後國民的飯碗或支持，這些代表人物不得不說謊的情境，假使一開始錯了，他們便會一直錯下去，這樣的情況令人相當惋惜。</p>
<p>海豚的確很有靈性，在他們受到如此的遭遇，難免會感受到如新世界中，那些因為外表被看成不同種的情況，而受到摧殘的可能，對於靈性的動物，在受到傷害，我們給予同情，在其他情況下則沒有這麼強烈的反應。</p>
<h2 id="消費型科技商品"><a href="#消費型科技商品" class="headerlink" title="消費型科技商品"></a>消費型科技商品</h2><p>現在出門一定有 GPS 衛星導航的裝置，才能穿梭於大街小巷，這些裝置給我們相當大的便利，不用攜帶大量的地圖資訊出門，不會迷路、不用煩惱就可以輕鬆出門。</p>
<p>科技所帶來的便利，使得停下來思考的機會少了，也不會看看四周的景色，追求更快速地抵達目的地，目的地以外的機緣就越來越少了。比起問人，問機器更來得有信任感，這也表示著相信別人給的知識也不是那麼重要。根據新聞的研究報導，也許我們正在改變記憶方式，開始不擅長記繁瑣的事物，而開始擅長去哪裡找資料、如何使用資料。</p>
<p>因此，也常發生因衛星導航所造成的交通事故，被引導到錯誤地方或者是進入不合適的地點。這也反應使用者即使發現了不合理之處，最後仍相信訊息給的答案。假使衛星給了錯誤訊息，或者被惡意修改成錯誤訊息，很容易造就嚴重事故，我們已經被訓練得無法自己處理這些資訊。</p>
<p>也許老師會問我「那你認為到底要不要買衛星導航？」這一點還真的是要看需求，身為宅的人們不喜歡出門呢。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/hw-nachos4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/24/lesson/hw-nachos4/" class="article-date">
  <time datetime="2014-05-24T00:14:43.000Z" itemprop="datePublished">2014-05-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/作業系統/">作業系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/24/lesson/hw-nachos4/">向 NachOS 4.0 作業進發 (1)</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/24/lesson/hw-nachos4/" data-id="cksb6ga6n02fwd8vndoecg3gm" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/24/lesson/hw-nachos4/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NachOS/">NachOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/作業系統/">作業系統</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="關於-NachOS-4-0"><a href="#關於-NachOS-4-0" class="headerlink" title="關於 NachOS 4.0"></a>關於 NachOS 4.0</h1><p>作為教學用作業系統，需要實現簡單並且儘量縮小與實際作業系統之間的差距，所以我們採用 Nachos 作為作業系統課程的教學實踐平臺。Nachos 是美國加州大學伯克萊分校在作業系統課程中已多次使用的作業系統課程設計平臺，在美國很多大學中得到了應用，它在作業系統教學方面具有一下幾個突出的優點：</p>
<ul>
<li>採用通用虛擬機器</li>
<li>簡單而易於擴展    </li>
<li>物件導向性</li>
<li>… 略</li>
</ul>
<blockquote>
<p>簡單地來說，就是一個模擬作業系統的軟體</p>
</blockquote>
<h1 id="安裝"><a href="#安裝" class="headerlink" title="安裝"></a>安裝</h1><p>課程頁面：<a href="http://networklab.csie.ncu.edu.tw/2014_os/osweb.html#download" target="_blank" rel="external">http://networklab.csie.ncu.edu.tw/2014_os/osweb.html#download</a></p>
<ul>
<li>Platform: Linux or Linux over VMware <pre><code>RedHat Linux 9.0 
</code></pre>  在 Ubuntu 上面運行無法</li>
<li>Install steps<ul>
<li>Get NachOS-4.0<pre><code>wget ../nachos-4.0.tar.gz
</code></pre></li>
<li>Get Cross Compiler<pre><code>wget ../mips-decstation.linux-xgcc.tgz
</code></pre></li>
<li>Move Cross Compiler to /<pre><code>mv ./mips-decstation.linux-xgcc.tgz /
</code></pre></li>
<li>Untar Cross Compiler<pre><code>tar zxvf ./mips-decstation.linux-xgcc.tgz
</code></pre></li>
<li>Untar NachOS-4.0<pre><code>tar zxvf ./nachos-4.0.tar.gz
</code></pre></li>
<li>Make NachOS-4.0<pre><code>cd ./nachos-4.0/code
make
</code></pre></li>
<li>Test if installation is succeeded<pre><code>cd ./userprog
./nachos -e ../test/test1
./nachos -e ../test/test2
</code></pre></li>
</ul>
</li>
</ul>
<p>預期運行結果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">Total threads number is 1</div><div class="line">Thread ../test/test1 is executing.</div><div class="line">Print integer:9</div><div class="line">Print integer:8</div><div class="line">Print integer:7</div><div class="line">Print integer:6</div><div class="line">return value:0</div><div class="line">No threads ready or runnable, and no pending interrupts.</div><div class="line">Assuming the program completed.</div><div class="line">Machine halting!</div><div class="line">                                                                                </div><div class="line">Ticks: total 200, idle 66, system 40, user 94</div><div class="line">Disk I/O: reads 0, writes 0</div><div class="line">Console I/O: reads 0, writes 0</div><div class="line">Paging: faults 0</div><div class="line">Network I/O: packets received 0, sent 0</div><div class="line"></div><div class="line">Total threads number is 1</div><div class="line">Thread ../test/test2 is executing.</div><div class="line">Print integer:20</div><div class="line">Print integer:21</div><div class="line">Print integer:22</div><div class="line">Print integer:23</div><div class="line">Print integer:24</div><div class="line">Print integer:25</div><div class="line">return value:0</div><div class="line">No threads ready or runnable, and no pending interrupts.</div><div class="line">Assuming the program completed.</div><div class="line">Machine halting!</div><div class="line"></div><div class="line">Ticks: total 200, idle 32, system 40, user 128</div><div class="line">Disk I/O: reads 0, writes 0</div><div class="line">Console I/O: reads 0, writes 0</div><div class="line">Paging: faults 0</div><div class="line">Network I/O: packets received 0, sent 0</div></pre></td></tr></table></figure></p>
<h1 id="作業階段"><a href="#作業階段" class="headerlink" title="作業階段"></a>作業階段</h1><h2 id="Multiprogramming"><a href="#Multiprogramming" class="headerlink" title="Multiprogramming"></a>Multiprogramming</h2><p>執行下述指令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./nachos –e ../test/test1 –e ../test/test2</div></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><figcaption><span>test1.c</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"syscall.h"</span></span></div><div class="line">main() &#123;</div><div class="line">    <span class="keyword">int</span> n;</div><div class="line">    <span class="keyword">for</span> (n=<span class="number">9</span>;n&gt;<span class="number">5</span>;n--)</div><div class="line">        PrintInt(n);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>test2.c</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"syscall.h"</span></span></div><div class="line"></div><div class="line">main() &#123;</div><div class="line">    <span class="keyword">int</span> n;</div><div class="line">    <span class="keyword">for</span> (n=<span class="number">20</span>;n&lt;=<span class="number">25</span>;n++)</div><div class="line">        PrintInt(n);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在開始動工前，發現在 Multithread 操作會有錯誤，test1 程序會遞減輸出，而 test2 程序會遞增輸出，但是根據運行結果，兩個程式都會遞增輸出。</p>
<p>目標運行結果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">Total threads number is 2</div><div class="line">Thread ../test/test1 is executing.</div><div class="line">Thread ../test/test2 is executing.</div><div class="line">Print integer:9</div><div class="line">Print integer:8</div><div class="line">Print integer:7</div><div class="line">Print integer:20</div><div class="line">Print integer:21</div><div class="line">Print integer:22</div><div class="line">Print integer:23</div><div class="line">Print integer:24</div><div class="line">Print integer:6</div><div class="line">return value:0</div><div class="line">Print integer:25</div><div class="line">return value:0</div><div class="line">No threads ready or runnable, and no pending interrupts.</div><div class="line">Assuming the program completed.</div><div class="line">Machine halting!</div><div class="line"> </div><div class="line">Ticks: total 300, idle 8, system 70, user 222</div><div class="line">Disk I/O: reads 0, writes 0</div><div class="line">Console I/O: reads 0, writes 0</div><div class="line">Paging: faults 0</div><div class="line">Network I/O: packets received 0, sent 0</div></pre></td></tr></table></figure></p>
<ul>
<li>為什麼兩個程式都會遞增輸出？<br>明顯地是兩個程式匯入時，操作到相同區域的 code segment。如果發現各別遞增和遞減，但是輸出 <code>n</code> 的結果錯誤，則可以想到是 <code>context-switch</code> 上發生問題。</li>
</ul>
<h3 id="解決"><a href="#解決" class="headerlink" title="解決"></a>解決</h3><p>需要為 physical address 做標記，這個 physical address 就是在 main memory 裡面的位置。而每一個 process 都會有一個 AddrSpace，然後紀錄 logical address 所對應在 physical address，也就是 <code>pageTable</code> 對應到 <code>pageTable[i].physicalPage</code>。</p>
<p>也就是說，當要執行 process 某一頁的程序，則將會去找 pageTable 所對應的 physicalPage，然後去運行。在作業一開始給的代碼中，會發現所有程序的 physicalPage 都共用，如此一來當然會執行到同一份 code。</p>
<p>首先，我們需要一個全局的標記，來記錄 main memory page 的情況。<br><figure class="highlight cpp"><figcaption><span>usrprog/addrspace.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddrSpace</span> &#123;</span></div><div class="line">  <span class="keyword">public</span>:</div><div class="line">    ...</div><div class="line">    <span class="keyword">static</span> <span class="keyword">bool</span> usedPhyPage[NumPhysPages];</div><div class="line">  <span class="keyword">private</span>:</div><div class="line">    ...</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>接著，在 addrspace.cc 宣告實體，並且初始化是 <code>0</code>，表示全部都還沒有用過。</p>
<figure class="highlight cpp"><figcaption><span>usrprog/addrspace.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"copyright.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"main.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"addrspace.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"machine.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"noff.h"</span></span></div><div class="line">    ...</div><div class="line"><span class="keyword">bool</span> AddrSpace::usedPhyPage[NumPhysPages] = &#123;<span class="number">0</span>&#125;;</div><div class="line">    ...</div></pre></td></tr></table></figure>
<p>當 process 執行成功後，將會釋放資源。此時將要把標記使用的 page 設回未使用。<br><figure class="highlight cpp"><figcaption><span>usrprog/addrspace.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">AddrSpace::~AddrSpace()</div><div class="line">&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numPages; i++)</div><div class="line">        AddrSpace::usedPhyPage[pageTable[i].physicalPage] = <span class="literal">false</span>;</div><div class="line">   <span class="keyword">delete</span> pageTable;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最後，就是稍微麻煩的地方，當將程序載入記憶體時，要去填入 <code>pageTable[]</code> 對應的 <code>physicalPage</code>，這裡使用線性時間去搜索第一個未使用的 page 進行填入。</p>
<p>載入確定後，便要開始執行，執行的時候要去算程序進入點，進入點的位置即是 main memory address。</p>
<p><code>mainMemory[pageTable[noffH.code.virtualAddr/PageSize].physicalPage * PageSize + (noffH.code.virtualAddr%PageSize)]</code></p>
<p>首先算出第幾頁，然後乘上 <code>PageSize</code> 就是 page base，而 page offset 則是 <code>code.address mod PageSize</code>。</p>
<p>最後，<code>page base + page offset</code> 就是我們所需要的程序進入點。</p>
<figure class="highlight cpp"><figcaption><span>usrprog/addrspace.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">bool</span> AddrSpace::Load(<span class="keyword">char</span> *fileName) &#123;</div><div class="line">    OpenFile *executable = kernel-&gt;fileSystem-&gt;Open(fileName);</div><div class="line">    NoffHeader noffH;</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> size;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (executable == <span class="literal">NULL</span>) &#123;</div><div class="line">    <span class="built_in">cerr</span> &lt;&lt; <span class="string">"Unable to open file "</span> &lt;&lt; fileName &lt;&lt; <span class="string">"\n"</span>;</div><div class="line">    <span class="keyword">return</span> FALSE;</div><div class="line">    &#125;</div><div class="line">    executable-&gt;ReadAt((<span class="keyword">char</span> *)&amp;noffH, <span class="keyword">sizeof</span>(noffH), <span class="number">0</span>);</div><div class="line">    <span class="keyword">if</span> ((noffH.noffMagic != NOFFMAGIC) &amp;&amp; </div><div class="line">        (WordToHost(noffH.noffMagic) == NOFFMAGIC))</div><div class="line">    	SwapHeader(&amp;noffH);</div><div class="line">    ASSERT(noffH.noffMagic == NOFFMAGIC);</div><div class="line"></div><div class="line"><span class="comment">// how big is address space?</span></div><div class="line">    size = noffH.code.size + noffH.initData.size + noffH.uninitData.size </div><div class="line">            + UserStackSize;	<span class="comment">// we need to increase the size</span></div><div class="line">                        <span class="comment">// to leave room for the stack</span></div><div class="line">    numPages = divRoundUp(size, PageSize);</div><div class="line"><span class="comment">//	cout &lt;&lt; "number of pages of " &lt;&lt; fileName&lt;&lt; " is "&lt;&lt; numPages &lt;&lt; endl;</span></div><div class="line"><span class="comment">// morris add</span></div><div class="line">    pageTable = <span class="keyword">new</span> TranslationEntry[numPages];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; numPages; i++) &#123;</div><div class="line">        pageTable[i].virtualPage = i;</div><div class="line">        <span class="keyword">while</span>(j &lt; NumPhysPages &amp;&amp; AddrSpace::usedPhyPage[j] == <span class="literal">true</span>)</div><div class="line">            j++;</div><div class="line">        AddrSpace::usedPhyPage[j] = <span class="literal">true</span>;</div><div class="line">        pageTable[i].physicalPage = j;</div><div class="line">        pageTable[i].valid = <span class="literal">true</span>;</div><div class="line">        pageTable[i].use = <span class="literal">false</span>;</div><div class="line">        pageTable[i].dirty = <span class="literal">false</span>;</div><div class="line">        pageTable[i].readOnly = <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line"><span class="comment">// end morris add</span></div><div class="line">    size = numPages * PageSize;</div><div class="line"></div><div class="line">    ASSERT(numPages &lt;= NumPhysPages);		<span class="comment">// check we're not trying</span></div><div class="line">                        <span class="comment">// to run anything too big --</span></div><div class="line">                        <span class="comment">// at least until we have</span></div><div class="line">                        <span class="comment">// virtual memory</span></div><div class="line"></div><div class="line">    DEBUG(dbgAddr, <span class="string">"Initializing address space: "</span> &lt;&lt; numPages &lt;&lt; <span class="string">", "</span> &lt;&lt; size);</div><div class="line"></div><div class="line"><span class="comment">// then, copy in the code and data segments into memory</span></div><div class="line">    <span class="keyword">if</span> (noffH.code.size &gt; <span class="number">0</span>) &#123;</div><div class="line">        DEBUG(dbgAddr, <span class="string">"Initializing code segment."</span>);</div><div class="line">    DEBUG(dbgAddr, noffH.code.virtualAddr &lt;&lt; <span class="string">", "</span> &lt;&lt; noffH.code.size);</div><div class="line"><span class="comment">// morris add</span></div><div class="line">        	executable-&gt;ReadAt(</div><div class="line">        &amp;(kernel-&gt;machine-&gt;mainMemory[pageTable[noffH.code.virtualAddr/PageSize].physicalPage * PageSize + (noffH.code.virtualAddr%PageSize)]), </div><div class="line">            noffH.code.size, noffH.code.inFileAddr);</div><div class="line"><span class="comment">// end morris add</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (noffH.initData.size &gt; <span class="number">0</span>) &#123;</div><div class="line">        DEBUG(dbgAddr, <span class="string">"Initializing data segment."</span>);</div><div class="line">    DEBUG(dbgAddr, noffH.initData.virtualAddr &lt;&lt; <span class="string">", "</span> &lt;&lt; noffH.initData.size);</div><div class="line"><span class="comment">// morris add</span></div><div class="line">        executable-&gt;ReadAt(</div><div class="line">        &amp;(kernel-&gt;machine-&gt;mainMemory[pageTable[noffH.initData.virtualAddr/PageSize].physicalPage * PageSize + (noffH.code.virtualAddr%PageSize)]),</div><div class="line">            noffH.initData.size, noffH.initData.inFileAddr);</div><div class="line"><span class="comment">// end morris add</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">delete</span> executable;			<span class="comment">// close file</span></div><div class="line">    <span class="keyword">return</span> TRUE;			<span class="comment">// success</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h2 id="Sleep-System-call"><a href="#Sleep-System-call" class="headerlink" title="Sleep() System call"></a>Sleep() System call</h2><p>撰寫自己的 Sleep function，將該 Thread 進入休眠。</p>
<h3 id="測試檔案"><a href="#測試檔案" class="headerlink" title="測試檔案"></a>測試檔案</h3><p>與一開始的 <code>test1.c</code> 很像，這裡先做個簡單測試。<br><figure class="highlight cpp"><figcaption><span>/code/test/sleep.c</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"syscall.h"</span></span></div><div class="line">main() &#123;</div><div class="line">    <span class="keyword">int</span> i;</div><div class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</div><div class="line">        Sleep(<span class="number">10000000</span>);</div><div class="line">        PrintInt(<span class="number">50</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>因為整個測試檔案是要能在 nachOS 上面跑，所以不能使用一般的編譯方式？所以把這些訊息寫入 <code>Makefile</code> 中，之後下 <code>$ make</code> 產出 <code>sleep</code> 即可。<br><figure class="highlight cpp"><figcaption><span>/code/test/Makefile</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">all: halt shell matmult sort test1 test2 sleep</div><div class="line">...</div><div class="line">sleep: sleep.o start.o</div><div class="line">    &lt;span&gt;$(LD)$&lt;/span&gt;&lt;!-- Has MathJax --&gt;(LDFLAGS) start.o sleep.o -o sleep.coff</div><div class="line">    ../bin/coff2noff sleep.coff sleep</div><div class="line">...</div></pre></td></tr></table></figure></p>
<blockquote>
<p>如果無法在 <code>/code/test</code> 下 <code>$ make</code> 順利產出，則請參照 <strong> 其他指令 </strong>，將原本下載的 <code>mips-decstation.linux-xgcc.gz</code> 解壓縮產生的 <code>/usr</code> 移動到正確位置。</p>
</blockquote>
<h3 id="解決-1"><a href="#解決-1" class="headerlink" title="解決"></a>解決</h3><p>首先，要模仿 <code>PrintInt()</code>，找到切入的宣告位置。努力地尾隨前人。</p>
<figure class="highlight cpp"><figcaption><span>/code/userprog/syscall.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SC_PrintInt	11</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SC_Sleep	12</span></div><div class="line">...</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">PrintInt</span><span class="params">(<span class="keyword">int</span> number)</span></span>;	<span class="comment">//my System Call</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Sleep</span><span class="params">(<span class="keyword">int</span> number)</span></span>;         <span class="comment">// morris add</span></div><div class="line">...</div></pre></td></tr></table></figure>
<p>接著，找一下 ASM。<br>以下部分就不得而知了，為什麼會出現在 <code>/code/test</code> 目錄下。<br><figure class="highlight cpp"><figcaption><span>/code/test/start.s</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">    ...</div><div class="line">PrintInt:</div><div class="line">    addiu   &lt;span&gt;$2,$&lt;/span&gt;&lt;!-- Has MathJax --&gt;0,SC_PrintInt</div><div class="line">    syscall</div><div class="line">    j       $<span class="number">31</span></div><div class="line">    .end    PrintInt</div><div class="line"></div><div class="line">    .globl  Sleep</div><div class="line">    .ent	Sleep</div><div class="line">Sleep:</div><div class="line">    addiu   &lt;span&gt;$2,$&lt;/span&gt;&lt;!-- Has MathJax --&gt;0,SC_Sleep</div><div class="line">    syscall</div><div class="line">    j	$<span class="number">31</span></div><div class="line">    .end	Sleep</div><div class="line">    ...</div></pre></td></tr></table></figure></p>
<p>最後，確定 nachOS 會處理我們的例外操作。</p>
<figure class="highlight cpp"><figcaption><span>/code/userprog/exception.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">    ...</div><div class="line"><span class="keyword">case</span> SC_PrintInt:</div><div class="line">    val=kernel-&gt;machine-&gt;ReadRegister(<span class="number">4</span>);</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Print integer:"</span> &lt;&lt; val &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span>;</div><div class="line"><span class="keyword">case</span> SC_Sleep:</div><div class="line">    val=kernel-&gt;machine-&gt;ReadRegister(<span class="number">4</span>);</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Sleep Time "</span> &lt;&lt; val &lt;&lt; <span class="string">"(ms) "</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    kernel-&gt;alarm-&gt;WaitUntil(val);</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">    ...</div></pre></td></tr></table></figure>
<blockquote>
<p>到這裡需要喘口氣，剛找了一陣子的代碼。接著才是重頭戲，因為你看到了 <code>kernel-&gt;alarm-&gt;WaitUntil(val);</code> 出現了。沒錯！我們需要撰寫那邊的代碼。</p>
</blockquote>
<p>既然 kernel 存有 <code>alarm</code>，也就是說每隔固定一段間，就會呼叫 <code>Alarm::CallBack()</code>，因此，對於這個鬧鐘來個累加器 <code>Bedroom::_current_interrupt</code>，全局去記數，當作毫秒 (ms) 看待就可以，每加一次就相當於過了 1 毫秒 (ms)。</p>
<p>假設現在某一個 <code>time = _current_interrupt</code> 呼叫 <code>Sleep(x)</code> 後，將 <code>(Thread address, _current_interrupt + x)</code> 丟入 List，則期望在 <code>_current_interrupt + x</code> 的時候甦醒。因此，每當 _current_interrupt++ 就去檢查 List 中，誰的預期時間小於 _current_interrupt，就將其從 List 中清除。</p>
<blockquote>
<p>這裡先不考慮 _current_interrupt Overflow 的問題，根據電腦效率，可能在 5 ~ 10 秒內就發生一次，此時會造成所有 Thread 沉眠很久。若察覺 Sleep 太久，則是發生 Overflow。</p>
</blockquote>
<ul>
<li>當有程序呼叫 <code>Sleep()</code> 時，會呼叫 <code>WaitUntil()</code>，然後將其丟入 <code>Bedroom</code> 安眠。</li>
<li>然後在 <code>CallBlack()</code> 被呼叫時，來去 <code>Bedroom</code> 檢查誰該醒來了。</li>
</ul>
<figure class="highlight cpp"><figcaption><span>/code/threads/alarm.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"copyright.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"utility.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"callback.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"timer.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"thread.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bedroom</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        Bedroom():_current_interrupt(<span class="number">0</span>) &#123;&#125;;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">PutToBed</span><span class="params">(Thread *t, <span class="keyword">int</span> x)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">MorningCall</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">IsEmpty</span><span class="params">()</span></span>;</div><div class="line">    <span class="keyword">private</span>:</div><div class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Bed</span> &#123;</span></div><div class="line">            <span class="keyword">public</span>:</div><div class="line">                Bed(Thread* t, <span class="keyword">int</span> x):</div><div class="line">                    sleeper(t), when(x) &#123;&#125;;</div><div class="line">                Thread* sleeper;</div><div class="line">                <span class="keyword">int</span> when;</div><div class="line">        &#125;;</div><div class="line">    </div><div class="line">    <span class="keyword">int</span> _current_interrupt;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">list</span>&lt;Bed&gt; _beds;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// The following class defines a software alarm clock. </span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Alarm</span> :</span> <span class="keyword">public</span> CallBackObj &#123;</div><div class="line">  <span class="keyword">public</span>:</div><div class="line">    Alarm(<span class="keyword">bool</span> doRandomYield);	<span class="comment">// Initialize the timer, and callback </span></div><div class="line">                <span class="comment">// to "toCall" every time slice.</span></div><div class="line">    ~Alarm() &#123; <span class="keyword">delete</span> timer; &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">WaitUntil</span><span class="params">(<span class="keyword">int</span> x)</span></span>;	<span class="comment">// suspend execution until time &gt; now + x</span></div><div class="line"></div><div class="line">  <span class="keyword">private</span>:</div><div class="line">    Timer *timer;		<span class="comment">// the hardware timer device</span></div><div class="line">    Bedroom _bedroom;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CallBack</span><span class="params">()</span></span>;		<span class="comment">// called when the hardware</span></div><div class="line">                <span class="comment">// timer generates an interrupt</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>確定有哪些 method 就可以開始實作了。</p>
<figure class="highlight cpp"><figcaption><span>/code/threads/alarm.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> Alarm::CallBack() &#123;</div><div class="line">    Interrupt *interrupt = kernel-&gt;interrupt;</div><div class="line">    MachineStatus status = interrupt-&gt;getStatus();</div><div class="line">    <span class="keyword">bool</span> woken = _bedroom.MorningCall();</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (status == IdleMode &amp;&amp; !woken &amp;&amp; _bedroom.IsEmpty()) &#123;<span class="comment">// is it time to quit?</span></div><div class="line">        <span class="keyword">if</span> (!interrupt-&gt;AnyFutureInterrupts()) &#123;</div><div class="line">        timer-&gt;Disable();	<span class="comment">// turn off the timer</span></div><div class="line">    &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;			<span class="comment">// there's someone to preempt</span></div><div class="line">    interrupt-&gt;YieldOnReturn();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Alarm::WaitUntil(<span class="keyword">int</span> x) &#123;</div><div class="line">    IntStatus oldLevel = kernel-&gt;interrupt-&gt;SetLevel(IntOff);</div><div class="line">    Thread* t = kernel-&gt;currentThread;</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Alarm::WaitUntil go sleep"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    _bedroom.PutToBed(t, x);</div><div class="line">    kernel-&gt;interrupt-&gt;SetLevel(oldLevel);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">bool</span> Bedroom::IsEmpty() &#123;</div><div class="line">    <span class="keyword">return</span> _beds.size() == <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Bedroom::PutToBed(Thread*t, <span class="keyword">int</span> x) &#123;</div><div class="line">    ASSERT(kernel-&gt;interrupt-&gt;getLevel() == IntOff);</div><div class="line">    _beds.push_back(Bed(t, _current_interrupt + x));</div><div class="line">    t-&gt;Sleep(<span class="literal">false</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">bool</span> Bedroom::MorningCall() &#123;</div><div class="line">    <span class="keyword">bool</span> woken = <span class="literal">false</span>;</div><div class="line"></div><div class="line">    _current_interrupt ++;</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="built_in">std</span>::<span class="built_in">list</span>&lt;Bed&gt;::iterator it = _beds.begin(); </div><div class="line">        it != _beds.end(); ) &#123;</div><div class="line">        <span class="keyword">if</span>(_current_interrupt &gt;= it-&gt;when) &#123;</div><div class="line">            woken = <span class="literal">true</span>;</div><div class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"Bedroom::MorningCall Thread woken"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">            kernel-&gt;scheduler-&gt;ReadyToRun(it-&gt;sleeper);</div><div class="line">            it = _beds.erase(it);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            it++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> woken;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>到這裡我們就完成 <code>Sleep()</code> 製作。</p>
<p>在下一階段，將要加入排程的製作。</p>
<h2 id="Scheduling"><a href="#Scheduling" class="headerlink" title="Scheduling"></a>Scheduling</h2><p>目標完成 SJF, RR, FIFO。<br>請參閱 “向 NachOS 4.0 作業進發 (2)”</p>
<h1 id="其他指令"><a href="#其他指令" class="headerlink" title="其他指令"></a>其他指令</h1><ul>
<li><p>打包轉移 // 交作業前，將檔案包出傳送，此指令不是壓縮用途</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ tar cvf FileName.tar DirName</div></pre></td></tr></table></figure>
</li>
<li><p>複製資料夾 // 將 nachos gcc library 搬移至 <code>/usr/local/nachos ...</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cp -a DirName TARGET_PATH</div></pre></td></tr></table></figure>
</li>
<li><p>轉移至 root 權限 // 如果指令權限不夠，需要下達此指令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ su</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="備忘"><a href="#備忘" class="headerlink" title="備忘"></a>備忘</h1><ul>
<li>網路上有幾個 Java 版本的 NachOS，架構稍微不同，如果發現文章說明有點怪怪的，請看一下他是用 JAVA 版本還是 C++ 版本。</li>
<li>至於怎麼將檔案從 Red Hat，這有點惱人，可以想辦法安裝其他瀏覽器，然後開 e-mail 送出，或者使用 terminal 上的 wget 安裝 … 一堆辦法。最後我自己用 nodejs 寫一個簡單的 upload server 傳出來。</li>
</ul>
<h1 id="代碼下載"><a href="#代碼下載" class="headerlink" title="代碼下載"></a>代碼下載</h1><p><a href="https://github.com/morris821028/hw-nachos-4.0" target="_blank" rel="external">Github</a></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/hw-computational-intelligence" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/19/lesson/hw-computational-intelligence/" class="article-date">
  <time datetime="2014-05-19T11:47:28.000Z" itemprop="datePublished">2014-05-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/19/lesson/hw-computational-intelligence/">計算型智慧 程式作業</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/19/lesson/hw-computational-intelligence/" data-id="cksb6ga6702fed8vntw59gxqs" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/19/lesson/hw-computational-intelligence/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Fuzzy-System/">Fuzzy System</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GA/">GA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PSO/">PSO</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="Computational-Intelligence-計算型智慧"><a href="#Computational-Intelligence-計算型智慧" class="headerlink" title="Computational Intelligence 計算型智慧"></a>Computational Intelligence 計算型智慧</h1><p>本課程將會有三階段程式，將三個算法依序加入程式中，為了要實作這些算法，必須先作出模擬器。</p>
<h2 id="Lv-0-模擬器"><a href="#Lv-0-模擬器" class="headerlink" title="Lv. 0 模擬器"></a>Lv. 0 模擬器</h2><p>在一個 2D 平面中，以一個圓形當作車子，道路為線段的方式進行描述。為了在隨後的擴充，將地圖內容物分成可行區域多邊形和障礙物多邊形。</p>
<ul>
<li>要支持車子下一秒的擺角，並且按下推動鍵會根據方程式進行移動。</li>
<li>可以將車子兩側的感測器進行角度調整，並且可以根據感測器角度進行距離計算。</li>
<li>並且在呈現 2D 平面時，附加顯示座標軸的比例。</li>
</ul>
<p><img src="/img/hw-ci-0.PNG" alt="完成圖"></p>
<p>由於私心，有一些額外產物。</p>
<ul>
<li>完成可以自動置中的設定</li>
<li>提供地圖縮放和讀取操作</li>
<li>製作地圖產生器 (other project)</li>
<li>模擬器的彈木遊戲番外篇 (other project)</li>
<li>提供運行欄位的縮起</li>
</ul>
<h2 id="Lv-1-模糊系統"><a href="#Lv-1-模糊系統" class="headerlink" title="Lv. 1 模糊系統"></a>Lv. 1 模糊系統</h2><p>車子運行公式</p>
<p><img src="/img/hw-ci-1.PNG" alt="運行公式"></p>
<p>其中 Φ(t) 是模型車與水平軸的角度，b 是模型車的長度，x 與 y 是模型車的座標位置， Θ(t) 是模型車方向盤所打的角度，我們對模擬的輸入輸出變數限制如下：</p>
<p><code>-40 deg &lt;= Θ(t) &lt;= 40 deg</code></p>
<p>寫一個程式使用模糊系統、理論模擬車子行徑，並且想辦法最佳化。</p>
<ul>
<li>考慮擴充性，以後車子的運行公式可能會替換，因此建造一個 <code>Engine class</code>。</li>
<li>模糊系統的幾個特性拆分成數個 method，並且使用不同的數學計算採用繼承關係。</li>
<li>最困難得地方在於計算函數交集，採用離散取點是最後的手段</li>
</ul>
<h3 id="函數實驗"><a href="#函數實驗" class="headerlink" title="函數實驗"></a>函數實驗</h3><ol>
<li>經過實驗，三個感測器分別坐落於前方 (90度)、左右各偏轉 50 度左右的夾角比左右 90 度更好。用以應付多變的轉角彎度，防止模稜兩可的擺動。</li>
<li>不管哪裡種去模糊化系統，由於題目限制擺角於 [-40, 40] 度之間，因此很容易在加權平均、質心、離散化而導致邊界擺角的機率甚低，當越多函數則稀釋程度越高。因此函數定義可以超過限制擺角，只需要在去模糊化時，約束至條件內即可。</li>
<li>設計函數時，要討論向其中一個方向偏轉，也就是不能設計過於對稱的圖形，否則將會在死胡同裡打轉。</li>
</ol>
<h3 id="函數設計"><a href="#函數設計" class="headerlink" title="函數設計"></a>函數設計</h3><p>d1 為前方感測器，d2 為右方感測器，d3 為左方感測器。</p>
<ol>
<li>d1 歸屬函數為<br><img src="/img/hw-ci-2.PNG" alt="d1 歸屬函數"><br>d2, d3 歸屬函數為<br><img src="/img/hw-ci-3.PNG" alt="d2, d3 歸屬函數">    </li>
<li>函數式加權平均<pre><code>If d3 large, θ = 55
If d2 large, θ = -55
If d2 medium, θ = -40
If d3 medium, θ = 40
If d1 large and d2 small, θ = -30
If d1 large and d3 small, θ = 30
If d1 small, θ = -60
</code></pre>規則如上述七條，以最簡單的常數關係。測試結果還算不錯。<br><code>if condition, then statement</code>，statement 中的變數不存在於 condition 去做調整，後來發現由於太複雜去討論而一直失敗。</li>
<li><p>重心法、最大平均法、修正型最大平均法、中心平均法<br>為了方便計算連續函數，採用離散取點，間隔 0.1 抓取 [-60, 60] 之間的點座標。對於以下四種方法討論於簡單彎道的過程記錄：<br><code>If d3 large</code><br><img src="/img/hw-ci-4.png" alt="If d3 large"><br>If d2 large<br><img src="/img/hw-ci-5.png" alt="If d2 large"><br>If d2 medium<br><img src="/img/hw-ci-6.png" alt="If d2 medium"><br>If d3 medium<br><img src="/img/hw-ci-7.png" alt="If d3 medium"><br>If d1 large and d2 small<br><img src="/img/hw-ci-8.png" alt="If d1 large and d2 small"><br>If d1 large and d3 small<br><img src="/img/hw-ci-9.png" alt="If d1 large and d3 small"><br>If d1 small, θ = -60<br><img src="/img/hw-ci-10.png" alt="If d1 small"></p>
<ul>
<li>重心法<br>當中表現最為穩健，而且路徑平滑。</li>
<li>最大平均法<br>由於定義的函數較為簡單，而且大多都是以梯形的方式存在，雖然能在機率高的情況下走完全程，路徑中會呈現左右擺盪情況。並且大多都已極值的方式出現。</li>
<li>修正型最大平均法<br>情況會稍微好一些，但是對於並沒有向重心法一樣的圓滑曲線，仍是因為原先的函數設計所惹的問題。</li>
</ul>
<p>對於某一種方法而去定義相關的函數進行測較好，而在最大平均法的部分，必須使用較具有變化性的曲線，否則很容易在極值狀況下擺動。</p>
</li>
</ol>
<hr>
<h2 id="Lv-2-GA"><a href="#Lv-2-GA" class="headerlink" title="Lv 2. GA"></a>Lv 2. GA</h2><p><img src="/img/hw-ci-RBF.PNG" alt="RBF"></p>
<p>「放射狀基底函數網路 RBF」，基本上，其網路架構如圖1所示，為兩層的網路；假設輸入維度是p ，以及隱藏層類神經元的數目是J ，那麼網路的輸入可以表示成：<br><img src="/img/hw-ci-RBF-f1.PNG" alt=""><br>其中選用高斯型基底函數：<br><img src="/img/hw-ci-RBF-f2.PNG" alt=""><br>其中 x = (x1,x2,…,xp) 、mj = (mj1,mj2,…,mjp) 、||  || 代表向量絕對值<br>適應函數為：<br><img src="/img/hw-ci-RBF-f3.PNG" alt=""></p>
<p>請用實數型基因演算法，找出wj , mj , σj，在不同的數字J下，最好的基因向量 (例如J為9、輸入x為3維向量，則表示基因向量是1+9+3x9+9=46維度的向量，請注意這裡不是指族群數；又例如J為7、輸入x為3維向量，則表示基因向量是1+7+3x7+7=36維度的向量)下，評估函數E(式1)為越小越好。其中基因向量維度公式為 1+J + p<em>J+J = (p+2)</em>J+1維向量( ,w1 , w2 ,.., wJ , m11, m12,.., m1p, m21, m22,.., m2p,.., mJ1, mJ2,…, mJp, σ1, σ2, …, σJ)。</p>
<p>參數說明 : </p>
<ul>
<li>N 作業1產生的N筆成功到達目的訓練資料(換不同起始點)</li>
<li>y<sub>n</sub> 表示訓練資料的方向盤期望輸出值 P.s.如果配合wj值的範圍為0~1之間，在此則必須把yn由-40~+40度正規化到 0~1之間；如果不想正規化  就必須把 wj的值範圍調整到 -40~40之間 範圍為0~1之間</li>
<li>W<sub>j</sub> 範圍為 0~1 (或是-40~40)之間 P.s.此需配合訓練集的yn跟F(n)值範圍，所以皆需正規化到0~1之間；若不正規化，wj的值範圍為 -40~40之間</li>
<li>m<sub>j</sub> 範圍跟X範圍一樣，如以提供的範例檔則為 0~30</li>
<li>σ<sub>j</sub> 範圍為0~10之間；也可以設定更大的範圍做探討。</li>
</ul>
<blockquote>
<p><strong> 實作概要 </strong>：<br>把參數編碼成 DNA，使用 GA 算法改變 DNA，然後用之前的模糊系統的結果，讓 RBF 接近之前定義的模糊系統。需要拿模糊系統的一些測資當作訓練資料，收集之後餵給 GA 做訓練。</p>
</blockquote>
<h3 id="實驗方法"><a href="#實驗方法" class="headerlink" title="實驗方法"></a>實驗方法</h3><ol>
<li>核心代碼，對於每次迭代，著手適應、選擇、交配、突變。</li>
<li>細部 “交配” 代碼，採用實數型的分離和聚集兩種情況。</li>
<li>細部 “突變” 代碼，採用微量雜訊，唯一不同的地方在於，這個微量雜訊會根據當前數值的比例有關，為了避免大數字對於微量雜訊的干擾不夠強烈。</li>
</ol>
<h3 id="實驗結果"><a href="#實驗結果" class="headerlink" title="實驗結果"></a>實驗結果</h3><ol>
<li>運行結果 J = 3, p = 3<br>( ,w1 , w2 ,.., wJ , m11, m12,.., m1p, m21, m22,.., m2p,.., mJ1, mJ2,…, mJp, σ1, σ2, …, σJ) = (0.163568 0.851471 1.594151 1.379580 13.092824 0.000505 12.611789 30.000000 0.000368 18.715240 0.000850 2.708967 30.000000 6.307677 7.584529 10.000000)</li>
<li>訓練數據為 “map2” 走一圈的訓練資訊，約為 500 筆。因為 “map0” (即本次作業給的地圖) 的複雜度不夠以至於無法充分表達原本設計的模糊系統。也就是根據當初模糊系統設計，收集的數據的多樣性和連續性不足。</li>
</ol>
<h3 id="實驗分析"><a href="#實驗分析" class="headerlink" title="實驗分析"></a>實驗分析</h3><p>根據 RBF 的神經元，這裡可以越少越好，在程式中，神經元個數(J) 設置 3 個。運行時採用輪盤式選擇，讓適應能力好的，具有較高的機會繁殖，採用一個隨機變數去挑選。而在基因方面使用實數型基因的形式。</p>
<ol>
<li>運行時，突變機率和突變比例相當重要，由於相同適應能力好的物種量很多，只保留其中一部分即可，因此可以將突變機率0.5 左右，太低則會造成進化速度太慢，太高則容易失去原本適應好的物種，導致整體適應度的震盪。</li>
<li>另外設置突變的比例，也就是該段實數值上下調整的比例。<br><code>g.getDNA()[i] = g.getDNA()[i] + ratio * Math.random() * g.getDNA()[i];</code><br>藉由上述的式子，將 ratio 設置成一個調變比例，來製造爆炸效應的規模。而在運行時，突變效果還能接受。</li>
<li>原本運行時，只將 DNA 片段的值任意放置，並且約束在不會超出函數的定義域，在收斂速度上有明顯加速。但為了符合作業需求，將每個參數約束在指定範圍內，在收斂速度慢了一截，在預期結果並沒有很好。</li>
<li>在不同地圖收集的預期資訊，會針對不同車子感測器的角度有所差異，因此不能拿不同型的感測數據，訓練出來的 RBF 不能給另外一台車子來使用，除非使用的感測器角度相當接近。</li>
<li>對於死路的轉彎，在神經元個數(J) 等於 2 的時候，運行結果較為不佳，但是在本次作業中，並不會有這種數據的出現，也不用考慮這種情況。但是當神經元個數少時，GA 算法的運行速度是相當快的。</li>
</ol>
<hr>
<h2 id="Lv-3-PSO"><a href="#Lv-3-PSO" class="headerlink" title="Lv. 3 PSO"></a>Lv. 3 PSO</h2><p>請利用Particle swarm optimization替換掉 GA 部分。</p>
<ul>
<li>AgentNum(粒子數)</li>
<li>IterationNum(疊代數),</li>
<li>MaxV(最大速度),</li>
<li>MaxX(最大值範圍),</li>
<li>Weights(兩個權重),</li>
<li>Convergent_Error(停止條件)</li>
<li>並畫出 fitness function 曲線變化 (每一次疊代的最佳fitness值)，最後訓練完成的F(x)當作規則 請跑出車子軌跡。</li>
</ul>
<h3 id="實驗分析-1"><a href="#實驗分析-1" class="headerlink" title="實驗分析"></a>實驗分析</h3><p>一開始參數為<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">int</span> sandSize = <span class="number">512</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">double</span> maxVelocity = <span class="number">0.5</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">double</span> maxXposition = <span class="number">0.5</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">double</span> weightOfCognition = <span class="number">0.5</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">double</span> weightOfSocial = <span class="number">0.5</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">double</span> nearRatio = <span class="number">0.5</span>;</div></pre></td></tr></table></figure></p>
<p><img src="/img/hw-ci-11.png" alt="PSO 1"></p>
<p><img src="/img/hw-ci-12.png" alt="PSO 2"></p>
<ul>
<li><p>基本上 <code>maxXposition</code> 沒有用到，調整其他比例可以發現端倪。</p>
</li>
<li><p>從圖 <code>PSO 2</code> 中可以發現到，PSO 與 GA 最大的不同在於，如果 GA 調用部分突變的情況下，很高的機率會發現適應曲線是嚴格遞減的，但是在 PSO 由於會飛來飛去，有可能會來回震盪。</p>
</li>
<li><p>當所有粒子逼近最佳解時，仍會以原本的速度繼續飛行，而原本屬於最佳位置的點也會開始模仿其他粒子飛行，如此一來就會造成震盪。</p>
</li>
</ul>
<p><img src="/img/hw-ci-14.png" alt="PSO 3"></p>
<ul>
<li><p>其震盪的高低決定於鄰近模仿的權重，如果鄰近的粒子效果不好，模仿的權重高的時候，會導致整個最佳解有嚴重的偏離。由 <code>PSO 3</code> 中可以驗證這個震盪問題。</p>
</li>
<li><p>如果對於全局模仿權重調高，很容易造成處於群聚粒子不容易分離，也就是很難在早到其他的區域最佳解，會在很快的時間內進入某一個區域最佳解，從這一點中可以發現 PSO 真的具有快速收斂的性質。</p>
</li>
<li><p>設定 <code>maxVelocity</code> 是將整個向量長度 (歐幾里得距離) 壓縮，這將可以控制查找的精密度，如果設定太小會導致收斂速度明顯下降。將 <code>maxVelocity = 10</code> 時，適應函數看起來會有比較高的進展，由於會將每個參數約束，只要速度不是太小影響就不大。</p>
</li>
<li><p>當速度上限增加時，粒子碰到牆的機會也會上升，由於搜索範圍的可能性涵蓋邊界的情況增加，如果最佳解在邊界，在這樣的情況就會更好。</p>
</li>
<li><p>在代碼中，鄰近的定義為最近粒子中排名前 20% 的最佳解。如果採用對於常數長度，這種情況上不容易觀察，也就是說不能直接找到鄰近模仿的規模該定義在何處。</p>
</li>
<li><p>運行結果 J = 3, p = 3<br>( ,w1 , w2 ,.., wJ , m11, m12,.., m1p, m21, m22,.., m2p,.., mJ1, mJ2,…, mJp, σ1, σ2, …, σJ) = (0.117271 1.270048 0.000000 0.805823 15.845525 0.000000 21.613452 13.509075 0.000000 0.000000 30.000000 0.000000 10.505934 10.000000 10.000000 5.238101)</p>
</li>
</ul>
<h1 id="Github-Download"><a href="#Github-Download" class="headerlink" title="Github Download"></a>Github Download</h1><p><a href="https://github.com/morris821028/hw-FuzzySystem" target="_blank" rel="external">Download</a></p>
<p><a href="http://morris821028.github.io/2014/05/19/hw-computational-intelligence/">Blog</a></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/operating-system-hw-thread" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/18/lesson/operating-system-hw-thread/" class="article-date">
  <time datetime="2014-05-18T06:58:10.000Z" itemprop="datePublished">2014-05-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/作業系統/">作業系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/18/lesson/operating-system-hw-thread/">作業系統 Thread 程式作業</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/18/lesson/operating-system-hw-thread/" data-id="cksb6ga5m02ejd8vnkzxwkvhi" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/18/lesson/operating-system-hw-thread/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C++</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/matrix/">matrix</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/thread/">thread</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/作業系統/">作業系統</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="C-Thread-練習"><a href="#C-Thread-練習" class="headerlink" title="C++ Thread 練習"></a>C++ Thread 練習</h1><h2 id="作業要求"><a href="#作業要求" class="headerlink" title="作業要求"></a>作業要求</h2><blockquote>
<p>作業一:應用 Thread 撰寫任意程式(語言不限)，繳交方式 FTP:140.115.155.192(選擇自己學號的資料夾上傳) 帳:os2014 密碼不知道者請再問助教，檔案名稱: “作業一<em>學號</em>姓名_第幾版” ex:”作業一<em>10252200x</em>林大乖_v1” 繳交內容:壓縮檔(報告word 以及 程式碼,執行檔)，截止日期:2014/05/25(日)23:59</p>
</blockquote>
<h2 id="程式功能"><a href="#程式功能" class="headerlink" title="程式功能"></a>程式功能</h2><p>兩個 <code>n*n</code> 矩陣相乘，在最基礎的 <code>O(n^3)</code> 效能上，使用 Thread 等相關技巧使其加速。</p>
<h2 id="運行"><a href="#運行" class="headerlink" title="運行"></a>運行</h2><ul>
<li><p>Mac OSX</p>
<pre><code>$ clang -pthread x.cpp -o x
</code></pre></li>
<li><p>Linux</p>
<pre><code>$ gcc -lpthread x.cpp -o x
</code></pre></li>
</ul>
<h2 id="測試效率"><a href="#測試效率" class="headerlink" title="測試效率"></a>測試效率</h2><ul>
<li>Mac OSX and Linux<pre><code>$ time ./a.out
</code></pre></li>
</ul>
<h2 id="測試結果"><a href="#測試結果" class="headerlink" title="測試結果"></a>測試結果</h2><p>測試環境為 2013 Mac Air 1.3 GHz Intel Core i5 上對 <code>1024 x 1024</code> 的矩陣進行相乘的統計結果。</p>
<ul>
<li><code>matrix.cpp</code><br>最原始的一般寫法，直接使用 <code>O(n^3)</code> 。運行時間約在 20 秒左右完成。</li>
<li><code>matrix[v2].cpp</code><br>使用轉置矩陣後，在進行運算，這種方式是加快作業系統中的快取層，速度提升至約在 4 秒左右完成。</li>
<li><code>matrix[v3].cpp</code><br>建立在 <code>matrix[v2].cpp</code> 的基礎上，使用 4 條 thread，分別對處理的 column 進行分割操作，速度約在 2 秒內完成。</li>
<li>matrix[v4].cpp<br>與 <code>matrix[v3].cpp</code> 類似，調整 thread 的數量，查看效率變化，但是速度沒有更快的趨勢。</li>
</ul>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>Thread 多不代表會比較快，而是該程式佔有 CPU 的機會比較高，使用的資源就會比較多。在整個作業系統中，Thread 多上下文切換的次數就會上升，對於作業系統整體效率是下降的，但是又不能沒有 Thread，看起來像是所有程式同時在運行，也要防止落入死機無法動彈的情況。</p>
<p>而在 thread 上面會發現，當數量達到一定程度後，速度就不會上升，有一部分是因為 CPU 超頻運作。</p>
<blockquote>
<p>超頻（英語：Overclocking）是把一個電子配件的時脈速度提升至高於廠方所定的速度運作，從而提升性能的方法，但此舉有可能導致該配件穩定性下降。</p>
</blockquote>
<p>可能是長時間閒置的 CPU 發現有大規模的工作運行，把時脈速度升起。</p>
<h1 id="代碼"><a href="#代碼" class="headerlink" title="代碼"></a>代碼</h1><h2 id="matrix-cpp"><a href="#matrix-cpp" class="headerlink" title="matrix.cpp"></a>matrix.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 1024</span></div><div class="line"><span class="keyword">double</span> A[MAX_N][MAX_N];</div><div class="line"><span class="keyword">double</span> B[MAX_N][MAX_N];</div><div class="line"><span class="keyword">double</span> C[MAX_N][MAX_N];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">multiply</span><span class="params">(<span class="keyword">double</span> A[][MAX_N], <span class="keyword">double</span> B[][MAX_N], <span class="keyword">double</span> C[][MAX_N])</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; MAX_N; j++) &#123;</div><div class="line">            <span class="keyword">double</span> sum = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; MAX_N; k++) &#123;</div><div class="line">                sum += A[i][k] * B[k][j];</div><div class="line">            &#125;</div><div class="line">            C[i][j] = sum;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">    <span class="comment">//clock_t start, finish;</span></div><div class="line">    <span class="comment">//start = clock(); // start time clock</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; MAX_N; j++) &#123;</div><div class="line">            A[i][j] = i;</div><div class="line">            B[i][j] = j;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    multiply(A, B, C);</div><div class="line">    <span class="comment">//finish = clock(); // finish time clock</span></div><div class="line">    <span class="comment">//printf("Time: %lf\n", (double)(finish - start)/1000);</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="matrix-v2-cpp"><a href="#matrix-v2-cpp" class="headerlink" title="matrix[v2].cpp"></a>matrix[v2].cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 1024</span></div><div class="line"><span class="keyword">double</span> A[MAX_N][MAX_N];</div><div class="line"><span class="keyword">double</span> B[MAX_N][MAX_N];</div><div class="line"><span class="keyword">double</span> C[MAX_N][MAX_N];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">trans</span><span class="params">(<span class="keyword">double</span> A[][MAX_N])</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt; MAX_N; j++) &#123;</div><div class="line">            swap(A[i][j], A[j][i]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">multiply</span><span class="params">(<span class="keyword">double</span> A[][MAX_N], <span class="keyword">double</span> B[][MAX_N], <span class="keyword">double</span> C[][MAX_N])</span> </span>&#123;</div><div class="line">    trans(B);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; MAX_N; j++) &#123;</div><div class="line">            <span class="keyword">double</span> sum = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; MAX_N; k++) &#123;</div><div class="line">                sum += A[i][k] * B[j][k];</div><div class="line">            &#125;</div><div class="line">            C[i][j] = sum;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">    <span class="comment">//clock_t start, finish;</span></div><div class="line">    <span class="comment">//start = clock(); // start time clock</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; MAX_N; j++) &#123;</div><div class="line">            A[i][j] = i;</div><div class="line">            B[i][j] = j;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    multiply(A, B, C);</div><div class="line">    <span class="comment">//finish = clock(); // finish time clock</span></div><div class="line">    <span class="comment">//printf("Time: %lf\n", (double)(finish - start)/1000);</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="matrix-v3-c"><a href="#matrix-v3-c" class="headerlink" title="matrix[v3].c"></a>matrix[v3].c</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 1024</span></div><div class="line"><span class="keyword">double</span> A[MAX_N][MAX_N];</div><div class="line"><span class="keyword">double</span> B[MAX_N][MAX_N];</div><div class="line"><span class="keyword">double</span> C[MAX_N][MAX_N];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">trans</span><span class="params">(<span class="keyword">double</span> A[][MAX_N])</span> </span>&#123;</div><div class="line">    <span class="keyword">double</span> x;</div><div class="line">    <span class="keyword">int</span> i, j;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (j = i+<span class="number">1</span>; j &lt; MAX_N; j++) &#123;</div><div class="line">            x = A[i][j];</div><div class="line">            A[i][j] = A[j][i];</div><div class="line">            A[j][i] = x;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_THREAD 4</span></div><div class="line"><span class="function"><span class="keyword">void</span> *<span class="title">multiply</span><span class="params">(<span class="keyword">void</span> *arg)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> id = *((<span class="keyword">int</span> *)arg);</div><div class="line">    <span class="keyword">int</span> st = id * MAX_N / MAX_THREAD;</div><div class="line">    <span class="keyword">int</span> ed = (id + <span class="number">1</span>) * MAX_N / MAX_THREAD - <span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> i, j, k;</div><div class="line">    <span class="keyword">for</span> (i = st; i &lt;= ed; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; MAX_N; j++) &#123;</div><div class="line">            <span class="keyword">double</span> sum = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; MAX_N; k++) &#123;</div><div class="line">                sum += A[i][k] * B[j][k];</div><div class="line">            &#125;</div><div class="line">            C[i][j] = sum;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">    <span class="built_in">puts</span>(<span class="string">"Thread version"</span>);</div><div class="line">    <span class="comment">//clock_t start, finish;</span></div><div class="line">    <span class="comment">//start = clock(); // start time clock</span></div><div class="line">    <span class="keyword">int</span> i, j;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; MAX_N; j++) &#123;</div><div class="line">            A[i][j] = i;</div><div class="line">            B[i][j] = j;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    trans(B);</div><div class="line">    </div><div class="line">    <span class="keyword">pthread_t</span> *threads;</div><div class="line">    threads = (<span class="keyword">pthread_t</span> *) <span class="built_in">malloc</span>(MAX_THREAD * <span class="keyword">sizeof</span>(<span class="keyword">pthread_t</span>));</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_THREAD; i++) &#123;</div><div class="line">        <span class="keyword">int</span> *p = (<span class="keyword">int</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</div><div class="line">        *p = i;</div><div class="line">        pthread_create(&amp;threads[i], <span class="literal">NULL</span>, multiply, (<span class="keyword">void</span> *)(p));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; MAX_THREAD; i++) &#123;</div><div class="line">        pthread_join(threads[i], <span class="literal">NULL</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//finish = clock(); // finish time clock</span></div><div class="line">    <span class="comment">//printf("Time: %lf\n", (double)(finish - start)/1000);</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>雖然作業可以有其他語言的相關 Thread，在 Java 作品方面可以查看 Github。</p>
<ul>
<li><a href="https://github.com/morris821028/hw-ChatRoom" target="_blank" rel="external">聊天室 Chart Room</a></li>
<li><a href="https://github.com/morris821028/hw-FuzzySystem" target="_blank" rel="external">演化模擬</a></li>
</ul>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/hw-agile-paper" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/14/lesson/hw-agile-paper/" class="article-date">
  <time datetime="2014-05-14T13:36:45.000Z" itemprop="datePublished">2014-05-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/img/1399146778408.gif" rel="gallery_cksb6ga5902e4d8vnoh4n0pfu">
        <img src="/img/1399146778408.gif" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/14/lesson/hw-agile-paper/">論文選讀 Agile Development and User Experience Design ... </a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/14/lesson/hw-agile-paper/" data-id="cksb6ga5902e4d8vnoh4n0pfu" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/14/lesson/hw-agile-paper/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/軟體開發/">軟體開發</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="課程論文心得"><a href="#課程論文心得" class="headerlink" title="課程論文心得"></a>課程論文心得</h1><p>首先，所讀這一篇的論文名稱為『Agile Development and User Experience Design Integration as an Ongoing Achievement in Practice』 所以著重點在于用戶體驗設計要怎麼融入敏捷開發的探討。</p>
<p>什麼是用戶體驗？先說說 UX Designer 做些什麼嗎</p>
<p><a href="https://www.facebook.com/notes/kit-lin/%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%BD%89ux-designer%E5%B0%B1%E4%B8%8A%E6%89%8B%E4%B8%8A/10152088295236310" target="_blank" rel="external">第一次轉UX Designer就上手（上）</a></p>
<p><a href="https://www.facebook.com/notes/kit-lin/%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%BD%89ux-designer%E5%B0%B1%E4%B8%8A%E6%89%8B%E4%B8%8B/10152088337196310" target="_blank" rel="external">第一次轉UX Designer就上手（下）</a></p>
<p>看完內容後，總之 UX Designer 算是一種設計師，與理工背景的開發人員可是天差地遠，</p>
<p>他們比起宅宅開發者來說，要與用戶產生關係，繪畫、表達、心理學、與現實溝通，開發人員擁有技術並且完成目標，但是行為卻不是一般使用者，最簡單的說法是『為什麼做出來的軟體只有開發者會用？』如果在軟體的需求面向是開發者們的話，這也許還不是問題，但是要做出給一般人使用的軟體，這樣是行不同的。但是開發者的邏輯古怪到自己都不明白的機率是挺高的，因此會有 UX Designer。</p>
<p>借由 UX design，軟體將會有耐用性、易上手、輕便化 … 等，這讓我突然想到總是會開發出根本用不著的功能，或者是相當難操作的功能。</p>
<p>但是要把 UX design 完全融入是有困難的，因為邏輯思維不同的人，是很難協調的，又或者會互相侵蝕。</p>
<h2 id="開始談談論文的內容"><a href="#開始談談論文的內容" class="headerlink" title="開始談談論文的內容"></a>開始談談論文的內容</h2><p>這一篇論文，主要是 <strong> 觀察 </strong>，也沒有觀察到所有目前的運行方式。換句話說，不會存在唯一一個好的開發方式，根據組織的規模和文化背景，所適用的運行方式也會有所不同，在理論上百分之百照抄別人的做法運用在自己的發開方式，但是可以藉由論文中觀察的幾點來學習我們的開發方式大概需要的是哪些面向需求。</p>
<p>而當開發人員是怎麼樣類型的人，就可能需要運用哪些方式，這些都是需要去探討的。外國也許按照它們的方式走成功，但並不代表按照一樣的作法一樣會成功，這就所謂 <strong> 新方法論 </strong>。新方法論沒有絕對的方法，說來有點玄，也就是沒有固定方法就是方法！</p>
<p>由於組織規模不同，彼此部門又要互相協調，在設計與開發之間的不同在於時間的週期不同，工作類型的方式不同，如果是大規模組織，『提高內聚力，降低耦合度』因此專業分工的類型將會在 Study 1 中被提及，這麼考量是有它的原因在的。</p>
<p>而文藝復興時期的全才－達文西類型，則可以在 Study 2 中被提及，每一個人都必須學習一點別人的領域的項目，這樣可以互相考量、共同承擔，來分散思考風險。但這樣對於一般人是相當困難的，如果是菁英組織的運行，大概就是長得這樣。</p>
<p>在最後的 Study 3 中，雖然使用傳統的瀑布式開發，這種神祕的設計大於開發組合相當異常，但也許是一種新的導向。在往後的時代中，當技術相對成熟穩定時，面對的將會是設計需求大於開發需求。</p>
<hr>
<h1 id="RESEARCH-METHOD"><a href="#RESEARCH-METHOD" class="headerlink" title="RESEARCH METHOD"></a>RESEARCH METHOD</h1><p>這裡提供三種 Ethnography (社會學的一種寫作文本，中文翻譯：民族誌) 來探討敏捷開發人員和用戶體驗設計師的配置方式。</p>
<h2 id="A-In-the-field"><a href="#A-In-the-field" class="headerlink" title="A. In the field"></a>A. In the field</h2><p>(田野調查的區域，民族誌運用田野工作來提供人類社會學的描述研究)</p>
<p>總共有三個組織中，四個團隊參與本次研究，參與研究的團隊中正在進行 UX 設計，而我們主要的工作是觀察他們的工作運行情況。</p>
<p>共計在三種情況進行觀察。</p>
<ul>
<li>Study 1: 觀察時間為兩個星期</li>
<li>Study 2: 觀察時間為六天</li>
<li>Study 3: 觀察時間為兩天</li>
</ul>
<p>其中 Study 1, 2 過程中會涵蓋 Sprint 會議，而 Study 3 則只有涵蓋開發人員和設計師共處一室。</p>
<h2 id="B-Thematic-analysis"><a href="#B-Thematic-analysis" class="headerlink" title="B. Thematic analysis"></a>B. Thematic analysis</h2><p>(專題分析)</p>
<h2 id="C-Study-participants"><a href="#C-Study-participants" class="headerlink" title="C. Study participants"></a>C. Study participants</h2><p>(研究參與者)</p>
<h1 id="ACCOUNTS-OF-THE-DAY-TO-DAY-INTEGARTION-WORK"><a href="#ACCOUNTS-OF-THE-DAY-TO-DAY-INTEGARTION-WORK" class="headerlink" title="ACCOUNTS OF  THE DAY-TO-DAY INTEGARTION WORK"></a>ACCOUNTS OF  THE DAY-TO-DAY INTEGARTION WORK</h1><h2 id="Study-1"><a href="#Study-1" class="headerlink" title="Study 1"></a>Study 1</h2><p>這項研究在 14 位 developer 和 2 位 UX designer，這兩位 UX designer 並不屬於 developer team，而是屬於該公司的 UX design team，因此他們並沒有參與 Sprint meeting、Standup、Retrospective，當然開發人員也沒有參與 design meeting，developer team 和 design team 在不同樓層工作。</p>
<p>開發人員描述道『將 UX design 與 agile develop 分開，是基於管理層面。』這很大的原因在於要將 UX 創造力發揮到極限，不能讓軟體工程的問題阻擋他們思考。</p>
<p>而在 Sprint meeting 中觀察到，UX designer 會提供一個 UX design 在 sprint meeting 前送達。但在隨後的 UX design 版本則是偶爾送到 developer 手上，直到 sprint 的最後一天仍持續修改，這表示著 developer 無法依靠 UX design 考慮相關的實作項目，所以大多數的關於 UX 工作將會分配在最後幾個小時來完成。</p>
<p>然而如果詢問 UX designer 是否已經意識到自己時間分配所造成的影響，則他們會回答說『沒有』。但事實上，在發送 UX design 時就已經造成相當多的問題。</p>
<blockquote>
<p>[UX designer]: “That was never explicitly said to me … I thinks there was and still is visibility issues to do with what they’re doing and what their timeline are.”<br>這表示 UX designer 從來不知道這些事情，也從來沒有直接地被告知這項問題，也是因為不知道 developer 的運行工作和時程表。</p>
</blockquote>
<p>當要澄清或者是修改 UX design 時，develop 會將問題寫下，並且要求 UX designer 在他們的 feedback meeting 中討論。</p>
<blockquote>
<p>[senior UX designer]: “The visual designs are pretty much parallel to the wireframes … what kind of feedback do you want to give ?”<br>資深 UX designer 表示道：所有的視覺設計都是在線框 (wireframe) 的基礎上完成的，能有什麼樣的反饋？</p>
</blockquote>
<p>developer 並不完全了解 UX design，只能依靠 UX designer 的批准和重構，這 “批准” 主要是對於敏捷開發中的維護和支持的組成用途，但是當 developer 向 designer 發問時，往往是溝通失敗的。</p>
<blockquote>
<p>2pm: There is some problem with the visual design from UX [hadn’t arrived yet]. Project manager’s been trying to get in touch with the interaction designer, however can not get in contact - mobile switched off. Project manager has heard that UX are moving desks (not all the visual designs have been delivered since the developer feedback session). </p>
</blockquote>
<p>上述內容看得不明白，難道是就是單純 PM 得不到完整的 visual design，因此也就不能向互動工程師聯繫嗎？</p>
<h2 id="Study-2"><a href="#Study-2" class="headerlink" title="Study 2"></a>Study 2</h2><p>小型手機軟件開發的公司，這一間公司有兩支團隊，每一隊有 5 名 developer 和 1 名 UX designer。其中 UX designer 設計非功能性描述和 screen mock-ups，這幾個項目將可以幫助 developer 參考進行開發。</p>
<pre><code>mock-ups 相當於一種 prototype 可以支持動作的描述，通常會帶有基礎的 action code，關於 mock-ups 的相關工具有很多，但是通常價格不菲，邊設計還能自動幫忙產生代碼是不容易的工作。網路上找不到相關的解釋，就先這樣頂替了，相較於一般手繪製圖和文件描述，這樣的方式更為容易了解。
</code></pre><p>在他們會議中，每一個角色(QA, scrum master, product owner, UX designer, developer) 都參與討論會議，創造共同意識和共享決策責任。</p>
<blockquote>
<p>9:30 [developer]: How should tabs appear, is ad always right-most tab ? … UX designer tells the developer what whould happen: As new chats come in ad tab moves over to right-most tab.</p>
</blockquote>
<p>開發人員: 分頁到底該如何呈現，而廣告要固定在最右側的分頁嗎？ … UX designer 告訴我們應該「當新的聊天訊息進來時，廣告要移動到最右邊的分頁嗎？」</p>
<blockquote>
<p>[Product owner]: Still waiting on response for some questions from the client.</p>
</blockquote>
<p>Product owner: 這仍然在等待顧客的回報訊息</p>
<blockquote>
<p>[QA]: Kind of hard to do QA if we don’t have the answer … wayry of starting stories without behaviours which means we might have to change thins and that wastes time.</p>
</blockquote>
<p>QA: 這件事情很難做確認，如果我們沒有接收到回報，做的任何修改也許只是浪費時間，無法確定品質。</p>
<blockquote>
<p>[UX designer]: Do them anyway, they might need to go through a number of iterations before they agree this is what they want … it’s better of they see something working as soon as posssible.</p>
</blockquote>
<p>UX designer: 先把這問題放一旁，這需要多次迭代才能確定這是他們想要的 … 如果他們需要高效工作，則這個方式可能比較好。</p>
<blockquote>
<p>[QA]: What if an ad coes in at exactly the same time as a chat ?</p>
</blockquote>
<p>QA: 那如果廣告作為一個新的聊天訊息出場的話呢？</p>
<blockquote>
<p>[UX designer]: That’s extreme edge case and probably very hard to test. So leave it. QA agrees.</p>
</blockquote>
<p>UX designer: 這是一個相當極端的方式，非常難測試，所以先不要管這個。</p>
<p>這些對話通常在每一天的工作中進行，詢問另外一個團隊問題，而另外的團隊注意這些問題。</p>
<blockquote>
<p>[UX designer]: “… if developers come up with issues, these are discussed on a case-by-case basis as they come up … There are lots of small things which are easily worked out on a day-to-day basis”</p>
</blockquote>
<p>UX designer: 如果 developer 在每一個 case 基礎上想出了問題，這些小問題很容易在每日解決。</p>
<p>從會議過程中，主要，我們可以發現的每一個角色都參與了 UX design，同時也在職權外貢獻了他們的想法 - 例如 UX designer 建議在極端情況忽略 QA testing，而在 QA 沒有指責 UX designer 所做的 QA 決策，他們接受這項意見並沒有發出任何評論。其次，在這個 UX design 討論議題中也一起討論了 non-UX 的問題(如這個 QA testing 問題)。</p>
<p>這次的會議的下一步行動，包括實現解決方案和傳達問題給客戶。所有的角色參與討論導致決策同時考慮的設計價值和技術考量。</p>
<p>而在會議中，有 developer 向其他人簡單說明，他在網路空間上有一些之前專案製作時替換視覺設計的文件可以參考，這可以讓 UI designer 可以接受這些更改的項目，增加信服力。</p>
<blockquote>
<p>[UX designer]: Sometimes the developers’ decisions are better, as they are much closer to the implementation. 有時候開發者的決策會更好，因為他們更接近實作。</p>
</blockquote>
<h2 id="Study-3"><a href="#Study-3" class="headerlink" title="Study 3"></a>Study 3</h2><p>在非常小的公司進行，有 1 名 developer 和 2 名 UX designer，他們擅長瀑布形式的開發，在開發過程中 developer 和 UX designer 在同一間辦公室工作，目標是使得設計和開發更接近。正如 Study 1 的時候，發現 developer 會根據 UX designer 設計的線框 (wireframe) 和 visual design 努力地工作。</p>
<p>觀察兩天後的結果如下:</p>
<p>在一般的情況下，UX designer 通常和 developer 在不同樓層工作，developer 也表示他們很少去找 designer 討論遭遇的問題。</p>
<blockquote>
<p>[developer]: We often find things that don’t work, but we don’t go back to design. We just do our best. 我們常發現很多事情並不會 work，但是並沒有回去檢討設計，單純盡力而為。</p>
</blockquote>
<p>在這種共同工作的情況下，designer 給予了一些回應。</p>
<blockquote>
<p>[UX designer]: This style of working means we can collaborate in order to get our points across, rather than dictate because there’s no communication going on. 這種工作方式可以讓我們的觀點交換，而不是因為沒有通通合作的命令。</p>
<p>[Head of UX]: And when we first met with the client, the first thing they did was to present to us the findings of that initial research. So we can then go and propose what would bee the next step, which is quite different from any other type of work we’ve been invited to get involved in.</p>
</blockquote>
<p>在大多數的情況，不確定性，設計師在現場談話的記錄:</p>
<blockquote>
<p>[visual designer]: I just feel like I’m not getting any-where.</p>
<p>[IA]: I also feel that way.</p>
</blockquote>
<p>但是對於另一個情況下</p>
<blockquote>
<p>[developer]: Just cover the site map.</p>
</blockquote>
<p>developer 和 designer 共同工作</p>
<ul>
<li>可以相互討論跟顧客對談時的內容 (當時在場的感受不同)</li>
<li>目標計劃做些什麼，訊息可以提前知道。(想要做第二個版本)</li>
<li>「這個設計會不會很難實作？」這些問題將會很快被反應出來。</li>
</ul>
<blockquote>
<p>[developer]: It would probably be just as easy.</p>
</blockquote>
<hr>
<h1 id="THEME-FOR-ACHIEVING-INTEGRATION"><a href="#THEME-FOR-ACHIEVING-INTEGRATION" class="headerlink" title="THEME FOR ACHIEVING INTEGRATION"></a>THEME FOR ACHIEVING INTEGRATION</h1><h2 id="A-Integration-as-expectations-about-acceptable-behaviour"><a href="#A-Integration-as-expectations-about-acceptable-behaviour" class="headerlink" title="A. Integration as expectations about acceptable behaviour"></a>A. Integration as expectations about acceptable behaviour</h2><p>在 Study 1 中可以發現，如果將兩者隔離，很容易造成規劃的浪費和開發者在最後期限前超時工作。UX designer 同時跨越多個專案進行設計，丟出設計之後就沒有可接收開發者的反饋，只有等到 sprint meeting 的反應才重新設計，這時可能已經為期已晚。</p>
<p>在 Study 2 中可以發現，頻繁確保兩者之間有相互支持，並且在 UX design 和代碼之間可以互相溝通，相較于 Study 1 上，溝通性有上升，但這些遭遇的問題將會在每個人參與討論會議的過程中的一部份。</p>
<p>在 Study 3 中，每一個成員都有機會被其他角色問到自己領域的問題，同時也可以在與客戶討論中的觀察，在隨後討論。這都歸因于他們在同一間辦公室工作。</p>
<h2 id="B-Integration-as-mutual-awareness"><a href="#B-Integration-as-mutual-awareness" class="headerlink" title="B. Integration as mutual awareness"></a>B. Integration as mutual awareness</h2><p>相對于 Study 1 中，Study 2, 3 擁有了共同享有決策的責任，同時提高了互動上的認識。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/compiler-clg-ll(1)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/11/lesson/compiler-clg-ll(1)/" class="article-date">
  <time datetime="2014-05-11T14:36:41.000Z" itemprop="datePublished">2014-05-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/編譯器/">編譯器</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/11/lesson/compiler-clg-ll(1)/">編譯器 Compiler CFG LL(1)</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/11/lesson/compiler-clg-ll(1)/" data-id="cksb6ga4g02d2d8vntacxfwmu" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/11/lesson/compiler-clg-ll(1)/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CFG/">CFG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/First-Set/">First Set</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Follow-Set/">Follow Set</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LL-1/">LL(1)</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/編譯器/">編譯器</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="序文"><a href="#序文" class="headerlink" title="序文"></a>序文</h1><p>相較於其他技術而言，編譯器的確不是什麼有趣的課程，在這一門領域專研的人也變少了，所以專精的人越少，將會越有機會。易見地，也越來越少大學開設這門編譯器的課程，不過在一些公司，編譯器的技術將成為私囊秘寶，如何將代碼更加地優化快速，這就是相當令人感到為之一驚的地方。</p>
<h1 id="DFA-NFA-Regular-expression"><a href="#DFA-NFA-Regular-expression" class="headerlink" title="DFA, NFA, Regular expression"></a>DFA, NFA, Regular expression</h1><p>在討論所有語法前，要明白正規表達式 ( Regular expression = RegExp ) 的運作，RegExp 運作上涵蓋的語法集合是最小的，對於一個 RegExp 來說，可以轉換成具有 n 個狀態的 NFA，而這台 NFA 可以轉換成 2<sup>n</sup> 狀態的 DFA。</p>
<p>NFA 和 DFA 最大的不同在於轉移狀態時，考慮的路徑情況，NFA 可以在不考慮輸入進行轉移，或者在相同情況下可以有很多轉移選擇。 DFA 則必須在一個輸入唯一一個轉移情況下運作。</p>
<img src="/img/500px-DFAexample.svg.png" title="DFA">
<p>如上圖 DFA 所示，邊上的內容就是根據輸入的情況進行轉移。</p>
<img src="/img/423px-NFASimpleExample.svg.png" title="NFA">
<p>如上圖 NFA 所示，會發現狀態 <code>p</code> 對於輸入 <code>1</code> 有 2 種轉移可能 (<code>p-&gt;p</code> or <code>p-&gt;q</code>)。</p>
<p>最後可以得到一個 RegExp 一定會有一台 DFA 辨識它。而一台 DFA 也一定會有一個 RegExp，這句話的含意將可以在 <code>計算理論</code> 這門課中學到如何藉由類似 <code>Floyd Algorithm</code> 內點性質依序推出 DFA 對應的 RegExp。</p>
<h1 id="CFG-Context-free-grammar"><a href="#CFG-Context-free-grammar" class="headerlink" title="CFG (Context-free grammar)"></a>CFG (Context-free grammar)</h1><p>A context-free grammar is a formal system that describes a language by specifying how any legal string (i.e., sequence of tokens) can be derived from a start symbol. It consists of a set of productions, each of which states that a given symbol can be replaced by a given sequence of symbols. </p>
<p>另一個類似的語言是 <code>Context-sensitive grammar</code>，等價性質的兄弟是 <code>Chomsky normal form</code>。</p>
<ul>
<li><p>CFG <code>G = (Vt, Vn, S, P)</code></p>
<ul>
<li>Vt: 有限的 terminal 字符集</li>
<li>Vn: 有限的 nonterminal 字符集</li>
<li>S: 一開始出發的 start symbol</li>
<li>P: 轉換的規則 (production)</li>
<li><p>來個例子</p>
<pre><code>LHS (left-hand side) -&gt; RHS (right-hand side)

&lt;E&gt;         -&gt; &lt;Prefix&gt; ( &lt;E&gt; )
&lt;E&gt;         -&gt; V &lt;Tail&gt;
&lt;Prefix&gt;    -&gt; F
&lt;Prefix&gt;    -&gt; l
&lt;Tail&gt;      -&gt; + &lt;E&gt;
&lt;Tail&gt;      -&gt; l
</code></pre><p>明顯地</p>
<ul>
<li><code>Vt = {(, ), V, F, l, +}</code></li>
<li><code>Vn = {&lt;E&gt;, &lt;Prefix&gt;, &lt;Tail&gt;}</code></li>
<li><code>S = &lt;E&gt;</code></li>
<li><code>P</code> 就是給定那六條規規則</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>名詞<ul>
<li><em>Sentential form</em><br>  If S =&gt;<sup>*</sup> β, β then is said to be <em>sentential form</em> of the CFG<br>  簡單來說，所有從 start symbol 過程中替換出來的句子都稱為 sentential form。</li>
<li><em>Handle</em> of a sentential form<br>  The handle of a sentential form is the left-most simple phrase.<br>  <img src="/img/ch07-tree-1.png" alt="img"><br>  簡單來說，就是將一個 nonterminal 根據 production 轉換成 RHS (right-hand side) 的一個步驟。</li>
</ul>
</li>
</ul>
<ul>
<li>什麼是 CFG (上下文無關語法)？<br>  簡單來說，還真的是上下文無關，例如 <code>S -&gt; AB</code> 可以見到 S 轉換時，不會因為前文或後文是什麼內容而影響，而在 <code>Context-sensitive grammar</code> (上下文敏感) 可以見到 <code>aSb -&gt; AB</code> 會因為前面跟後面所受到的影響。</li>
</ul>
<blockquote>
<p>這裡使用大寫為 nontermainl，其他字符為 terminal。</p>
</blockquote>
<h2 id="First-Set"><a href="#First-Set" class="headerlink" title="First Set"></a>First Set</h2><ul>
<li>First(A)<ul>
<li>The set of all the <em>terminal</em> symbols that can <em>begin</em> a sentential form <em>derivable from</em> A. <code>A =&gt;* aB</code><pre><code>First(A) = {
    a in Vt | A =&gt;* aB, and
    Λ in Vt | A =&gt;* Λ
}
</code></pre></li>
<li>簡單地說，從這個 nonterminal 開始，第一個不能被替換的 terminal 就會在 First set 中。</li>
</ul>
</li>
<li>計算 <code>First(A)</code> 前，必須先建出這個 nonterminal 有沒有可能推出 Λ，即 <code>A =&gt;* Λ</code>。<br>這邊相當有意思，使用迭代更新，如果發現 <code>B =&gt;* Λ</code> 和 <code>C =&gt;* Λ</code> 則對於 Production <code>A =&gt; BC</code> 來說，可以得到 <code>A =&gt;* Λ</code> 就這麼依序推出所有情況，時間複雜度應該在 <code>O(n^2)</code>。</li>
<li>計算 <code>First(A)</code> 時，掃描規則 <code>LHS =&gt; RHS</code>，找到 <code>First(RHS)</code> 並且 <code>First(LHS).insert(First(RHS))</code>，依樣使用迭代更新推出所有情況，時間複雜度應該在 <code>O(n^2)</code>。</li>
</ul>
<h2 id="Follow-Set"><a href="#Follow-Set" class="headerlink" title="Follow Set"></a>Follow Set</h2><ul>
<li>Follow(A)<ul>
<li><em>A</em> is any nonterminal</li>
<li>Follow(A) is <em>the set of terminals</em> that may follow <em>A</em> in some sentential form. <code>S =&gt;* ... Aabc ...</code>follow set。<pre><code>Follow(A) = {
    a in Vt | S =&gt;* ... Aa ..., and
    Λ in Vt | S =&gt;* aA
}
</code></pre></li>
<li>請切記，一定要從 start symbol 開始替換的所有句子，而在這個 nonterminal 隨後可能跟著的 termainl 就會屬於它的。</li>
</ul>
</li>
<li>計算 <code>Follow(A)</code> 前，請先把 First set 都算完，接著也是用迭代更新，掃描規則 <code>A -&gt; a B b</code><br>對於 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">if Λ not in First(b)</div><div class="line">    Follow(B).insert(First(b))</div><div class="line">else</div><div class="line">    Follow(B).insert(First(b) - Λ)</div><div class="line">    Follow(B).insert(Follow(A))</div><div class="line">``` </div><div class="line"></div><div class="line">## Predict Set ##</div><div class="line"></div><div class="line">* Given the productions</div><div class="line">* During a (leftmost) derivation, Deciding which production to match, Using lookahead symbols</div><div class="line">* 相較於 First set 和 Follow set，Predict Set 是根據 Production 產生的，也就是說一條 production 會有一個對應的 predict set，而 First set 和 Follow set 都是根據 nonterminal 產生一對一對應的集合，用來預測這一條規則的第一個 terminal 會有哪些。</div><div class="line"></div><div class="line">對於 production : `A -&gt; X1 X2 ... Xm`</div></pre></td></tr></table></figure>
</li>
</ul>
<p>if Λ in First(X1 X2 … Xm)<br>    Predict(A -&gt; X1 X2 … Xm).insert(First(X1 X2 … Xm) - Λ);<br>    Predict(A -&gt; X1 X2 … Xm).insert(Follow(A));<br>else<br>    Predict(A -&gt; X1 X2 … Xm).insert(First(X1 X2 … Xm));<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">對於第一判斷情況在于 `... AE = ... X1 X2 ... Xm E`，明顯地可以從 `Follow(A)` 得到第一個字符為何。</div><div class="line"></div><div class="line">## LL(1) Table ##</div><div class="line">&gt; 尚未撰寫</div><div class="line"></div><div class="line">C++ code</div><div class="line">=====</div><div class="line"></div><div class="line">## 資料規格 ##</div><div class="line"></div><div class="line">以下代碼實作 CFG 的 First Set, Follow Set, Predict Set 和 LL(1) Table。</div><div class="line"></div><div class="line">用字符 `l` 代替 lambda</div><div class="line"></div><div class="line">## 資料範例 ##</div><div class="line"></div><div class="line">* 本課程簡易範例輸入</div></pre></td></tr></table></figure></p>
<p>S-&gt;aSe<br>S-&gt;B<br>B-&gt;bBe<br>B-&gt;C<br>C-&gt;cCe<br>C-&gt;d</p>
<p>A-&gt;BaAb<br>A-&gt;cC<br>B-&gt;d<br>B-&gt;l<br>C-&gt;eA<br>C-&gt;l</p>
<p>A-&gt;aAd<br>A-&gt;B<br>B-&gt;bBd<br>B-&gt;C<br>C-&gt;cCd<br>C-&gt;l</p>
<p>E-&gt;TX<br>X-&gt;+E<br>X-&gt;#<br>T-&gt;(E)<br>T-&gt;intY<br>Y-&gt;*T<br>Y-&gt;#</p>
<p>E-&gt;P(E)<br>E-&gt;vT<br>P-&gt;f<br>P-&gt;l<br>T-&gt;+E<br>T-&gt;l</p>
<p>S-&gt;aSe<br>S-&gt;B<br>B-&gt;bBe<br>B-&gt;C<br>C-&gt;cCe<br>C-&gt;d</p>
<p>S-&gt;ABc<br>A-&gt;a<br>A-&gt;l<br>B-&gt;b<br>B-&gt;l</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">* 本課程簡易範例輸出</div></pre></td></tr></table></figure>
<p>B:b,c,d<br>C:c,d<br>S:a,b,c,d<br>a:a<br>b:b<br>c:c<br>d:d<br>e:e<br>A:a,c,d<br>B:d,l<br>C:e,l<br>a:a<br>b:b<br>c:c<br>d:d<br>e:e<br>A:a,b,c,l<br>B:b,c,l<br>C:c,l<br>a:a<br>b:b<br>c:c<br>d:d</p>
<p>#:#<br>(:(<br>):)<br><em>:</em><br>+:+<br>E:(,i<br>T:(,i<br>X:#,+<br>Y:#,*<br>i:i<br>n:n<br>t:t<br>(:(<br>):)<br>+:+<br>E:(,f,v<br>P:f,l<br>T:+,l<br>f:f<br>v:v<br>B:b,c,d<br>C:c,d<br>S:a,b,c,d<br>a:a<br>b:b<br>c:c<br>d:d<br>e:e<br>A:a,l<br>B:b,l<br>S:a,b,c<br>a:a<br>b:b<br>c:c<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- - - - -</div><div class="line"></div><div class="line">* HTML 格式範例輸入</div></pre></td></tr></table></figure></p>
<p> <program>            -&gt; begin <statement_list> end<br> <statement_list>    -&gt; <statement> <statement_tail><br> <statement_tail>    -&gt; <statement> <statement_tail><br> <statement_tail>    -&gt; l<br> <statement>        -&gt; ID := <expression> ;<br> <statement>        -&gt; read ( <id_list> ) ;<br> <statement>        -&gt; write ( <expr_list> ) ;<br> <id_list>            -&gt; ID <id_tail><br> <id_tail>            -&gt; , ID <id_tail><br> <id_tail>            -&gt; l<br> <expr_list>        -&gt; <expression> <expr_tail><br> <expr_tail>        -&gt; , <expression> <expr_tail><br> <expr_tail>        -&gt; l<br> <expression>        -&gt; <primary> <primary_tail><br> <primary_tail>        -&gt; <add_op>    <primary> <primary_tail><br> <primary_tail>        -&gt; l<br> <primary>            -&gt; ( <expression> )<br> <primary>            -&gt; ID<br> <primary>            -&gt; INTLIT<br> <add_op>            -&gt; +<br> <add_op>            -&gt; -<br> <system_goal>        -&gt; <program> $</program></system_goal></add_op></add_op></primary></primary></expression></primary></primary_tail></primary_tail></primary></add_op></primary_tail></primary_tail></primary></expression></expr_tail></expr_tail></expression></expr_tail></expr_tail></expression></expr_list></id_tail></id_tail></id_tail></id_tail></id_list></expr_list></statement></id_list></statement></expression></statement></statement_tail></statement_tail></statement></statement_tail></statement_tail></statement></statement_list></statement_list></program></p>
<p> begin ID := ID - INTLIT + ID ; end $<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">* HTML 格式範例輸出</div></pre></td></tr></table></figure></p>
<p>+—————-+—– First set —–+<br>|$               | { $ }<br>|(               | { ( }<br>|)               | { ) }<br>|+               | { + }<br>|,               | { , }<br>|-               | { - }<br>|:=              | { := }<br>|;               | { ; }<br>|<add_op>        | { + - }<br>|<expr_list>     | { ( ID INTLIT }<br>|<expr_tail>     | { , l }<br>|<expression>    | { ( ID INTLIT }<br>|<id_list>       | { ID }<br>|<id_tail>       | { , l }<br>|<primary>       | { ( ID INTLIT }<br>|<primary_tail>  | { + - l }<br>|<program>       | { begin }<br>|<statement>     | { ID read write }<br>|<statement_list>| { ID read write }<br>|<statement_tail>| { ID l read write }<br>|<system_goal>   | { begin }<br>|ID              | { ID }<br>|INTLIT          | { INTLIT }<br>|begin           | { begin }<br>|end             | { end }<br>|read            | { read }<br>|write           | { write }<br>+—————-+———————+</system_goal></statement_tail></statement_list></statement></program></primary_tail></primary></id_tail></id_list></expression></expr_tail></expr_list></add_op></p>
<p>+—————-+—– Follow set —–+<br>|<add_op>        | { ( ID INTLIT }<br>|<expr_list>     | { ) }<br>|<expr_tail>     | { ) }<br>|<expression>    | { ) , ; }<br>|<id_list>       | { ) }<br>|<id_tail>       | { ) }<br>|<primary>       | { ) + , - ; }<br>|<primary_tail>  | { ) , ; }<br>|<program>       | { $ }<br>|<statement>     | { ID end read write }<br>|<statement_list>| { end }<br>|<statement_tail>| { end }<br>|<system_goal>   | { l }<br>+—————-+———————+</system_goal></statement_tail></statement_list></statement></program></primary_tail></primary></id_tail></id_list></expression></expr_tail></expr_list></add_op></p>
<p>+—————-+—– LL(1) table —–+<br>|                |     $|     (|     )|     +|     ,|     -|    :=|     ;|    ID|INTLIT| begin|   end|  read| write|<br>|<add_op>        |      |      |      |    20|      |    21|      |      |      |      |      |      |      |      |<br>|<expr_list>     |      |    11|      |      |      |      |      |      |    11|    11|      |      |      |      |<br>|<expr_tail>     |      |      |    13|      |    12|      |      |      |      |      |      |      |      |      |<br>|<expression>    |      |    14|      |      |      |      |      |      |    14|    14|      |      |      |      |<br>|<id_list>       |      |      |      |      |      |      |      |      |     8|      |      |      |      |      |<br>|<id_tail>       |      |      |    10|      |     9|      |      |      |      |      |      |      |      |      |<br>|<primary>       |      |    17|      |      |      |      |      |      |    18|    19|      |      |      |      |<br>|<primary_tail>  |      |      |    16|    15|    16|    15|      |    16|      |      |      |      |      |      |<br>|<program>       |      |      |      |      |      |      |      |      |      |      |     1|      |      |      |<br>|<statement>     |      |      |      |      |      |      |      |      |     5|      |      |      |     6|     7|<br>|<statement_list>|      |      |      |      |      |      |      |      |     2|      |      |      |     2|     2|<br>|<statement_tail>|      |      |      |      |      |      |      |      |     3|      |      |     4|     3|     3|<br>|<system_goal>   |      |      |      |      |      |      |      |      |      |      |    22|      |      |      |<br>+—————-+———————+</system_goal></statement_tail></statement_list></statement></program></primary_tail></primary></id_tail></id_list></expression></expr_tail></expr_list></add_op></p>
<p>Process syntax accept</p>
<p>```</p>
<h2 id="代碼"><a href="#代碼" class="headerlink" title="代碼"></a>代碼</h2><p>2014/6/1 修正 parsing 時的 lambda 問題。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HTMLProduction</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Production</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        <span class="built_in">string</span> 			LHS;</div><div class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; 	RHS;</div><div class="line">        <span class="keyword">int</span> 			label;</div><div class="line">        </div><div class="line">        Production(<span class="built_in">string</span> L = <span class="string">""</span>, <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; R = <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;()) &#123;</div><div class="line">            LHS = L;</div><div class="line">            RHS = R;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%s -&gt; "</span>, LHS.c_str());</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; RHS.size(); i++)</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%s"</span>, RHS[i].c_str());</div><div class="line">        &#125;</div><div class="line">&#125;;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grammar</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">string</span> 		lambda;</div><div class="line">        <span class="built_in">string</span> 						start_symbol;</div><div class="line">        <span class="built_in">vector</span>&lt;Production&gt; 			rules;</div><div class="line">        <span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; &gt; 	first_set;</div><div class="line">        <span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; &gt; 	follow_set;</div><div class="line">        <span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">bool</span>&gt; 			derives_lambda;</div><div class="line">        <span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="built_in">map</span>&lt;<span class="built_in">string</span>, Production&gt; &gt;	lltable;</div><div class="line">        </div><div class="line">        <span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">bool</span>&gt; mark_lambda();</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">fill_first_set</span><span class="params">()</span></span>;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">fill_follow_set</span><span class="params">()</span></span>;</div><div class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">isNonterminal</span><span class="params">(<span class="built_in">string</span> token)</span></span>;</div><div class="line">        <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; compute_first(<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; rhs);</div><div class="line">        <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; get_predict_set(Production p);</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">fill_lltable</span><span class="params">()</span></span>;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">lldriver</span><span class="params">(<span class="built_in">queue</span>&lt;<span class="built_in">string</span>&gt; tokens)</span></span>;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">const</span> <span class="built_in">string</span> Grammar::lambda(<span class="string">"l"</span>);</div><div class="line"></div><div class="line"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; Grammar::compute_first(<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; rhs) &#123;</div><div class="line">    <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; result;</div><div class="line">    <span class="keyword">size_t</span> i;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span>(rhs.size() == <span class="number">0</span> || rhs[<span class="number">0</span>] == Grammar::lambda) &#123;</div><div class="line">        result.insert(Grammar::lambda);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        result = first_set[rhs[<span class="number">0</span>]];</div><div class="line">        <span class="keyword">for</span>(i = <span class="number">1</span>; i &lt; rhs.size() &amp;&amp; </div><div class="line">            first_set[rhs[i<span class="number">-1</span>]].find(Grammar::lambda) != first_set[rhs[i<span class="number">-1</span>]].end(); i++) &#123;</div><div class="line">            <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; f = first_set[rhs[i]];</div><div class="line">            f.erase(Grammar::lambda);</div><div class="line">            result.insert(f.begin(), f.end());	</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(i == rhs.size() </div><div class="line">            &amp;&amp; first_set[rhs[i<span class="number">-1</span>]].find(Grammar::lambda) != first_set[rhs[i<span class="number">-1</span>]].end()) &#123;</div><div class="line">            result.insert(Grammar::lambda);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            result.erase(Grammar::lambda);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125; </div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * please call get_predict_set() after fill_follow_set() and fill_first_set()</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; Grammar::get_predict_set(Production p) &#123;</div><div class="line">    <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; result;</div><div class="line">    <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; rfirst;</div><div class="line">    </div><div class="line">    rfirst = compute_first(p.RHS);</div><div class="line">    <span class="keyword">if</span>(rfirst.find(Grammar::lambda) != rfirst.end()) &#123;</div><div class="line">        rfirst.erase(Grammar::lambda);</div><div class="line">        result.insert(rfirst.begin(), rfirst.end());</div><div class="line">        rfirst = follow_set[p.LHS];</div><div class="line">        result.insert(rfirst.begin(), rfirst.end());</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        result.insert(rfirst.begin(), rfirst.end());</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">void</span> Grammar::fill_lltable() &#123;</div><div class="line">    <span class="built_in">string</span>		A; <span class="comment">// nonterminal</span></div><div class="line">    Production 	p;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</div><div class="line">        p = rules[i];</div><div class="line">        A = p.LHS;</div><div class="line">        <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; predict_set = get_predict_set(p);</div><div class="line">        </div><div class="line">        <span class="keyword">for</span>(<span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;::iterator it = predict_set.begin();</div><div class="line">            it != predict_set.end(); it++) &#123;</div><div class="line">            assert(lltable[A].find(*it) == lltable[A].end());</div><div class="line">            lltable[A][*it] = p;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"><span class="keyword">bool</span> Grammar::isNonterminal(<span class="built_in">string</span> token) &#123;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> HTMLProduction</span></div><div class="line">    <span class="keyword">if</span>(token == Grammar::lambda)</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    <span class="keyword">if</span>(token[<span class="number">0</span>] == <span class="string">'&lt;'</span> &amp;&amp; token[token.length() - <span class="number">1</span>] == <span class="string">'&gt;'</span>)</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">    <span class="keyword">if</span>(token == Grammar::lambda)</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; token.length(); i++) &#123;</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">isupper</span>(token[i]))</div><div class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">&#125;</div><div class="line"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">bool</span>&gt; Grammar::mark_lambda() &#123;</div><div class="line">    <span class="keyword">bool</span> 				rhs_derives_lambda;</div><div class="line">    <span class="keyword">bool</span> 				changes;</div><div class="line">    Production 			p;</div><div class="line">    </div><div class="line">    derives_lambda.clear();</div><div class="line">    </div><div class="line">    <span class="comment">/* initially, nothing is marked. */</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</div><div class="line">        derives_lambda[rules[i].LHS] = <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">do</span> &#123;</div><div class="line">        changes = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</div><div class="line">            p = rules[i];</div><div class="line">            <span class="keyword">if</span>(!derives_lambda[p.LHS]) &#123;</div><div class="line">                <span class="keyword">if</span>(p.RHS.size() == <span class="number">0</span> || p.RHS[<span class="number">0</span>] == Grammar::lambda) &#123;</div><div class="line">                    changes = derives_lambda[p.LHS] = <span class="literal">true</span>;</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">/* does each part of RHS derive lambda ? */</span></div><div class="line">                rhs_derives_lambda = derives_lambda[<span class="built_in">string</span>(p.RHS[<span class="number">0</span>])];</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">size_t</span> j = <span class="number">1</span>; j &lt; p.RHS.size(); j++) &#123;</div><div class="line">                    rhs_derives_lambda &amp;= derives_lambda[p.RHS[j]];</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>(rhs_derives_lambda) &#123;</div><div class="line">                    changes = <span class="literal">true</span>;</div><div class="line">                    derives_lambda[p.LHS] = <span class="literal">true</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">while</span>(changes);</div><div class="line">    <span class="keyword">return</span> derives_lambda;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Grammar::fill_first_set() &#123;</div><div class="line">    </div><div class="line">    <span class="built_in">string</span> 		A; <span class="comment">// nonterminal</span></div><div class="line">    <span class="built_in">string</span> 		a; <span class="comment">// terminal</span></div><div class="line">    Production 	p;</div><div class="line">    <span class="keyword">bool</span> 		changes;</div><div class="line">        </div><div class="line">    mark_lambda();</div><div class="line">    first_set.clear();</div><div class="line">    </div><div class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</div><div class="line">        A = rules[i].LHS;</div><div class="line">        <span class="keyword">if</span>(derives_lambda[A])</div><div class="line">            first_set[A].insert(Grammar::lambda);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> j = <span class="number">0</span>; j &lt; rules[i].RHS.size(); j++) &#123;</div><div class="line">            a = rules[i].RHS[j];</div><div class="line">            <span class="keyword">if</span>(!isNonterminal(a)) &#123;</div><div class="line">                <span class="keyword">if</span>(a != Grammar::lambda)</div><div class="line">                    first_set[a].insert(a);</div><div class="line">                <span class="keyword">if</span>(j == <span class="number">0</span>) &#123; <span class="comment">// A -&gt; aXX</span></div><div class="line">                    first_set[rules[i].LHS].insert(a);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">do</span> &#123;</div><div class="line">        changes = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</div><div class="line">            p = rules[i];</div><div class="line">            <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; rfirst = compute_first(p.RHS);</div><div class="line">            <span class="keyword">size_t</span> oldsize = first_set[p.LHS].size();</div><div class="line">            first_set[p.LHS].insert(rfirst.begin(), rfirst.end());</div><div class="line">            <span class="keyword">size_t</span> newsize = first_set[p.LHS].size();</div><div class="line">            <span class="keyword">if</span>(oldsize != newsize)</div><div class="line">                changes = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">while</span>(changes);</div><div class="line">&#125; </div><div class="line"></div><div class="line"><span class="keyword">void</span> Grammar::fill_follow_set() &#123;</div><div class="line">    <span class="built_in">string</span> 	A, B; <span class="comment">// nonterminal</span></div><div class="line">    Production 	p;</div><div class="line">    <span class="keyword">bool</span> 	changes;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</div><div class="line">        A = rules[i].LHS;</div><div class="line">        follow_set[A].clear();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    follow_set[start_symbol].insert(Grammar::lambda);</div><div class="line">        </div><div class="line">    <span class="keyword">do</span> &#123;</div><div class="line">        changes = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</div><div class="line">            <span class="comment">/* A -&gt; a B b</span></div><div class="line"><span class="comment">			 * I.e. for each production and each occurrence</span></div><div class="line"><span class="comment">			 * of a nonterminal in its right-hand side. </span></div><div class="line"><span class="comment">			 */</span></div><div class="line">            p = rules[i];</div><div class="line">            A = p.LHS;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">size_t</span> j = <span class="number">0</span>; j &lt; p.RHS.size(); j++) &#123;</div><div class="line">                B = p.RHS[j];</div><div class="line">                <span class="keyword">if</span>(isNonterminal(B)) &#123;</div><div class="line">                    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; beta(p.RHS.begin() + j + <span class="number">1</span>, p.RHS.end());</div><div class="line">                    <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; rfirst = compute_first(beta);</div><div class="line">                    <span class="keyword">size_t</span> oldsize = follow_set[B].size();</div><div class="line">                    </div><div class="line">                    <span class="keyword">if</span>(rfirst.find(Grammar::lambda) == rfirst.end()) &#123;</div><div class="line">                        follow_set[B].insert(rfirst.begin(), rfirst.end());	</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        rfirst.erase(Grammar::lambda);</div><div class="line">                        follow_set[B].insert(rfirst.begin(), rfirst.end());	</div><div class="line">                        rfirst = follow_set[A];</div><div class="line">                        follow_set[B].insert(rfirst.begin(), rfirst.end());</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">size_t</span> newsize = follow_set[B].size();			</div><div class="line">                    <span class="keyword">if</span>(oldsize != newsize)</div><div class="line">                        changes = <span class="literal">true</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">while</span>(changes);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Grammar::lldriver(<span class="built_in">queue</span>&lt;<span class="built_in">string</span>&gt; tokens) &#123;</div><div class="line">    <span class="built_in">stack</span>&lt;<span class="built_in">string</span>&gt; 	stk;</div><div class="line">    <span class="built_in">string</span> 			X;</div><div class="line">    <span class="built_in">string</span>			a;</div><div class="line">    Production		p;</div><div class="line">    <span class="comment">/* Push the Start Symbol onto an empty stack */</span></div><div class="line">    stk.push(start_symbol);</div><div class="line">    </div><div class="line">    <span class="keyword">while</span>(!stk.empty() &amp;&amp; !tokens.empty()) &#123;</div><div class="line">        X = stk.top();</div><div class="line">        a = tokens.front();</div><div class="line">        <span class="comment">// cout &lt;&lt; X &lt;&lt; " " &lt;&lt; a &lt;&lt; endl;</span></div><div class="line">        <span class="keyword">if</span>(isNonterminal(X) &amp;&amp; lltable[X].find(a) != lltable[X].end()) &#123;</div><div class="line">            p = lltable[X][a];</div><div class="line">            stk.pop();</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = p.RHS.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">                <span class="keyword">if</span>(p.RHS[i] == Grammar::lambda)</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                stk.push(p.RHS[i]);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(X == a) &#123;</div><div class="line">            stk.pop();</div><div class="line">            tokens.pop();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(lltable[X].find(Grammar::lambda) != lltable[X].end()) &#123;</div><div class="line">            stk.pop();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">/* Process syntax error. */</span></div><div class="line">            <span class="built_in">puts</span>(<span class="string">"Bad!"</span>);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">while</span>(!stk.empty()) &#123;</div><div class="line">        X = stk.top();</div><div class="line">        <span class="keyword">if</span>(lltable[X].find(Grammar::lambda) != lltable[X].end())</div><div class="line">            stk.pop();</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(tokens.size() == <span class="number">0</span> &amp;&amp; stk.size() == <span class="number">0</span>)</div><div class="line">        <span class="built_in">puts</span>(<span class="string">"Good"</span>);</div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="built_in">puts</span>(<span class="string">"Bad!"</span>);</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">queue</span>&lt;<span class="built_in">string</span>&gt; getTokens(<span class="keyword">char</span> s[]) &#123;</div><div class="line">    <span class="function"><span class="built_in">stringstream</span> 	<span class="title">sin</span><span class="params">(s)</span></span>;</div><div class="line">    <span class="built_in">queue</span>&lt;<span class="built_in">string</span>&gt; 	tokens;</div><div class="line">    <span class="built_in">string</span>			token;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">sin</span> &gt;&gt; token)</div><div class="line">        tokens.push(token);</div><div class="line">    <span class="keyword">return</span> tokens;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">parsingProduction</span><span class="params">(<span class="built_in">string</span> r, Grammar &amp;g)</span> </span>&#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> HTMLProduction</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> 		production_label = <span class="number">0</span>;</div><div class="line">    <span class="function"><span class="built_in">stringstream</span> 	<span class="title">sin</span><span class="params">(r)</span></span>;</div><div class="line">    <span class="built_in">string</span> 			lhs, foo;</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; 	tokens;</div><div class="line">    <span class="built_in">sin</span> &gt;&gt; lhs &gt;&gt; foo;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">sin</span> &gt;&gt; foo)</div><div class="line">        tokens.push_back(foo);</div><div class="line">    <span class="function">Production <span class="title">p</span><span class="params">(lhs, tokens)</span></span>;</div><div class="line">    p.label = ++production_label;</div><div class="line">    g.rules.push_back(p);</div><div class="line"><span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">    <span class="function"><span class="built_in">string</span> <span class="title">div</span><span class="params">(<span class="string">"-&gt;"</span>)</span></span>;</div><div class="line">    <span class="keyword">size_t</span> found = r.find(div);</div><div class="line">    <span class="keyword">if</span>(found != <span class="built_in">std</span>::<span class="built_in">string</span>::npos) &#123;</div><div class="line">        <span class="built_in">string</span> rhs = r.substr(found + div.length());</div><div class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; tokens;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rhs.size(); i++)</div><div class="line">            tokens.push_back(rhs.substr(i, <span class="number">1</span>));</div><div class="line">        Production p(r.substr(0, found), tokens);</div><div class="line">        g.rules.push_back(p);</div><div class="line">    &#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">&#125; </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//freopen("input.txt", "r+t", stdin);</span></div><div class="line">    <span class="comment">//freopen("output.txt", "w+t", stdout); </span></div><div class="line">    </div><div class="line">    <span class="keyword">char</span> in[<span class="number">1024</span>];</div><div class="line">    <span class="keyword">while</span>(gets(in)) &#123;</div><div class="line">        Grammar g;</div><div class="line">        parsingProduction(in, g);</div><div class="line">        <span class="keyword">while</span>(gets(in) &amp;&amp; in[<span class="number">0</span>] != <span class="string">'\0'</span>) &#123;</div><div class="line">            parsingProduction(in, g);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> HTMLProduction</span></div><div class="line">        g.start_symbol = <span class="string">"&lt;system_goal&gt;"</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">        g.start_symbol = <span class="string">"S"</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">        </div><div class="line">        g.fill_first_set();</div><div class="line">        g.fill_follow_set();</div><div class="line">        g.fill_lltable();</div><div class="line">        </div><div class="line">        <span class="built_in">puts</span>(<span class="string">"+----------------+----- First set -----+"</span>);</div><div class="line">        <span class="keyword">for</span>(<span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; &gt;::iterator it = g.first_set.begin();</div><div class="line">            it != g.first_set.end(); it++) &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"|%-16s| &#123;"</span>, it-&gt;first.c_str());</div><div class="line">            <span class="keyword">for</span>(<span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;::iterator jt = it-&gt;second.begin();</div><div class="line">                jt != it-&gt;second.end(); jt++) &#123;</div><div class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="string">" "</span> &lt;&lt; *jt;</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">puts</span>(<span class="string">" &#125;"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">puts</span>(<span class="string">"+----------------+---------------------+\n"</span>);</div><div class="line">        <span class="built_in">puts</span>(<span class="string">"+----------------+----- Follow set -----+"</span>);</div><div class="line">        <span class="keyword">for</span>(<span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; &gt;::iterator it = g.follow_set.begin();</div><div class="line">            it != g.follow_set.end(); it++) &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"|%-16s| &#123;"</span>, it-&gt;first.c_str());</div><div class="line">            <span class="keyword">for</span>(<span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;::iterator jt = it-&gt;second.begin();</div><div class="line">                jt != it-&gt;second.end(); jt++) &#123;</div><div class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="string">" "</span> &lt;&lt; *jt;</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">puts</span>(<span class="string">" &#125;"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">puts</span>(<span class="string">"+----------------+---------------------+\n"</span>);</div><div class="line">        <span class="built_in">puts</span>(<span class="string">"+----------------+----- LL(1) table -----+"</span>);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"|%-16s|"</span>, <span class="string">""</span>);			</div><div class="line">        <span class="keyword">for</span>(<span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; &gt;::iterator jt = g.first_set.begin();</div><div class="line">                jt != g.first_set.end(); jt++) &#123;</div><div class="line">            <span class="built_in">string</span> A = jt-&gt;first;</div><div class="line">            <span class="keyword">if</span>(g.isNonterminal(A))</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%6s|"</span>, A.c_str());</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">        <span class="keyword">for</span>(<span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="built_in">map</span>&lt;<span class="built_in">string</span>, Production&gt; &gt;::iterator it = g.lltable.begin();</div><div class="line">            it != g.lltable.end(); it++) &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"|%-16s|"</span>, it-&gt;first.c_str());</div><div class="line">            <span class="keyword">for</span>(<span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; &gt;::iterator jt = g.first_set.begin();</div><div class="line">                jt != g.first_set.end(); jt++) &#123;</div><div class="line">                <span class="built_in">string</span> A = jt-&gt;first;</div><div class="line">                <span class="keyword">if</span>(g.isNonterminal(A))</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">if</span>(it-&gt;second.find(A) == it-&gt;second.end()) </div><div class="line">                    <span class="built_in">printf</span>(<span class="string">"%6s|"</span>, <span class="string">""</span>);</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    <span class="built_in">printf</span>(<span class="string">"%6d|"</span>, it-&gt;second[A].label);</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">puts</span>(<span class="string">"+----------------+---------------------+\n"</span>);</div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> HTMLProduction</span></div><div class="line">        gets(in);</div><div class="line">        g.lldriver(getTokens(in));</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="備註"><a href="#備註" class="headerlink" title="備註"></a>備註</h1><p>要學會更多，請修 <code>計算理論</code> 這門課程。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/new-methodology" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/04/21/lesson/new-methodology/" class="article-date">
  <time datetime="2014-04-21T08:09:04.000Z" itemprop="datePublished">2014-04-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/04/21/lesson/new-methodology/">軟體開發方法論(翻譯部分內容)</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/04/21/lesson/new-methodology/" data-id="cksb6ga5o02end8vn0g5zh0ub" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/04/21/lesson/new-methodology/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/軟體開發/">軟體開發</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="長篇大論"><a href="#長篇大論" class="headerlink" title="長篇大論"></a>長篇大論</h1><p>只求軟體開發的工程方法，最近上敏捷方法，教授開始講到了始祖 …</p>
<p>於是上演了輪番翻譯的戲碼，讓各種同學參與這份大型工程，關於翻譯的同時，深刻地理解到這也是為什麼無法接觸國外的最新資訊啊，曲解、誤解、亂解 …</p>
<blockquote>
<p>我的語言記憶體如此小，卻搭載世界最複雜的語言。</p>
</blockquote>
<h2 id="序"><a href="#序" class="headerlink" title="序"></a>序</h2><blockquote><p>In the past few years there’s been a blossoming of a new style of software methodology - referred to as agile methods. Alternatively characterized as an antidote to bureaucracy or a license to hack they’ve stirred up interest all over the software landscape. In this essay I explore the reasons for agile methods, focusing not so much on their weight but on their adaptive nature and their people-first orientation. </p>
<footer><strong>Martin Fowler</strong><cite><a href="http://www.martinfowler.com/articles/newMethodology.html" target="_blank" rel="external">The New Methodology</a></cite></footer></blockquote>
<p>Probably the most noticeable change to software process thinking in the last few years has been the appearance of the word ‘agile’. We talk of agile software methods, of how to introduce agility into a development team, or of how to resist the impending storm of agilists determined to change well-established practices.</p>
<p>也許在這過去幾年最引人注目對軟件過程的思考的改變 - “敏捷 agile” 一詞的出現。我們將談論如何將敏捷軟體方法(agile software method)引入到開發團隊，或者如何抗拒即將到來的敏捷提倡者所帶來的風暴，這風暴將改變原先建立的好的業界實踐方法。</p>
<p>This new movement grew out of the efforts of various people who dealt with software process in the 1990s, found them wanting, and looked for a new approach to software process. Most of the ideas were not new, indeed many people believed that much successful software had been built that way for a long time. There was, however, a view that these ideas had been stifled and not been treated seriously enough, particularly by people interested in software process.</p>
<p>這新運動來自于 1990 年起不同人對於軟體程序的努力，他們發現和找到一個新的軟體程序。大多數敏捷方法的想法並不新，大多數人認為很多成功的軟件本來就有內置這種方式很久了，的確是有的，然而有一觀點指出，這些想法對於對軟體過程感興趣的人眼中並沒有受到重視，甚至被受到抑制。</p>
<p>This essay was originally part of this movement. I originally published it in July 2000. I wrote it, like most of my essays, as part of trying to understand the topic. At that time I’d used Extreme Programming for several years after I was lucky enough to work with Kent Beck, Ron Jeffries, Don Wells, and above all the rest of the Chrysler C3 team in 1996. I had since had conversations and read books from other people who had similar ideas about software process, but had not necessarily wanted to take the same path as Extreme Programming. So in the essay I wanted to explore what were the similarities and differences between these methodologies.</p>
<p>這篇文章也是新運動的起源一部份，最初發表于 2000 年 7 月。作為嘗試了解這文章一部份，您必須知曉這篇文章的風格如同其他大多數我寫的文章。在很幸運地與 Kent Beck, Ron Jeffries, Don Wells 共事後，我已經使用極限編程 (Extreme Programming) 好幾年。從 1996 年的 Chrysler C3 team 那時。我有機會與別人互相交流資訊和書籍來得到他們對於軟體過程中的類似想法，但即使是極限編程 (Extreme Programming) 也沒有一定要採用一樣的走法，所以在這篇文章中，我想要探索這些方法間的異同。</p>
<p>My conclusion then, which I still believe now, is that there were some fundamental principles that united these methodologies, and these principles were a notable contrast from the assumptions of the established methodologies.</p>
<p>以我的話來說，我至今仍相信那些方法一定有一些共同的基本原則，這些原則可能會從原本既有的(主流)方法假設中有明顯地對比。</p>
<p>This essay has continued to be one of the most popular essays on my website, which means I feel somewhat bidden to keep it up to date. In its original form the essay both explored these differences in principles and provided a survey of agile methods as I then understood them. Too much has happened with agile methods since for me to keep up with the survey part, although I do provide some links to continue your explorations. The differences in principles still remain, and this discussion I’ve kept.</p>
<p>這篇文章將會一直是一篇這個網站最熱門的文章，也意味者我會感到使命去保持這篇文章的更新。在文章原始架構中，會探討我所了解的這些原則的差異和提供敏捷方法的調查。當我在調查的同時，敏捷方法已經發生了變動，但仍我也提供一些鏈結供您探索，這些原則的差異和討論內容仍會保留在這篇文章中。</p>
<p>Most software development is a chaotic activity, often characterized by the phrase “code and fix”. The software is written without much of an underlying plan, and the design of the system is cobbled together from many short term decisions. This actually works pretty well as the system is small, but as the system grows it becomes increasingly difficult to add new features to the system. Furthermore bugs become increasingly prevalent and increasingly difficult to fix. A typical sign of such a system is a long test phase after the system is “feature complete”. Such a long test phase plays havoc with schedules as testing and debugging is impossible to schedule. </p>
<p>大多數軟體開發是一個混亂的開始，常常以一句話代以概括 ”撰寫！修復！“，這些軟體在撰寫時不用事先有基礎的計劃，也不用系統架構，將由短期項目討論就可以拼湊起來。這確切在系統很小時可以運作，但當系統越大時將會變得相當困難去增加新的功能。此外，BUG 也會越來越普遍見到，且越來越難除錯。這典型系統是在功能齊備後，才經由長時間的測試階段。這麼長時間的測試階段將嚴重破壞測試和除錯的行程，使得行程根本無法安排。試階段起著嚴重破壞的時間表為測試和調試是不可能的安排。</p>
<p>The original movement to try to change this introduced the notion of methodology. These methodologies impose a disciplined process upon software development with the aim of making software development more predictable and more efficient. They do this by developing a detailed process with a strong emphasis on planning inspired by other engineering disciplines - which is why I like to refer to them as engineering methodologies (another widely used term for them is plan-driven methodologies). </p>
<p>起源運動將要改變這種方法的概念，這些方法論所施加的紀律，將協助軟體開發變得更可預測和更有效率。他們將透過製定詳細的過程，這些過程特別強調設計，靈感來自于其他工程學門- 這就是為什麼我喜歡稱呼它們為 ”工程方法 enginerring methodologies“ (對於他們來說，另一個廣泛使用的術語為 “計劃驅動方法 plan-driven methodologies”)</p>
<p>Engineering methodologies have been around for a long time. They’ve not been noticeable for being terribly successful. They are even less noted for being popular. The most frequent criticism of these methodologies is that they are bureaucratic. There’s so much stuff to do to follow the methodology that the whole pace of development slows down. </p>
<p>工程方法已經存有一段歷史，它們都沒有被注目那背後可怕的成功，它們相當少被認為是受流行的，常見的批評為 ”它們是官僚政治的“ // 相當死板的 ？ 。有相當多的項目都遵循這套方法論使用緩慢的發展步伐。</p>
<p><strong> Agile methodologies </strong> developed as a reaction to these methodologies. For many people the appeal of these agile methodologies is their reaction to the bureaucracy of the engineering methodologies. These new methods attempt a useful compromise between no process and too much process, providing just enough process to gain a reasonable payoff. </p>
<p>敏捷方法的發展就是反映這些工程方法論，對于大多數的人而言，敏捷方法的吸引力是反映出工程方法的官僚主義，這些新方法是在沒有進展和太多進展中的折衷妥協方案，提供一種恰當的過程來獲得合理回饋。</p>
<p>The result of all of this is that agile methods have some significant changes in emphasis from engineering methods. The most immediate difference is that they are less document-oriented, usually emphasizing a smaller amount of documentation for a given task. In many ways they are rather code-oriented: following a route that says that the key part of documentation is source code. </p>
<p>這一切的結過是，敏捷方法從工程方法中有顯的改變。最明顯的差異是少寫文件(文件導向)，通常強調少量文件的工作，在許多說法上，它們更偏向代碼導向(code-oriented: 文件的關鍵部分是源代碼 source code)</p>
<h1 id="糟透的軟體開發"><a href="#糟透的軟體開發" class="headerlink" title="糟透的軟體開發"></a>糟透的軟體開發</h1><p>在土木工程中，建造一個橋來說，通常在設計草圖完成後，即使換了別的公司繼續接按下去做，一樣能按照這個設計草圖完成。如果在施工過程中遇到問題，通常問題也不會太難，而且非常容易被解決。</p>
<p>在了解這些設計草圖後，可以發現勞心者和勞力者的工作是分開的，設計由專家耗費心力完成，而實作能由工人來按照草圖，因此這些設計草圖是確保工人們能看得懂，但是在軟體工程中，大部分都是勞心者和勞力者集一人之中。</p>
<p>施工是一個相當耗費成本的工作，在早期的軟體工程開發專家，希望能將土木工程的方法轉移到軟體工程上。讓專家進行設計，再讓低成本的工作人員來完成實作，設計費用通常比實作費用來的低，工程師仍有高低薪之分，新一代的低薪工程師呢！</p>
<p>專家寫出來的設計草圖，要讓 programmer 看得懂，通常是非常困難的。即使是 UML 圖，雖然在紙(草圖)上看起來相當不錯，但是實作上的問題卻相當多，土木工程的設計圖可以經過數學模型去測試，但是軟體工程的設計圖只能由人腦去找到邏輯BUG，即使是設計熟練的專家，要設計出不會有實作問題的草圖也是常發生的。</p>
<p>接續著剛剛討論的造橋問題，設計費用只占了全部花費的十分之一，按照草圖寫 code 是相當簡單的，根據 McConnell 調查大型專案，只有 15% 的成本進行程式撰寫和測試(這裡我們需要勞力成本比例越高越好)。即使把其他成本混在一起，設計仍占了 50% 的成本比例。軟體工程只是工程分枝中之一，這其中一定有蹊蹺。</p>
<p>結論</p>
<ul>
<li>軟體的建造相當便宜，甚至於免費(只淤需要電腦和編譯器，沒有實體。)</li>
<li>軟體受設計影響，因此需要有創造力和有天賦的人。</li>
<li>俱有創新的程序不容易去規劃，可預測的性質甚至變成不可能。</li>
<li>我們需要不同於傳統工程的方法，來解決這詭異的軟體工程的開發程序。</li>
</ul>
<p>常常有開發者收到客戶不斷地改變需求，但是改變需求是常態，但是對於開發者而言卻是想不透的謎。這表示當初需求並沒有弄完整，但是也不能說像客戶簽訂契約——表示在軟體完成前，需求都不會改變。需求改變是很正常的，這客戶來說這個契約反而不合理。</p>
<p>按需求收費，加什麼功能要多少錢？估算收費也是不好量化，也會根據產品使用的方式和使用者有關，因此品質的水準與費用是不好預估。客戶以為“軟”體容易修改，但並不是每個需求都容易修改，通常會耗費大量的時間去滿足客戶的需求。</p>
<p>如果需求不穩定，就得不到可預測的計劃去完成軟體。</p>
<h1 id="真的不可預測？"><a href="#真的不可預測？" class="headerlink" title="真的不可預測？"></a>真的不可預測？</h1><p>在 NASA 太空軟體開發中，他們的計劃是可以預測的，但這也只是一個特別的例子，主要原因是長期時間，龐大的團隊，穩定的需求。</p>
<p>更可怕的是，如果客戶需求不穩定，卻告知有可預測的計劃，這樣自欺欺人的行為相當令人詬病。</p>
<p>”可預測“是令人相當渴望的，這導致一開始擬定的計劃越飄越遠，最後計劃將會分崩離析。</p>
<p>按照方法論運行總是美好的，但是在軟體開發上必須要捨棄掉，但這樣的舉動相當困難，要捨棄一直以來處理事情的方式，但也並不是讓事情處理變得無法控制的混沌，捨棄“預測”吧！</p>
<h1 id="控制-“不可預測”程序"><a href="#控制-“不可預測”程序" class="headerlink" title="控制 “不可預測”程序"></a>控制 “不可預測”程序</h1><p>使用迭代方式，並且將計劃越短越好，看起來就是多方面失敗的開始，但卻有機會看來進步的地方，當計劃越短，就能越早知道反饋(feedback)。</p>
<p>文件可以隱藏缺失，沒有經過測試將會有更多的缺失。</p>
<p>XP 一周或兩周，SCRUM 一個月之類的，越熟練則會越短時間。</p>
<p>=====</p>
<p>並不是每個工程師都像零件，換個人就可以繼續運行。</p>
<p>不可更換的人零件都跑了，也就是最有創意的人力都走了，可更換的人卻留下了。</p>
<h1 id="Programmer-是有責任的專業人員？"><a href="#Programmer-是有責任的專業人員？" class="headerlink" title="Programmer 是有責任的專業人員？"></a>Programmer 是有責任的專業人員？</h1><p>早期是工廠的運行模式，希望能讓工人多做一點事情，來讓成本降低。</p>
<p>每個 programmer 是獨特的，產出的代碼也都不同，每一個人的創意不同，把人當資源就錯了。</p>
<p>施工和設計能不能分開？施工只是由編譯器來，因此軟體全是文創業，算是設計類型的職業。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/categories/學校課程/page/10/">&laquo; Prev</a><a class="page-number" href="/categories/學校課程/">1</a><span class="space">&hellip;</span><a class="page-number" href="/categories/學校課程/page/9/">9</a><a class="page-number" href="/categories/學校課程/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/categories/學校課程/page/12/">12</a><a class="extend next" rel="next" href="/categories/學校課程/page/12/">Next &raquo;</a>
    </nav>
  
</section>
          
          
            <aside id="sidebar">
  <!-- <div id="ukagaka_panel"></div> -->
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">115</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算機圖學/">計算機圖學</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/">工作應用</a><span class="category-list-count">35</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Java/">Java</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Meme/">Meme</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/可持久化/">可持久化</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/鬼故事/">鬼故事</a><span class="category-list-count">12</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">633</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">483</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">77</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">45</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2021/08/14/work/company-ghost-story-12/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 12</a>
          </li>
        
          <li>
            <a class="text" href="/2021/07/29/java/java-jni-tls-error-2/">
              
                <i class="icon-file-o"></i> 
              
            Java JNI GC Thread Error (EINVAL)</a>
          </li>
        
          <li>
            <a class="text" href="/2021/07/29/work/company-ghost-story-11/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 11</a>
          </li>
        
          <li>
            <a class="text" href="/2021/06/21/diary-202106/">
              
                <i class="icon-file-o"></i> 
              
            疫情下的工作變化</a>
          </li>
        
          <li>
            <a class="text" href="/2021/06/21/work/company-ghost-story-10/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 10</a>
          </li>
        
          <li>
            <a class="text" href="/2021/05/30/diary-202105/">
              
                <i class="icon-file-o"></i> 
              
            前思後想 新居落成</a>
          </li>
        
          <li>
            <a class="text" href="/2021/05/30/java/java-memory-optimization-2/">
              
                <i class="icon-file-o"></i> 
              
            Java 優化內存使用 組合篇</a>
          </li>
        
          <li>
            <a class="text" href="/2021/05/30/java/java-memory-optimization-1/">
              
                <i class="icon-file-o"></i> 
              
            Java 優化內存使用 結構篇</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/diary-202101/">
              
                <i class="icon-file-o"></i> 
              
            二八進展</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-globl-var/">
              
                <i class="icon-file-o"></i> 
              
            Global Variable</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
  
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2021 Shiang-Yun Yang 
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>