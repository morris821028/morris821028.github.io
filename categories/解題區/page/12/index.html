<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Category: 解題區 | Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Morris&#39; Blog">
<meta property="og:url" content="http://morris821028.github.io/categories/解題區/page/12/index.html">
<meta property="og:site_name" content="Morris&#39; Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris&#39; Blog">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
  <link rel="import" href="/bower_components/app-layout/app-layout.html"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          
          <section id="main">
  
    <article id="post-zj-b413" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/29/zj-b413/" class="article-date">
  <time datetime="2015-06-28T23:09:51.000Z" itemprop="datePublished">2015-06-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/29/zj-b413/">b413. 虛擬女友</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/29/zj-b413/" data-id="ckpaivca100amn8vn2wepdsph" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/29/zj-b413/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/并查集/">并查集</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>曾經有一部採訪影片《BBC 紀錄片：別和日本人談性 No Sex. We’re Japanese.》在網路上流傳，其中有一段談到虛擬遊戲中的生活，不少男性以遊戲中的女角發生關係，其中以一款遊戲「Love Plus」為大宗，即使是擁有現實和虛擬的生活，若要選擇其中一方站，不少男性仍然「我選擇死亡」回答。</p>
<p>現在先不解決男女雙方的問題、在彼此關係上要如何運作，如何回到早些年沒有遊戲機、沒有網路、更沒有虛擬女友的交際生活，只有同性朋友要怎麼交流呢？於是有一場專門為這些男性舉行的一場交友會，規則如下所述：</p>
<ul>
<li>一開始全場男性都彼此不認識</li>
<li>每一個男性分別喜歡各自的虛擬女友 (可以是同一個)</li>
<li>每一個時刻，其中兩個男性會因談論遊戲而成為朋友</li>
<li>自己朋友的朋友也會成為朋友</li>
<li>如果朋友的虛擬女友的類型不同，他們有可能會因偏好女友類型不同而爭吵，稱為不穩定對。</li>
</ul>
<p>請問每一個時刻下，有多少穩定對朋友。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line"></span><br><span class="line">3 2</span><br><span class="line">1 2 1</span><br><span class="line">1 2</span><br><span class="line">2 3</span><br><span class="line"></span><br><span class="line">4 4</span><br><span class="line">1 2 2 1</span><br><span class="line">1 2</span><br><span class="line">2 3</span><br><span class="line">1 3</span><br><span class="line">2 4</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>IPSC 2015 F 那一題發生於男女雙方都會進行聯集，而這一題只有男方會進行聯集。</p>
<p>合併兩團男時，只有下標 (女友類型) 相同會成為穩定對，可以利用合併排序來完成，能發生合併表示男的彼此之間不認識，只要考慮有多少女方相同即可。每一次將小堆合併到大堆中，由於要計數合併複雜度需要 <span>$O(min(|A|, |B|) \times \log N)$</span><!-- Has MathJax -->，若搭配 hash 可以降到 <span>$O(min(|A|, |B|)$</span><!-- Has MathJax -->。一般并查集 joint 複雜度為 <span>$O(1)$</span><!-- Has MathJax -->，整體操作只需要 <span>$O(N)$</span><!-- Has MathJax -->，但為了要計數，整體的複雜度為 <span>$O(N \log N)$</span><!-- Has MathJax -->。</p>
<p>可以選擇合併排序來完成，每一次把兩堆的女方列出來，把兩堆相同類型的次數相乘，列出來可以循序做，或者是串列完成，每一次保證堆裡面的女方順序是由小排到大，合併複雜度就為 <span>$O(|A| + |B|)$</span><!-- Has MathJax -->，均攤下複雜度為 <span>$O(N \log N)$</span><!-- Has MathJax -->，當測資不夠隨機複雜度會掉到 <span>$O(N^2)$</span><!-- Has MathJax -->，情況是每一次只把大小為 1 的堆合併到大小 i-1 的堆。</p>
<p>在測資隨機生成下，第二種作法會來得比第一種快。第一種做法要搭配 <code>ordered_map</code> 或者是 <code>unordered_map</code>，寫起來會比較不方便。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">65536</span>;</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; son[MAXN];</span><br><span class="line"><span class="keyword">int</span> parent[MAXN], A[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, n, m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span> (testcase--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;A[i]);</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> tot_pair = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> x, y;</span><br><span class="line">        map&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;, <span class="keyword">int</span> &gt; R;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            parent[i] = i;</span><br><span class="line">            son[i].<span class="built_in">resize</span>(<span class="number">1</span>, i);</span><br><span class="line">            R[pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;(i, A[i])] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;y);</span><br><span class="line">            x--, y--;</span><br><span class="line">            x = parent[x], y = parent[y];</span><br><span class="line">            <span class="keyword">if</span> (x != y) &#123; <span class="comment">// merge small to large</span></span><br><span class="line">                <span class="keyword">if</span> (son[x].<span class="built_in">size</span>() &gt; son[y].<span class="built_in">size</span>())</span><br><span class="line">                    <span class="built_in">swap</span>(x, y);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e: son[x]) &#123;</span><br><span class="line">                    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">t</span><span class="params">(parent[e], A[e])</span></span>;</span><br><span class="line">                    R[t]--;</span><br><span class="line">                    <span class="keyword">if</span> (R[t] == <span class="number">0</span>)  R.<span class="built_in">erase</span>(t);</span><br><span class="line">                    parent[e] = y;</span><br><span class="line">                    son[y].<span class="built_in">push_back</span>(e);</span><br><span class="line">                    tot_pair += R[pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;(parent[e], A[e])];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e: son[x])</span><br><span class="line">                    R[pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;(parent[e], A[e])]++;</span><br><span class="line">                son[x].<span class="built_in">clear</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, tot_pair);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-zj-b416" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/27/zj-b416/" class="article-date">
  <time datetime="2015-06-27T13:34:13.000Z" itemprop="datePublished">2015-06-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/27/zj-b416/">b416. 誤會妹子序列</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/27/zj-b416/" data-id="ckpaivca100apn8vn648k9f4i" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/27/zj-b416/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BIT/">BIT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/可持久化/">可持久化</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/掃描線/">掃描線</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/莫隊算法/">莫隊算法</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>在 2015 年 6 月的 Facebook 上，不少以「靠北」為前綴命名的粉絲頁面，就如 靠北工程師 為例，不少業界工程師匿名在上面抱怨工作過時、主管、生活 … 等。突然有一篇 #靠北工程師7257 抱怨著編程競賽的零零種種，從回應中能明白存在業界工程師不清楚編程競賽，以 UI 介面、cmd 指令 … 等方式理解比賽的目標、運行。</p>
<p>網路處處有答案，演算法和資料結構到底重不重要？抄下來能用就行，大部分的要求是不講求效率的，但對於曾經在編程競賽待過一陣子的小夥伴而言，看到他們的理解方式開始感到憤憤不平，進行了一陣子的爭吵。</p>
<p>過一陣子，大批的學生開始進入 靠北工程師 裡發文，開始爭論學校、系所哪個是比較有未來的，突然間有一位資管系的同學發問這一道算法題 ‪#‎靠北工程師7780‬ ，結果一不小心就看錯題目，把種類數誤看成個數，於是討論了不少其他的算法來完成，現在就把這個問題交給你。</p>
<p>用各種算法解決這個誤解的題目。</p>
<h3 id="問題描述"><a href="#問題描述" class="headerlink" title="問題描述"></a>問題描述</h3><p>Autumn 和 Bakser 又在研究 Gty 的妹子序列了！</p>
<p>但他們遇到了一個難題，對於一段妹子們，他們想讓你幫忙求出這之內美麗度 <span>$s_i \in [a, b]$</span><!-- Has MathJax --> 的妹子個數。為了方便，我們規定妹子們的美麗度全都在 <span>$[1,n]$</span><!-- Has MathJax --> 中。</p>
<p>給定一個長度為 <span>$n$</span><!-- Has MathJax --> ( <span>$1 \le n \le 100000$</span><!-- Has MathJax --> ) 的正整數序列 <span>$s$</span><!-- Has MathJax --> (<span>$1 \le s_i \le n$</span><!-- Has MathJax -->)，對於 <span>$m$</span><!-- Has MathJax --> ( <span>$1 \le m \le 1000000$</span><!-- Has MathJax -->) 次詢問 <span>$l, r, a, b$</span><!-- Has MathJax -->，每次輸出 <span>$[s_l, \text{... },s_r]$</span><!-- Has MathJax --> 中，權值 <span>$s_i \in [a, b]$</span><!-- Has MathJax --> 的個數。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">10 10</span><br><span class="line">4 4 5 1 4 1 5 1 2 1</span><br><span class="line">5 9 1 2</span><br><span class="line">3 4 7 9</span><br><span class="line">4 4 2 5</span><br><span class="line">2 3 4 7</span><br><span class="line">5 10 4 4</span><br><span class="line">3 9 1 1</span><br><span class="line">1 4 5 9</span><br><span class="line">8 9 3 3</span><br><span class="line">2 2 1 6</span><br><span class="line">8 9 1 4</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">2</span><br><span class="line">1</span><br><span class="line">3</span><br><span class="line">1</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>相較於 b414. BZOJ 3809 Gty 的二逼妹子序列 解法會相對多樣，單純計數就會變得比較簡單。</p>
<p>在這一題中，這裡提供三種解法：</p>
<ul>
<li>莫隊算法<br>只能離線處理，無法強制在線詢問，算法複雜度由分塊降到 <span>$O(N^{1.5})$</span><!-- Has MathJax -->。可參考 b414 的解法。</li>
<li>掃描線 + BIT<br>只能離線處理，把題目轉換成二維情況 <span>$(i, A[i])$</span><!-- Has MathJax -->，詢問相當於找到矩形內部 <span>$[l, r] \times [a, b]$</span><!-- Has MathJax --> 有多少點座標，所以可以當作二維前綴來完成計數 <span>$f(l, r, a, b) = f(r, b) - f(l-1, b) - f(r, a-1) - f(l-1, a-1)$</span><!-- Has MathJax -->。<span>$f(x, y)$</span><!-- Has MathJax --> 表示從原點 <span>$(0, 0)$</span><!-- Has MathJax --> 到 <span>$(x, y)$</span><!-- Has MathJax --> 的點數量，這樣的方式記憶體過多，利用掃描線算法降下來，對 x 由小掃描到大，依序將點插入詢問 <span>$f(x, y)$</span><!-- Has MathJax --> 會在掃瞄到 x 時，詢問 <span>$[0, y]$</span><!-- Has MathJax --> 之間的累計個數得到，最後將每一個詢問離線成四個詢問，掃描一次即可。</li>
<li>可持久化線段樹<br>必須預處理，支持在線詢問，不帶操作修改。將序列權值排序 <span>$(A[i], i)$</span><!-- Has MathJax -->，依序索引值插入線段樹，紀錄每一個插入完的線段樹狀態，接著當詢問 <span>$l, r, a, b$</span><!-- Has MathJax -->，相當於在版本 <code>ver_b - ver_a</code> 查詢線段樹區間 <span>$[l, r]$</span><!-- Has MathJax --> 的總和。由於是計數符合區間減法才能這樣做，否則持久化線段樹還要套別的小技巧來完成。</li>
</ul>
<p>補充一點，雖然 KD-tree 效能是 <span>$O(\sqrt{N} + K)$</span><!-- Has MathJax -->，它也支持 range searching，但必須搭配 report K 操作，那個 <span>$O(\sqrt{N})$</span><!-- Has MathJax --> 的花費是伴隨著 report 存在，因此單一筆計數詢問是無法達到 <span>$O(\sqrt{N})$</span><!-- Has MathJax -->，天真的我寫下去直接 TLE。</p>
<h3 id="莫隊算法"><a href="#莫隊算法" class="headerlink" title="莫隊算法"></a>莫隊算法</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">100005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">1000005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXSQRTV = <span class="number">512</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Offline</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Event</span> &#123;</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> PILE, belong[MAXV];</span><br><span class="line">        <span class="keyword">int</span> l, r, x, y, qid;</span><br><span class="line">        <span class="built_in">Event</span>(<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>, <span class="keyword">int</span> d = <span class="number">0</span>, <span class="keyword">int</span> e = <span class="number">0</span>):</span><br><span class="line">            <span class="built_in">l</span>(a), <span class="built_in">r</span>(b), <span class="built_in">x</span>(c), <span class="built_in">y</span>(d), <span class="built_in">qid</span>(e) &#123;&#125;</span><br><span class="line">        <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Event &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (belong[l] != belong[x.l])</span><br><span class="line">                <span class="keyword">return</span> l &lt; x.l;</span><br><span class="line">            <span class="keyword">return</span> r &lt; x.r; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">int</span> A[MAXN], N, qsize;</span><br><span class="line">    Event event[MAXQ];</span><br><span class="line">    <span class="keyword">int</span> ret[MAXQ];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;N = N, qsize = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(pile, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(pile));</span><br><span class="line">        <span class="built_in">memset</span>(val_count, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(val_count));</span><br><span class="line">        val_PILE = Event::PILE = <span class="built_in">sqrt</span>(N);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = N; i &gt;= <span class="number">1</span>; i--)</span><br><span class="line">            val_belong[i] = Event::belong[i] = i / Event::PILE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">q_add</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        event[qsize] = <span class="built_in">Event</span>(l, r, a, b, qsize);</span><br><span class="line">        qsize++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(event, event+qsize);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">1</span>, r = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; qsize; i++) &#123;</span><br><span class="line">            <span class="keyword">while</span> (r &lt; event[i].r)	r++, <span class="built_in">update</span>(A[r], <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">while</span> (r &gt; event[i].r)	<span class="built_in">update</span>(A[r], <span class="number">-1</span>), r--;</span><br><span class="line">            <span class="keyword">while</span> (l &gt; event[i].l)	l--, <span class="built_in">update</span>(A[l], <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">while</span> (l &lt; event[i].l)	<span class="built_in">update</span>(A[l], <span class="number">-1</span>), l++;</span><br><span class="line">            ret[event[i].qid] = <span class="built_in">query</span>(event[i].x, event[i].y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// unrolled</span></span><br><span class="line">    <span class="keyword">int</span> pile[MAXSQRTV], val_count[MAXV], val_belong[MAXV], val_PILE;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        val_count[x] += val;</span><br><span class="line">        pile[val_belong[x]] += val;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (val_belong[a] == val_belong[b]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = a; i &lt;= b; i++)</span><br><span class="line">                ret += val_count[i];</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = val_belong[a]+<span class="number">1</span>; i &lt; val_belong[b]; i++)</span><br><span class="line">            ret += pile[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = (val_belong[a]+<span class="number">1</span>)*val_PILE<span class="number">-1</span>; i &gt;= a; i--)</span><br><span class="line">            ret += val_count[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = (val_belong[b])*val_PILE; i &lt;= b; i++)</span><br><span class="line">            ret += val_count[i];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; off;</span><br><span class="line"><span class="keyword">int</span> Offline::Event::PILE = <span class="number">16</span>, Offline::Event::belong[MAXV];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> mLocalStream &#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readchar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">char</span> buf[N];</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">char</span> *p = buf, *end = buf;</span><br><span class="line">        <span class="keyword">if</span>(p == end) &#123;</span><br><span class="line">            <span class="keyword">if</span>((end = buf + <span class="built_in">fread</span>(buf, <span class="number">1</span>, N, stdin)) == buf) <span class="keyword">return</span> EOF;</span><br><span class="line">            p = buf;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *p++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ReadInt</span><span class="params">(<span class="keyword">int</span> *x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">char</span> c, neg;</span><br><span class="line">        <span class="keyword">while</span>((c = <span class="built_in">readchar</span>()) &lt; <span class="string">&#x27;-&#x27;</span>)    &#123;<span class="keyword">if</span>(c == EOF) <span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">        neg = (c == <span class="string">&#x27;-&#x27;</span>) ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">        *x = (neg == <span class="number">1</span>) ? c-<span class="string">&#x27;0&#x27;</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>((c = <span class="built_in">readchar</span>()) &gt;= <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            *x = (*x &lt;&lt; <span class="number">3</span>) + (*x &lt;&lt; <span class="number">1</span>) + c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        *x *= neg;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Print</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</span><br><span class="line">        <span class="keyword">char</span> buf[N], *p, *end;</span><br><span class="line">        <span class="built_in">Print</span>() &#123;</span><br><span class="line">            p = buf, end = buf + N - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">printInt</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">static</span> <span class="keyword">char</span> stk[<span class="number">16</span>];</span><br><span class="line">            <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">            stk[idx++] = <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (!x)	</span><br><span class="line">                stk[idx++] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            <span class="keyword">while</span> (x)</span><br><span class="line">                stk[idx++] = x%<span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>, x /= <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">while</span> (idx) &#123;</span><br><span class="line">                <span class="keyword">if</span> (p == end) &#123;</span><br><span class="line">                    *p = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, buf), p = buf;</span><br><span class="line">                &#125;</span><br><span class="line">                *p = stk[--idx], p++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ~<span class="built_in">Print</span>() &#123;</span><br><span class="line">            *p = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        &#125;		</span><br><span class="line">    &#125; bprint;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m, l, r, a, b;</span><br><span class="line">    <span class="keyword">while</span> (mLocalStream::<span class="built_in">ReadInt</span>(&amp;n)) &#123;</span><br><span class="line">        mLocalStream::<span class="built_in">ReadInt</span>(&amp;m);</span><br><span class="line">        off.<span class="built_in">init</span>(n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;off.A[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;l);</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;r);</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;a);</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;b);</span><br><span class="line">            off.<span class="built_in">q_add</span>(l, r, a, b);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        off.<span class="built_in">run</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">            mLocalStream::bprint.<span class="built_in">printInt</span>(off.ret[i]);</span><br><span class="line"><span class="comment">//			printf(&quot;%d\n&quot;, off.ret[i]);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="掃描線"><a href="#掃描線" class="headerlink" title="掃描線"></a>掃描線</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//#include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">1000005</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Event</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> y, qid, qtype;</span><br><span class="line">    <span class="built_in">Event</span>(<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>):</span><br><span class="line">    <span class="built_in">y</span>(a), <span class="built_in">qid</span>(b), <span class="built_in">qtype</span>(c) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BIT</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> v[MAXN], N;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;N = N;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= N; i++)</span><br><span class="line">            v[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (x &lt;= N) &#123;</span><br><span class="line">            v[x] += val;</span><br><span class="line">            x += x&amp;(-x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x) &#123;</span><br><span class="line">            sum += v[x];</span><br><span class="line">            x -= x&amp;(-x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; bit;</span><br><span class="line"><span class="keyword">namespace</span> mLocalStream &#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readchar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">char</span> buf[N];</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">char</span> *p = buf, *end = buf;</span><br><span class="line">        <span class="keyword">if</span>(p == end) &#123;</span><br><span class="line">            <span class="keyword">if</span>((end = buf + <span class="built_in">fread</span>(buf, <span class="number">1</span>, N, stdin)) == buf) <span class="keyword">return</span> EOF;</span><br><span class="line">            p = buf;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *p++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ReadInt</span><span class="params">(<span class="keyword">int</span> *x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">char</span> c, neg;</span><br><span class="line">        <span class="keyword">while</span>((c = <span class="built_in">readchar</span>()) &lt; <span class="string">&#x27;-&#x27;</span>)    &#123;<span class="keyword">if</span>(c == EOF) <span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">        neg = (c == <span class="string">&#x27;-&#x27;</span>) ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">        *x = (neg == <span class="number">1</span>) ? c-<span class="string">&#x27;0&#x27;</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>((c = <span class="built_in">readchar</span>()) &gt;= <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            *x = (*x &lt;&lt; <span class="number">3</span>) + (*x &lt;&lt; <span class="number">1</span>) + c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        *x *= neg;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Print</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</span><br><span class="line">        <span class="keyword">char</span> buf[N], *p, *end;</span><br><span class="line">        <span class="built_in">Print</span>() &#123;</span><br><span class="line">            p = buf, end = buf + N - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">printInt</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">static</span> <span class="keyword">char</span> stk[<span class="number">16</span>];</span><br><span class="line">            <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">            stk[idx++] = <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (!x)</span><br><span class="line">                stk[idx++] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            <span class="keyword">while</span> (x)</span><br><span class="line">                stk[idx++] = x%<span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>, x /= <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">while</span> (idx) &#123;</span><br><span class="line">                <span class="keyword">if</span> (p == end) &#123;</span><br><span class="line">                    *p = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, buf), p = buf;</span><br><span class="line">                &#125;</span><br><span class="line">                *p = stk[--idx], p++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ~<span class="built_in">Print</span>() &#123;</span><br><span class="line">            *p = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        &#125;		</span><br><span class="line">    &#125; bprint;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, A[MAXN], ret[MAXQ];</span><br><span class="line">vector&lt;Event&gt; event[MAXN]; <span class="comment">// event[pos]</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (mLocalStream::<span class="built_in">ReadInt</span>(&amp;n)) &#123;</span><br><span class="line">        mLocalStream::<span class="built_in">ReadInt</span>(&amp;m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(A+i), event[i].<span class="built_in">clear</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> l, r, a, b;</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;l);</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;r);</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;a);</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;b);</span><br><span class="line">            <span class="comment">// area [l, a] - [r, b] = [r, b] - [l-1, b] - [r, a-1] + [l-1, a-1]</span></span><br><span class="line">            event[r].<span class="built_in">push_back</span>(<span class="built_in">Event</span>(b, i, <span class="number">1</span>));</span><br><span class="line">            event[l<span class="number">-1</span>].<span class="built_in">push_back</span>(<span class="built_in">Event</span>(b, i, <span class="number">-1</span>));</span><br><span class="line">            event[r].<span class="built_in">push_back</span>(<span class="built_in">Event</span>(a<span class="number">-1</span>, i, <span class="number">-1</span>));</span><br><span class="line">            event[l<span class="number">-1</span>].<span class="built_in">push_back</span>(<span class="built_in">Event</span>(a<span class="number">-1</span>, i, <span class="number">1</span>));</span><br><span class="line">            ret[i] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        bit.<span class="built_in">init</span>(n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            bit.<span class="built_in">add</span>(A[i], <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e: event[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> val = bit.<span class="built_in">query</span>(e.y);</span><br><span class="line">                ret[e.qid] += e.qtype * val;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ret[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="可持久化"><a href="#可持久化" class="headerlink" title="可持久化"></a>可持久化</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXNODE = <span class="number">3000000</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">100005</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SegementTree</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        Node *lson, *rson;</span><br><span class="line">        <span class="keyword">int</span> val;</span><br><span class="line">    &#125; nodes[MAXNODE];</span><br><span class="line">    <span class="keyword">int</span> nodesize, L, R;</span><br><span class="line">    <span class="function">Node* <span class="title">init</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        nodesize = <span class="number">0</span>;</span><br><span class="line">        L = l, R = r;</span><br><span class="line">        Node* root = <span class="built_in">build</span>(l, r);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nodesize &gt;= MAXNODE)</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> &amp;nodes[nodesize++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">cloneNode</span><span class="params">(Node *p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nodesize &gt;= MAXNODE)</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        Node* u = &amp;nodes[nodesize++];</span><br><span class="line">        *u = *p;</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">build</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l &gt; r)  <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        Node *u = <span class="built_in">newNode</span>();</span><br><span class="line">        u-&gt;lson = u-&gt;rson = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">            u-&gt;val = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> m = (l + r)/<span class="number">2</span>;</span><br><span class="line">            u-&gt;lson = <span class="built_in">build</span>(l, m);</span><br><span class="line">            u-&gt;rson = <span class="built_in">build</span>(m+<span class="number">1</span>, r);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">add</span><span class="params">(Node *p, <span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">add</span>(p, x, val, L, R);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(Node *tp, Node *tq, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query</span>(tp, tq, L, R, x, y);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function">Node* <span class="title">add</span><span class="params">(Node *p, <span class="keyword">int</span> x, <span class="keyword">int</span> val, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        Node *u = <span class="built_in">cloneNode</span>(p);</span><br><span class="line">        u-&gt;val += val;</span><br><span class="line">        <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">            <span class="keyword">return</span> u;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> mid = (l + r)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (x &lt;= mid)</span><br><span class="line">                u-&gt;lson = <span class="built_in">add</span>(p-&gt;lson, x, val, l, mid);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                u-&gt;rson = <span class="built_in">add</span>(p-&gt;rson, x, val, mid+<span class="number">1</span>, r);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(Node *tp, Node *tq, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= l &amp;&amp; r &lt;= y)</span><br><span class="line">            <span class="keyword">return</span> tq-&gt;val - tp-&gt;val;</span><br><span class="line">        <span class="keyword">int</span> mid = (l+r)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (y &lt;= mid)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">query</span>(tp-&gt;lson, tq-&gt;lson, l, mid, x, y);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (x &gt; mid)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">query</span>(tp-&gt;rson, tq-&gt;rson, mid+<span class="number">1</span>, r, x, y);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">query</span>(tp-&gt;lson, tq-&gt;lson, l, mid, x, mid) +</span><br><span class="line">                <span class="built_in">query</span>(tp-&gt;rson, tq-&gt;rson, mid+<span class="number">1</span>, r, mid+<span class="number">1</span>, y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; segTree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> mLocalStream &#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readchar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">char</span> buf[N];</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">char</span> *p = buf, *end = buf;</span><br><span class="line">        <span class="keyword">if</span>(p == end) &#123;</span><br><span class="line">            <span class="keyword">if</span>((end = buf + <span class="built_in">fread</span>(buf, <span class="number">1</span>, N, stdin)) == buf) <span class="keyword">return</span> EOF;</span><br><span class="line">            p = buf;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *p++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ReadInt</span><span class="params">(<span class="keyword">int</span> *x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">char</span> c, neg;</span><br><span class="line">        <span class="keyword">while</span>((c = <span class="built_in">readchar</span>()) &lt; <span class="string">&#x27;-&#x27;</span>)    &#123;<span class="keyword">if</span>(c == EOF) <span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">        neg = (c == <span class="string">&#x27;-&#x27;</span>) ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">        *x = (neg == <span class="number">1</span>) ? c-<span class="string">&#x27;0&#x27;</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>((c = <span class="built_in">readchar</span>()) &gt;= <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            *x = (*x &lt;&lt; <span class="number">3</span>) + (*x &lt;&lt; <span class="number">1</span>) + c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        *x *= neg;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Print</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</span><br><span class="line">        <span class="keyword">char</span> buf[N], *p, *end;</span><br><span class="line">        <span class="built_in">Print</span>() &#123;</span><br><span class="line">            p = buf, end = buf + N - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">printInt</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">static</span> <span class="keyword">char</span> stk[<span class="number">16</span>];</span><br><span class="line">            <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">            stk[idx++] = <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (!x)</span><br><span class="line">                stk[idx++] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            <span class="keyword">while</span> (x)</span><br><span class="line">                stk[idx++] = x%<span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>, x /= <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">while</span> (idx) &#123;</span><br><span class="line">                <span class="keyword">if</span> (p == end) &#123;</span><br><span class="line">                    *p = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, buf), p = buf;</span><br><span class="line">                &#125;</span><br><span class="line">                *p = stk[--idx], p++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ~<span class="built_in">Print</span>() &#123;</span><br><span class="line">            *p = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        &#125;		</span><br><span class="line">    &#125; bprint;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SegementTree::Node *ver[MAXQ];</span><br><span class="line">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; A[MAXN];</span><br><span class="line"><span class="keyword">int</span> fver[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m, x;</span><br><span class="line">    <span class="keyword">while</span> (mLocalStream::<span class="built_in">ReadInt</span>(&amp;n)) &#123;</span><br><span class="line">        mLocalStream::<span class="built_in">ReadInt</span>(&amp;m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;x), A[i] = <span class="built_in">make_pair</span>(x, i);</span><br><span class="line">        <span class="built_in">sort</span>(A+<span class="number">1</span>, A+n+<span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        ver[<span class="number">0</span>] = segTree.<span class="built_in">init</span>(<span class="number">1</span>, n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            ver[i] = segTree.<span class="built_in">add</span>(ver[i<span class="number">-1</span>], A[i].second, <span class="number">1</span>);</span><br><span class="line">            fver[i] = A[i].first;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> l, r, a, b;</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;l);</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;r);</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;a);</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;b);</span><br><span class="line">            <span class="keyword">int</span> va = (<span class="keyword">int</span>) (<span class="built_in">lower_bound</span>(fver+<span class="number">1</span>, fver+n+<span class="number">1</span>, a) - fver) - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> vb = (<span class="keyword">int</span>) (<span class="built_in">upper_bound</span>(fver+<span class="number">1</span>, fver+n+<span class="number">1</span>, b) - fver) - <span class="number">1</span>;</span><br><span class="line">            mLocalStream::bprint.<span class="built_in">printInt</span>(segTree.<span class="built_in">query</span>(ver[va], ver[vb], l, r));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-zj-b414" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/27/zj-b414/" class="article-date">
  <time datetime="2015-06-27T13:20:08.000Z" itemprop="datePublished">2015-06-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/27/zj-b414/">b414. BZOJ 3809 Gty 的二逼妹子序列</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/27/zj-b414/" data-id="ckpaivca100ann8vn1lg89o9v" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/27/zj-b414/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分塊/">分塊</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/莫隊算法/">莫隊算法</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Autumn 和 Bakser 又在研究 Gty 的妹子序列了！</p>
<p>但他們遇到了一個難題，對於一段妹子們，他們想讓你幫忙求出這之內美麗度 <span>$s_i \in [a, b]$</span><!-- Has MathJax --> 的妹子的美麗度的種類數。為了方便，我們規定妹子們的美麗度全都在 <span>$[1,n]$</span><!-- Has MathJax --> 中。</p>
<p>給定一個長度為 <span>$n$</span><!-- Has MathJax --> ( <span>$1 \le n \le 100000$</span><!-- Has MathJax --> ) 的正整數序列 <span>$s$</span><!-- Has MathJax --> (<span>$1 \le s_i \le n$</span><!-- Has MathJax -->)，對於 <span>$m$</span><!-- Has MathJax --> ( <span>$1 \le m \le 1000000$</span><!-- Has MathJax -->) 次詢問 <span>$l, r, a, b$</span><!-- Has MathJax -->，每次輸出 <span>$[s_l, \text{... },s_r]$</span><!-- Has MathJax --> 中，權值 <span>$s_i \in [a, b]$</span><!-- Has MathJax --> 的權值種類數。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">10 10</span><br><span class="line">4 4 5 1 4 1 5 1 2 1</span><br><span class="line">5 9 1 2</span><br><span class="line">3 4 7 9</span><br><span class="line">4 4 2 5</span><br><span class="line">2 3 4 7</span><br><span class="line">5 10 4 4</span><br><span class="line">3 9 1 1</span><br><span class="line">1 4 5 9</span><br><span class="line">8 9 3 3</span><br><span class="line">2 2 1 6</span><br><span class="line">8 9 1 4</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">2</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>解決區間內數字在某個值域內部的種類數。</p>
<p>** 前情提要 **，如果單純問區間種類數 (獨特)，可以轉換成找區間內部有多少數字大於右端點，要預處理每一個數字的下一個相同數字的位置，只要符合大於右端點的條件即為獨特。可以使用持久化線段樹來做這件事情，依序加入序列數字，貪心去保留最右側的相同數字是獨特的，藉由多版本的區間相減來完成。</p>
<p>現在特別要求在某個值域內部，那就沒有好方法可解，可以使用莫隊下去完成。但是莫隊算法在區間轉移 (example <code>[l, r] to [l, r+1]</code>) 的效能要縮小到 <span>$O(1)$</span><!-- Has MathJax -->，若使用一般樹結構，莫隊算法會衰退到 <span>$O(N^{1.5} \log N)$</span><!-- Has MathJax -->，還不如修改快一點 <span>$O(1)$</span><!-- Has MathJax -->，詢問慢一點 <span>$O(\sqrt{N})$</span><!-- Has MathJax -->，將值域使用塊狀表方式記錄，來達到 <span>$O(N^{1.5} + Q \sqrt{N})$</span><!-- Has MathJax --></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">100005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">1000005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXSQRTV = <span class="number">512</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Offline</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Event</span> &#123;</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> PILE, belong[MAXV];</span><br><span class="line">        <span class="keyword">int</span> l, r, x, y, qid;</span><br><span class="line">        <span class="built_in">Event</span>(<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>, <span class="keyword">int</span> d = <span class="number">0</span>, <span class="keyword">int</span> e = <span class="number">0</span>):</span><br><span class="line">            <span class="built_in">l</span>(a), <span class="built_in">r</span>(b), <span class="built_in">x</span>(c), <span class="built_in">y</span>(d), <span class="built_in">qid</span>(e) &#123;&#125;</span><br><span class="line">        <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Event &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (belong[l] != belong[x.l])</span><br><span class="line">                <span class="keyword">return</span> l &lt; x.l;</span><br><span class="line">            <span class="keyword">return</span> r &lt; x.r; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">int</span> A[MAXN], N, qsize;</span><br><span class="line">    Event event[MAXQ];</span><br><span class="line">    <span class="keyword">int</span> ret[MAXQ];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;N = N, qsize = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(pile, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(pile));</span><br><span class="line">        <span class="built_in">memset</span>(val_count, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(val_count));</span><br><span class="line">        val_PILE = Event::PILE = <span class="built_in">sqrt</span>(N);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = N; i &gt;= <span class="number">1</span>; i--)</span><br><span class="line">            val_belong[i] = Event::belong[i] = i / Event::PILE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">q_add</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        event[qsize] = <span class="built_in">Event</span>(l, r, a, b, qsize);</span><br><span class="line">        qsize++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(event, event+qsize);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">1</span>, r = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; qsize; i++) &#123;</span><br><span class="line">            <span class="keyword">while</span> (r &lt; event[i].r)	r++, <span class="built_in">update</span>(A[r], <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">while</span> (r &gt; event[i].r)	<span class="built_in">update</span>(A[r], <span class="number">-1</span>), r--;</span><br><span class="line">            <span class="keyword">while</span> (l &gt; event[i].l)	l--, <span class="built_in">update</span>(A[l], <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">while</span> (l &lt; event[i].l)	<span class="built_in">update</span>(A[l], <span class="number">-1</span>), l++;</span><br><span class="line">            ret[event[i].qid] = <span class="built_in">query</span>(event[i].x, event[i].y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// unrolled</span></span><br><span class="line">    <span class="keyword">int</span> pile[MAXSQRTV], val_count[MAXV], val_belong[MAXV], val_PILE;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        val_count[x] += val;</span><br><span class="line">        <span class="keyword">if</span> (val == <span class="number">-1</span> &amp;&amp; val_count[x] == <span class="number">0</span>)</span><br><span class="line">            pile[val_belong[x]]--;</span><br><span class="line">        <span class="keyword">if</span> (val == <span class="number">1</span> &amp;&amp; val_count[x] == <span class="number">1</span>)</span><br><span class="line">            pile[val_belong[x]]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (val_belong[a] == val_belong[b]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = a; i &lt;= b; i++)</span><br><span class="line">                ret += val_count[i] &gt; <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = val_belong[a]+<span class="number">1</span>; i &lt; val_belong[b]; i++)</span><br><span class="line">            ret += pile[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = (val_belong[a]+<span class="number">1</span>)*val_PILE<span class="number">-1</span>; i &gt;= a; i--)</span><br><span class="line">            ret += val_count[i] &gt; <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = (val_belong[b])*val_PILE; i &lt;= b; i++)</span><br><span class="line">            ret += val_count[i] &gt; <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; off;</span><br><span class="line"><span class="keyword">int</span> Offline::Event::PILE = <span class="number">16</span>, Offline::Event::belong[MAXV];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> mLocalStream &#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readchar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">char</span> buf[N];</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">char</span> *p = buf, *end = buf;</span><br><span class="line">        <span class="keyword">if</span>(p == end) &#123;</span><br><span class="line">            <span class="keyword">if</span>((end = buf + <span class="built_in">fread</span>(buf, <span class="number">1</span>, N, stdin)) == buf) <span class="keyword">return</span> EOF;</span><br><span class="line">            p = buf;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *p++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ReadInt</span><span class="params">(<span class="keyword">int</span> *x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">char</span> c, neg;</span><br><span class="line">        <span class="keyword">while</span>((c = <span class="built_in">readchar</span>()) &lt; <span class="string">&#x27;-&#x27;</span>)    &#123;<span class="keyword">if</span>(c == EOF) <span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">        neg = (c == <span class="string">&#x27;-&#x27;</span>) ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">        *x = (neg == <span class="number">1</span>) ? c-<span class="string">&#x27;0&#x27;</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>((c = <span class="built_in">readchar</span>()) &gt;= <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            *x = (*x &lt;&lt; <span class="number">3</span>) + (*x &lt;&lt; <span class="number">1</span>) + c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        *x *= neg;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Print</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</span><br><span class="line">        <span class="keyword">char</span> buf[N], *p, *end;</span><br><span class="line">        <span class="built_in">Print</span>() &#123;</span><br><span class="line">            p = buf, end = buf + N - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">printInt</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">static</span> <span class="keyword">char</span> stk[<span class="number">16</span>];</span><br><span class="line">            <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">            stk[idx++] = <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (!x)	</span><br><span class="line">                stk[idx++] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            <span class="keyword">while</span> (x)</span><br><span class="line">                stk[idx++] = x%<span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>, x /= <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">while</span> (idx) &#123;</span><br><span class="line">                <span class="keyword">if</span> (p == end) &#123;</span><br><span class="line">                    *p = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, buf), p = buf;</span><br><span class="line">                &#125;</span><br><span class="line">                *p = stk[--idx], p++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ~<span class="built_in">Print</span>() &#123;</span><br><span class="line">            *p = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        &#125;		</span><br><span class="line">    &#125; bprint;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m, l, r, a, b;</span><br><span class="line">    <span class="keyword">while</span> (mLocalStream::<span class="built_in">ReadInt</span>(&amp;n)) &#123;</span><br><span class="line">        mLocalStream::<span class="built_in">ReadInt</span>(&amp;m);</span><br><span class="line">        off.<span class="built_in">init</span>(n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;off.A[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;l);</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;r);</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;a);</span><br><span class="line">            mLocalStream::<span class="built_in">ReadInt</span>(&amp;b);</span><br><span class="line">            off.<span class="built_in">q_add</span>(l, r, a, b);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        off.<span class="built_in">run</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">            mLocalStream::bprint.<span class="built_in">printInt</span>(off.ret[i]);</span><br><span class="line"><span class="comment">//			printf(&quot;%d\n&quot;, off.ret[i]);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-zj-b415" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/26/zj-b415/" class="article-date">
  <time datetime="2015-06-25T23:13:24.000Z" itemprop="datePublished">2015-06-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/26/zj-b415/">b415. 輸出優化練習</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/26/zj-b415/" data-id="ckpaivca100aon8vn7t2nfeqo" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/26/zj-b415/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/優化輸入/">優化輸入</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/優化輸出/">優化輸出</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>寫題目不只會遇到算法複雜度問題，還會遇到語法上的瓶頸，了解更深入的作業系統架構、語言特性，了解每一個函數的實作方法，就能把代碼效能發揮到淋淋盡緻。當然，對於代碼轉成執行檔的最佳化技巧也是如此，接下來就來做個基礎題吧。</p>
<p>現在請處理一個偽隨機數計算，輸出前 <span>$m$</span><!-- Has MathJax --> 個值。</p>
<span>$x_{i+1} \equiv x_{i}^{2} \mod n$</span><!-- Has MathJax -->

<p>有興趣的同學，可以查閱 Blum Blum Shub (BBS) Generator 相關隨機數算法。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">90 141 5</span><br><span class="line">52 57 5</span><br><span class="line">19 129 5</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">90 63 21 18 42</span><br><span class="line">52 25 55 4 16</span><br><span class="line">19 103 31 58 10</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>手動轉字串，減少函數 <code>printf()</code> 的呼叫，一次將答案吐出來便可以達到加速，由於有一部分時間都花在取模，速度最多提升個兩到三倍。</p>
<p>用 <code>putchar()</code> 速度也會比 <code>printf()</code> 快一點，但沒有實作 buffer 來得快。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span> </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">namespace</span> mLocalStream &#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readchar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">char</span> buf[N];</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">char</span> *p = buf, *end = buf;</span><br><span class="line">        <span class="keyword">if</span>(p == end) &#123;</span><br><span class="line">            <span class="keyword">if</span>((end = buf + <span class="built_in">fread</span>(buf, <span class="number">1</span>, N, stdin)) == buf) <span class="keyword">return</span> EOF;</span><br><span class="line">            p = buf;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *p++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ReadInt</span><span class="params">(<span class="keyword">int</span> *x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">char</span> c, neg;</span><br><span class="line">        <span class="keyword">while</span>((c = <span class="built_in">readchar</span>()) &lt; <span class="string">&#x27;-&#x27;</span>)    &#123;<span class="keyword">if</span>(c == EOF) <span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">        neg = (c == <span class="string">&#x27;-&#x27;</span>) ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">        *x = (neg == <span class="number">1</span>) ? c-<span class="string">&#x27;0&#x27;</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>((c = <span class="built_in">readchar</span>()) &gt;= <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            *x = (*x &lt;&lt; <span class="number">3</span>) + (*x &lt;&lt; <span class="number">1</span>) + c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        *x *= neg;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Print</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</span><br><span class="line">        <span class="keyword">char</span> buf[N], *p, *end;</span><br><span class="line">        <span class="built_in">Print</span>() &#123;</span><br><span class="line">            p = buf, end = buf + N - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">printInt</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">char</span> padding)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">static</span> <span class="keyword">char</span> stk[<span class="number">16</span>];</span><br><span class="line">            <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">            stk[idx++] = padding;</span><br><span class="line">            <span class="keyword">if</span> (!x)	</span><br><span class="line">                stk[idx++] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            <span class="keyword">while</span> (x)</span><br><span class="line">                stk[idx++] = x%<span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>, x /= <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">while</span> (idx) &#123;</span><br><span class="line">                <span class="keyword">if</span> (p == end) &#123;</span><br><span class="line">                    *p = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, buf), p = buf;</span><br><span class="line">                &#125;</span><br><span class="line">                *p = stk[--idx], p++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">online_printInt</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">static</span> <span class="keyword">char</span> ch[<span class="number">16</span>];</span><br><span class="line">            <span class="keyword">static</span> <span class="keyword">int</span> idx;</span><br><span class="line">            idx = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (x == <span class="number">0</span>)	ch[++idx] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (x &gt; <span class="number">0</span>) ch[++idx] = x % <span class="number">10</span>, x /= <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">while</span> (idx) </span><br><span class="line">                <span class="built_in">putchar</span>(ch[idx--]+<span class="number">48</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ~<span class="built_in">Print</span>() &#123;</span><br><span class="line">            *p = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; bprint;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x0, p, n;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;x0, &amp;p, &amp;n) == <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            mLocalStream::bprint.<span class="built_in">printInt</span>(x0, i == n<span class="number">-1</span> ? <span class="string">&#x27;\n&#x27;</span> : <span class="string">&#x27; &#x27;</span>);</span><br><span class="line"><span class="comment">//			mLocalStream::Print::online_printInt(x0);</span></span><br><span class="line"><span class="comment">//			putchar(i == n-1 ? &#x27;\n&#x27; : &#x27; &#x27;);</span></span><br><span class="line">            x0 = ((<span class="keyword">long</span> <span class="keyword">long</span>) x0 * x0)%p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-zj-d476" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/25/zj-d476/" class="article-date">
  <time datetime="2015-06-24T23:05:28.000Z" itemprop="datePublished">2015-06-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/25/zj-d476/">d476. 區間查詢</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/25/zj-d476/" data-id="ckpaivcac00bxn8vn852ebryp" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/25/zj-d476/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/整體二分/">整體二分</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/離線處理/">離線處理</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>一個長度為 n 的序列，支持兩種操作：</p>
<ol>
<li>输出 <span>$[A, B]$</span><!-- Has MathJax --> 區間第 k 小的數 (從小到大排序後第 k 個)</li>
<li>修改第 I 個數為 W</li>
</ol>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">5 3</span><br><span class="line">1 2 3 4 5</span><br><span class="line">Q 1 4 2</span><br><span class="line">C 2 5</span><br><span class="line">Q 1 4 2</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>在討論用一些雜七雜八的樹類結構去跟莫隊算法搏鬥之餘，用了轉幾何方向去兜資料結構，隨後發現題目尋找的是 unique 而非計數，因此很多想法就垮台，當然出成另一道題目也是不錯。決定尋找其他想法！</p>
<h3 id="開始"><a href="#開始" class="headerlink" title="開始"></a>開始</h3><p>整體二分是什麼呢？假設操作只有修改、詢問，不包含插入、刪除，而且詢問是一個數值結果，這個數值結果可以藉由二分 + 掃描來完成，那就可以使用整體二分來離線支持。</p>
<p>對答案值域分治，將相關操作分治在一起，同時要保留順序性，分治過程中會不斷地累加每一個詢問的掃描數值，最後滿溢時紀錄答案。每一個操作最多在 <span>$\log \text{MAXV}$</span><!-- Has MathJax --> 層計算，因此複雜度是 <span>$O(Q \log \text{MAXV})$</span><!-- Has MathJax -->。</p>
<p>好處是可以用常數較低的結構，所以會比較快？</p>
<h4 id="應用"><a href="#應用" class="headerlink" title="應用"></a>應用</h4><p>這一道經典題有很多作法，如持久化線段樹、塊狀鏈表、歸併樹、劃分樹、 … 等。其中能支持修改的有塊狀鏈表、複雜的持久化線段樹 (主席樹)。</p>
<p>帶修改的區間 K 小，概略說明二分答案 <span>$x$</span><!-- Has MathJax -->，然後去查找小於等於 <span>$x$</span><!-- Has MathJax --> 的數字在區間 <span>$[l, r]$</span><!-- Has MathJax --> 內出現的次數是否大於等於 <span>$K$</span><!-- Has MathJax -->。然後修改元素有加入跟移除，二分答案 mid，要將加入、移除會影響的 <span>$A[i] \le mid$</span><!-- Has MathJax -->，加入或移除時對該數字的索引值 <span>$i$</span><!-- Has MathJax --> 建造統計方案。</p>
<p>對於(位置, 值) <span>$\left \langle i, A[i] \right \rangle$</span><!-- Has MathJax --> 來說，一開始的前 <span>$N$</span><!-- Has MathJax --> 個操作是加入 <span>$\left \langle i, A[i] \right \rangle$</span><!-- Has MathJax -->，二分答案時，用一個 binary indexed tree 去維護 index 的個數，也就是說，對於修改元素 <span>$\left \langle i, A[i] \right \rangle$</span><!-- Has MathJax --> 相當於在二分答案 mid 時，插入 <code>BIT.add(i, 1)</code>，那對於區間詢問，相當於查找 <code>BIT.query([l, r])</code> 如此一來就能知道區間 <span>$[l, r]$</span><!-- Has MathJax --> 在 mid 以內有幾個數字符合。</p>
<p>假設計數大於 k，詢問往左放，反之扣除已知 mid 以內的數量，詢問往右放，如此一來就完成了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">65536</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">65536</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Offline</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Event</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> x, y, k, qtype, qid;</span><br><span class="line">        <span class="keyword">int</span> calc; <span class="comment">//</span></span><br><span class="line">        <span class="built_in">Event</span>(<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>, <span class="keyword">int</span> d = <span class="number">0</span>, <span class="keyword">int</span> e = <span class="number">0</span>, <span class="keyword">int</span> f = <span class="number">0</span>):</span><br><span class="line">            <span class="built_in">x</span>(a), <span class="built_in">y</span>(b), <span class="built_in">k</span>(c), <span class="built_in">qtype</span>(d), <span class="built_in">qid</span>(e), <span class="built_in">calc</span>(f) &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    vector&lt;Event&gt; event;</span><br><span class="line">    <span class="keyword">int</span> N, ret[MAXQ];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;N = N;</span><br><span class="line">        event.<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addEvent</span><span class="params">(<span class="keyword">int</span> qtype, <span class="keyword">int</span> qid, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        event.<span class="built_in">push_back</span>(<span class="built_in">Event</span>(x, y, k, qtype, qid));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">DC</span>(<span class="number">0</span>, event.<span class="built_in">size</span>()<span class="number">-1</span>, <span class="number">0</span>, INF);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// buffer</span></span><br><span class="line">    <span class="keyword">int</span> buf[MAXQ];</span><br><span class="line">    Event ebuf1[MAXQ], ebuf2[MAXQ];</span><br><span class="line">    <span class="comment">// binary indexed tree</span></span><br><span class="line">    <span class="keyword">int</span> bit[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (x &lt;= N) &#123;</span><br><span class="line">            bit[x] += val;</span><br><span class="line">            x += (x)&amp;(-x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x) &#123;</span><br><span class="line">            ret += bit[x];</span><br><span class="line">            x -= (x)&amp;(-x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DC</span><span class="params">(<span class="keyword">int</span> q_l, <span class="keyword">int</span> q_r, <span class="keyword">int</span> val_l, <span class="keyword">int</span> val_r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (q_l &gt; q_r)	<span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span> (val_l == val_r) &#123;	<span class="comment">// find</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = q_l; i &lt;= q_r; i++)</span><br><span class="line">                <span class="keyword">if</span> (event[i].qtype == <span class="number">2</span>)</span><br><span class="line">                    ret[event[i].qid] = val_l;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> mid = (val_l + val_r)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = q_l; i &lt;= q_r; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (event[i].qtype == <span class="number">0</span> &amp;&amp; event[i].y &lt;= mid)</span><br><span class="line">                <span class="built_in">add</span>(event[i].x, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (event[i].qtype == <span class="number">1</span> &amp;&amp; event[i].y &lt;= mid)</span><br><span class="line">                <span class="built_in">add</span>(event[i].x, <span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (event[i].qtype == <span class="number">2</span>)</span><br><span class="line">                buf[i] = <span class="built_in">query</span>(event[i].y) - <span class="built_in">query</span>(event[i].x<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = q_l; i &lt;= q_r; i++) &#123; <span class="comment">// resume</span></span><br><span class="line">            <span class="keyword">if</span> (event[i].qtype == <span class="number">0</span> &amp;&amp; event[i].y &lt;= mid)</span><br><span class="line">                <span class="built_in">add</span>(event[i].x, <span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (event[i].qtype == <span class="number">1</span> &amp;&amp; event[i].y &lt;= mid)</span><br><span class="line">                <span class="built_in">add</span>(event[i].x, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> lidx = <span class="number">0</span>, ridx = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = q_l; i &lt;= q_r; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (event[i].qtype == <span class="number">0</span> || event[i].qtype == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (event[i].y &lt;= mid)</span><br><span class="line">                    ebuf1[lidx++] = event[i];</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    ebuf2[ridx++] = event[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (event[i].calc + buf[i] &gt; event[i].k - <span class="number">1</span>)</span><br><span class="line">                    ebuf1[lidx++] = event[i];</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    event[i].calc += buf[i];</span><br><span class="line">                    ebuf2[ridx++] = event[i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lidx; i++)</span><br><span class="line">            event[q_l+i] = ebuf1[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ridx; i++)</span><br><span class="line">            event[q_l+lidx+i] = ebuf2[i];</span><br><span class="line">        <span class="built_in">DC</span>(q_l, q_l+lidx<span class="number">-1</span>, val_l, mid);</span><br><span class="line">        <span class="built_in">DC</span>(q_l+lidx, q_r, mid+<span class="number">1</span>, val_r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; off;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m, x, y, k, v;</span><br><span class="line">    <span class="keyword">int</span> A[<span class="number">65536</span>];</span><br><span class="line">    <span class="keyword">char</span> cmd[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m) == <span class="number">2</span>) &#123;</span><br><span class="line">        off.<span class="built_in">init</span>(n);</span><br><span class="line">        <span class="comment">// qtype 0:add, 1:remove, 2: query</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;A[i]);</span><br><span class="line">            off.<span class="built_in">addEvent</span>(<span class="number">0</span>, <span class="number">0</span>, i, A[i], <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> qid = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, cmd);</span><br><span class="line">            <span class="keyword">if</span> (cmd[<span class="number">0</span>] == <span class="string">&#x27;Q&#x27;</span>) &#123;</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;x, &amp;y, &amp;k);</span><br><span class="line">                off.<span class="built_in">addEvent</span>(<span class="number">2</span>, qid++, x, y, k);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;v);</span><br><span class="line">                off.<span class="built_in">addEvent</span>(<span class="number">1</span>, <span class="number">0</span>, x, A[x], <span class="number">0</span>);</span><br><span class="line">                off.<span class="built_in">addEvent</span>(<span class="number">0</span>, <span class="number">0</span>, x, v, <span class="number">0</span>);</span><br><span class="line">                A[x] = v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        off.<span class="built_in">run</span>();		</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; qid; i++)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, off.ret[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-TIOJ-1475" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/22/TIOJ-1475/" class="article-date">
  <time datetime="2015-06-22T01:24:23.000Z" itemprop="datePublished">2015-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/22/TIOJ-1475/">TIOJ 1475 錄製專輯 (Record)</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/22/TIOJ-1475/" data-id="ckpaivc6z000in8vn9u3z0hu9" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/22/TIOJ-1475/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dp/">dp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/大數/">大數</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Jolin 是個愛唱歌的小孩，每次總喜歡邊唱邊用電腦把自己的歌聲錄下來，因此長久下來，在她的電腦裡，已儲存了為數不小的個人歌唱作品。由於耶誕節快要到了，為了準備一份特別的耶誕禮物給爸爸，Jolin 準備從電腦中儲存的個人歌唱作品，挑選幾首歌製成一張個人專輯 CD。由於每張 CD 的容量有限，而Jolin 的個人歌唱作品早已遠遠超過一張 CD 可收錄的容量，因此 Jolin 希望你可以幫她想辦法，讓她所製作的專輯中，能有數目最多的歌曲（請注意：每一首歌只能被收錄一次），同時必需剛好裝滿整張 CD，不留下任何未使用的空間。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">10 50 30 70 60</span><br><span class="line">80 </span><br><span class="line">5</span><br><span class="line">10 50 30 70 60</span><br><span class="line">20 </span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2 4</span><br><span class="line">0 0 </span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>實作 C++ 簡單的加法、乘法大數，直接把別提的拿過來用。</p>
<p>套用 0/1 背包問題，額外增加大數紀錄方法數，最後乘上 <span>$N!$</span><!-- Has MathJax --> 即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BigInteger</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;<span class="keyword">long</span> <span class="keyword">long</span>&gt; v;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> MAXC;</span><br><span class="line">    <span class="built_in">BigInteger</span>(<span class="keyword">int</span> x = <span class="number">0</span>) &#123;</span><br><span class="line">        v = vector&lt;<span class="keyword">long</span> <span class="keyword">long</span>&gt;(<span class="number">10</span>, <span class="number">0</span>);</span><br><span class="line">        v[<span class="number">0</span>] = x;</span><br><span class="line">        MAXC = <span class="number">100000000</span>;</span><br><span class="line">        <span class="built_in">normal</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    BigInteger <span class="keyword">operator</span>+(<span class="keyword">const</span> BigInteger &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="function">BigInteger <span class="title">r</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">        r.v.<span class="built_in">resize</span>(<span class="built_in">max</span>(v.<span class="built_in">size</span>(), x.v.<span class="built_in">size</span>()) + <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; v.<span class="built_in">size</span>(); i++)</span><br><span class="line">            r.v[i] += v[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; x.v.<span class="built_in">size</span>(); i++)</span><br><span class="line">            r.v[i] += x.v[i];</span><br><span class="line">        r.<span class="built_in">normal</span>();</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">    BigInteger <span class="keyword">operator</span>*(<span class="keyword">const</span> BigInteger &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="function">BigInteger <span class="title">r</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">        r.v.<span class="built_in">resize</span>(v.<span class="built_in">size</span>() + x.v.<span class="built_in">size</span>() + <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; v.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (v[i] == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; x.v.<span class="built_in">size</span>(); j++)</span><br><span class="line">                r.v[i+j] += v[i] * x.v[j];</span><br><span class="line">        &#125;</span><br><span class="line">        r.<span class="built_in">normal</span>();</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">normal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; v.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (v[i] &gt;= MAXC) &#123;</span><br><span class="line">                v[i+<span class="number">1</span>] += v[i] / MAXC;</span><br><span class="line">                v[i] %= MAXC;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> s = (<span class="keyword">int</span>) v.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (s &gt; <span class="number">0</span> &amp;&amp; v[s] == <span class="number">0</span>)</span><br><span class="line">            s--;</span><br><span class="line">        v.<span class="built_in">resize</span>(s+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isZero</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (v.<span class="built_in">size</span>() &gt; <span class="number">1</span>)   <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> v[<span class="number">0</span>] == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> BigInteger &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">    	<span class="keyword">if</span> (v.<span class="built_in">size</span>() != x.v.<span class="built_in">size</span>())</span><br><span class="line">    		<span class="keyword">return</span> v.<span class="built_in">size</span>() &lt; x.v.<span class="built_in">size</span>();</span><br><span class="line">    	<span class="keyword">for</span> (<span class="keyword">int</span> i = v.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    		<span class="keyword">if</span> (v[i] != x.v[i])</span><br><span class="line">    			<span class="keyword">return</span> v[i] &lt; x.v[i];</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> BigInteger &amp;x)  <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (v.<span class="built_in">size</span>() != x.v.<span class="built_in">size</span>())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = v.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            <span class="keyword">if</span> (v[i] != x.v[i])</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>, v[v.<span class="built_in">size</span>()<span class="number">-1</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = (<span class="keyword">int</span>) v.<span class="built_in">size</span>() - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%08lld&quot;</span>, v[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N, M, A[<span class="number">128</span>];</span><br><span class="line">    BigInteger f[<span class="number">128</span>] = &#123;&#125;;</span><br><span class="line">    f[<span class="number">0</span>] = <span class="built_in">BigInteger</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">128</span>; i++)</span><br><span class="line">        f[i] = f[i<span class="number">-1</span>] * <span class="built_in">BigInteger</span>(i);</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;N) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;A[i]);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;M);</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">sort</span>(A, A + N);</span><br><span class="line">        <span class="keyword">int</span> dp[<span class="number">10005</span>] = &#123;&#125;;</span><br><span class="line">        BigInteger dp2[<span class="number">10005</span>] = &#123;&#125;;</span><br><span class="line">        dp2[<span class="number">0</span>] = <span class="built_in">BigInteger</span>(<span class="number">1</span>), dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = A[i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = M; j &gt;= x; j--) &#123;</span><br><span class="line">                <span class="keyword">if</span> (dp[j] &lt; dp[j-x] + <span class="number">1</span> &amp;&amp; !dp2[j-x].<span class="built_in">isZero</span>())</span><br><span class="line">                    dp[j] = dp[j-x] + <span class="number">1</span>, dp2[j] = <span class="built_in">BigInteger</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">if</span> (dp[j] == dp[j-x] + <span class="number">1</span> &amp;&amp; !dp2[j-x].<span class="built_in">isZero</span>())</span><br><span class="line">                    dp2[j] = dp2[j] + dp2[j-x];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> a = dp[M];</span><br><span class="line">        BigInteger b = dp2[M] * f[a];</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, a);</span><br><span class="line">        b.<span class="built_in">print</span>();</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">10 50 30 70 60</span></span><br><span class="line"><span class="comment">20 </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-bzoj-2038" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/22/bzoj-2038/" class="article-date">
  <time datetime="2015-06-22T01:05:47.000Z" itemprop="datePublished">2015-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/22/bzoj-2038/">BZOJ 2038 小 Z 的袜子</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/22/bzoj-2038/" data-id="ckpaivc73000on8vnb3l5djep" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/22/bzoj-2038/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/莫隊算法/">莫隊算法</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/離線處理/">離線處理</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>給一個序列，詢問一個區間中任挑兩個數字，這兩個數字相同的機率為何，將答案化簡後輸出。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">6 4</span><br><span class="line">1 2 3 3 3 2</span><br><span class="line">2 6</span><br><span class="line">1 3</span><br><span class="line">3 5</span><br><span class="line">1 6</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2/5</span><br><span class="line">0/1</span><br><span class="line">1/1</span><br><span class="line">4/15</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>莫隊算法命名是莫濤隊伍想出來的，不算是特別算法命名，估計是比賽中想到，目前沒看到英文命名。</p>
<p>莫隊算法處理離線詢問，回答所有答案複雜度為 <span>$O(N^{1.5})$</span><!-- Has MathJax -->，其中 N 是區間索引值的範圍大小。概念在於分塊處理如下：</p>
<ul>
<li>對於每個詢問的左端點放置於同一塊去處理</li>
<li>每一次處理一個塊狀的所有詢問</li>
<li>對於同一塊，詢問的右端點嚴格遞增去處理，讓左端點不斷地移動</li>
</ul>
<p>發現到單獨看左端點指針的移動，約為 <span>$O(N^{1.5})$</span><!-- Has MathJax -->，只考慮同一塊，最多有 <span>$N$</span><!-- Has MathJax --> 的詢問，一個詢問會造成左端點移動 <span>$O(N^{0.5})$</span><!-- Has MathJax -->。而單獨看又端點指針的移動，約為 <span>$O(N^{1.5})$</span><!-- Has MathJax -->，由於只會有 <span>$O(N^{0.5})$</span><!-- Has MathJax --> 塊，每一塊最慘就是遞增的移動 <span>$O(N)$</span><!-- Has MathJax -->。</p>
<p>只要轉移區間 (維護區間的答案、計數，例如從 <code>[l, r]</code> 變成 <code>[l, r-1]</code> 的答案維護，把區間左右端點變大變小 1 的轉移計算) 的速度快，則複雜度約為 <span>$O(N^{1.5})$</span><!-- Has MathJax -->。有不少情況需要 <span>$O(\log N)$</span><!-- Has MathJax --> 的其他數據結構維護轉移，複雜度就會變成 <span>$O(N^{1.5} \log N)$</span><!-- Has MathJax -->，必要時使用塊狀表去作為數據結構進行轉移，當詢問次數 Q 與序列長度 N 呈線性關係，塊狀表支持 <span>$O(1)$</span><!-- Has MathJax --> 修改，<span>$O(N^{0.5})$</span><!-- Has MathJax --> 統計，那複雜度又能壓回 <span>$O(N^{1.5})$</span><!-- Has MathJax -->。</p>
<p>能使用莫隊算法的題目，其中也不少能使用持久化結構來完成，若不考慮空間使用量，持久化結構能支持離線預處理、在線詢問。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">50005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">50005</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Offline</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Event</span> &#123;</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> PILE;</span><br><span class="line">        <span class="keyword">int</span> l, r, qid;</span><br><span class="line">        <span class="built_in">Event</span>(<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>):</span><br><span class="line">            <span class="built_in">l</span>(a), <span class="built_in">r</span>(b), <span class="built_in">qid</span>(c) &#123;&#125;</span><br><span class="line">        <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Event &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (l / PILE != x.l / PILE)</span><br><span class="line">                <span class="keyword">return</span> l &lt; x.l;</span><br><span class="line">            <span class="keyword">return</span> r &lt; x.r; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">int</span> A[MAXN], N, qsize;</span><br><span class="line">    vector&lt;Event&gt; event;</span><br><span class="line">    vector&lt; pair&lt;<span class="keyword">long</span> <span class="keyword">long</span>, <span class="keyword">long</span> <span class="keyword">long</span>&gt; &gt; ret;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;N = N, qsize = <span class="number">0</span>;</span><br><span class="line">        event.<span class="built_in">clear</span>();</span><br><span class="line">        <span class="built_in">memset</span>(B, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(B));</span><br><span class="line">        <span class="keyword">for</span> (Event::PILE = <span class="number">1</span>; Event::PILE * Event::PILE &lt; N; Event::PILE &lt;&lt;= <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">q_add</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        event.<span class="built_in">push_back</span>(<span class="built_in">Event</span>(l, r, qsize));</span><br><span class="line">        qsize++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(event.<span class="built_in">begin</span>(), event.<span class="built_in">end</span>());</span><br><span class="line">        ret.<span class="built_in">resize</span>(event.<span class="built_in">size</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">1</span>, r = <span class="number">0</span>;</span><br><span class="line">        q_stat = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; event.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">while</span> (r &lt; event[i].r)	r++, <span class="built_in">update</span>(A[r], <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">while</span> (r &gt; event[i].r)	<span class="built_in">update</span>(A[r], <span class="number">-1</span>), r--;</span><br><span class="line">            <span class="keyword">while</span> (l &gt; event[i].l)	l--, <span class="built_in">update</span>(A[l], <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">while</span> (l &lt; event[i].l)	<span class="built_in">update</span>(A[l], <span class="number">-1</span>), l++;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> a, b, len = event[i].r - event[i].l + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (len &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                a = q_stat - len;</span><br><span class="line">                b = len * (len - <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                a = <span class="number">0</span>, b = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ret[event[i].qid] = <span class="built_in">make_pair</span>(a, b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> B[MAXV], q_stat;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        B[x] += val;</span><br><span class="line">        q_stat += val * <span class="number">2</span> * B[x] - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; off;</span><br><span class="line"><span class="keyword">int</span> Offline::Event::PILE = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">llgcd</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x, <span class="keyword">long</span> <span class="keyword">long</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> t;</span><br><span class="line">    <span class="keyword">while</span> (x%y)</span><br><span class="line">        t = x, x = y, y = t%y;</span><br><span class="line">    <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N, M, l, r;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;N, &amp;M) == <span class="number">2</span>) &#123;</span><br><span class="line">        off.<span class="built_in">init</span>(N);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;off.A[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; M; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;l, &amp;r);</span><br><span class="line">            off.<span class="built_in">q_add</span>(l, r);</span><br><span class="line">        &#125;</span><br><span class="line">        off.<span class="built_in">run</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; off.ret.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> a = off.ret[i].first;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> b = off.ret[i].second;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> g = <span class="built_in">llgcd</span>(a, b);</span><br><span class="line">            a /= g, b /= g;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld/%lld\n&quot;</span>, a, b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1 1</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">1 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-bzoj-3065" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/22/bzoj-3065/" class="article-date">
  <time datetime="2015-06-22T00:55:28.000Z" itemprop="datePublished">2015-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/22/bzoj-3065/">BZOJ 3065 帶插入區間 K 小值</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/22/bzoj-3065/" data-id="ckpaivc73000pn8vndg6n6qys" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/22/bzoj-3065/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/塊狀鏈表/">塊狀鏈表</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>詢問區間 K 小，額外支持插入一個元素到序列中。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">10 5 8 28 0 19 2 31 1 22 </span><br><span class="line">30</span><br><span class="line">I 6 9</span><br><span class="line">M 1 11</span><br><span class="line">I 8 17</span><br><span class="line">M 1 31</span><br><span class="line">M 6 26</span><br><span class="line">Q 2 7 6</span><br><span class="line">I 23 30</span><br><span class="line">M 31 7</span><br><span class="line">I 22 27</span><br><span class="line">M 26 18</span><br><span class="line">Q 26 17 31</span><br><span class="line">I 5 2</span><br><span class="line">I 18 13</span><br><span class="line">Q 3 3 3</span><br><span class="line">I 27 19</span><br><span class="line">Q 23 23 30</span><br><span class="line">Q 5 13 5</span><br><span class="line">I 3 0</span><br><span class="line">M 15 27</span><br><span class="line">Q 0 28 13</span><br><span class="line">Q 3 29 11</span><br><span class="line">M 2 8</span><br><span class="line">Q 12 5 7</span><br><span class="line">I 30 19</span><br><span class="line">M 11 19</span><br><span class="line">Q 17 8 29</span><br><span class="line">M 29 4</span><br><span class="line">Q 3 0 12</span><br><span class="line">I 7 18</span><br><span class="line">M 29 27</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">28</span><br><span class="line">2</span><br><span class="line">31</span><br><span class="line">0</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">14</span><br><span class="line">27</span><br><span class="line">15</span><br><span class="line">14</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>直接修改可持久化塊狀鏈表的那一題 Zerojudge b411 記憶中的序列 2，把可持久化的記憶體拔掉，這樣就免得記憶體需求過大。出題者是想用替罪羊樹掛另一個平衡樹下去做。應該沒設想到塊狀鏈表在此題的速度也不算差。時限 60 秒大概跑了 30 秒，還不比樹套樹來得慢。</p>
<p>因為有插入操作，不管是主席樹還是函數式線段樹 (這兩個應該是同一個傢伙)，都無法辦到，只能靠可插入的平衡樹。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">65536</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">262144</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnrolledLinkedList</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; A, B;</span><br><span class="line">        Node *next, *alias;</span><br><span class="line">        <span class="built_in">Node</span>() &#123;</span><br><span class="line">            A.<span class="built_in">clear</span>(), B.<span class="built_in">clear</span>(), next = alias = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">Node* <span class="title">real</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (alias)	<span class="keyword">return</span> alias;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (alias) &#123;</span><br><span class="line">                A = alias-&gt;A, B = alias-&gt;B;</span><br><span class="line">                alias = <span class="literal">NULL</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            A.<span class="built_in">insert</span>(A.<span class="built_in">begin</span>() + x, val);</span><br><span class="line">            B.<span class="built_in">resize</span>(A.<span class="built_in">size</span>());</span><br><span class="line">            B[A.<span class="built_in">size</span>()<span class="number">-1</span>] = val;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = (<span class="keyword">int</span>) A.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt; <span class="number">0</span> &amp;&amp; B[i] &lt; B[i<span class="number">-1</span>]; i--)</span><br><span class="line">                <span class="built_in">swap</span>(B[i], B[i<span class="number">-1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> val = A[x];</span><br><span class="line">            A.<span class="built_in">erase</span>(A.<span class="built_in">begin</span>()+x);</span><br><span class="line">            B.<span class="built_in">erase</span>(<span class="built_in">lower_bound</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>(), val));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> t = A[x];</span><br><span class="line">            A[x] = val;</span><br><span class="line">            B.<span class="built_in">erase</span>(<span class="built_in">lower_bound</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>(), t));</span><br><span class="line">            B.<span class="built_in">resize</span>(A.<span class="built_in">size</span>());</span><br><span class="line">            B[A.<span class="built_in">size</span>()<span class="number">-1</span>] = val;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = (<span class="keyword">int</span>) A.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt; <span class="number">0</span> &amp;&amp; B[i] &lt; B[i<span class="number">-1</span>]; i--)</span><br><span class="line">                <span class="built_in">swap</span>(B[i], B[i<span class="number">-1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">relax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            B = A;</span><br><span class="line">            <span class="built_in">sort</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">int</span> PSIZE;</span><br><span class="line">    stack&lt;Node*&gt; mem;</span><br><span class="line">    <span class="function">Node* <span class="title">init</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> n)</span> </span>&#123; <span class="comment">// A[1:n]</span></span><br><span class="line">        <span class="built_in">free</span>();</span><br><span class="line">        PSIZE = <span class="built_in">max</span>((<span class="keyword">int</span>) <span class="built_in">sqrt</span>(n), <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; ; i &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt;= PSIZE) &#123;</span><br><span class="line">                PSIZE = i;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Node *u, *v, *head;</span><br><span class="line">        </span><br><span class="line">        head = <span class="built_in">newNode</span>();</span><br><span class="line">        u = head, v = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (u-&gt;A.<span class="built_in">size</span>() == PSIZE) &#123;</span><br><span class="line">                u-&gt;next = <span class="built_in">newNode</span>();</span><br><span class="line">                v = u, u = u-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            u-&gt;A.<span class="built_in">push_back</span>(A[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (u = head; u != <span class="literal">NULL</span>; u = u-&gt;next)</span><br><span class="line">            u-&gt;<span class="built_in">relax</span>();</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Node* p = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">        mem.<span class="built_in">push</span>(p);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">cloneNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        Node *t = u-&gt;<span class="built_in">real</span>();</span><br><span class="line">        Node *p = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">        *p = *t, p-&gt;next = u-&gt;next, mem.<span class="built_in">push</span>(p);</span><br><span class="line">        <span class="keyword">return</span> p; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">aliasNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        Node *t = u-&gt;<span class="built_in">real</span>();</span><br><span class="line"><span class="comment">//		Node* p = new Node();</span></span><br><span class="line"><span class="comment">//		p-&gt;alias = t, p-&gt;next = u-&gt;next, mem.push(p);</span></span><br><span class="line"><span class="comment">//		return p;</span></span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">erase</span><span class="params">(Node *ver, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        Node *a, *b, *u, *v, *t;</span><br><span class="line">        u = ver, a = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r; u; l = r+<span class="number">1</span>, u = u-&gt;next) &#123;</span><br><span class="line">            r = l + u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (l &lt;= x &amp;&amp; x &lt;= r) &#123;</span><br><span class="line">                t = <span class="built_in">cloneNode</span>(u);</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = t, b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = t, b = b-&gt;next;</span><br><span class="line">                t-&gt;<span class="built_in">erase</span>(x - l);</span><br><span class="line">                t-&gt;next = u-&gt;next;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = <span class="built_in">aliasNode</span>(u), b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = <span class="built_in">aliasNode</span>(u), b = b-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">relaxList</span>(a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">insert</span><span class="params">(Node *ver, <span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        Node *a, *b, *u, *v, *t;</span><br><span class="line">        u = ver, a = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r; u; l = r+<span class="number">1</span>, u = u-&gt;next) &#123;</span><br><span class="line">            r = l + u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (l<span class="number">-1</span> &lt;= x &amp;&amp; x &lt;= r) &#123;</span><br><span class="line">                t = <span class="built_in">cloneNode</span>(u);</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = t, b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = t, b = b-&gt;next;</span><br><span class="line">                t-&gt;<span class="built_in">insert</span>(x - l + <span class="number">1</span>, val);</span><br><span class="line">                t-&gt;next = u-&gt;next;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = <span class="built_in">aliasNode</span>(u), b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = <span class="built_in">aliasNode</span>(u), b = b-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">relaxList</span>(a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">change</span><span class="params">(Node *ver, <span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        Node *a, *b, *u, *v, *t;</span><br><span class="line">        u = ver, a = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r; u; l = r+<span class="number">1</span>, u = u-&gt;next) &#123;</span><br><span class="line">            r = l + u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (l &lt;= x &amp;&amp; x &lt;= r) &#123;</span><br><span class="line">                t = <span class="built_in">cloneNode</span>(u);</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = t, b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = t, b = b-&gt;next;</span><br><span class="line">                t-&gt;<span class="built_in">change</span>(x - l, val);</span><br><span class="line">                t-&gt;next = u-&gt;next;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = <span class="built_in">aliasNode</span>(u), b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = <span class="built_in">aliasNode</span>(u), b = b-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findRank</span><span class="params">(Node *ver, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> val, <span class="keyword">int</span> threshold = INT_MAX)</span> </span>&#123;</span><br><span class="line">        Node *u, *v;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        u = ver;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r; u != <span class="literal">NULL</span>; u = u-&gt;next, l = r+<span class="number">1</span>) &#123;</span><br><span class="line">            r = l + u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">                ret += <span class="built_in">upper_bound</span>(u-&gt;<span class="built_in">real</span>()-&gt;B.<span class="built_in">begin</span>(), u-&gt;<span class="built_in">real</span>()-&gt;B.<span class="built_in">end</span>(), val) - u-&gt;<span class="built_in">real</span>()-&gt;B.<span class="built_in">begin</span>();</span><br><span class="line">                L = r + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((l &lt;= L &amp;&amp; L &lt;= r) || (l &lt;= R &amp;&amp; R &lt;= r)) &#123;</span><br><span class="line">                <span class="keyword">int</span> i = L - l;</span><br><span class="line">                <span class="keyword">while</span> (i &lt; u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &amp;&amp; L &lt;= R) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (u-&gt;<span class="built_in">real</span>()-&gt;A[i] &lt;= val)</span><br><span class="line">                        ret++;</span><br><span class="line">                    i++, L++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ret &gt;= threshold)	<span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(Node *ver, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> k)</span>  </span>&#123;	<span class="comment">// kth-number</span></span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="number">100005</span>, mid, t = <span class="number">0</span>; <span class="comment">// value in A[]</span></span><br><span class="line">        <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">            mid = (l + r)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">findRank</span>(ver, L, R, mid, k) &gt;= k)</span><br><span class="line">                r = mid - <span class="number">1</span>, t = mid;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">mergeNode</span><span class="params">(Node *u, Node *v)</span> </span>&#123;</span><br><span class="line">        Node *p, *q;</span><br><span class="line">        Node *a = <span class="built_in">newNode</span>();</span><br><span class="line">        p = u-&gt;<span class="built_in">real</span>(), q = v-&gt;<span class="built_in">real</span>();</span><br><span class="line">        a-&gt;next = v-&gt;next;</span><br><span class="line">        a-&gt;A.<span class="built_in">insert</span>(a-&gt;A.<span class="built_in">end</span>(), p-&gt;A.<span class="built_in">begin</span>(), p-&gt;A.<span class="built_in">end</span>());</span><br><span class="line">        a-&gt;A.<span class="built_in">insert</span>(a-&gt;A.<span class="built_in">end</span>(), q-&gt;A.<span class="built_in">begin</span>(), q-&gt;A.<span class="built_in">end</span>());</span><br><span class="line">        a-&gt;B.<span class="built_in">resize</span>(a-&gt;A.<span class="built_in">size</span>());</span><br><span class="line">        <span class="built_in">merge</span>(p-&gt;B.<span class="built_in">begin</span>(), p-&gt;B.<span class="built_in">end</span>(), q-&gt;B.<span class="built_in">begin</span>(), q-&gt;B.<span class="built_in">end</span>(), a-&gt;B.<span class="built_in">begin</span>());</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">splitNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        Node *t = u-&gt;<span class="built_in">real</span>();</span><br><span class="line">        Node *a = <span class="built_in">newNode</span>(), *b = <span class="built_in">newNode</span>();</span><br><span class="line">        <span class="keyword">int</span> n = t-&gt;A.<span class="built_in">size</span>()/<span class="number">2</span>;</span><br><span class="line">        a-&gt;next = b, b-&gt;next = u-&gt;next;</span><br><span class="line">        a-&gt;A.<span class="built_in">insert</span>(a-&gt;A.<span class="built_in">begin</span>(), t-&gt;A.<span class="built_in">begin</span>(), t-&gt;A.<span class="built_in">begin</span>()+n);</span><br><span class="line">        b-&gt;A.<span class="built_in">insert</span>(b-&gt;A.<span class="built_in">begin</span>(), t-&gt;A.<span class="built_in">begin</span>()+n, t-&gt;A.<span class="built_in">end</span>());</span><br><span class="line">        a-&gt;<span class="built_in">relax</span>(), b-&gt;<span class="built_in">relax</span>();</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">relaxList</span><span class="params">(Node *ver)</span> </span>&#123;</span><br><span class="line">        Node *a, *b, *u, *v, *t;</span><br><span class="line">        <span class="keyword">int</span> need = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (u = ver, a = <span class="literal">NULL</span>; !need &amp;&amp; u != <span class="literal">NULL</span>; u = u-&gt;next) &#123;</span><br><span class="line">            <span class="keyword">if</span> (u-&gt;next != <span class="literal">NULL</span> &amp;&amp; u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() + u-&gt;next-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &lt; (PSIZE&lt;&lt;<span class="number">1</span>)) <span class="comment">// merge</span></span><br><span class="line">            	need = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &gt; (PSIZE&lt;&lt;<span class="number">1</span>))	<span class="comment">// split</span></span><br><span class="line">            	need = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!need)</span><br><span class="line">        	<span class="keyword">return</span> ver;</span><br><span class="line">        stack&lt;Node*&gt; remove;	<span class="comment">// static used </span></span><br><span class="line">        <span class="keyword">for</span> (u = ver, a = <span class="literal">NULL</span>; u != <span class="literal">NULL</span>; u = u-&gt;next) &#123;</span><br><span class="line">            <span class="keyword">if</span> (u-&gt;next != <span class="literal">NULL</span> &amp;&amp; u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() + u-&gt;next-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &lt; (PSIZE&lt;&lt;<span class="number">1</span>)) &#123;	<span class="comment">// merge</span></span><br><span class="line">            	<span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">            		a = <span class="built_in">mergeNode</span>(u, u-&gt;next), b = a;</span><br><span class="line">            	<span class="keyword">else</span></span><br><span class="line">            		b-&gt;next = <span class="built_in">mergeNode</span>(u, u-&gt;next), b = b-&gt;next;</span><br><span class="line">            	remove.<span class="built_in">push</span>(u), remove.<span class="built_in">push</span>(u-&gt;next); <span class="comment">// static used  </span></span><br><span class="line">                u = u-&gt;next;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &gt; (PSIZE&lt;&lt;<span class="number">1</span>)) &#123;	<span class="comment">// split</span></span><br><span class="line">            	<span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">            		a = <span class="built_in">splitNode</span>(u), b = a-&gt;next;</span><br><span class="line">            	<span class="keyword">else</span></span><br><span class="line">            		b-&gt;next = <span class="built_in">splitNode</span>(u), b = b-&gt;next-&gt;next;</span><br><span class="line">            	remove.<span class="built_in">push</span>(u); <span class="comment">// static used  </span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            	<span class="keyword">if</span> (a == <span class="literal">NULL</span>)	</span><br><span class="line">                    a = <span class="built_in">aliasNode</span>(u), b = a;</span><br><span class="line">            	<span class="keyword">else</span>			</span><br><span class="line">                    b-&gt;next = <span class="built_in">aliasNode</span>(u), b = b-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (!remove.<span class="built_in">empty</span>()) &#123; <span class="comment">// static used  </span></span><br><span class="line">        	u = remove.<span class="built_in">top</span>(), remove.<span class="built_in">pop</span>();</span><br><span class="line">        	<span class="keyword">delete</span> u;</span><br><span class="line">        &#125;	    	</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(Node *head)</span> </span>&#123;</span><br><span class="line">        Node *u = head;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[&quot;</span>);</span><br><span class="line">    	<span class="keyword">while</span> (u != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>(); i++)</span><br><span class="line">            	<span class="built_in">printf</span>(<span class="string">&quot;%d%s&quot;</span>, u-&gt;<span class="built_in">real</span>()-&gt;A[i], i != u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>()<span class="number">-1</span> ? <span class="string">&quot; &quot;</span> : <span class="string">&quot; &quot;</span>);</span><br><span class="line">        	u = u-&gt;next;</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="built_in">puts</span>(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">free</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">while</span> (!mem.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            Node *u = mem.<span class="built_in">top</span>();</span><br><span class="line">            mem.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">delete</span> u;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; dream; </span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> A[MAXN], n, q;</span><br><span class="line">UnrolledLinkedList::Node *ver[MAXQ];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x, y, v;</span><br><span class="line">    <span class="keyword">char</span> cmd[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;A[i]);</span><br><span class="line">        ver[<span class="number">0</span>] = dream.<span class="built_in">init</span>(A, n);</span><br><span class="line"><span class="comment">//		dream.debug(ver[0]);</span></span><br><span class="line">        <span class="keyword">int</span> encrypt = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;q);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, cmd);</span><br><span class="line">            <span class="keyword">if</span> (cmd[<span class="number">0</span>] == <span class="string">&#x27;I&#x27;</span>) &#123;</span><br><span class="line">                <span class="comment">// insert A[x] = v</span></span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;v);</span><br><span class="line">                x ^= encrypt, v ^= encrypt;</span><br><span class="line">                ver[i] = dream.<span class="built_in">insert</span>(ver[i<span class="number">-1</span>], x<span class="number">-1</span>, v);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd[<span class="number">0</span>] == <span class="string">&#x27;Q&#x27;</span>) &#123;</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;x, &amp;y, &amp;v);</span><br><span class="line">                x ^= encrypt, y ^= encrypt, v ^= encrypt;</span><br><span class="line">                <span class="keyword">int</span> t = dream.<span class="built_in">find</span>(ver[i<span class="number">-1</span>], x, y, v);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, t);</span><br><span class="line">                encrypt = t;</span><br><span class="line">                ver[i] = ver[i<span class="number">-1</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd[<span class="number">0</span>] == <span class="string">&#x27;M&#x27;</span>) &#123;</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;v);</span><br><span class="line">                x ^= encrypt, v ^= encrypt;</span><br><span class="line">                ver[i] = dream.<span class="built_in">change</span>(ver[i<span class="number">-1</span>], x, v);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//			dream.debug(ver[i]);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">1 2 3 4 5</span></span><br><span class="line"><span class="comment">9999</span></span><br><span class="line"><span class="comment">4 1 5 2</span></span><br><span class="line"><span class="comment">1 2 1</span></span><br><span class="line"><span class="comment">4 1 5 2</span></span><br><span class="line"><span class="comment">0 1</span></span><br><span class="line"><span class="comment">4 1 5 2</span></span><br><span class="line"><span class="comment">2 1</span></span><br><span class="line"><span class="comment">1 0 5</span></span><br><span class="line"><span class="comment">3 3 9</span></span><br><span class="line"><span class="comment">4 1 1 1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-zj-b412" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/22/zj-b412/" class="article-date">
  <time datetime="2015-06-22T00:38:41.000Z" itemprop="datePublished">2015-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/22/zj-b412/">b412. 記憶中的并查集</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/22/zj-b412/" data-id="ckpaivca000aln8vn7acm5saj" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/22/zj-b412/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/可持久化/">可持久化</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/并查集/">并查集</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>維護一個並查集的操作，並且支持版本回溯。</p>
<ul>
<li>合併兩個堆</li>
<li>詢問兩個元素是否同堆</li>
<li>版本回溯</li>
</ul>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2 5</span><br><span class="line">2 1 2</span><br><span class="line">1 1 2</span><br><span class="line">2 1 2</span><br><span class="line">1 1</span><br><span class="line">3 0 3</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>持久化概念，相當於維護 <code>parent[]</code> 陣列的版本，這一點可以利用可持久化線段樹來維護。</p>
<p>並查集的查詢功能不修改 <code>parent[]</code> 陣列，合併操作卻有可能修改數個 <code>parent[]</code>，為了降低記憶體用量，盡可能少用路徑壓縮這個技巧，雖然在一般並查集都會使用這個來加速，否則很容易變很慢，是因為持久化是會拉低速度，因為持久化需要 <span>$O(\log N)$</span><!-- Has MathJax --> 的時間去更改 <code>parent[]</code>，單筆路徑壓縮長度為 <span>$M$</span><!-- Has MathJax --> 個點，需要 <span>$O(M \log N)$</span><!-- Has MathJax --> 的調整，<span>$M$</span><!-- Has MathJax --> 在並查集中是常數類。</p>
<p>詢問不多時用啟發式合併就好，將小堆的元素合併到大堆中。效能會比較好。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">3000000</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SegementTree</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        Node *lson, *rson;</span><br><span class="line">        pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; val;</span><br><span class="line">    &#125; nodes[MAXN];</span><br><span class="line">    <span class="keyword">int</span> nodesize, L, R;</span><br><span class="line">    <span class="function">Node* <span class="title">init</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        nodesize = <span class="number">0</span>;</span><br><span class="line">        L = l, R = r;</span><br><span class="line">        Node* root = <span class="built_in">build</span>(l, r);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nodesize &gt;= MAXN)</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> &amp;nodes[nodesize++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">cloneNode</span><span class="params">(Node *p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nodesize &gt;= MAXN)</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        Node* u = &amp;nodes[nodesize++];</span><br><span class="line">        *u = *p;</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">build</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l &gt; r)  <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        Node *u = <span class="built_in">newNode</span>();</span><br><span class="line">        u-&gt;lson = u-&gt;rson = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">            u-&gt;val = <span class="built_in">make_pair</span>(l, <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> m = (l + r)/<span class="number">2</span>;</span><br><span class="line">        	u-&gt;lson = <span class="built_in">build</span>(l, m);</span><br><span class="line">        	u-&gt;rson = <span class="built_in">build</span>(m+<span class="number">1</span>, r);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">change</span><span class="params">(Node *p, <span class="keyword">int</span> x, pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; val, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        Node *u = <span class="built_in">cloneNode</span>(p);</span><br><span class="line">        <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        	u-&gt;val = val;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        	<span class="keyword">int</span> mid = (l + r)/<span class="number">2</span>;</span><br><span class="line">        	<span class="keyword">if</span> (x &lt;= mid)</span><br><span class="line">            	u-&gt;lson = <span class="built_in">change</span>(p-&gt;lson, x, val, l, mid);</span><br><span class="line">        	<span class="keyword">else</span></span><br><span class="line">         		u-&gt;rson = <span class="built_in">change</span>(p-&gt;rson, x, val, mid+<span class="number">1</span>, r);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">change</span><span class="params">(Node *p, <span class="keyword">int</span> x, pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">change</span>(p, x, val, L, R);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">find</span><span class="params">(Node *ver, <span class="keyword">int</span> x, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">        	<span class="keyword">return</span> ver-&gt;val;</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= mid)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">find</span>(ver-&gt;lson, x, l, mid);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">find</span>(ver-&gt;rson, x, mid+<span class="number">1</span>, r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">find</span><span class="params">(Node *ver, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">find</span>(ver, x, L, R);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// disjoint set</span></span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">findp</span><span class="params">(Node *ver, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; p = <span class="built_in">find</span>(ver, x);</span><br><span class="line">        <span class="keyword">return</span> x == p.first ? p : <span class="built_in">findp</span>(ver, p.first);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">joint</span><span class="params">(Node *ver, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; a = <span class="built_in">findp</span>(ver, x);</span><br><span class="line">        pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; b = <span class="built_in">findp</span>(ver, y);</span><br><span class="line">        <span class="keyword">if</span> (a.first == b.first)</span><br><span class="line">            <span class="keyword">return</span> ver;</span><br><span class="line">        Node *u = ver;</span><br><span class="line">        <span class="keyword">if</span> (a.second &gt; b.second) &#123;</span><br><span class="line">            u = <span class="built_in">change</span>(u, b.first, <span class="built_in">make_pair</span>(a.first, b.second));</span><br><span class="line">            u = <span class="built_in">change</span>(u, a.first, <span class="built_in">make_pair</span>(a.first, a.second + b.second));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            u = <span class="built_in">change</span>(u, a.first, <span class="built_in">make_pair</span>(b.first, a.second));</span><br><span class="line">            u = <span class="built_in">change</span>(u, b.first, <span class="built_in">make_pair</span>(b.first, a.second + b.second));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; segTree;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">262144</span>;</span><br><span class="line">SegementTree::Node *ver[MAXQ];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m;</span><br><span class="line">    <span class="keyword">int</span> cmd, x, y, v;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m) == <span class="number">2</span>) &#123;</span><br><span class="line">        ver[<span class="number">0</span>] = segTree.<span class="built_in">init</span>(<span class="number">1</span>, n);</span><br><span class="line">        <span class="keyword">int</span> encrypt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;cmd);</span><br><span class="line">            cmd ^= encrypt;</span><br><span class="line">            <span class="keyword">if</span> (cmd == <span class="number">0</span>) &#123; 		<span class="comment">// back</span></span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;v);</span><br><span class="line">                v ^= encrypt;</span><br><span class="line">                ver[i] = ver[v];</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">1</span>) &#123;	<span class="comment">// joint</span></span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;y);</span><br><span class="line">                x ^= encrypt, y ^= encrypt; </span><br><span class="line">                ver[i] = segTree.<span class="built_in">joint</span>(ver[i<span class="number">-1</span>], x, y);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">2</span>) &#123;	<span class="comment">// find</span></span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;y);</span><br><span class="line">                x ^= encrypt, y ^= encrypt;</span><br><span class="line">                pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; a = segTree.<span class="built_in">findp</span>(ver[i<span class="number">-1</span>], x);</span><br><span class="line">                pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; b = segTree.<span class="built_in">findp</span>(ver[i<span class="number">-1</span>], y);</span><br><span class="line">                <span class="keyword">int</span> t = a.first == b.first;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, t);</span><br><span class="line">                ver[i] = ver[i<span class="number">-1</span>];</span><br><span class="line">                encrypt = t;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;WTF&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-zj-b411" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/22/zj-b411/" class="article-date">
  <time datetime="2015-06-22T00:28:54.000Z" itemprop="datePublished">2015-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/22/zj-b411/">b411. 記憶中的序列 2</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/22/zj-b411/" data-id="ckpaivca000akn8vn28b5akin" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/22/zj-b411/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/可持久化/">可持久化</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/塊狀鏈表/">塊狀鏈表</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>動態區間 K 小，有四種操作</p>
<ul>
<li>插入元素</li>
<li>刪除元素</li>
<li>修改元素</li>
<li>版本回溯</li>
<li>詢問某個區間的第 K 小元素</li>
</ul>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">1 2 3 4 5</span><br><span class="line">5</span><br><span class="line">4 1 5 2</span><br><span class="line">3 0 3</span><br><span class="line">6 3 7 0</span><br><span class="line">1 0</span><br><span class="line">5 0 4 3</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>每次操作最多增加 <span>$O(\sqrt{n})$</span><!-- Has MathJax --> 記憶體，需要針對節點作抽象化，修改節點時再進行實體化，如此一來不用針對搜索路徑上的每一節點都進行複製，一般持久化平衡樹進行時，會直接複製整個節點，但塊狀鏈表若是複製下去會退化成時間、空間都是 <span>$O(n)$</span><!-- Has MathJax --> 的情況。</p>
<p>詢問時仍然需要二分搜索答案，看答案是否符合 K 小元素，也就是說要得到某個元素在區間中的排名。</p>
<p>塊狀鏈表代碼很醜，看看就好。如果需要支持修改、增加元素的區間 K 小，雖然複雜度高，但常數小、記憶體快取優勢，速度不比二元樹類型的資料結構來得慢，不管需不需要持久化塊狀鏈表都是這類型不錯的選擇。</p>
<h3 id="另解"><a href="#另解" class="headerlink" title="另解"></a>另解</h3><p>假設詢問為 <span>$Q$</span><!-- Has MathJax --> 個，聽說可以用區間 <span>$[1, 2NQ]$</span><!-- Has MathJax --> 的線段樹之類的超大區間線段樹，必要的探訪時進行開花 (將子節點打開)，利用標記計算相對位置來進行查詢。相對位置計算大概會在邊緣情況崩潰。</p>
<p>至於柳柳州提到的替罪羊樹是樹套樹下去持久化，每一個節點表示一個區間，接著在節點中建造一個平衡樹來查找區間 K 小元素。這樣的做法一樣需要二分搜索答案。但塊狀鏈表在速度跟記憶體都贏了，因為樹套樹的常數比較大，增加的記憶體也多。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">32767</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">131072</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnrolledLinkedList</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; A, B;</span><br><span class="line">        Node *next, *alias;</span><br><span class="line">        <span class="built_in">Node</span>() &#123;</span><br><span class="line">            A.<span class="built_in">clear</span>(), B.<span class="built_in">clear</span>(), next = alias = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">Node* <span class="title">real</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (alias)	<span class="keyword">return</span> alias;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (alias) &#123;</span><br><span class="line">                A = alias-&gt;A, B = alias-&gt;B;</span><br><span class="line">                alias = <span class="literal">NULL</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            A.<span class="built_in">insert</span>(A.<span class="built_in">begin</span>() + x, val);</span><br><span class="line">            B.<span class="built_in">resize</span>(A.<span class="built_in">size</span>());</span><br><span class="line">            B[A.<span class="built_in">size</span>()<span class="number">-1</span>] = val;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = (<span class="keyword">int</span>) A.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt; <span class="number">0</span> &amp;&amp; B[i] &lt; B[i<span class="number">-1</span>]; i--)</span><br><span class="line">                <span class="built_in">swap</span>(B[i], B[i<span class="number">-1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> val = A[x];</span><br><span class="line">            A.<span class="built_in">erase</span>(A.<span class="built_in">begin</span>()+x);</span><br><span class="line">            B.<span class="built_in">erase</span>(<span class="built_in">lower_bound</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>(), val));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> t = A[x];</span><br><span class="line">            A[x] = val;</span><br><span class="line">            B.<span class="built_in">erase</span>(<span class="built_in">lower_bound</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>(), t));</span><br><span class="line">            B.<span class="built_in">resize</span>(A.<span class="built_in">size</span>());</span><br><span class="line">            B[A.<span class="built_in">size</span>()<span class="number">-1</span>] = val;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = (<span class="keyword">int</span>) A.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt; <span class="number">0</span> &amp;&amp; B[i] &lt; B[i<span class="number">-1</span>]; i--)</span><br><span class="line">                <span class="built_in">swap</span>(B[i], B[i<span class="number">-1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">relax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            B = A;</span><br><span class="line">            <span class="built_in">sort</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">int</span> PSIZE;</span><br><span class="line">    stack&lt;Node*&gt; mem;</span><br><span class="line">    <span class="function">Node* <span class="title">init</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> n)</span> </span>&#123; <span class="comment">// A[1:n]</span></span><br><span class="line">        <span class="built_in">free</span>();</span><br><span class="line">        PSIZE = <span class="built_in">max</span>((<span class="keyword">int</span>) <span class="built_in">sqrt</span>(n), <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; ; i &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt;= PSIZE) &#123;</span><br><span class="line">                PSIZE = i;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Node *u, *v, *head;</span><br><span class="line">        </span><br><span class="line">        head = <span class="built_in">newNode</span>();</span><br><span class="line">        u = head, v = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (u-&gt;A.<span class="built_in">size</span>() == PSIZE) &#123;</span><br><span class="line">                u-&gt;next = <span class="built_in">newNode</span>();</span><br><span class="line">                v = u, u = u-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            u-&gt;A.<span class="built_in">push_back</span>(A[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (u = head; u != <span class="literal">NULL</span>; u = u-&gt;next)</span><br><span class="line">            u-&gt;<span class="built_in">relax</span>();</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Node* p = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">        mem.<span class="built_in">push</span>(p);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">cloneNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        Node *t = u-&gt;<span class="built_in">real</span>();</span><br><span class="line">        Node *p = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">        *p = *t, p-&gt;next = u-&gt;next, mem.<span class="built_in">push</span>(p);</span><br><span class="line">        <span class="keyword">return</span> p; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">aliasNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        Node *t = u-&gt;<span class="built_in">real</span>();</span><br><span class="line">        Node* p = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">        p-&gt;alias = t, p-&gt;next = u-&gt;next, mem.<span class="built_in">push</span>(p);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">erase</span><span class="params">(Node *ver, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        Node *a, *b, *u, *v, *t;</span><br><span class="line">        u = ver, a = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r; u; l = r+<span class="number">1</span>, u = u-&gt;next) &#123;</span><br><span class="line">            r = l + u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (l &lt;= x &amp;&amp; x &lt;= r) &#123;</span><br><span class="line">                t = <span class="built_in">cloneNode</span>(u);</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = t, b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = t, b = b-&gt;next;</span><br><span class="line">                t-&gt;<span class="built_in">erase</span>(x - l);</span><br><span class="line">                t-&gt;next = u-&gt;next;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = <span class="built_in">aliasNode</span>(u), b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = <span class="built_in">aliasNode</span>(u), b = b-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">relaxList</span>(a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">insert</span><span class="params">(Node *ver, <span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        Node *a, *b, *u, *v, *t;</span><br><span class="line">        u = ver, a = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r; u; l = r+<span class="number">1</span>, u = u-&gt;next) &#123;</span><br><span class="line">            r = l + u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (l<span class="number">-1</span> &lt;= x &amp;&amp; x &lt;= r) &#123;</span><br><span class="line">                t = <span class="built_in">cloneNode</span>(u);</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = t, b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = t, b = b-&gt;next;</span><br><span class="line">                t-&gt;<span class="built_in">insert</span>(x - l + <span class="number">1</span>, val);</span><br><span class="line">                t-&gt;next = u-&gt;next;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = <span class="built_in">aliasNode</span>(u), b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = <span class="built_in">aliasNode</span>(u), b = b-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">relaxList</span>(a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">change</span><span class="params">(Node *ver, <span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        Node *a, *b, *u, *v, *t;</span><br><span class="line">        u = ver, a = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r; u; l = r+<span class="number">1</span>, u = u-&gt;next) &#123;</span><br><span class="line">            r = l + u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (l &lt;= x &amp;&amp; x &lt;= r) &#123;</span><br><span class="line">                t = <span class="built_in">cloneNode</span>(u);</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = t, b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = t, b = b-&gt;next;</span><br><span class="line">                t-&gt;<span class="built_in">change</span>(x - l, val);</span><br><span class="line">                t-&gt;next = u-&gt;next;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = <span class="built_in">aliasNode</span>(u), b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = <span class="built_in">aliasNode</span>(u), b = b-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findRank</span><span class="params">(Node *ver, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> val, <span class="keyword">int</span> threshold = INT_MAX)</span> </span>&#123;</span><br><span class="line">        Node *u, *v;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        u = ver;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r; u != <span class="literal">NULL</span>; u = u-&gt;next, l = r+<span class="number">1</span>) &#123;</span><br><span class="line">            r = l + u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">                ret += <span class="built_in">upper_bound</span>(u-&gt;<span class="built_in">real</span>()-&gt;B.<span class="built_in">begin</span>(), u-&gt;<span class="built_in">real</span>()-&gt;B.<span class="built_in">end</span>(), val) - u-&gt;<span class="built_in">real</span>()-&gt;B.<span class="built_in">begin</span>();</span><br><span class="line">                L = r + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((l &lt;= L &amp;&amp; L &lt;= r) || (l &lt;= R &amp;&amp; R &lt;= r)) &#123;</span><br><span class="line">                <span class="keyword">int</span> i = L - l;</span><br><span class="line">                <span class="keyword">while</span> (i &lt; u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &amp;&amp; L &lt;= R) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (u-&gt;<span class="built_in">real</span>()-&gt;A[i] &lt;= val)</span><br><span class="line">                        ret++;</span><br><span class="line">                    i++, L++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ret &gt;= threshold)	<span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(Node *ver, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> k)</span>  </span>&#123;	<span class="comment">// kth-number</span></span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="number">100000</span>, mid, t = <span class="number">0</span>; <span class="comment">// value in A[]</span></span><br><span class="line">        <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">            mid = (l + r)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">findRank</span>(ver, L, R, mid, k) &gt;= k)</span><br><span class="line">                r = mid - <span class="number">1</span>, t = mid;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">mergeNode</span><span class="params">(Node *u, Node *v)</span> </span>&#123;</span><br><span class="line">        Node *p, *q;</span><br><span class="line">        Node *a = <span class="built_in">newNode</span>();</span><br><span class="line">        p = u-&gt;<span class="built_in">real</span>(), q = v-&gt;<span class="built_in">real</span>();</span><br><span class="line">        a-&gt;next = v-&gt;next;</span><br><span class="line">        a-&gt;A.<span class="built_in">insert</span>(a-&gt;A.<span class="built_in">end</span>(), p-&gt;A.<span class="built_in">begin</span>(), p-&gt;A.<span class="built_in">end</span>());</span><br><span class="line">        a-&gt;A.<span class="built_in">insert</span>(a-&gt;A.<span class="built_in">end</span>(), q-&gt;A.<span class="built_in">begin</span>(), q-&gt;A.<span class="built_in">end</span>());</span><br><span class="line">        a-&gt;B.<span class="built_in">resize</span>(a-&gt;A.<span class="built_in">size</span>());</span><br><span class="line">        <span class="built_in">merge</span>(p-&gt;B.<span class="built_in">begin</span>(), p-&gt;B.<span class="built_in">end</span>(), q-&gt;B.<span class="built_in">begin</span>(), q-&gt;B.<span class="built_in">end</span>(), a-&gt;B.<span class="built_in">begin</span>());</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">splitNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        Node *t = u-&gt;<span class="built_in">real</span>();</span><br><span class="line">        Node *a = <span class="built_in">newNode</span>(), *b = <span class="built_in">newNode</span>();</span><br><span class="line">        <span class="keyword">int</span> n = t-&gt;A.<span class="built_in">size</span>()/<span class="number">2</span>;</span><br><span class="line">        a-&gt;next = b, b-&gt;next = u-&gt;next;</span><br><span class="line">        a-&gt;A.<span class="built_in">insert</span>(a-&gt;A.<span class="built_in">begin</span>(), t-&gt;A.<span class="built_in">begin</span>(), t-&gt;A.<span class="built_in">begin</span>()+n);</span><br><span class="line">        b-&gt;A.<span class="built_in">insert</span>(b-&gt;A.<span class="built_in">begin</span>(), t-&gt;A.<span class="built_in">begin</span>()+n, t-&gt;A.<span class="built_in">end</span>());</span><br><span class="line">        a-&gt;<span class="built_in">relax</span>(), b-&gt;<span class="built_in">relax</span>();</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">relaxList</span><span class="params">(Node *ver)</span> </span>&#123;</span><br><span class="line">        Node *a, *b, *u, *v, *t;</span><br><span class="line">        <span class="keyword">int</span> need = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (u = ver, a = <span class="literal">NULL</span>; !need &amp;&amp; u != <span class="literal">NULL</span>; u = u-&gt;next) &#123;</span><br><span class="line">            <span class="keyword">if</span> (u-&gt;next != <span class="literal">NULL</span> &amp;&amp; u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() + u-&gt;next-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &lt; (PSIZE&lt;&lt;<span class="number">1</span>)) <span class="comment">// merge</span></span><br><span class="line">            	need = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &gt; (PSIZE&lt;&lt;<span class="number">1</span>))	<span class="comment">// split</span></span><br><span class="line">            	need = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!need)</span><br><span class="line">        	<span class="keyword">return</span> ver;</span><br><span class="line">        	</span><br><span class="line">        <span class="keyword">for</span> (u = ver, a = <span class="literal">NULL</span>; u != <span class="literal">NULL</span>; u = u-&gt;next) &#123;</span><br><span class="line">            <span class="keyword">if</span> (u-&gt;next != <span class="literal">NULL</span> &amp;&amp; u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() + u-&gt;next-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &lt; (PSIZE&lt;&lt;<span class="number">1</span>)) &#123;	<span class="comment">// merge</span></span><br><span class="line">            	<span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">            		a = <span class="built_in">mergeNode</span>(u, u-&gt;next), b = a;</span><br><span class="line">            	<span class="keyword">else</span></span><br><span class="line">            		b-&gt;next = <span class="built_in">mergeNode</span>(u, u-&gt;next), b = b-&gt;next;</span><br><span class="line">                u = u-&gt;next;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &gt; (PSIZE&lt;&lt;<span class="number">1</span>)) &#123;	<span class="comment">// split</span></span><br><span class="line">            	<span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">            		a = <span class="built_in">splitNode</span>(u), b = a-&gt;next;</span><br><span class="line">            	<span class="keyword">else</span></span><br><span class="line">            		b-&gt;next = <span class="built_in">splitNode</span>(u), b = b-&gt;next-&gt;next;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            	<span class="keyword">if</span> (a == <span class="literal">NULL</span>)	</span><br><span class="line">                    a = <span class="built_in">aliasNode</span>(u), b = a;</span><br><span class="line">            	<span class="keyword">else</span>			</span><br><span class="line">                    b-&gt;next = <span class="built_in">aliasNode</span>(u), b = b-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(Node *head)</span> </span>&#123;</span><br><span class="line">        Node *u = head;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[&quot;</span>);</span><br><span class="line">    	<span class="keyword">while</span> (u != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>(); i++)</span><br><span class="line">            	<span class="built_in">printf</span>(<span class="string">&quot;%d%s&quot;</span>, u-&gt;<span class="built_in">real</span>()-&gt;A[i], i != u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>()<span class="number">-1</span> ? <span class="string">&quot; &quot;</span> : <span class="string">&quot; &quot;</span>);</span><br><span class="line">        	u = u-&gt;next;</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="built_in">puts</span>(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">free</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (!mem.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            Node *u = mem.<span class="built_in">top</span>();</span><br><span class="line">            mem.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">delete</span> u;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; dream; </span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> A[MAXN], n, q;</span><br><span class="line">UnrolledLinkedList::Node *ver[MAXQ];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x, y, v, cmd;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;A[i]);</span><br><span class="line">        ver[<span class="number">0</span>] = dream.<span class="built_in">init</span>(A, n);</span><br><span class="line"><span class="comment">//		dream.debug(ver[0]);</span></span><br><span class="line">        <span class="keyword">int</span> encrypt = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;q);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;cmd);</span><br><span class="line">            cmd ^= encrypt;</span><br><span class="line">            <span class="keyword">if</span> (cmd == <span class="number">0</span>) &#123;			<span class="comment">// back version v</span></span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;v);</span><br><span class="line">                v ^= encrypt;</span><br><span class="line">                ver[i] = ver[v];</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">1</span>) &#123; 	<span class="comment">// insert A[x] = v</span></span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;v);</span><br><span class="line">                x ^= encrypt, v ^= encrypt;</span><br><span class="line">                ver[i] = dream.<span class="built_in">insert</span>(ver[i<span class="number">-1</span>], x, v);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">2</span>) &#123;	<span class="comment">// delete A[x]</span></span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">                x ^= encrypt;</span><br><span class="line">                ver[i] = dream.<span class="built_in">erase</span>(ver[i<span class="number">-1</span>], x);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">3</span>) &#123;	<span class="comment">// make A[x] = v</span></span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;v);</span><br><span class="line">                x ^= encrypt, v ^= encrypt;</span><br><span class="line">                ver[i] = dream.<span class="built_in">change</span>(ver[i<span class="number">-1</span>], x, v);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">4</span>) &#123;</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;x, &amp;y, &amp;v);</span><br><span class="line">                x ^= encrypt, y ^= encrypt, v ^= encrypt;</span><br><span class="line">                <span class="keyword">int</span> t = dream.<span class="built_in">find</span>(ver[i<span class="number">-1</span>], x, y, v);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, t);</span><br><span class="line">                encrypt = t;</span><br><span class="line">                ver[i] = ver[i<span class="number">-1</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;WTF&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//			dream.debug(ver[i]);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/categories/解題區/page/11/">&laquo; Prev</a><a class="page-number" href="/categories/解題區/">1</a><span class="space">&hellip;</span><a class="page-number" href="/categories/解題區/page/10/">10</a><a class="page-number" href="/categories/解題區/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/categories/解題區/page/13/">13</a><a class="page-number" href="/categories/解題區/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/categories/解題區/page/64/">64</a><a class="extend next" rel="next" href="/categories/解題區/page/13/">Next &raquo;</a>
    </nav>
  
</section>
          
          
            <aside id="sidebar">
  <!-- <div id="ukagaka_panel"></div> -->
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">115</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算機圖學/">計算機圖學</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/">工作應用</a><span class="category-list-count">30</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Java/">Java</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Meme/">Meme</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/可持久化/">可持久化</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/鬼故事/">鬼故事</a><span class="category-list-count">9</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">44</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">633</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">483</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">77</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">45</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2021/05/30/java/java-memory-optimization-1/">
              
                <i class="icon-file-o"></i> 
              
            Java 優化內存使用 結構篇</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/diary-202101/">
              
                <i class="icon-file-o"></i> 
              
            二八進展</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-file-extension/">
              
                <i class="icon-file-o"></i> 
              
            File Extension</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-globl-var/">
              
                <i class="icon-file-o"></i> 
              
            Global Variable</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-handover/">
              
                <i class="icon-file-o"></i> 
              
            Handover</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-interview-recursion/">
              
                <i class="icon-file-o"></i> 
              
            Interview &amp; Recursion</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-job-build/">
              
                <i class="icon-file-o"></i> 
              
            Job Build</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-lang/">
              
                <i class="icon-file-o"></i> 
              
            Programming Language Impostors</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-machine-learning-newbie/">
              
                <i class="icon-file-o"></i> 
              
            Machine Learning for Newbie</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-parallel-gc/">
              
                <i class="icon-file-o"></i> 
              
            Parallel &amp; Garbage Collection</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
<script type="text/javascript">
  $('#ukagaka_panel').ukagaka();
</script>
  
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2021 Shiang-Yun Yang 
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>