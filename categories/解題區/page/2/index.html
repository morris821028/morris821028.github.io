<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Category: 解題區 | Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Morris&#39; Blog">
<meta property="og:url" content="http://morris821028.github.io/categories/解題區/page/2/index.html">
<meta property="og:site_name" content="Morris&#39; Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris&#39; Blog">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
  <link rel="import" href="/bower_components/app-layout/app-layout.html"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          
          <section id="main">
  
    <article id="post-2017-google-code-jam-qr" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/09/2017-google-code-jam-qr/" class="article-date">
  <time datetime="2017-04-09T06:21:32.000Z" itemprop="datePublished">2017-04-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/KrHRAeT.jpg" rel="gallery_ckpaivc6z000hn8vn4qrk9cga">
        <img src="http://i.imgur.com/KrHRAeT.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/09/2017-google-code-jam-qr/">2017 Google Code Jam Round QR</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/04/09/2017-google-code-jam-qr/" data-id="ckpaivc6z000hn8vn4qrk9cga" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/04/09/2017-google-code-jam-qr/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/二分匹配/">二分匹配</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/數學/">數學</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/貪心/">貪心</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <p>「在 24 小時內想不到解法，就註定這一生為處男」－《解題暴君》</p>
<blockquote>
<p>感謝小夥伴們、茵可、妮可的提醒和翻譯，提醒要比賽，結果題目意思猜了一個下午 …</p>
</blockquote>
<h2 id="A-Oversized-Pancake-Flipper"><a href="#A-Oversized-Pancake-Flipper" class="headerlink" title="A. Oversized Pancake Flipper"></a>A. Oversized Pancake Flipper</h2><p>有 <span>$N$</span><!-- Has MathJax --> 個煎餅排成一列，每個煎餅有正反兩面，分別以 <code>+</code> 和 <code>-</code> 表示，現在有一個超大的煎餅翻轉氣，一次可以翻轉恰好連續 <span>$K$</span><!-- Has MathJax --> 個煎餅的狀態，若一次不滿 <span>$K$</span><!-- Has MathJax --> 視為無效操作。給予起始盤面，請問至少要操作幾次才能使其全部都成為正面。</p>
<p>由邊界開始觀察，最左的正面一定不再被翻，如果翻了必然為多一次操作，不斷地推移下去，只有最左邊的反面要依序翻轉，貪心模擬即可。</p>
<h2 id="B-Tidy-Numbers"><a href="#B-Tidy-Numbers" class="headerlink" title="B. Tidy Numbers"></a>B. Tidy Numbers</h2><p>要找到一種特別的數字，這些數字滿足從高位到低位的每一位呈現非嚴格遞減，請問從數字 <span>$1$</span><!-- Has MathJax --> 判斷到 <span>$N$</span><!-- Has MathJax --> 最後一個滿足的數字為何。</p>
<p>最直觀的方案就 <span>$N$</span><!-- Has MathJax --> 開始倒退過去找第一個符合的解。為解決大測資，<span>$N$</span><!-- Has MathJax --> 大到不太可能窮舉，即便很容易出現 <code>???999999</code> 的解，我們可以用更簡單的貪心算法找到這個小於等於 <span>$N$</span><!-- Has MathJax --> 的解。</p>
<ul>
<li>例如輸入為 423</li>
<li>從最高位開始窮舉，第一位不能放 4，其原因在於貪心 444 已經大於 423，退而求其次 333 是可行的一組解</li>
<li>接著再考慮下一位時，我們不必要求小於等於 2，因為前一次窮舉保證小於 423，直接從 9 開始嘗試 399 是否符合解 … 類推。</li>
</ul>
<p>這樣的解法效能為 <span>$O(m^2)$</span><!-- Has MathJax -->，由於位數很小，就可以偷懶地去寫它。</p>
<h2 id="C-Bathroom-Stalls"><a href="#C-Bathroom-Stalls" class="headerlink" title="C. Bathroom Stalls"></a>C. Bathroom Stalls</h2><p>在公共澡堂中，有 <span>$N$</span><!-- Has MathJax --> 個位子排成一列，最左和最右有守衛。現在 <span>$M$</span><!-- Has MathJax --> 名使用者依照順序進入澡堂，每一個人會遠則離其他人盡可能遠的位置，意即往左和往右到第一個人的距離最小值最大化，往左距離為 <span>$L_s$</span><!-- Has MathJax --> 往右為 <span>$R_s$</span><!-- Has MathJax -->，這樣的位置也許會有好幾個，這時候優先選擇 <span>$\max(L_s, R_s)$</span><!-- Has MathJax --> 最大的那一個 (也就是盡可能靠左側)。請問最後一個人的 <span>$\max(L_s, R_s)$</span><!-- Has MathJax --> 和 <span>$\min(L_s, R_s)$</span><!-- Has MathJax --> 分別為多少？</p>
<p>若使用純模擬，時間複雜度可能高達 <span>$O(NM)$</span><!-- Has MathJax -->，大測資是無法在時間內通過的。仔細觀察到題目並未要求找到最後一個人的所在位置，在數學推敲上並不要求太高，那麼我們轉向繼續連續為空的區段分別有多少個。</p>
<ul>
<li>例如一開始長度為 <span>$N=10$</span><!-- Has MathJax --></li>
<li>有一段長度為 10，第一個人必然會將這一個分成兩段 4 和 5</li>
<li>下一個人則會把 5 再分成 2 和 2</li>
<li>下一個人則會把 4 再分成 1 和 2</li>
</ul>
<p>計算過程中，我們按照長度高到低依序挑出，便可以知道最終的結果。為了加速運算，需要紀錄某個長度有多少個，一次統計會使用相同挑選方案的人，來逼近最終的 <span>$M$</span><!-- Has MathJax --> 個人。時間複雜度 <span>$O(\log N)$</span><!-- Has MathJax -->？</p>
<h2 id="D-Fashion-Show"><a href="#D-Fashion-Show" class="headerlink" title="D. Fashion Show"></a>D. Fashion Show</h2><p>在一個方型時尚展場中，我們可以放置 3 種不同的服裝，分別為 <code>+</code>, <code>x</code>, <code>o</code> 三種，其中 <code>+</code>, <code>x</code> 可以為展場增添 1 分，<code>o</code> 可以增添 2 分，我們希望按照下述的規則使得展場總分最高：</p>
<ul>
<li>對於同行或者同列的放置服裝，任兩個之中，至少要有一個為 <code>+</code></li>
<li>對於斜對角 45 度的放置服裝，任兩個之中，至少要有一個為 <code>x</code></li>
</ul>
<p>現在給予一個空的展場和一些已經放置服裝的位置，你只能升級 <code>+</code>, <code>x</code> 服裝為 <code>o</code> 和增加新的服裝在空位置上，使得分數最高，輸出其中一組解即可。</p>
<p>如果只看行列，通常我們可以轉換成二分匹配，其中 <code>(行 i) -- (列 j)</code> 表明了一種放置方案，而中間的匹配邊成為最終的放置選擇。現在多了斜對角，匹配成為最難處理的部份，</p>
<p>題目的規則可以轉換成，行列最多放置一個非 <code>+</code>，同理對角最多放置一個非 <code>x</code>。按照原先的匹配思路，如果放置 <code>x</code>，則相當於匹配某行某列。同理，放置 <code>+</code>，則相當於匹配某斜和某反斜。這裡我們發現如果同時匹配，則視為 <code>o</code>，其匹配數恰好符合題目要求的得分。</p>
<p>對於已經擺設上去的點，預先將其匹配，並且那些行、列、斜線及反斜的代表點則不再與其他節點匹配，最後，我們構造節點個數為 <span>$6N$</span><!-- Has MathJax --> 的二分匹配圖，運行匈牙利或者是最大流算法都可解決。</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><h3 id="A"><a href="#A" class="headerlink" title="A"></a>A</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>, K;</span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">1024</span>];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span> (testcase--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s %d&quot;</span>, s, &amp;K);</span><br><span class="line">        <span class="keyword">int</span> n = <span class="built_in">strlen</span>(s);</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>, valid = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s[i] == <span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (i+K &lt;= n) &#123;</span><br><span class="line">                ret++;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; K; j++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (s[i+j] == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">                        s[i+j] = <span class="string">&#x27;+&#x27;</span>;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        s[i+j] = <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        valid = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            valid &amp;= s[i] == <span class="string">&#x27;+&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (valid)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %d\n&quot;</span>, ++cases, ret);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: IMPOSSIBLE\n&quot;</span>, ++cases);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="B"><a href="#B" class="headerlink" title="B"></a>B</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">uint64_t</span> N;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span> (testcase--) &#123;</span><br><span class="line">        <span class="keyword">char</span> s[<span class="number">1024</span>];</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">        <span class="built_in">sscanf</span>(s, <span class="string">&quot;%llu&quot;</span>, &amp;N);</span><br><span class="line">        <span class="keyword">int</span> n = <span class="built_in">strlen</span>(s);</span><br><span class="line">        <span class="keyword">uint64_t</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> begin_small = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> prev = ret%<span class="number">10</span>;</span><br><span class="line">            <span class="keyword">int</span> st = begin_small ? <span class="number">9</span> : (s[i]-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = st; j &gt;= prev; j--) &#123;</span><br><span class="line">                <span class="keyword">uint64_t</span> test = ret;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = i; k &lt; n; k++)</span><br><span class="line">                    test = test*<span class="number">10</span> + j;</span><br><span class="line">                <span class="keyword">if</span> (test &lt;= N) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!begin_small &amp;&amp; j != s[i]-<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                        begin_small = <span class="number">1</span>;</span><br><span class="line">                    ret = ret*<span class="number">10</span> + j;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %llu\n&quot;</span>, ++cases, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="C"><a href="#C" class="headerlink" title="C"></a>C</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span> (testcase--) &#123;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> n, m;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld %lld&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">        map&lt;<span class="keyword">long</span> <span class="keyword">long</span>, <span class="keyword">long</span> <span class="keyword">long</span>&gt; S;</span><br><span class="line">        S[n] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> ret1 = <span class="number">-1</span>, ret2 = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span> (m) &#123;</span><br><span class="line">            pair&lt;<span class="keyword">long</span> <span class="keyword">long</span>, <span class="keyword">long</span> <span class="keyword">long</span>&gt; e = *S.<span class="built_in">rbegin</span>();</span><br><span class="line">            S.<span class="built_in">erase</span>(e.first);</span><br><span class="line">            <span class="keyword">if</span> (e.second &gt;= m) &#123;</span><br><span class="line">                ret1 = e.first/<span class="number">2</span>, ret2 = (e.first<span class="number">-1</span>)/<span class="number">2</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            m -= e.second;</span><br><span class="line">            <span class="keyword">if</span> (e.first%<span class="number">2</span>) &#123;</span><br><span class="line">                <span class="keyword">long</span> <span class="keyword">long</span> t = e.first/<span class="number">2</span>;</span><br><span class="line">                S[t] += <span class="number">2LL</span>*e.second;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">long</span> <span class="keyword">long</span> t = e.first/<span class="number">2</span>;</span><br><span class="line">                S[t] += e.second;</span><br><span class="line">                S[t<span class="number">-1</span>] += e.second;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %lld %lld\n&quot;</span>, ++cases, ret1, ret2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="D"><a href="#D" class="headerlink" title="D"></a>D</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">40010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXE = MAXV * <span class="number">200</span> * <span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1</span>&lt;&lt;<span class="number">29</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, cap, flow;</span><br><span class="line">    Edge *next, *re;</span><br><span class="line">&#125; Edge;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MaxFlow</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    Edge edge[MAXE], *adj[MAXV], *pre[MAXV], *arc[MAXV];</span><br><span class="line">    <span class="keyword">int</span> e, n, level[MAXV], lvCnt[MAXV], Q[MAXV];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        n = x, e = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) adj[i] = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Addedge</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> flow)</span></span>&#123;</span><br><span class="line">        edge[e].v = y, edge[e].cap = flow, edge[e].next = adj[x];</span><br><span class="line">        edge[e].re = &amp;edge[e+<span class="number">1</span>], adj[x] = &amp;edge[e++];</span><br><span class="line">        edge[e].v = x, edge[e].cap = <span class="number">0</span>, edge[e].next = adj[y];</span><br><span class="line">        edge[e].re = &amp;edge[e<span class="number">-1</span>], adj[y] = &amp;edge[e++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Bfs</span><span class="params">(<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> front = <span class="number">0</span>, rear = <span class="number">0</span>, r = <span class="number">0</span>, dis = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) level[i] = n, lvCnt[i] = <span class="number">0</span>;</span><br><span class="line">        level[v] = <span class="number">0</span>, ++lvCnt[<span class="number">0</span>];</span><br><span class="line">        Q[rear++] = v;</span><br><span class="line">        <span class="keyword">while</span> (front != rear)&#123;</span><br><span class="line">            <span class="keyword">if</span> (front == r) ++dis, r = rear;</span><br><span class="line">            v = Q[front++];</span><br><span class="line">            <span class="keyword">for</span> (Edge *i = adj[v]; i != <span class="literal">NULL</span>; i = i-&gt;next) &#123;</span><br><span class="line">                <span class="keyword">int</span> t = i-&gt;v;</span><br><span class="line">                <span class="keyword">if</span> (level[t] == n) level[t] = dis, Q[rear++] = t, ++lvCnt[dis];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Maxflow</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>, i, j;</span><br><span class="line">        <span class="built_in">Bfs</span>(t);</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) pre[i] = <span class="literal">NULL</span>, arc[i] = adj[i];</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; e; ++i) edge[i].flow = edge[i].cap;</span><br><span class="line">        i = s;</span><br><span class="line">        <span class="keyword">while</span> (level[s] &lt; n)&#123;</span><br><span class="line">            <span class="keyword">while</span> (arc[i] &amp;&amp; (level[i] != level[arc[i]-&gt;v]+<span class="number">1</span> || !arc[i]-&gt;flow)) </span><br><span class="line">                arc[i] = arc[i]-&gt;next;</span><br><span class="line">            <span class="keyword">if</span> (arc[i])&#123;</span><br><span class="line">                j = arc[i]-&gt;v;</span><br><span class="line">                pre[j] = arc[i];</span><br><span class="line">                i = j;</span><br><span class="line">                <span class="keyword">if</span> (i == t)&#123;</span><br><span class="line">                    <span class="keyword">int</span> update = INF;</span><br><span class="line">                    <span class="keyword">for</span> (Edge *p = pre[t]; p != <span class="literal">NULL</span>; p = pre[p-&gt;re-&gt;v])</span><br><span class="line">                        <span class="keyword">if</span> (update &gt; p-&gt;flow) update = p-&gt;flow;</span><br><span class="line">                    ret += update;</span><br><span class="line">                    <span class="keyword">for</span> (Edge *p = pre[t]; p != <span class="literal">NULL</span>; p = pre[p-&gt;re-&gt;v])</span><br><span class="line">                        p-&gt;flow -= update, p-&gt;re-&gt;flow += update;</span><br><span class="line">                    i = s;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">int</span> depth = n<span class="number">-1</span>;</span><br><span class="line">                <span class="keyword">for</span> (Edge *p = adj[i]; p != <span class="literal">NULL</span>; p = p-&gt;next)</span><br><span class="line">                    <span class="keyword">if</span> (p-&gt;flow &amp;&amp; depth &gt; level[p-&gt;v]) depth = level[p-&gt;v];</span><br><span class="line">                <span class="keyword">if</span> (--lvCnt[level[i]] == <span class="number">0</span>) <span class="keyword">return</span> ret;</span><br><span class="line">                level[i] = depth+<span class="number">1</span>;</span><br><span class="line">                ++lvCnt[level[i]];</span><br><span class="line">                arc[i] = adj[i];</span><br><span class="line">                <span class="keyword">if</span> (i != s) i = pre[i]-&gt;re-&gt;v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; g;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span> (testcase--) &#123;</span><br><span class="line">        <span class="keyword">int</span> n, m;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">        </span><br><span class="line">        g.<span class="built_in">Init</span>(<span class="number">6</span>*n+<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> mm[<span class="number">800</span>][<span class="number">800</span>];</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> mmPos[<span class="number">800</span>][<span class="number">800</span>][<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(mm, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(mm));</span><br><span class="line">        <span class="keyword">int</span> source = <span class="number">6</span>*n+<span class="number">1</span>, sink = <span class="number">6</span>*n+<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> board[<span class="number">128</span>][<span class="number">128</span>] = &#123;&#125;;</span><br><span class="line">        <span class="keyword">int</span> <span class="keyword">board_t</span>[<span class="number">128</span>][<span class="number">128</span>] = &#123;&#125;;</span><br><span class="line">        <span class="keyword">char</span> board_s[<span class="number">128</span>][<span class="number">128</span>] = &#123;&#125;;</span><br><span class="line">        <span class="keyword">int</span> ban[<span class="number">800</span>] = &#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                mm[i][j+n] = <span class="number">1</span>;</span><br><span class="line">                mm[(i+j)+<span class="number">2</span>*n][(i-j+n<span class="number">-1</span>)+<span class="number">4</span>*n] = <span class="number">1</span>;</span><br><span class="line">                mmPos[i][j+n][<span class="number">0</span>] = i;</span><br><span class="line">                mmPos[i][j+n][<span class="number">1</span>] = j;</span><br><span class="line">                mmPos[(i+j)+<span class="number">2</span>*n][(i-j+n<span class="number">-1</span>)+<span class="number">4</span>*n][<span class="number">0</span>] = i;</span><br><span class="line">                mmPos[(i+j)+<span class="number">2</span>*n][(i-j+n<span class="number">-1</span>)+<span class="number">4</span>*n][<span class="number">1</span>] = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> s[<span class="number">16</span>];</span><br><span class="line">            <span class="keyword">int</span> x, y;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s %d %d&quot;</span>, s, &amp;x, &amp;y);</span><br><span class="line">            x--, y--;</span><br><span class="line">            board_s[x][y] = s[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span> (s[<span class="number">0</span>] == <span class="string">&#x27;o&#x27;</span>) &#123;</span><br><span class="line">                ret += <span class="number">2</span>, board[x][y] = <span class="number">2</span>;</span><br><span class="line">                ban[x] = <span class="number">1</span>, ban[y+n] = <span class="number">1</span>;</span><br><span class="line">                ban[(x+y)+(<span class="number">2</span>*n)] = <span class="number">1</span>;</span><br><span class="line">                ban[(x-y+n<span class="number">-1</span>)+<span class="number">4</span>*n] = <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[<span class="number">0</span>] == <span class="string">&#x27;+&#x27;</span>) &#123;</span><br><span class="line">                ret += <span class="number">1</span>, board[x][y] = <span class="number">1</span>;</span><br><span class="line">                ban[(x+y)+(<span class="number">2</span>*n)] = <span class="number">1</span>;</span><br><span class="line">                ban[(x-y+n<span class="number">-1</span>)+<span class="number">4</span>*n] = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//				printf(&quot;%d %d\n&quot;, x+y+2*n, x-y+n-1+4*n);</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[<span class="number">0</span>] == <span class="string">&#x27;x&#x27;</span>) &#123;</span><br><span class="line">                ret += <span class="number">1</span>, board[x][y] = <span class="number">1</span>;</span><br><span class="line">                ban[x] = <span class="number">1</span>, ban[y+n] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">memcpy</span>(<span class="keyword">board_t</span>, board, <span class="built_in"><span class="keyword">sizeof</span></span>(board));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            g.<span class="built_in">Addedge</span>(source, i, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>*n; i &lt; <span class="number">4</span>*n; i++)</span><br><span class="line">            g.<span class="built_in">Addedge</span>(source, i, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &lt; <span class="number">2</span>*n; i++)</span><br><span class="line">            g.<span class="built_in">Addedge</span>(i, sink, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">4</span>*n; i &lt; <span class="number">6</span>*n; i++)</span><br><span class="line">            g.<span class="built_in">Addedge</span>(i, sink, <span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = n; j &lt; <span class="number">2</span>*n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (ban[i] || ban[j] || !mm[i][j])</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                g.<span class="built_in">Addedge</span>(i, j, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>*n; i &lt; <span class="number">4</span>*n<span class="number">-1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">4</span>*n; j &lt; <span class="number">6</span>*n<span class="number">-1</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (ban[i] || ban[j] || !mm[i][j])</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                g.<span class="built_in">Addedge</span>(i, j, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> flow = g.<span class="built_in">Maxflow</span>(source, sink);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Edge *p = g.adj[i]; p != <span class="literal">NULL</span>; p = p-&gt;next) &#123;</span><br><span class="line">                <span class="keyword">if</span> (p-&gt;v &gt;= n &amp;&amp; p-&gt;v &lt; <span class="number">2</span>*n &amp;&amp; p-&gt;flow == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">board_t</span>[mmPos[i][p-&gt;v][<span class="number">0</span>]][mmPos[i][p-&gt;v][<span class="number">1</span>]]++;</span><br><span class="line"><span class="comment">//					printf(&quot;---- %d %d\n&quot;, mmPos[i][p-&gt;v][0], mmPos[i][p-&gt;v][1]);</span></span><br><span class="line">                    board_s[mmPos[i][p-&gt;v][<span class="number">0</span>]][mmPos[i][p-&gt;v][<span class="number">1</span>]] = <span class="string">&#x27;x&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>*n; i &lt; <span class="number">4</span>*n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Edge *p = g.adj[i]; p != <span class="literal">NULL</span>; p = p-&gt;next) &#123;</span><br><span class="line">                <span class="keyword">if</span> (p-&gt;v &gt;= <span class="number">4</span>*n &amp;&amp; p-&gt;v &lt; <span class="number">6</span>*n &amp;&amp; p-&gt;flow == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">board_t</span>[mmPos[i][p-&gt;v][<span class="number">0</span>]][mmPos[i][p-&gt;v][<span class="number">1</span>]]++;</span><br><span class="line"><span class="comment">//					printf(&quot;---- %d %d\n&quot;, mmPos[i][p-&gt;v][0], mmPos[i][p-&gt;v][1]);</span></span><br><span class="line">                    board_s[mmPos[i][p-&gt;v][<span class="number">0</span>]][mmPos[i][p-&gt;v][<span class="number">1</span>]] = <span class="string">&#x27;+&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">DD</span> &#123;</span></span><br><span class="line">            <span class="keyword">int</span> x, y;</span><br><span class="line">            <span class="keyword">char</span> val;</span><br><span class="line">            <span class="built_in">DD</span>(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">char</span> val): <span class="built_in">x</span>(x), <span class="built_in">y</span>(y), <span class="built_in">val</span>(val) &#123;&#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        vector&lt;DD&gt; V;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">board_t</span>[i][j] != board[i][j]) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">board_t</span>[i][j] == <span class="number">2</span>)</span><br><span class="line">                        V.<span class="built_in">push_back</span>(<span class="built_in">DD</span>(i+<span class="number">1</span>, j+<span class="number">1</span>, <span class="string">&#x27;o&#x27;</span>));</span><br><span class="line"><span class="comment">//						printf(&quot;o %d %d\n&quot;, i+1, j+1);</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">board_t</span>[i][j] == <span class="number">1</span>)</span><br><span class="line">                        V.<span class="built_in">push_back</span>(<span class="built_in">DD</span>(i+<span class="number">1</span>, j+<span class="number">1</span>, board_s[i][j]));</span><br><span class="line"><span class="comment">//						printf(&quot;%c %d %d\n&quot;, board_s[i][j], i+1, j+1);</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %d %d\n&quot;</span>, ++cases, ret+flow, V.<span class="built_in">size</span>());</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; V.<span class="built_in">size</span>(); i++)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%c %d %d\n&quot;</span>, V[i].val, V[i].x, V[i].y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-20007" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/18/jg-20007/" class="article-date">
  <time datetime="2017-01-18T01:16:30.000Z" itemprop="datePublished">2017-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/出題解題/">出題解題</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/18/jg-20007/">淺談旅行推銷員問題 (Travelling Salesman Problem) 搜索加速</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/01/18/jg-20007/" data-id="ckpaivcfm00nbn8vnc3de2umk" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/01/18/jg-20007/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DLX/">DLX</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/branch-and-reduce-algorithm/">branch-and-reduce algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <blockquote>
<p>學弟們修課〈演算法設計與分析〉內容中的一環，看他們的講義進行加速比較，也許有人會認為我太閒，但這只是追求真理。看看維基百科上，就有那上萬點的極佳近似解算法，而接下來要說的相當於玩具等級。</p>
</blockquote>
<h2 id="Task-Description"><a href="#Task-Description" class="headerlink" title="Task Description"></a>Task Description</h2><p>給一組城市和每一個城市之間的單向距離，請找出從起點城市出發，經過所有城市且不重複回到起點城市的最短距離和。</p>
<p>例如，走訪順序為 $1-2-4-3-1$. 距離總和為 $10+25+30+15 = 80$.</p>
<p><img src="http://i.imgur.com/l2aSygv.png"></p>
<h2 id="Subtask"><a href="#Subtask" class="headerlink" title="Subtask"></a>Subtask</h2><span>$N \le 100$</span><!-- Has MathJax -->

<h2 id="Input-Format"><a href="#Input-Format" class="headerlink" title="Input Format"></a>Input Format</h2><p>只有一組測資，每組第一行有一個整數 <span>$N$</span><!-- Has MathJax --> ，表示有 <span>$N$</span><!-- Has MathJax --> 座城市，接下來會有 <span>$N$</span><!-- Has MathJax --> 行，每行上有 <span>$N$</span><!-- Has MathJax --> 個非負整數 <span>$D_{i, j}$</span><!-- Has MathJax --> 表示節點 <span>$i$</span><!-- Has MathJax --> 到節點 <span>$j$</span><!-- Has MathJax --> 的距離，如果 <span>$D_{i, j} = 0$</span><!-- Has MathJax --> ，視同沒有邊。</p>
<p>你可以假設每一條邊可能是單向的，保證至少一條 TSP 路徑。</p>
<ul>
<li><span>$3 &lt; N \leq 100$</span><!-- Has MathJax --></li>
<li><span>$0 &lt; \textit{distance between any pair of cities} \le 10000$</span><!-- Has MathJax --></li>
</ul>
<h2 id="Output-Format"><a href="#Output-Format" class="headerlink" title="Output Format"></a>Output Format</h2><p>輸出一行最小距離和。</p>
<h2 id="Sample-Input-1"><a href="#Sample-Input-1" class="headerlink" title="Sample Input 1"></a>Sample Input 1</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">0 10 15 20</span><br><span class="line">10 0 35 25</span><br><span class="line">15 35 0 30</span><br><span class="line">20 25 30 0</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output-1"><a href="#Sample-Output-1" class="headerlink" title="Sample Output 1"></a>Sample Output 1</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">80</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><h3 id="初學第一步－窮舉"><a href="#初學第一步－窮舉" class="headerlink" title="初學第一步－窮舉"></a>初學第一步－窮舉</h3><p>從最直觀的想法中，我們可以使用窮舉 <span>$O(N!)$</span><!-- Has MathJax --> 解決，再搭配簡單的剪枝 (加上當前點 <span>$u$</span><!-- Has MathJax --> 返回起點的最短路徑長是否大於已知解)。當 <span>$N \ge 12$</span><!-- Has MathJax --> 時，理論運算次數達 4 億之多，運算時間相當於 1 秒左右 (粗估一般 CPU 可達 4 GHz)，接下來窮舉速度就不堪負荷。</p>
<blockquote>
<p>時間複雜度 <span>$O(N!)$</span><!-- Has MathJax --> ， 空間複雜度 <span>$O(N)$</span><!-- Has MathJax --></p>
</blockquote>
<h3 id="踏出第一步－動態規劃"><a href="#踏出第一步－動態規劃" class="headerlink" title="踏出第一步－動態規劃"></a>踏出第一步－動態規劃</h3><p>當學會動態規劃後，解決這一 NP-Complete 問題時，我們使用記憶體空間去掉重複換取時間，定義狀態 <code>dp[i][j]</code> 表示當前走過的點集合 <span>$i$</span><!-- Has MathJax --> ，停留最後一個點位置 <span>$j$</span><!-- Has MathJax --> ，點集合可以用 bitmask 的技巧壓縮，集合狀態個數 <span>$2^N$</span><!-- Has MathJax --> ，窮舉所有停留點轉移需要 <span>$O(N)$</span><!-- Has MathJax --> 次。當 <span>$N \ge 25$</span><!-- Has MathJax --> 時，理論次數達 8 億之多，再加上記憶體存取效能，導致運行約數十秒。</p>
<blockquote>
<p>時間複雜度 <span>$O(N^2 \cdot 2^N)$</span><!-- Has MathJax --> ， 空間複雜度 <span>$O(N \cdot 2^N)$</span><!-- Has MathJax --></p>
</blockquote>
<h3 id="更進一步"><a href="#更進一步" class="headerlink" title="更進一步"></a>更進一步</h3><p>我們發現到基礎窮舉中可以剪枝卻又不夠局觀，在動態規劃中擁有移除重複卻又不能剪枝，動態規劃又佔據大量的記憶體空間，那麼使用更厲害的 branch-and-reduce 算法吧。簡單介紹一下 branch-and-reduce 算法的特性：</p>
<ul>
<li>屬於窮舉的一環</li>
<li>在每一步中，花費較多的時間估算整體基礎花費，用來剪枝</li>
<li>窮舉一步之後，將盤面選擇縮小，甚至做到同構移除來減少窮舉分支，這個步驟稱為 reduce</li>
<li>使用的記憶體空間少 (與一般窮舉相當)</li>
</ul>
<p>運用在 TSP 問題時，我們首先將輸入轉換成 <span>$N \times N$</span><!-- Has MathJax --> 矩陣，當移動從 <span>$u$</span><!-- Has MathJax --> 到 <span>$v$</span><!-- Has MathJax --> 時，矩陣就會變成 <span>$(N-1) \times (N-1)$</span><!-- Has MathJax --> 大小。</p>
<h4 id="計算基礎花費"><a href="#計算基礎花費" class="headerlink" title="計算基礎花費"></a>計算基礎花費</h4><p>對於一個 TSP 而言，每一個點必然有入邊和出邊，因此基礎花費必然每一個節點權重最小的入邊和出邊總和。範例操作如下：</p>
<span>$$\begin{align*}
\text{cost matrix } M_5 = \begin{bmatrix}
\infty &amp; 20 &amp; 30 &amp; 10 &amp; 11 \\
15 &amp; \infty &amp; 16 &amp; 4 &amp; 2 \\
3 &amp; 5 &amp; \infty &amp; 2 &amp; 4 \\
19 &amp; 6 &amp; 18 &amp; \infty &amp; 3 \\
16 &amp; 4 &amp; 7 &amp; 16 &amp; \infty
\end{bmatrix}
\end{align*}$$</span><!-- Has MathJax -->

<p>計算出邊最小值，將每一行的最小值算出，例如第一行 <span>$[\infty \; 20 \; 30 \; 10 \; 11]$</span><!-- Has MathJax --> 為 10，最後分別扣掉 10, 2, 2, 3, 4，得到出邊基礎花費 <span>$10+2+2+3+4 = 21$</span><!-- Has MathJax --> ，接著我們扣除掉基礎花費得到</p>
<span>$$\begin{align*}
\text{reduce row, cost matrix } M_5 = \begin{bmatrix}
\infty &amp; 10 &amp; 20 &amp; 0 &amp; 1 \\
13 &amp; \infty &amp; 14 &amp; 2 &amp; 0 \\
1 &amp; 3 &amp; \infty &amp; 0 &amp; 2 \\
16 &amp; 3 &amp; 15 &amp; \infty &amp; 0 \\
12 &amp; 0 &amp; 3 &amp; 12 &amp; \infty
\end{bmatrix}
\end{align*}$$</span><!-- Has MathJax -->

<p>此時，我們再針對入邊找到基礎花費，將每一個列的最小值算出，分別為 1, 0, 3, 0, 0，因此得到基礎花費 <span>$21+1+3 = 25$</span><!-- Has MathJax --> ，如此一來當下限高於當前的最佳解就可以退出。下一階段的矩陣就會被改造成如下所示</p>
<span>$$\begin{align*}
\text{reduce row/column, cost matrix }M_5 = \begin{bmatrix}
\infty &amp; 10 &amp; 17 &amp; 0 &amp; 1 \\
12 &amp; \infty &amp; 11 &amp; 2 &amp; 0 \\
0 &amp; 3 &amp; \infty &amp; 0 &amp; 2 \\
15 &amp; 3 &amp; 12 &amp; \infty &amp; 0 \\
11 &amp; 0 &amp; 0 &amp; 12 &amp; \infty
\end{bmatrix}
\end{align*}$$</span><!-- Has MathJax -->

<p>當我們從某一點 <span>$u$</span><!-- Has MathJax --> 移動到 <span>$v$</span><!-- Has MathJax --> 時，移除掉矩陣中的某一行 <span>$u$</span><!-- Has MathJax --> 和某一列 <span>$v$</span><!-- Has MathJax --> 即可。特別注意到，上述範例為完全圖，對於稀疏圖會發生無解情況，需要特別判斷。</p>
<h4 id="優化一夜"><a href="#優化一夜" class="headerlink" title="優化一夜"></a>優化一夜</h4><p>用陣列實作不算困難，當抽出一行一列時，可能會需要複製整個矩陣，又或者只用標記來防止計算到經過的點，不管哪一種寫法都不算漂亮。這裡提供一個解決方法：在處理基礎花費時，對整個矩陣每行每列扣一個定值，實作時不真正修改數值，而是把差值記錄下來，用 <span>$O(N)$</span><!-- Has MathJax --> 空間 <span>$Dx[], \; Dy[]$</span><!-- Has MathJax --> 記錄差值，如此一來就不用耗費 <span>$O(N^2)$</span><!-- Has MathJax --> 空間和時間進行複製。</p>
<p>相對地，這會造成計算真正值 <span>$M&apos;_{x, y} = M_{x, y} - Dx[x] - Dy[y]$</span><!-- Has MathJax --> 需要數次的記憶體存取。無妨地，我們已經將了每一層的空間和搬運次數，又因為陣列小到可以全塞進快取中。</p>
<h4 id="優化二夜"><a href="#優化二夜" class="headerlink" title="優化二夜"></a>優化二夜</h4><p>對於稀疏圖而言，用矩陣實作過於浪費空間，而且很容易拖累速度，因此可以使用雙十字鏈表 Dancing Links 來模擬上述的矩陣，高效地降低運行常數。實作複雜度指數上升。</p>
<h4 id="優化三夜"><a href="#優化三夜" class="headerlink" title="優化三夜"></a>優化三夜</h4><p>遞迴窮舉必然會遇到復原操作，除非我們完整地複製每一層狀態。通常我們只會修改差異，這裡需要對整個矩陣修改，這導致差異數量非常多。為了加速復原操作，遞迴時維護自己 stack 來復原修改差異，而且僅當 <span>$Dx[], Dy[]$</span><!-- Has MathJax --> 不為零的時候才進行儲存，因為一部分的 reduce 結果會是零，這些影響的效能非常多。</p>
<p>除了上述外，計算基礎花費仍佔據了 <span>$O(N^2)$</span><!-- Has MathJax --> 的時間並佔大部分的運行時間。為了減少計算量，可以做到以下幾點：</p>
<ul>
<li>在每一行/列計算最小值時，走訪 Dancing Links 每一行每一列，如果當前最小值已經被更新到 0 時，可以直接退出。</li>
<li>傳遞當前已知最佳解，當累積計算花費總和高於已知解就退出。</li>
</ul>
<h4 id="優化四夜"><a href="#優化四夜" class="headerlink" title="優化四夜"></a>優化四夜</h4><p>從啟發的觀點來看，每一階段有 <span>$n$</span><!-- Has MathJax --> 種選擇，各別算出預期最少花費後，排序後優先從花費小的開始拓展。</p>
<blockquote>
<p>下述程式只支援頂點個數 30 以內，在頂點個數 30 時，只需要耗費 161 ms 即可完成。<br>當我將頂點個數放大 50 時，小夥伴們的程序花了 2 個小時還沒結果，而我寫的版本跑了 1X 秒就結束。測資的極限就只到這了，暫時先擱著吧。<a href="https://judgegirl.csie.org/problem/0/20007">題目鏈結 20007. Fast Travelling Salesman Problem</a></p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXNODE 5000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXCOL 32</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 32</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x3f3f3f</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DancingNode</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> left, right, up, down;</span><br><span class="line">    <span class="keyword">int</span> ch, rh, w;</span><br><span class="line">&#125; DL[MAXNODE];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HelperNode</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> head, size, next, prev;</span><br><span class="line">&#125; HN[MAXNODE];</span><br><span class="line"><span class="keyword">int</span> help_head;</span><br><span class="line"><span class="keyword">int</span> s[MAXCOL];</span><br><span class="line"><span class="keyword">int</span> head, size, Ans;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Remove</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">    DL[DL[c].right].left = DL[c].left;</span><br><span class="line">    DL[DL[c].left].right = DL[c].right;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[c].down; i != c; i = DL[i].down) &#123;</span><br><span class="line">    	<span class="keyword">if</span> (HN[DL[i].rh].head == i)</span><br><span class="line">    		HN[DL[i].rh].head = DL[i].left;</span><br><span class="line">    	HN[DL[i].rh].size--;</span><br><span class="line">        DL[DL[i].right].left = DL[i].left;</span><br><span class="line">        DL[DL[i].left].right = DL[i].right;</span><br><span class="line">        s[DL[i].ch]--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Resume</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[c].down; i != c; i = DL[i].down) &#123;</span><br><span class="line">    	<span class="keyword">if</span> (HN[DL[i].rh].head == i)</span><br><span class="line">    		HN[DL[i].rh].head = DL[i].right;</span><br><span class="line">    	HN[DL[i].rh].size++;</span><br><span class="line">        DL[DL[i].right].left = i;</span><br><span class="line">        DL[DL[i].left].right = i;</span><br><span class="line">        s[DL[i].ch]++;</span><br><span class="line">    &#125;</span><br><span class="line">    DL[DL[c].right].left = c;</span><br><span class="line">    DL[DL[c].left].right = c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Reduce</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t = DL[i].rh;</span><br><span class="line">    HN[HN[t].next].prev = HN[t].prev;</span><br><span class="line">    HN[HN[t].prev].next = HN[t].next;</span><br><span class="line">    s[DL[i].ch]--;</span><br><span class="line">    </span><br><span class="line">    DL[DL[i].down].up = DL[i].up;</span><br><span class="line">    DL[DL[i].up].down = DL[i].down;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = DL[i].right; k != i; k = DL[k].right) &#123;</span><br><span class="line">        DL[DL[k].down].up = DL[k].up;</span><br><span class="line">        DL[DL[k].up].down = DL[k].down;</span><br><span class="line">        s[DL[k].ch]--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Recover</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t = DL[i].rh;</span><br><span class="line">    HN[HN[t].next].prev = t;</span><br><span class="line">    HN[HN[t].prev].next = t;</span><br><span class="line">    s[DL[i].ch]++;</span><br><span class="line">    </span><br><span class="line">    DL[DL[i].down].up = i;</span><br><span class="line">    DL[DL[i].up].down = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = DL[i].right; k != i; k = DL[k].right) &#123;</span><br><span class="line">        DL[DL[k].down].up = k;</span><br><span class="line">        DL[DL[k].up].down = k;</span><br><span class="line">        s[DL[k].ch]++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Select</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> s = DL[i].rh;</span><br><span class="line">    <span class="built_in">Reduce</span>(i);</span><br><span class="line">    <span class="built_in">Remove</span>(j);</span><br><span class="line">    HN[HN[s].next].prev = HN[s].prev;</span><br><span class="line">    HN[HN[s].prev].next = HN[s].next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cancel</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> s = DL[i].rh;</span><br><span class="line">    <span class="built_in">Resume</span>(j);</span><br><span class="line">    <span class="built_in">Recover</span>(i);</span><br><span class="line">    HN[HN[s].next].prev = s;</span><br><span class="line">    HN[HN[s].prev].next = s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">new_node</span><span class="params">(<span class="keyword">int</span> up, <span class="keyword">int</span> down, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">    DL[size].up = up, DL[size].down = down;</span><br><span class="line">    DL[size].left = left, DL[size].right = right;</span><br><span class="line">    DL[up].down = DL[down].up = DL[left].right = DL[right].left = size;</span><br><span class="line">    <span class="keyword">return</span> size++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">new_row</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> R[][<span class="number">2</span>], <span class="keyword">int</span> rh)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> r, row = <span class="number">-1</span>, k;</span><br><span class="line">    <span class="keyword">int</span> h = size;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        r = R[i][<span class="number">0</span>];</span><br><span class="line">        DL[size].ch = r, s[r]++;</span><br><span class="line">        DL[size].rh = rh;</span><br><span class="line">        DL[size].w = R[i][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (row == <span class="number">-1</span>) &#123;</span><br><span class="line">            row = <span class="built_in">new_node</span>(DL[DL[r].ch].up, DL[r].ch, size, size);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            k = <span class="built_in">new_node</span>(DL[DL[r].ch].up, DL[r].ch, DL[row].left, row);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    HN[rh].size = n;</span><br><span class="line">    HN[rh].head = h;</span><br><span class="line">    HN[rh].next = HN[help_head].next;</span><br><span class="line">    HN[rh].prev = help_head;</span><br><span class="line">    HN[HN[help_head].next].prev = rh;</span><br><span class="line">    HN[help_head].next = rh;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">    size = <span class="number">0</span>;</span><br><span class="line">    help_head = <span class="number">0</span>, HN[help_head].next = HN[help_head].prev = help_head;</span><br><span class="line">    head = <span class="built_in">new_node</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        <span class="built_in">new_node</span>(i, i, DL[head].left, head);</span><br><span class="line">        DL[i].ch = i, s[i] = <span class="number">0</span>;</span><br><span class="line">        DL[i].rh = <span class="number">0</span>;	<span class="comment">// important pointer (fail pointer)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> Dx[MAXN], Dy[MAXN];</span><br><span class="line"><span class="keyword">int</span> markRStk[MAXNODE], markRidx = <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">int</span> markCStk[MAXNODE], markCidx = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printDL</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = HN[help_head].prev; i != help_head; i = HN[i].prev) &#123;</span><br><span class="line">        <span class="keyword">int</span> j = HN[i].head, prev = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%2d &quot;</span>, DL[j].rh);</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (prev &lt; DL[j].ch)</span><br><span class="line">                prev++, <span class="built_in">printf</span>(<span class="string">&quot; -- &quot;</span>);</span><br><span class="line">            prev = DL[j].ch+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> rh = DL[j].rh, ch = DL[j].ch;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;[%2d]&quot;</span>, DL[j].w - Dx[rh] - Dy[ch]);</span><br><span class="line">            j = DL[j].right;</span><br><span class="line">        &#125; <span class="keyword">while</span> (j != HN[i].head);</span><br><span class="line">        <span class="keyword">while</span> (prev &lt;= n)</span><br><span class="line">            prev++, <span class="built_in">printf</span>(<span class="string">&quot; -- &quot;</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;----------------------&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cH</span><span class="params">(<span class="keyword">int</span> limit = INF)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ins = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = HN[help_head].prev; i != help_head; i = HN[i].prev) &#123;</span><br><span class="line">        <span class="keyword">if</span> (HN[i].size == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> INF;</span><br><span class="line">        <span class="keyword">int</span> j = HN[i].head, v = INF;</span><br><span class="line">        <span class="keyword">int</span> rh = DL[j].rh, ch;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            ch = DL[j].ch;</span><br><span class="line">            v = <span class="built_in">min</span>(v, DL[j].w - Dx[rh] - Dy[ch]);</span><br><span class="line">            j = DL[j].right;</span><br><span class="line">        &#125; <span class="keyword">while</span> (j != HN[i].head &amp;&amp; v);</span><br><span class="line">        <span class="keyword">if</span> (v == INF || ins+v &gt;= limit)</span><br><span class="line">            <span class="keyword">return</span> INF;</span><br><span class="line">        <span class="keyword">if</span> (v) &#123;</span><br><span class="line">            ins += v;</span><br><span class="line">            Dx[rh] += v;</span><br><span class="line">            markRStk[++markRidx] = v;</span><br><span class="line">            markRStk[++markRidx] = rh;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	printf(&quot;cH first\n&quot;);</span></span><br><span class="line"><span class="comment">	printDL(4);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[head].right; i != head; i = DL[i].right) &#123;</span><br><span class="line">        <span class="keyword">if</span> (DL[i].down == i)</span><br><span class="line">            <span class="keyword">return</span> INF;</span><br><span class="line">        <span class="keyword">int</span> j = DL[i].down, v = INF;</span><br><span class="line">        <span class="keyword">int</span> ch = DL[i].ch, rh;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            rh = DL[j].rh;</span><br><span class="line">            v = <span class="built_in">min</span>(v, DL[j].w - Dx[rh] - Dy[ch]);</span><br><span class="line">            j = DL[j].down;</span><br><span class="line">        &#125; <span class="keyword">while</span> (j != i &amp;&amp; v);</span><br><span class="line">        <span class="keyword">if</span> (v == INF || ins+v &gt;= limit)</span><br><span class="line">            <span class="keyword">return</span> INF;</span><br><span class="line">        <span class="keyword">if</span> (v) &#123;</span><br><span class="line">            ins += v;</span><br><span class="line">            Dy[ch] += v;</span><br><span class="line">            markCStk[++markCidx] = v;</span><br><span class="line">            markCStk[++markCidx] = ch;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ins;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rH</span><span class="params">(<span class="keyword">int</span> backRidx, <span class="keyword">int</span> backCidx)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (markRidx &gt; backRidx) &#123;</span><br><span class="line">        <span class="keyword">int</span> a = markRStk[markRidx--];</span><br><span class="line">        <span class="keyword">int</span> b = markRStk[markRidx--];</span><br><span class="line">        Dx[a] -= b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (markCidx &gt; backCidx) &#123;</span><br><span class="line">        <span class="keyword">int</span> a = markCStk[markCidx--];</span><br><span class="line">        <span class="keyword">int</span> b = markCStk[markCidx--];</span><br><span class="line">        Dy[a] -= b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> SAME_CUT</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isSame</span><span class="params">(<span class="keyword">int</span> vx, <span class="keyword">int</span> vy)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = HN[vx].head, j = HN[vy].head;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (DL[i].ch != DL[j].ch &amp;&amp; (DL[i].ch != vy &amp;&amp; DL[j].ch != vx))</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> e1 = DL[i].w - Dx[vx] - Dy[DL[i].ch];</span><br><span class="line">        <span class="keyword">int</span> e2 = DL[j].w - Dx[vy] - Dy[DL[j].ch];</span><br><span class="line">        <span class="keyword">if</span> (e1 != e2)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        i = DL[i].right;</span><br><span class="line">        j = DL[j].right;	</span><br><span class="line">    &#125; <span class="keyword">while</span> (i != HN[vx].head &amp;&amp; j != HN[vy].head);</span><br><span class="line">    <span class="keyword">return</span> i == HN[vx].head &amp;&amp; j == HN[vy].head;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> MST_CUT</span></span><br><span class="line"><span class="keyword">int</span> parent[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">findp</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x == parent[x] ? x : (parent[x]=<span class="built_in">findp</span>(parent[x]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">joint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    x = <span class="built_in">findp</span>(x), y = <span class="built_in">findp</span>(y);</span><br><span class="line">    <span class="keyword">if</span> (x == y) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    parent[y] = x;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">MST</span><span class="params">(<span class="keyword">int</span> st, <span class="keyword">int</span> ed, <span class="keyword">int</span> limit = INF)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> used[MAXN] = &#123;&#125;, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (HN[HN[help_head].prev].prev == help_head)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> i = HN[help_head].prev;</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>, in = INF, out = INF;</span><br><span class="line">    cases++;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> j = HN[i].head;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> x = DL[j].rh, y = DL[j].ch;</span><br><span class="line">            <span class="keyword">int</span> w = DL[j].w - Dx[x] - Dy[y];</span><br><span class="line">            <span class="keyword">if</span> (x == st) &#123;</span><br><span class="line">                in = <span class="built_in">min</span>(in, w);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (y == ed) &#123;</span><br><span class="line">                out = <span class="built_in">min</span>(out, w);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (used[x] != cases)</span><br><span class="line">                    used[x] = cases, parent[x] = x, n++;</span><br><span class="line">                <span class="keyword">if</span> (used[y] != cases)</span><br><span class="line">                    used[y] = cases, parent[y] = y, n++;</span><br><span class="line">                n -= <span class="built_in">joint</span>(x, y);</span><br><span class="line">            &#125;</span><br><span class="line">            j = DL[j].right;</span><br><span class="line">        &#125; <span class="keyword">while</span> (j != HN[i].head);</span><br><span class="line">        i = HN[i].prev;</span><br><span class="line">    &#125; <span class="keyword">while</span> (i != help_head);</span><br><span class="line">    ret = in + out;</span><br><span class="line">    <span class="keyword">if</span> (ret &gt;= limit)</span><br><span class="line">        <span class="keyword">return</span> limit;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;cc cut\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> lower_bound)</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> MST_CUT</span></span><br><span class="line">    <span class="keyword">if</span> (lower_bound + <span class="built_in">MST</span>(u, <span class="number">1</span>, Ans - lower_bound) &gt;= Ans) &#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="keyword">if</span> (lower_bound &gt;= Ans) &#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (HN[HN[help_head].prev].prev == help_head) &#123;</span><br><span class="line">        Ans = lower_bound;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> i = HN[u].head;</span><br><span class="line">    vector&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; pick;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> v = DL[i].ch;</span><br><span class="line">        <span class="keyword">int</span> runnable = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (v == <span class="number">1</span>)</span><br><span class="line">            runnable = <span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> SAME_CUT</span></span><br><span class="line">        <span class="keyword">if</span> (runnable) &#123;</span><br><span class="line">            <span class="keyword">int</span> e1 = DL[i].w - Dx[u] - Dy[v];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = HN[u].head; j != i &amp;&amp; runnable; j = DL[j].right) &#123;</span><br><span class="line">                <span class="keyword">int</span> e2 = DL[j].w - Dx[u] - Dy[DL[j].ch];</span><br><span class="line">                <span class="keyword">if</span> (e1 != e2)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">isSame</span>(v, DL[j].ch))</span><br><span class="line">                    runnable = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (runnable) &#123;</span><br><span class="line">            <span class="keyword">int</span> backRidx = markRidx, backCidx = markCidx;</span><br><span class="line">            <span class="keyword">int</span> tu = HN[u].head;</span><br><span class="line">            <span class="built_in">Select</span>(tu, v);</span><br><span class="line">            <span class="keyword">int</span> c = <span class="built_in">cH</span>(Ans - lower_bound);</span><br><span class="line">            <span class="keyword">if</span> (c != INF) &#123;</span><br><span class="line">                pick.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(lower_bound + c + DL[i].w-Dx[u]-Dy[v], v));</span><br><span class="line">            <span class="comment">//	DFS(v, lower_bound + c + DL[i].w-Dx[u]-Dy[v]);</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">rH</span>(backRidx, backCidx);</span><br><span class="line">            <span class="built_in">Cancel</span>(tu, v);</span><br><span class="line">        &#125;</span><br><span class="line">        i = DL[i].right;</span><br><span class="line">    &#125; <span class="keyword">while</span> (i != HN[u].head);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sort</span>(pick.<span class="built_in">begin</span>(), pick.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pick.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = pick[i].second;	</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">		printf(&quot;%d -&gt; %d, %d\n&quot;, u, v, pick[i].first);</span></span><br><span class="line"><span class="comment">		printDL(4);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">        <span class="keyword">int</span> backRidx = markRidx, backCidx = markCidx;</span><br><span class="line">        <span class="keyword">int</span> tu = HN[u].head;</span><br><span class="line">        <span class="built_in">Select</span>(tu, v);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">		printf(&quot;Select\n&quot;);</span></span><br><span class="line"><span class="comment">		printDL(4);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">        <span class="keyword">int</span> c = <span class="built_in">cH</span>(Ans - lower_bound);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">		printf(&quot;Reduce\n&quot;);</span></span><br><span class="line"><span class="comment">		printDL(4);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">        <span class="keyword">if</span> (c != INF)</span><br><span class="line">            <span class="built_in">DFS</span>(v, pick[i].first);</span><br><span class="line">        <span class="built_in">rH</span>(backRidx, backCidx);</span><br><span class="line">        <span class="built_in">Cancel</span>(tu, v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> G[MAXN][MAXN];</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">init</span>(n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> R[MAXN][<span class="number">2</span>], Rcnt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">                <span class="built_in">assert</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;G[i][j]) == <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (G[i][j])</span><br><span class="line">                    R[Rcnt][<span class="number">0</span>] = j, R[Rcnt][<span class="number">1</span>] = G[i][j], Rcnt++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">new_row</span>(Rcnt, R, i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> backRidx = markRidx, backCidx = markCidx;</span><br><span class="line">        Ans = INF;</span><br><span class="line">        <span class="built_in">DFS</span>(<span class="number">1</span>, <span class="built_in">cH</span>());</span><br><span class="line">        <span class="built_in">rH</span>(backRidx, backCidx);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, Ans);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-2017-facebook-hacker-cup-round-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/16/2017-facebook-hacker-cup-round-1/" class="article-date">
  <time datetime="2017-01-16T03:30:15.000Z" itemprop="datePublished">2017-01-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/16/2017-facebook-hacker-cup-round-1/">2017 Facebook Hacker Cup Round 1</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/01/16/2017-facebook-hacker-cup-round-1/" data-id="ckpaivc6y000gn8vn6ja43ly7" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/01/16/2017-facebook-hacker-cup-round-1/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <blockquote>
<p>感謝小夥伴妮可、茵可熱情支援</p>
</blockquote>
<h2 id="Facebook-2017-Hacker-Cup-Round-1"><a href="#Facebook-2017-Hacker-Cup-Round-1" class="headerlink" title="Facebook 2017 Hacker Cup Round 1"></a>Facebook 2017 Hacker Cup Round 1</h2><h3 id="A-Pie-Progress"><a href="#A-Pie-Progress" class="headerlink" title="A. Pie Progress"></a>A. Pie Progress</h3><p>單身狗的 <span>$N$</span><!-- Has MathJax --> 天日子中 (娛樂性質翻譯)，每天晚餐想要一道點心派搭配。每天早晨決定到當地的餅舖採購，每天一定會生產 <span>$M$</span><!-- Has MathJax --> 派，每一種派的價格也有所不同，不用考慮派會壞掉的情況，預先庫存保留著吃。為防止不當商人購買數量過多，當天若購買 <span>$K$</span><!-- Has MathJax --> 個派，需要額外支付 <span>$K^2$</span><!-- Has MathJax --> 的交易手續費，請問採購花費最少為何。</p>
<p>明顯地，每一天的狀態就是採購了多少個派，得到狀態 <span>$\text{dp}[i][j]$</span><!-- Has MathJax --> 表示前 <span>$i$</span><!-- Has MathJax --> 天總共採購 <span>$j$</span><!-- Has MathJax --> 個餅，轉移過程中要保證數量足夠支付每一天，意即只對 <span>$i \le j$</span><!-- Has MathJax --> 進行轉移。每一天窮舉購買的數量，窮舉採購的花費時，勢必要先排序每塊派的價格，每次只挑選前幾個小的，時間複雜度 <span>$O(N^2 M)$</span><!-- Has MathJax --> 。</p>
<span>$$\begin{align*}
dp[i][j] = \left\{\begin{matrix}
0 &amp;&amp; i = 0\;, j = 0\\
\min(dp[i-1][j-k-1] + \text{SumC}[k] + (k+1)^2) &amp;&amp; i \le j \\
\infty &amp;&amp; \text{otherwise}
\end{matrix}\right.
\end{align*}$$</span><!-- Has MathJax -->

<h3 id="B-Fighting-the-Zombies"><a href="#B-Fighting-the-Zombies" class="headerlink" title="B. Fighting the Zombies"></a>B. Fighting the Zombies</h3><p>在 D&amp;D 遊戲，身為一個魔法師要消滅地圖上的殭屍們。一次操作有兩個步驟，第一步驟圈選任意半徑內的所有殭屍，不改變其相對位置將他們進行轉移，第二步驟選擇長寬為 <span>$R$</span><!-- Has MathJax --> 的方形內的所有殭屍，請問一次操作最多可以消滅多少殭屍。</p>
<p>從第二步驟中觀察到消滅的大小是固定的，因此圈選半徑會被約束在 <span>$R$</span><!-- Has MathJax --> 內，實際上也不用考慮圓，因為方形被包含在圓裏。最後，我們直接求第一步驟的所有方形情況，將內部的殭屍全部移除後，再窮舉一次方形範圍內部的其他殭屍，所有可能取最大值即可。時間複雜度 <span>$O(N^6)$</span><!-- Has MathJax --> 。由於 <span>$N \le 50$</span><!-- Has MathJax --> ，六分鐘內是可以容忍的。</p>
<h3 id="C-Manic-Moving"><a href="#C-Manic-Moving" class="headerlink" title="C. Manic Moving"></a>C. Manic Moving</h3><p>搬家公司在 <span>$N$</span><!-- Has MathJax --> 個城鎮之間服務，貨車司機打算用最小的油量花費依序完成公司給定 <span>$K$</span><!-- Has MathJax --> 個訂單。第 <span>$i$</span><!-- Has MathJax --> 名客戶要求從 <span>$S_i$</span><!-- Has MathJax --> 地搬到 <span>$D_i$</span><!-- Has MathJax --> ，貨車一次可以載運兩名客戶的量。根據訂單順序，先來的就要載貨，同理也要先卸貨。</p>
<p>從題目中發現對於順序要求非常嚴苛，定出每一階段的狀態 <span>$dp[i][j][2]$</span><!-- Has MathJax --> 表示完成前 <span>$i$</span><!-- Has MathJax --> 個訂單、最後停留位置在 <span>$j$</span><!-- Has MathJax --> 地，最後的 <code>[2]</code> 表示前一個階段是否已經卸貨。分成兩種方式討論，時間複雜度 <span>$O(KN)$</span><!-- Has MathJax --> 。</p>
<h3 id="D-Beach-Umbrellas"><a href="#D-Beach-Umbrellas" class="headerlink" title="D. Beach Umbrellas"></a>D. Beach Umbrellas</h3><p>有 <span>$N$</span><!-- Has MathJax --> 個人各自帶著半徑 <span>$R_i$</span><!-- Has MathJax --> 的降落傘，在海岸進行降落，岸上有 <span>$M$</span><!-- Has MathJax --> 個降落點，每個降落點間隔一公尺，請問有多少種降落方式使得他們不會碰撞。</p>
<p>從題目給的說明中，我們發現到左右兩側的降落點比較特別，因為他們的傘的一部份可能會落在 <span>$M$</span><!-- Has MathJax --> 點之外，因此考慮窮舉降落在左右側的所有方法數 <span>$N^2$</span><!-- Has MathJax --> ，若要計算固定左右兩側的方法數，可以使用重複組合 H 得到 (滿足 <span>$x_1 + x_2 + \cdots + x_n = Y$</span><!-- Has MathJax --> 且每個數皆為非負整數的方法數)。然而，這樣計算方法缺少順序，最後補上排列計數 <span>$(N-2)!$</span><!-- Has MathJax --> 。</p>
<p>來講講窮舉左右兩側之後怎麼算出方法數</p>
<ul>
<li>左右兩側分別為 <span>$R_i$</span><!-- Has MathJax --> 和 <span>$R_j$</span><!-- Has MathJax --> 的情況</li>
<li>海岸左寬度增加 <span>$R_i$</span><!-- Has MathJax -->，同理右寬度增加 <span>$R_j$</span><!-- Has MathJax --> </li>
<li>如此一來，左右變數的情況就能套用重複組合分配 <span>$N$</span><!-- Has MathJax --> 個變數，總和為 <span>$M + R_i + R_j$</span><!-- Has MathJax --> ，每個變數至少大於等於 <span>$R_i$</span><!-- Has MathJax --></li>
</ul>
<p>特別地，變數 <span>$M$</span><!-- Has MathJax --> 過大。在窮舉所有情況中，組合類型最多 <span>$2R$</span><!-- Has MathJax --> 種，而非 <span>$N^2$</span><!-- Has MathJax --> 種。計算量多到必須預先建表，每一個組合數 <span>$C^{M+?}_{N}$</span><!-- Has MathJax --> ，由於底數是固定的，利用區間滑動在 <span>$O(1)$</span><!-- Has MathJax --> 轉換 (需要乘法反元素支援)。預先建表的時間 <span>$O(R)$</span><!-- Has MathJax -->，窮舉部分 <span>$O(N^2 \log R)$</span><!-- Has MathJax --> 。</p>
<h3 id="Solution-A"><a href="#Solution-A" class="headerlink" title="Solution A"></a>Solution A</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span> (testcase--) &#123;</span><br><span class="line">        <span class="keyword">int</span> N, M;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;N, &amp;M);</span><br><span class="line">        <span class="keyword">int</span> dp[<span class="number">305</span>][<span class="number">305</span>] = &#123;&#125;;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= N; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= N; j++)</span><br><span class="line">                dp[i][j] = INF;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> A[<span class="number">305</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; M; j++)</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;A[j]);</span><br><span class="line">            <span class="built_in">sort</span>(A, A+M);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>, sum = <span class="number">0</span>; j &lt; M; j++) &#123;</span><br><span class="line">                sum += A[j];</span><br><span class="line">                A[j] = sum;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; N; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (dp[i][j] == INF)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; M &amp;&amp; k+j &lt;= N; k++) &#123;</span><br><span class="line">                    dp[i+<span class="number">1</span>][j+k+<span class="number">1</span>] = <span class="built_in">min</span>(dp[i+<span class="number">1</span>][j+k+<span class="number">1</span>], dp[i][j] + A[k] + (k+<span class="number">1</span>)*(k+<span class="number">1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt;= N; j++)</span><br><span class="line">                dp[i+<span class="number">1</span>][j] = <span class="built_in">min</span>(dp[i+<span class="number">1</span>][j], dp[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %d\n&quot;</span>, ++cases, dp[N][N]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-B"><a href="#Solution-B" class="headerlink" title="Solution B"></a>Solution B</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span> (testcase--) &#123;</span><br><span class="line">        <span class="keyword">int</span> N, R;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;N, &amp;R);</span><br><span class="line">        vector&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; A;</span><br><span class="line">        set&lt;<span class="keyword">int</span>&gt; SX, SY;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x, y;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;y);</span><br><span class="line">            A.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(x, y));</span><br><span class="line">            SX.<span class="built_in">insert</span>(x), SY.<span class="built_in">insert</span>(y);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(A.<span class="built_in">begin</span>(), A.<span class="built_in">end</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> LX : SX) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> LY : SY) &#123;</span><br><span class="line">                <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">                <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">used</span><span class="params">(N, <span class="number">0</span>)</span></span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (A[i].first &gt;= LX &amp;&amp; A[i].first &lt;= LX+R</span><br><span class="line">                        &amp;&amp; A[i].second &gt;= LY &amp;&amp; A[i].second &lt;= LY+R)</span><br><span class="line">                    cnt++, used[i] = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> TX : SX) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">auto</span> TY: SY) &#123;</span><br><span class="line">                        <span class="keyword">int</span> dd = <span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (used[i])</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            <span class="keyword">if</span> (A[i].first &gt;= TX &amp;&amp; A[i].first &lt;= TX+R</span><br><span class="line">                                &amp;&amp; A[i].second &gt;= TY &amp;&amp; A[i].second &lt;= TY+R)</span><br><span class="line">                                dd++;</span><br><span class="line">                        &#125;</span><br><span class="line">                        ret = <span class="built_in">max</span>(ret, dd+cnt);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %d\n&quot;</span>, ++cases, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-C"><a href="#Solution-C" class="headerlink" title="Solution C"></a>Solution C</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span> (testcase--) &#123;</span><br><span class="line">        <span class="keyword">int</span> N, M, K;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;N, &amp;M, &amp;K);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> g[<span class="number">105</span>][<span class="number">105</span>] = &#123;&#125;;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span> INF = <span class="number">1LL</span>&lt;&lt;<span class="number">60</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= N; j++)</span><br><span class="line">                g[i][j] = INF;</span><br><span class="line">            g[i][i] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; M; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> A, B;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> G;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %lld&quot;</span>, &amp;A, &amp;B, &amp;G);</span><br><span class="line">            g[A][B] = <span class="built_in">min</span>(g[A][B], G);</span><br><span class="line">            g[B][A] = <span class="built_in">min</span>(g[B][A], G);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= N; k++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= N; j++)</span><br><span class="line">                    g[i][j] = <span class="built_in">min</span>(g[i][j], g[i][k]+g[k][j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"><span class="comment">//		for (int i = 1; i &lt;= N; i++) &#123;</span></span><br><span class="line"><span class="comment">//			for (int j = 1; j &lt;= N; j++)</span></span><br><span class="line"><span class="comment">//				printf(&quot;%lld &quot;, g[i][j]);</span></span><br><span class="line"><span class="comment">//			puts(&quot;&quot;);</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> S[<span class="number">5005</span>], D[<span class="number">5005</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; K; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;S[i], &amp;D[i]);</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">long</span> <span class="keyword">long</span> dp[<span class="number">5005</span>][<span class="number">105</span>][<span class="number">2</span>] = &#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= K; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= N; j++)</span><br><span class="line">                dp[i][j][<span class="number">0</span>] = INF, dp[i][j][<span class="number">1</span>] = INF;;</span><br><span class="line">        &#125;</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; K; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> s1 = S[i], d1 = D[i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= N; j++) &#123;</span><br><span class="line">                <span class="keyword">long</span> <span class="keyword">long</span> cc;</span><br><span class="line">                cc = g[j][s1]+g[s1][d1];</span><br><span class="line">                dp[i+<span class="number">1</span>][d1][<span class="number">0</span>] = <span class="built_in">min</span>(dp[i+<span class="number">1</span>][d1][<span class="number">0</span>], dp[i][j][<span class="number">0</span>] + cc);</span><br><span class="line">                cc = g[j][s1];</span><br><span class="line">                dp[i+<span class="number">1</span>][s1][<span class="number">1</span>] = <span class="built_in">min</span>(dp[i+<span class="number">1</span>][s1][<span class="number">1</span>], dp[i][j][<span class="number">0</span>] + cc);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (dp[i][j][<span class="number">1</span>] != INF &amp;&amp; i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">int</span> sP = S[i<span class="number">-1</span>], dP = D[i<span class="number">-1</span>];</span><br><span class="line">                    cc = g[j][s1]+g[s1][dP];</span><br><span class="line">                    dp[i+<span class="number">1</span>][dP][<span class="number">1</span>] = <span class="built_in">min</span>(dp[i+<span class="number">1</span>][dP][<span class="number">1</span>], dp[i][j][<span class="number">1</span>] + cc);</span><br><span class="line">                    cc = g[j][s1]+g[s1][dP]+g[dP][d1];</span><br><span class="line">                    dp[i+<span class="number">1</span>][d1][<span class="number">0</span>] = <span class="built_in">min</span>(dp[i+<span class="number">1</span>][d1][<span class="number">0</span>], dp[i][j][<span class="number">1</span>] + cc);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line"><span class="comment">//			for (int j = 1; j &lt;= N; j++)</span></span><br><span class="line"><span class="comment">//				printf(&quot;%lld &quot;, dp[i+1][j][0]);</span></span><br><span class="line"><span class="comment">//			puts(&quot;&quot;);</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (dp[K][i][<span class="number">0</span>] != INF)</span><br><span class="line">                ret = <span class="built_in">max</span>(ret, dp[K][i][<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %lld\n&quot;</span>, ++cases, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-D"><a href="#Solution-D" class="headerlink" title="Solution D"></a>Solution D</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span> MOD = <span class="number">1000000007LL</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exgcd</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x, <span class="keyword">long</span> <span class="keyword">long</span> y, <span class="keyword">long</span> <span class="keyword">long</span> &amp;g, </span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="keyword">long</span> <span class="keyword">long</span> &amp;a, <span class="keyword">long</span> <span class="keyword">long</span> &amp;b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (y == <span class="number">0</span>)</span><br><span class="line">        g = x, a = <span class="number">1</span>, b = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">exgcd</span>(y, x%y, g, b, a), b -= (x/y) * a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">inverse</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x, <span class="keyword">long</span> <span class="keyword">long</span> p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> g, b, r;</span><br><span class="line">    <span class="built_in">exgcd</span>(x, p, g, r, b);</span><br><span class="line">    <span class="keyword">if</span> (g &lt; <span class="number">0</span>)	r = -r;</span><br><span class="line">    <span class="keyword">return</span> (r%p + p)%p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span> (testcase--) &#123;</span><br><span class="line">        <span class="keyword">int</span> N, M, R[<span class="number">2048</span>], S = <span class="number">0</span>, mxR = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;N, &amp;M);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;R[i]), S += R[i], mxR = <span class="built_in">max</span>(mxR, R[i]);</span><br><span class="line">        <span class="keyword">if</span> (N == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %lld\n&quot;</span>, ++cases, M);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;%d %d %d\n&quot;</span>, N, S, M);</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> invNplus = <span class="number">1</span>;</span><br><span class="line">        map&lt;<span class="keyword">long</span> <span class="keyword">long</span>, <span class="keyword">long</span> <span class="keyword">long</span>&gt; C;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> f = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++)</span><br><span class="line">                f = (f * i)%MOD;</span><br><span class="line">            invNplus = <span class="built_in">inverse</span>(f, MOD);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">int</span> l = <span class="number">1</span>, r = <span class="number">1</span>;</span><br><span class="line">            f = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = M - <span class="number">2</span>*S; i &lt;= M - <span class="number">2</span>*S + <span class="number">2</span>*mxR; i++) &#123;</span><br><span class="line">                <span class="keyword">int</span> tM = i+N<span class="number">-1</span>;</span><br><span class="line">                <span class="keyword">if</span> (tM &lt; N)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">int</span> L = tM-N+<span class="number">1</span>, R = tM;</span><br><span class="line">                <span class="keyword">if</span> (r &lt; L)</span><br><span class="line">                    l = r = f = L;</span><br><span class="line">                <span class="keyword">while</span> (l &lt; L)</span><br><span class="line">                    f = (f*<span class="built_in">inverse</span>(l, MOD))%MOD, l++;</span><br><span class="line">                <span class="keyword">while</span> (r &lt; R)</span><br><span class="line">                    r++, f = (f * r)%MOD;</span><br><span class="line">                C[tM] = (f * invNplus)%MOD;</span><br><span class="line"><span class="comment">//				printf(&quot;C(%lld %d) = %lld, %lld\n&quot;, tM, N, C[tM], f);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; N; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i == j)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">int</span> tM = M + R[i] + R[j] - <span class="number">2</span>*S;</span><br><span class="line">                <span class="keyword">if</span> (tM+N<span class="number">-1</span> &lt; N)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line"><span class="comment">//				printf(&quot;add C(%d %d)\n&quot;, tM+N-1, N);</span></span><br><span class="line">                ret += C[tM+N<span class="number">-1</span>];</span><br><span class="line">                ret %= MOD;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> f = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N<span class="number">-2</span>; i++)</span><br><span class="line">            f = (f * i)%MOD;</span><br><span class="line">        ret = ret * f;</span><br><span class="line">        ret %= MOD;</span><br><span class="line">        <span class="built_in">assert</span>(ret &gt;= <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %lld\n&quot;</span>, ++cases, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-2017-facebook-hacker-cup-qualification" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/16/2017-facebook-hacker-cup-qualification/" class="article-date">
  <time datetime="2017-01-16T02:23:56.000Z" itemprop="datePublished">2017-01-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/16/2017-facebook-hacker-cup-qualification/">2017 Facebook Hacker Cup 資格賽</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/01/16/2017-facebook-hacker-cup-qualification/" data-id="ckpaivc6y000fn8vnawpn89wp" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/01/16/2017-facebook-hacker-cup-qualification/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <blockquote>
<p>原本只是想推碩一學弟去寫，學弟邀著邀著，我這個老骨頭只好跟著寫</p>
</blockquote>
<h2 id="Facebook-Hacker-Cup-2017-Qualification-Round"><a href="#Facebook-Hacker-Cup-2017-Qualification-Round" class="headerlink" title="Facebook Hacker Cup 2017 Qualification Round"></a>Facebook Hacker Cup 2017 Qualification Round</h2><h3 id="A-Progress-Pie"><a href="#A-Progress-Pie" class="headerlink" title="A. Progress Pie"></a>A. Progress Pie</h3><p>給一個落在 <span>$(0, 0)\; , (100, 100)$</span><!-- Has MathJax --> 矩形內部的圓餅圖，並且從垂直十二點方向開始，順時針繞一圈 <span>$P \%$</span><!-- Has MathJax --> ，又額外給一座標，請問該點是黑色還是白色，並且保證任何一組詢問點，鄰近 <span>$10^{-6}$</span><!-- Has MathJax --> 都屬於相同顏色。</p>
<p>從最後一個條件來看，我們處理邊界條件的誤差是可以容忍的。由於輸入都是整數，完全在整數上操作的部分尚未想到，但我們可以透過內積外積得到詢問點是順時針轉了 <span>$R, \; 0 \le R &lt; 2 \pi$</span><!-- Has MathJax --> ，只需要判斷 <span>$R$</span><!-- Has MathJax --> 是否小於等於 <span>$P$</span><!-- Has MathJax --> 即可。</p>
<p>十二點鐘的方向向量為 <span>$\vec{v} = (0, 50)$</span><!-- Has MathJax --> ，詢問點與圓心的向量為 <span>$\vec{u} = (X-50, Y-50)$</span><!-- Has MathJax --> ，計算這兩個向量的夾角 <span>$\theta = \cos^{-1}(\frac{u \cdot v}{|u| |v|})$</span><!-- Has MathJax --> ，這樣算出來的角度只會落在 <span>$[0, \pi)$</span><!-- Has MathJax --> ，接著透過外積決定順時針還是逆時針，補回來即可。</p>
<h3 id="B-Lazy-Loading"><a href="#B-Lazy-Loading" class="headerlink" title="B. Lazy Loading"></a>B. Lazy Loading</h3><p>搬家公司的工人要搬運 <span>$N$</span><!-- Has MathJax --> 個重量不同的傢俱，主管要求每次搬運至少 50 磅，工人為了偷懶，每次只搬運一部份的傢俱，然而主管不會準確計算工人搬運的總重，只會問一次搬運的最大重量和個數，工人想藉由分配方法來增加工作天數，請問要怎麼符合需求達到最多搬運天數。</p>
<p>可想而知，我們只需要貪心計算即可，每次挑選最重的那一個，接著搭配當前最輕的來湊數，一超過 50 磅就當作一天的搬運方案，直到沒有物品。一開始排序好 <span>$O(N \log N)$</span><!-- Has MathJax --> ，接著只需要掃描一次 <span>$O(N)$</span><!-- Has MathJax --> 即可完成。</p>
<h3 id="C-Fighting-the-Zombie"><a href="#C-Fighting-the-Zombie" class="headerlink" title="C. Fighting the Zombie"></a>C. Fighting the Zombie</h3><p>在 D&amp;D 遊戲中，我們需要施放技能攻擊血量為 <span>$H$</span><!-- Has MathJax --> 的殭屍，施放採用擲骰子的方式，骰一個 <span>$Y$</span><!-- Has MathJax --> 面骰 <span>$X$</span><!-- Has MathJax --> 次得到的點數總和加上固定值 <span>$Z$</span><!-- Has MathJax --> ，請問一擊必殺的機率最高為何，由於盤面上有許多骰子可以挑選，請輸出機率最高的那個骰子的機率為何。</p>
<p>首先，我們必須先瞭解最基礎的六面骰，投擲 <span>$X$</span><!-- Has MathJax --> 總和的方法數怎麼計算，定義 <span>$\text{dp}[i][j]$</span><!-- Has MathJax --> 表示投擲 <span>$i$</span><!-- Has MathJax --> 次，點數總和為 <span>$j$</span><!-- Has MathJax --> 的方法數。我們得到</p>
<span>$$\begin{align*}
dp[i][j] = \left\{\begin{matrix}
1 &amp;&amp; i = 0\;, j = 0\\
dp[i-1][j-1] + dp[i-1][j-2] + \cdots + dp[i-1][j-6] &amp;&amp; i \le j \\
0 &amp;&amp; \text{otherwise}
\end{matrix}\right.
\end{align*}$$</span><!-- Has MathJax -->

<p>上述的遞迴考慮 <span>$i-1$</span><!-- Has MathJax --> 個骰子的總和方法數，再決定第 <span>$i$</span><!-- Has MathJax --> 個骰子擲出哪一種點數。然而，這種方法不適用此題計算機率，很容易發生 overflow，方法數的總和為 <span>$Y^X$</span><!-- Has MathJax --> ，所以一開始我們就採用機率的方式統計。</p>
<span>$$\begin{align*}
dp[i][j] = \left\{\begin{matrix}
1 &amp;&amp; i = 0\;, j = 0\\
(dp[i-1][j-1] + dp[i-1][j-2] + \cdots + dp[i-1][j-6])/6 &amp;&amp; i \le j \\
0 &amp;&amp; \text{otherwise}
\end{matrix}\right.
\end{align*}$$</span><!-- Has MathJax -->

<p>這樣的 DP 計算消耗時間 <span>$O(X^2 Y^2)$</span><!-- Has MathJax --> ，加上滑動窗口統計總和則可以落在 <span>$O(X^2 Y)$</span><!-- Has MathJax --> 。</p>
<blockquote>
<p>比賽當下寫的，思路不是很清楚，變數命名和邏輯判斷會有點醜，沒有好好整理。</p>
</blockquote>
<h3 id="Solution-A"><a href="#Solution-A" class="headerlink" title="Solution A"></a>Solution A</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-8</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> pi = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span> (testcase--) &#123;</span><br><span class="line">        <span class="keyword">int</span> P, X, Y;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;P, &amp;X, &amp;Y);</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (X == <span class="number">50</span> &amp;&amp; Y == <span class="number">50</span>) &#123;</span><br><span class="line">            ret = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">hypot</span>(X<span class="number">-50</span>, Y<span class="number">-50</span>) &gt; <span class="number">50</span>) &#123;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (P == <span class="number">100</span>) &#123;</span><br><span class="line">            ret = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (P == <span class="number">0</span>) &#123;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> vx = X<span class="number">-50</span>, vy = Y<span class="number">-50</span>;</span><br><span class="line">            <span class="keyword">int</span> tx = <span class="number">0</span>, ty = <span class="number">50</span>;</span><br><span class="line">            <span class="keyword">double</span> theta = <span class="built_in">acos</span>((vx*tx+vy*ty)/<span class="built_in">hypot</span>(vx, vy)/<span class="built_in">hypot</span>(tx, ty));</span><br><span class="line">            <span class="keyword">if</span> (tx*vy - ty*vx &gt; <span class="number">0</span>)</span><br><span class="line">                theta = <span class="number">2</span>*pi-theta;</span><br><span class="line">            <span class="keyword">double</span> t = (<span class="keyword">double</span>) P/<span class="number">100.0</span>*<span class="number">2</span>*pi;</span><br><span class="line">            <span class="keyword">if</span> (theta &lt;= t)</span><br><span class="line">                ret = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %s\n&quot;</span>, ++cases, ret ? <span class="string">&quot;black&quot;</span> : <span class="string">&quot;white&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-B"><a href="#Solution-B" class="headerlink" title="Solution B"></a>Solution B</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span> (testcase--) &#123;</span><br><span class="line">        <span class="keyword">int</span> n;</span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; A;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">            A.<span class="built_in">push_back</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(A.<span class="built_in">begin</span>(), A.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> r = n<span class="number">-1</span>, l = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (r &gt;= l) &#123;</span><br><span class="line">            <span class="keyword">int</span> need = ((<span class="number">50</span> + A[r]<span class="number">-1</span>) / A[r]);</span><br><span class="line">            <span class="keyword">if</span> (l + need<span class="number">-1</span> &gt; r)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            l += need<span class="number">-1</span>, r--;</span><br><span class="line">            ret++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %d\n&quot;</span>, ++cases, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-C"><a href="#Solution-C" class="headerlink" title="Solution C"></a>Solution C</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span> (testcase--) &#123;</span><br><span class="line">        <span class="keyword">int</span> H, S;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;H, &amp;S);</span><br><span class="line">        vector&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; A;</span><br><span class="line">        <span class="keyword">double</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; S; i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> s[<span class="number">128</span>];</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">            <span class="keyword">int</span> X = <span class="number">0</span>, Y = <span class="number">0</span>, Z = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>, x = <span class="number">0</span>, sign = <span class="number">1</span>, idx = <span class="number">0</span>; s[j]; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">isdigit</span>(s[j]))</span><br><span class="line">                    x = x * <span class="number">10</span> + s[j] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                <span class="keyword">if</span> (s[j+<span class="number">1</span>] == <span class="string">&#x27;\0&#x27;</span> || !<span class="built_in">isdigit</span>(s[j])) &#123;</span><br><span class="line">                    x = x * sign;</span><br><span class="line">                    <span class="keyword">if</span> (idx == <span class="number">0</span>)</span><br><span class="line">                        X = x;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (idx == <span class="number">1</span>)</span><br><span class="line">                        Y = x;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        Z = x;</span><br><span class="line">                    <span class="keyword">if</span> (s[j] == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">                        sign = <span class="number">-1</span>;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        sign = <span class="number">1</span>;</span><br><span class="line">                    x = <span class="number">0</span>, idx++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> l = X+Z, r = X*Y+Z;</span><br><span class="line">            <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> OFF = <span class="number">1024</span>;</span><br><span class="line">            <span class="keyword">static</span> <span class="keyword">double</span> dp[<span class="number">2</span>][OFF];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; OFF; i++)</span><br><span class="line">                dp[<span class="number">0</span>][i] = dp[<span class="number">1</span>][i] = <span class="number">0</span>;</span><br><span class="line">            dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; X; i++) &#123;</span><br><span class="line">                <span class="keyword">int</span> p = i&amp;<span class="number">1</span>, q = i&amp;<span class="number">1</span>^<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; OFF; j++)</span><br><span class="line">                    dp[q][j] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; OFF; j++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (dp[p][j] &lt;= <span class="number">0</span>)	<span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= Y; k++)</span><br><span class="line">                        dp[q][j+k] += dp[p][j]*((<span class="keyword">double</span>) <span class="number">1.f</span>/Y);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">double</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= X*Y; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j+Z &gt;= H)</span><br><span class="line">                    sum += dp[(X<span class="number">-1</span>)&amp;<span class="number">1</span>^<span class="number">1</span>][j];</span><br><span class="line">            &#125;</span><br><span class="line">            ret = <span class="built_in">max</span>(ret, sum);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %.6lf\n&quot;</span>,++cases, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-20008" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/18/jg-20008/" class="article-date">
  <time datetime="2016-12-18T03:14:07.000Z" itemprop="datePublished">2016-12-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/出題解題/">出題解題</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/18/jg-20008/">淺談多重背包問題 (Multiple Knapsack Problem) 優化那些事</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/12/18/jg-20008/" data-id="ckpaivc7s002vn8vnb6vzdwfq" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/12/18/jg-20008/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DP/">DP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/monotone-queue/">monotone queue</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/優化/">優化</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/單調堆/">單調堆</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/背包問題/">背包問題</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <blockquote>
<p>收錄於 <a href="https://judgegirl.csie.org/problem/0/20008">批改娘 20008. Fast Multiple Knapsack Problem</a></p>
</blockquote>
<blockquote>
<p>之所以出了這一題，源自於實驗室另一名同學跑實驗太久，進而撰寫優化程序。聽說原本跑了十分鐘的實驗，改善後提升了到一分鐘跑完。</p>
</blockquote>
<h2 id="輸入格式"><a href="#輸入格式" class="headerlink" title="輸入格式"></a>輸入格式</h2><p>每組測資第一行包含兩個正整數，分別代表背包大小 $M$ ($\leq 10^6$) 和物品個數 $N$ ($\leq 1000$)，下一行開始每行包含兩個正整數，分別代表物品價值 $P_i$ ($\leq 10^3$)、物品重量 $W_i$ ($ \leq 10^5$) 以及物品最多可以挑 $C_i$ 個 ($\le 100$)。</p>
<h2 id="輸出格式"><a href="#輸出格式" class="headerlink" title="輸出格式"></a>輸出格式</h2><p>對於每組測資，請輸出最大收益。</p>
<h2 id="範例輸入-1"><a href="#範例輸入-1" class="headerlink" title="範例輸入 1"></a>範例輸入 1</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">50 7</span><br><span class="line">66 31 1</span><br><span class="line">232 10 4</span><br><span class="line">49 20 1</span><br><span class="line">54 19 1</span><br><span class="line">426 4 3</span><br><span class="line">589 3 10</span><br><span class="line">10 6 4</span><br></pre></td></tr></table></figure>

<h2 id="範例輸出-1"><a href="#範例輸出-1" class="headerlink" title="範例輸出 1"></a>範例輸出 1</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7178</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><blockquote>
<p>不管是 0/1 背包或者多重背包，兩者都屬於 bounded knapsack problem 問題。即便如此，優化上仍有些許的不同，請讓我緩緩道來。</p>
</blockquote>
<p>在此之前，您必須先理解上一篇《淺談背包問題 (0/1 Knapsack Problem) 優化那些事》的部分，不然會造成閱讀上的困難。</p>
<p>多重背包有一個二進制優化，也就是當物品限制最多拿 <span>$C$</span><!-- Has MathJax --> 個時，我們可以利用二進制組合的方式，轉換到 0/1 背包問題，因此我們會得到新的 <span>$N \log C$</span><!-- Has MathJax --> 個物品跑一次 0/1 背包，因此複雜度落在 <span>$O(N \log C \; W)$</span><!-- Has MathJax --> </p>
<p>然而，從公式定義上，在好幾年前的論文中，使用斜率優化降到 <span>$O(N \; W)$</span><!-- Has MathJax -->，推倒過程如下，</p>
<span>$j = k \; w_i + r, \; 0 \le r \le w_i - 1$</span><!-- Has MathJax -->

<span>$$\begin{align*}
dp[i][j] &amp;= \max\left\{dp[i-1][j], dp[i-1][j-w_i]+p_i, \cdots, dp[i-1][j-c_i \; w_i] + c_i \; p_i\right\} \\
&Tab;&amp;= \max\left\{dp[i-1][k \; w_i + r], dp[i-1][(k-1) \; w_i + r] + p_i, \cdots
&Tab;&Tab;, dp[i-1][(k-c_i) \; w_i + r] + c_i p_i\right\} \\
&Tab;&amp;= \max\left\{dp[i-1][k \; w_i + r] - k \; p_i, dp[i-1][(k-1) \; w_i + r] + (k-1) \; p_i, \cdots
&Tab;&Tab;, dp[i-1][(k-c_i) \; w_i + r] - (k-c_i) p_i\right\} + k \; p_i\\
\end{align*}$$</span><!-- Has MathJax -->

<p>隨著式子的轉移，我們發現每一個取值將不依賴相對位置，只跟自身的位置有關，那麼可以使用單調堆 (monotone queue) 運行 <span>$O(1)$</span><!-- Has MathJax --> 的 sliding windows 查找極值。最後，將相同餘數分堆處理，單調堆中最多存在 <span>$O(c)$</span><!-- Has MathJax --> 個元素。</p>
<h3 id="優化初夜"><a href="#優化初夜" class="headerlink" title="優化初夜"></a>優化初夜</h3><blockquote>
<p>如果只使用二進制優化，套上我們的 0/1 優化方案，將有大幅度地提升。</p>
</blockquote>
<p>加入 0/1 背包的優化策略，再套上最簡單的斜率優化算法，得到下面的程式。這裡很懶惰地，由於單調堆最多入隊 <span>$W$</span><!-- Has MathJax --> 次，不外乎地直接只用大小為 <span>$W$</span><!-- Has MathJax --> 的方式實作。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXW = <span class="number">1000005</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1005</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BB</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> w, v, c;</span><br><span class="line">        <span class="built_in">BB</span>(<span class="keyword">int</span> w = <span class="number">0</span>, <span class="keyword">int</span> v = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>):</span><br><span class="line">            <span class="built_in">w</span>(w), <span class="built_in">v</span>(v), <span class="built_in">c</span>(c) &#123;&#125;</span><br><span class="line">        <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> BB &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> w * c  &lt; x.w * x.c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(BB A[], <span class="keyword">int</span> dp[], <span class="keyword">int</span> W, <span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> MQ[MAXW][<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> w = A[i].w, v = A[i].v, c = A[i].c;</span><br><span class="line">            sum = <span class="built_in">min</span>(sum + w*c, W);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; w; j++) &#123;</span><br><span class="line">                <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>;</span><br><span class="line">                MQ[l][<span class="number">0</span>] = <span class="number">0</span>, MQ[l][<span class="number">1</span>] = dp[j];</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k*w+j &lt;= sum; k++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (k - MQ[l][<span class="number">0</span>] &gt; c)	</span><br><span class="line">                        l++;</span><br><span class="line">                    <span class="keyword">int</span> dpv = dp[k*w+j] - k*v;</span><br><span class="line">                    <span class="keyword">while</span> (l &lt;= r &amp;&amp; MQ[r][<span class="number">1</span>] &lt;= dpv)</span><br><span class="line">                        r--;</span><br><span class="line">                    r++;</span><br><span class="line">                    MQ[r][<span class="number">0</span>] = k, MQ[r][<span class="number">1</span>] = dpv;</span><br><span class="line">                    dp[k*w+j] = <span class="built_in">max</span>(dp[k*w+j], MQ[l][<span class="number">1</span>] + k*v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;	</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">knapsack</span><span class="params">(<span class="keyword">int</span> C[][<span class="number">3</span>], <span class="keyword">int</span> N, <span class="keyword">int</span> W)</span> </span>&#123;</span><br><span class="line">        vector&lt;BB&gt; A;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> w = C[i][<span class="number">0</span>], v = C[i][<span class="number">1</span>], c = C[i][<span class="number">2</span>];</span><br><span class="line">            A.<span class="built_in">push_back</span>(<span class="built_in">BB</span>(w, v, c));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">assert</span>(N &lt; MAXN);</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> dp1[MAXW+<span class="number">1</span>], dp2[MAXW+<span class="number">1</span>];</span><br><span class="line">        BB Ar[<span class="number">2</span>][MAXN];</span><br><span class="line">        <span class="keyword">int</span> ArN[<span class="number">2</span>] = &#123;&#125;;</span><br><span class="line">        <span class="built_in">memset</span>(dp1, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp1[<span class="number">0</span>])*(W+<span class="number">1</span>));</span><br><span class="line">        <span class="built_in">memset</span>(dp2, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp2[<span class="number">0</span>])*(W+<span class="number">1</span>));</span><br><span class="line">        <span class="built_in">sort</span>(A.<span class="built_in">begin</span>(), A.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">int</span> sum[<span class="number">2</span>] = &#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> ch = sum[<span class="number">1</span>] &lt; sum[<span class="number">0</span>];</span><br><span class="line">            Ar[ch][ArN[ch]] = A[i];</span><br><span class="line">            ArN[ch]++;</span><br><span class="line">            sum[ch] = <span class="built_in">min</span>(sum[ch] + A[i].w*A[i].c, W);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">run</span>(Ar[<span class="number">0</span>], dp1, W, ArN[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">run</span>(Ar[<span class="number">1</span>], dp2, W, ArN[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = W, mx = <span class="number">0</span>; i &lt;= W; i++, j--) &#123;</span><br><span class="line">            mx = <span class="built_in">max</span>(mx, dp2[i]);</span><br><span class="line">            ret = <span class="built_in">max</span>(ret, dp1[j] + mx);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> W, N;</span><br><span class="line">    <span class="built_in">assert</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;W, &amp;N) == <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">int</span> C[MAXN][<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">        <span class="built_in">assert</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;C[i][<span class="number">1</span>], &amp;C[i][<span class="number">0</span>], &amp;C[i][<span class="number">2</span>]) == <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">knapsack</span>(C, N, W));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不幸地，相較於一般的斜率優化寫法，並沒有太大的改善。</p>
<h3 id="優化二夜"><a href="#優化二夜" class="headerlink" title="優化二夜"></a>優化二夜</h3><p>運行 sliding windows 操作時，前 <span>$c$</span><!-- Has MathJax --> 次，是不會進行 <code>pop_front()</code> 操作的，因此把迴圈分兩堆處理，增加 branch predict。以及在乘數運算上，使用強度減少 (strength reduction) 的技術，將乘法換成加法。</p>
<blockquote>
<p>只能些許地改善 5% 的效能。</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(BB A[], <span class="keyword">int</span> dp[], <span class="keyword">int</span> W, <span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> MQ[MAXW][<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> w = A[i].w, v = A[i].v, c = A[i].c;</span><br><span class="line">        sum = <span class="built_in">min</span>(sum + w*c, W);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; w; j++) &#123;</span><br><span class="line">            <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>;</span><br><span class="line">            MQ[l][<span class="number">0</span>] = <span class="number">0</span>, MQ[l][<span class="number">1</span>] = dp[j];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>, tw = w+j, tv = v; tw &lt;= sum &amp;&amp; k &lt;= c; k++, tw += w, tv += v) &#123;</span><br><span class="line">                <span class="keyword">int</span> dpv = dp[tw] - tv;</span><br><span class="line">                <span class="keyword">while</span> (l &lt;= r &amp;&amp; MQ[r][<span class="number">1</span>] &lt;= dpv)</span><br><span class="line">                    r--;</span><br><span class="line">                r++;</span><br><span class="line">                MQ[r][<span class="number">0</span>] = k, MQ[r][<span class="number">1</span>] = dpv;</span><br><span class="line">                dp[tw] = <span class="built_in">max</span>(dp[tw], MQ[l][<span class="number">1</span>] + tv);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = c+<span class="number">1</span>, tw = (c+<span class="number">1</span>)*w+j, tv = (c+<span class="number">1</span>)*v; tw &lt;= sum; k++, tw += w, tv += v) &#123;</span><br><span class="line">                <span class="keyword">if</span> (k - MQ[l][<span class="number">0</span>] &gt; c)   </span><br><span class="line">                    l++;</span><br><span class="line">                <span class="keyword">int</span> dpv = dp[tw] - tv;</span><br><span class="line">                <span class="keyword">while</span> (l &lt;= r &amp;&amp; MQ[r][<span class="number">1</span>] &lt;= dpv)</span><br><span class="line">                    r--;</span><br><span class="line">                r++;</span><br><span class="line">                MQ[r][<span class="number">0</span>] = k, MQ[r][<span class="number">1</span>] = dpv;</span><br><span class="line">                dp[tw] = <span class="built_in">max</span>(dp[tw], MQ[l][<span class="number">1</span>] + tv);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="優化三夜"><a href="#優化三夜" class="headerlink" title="優化三夜"></a>優化三夜</h3><p>後來發現，sliding windows 滑動時，我們常常看前看後，因此常常會發生 cache miss，因為他要跳躍一大段記憶體空間查找數值，所以可以考慮花點操作將極值放在 stack 上，視為一種 software cache 來加速，來減少 cache miss 的懲罰。</p>
<p>接著，在迴圈邊界比較時，我們可以算得更精準些，回到一般的 <code>i++</code> 的 format pattern，讓編譯器幫我們做常見的迴圈優化。</p>
<blockquote>
<p>改善了 10% 效能</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(BB A[], <span class="keyword">int</span> dp[], <span class="keyword">int</span> W, <span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> MQ[MAXW][<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> w = A[i].w, v = A[i].v, c = A[i].c;</span><br><span class="line">        sum = <span class="built_in">min</span>(sum + w*c, W);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; w; j++) &#123;</span><br><span class="line">            <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>;</span><br><span class="line">            MQ[l][<span class="number">0</span>] = <span class="number">0</span>, MQ[l][<span class="number">1</span>] = dp[j];</span><br><span class="line">            <span class="keyword">int</span> cache_max = MQ[l][<span class="number">1</span>], cache_idx = MQ[l][<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">int</span> k_bound;</span><br><span class="line">            k_bound = <span class="built_in">min</span>((sum-j)/w, c);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>, tw = w+j, tv = v; k &lt;= k_bound; k++, tw += w, tv += v) &#123;</span><br><span class="line">                <span class="comment">// tw = k*w+j, tv = k*v;</span></span><br><span class="line">                <span class="keyword">int</span> dpv = dp[tw] - tv;</span><br><span class="line">                <span class="keyword">while</span> (l &lt;= r &amp;&amp; MQ[r][<span class="number">1</span>] &lt;= dpv)</span><br><span class="line">                    r--;</span><br><span class="line">                r++;</span><br><span class="line">                MQ[r][<span class="number">0</span>] = k, MQ[r][<span class="number">1</span>] = dpv;</span><br><span class="line">                <span class="keyword">if</span> (r == l)    cache_max = dpv, cache_idx = k;</span><br><span class="line">                dp[tw] = <span class="built_in">max</span>(dp[tw], cache_max + tv);</span><br><span class="line">            &#125;</span><br><span class="line">            k_bound = (sum-j)/w;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = c+<span class="number">1</span>, tw = (c+<span class="number">1</span>)*w+j, tv = (c+<span class="number">1</span>)*v; k &lt;= k_bound; k++, tw += w, tv += v) &#123;</span><br><span class="line">                <span class="keyword">int</span> dpv = dp[tw] - tv;</span><br><span class="line">                <span class="keyword">while</span> (l &lt;= r &amp;&amp; MQ[r][<span class="number">1</span>] &lt;= dpv)</span><br><span class="line">                    r--;</span><br><span class="line">                r++;</span><br><span class="line">                MQ[r][<span class="number">0</span>] = k, MQ[r][<span class="number">1</span>] = dpv;</span><br><span class="line">                <span class="keyword">if</span> (r == l)   </span><br><span class="line">                    cache_max = dpv, cache_idx = k;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (k - cache_idx &gt; c)   </span><br><span class="line">                    l++, cache_idx = MQ[l][<span class="number">0</span>], cache_max = MQ[l][<span class="number">1</span>];</span><br><span class="line">                dp[tw] = <span class="built_in">max</span>(dp[tw], cache_max + tv);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="優化四夜"><a href="#優化四夜" class="headerlink" title="優化四夜"></a>優化四夜</h3><p>儘管上面使用的 software cache 的方式減少 cache miss，但 DP table 仍與數據結構的記憶體位置相當遙遠，為了使他們貼近，應使用環狀隊列的實作，空間從 <span>$O(W)$</span><!-- Has MathJax --> 將到 <span>$O(N)$</span><!-- Has MathJax -->，實作時，將大小限制在 <span>$2^k$</span><!-- Has MathJax -->，方便運行時使用 AND 運算取代耗時的模數運算。</p>
<p>由於限制個數分佈上，很容易造成貪心算法有解，因此先跑一次貪心，如果貪心沒辦法達到剛好大小，那麼再跑 DP 找解。DP 找解時，可以將物品嘗試進行二進制轉換，將等價物品合併，來觸發計算邊界的優化。完成的程序如下：</p>
<blockquote>
<p>最終加速，改善 10%，期待你我的分享增進。根據鴿籠原理，cp 直種類不多時，可以高達 10 倍以上的加速。</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXW = <span class="number">1000005</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1005</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXC = <span class="number">1</span>&lt;&lt;<span class="number">12</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BB</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> w, v, c;</span><br><span class="line">        <span class="built_in">BB</span>(<span class="keyword">int</span> w = <span class="number">0</span>, <span class="keyword">int</span> v = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>):</span><br><span class="line">            <span class="built_in">w</span>(w), <span class="built_in">v</span>(v), <span class="built_in">c</span>(c) &#123;&#125;</span><br><span class="line">        <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> BB &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> w * c  &lt; x.w * x.c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">cmpByWeight</span><span class="params">(BB x, BB y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x.w &lt; y.w;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(BB A[], <span class="keyword">int</span> dp[], <span class="keyword">int</span> W, <span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> MQ[MAXC][<span class="number">2</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> w = A[i].w, v = A[i].v, c = A[i].c;</span><br><span class="line">            <span class="built_in">assert</span>(c &lt; MAXC);</span><br><span class="line">            sum = <span class="built_in">min</span>(sum + w*c, W);</span><br><span class="line">            <span class="keyword">if</span> (c != <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; w; j++) &#123;</span><br><span class="line">                    <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>;</span><br><span class="line">                    MQ[r][<span class="number">0</span>] = <span class="number">0</span>, MQ[r][<span class="number">1</span>] = dp[j];</span><br><span class="line">                    <span class="keyword">int</span> cache_max = MQ[r][<span class="number">1</span>], cache_idx = MQ[r][<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">int</span> k_bound;</span><br><span class="line">                    r = (r+<span class="number">1</span>)&amp;(MAXC<span class="number">-1</span>);</span><br><span class="line">                    k_bound = <span class="built_in">min</span>((sum-j)/w, c);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>, tw = w+j, tv = v; k &lt;= k_bound; k++, tw += w, tv += v) &#123;</span><br><span class="line">                        <span class="comment">// tw = k*w+j, tv = k*v;</span></span><br><span class="line">                        <span class="keyword">int</span> dpv = dp[tw] - tv;</span><br><span class="line">                        <span class="keyword">while</span> (l != r &amp;&amp; MQ[(r<span class="number">-1</span>+MAXC)&amp;(MAXC<span class="number">-1</span>)][<span class="number">1</span>] &lt;= dpv)</span><br><span class="line">                            r = (r<span class="number">-1</span>+MAXC)&amp;(MAXC<span class="number">-1</span>);</span><br><span class="line">                        MQ[r][<span class="number">0</span>] = k, MQ[r][<span class="number">1</span>] = dpv;</span><br><span class="line">                        <span class="keyword">if</span> (l == r)	cache_max = dpv, cache_idx = k;</span><br><span class="line">                        r = (r+<span class="number">1</span>)&amp;(MAXC<span class="number">-1</span>);</span><br><span class="line">                        dp[tw] = <span class="built_in">max</span>(dp[tw], cache_max + tv);</span><br><span class="line">                    &#125;</span><br><span class="line">                    k_bound = (sum-j)/w;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = c+<span class="number">1</span>, tw = (c+<span class="number">1</span>)*w+j, tv = (c+<span class="number">1</span>)*v; k &lt;= k_bound; k++, tw += w, tv += v) &#123;</span><br><span class="line">                        <span class="keyword">int</span> dpv = dp[tw] - tv;</span><br><span class="line">                        <span class="keyword">while</span> (l != r &amp;&amp; MQ[(r<span class="number">-1</span>+MAXC)&amp;(MAXC<span class="number">-1</span>)][<span class="number">1</span>] &lt;= dpv)</span><br><span class="line">                            r--;</span><br><span class="line">                        MQ[r][<span class="number">0</span>] = k, MQ[r][<span class="number">1</span>] = dpv;</span><br><span class="line">                        <span class="keyword">if</span> (l == r)	cache_max = dpv, cache_idx = k;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (k - cache_idx &gt; c)	</span><br><span class="line">                            l = (l+<span class="number">1</span>)&amp;(MAXC<span class="number">-1</span>), cache_idx = MQ[l][<span class="number">0</span>], cache_max = MQ[l][<span class="number">1</span>];</span><br><span class="line">                        r = (r+<span class="number">1</span>)&amp;(MAXC<span class="number">-1</span>);</span><br><span class="line">                        dp[tw] = <span class="built_in">max</span>(dp[tw], cache_max + tv);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = sum; j &gt;= w; j--)</span><br><span class="line">                    dp[j] = <span class="built_in">max</span>(dp[j], dp[j-w]+v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;	</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">greedy</span><span class="params">(<span class="keyword">int</span> C[][<span class="number">3</span>], <span class="keyword">int</span> N, <span class="keyword">int</span> W)</span> </span>&#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">GB</span> &#123;</span></span><br><span class="line">            <span class="keyword">int</span> w, v, c;</span><br><span class="line">            <span class="built_in">GB</span>(<span class="keyword">int</span> w = <span class="number">0</span>, <span class="keyword">int</span> v = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>):</span><br><span class="line">                <span class="built_in">w</span>(w), <span class="built_in">v</span>(v), <span class="built_in">c</span>(c) &#123;&#125;</span><br><span class="line">            <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> GB &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (v * x.w != x.v * w)</span><br><span class="line">                    <span class="keyword">return</span> v * x.w &gt; x.v * w;</span><br><span class="line">                <span class="keyword">return</span> c &gt; x.c;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        vector&lt;GB&gt; A;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> w = C[i][<span class="number">0</span>], v = C[i][<span class="number">1</span>], c = C[i][<span class="number">2</span>];</span><br><span class="line">            A.<span class="built_in">push_back</span>(<span class="built_in">GB</span>(w, v, c));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(A.<span class="built_in">begin</span>(), A.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> t = <span class="built_in">min</span>(A[i].c, W/A[i].w);</span><br><span class="line">            <span class="keyword">if</span> (t == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            W -= t*A[i].w;</span><br><span class="line">            ret += t*A[i].v;</span><br><span class="line">            <span class="keyword">if</span> (W == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">knapsack</span><span class="params">(<span class="keyword">int</span> C[][<span class="number">3</span>], <span class="keyword">int</span> N, <span class="keyword">int</span> W)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// filter</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> filter = <span class="built_in">greedy</span>(C, N, W);</span><br><span class="line">            <span class="keyword">if</span> (filter != <span class="number">-1</span>)</span><br><span class="line">                <span class="keyword">return</span> filter;</span><br><span class="line">        &#125;</span><br><span class="line">        vector&lt;BB&gt; A;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> w = C[i][<span class="number">0</span>], v = C[i][<span class="number">1</span>], c = C[i][<span class="number">2</span>];</span><br><span class="line">            A.<span class="built_in">push_back</span>(<span class="built_in">BB</span>(w, v, c));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// reduce</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">sort</span>(A.<span class="built_in">begin</span>(), A.<span class="built_in">end</span>(), cmpByWeight);</span><br><span class="line">            map&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;, <span class="keyword">int</span>&gt; R;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">                R[<span class="built_in">make_pair</span>(A[i].w, A[i].v)] = i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">                <span class="keyword">int</span> c = A[i].c;</span><br><span class="line">                map&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;, <span class="keyword">int</span>&gt;::iterator it;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= c; k &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">int</span> w = A[i].w * k, v = A[i].v * k;</span><br><span class="line">                    it = R.<span class="built_in">find</span>(<span class="built_in">make_pair</span>(w, v));</span><br><span class="line">                    <span class="keyword">if</span> (it != R.<span class="built_in">end</span>() &amp;&amp; i != it-&gt;second) &#123;</span><br><span class="line">                        <span class="keyword">int</span> j = it-&gt;second;</span><br><span class="line">                        A[j].c ++;</span><br><span class="line">                        A[i].c -= k;</span><br><span class="line">                    &#125;</span><br><span class="line">                    c -= k;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (c &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">int</span> w = A[i].w * c, v = A[i].v * c;</span><br><span class="line">                    it = R.<span class="built_in">find</span>(<span class="built_in">make_pair</span>(w, v));</span><br><span class="line">                    <span class="keyword">if</span> (it != R.<span class="built_in">end</span>() &amp;&amp; i != it-&gt;second) &#123;</span><br><span class="line">                        <span class="keyword">int</span> j = it-&gt;second;</span><br><span class="line">                        A[j].c ++;</span><br><span class="line">                        A[i].c -= c;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> dp1[MAXW+<span class="number">1</span>], dp2[MAXW+<span class="number">1</span>];</span><br><span class="line">        BB Ar[<span class="number">2</span>][MAXN];</span><br><span class="line">        <span class="keyword">int</span> ArN[<span class="number">2</span>] = &#123;&#125;;</span><br><span class="line">        <span class="built_in">memset</span>(dp1, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp1[<span class="number">0</span>])*(W+<span class="number">1</span>));</span><br><span class="line">        <span class="built_in">memset</span>(dp2, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp2[<span class="number">0</span>])*(W+<span class="number">1</span>));</span><br><span class="line">        <span class="built_in">sort</span>(A.<span class="built_in">begin</span>(), A.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">int</span> sum[<span class="number">2</span>] = &#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> ch = sum[<span class="number">1</span>] &lt; sum[<span class="number">0</span>];</span><br><span class="line">            Ar[ch][ArN[ch]] = A[i];</span><br><span class="line">            ArN[ch]++;</span><br><span class="line">            sum[ch] = <span class="built_in">min</span>(sum[ch] + A[i].w*A[i].c, W);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">run</span>(Ar[<span class="number">0</span>], dp1, W, ArN[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">run</span>(Ar[<span class="number">1</span>], dp2, W, ArN[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = W, mx = <span class="number">0</span>; i &lt;= W; i++, j--) &#123;</span><br><span class="line">            mx = <span class="built_in">max</span>(mx, dp2[i]);</span><br><span class="line">            ret = <span class="built_in">max</span>(ret, dp1[j] + mx);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> W, N;</span><br><span class="line">    <span class="built_in">assert</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;W, &amp;N) == <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">int</span> C[MAXN][<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">        <span class="built_in">assert</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;C[i][<span class="number">1</span>], &amp;C[i][<span class="number">0</span>], &amp;C[i][<span class="number">2</span>]) == <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">knapsack</span>(C, N, W));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-20005" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/18/jg-20005/" class="article-date">
  <time datetime="2016-12-18T01:13:40.000Z" itemprop="datePublished">2016-12-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/出題解題/">出題解題</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/18/jg-20005/">淺談背包問題 (0/1 Knapsack Problem) 優化那些事</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/12/18/jg-20005/" data-id="ckpaivc7r002tn8vn2ta15w8q" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/12/18/jg-20005/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DP/">DP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/優化/">優化</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/背包問題/">背包問題</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <blockquote>
<p>收錄於 <a href="https://judgegirl.csie.org/problem/0/20005">批改娘 20005. 0/1 Knapsack Problem</a>。之所以有機會談到這個問題，其原因於早期的背包問題，大多都是用 branch-and-bound 算法來完成，也因此學弟課程出了這一份作業，大部分的測資，使用 branch-and-bound 能跑得比一般記憶體化 DP 快上非常多。當然，作為一個 Morris(?) 怎能允許這樣的事情發生。</p>
</blockquote>
<blockquote>
<p>現在回顧一下背包問題的模型吧！</p>
</blockquote>
<h2 id="輸入格式"><a href="#輸入格式" class="headerlink" title="輸入格式"></a>輸入格式</h2><p>每組測資第一行包含兩個正整數，分別代表背包大小 $M$ ($\leq 5×10^6$) 和物品個數 $N$ ($\leq 1000$)，下一行開始每行包含兩個正整數，分別代表物品價值 $P_i$ ($\leq 10^5$)和物品重量 $W_i$ ($ \leq 10^5$)。</p>
<h2 id="輸出格式"><a href="#輸出格式" class="headerlink" title="輸出格式"></a>輸出格式</h2><p>對於每組測資，請輸出最大收益。</p>
<h2 id="範例輸入-1"><a href="#範例輸入-1" class="headerlink" title="範例輸入 1"></a>範例輸入 1</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">50 7</span><br><span class="line">70 31</span><br><span class="line">20 10</span><br><span class="line">39 20</span><br><span class="line">37 19</span><br><span class="line">7 4</span><br><span class="line">5 3</span><br><span class="line">10 6</span><br></pre></td></tr></table></figure>

<h2 id="範例輸出-1"><a href="#範例輸出-1" class="headerlink" title="範例輸出 1"></a>範例輸出 1</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">107</span><br></pre></td></tr></table></figure>

<h2 id="範例輸入-2"><a href="#範例輸入-2" class="headerlink" title="範例輸入 2"></a>範例輸入 2</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">170 7</span><br><span class="line">442 41</span><br><span class="line">525 50</span><br><span class="line">511 49</span><br><span class="line">593 59</span><br><span class="line">546 55</span><br><span class="line">564 57</span><br><span class="line">617 60</span><br></pre></td></tr></table></figure>

<h2 id="範例輸出-2"><a href="#範例輸出-2" class="headerlink" title="範例輸出 2"></a>範例輸出 2</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1735</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><h3 id="Branch-and-bound"><a href="#Branch-and-bound" class="headerlink" title="Branch-and-bound"></a>Branch-and-bound</h3><blockquote>
<p><a href="http://www.or.deis.unibo.it/kp/Chapter3.pdf">bound knapscak problem</a> 古耕竹同學提供</p>
</blockquote>
<p>如果物品可以被切割，那麼可以利用物品的 CP 值 (<span>$\textit{cp}_i = p_i/w_i$</span><!-- Has MathJax -->)排序，使用貪心算法在 <span>$O(N \log N)$</span><!-- Has MathJax --> 找到最佳解。然而，背包問題在於物品只能挑或不挑，一旦無法切割物品，那麼貪心算法無法將剩餘的部分填滿，進而可能產生更好的一組解填滿剩餘部分。</p>
<blockquote>
<p>想要更快嗎？多看論文且實作它吧！</p>
</blockquote>
<p>branch-and-bound 基本核心操作為</p>
<ul>
<li>按照 CP 值由大到小排序</li>
<li>貪心法最佳解 <span>$\textit{bound}$</span><!-- Has MathJax --></li>
<li>進行深度優先搜索，優先挑 CP 值大的入選<ul>
<li>當前挑選方案最佳解 <span>$g$</span><!-- Has MathJax --> + 剩餘物品使用貪心法最佳解 <span>$g$</span><!-- Has MathJax --> 小於等於當前最佳解 <span>$\textit{bound}$</span><!-- Has MathJax -->，則退出搜索。</li>
<li>更新 <span>$\textit{bound} = \max(\textit{bound}, g)$</span><!-- Has MathJax --></li>
<li>選擇加入 或 不加入 (註：學弟說我的某些測資，通通優先不選可以快個數十倍)</li>
</ul>
</li>
</ul>
<p>參考代碼</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Item</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, w;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">cp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">double</span>) v / w;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmpCP</span><span class="params">(Item a, Item b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> cpA = a.<span class="built_in">cp</span>();</span><br><span class="line">    <span class="keyword">double</span> cpB = b.<span class="built_in">cp</span>();</span><br><span class="line">    <span class="keyword">if</span> (cpA == cpB)</span><br><span class="line">        <span class="keyword">return</span> a.w &gt; b.w;</span><br><span class="line">    <span class="keyword">return</span> cpA &gt; cpB;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">Item items[<span class="number">1005</span>];</span><br><span class="line"><span class="keyword">int</span> prefixW[<span class="number">1005</span>];</span><br><span class="line"><span class="keyword">int</span> prefixV[<span class="number">1005</span>];</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">h</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> w, <span class="keyword">int</span> b, <span class="keyword">int</span> &amp;j, <span class="keyword">int</span> &amp;f)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fw = i == <span class="number">0</span> ? w : (w + prefixW[i<span class="number">-1</span>]);</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="built_in">max</span>(b, i); j &lt; n &amp;&amp; prefixW[j] &lt;= fw; j++);</span><br><span class="line">    <span class="keyword">if</span> (j &gt;= n) &#123;</span><br><span class="line">        <span class="keyword">return</span> prefixV[n<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> v = <span class="number">0</span>;</span><br><span class="line">    f = <span class="number">0</span>;</span><br><span class="line">    v += prefixV[j<span class="number">-1</span>] - (i == <span class="number">0</span> ? <span class="number">0</span> : prefixV[i<span class="number">-1</span>]);</span><br><span class="line">    w -= prefixW[j<span class="number">-1</span>] - (i == <span class="number">0</span> ? <span class="number">0</span> : prefixW[i<span class="number">-1</span>]);</span><br><span class="line">    <span class="keyword">if</span> (w != <span class="number">0</span>) &#123;</span><br><span class="line">        f = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">float</span> k = (<span class="keyword">float</span>) w / items[j].w;</span><br><span class="line">        w -= k * items[j].w;</span><br><span class="line">        v += k * items[j].v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">greedy</span><span class="params">(<span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> v = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)  &#123;</span><br><span class="line">        <span class="keyword">if</span> (w &gt;= items[i].w)&#123;</span><br><span class="line">            w -= items[i].w;</span><br><span class="line">            v += items[i].v;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> w, <span class="keyword">int</span> v, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= n) &#123;</span><br><span class="line">        ret = <span class="built_in">max</span>(ret, v);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> j = n, f;</span><br><span class="line">    <span class="keyword">int</span> hv = v + <span class="built_in">h</span>(i, w, b, j, f);</span><br><span class="line">    <span class="keyword">if</span> (hv &lt;= ret)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (f == <span class="number">0</span>) &#123;</span><br><span class="line">        ret = <span class="built_in">max</span>(ret, hv);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (w &gt;= items[i].w)</span><br><span class="line">        <span class="built_in">dfs</span>(i + <span class="number">1</span>, w - items[i].w, v + items[i].v, j);</span><br><span class="line">    <span class="built_in">dfs</span>(i + <span class="number">1</span>, w, v, j);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;m, &amp;n) == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;items[i].v, &amp;items[i].w);</span><br><span class="line">        <span class="built_in">stable_sort</span>(items, items+n, cmpCP);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, w = <span class="number">0</span>, v = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            w += items[i].w;</span><br><span class="line">            v += items[i].v;</span><br><span class="line">            prefixW[i] = w;</span><br><span class="line">            prefixV[i] = v;</span><br><span class="line">        &#125;</span><br><span class="line">        ret = <span class="built_in">greedy</span>(m);</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">0</span>, m, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h4><p>branch-and-bound 空間複雜度只跟 <span>$N$</span><!-- Has MathJax --> 有關，使用記憶體空間小，相較於記憶化搜索有較少的 cache miss，速度取決於搜索順序。對於同一 CP 的等價處理薄弱，一遇到這種情況，搜尋時間瞬間指數次方上去，可以等個昏天暗地。</p>
<h3 id="Dynamic-Programming"><a href="#Dynamic-Programming" class="headerlink" title="Dynamic Programming"></a>Dynamic Programming</h3><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><blockquote>
<p>請不要忘記背包問題屬於 NP-Complete，我們能做的事情只能優化計算，最慘的情況仍要面對，優化常數是可以努力的方向，讓我們嘗試變得更快吧。</p>
</blockquote>
<p>基礎寫法解說請參考 <a href="http://www.csie.ntnu.edu.tw/~u91029/KnapsackProblem.html#4">DJWS - Bounded Knapsack Problem</a> 的說明。</p>
<p>從定義上，我們通常會宣告 <code>dp[i][j]</code> 表示放入前 <span>$i$</span><!-- Has MathJax --> 個物品時，總共最多為 <span>$j$</span><!-- Has MathJax --> 的最大價值為何。這樣空間宣告使用 <span>$\mathcal{O}(NW)$</span><!-- Has MathJax -->。在實作上，我們可以藉由運算順序將空間降為 <span>$\mathcal{O}(W)$</span><!-- Has MathJax -->。因此，寫出以下代碼並不難</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> dp[MAXW];</span><br><span class="line"><span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp));</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = W; j &gt;= w[i]; j--)</span><br><span class="line">        dp[j] = <span class="built_in">max</span>(dp[j], dp[j-w[i]]+v[i]);</span><br></pre></td></tr></table></figure>

<h4 id="優化初夜"><a href="#優化初夜" class="headerlink" title="優化初夜"></a>優化初夜</h4><p>從實際運行上，我們可以發現每次跑 <span>$\mathcal{\theta}(W)$</span><!-- Has MathJax --> 非常浪費，只需要跑 <span>$\min(W, \sum w_i)$</span><!-- Has MathJax --> 即可。因此，第一份計算量優化如下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> dp[MAXW];</span><br><span class="line"><span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp));</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">    sum += w[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="built_in">min</span>(W, sum); j &gt;= w[i]; j--)</span><br><span class="line">        dp[j] = <span class="built_in">max</span>(dp[j], dp[j-w[i]]+v[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>計算邊界優化通常可以達到 2x 加速</p>
</blockquote>
<p>如此一來，在數量多權重小時，剛啟動的效能時可以賺到非常多。然而，不乏第一次就給權重的大的，目標最小化 <span>$\sum \text{sum}_i$</span><!-- Has MathJax -->，從數學觀念很明顯地瞭解，只要一開始將權重 <span>$w_i$</span><!-- Has MathJax --> 由小到大排序即可，這樣能保證最小化計算量！</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> dp[MAXW];</span><br><span class="line"><span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp));</span><br><span class="line"><span class="built_in">sort</span> (w, v) <span class="function">by w</span></span><br><span class="line"><span class="function"><span class="title">for</span> <span class="params">(<span class="keyword">int</span> i = <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; N; i++)</span> </span>&#123;</span><br><span class="line">    sum += w[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="built_in">min</span>(W, sum); j &gt;= w[i]; j--)</span><br><span class="line">        dp[j] = <span class="built_in">max</span>(dp[j], dp[j-w[i]]+v[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>數學使得我們更進一步，達到 1.5x 加速</p>
</blockquote>
<h4 id="優化二夜"><a href="#優化二夜" class="headerlink" title="優化二夜"></a>優化二夜</h4><p>經由平行的訓練，也許我們可以更往上一層優化。</p>
<p>接下來，打算把物品拆成兩堆，再利用優化初夜學到的技巧，就能引爆更多計算邊界優化。如果拆成三堆以上，合併操作變得相當複雜，當只有兩堆時，保證合併效能一定在 <span>$\mathcal{\theta}(W)$</span><!-- Has MathJax --> 完成。</p>
<p>如何合併兩堆的計算結果，假設 <code>dp1[i]</code> 表示其中一堆重量小於等於 <span>$i$</span><!-- Has MathJax --> 的最佳解，同理 <code>dp2[j]</code> 的計算結果。</p>
<p>當要湊出重量為 <span>$W$</span><!-- Has MathJax --> 的最佳解時，窮舉其中一堆的重量 <span>$i$</span><!-- Has MathJax --> 維護其中一堆的前綴最大值 <span>$j$</span><!-- Has MathJax -->，相當於使用掃描線算法在線性時間內合併。合併操作如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = W, mx = <span class="number">0</span>; i &lt;= W; i++, j--) &#123;</span><br><span class="line">    mx = <span class="built_in">max</span>(mx, dp2[i]);</span><br><span class="line">    ret = <span class="built_in">max</span>(ret, dp1[j] + mx);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Divide-and-Conquer，使得我們更快再更快！達到 1.5 加速</p>
</blockquote>
<p>然而，優化問題將轉移到最佳分堆策略，好的分堆策略將使得計算量下降更多。目標分兩堆，使得 <span>$\sum \text{sum1}_i + \sum \text{sum2}_i$</span><!-- Has MathJax --> 最小化。明顯地，由小到大排序物品重量，依序將物品放到總和最小的那一堆即可。最後，我們整合每一夜的結果如下：</p>
<blockquote>
<p>一個好的分堆，達到 1.2x 加速</p>
</blockquote>
<blockquote>
<p>相信在不久之後，還有更好的優化策略，也許不是延伸，而是全新的面貌。</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXW = <span class="number">5000005</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1005</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(<span class="keyword">int</span> A[][<span class="number">2</span>], <span class="keyword">int</span> dp[], <span class="keyword">int</span> W, <span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> w = A[i][<span class="number">0</span>], v = A[i][<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="built_in">min</span>(W, sum + w); j &gt;= w; j--)</span><br><span class="line">                dp[j] = <span class="built_in">max</span>(dp[j], dp[j-w]+v);</span><br><span class="line">            sum += w;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">knapsack</span><span class="params">(<span class="keyword">int</span> C[][<span class="number">2</span>], <span class="keyword">int</span> N, <span class="keyword">int</span> W)</span> </span>&#123;</span><br><span class="line">        vector&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; A;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">            A.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(C[i][<span class="number">0</span>], C[i][<span class="number">1</span>]));</span><br><span class="line">        N = A.<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">assert</span>(N &lt; MAXN);</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> dp1[MAXW+<span class="number">1</span>], dp2[MAXW+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">int</span> Ar[<span class="number">2</span>][MAXN][<span class="number">2</span>], ArN[<span class="number">2</span>] = &#123;&#125;;</span><br><span class="line">        <span class="built_in">memset</span>(dp1, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp1[<span class="number">0</span>])*(W+<span class="number">1</span>));</span><br><span class="line">        <span class="built_in">memset</span>(dp2, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp2[<span class="number">0</span>])*(W+<span class="number">1</span>));</span><br><span class="line">        <span class="built_in">sort</span>(A.<span class="built_in">begin</span>(), A.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">int</span> sum[<span class="number">2</span>] = &#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> ch = sum[<span class="number">1</span>] &lt; sum[<span class="number">0</span>];</span><br><span class="line">            Ar[ch][ArN[ch]][<span class="number">0</span>] = A[i].first;</span><br><span class="line">            Ar[ch][ArN[ch]][<span class="number">1</span>] = A[i].second;</span><br><span class="line">            ArN[ch]++;</span><br><span class="line">            sum[ch] += A[i].first;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">run</span>(Ar[<span class="number">0</span>], dp1, W, ArN[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">run</span>(Ar[<span class="number">1</span>], dp2, W, ArN[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = W, mx = <span class="number">0</span>; i &lt;= W; i++, j--) &#123;</span><br><span class="line">            mx = <span class="built_in">max</span>(mx, dp2[i]);</span><br><span class="line">            ret = <span class="built_in">max</span>(ret, dp1[j] + mx);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> W, N, C[MAXN][<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;W, &amp;N) == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">            <span class="built_in">assert</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;C[i][<span class="number">1</span>], &amp;C[i][<span class="number">0</span>]) == <span class="number">2</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">knapsack</span>(C, N, W));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>






          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-uva-13100" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/26/uva-13100/" class="article-date">
  <time datetime="2016-06-26T05:46:32.000Z" itemprop="datePublished">2016-06-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/26/uva-13100/">UVa 13100 - Painting the Wall</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/06/26/uva-13100/" data-id="ckpaivc9e008fn8vndmiy6odq" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/06/26/uva-13100/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dinic/">dinic</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/二分圖/">二分圖</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/最少點集覆蓋誒/">最少點集覆蓋誒</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>給一張 $N \times M$ 的圖，用最少筆畫勾勒出指定圖像，每一筆只能平行於兩軸，並且輸出任意一組解。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">5 7</span><br><span class="line">.*...*.</span><br><span class="line">.*...*.</span><br><span class="line">.*****.</span><br><span class="line">.*...*.</span><br><span class="line">.*...*.</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">vline 2 1 5</span><br><span class="line">vline 6 1 5</span><br><span class="line">hline 3 2 6</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>明顯地，要繪製的座標 $(x, y)$，可以視為一條邊 $x \Rightarrow y$，只要挑選某些點就可以覆蓋相鄰邊即可，在二分圖上找最少點集覆蓋是 P 多項式時間內可解的，並且最少點集大小為最大匹配數。但這一題要求要連續的筆畫，因此需要針對給定的圖形進行重新編號，將不連續的 x 和 y 座標重新定義。</p>
<p>這裡採用 Dinic’s algorithm 解決二分匹配，最後利用貪心回溯的方式可以找到一組解。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">40010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXE = MAXV * <span class="number">200</span> * <span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1</span>&lt;&lt;<span class="number">29</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, cap, flow;</span><br><span class="line">    Edge *next, *re;</span><br><span class="line">&#125; Edge;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MaxFlow</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    Edge edge[MAXE], *adj[MAXV], *pre[MAXV], *arc[MAXV];</span><br><span class="line">    <span class="keyword">int</span> e, n, level[MAXV], lvCnt[MAXV], Q[MAXV];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        n = x, e = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">assert</span>(n &lt; MAXV);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) adj[i] = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Addedge</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> flow)</span></span>&#123;</span><br><span class="line">        edge[e].v = y, edge[e].cap = flow, edge[e].next = adj[x];</span><br><span class="line">        edge[e].re = &amp;edge[e+<span class="number">1</span>], adj[x] = &amp;edge[e++];</span><br><span class="line">        edge[e].v = x, edge[e].cap = <span class="number">0</span>, edge[e].next = adj[y];</span><br><span class="line">        edge[e].re = &amp;edge[e<span class="number">-1</span>], adj[y] = &amp;edge[e++];</span><br><span class="line">        <span class="built_in">assert</span>(e &lt; MAXE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Bfs</span><span class="params">(<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> front = <span class="number">0</span>, rear = <span class="number">0</span>, r = <span class="number">0</span>, dis = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) level[i] = n, lvCnt[i] = <span class="number">0</span>;</span><br><span class="line">        level[v] = <span class="number">0</span>, ++lvCnt[<span class="number">0</span>];</span><br><span class="line">        Q[rear++] = v;</span><br><span class="line">        <span class="keyword">while</span> (front != rear)&#123;</span><br><span class="line">            <span class="keyword">if</span> (front == r) ++dis, r = rear;</span><br><span class="line">            v = Q[front++];</span><br><span class="line">            <span class="keyword">for</span> (Edge *i = adj[v]; i != <span class="literal">NULL</span>; i = i-&gt;next) &#123;</span><br><span class="line">                <span class="keyword">int</span> t = i-&gt;v;</span><br><span class="line">                <span class="keyword">if</span> (level[t] == n) level[t] = dis, Q[rear++] = t, ++lvCnt[dis];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Maxflow</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>, i, j;</span><br><span class="line">        <span class="built_in">Bfs</span>(t);</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) pre[i] = <span class="literal">NULL</span>, arc[i] = adj[i];</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; e; ++i) edge[i].flow = edge[i].cap;</span><br><span class="line">        i = s;</span><br><span class="line">        <span class="keyword">while</span> (level[s] &lt; n)&#123;</span><br><span class="line">            <span class="keyword">while</span> (arc[i] &amp;&amp; (level[i] != level[arc[i]-&gt;v]+<span class="number">1</span> || !arc[i]-&gt;flow)) </span><br><span class="line">                arc[i] = arc[i]-&gt;next;</span><br><span class="line">            <span class="keyword">if</span> (arc[i])&#123;</span><br><span class="line">                j = arc[i]-&gt;v;</span><br><span class="line">                pre[j] = arc[i];</span><br><span class="line">                i = j;</span><br><span class="line">                <span class="keyword">if</span> (i == t)&#123;</span><br><span class="line">                    <span class="keyword">int</span> update = INF;</span><br><span class="line">                    <span class="keyword">for</span> (Edge *p = pre[t]; p != <span class="literal">NULL</span>; p = pre[p-&gt;re-&gt;v])</span><br><span class="line">                        <span class="keyword">if</span> (update &gt; p-&gt;flow) update = p-&gt;flow;</span><br><span class="line">                    ret += update;</span><br><span class="line">                    <span class="keyword">for</span> (Edge *p = pre[t]; p != <span class="literal">NULL</span>; p = pre[p-&gt;re-&gt;v])</span><br><span class="line">                        p-&gt;flow -= update, p-&gt;re-&gt;flow += update;</span><br><span class="line">                    i = s;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">int</span> depth = n<span class="number">-1</span>;</span><br><span class="line">                <span class="keyword">for</span> (Edge *p = adj[i]; p != <span class="literal">NULL</span>; p = p-&gt;next)</span><br><span class="line">                    <span class="keyword">if</span> (p-&gt;flow &amp;&amp; depth &gt; level[p-&gt;v]) depth = level[p-&gt;v];</span><br><span class="line">                <span class="keyword">if</span> (--lvCnt[level[i]] == <span class="number">0</span>) <span class="keyword">return</span> ret;</span><br><span class="line">                level[i] = depth+<span class="number">1</span>;</span><br><span class="line">                ++lvCnt[level[i]];</span><br><span class="line">                arc[i] = adj[i];</span><br><span class="line">                <span class="keyword">if</span> (i != s) i = pre[i]-&gt;re-&gt;v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; g;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1024</span>*<span class="number">1024</span>;</span><br><span class="line"><span class="keyword">int</span> mx[MAXN], my[MAXN];</span><br><span class="line"><span class="keyword">int</span> X[MAXN], Y[MAXN];</span><br><span class="line"><span class="keyword">int</span> n, m, VX, VY;</span><br><span class="line"><span class="keyword">int</span> C[MAXN][<span class="number">3</span>], R[MAXN][<span class="number">3</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (X[u])	<span class="keyword">return</span> ;</span><br><span class="line">    X[u] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (Edge *p = g.adj[u]; p != <span class="literal">NULL</span>; p = p-&gt;next) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p-&gt;v - VX &gt;= <span class="number">1</span> &amp;&amp; p-&gt;v - VX &lt;= VY) &#123;</span><br><span class="line">            <span class="keyword">if</span> (my[p-&gt;v - VX] != <span class="number">-1</span> &amp;&amp; Y[p-&gt;v - VX] == <span class="number">0</span>) &#123;</span><br><span class="line">                Y[p-&gt;v - VX] = <span class="number">1</span>;</span><br><span class="line">                <span class="built_in">dfs</span>(my[p-&gt;v - VX]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> s[<span class="number">1024</span>][<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m) == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        	<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s[i]+<span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> xg[<span class="number">1024</span>][<span class="number">1024</span>] = &#123;&#125;;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> yg[<span class="number">1024</span>][<span class="number">1024</span>] = &#123;&#125;;</span><br><span class="line">        <span class="built_in">memset</span>(xg, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(xg));</span><br><span class="line">        <span class="built_in">memset</span>(yg, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(yg));</span><br><span class="line">        VX = <span class="number">0</span>, VY = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">        		<span class="keyword">if</span> (s[i][j] == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">        			<span class="keyword">if</span> (xg[i][j] == <span class="number">0</span>) &#123;</span><br><span class="line">        				xg[i][j] = ++VX;</span><br><span class="line">        				<span class="keyword">int</span> k = j;</span><br><span class="line">        				<span class="keyword">while</span> (k &lt;= m &amp;&amp; s[i][k] == <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">        					xg[i][k] = VX, k++;</span><br><span class="line">        				C[VX][<span class="number">0</span>] = i, C[VX][<span class="number">1</span>] = j, C[VX][<span class="number">2</span>] = k<span class="number">-1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (yg[i][j] == <span class="number">0</span>) &#123;</span><br><span class="line">                        yg[i][j] = ++VY;</span><br><span class="line">                        <span class="keyword">int</span> k = i;</span><br><span class="line">                        <span class="keyword">while</span> (k &lt;= n &amp;&amp; s[k][j] == <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">                            yg[k][j] = VY, k++;</span><br><span class="line">                        R[VY][<span class="number">0</span>] = j, R[VY][<span class="number">1</span>] = i, R[VY][<span class="number">2</span>] = k<span class="number">-1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> source = <span class="number">0</span>, sink = VX+VY+<span class="number">1</span>;</span><br><span class="line">        g.<span class="built_in">Init</span>(VX+VY+<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= VX; i++)</span><br><span class="line">            g.<span class="built_in">Addedge</span>(source, i, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= VY; i++)</span><br><span class="line">            g.<span class="built_in">Addedge</span>(VX+i, sink, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (s[i][j] == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">//					printf(&quot;%d - %d\n&quot;, xg[i][j], yg[i][j]);</span></span><br><span class="line">                    g.<span class="built_in">Addedge</span>(xg[i][j], yg[i][j] + VX, <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> mxflow = g.<span class="built_in">Maxflow</span>(source, sink);</span><br><span class="line">        <span class="built_in">memset</span>(mx, <span class="number">-1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(mx));</span><br><span class="line">        <span class="built_in">memset</span>(my, <span class="number">-1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(my));</span><br><span class="line">        <span class="built_in">memset</span>(X, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(X));</span><br><span class="line">        <span class="built_in">memset</span>(Y, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(Y));</span><br><span class="line">        <span class="keyword">int</span> match = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= VX; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Edge *p = g.adj[i]; p != <span class="literal">NULL</span>; p = p-&gt;next) &#123;</span><br><span class="line">                <span class="keyword">int</span> x = i, y = p-&gt;v, flow = p-&gt;flow;</span><br><span class="line">                <span class="keyword">if</span> (flow == <span class="number">0</span> &amp;&amp; y - VX &gt;= <span class="number">1</span> &amp;&amp; y - VX &lt;= VY) &#123;</span><br><span class="line">                    <span class="comment">// match x - (y - VX) in bipartite graph</span></span><br><span class="line">                    <span class="keyword">int</span> r = x, c = y - VX;</span><br><span class="line">                    mx[r] = c;</span><br><span class="line">                    my[c] = r;</span><br><span class="line">                    match++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">assert</span>(match == mxflow);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= VX; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mx[i] == <span class="number">-1</span>)</span><br><span class="line">                <span class="built_in">dfs</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, mxflow);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= VX; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!X[i] &amp;&amp; mx[i] != <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;hline %d %d %d\n&quot;</span>, C[i][<span class="number">0</span>], C[i][<span class="number">1</span>], C[i][<span class="number">2</span>]);</span><br><span class="line">                mxflow--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= VY; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Y[i]) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;vline %d %d %d\n&quot;</span>, R[i][<span class="number">0</span>], R[i][<span class="number">1</span>], R[i][<span class="number">2</span>]);</span><br><span class="line">                mxflow--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">assert</span>(mxflow == <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-uva-13102" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/26/uva-13102/" class="article-date">
  <time datetime="2016-06-26T05:27:41.000Z" itemprop="datePublished">2016-06-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/26/uva-13102/">UVa 13102 - Tobby Stones</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/06/26/uva-13102/" data-id="ckpaivc9f008hn8vn2tha61nb" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/06/26/uva-13102/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Splay-tree/">Splay tree</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><span>$N$</span><!-- Has MathJax --> 個石頭排成一列，一開始都是白色石頭，經過 <span>$M$</span><!-- Has MathJax --> 詢問，分別統計區間內的黑色、白色石頭個數。

<p>操作分別有以下幾種：</p>
<ol>
<li>統計區間 <code>[l, r]</code> 的黑色、白色石頭個數。</li>
<li>將區間 <code>[l, r]</code> 的石頭的排列反轉。</li>
<li>將區間 <code>[l, r]</code> 的石頭的顏色反轉。</li>
<li>將區間 <code>[l, r]</code> 的石頭的顏色全部改成 $c$</li>
</ol>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">10  7</span><br><span class="line">0  0  9</span><br><span class="line">3  0  4  0</span><br><span class="line">0  0  4</span><br><span class="line">1  0  9</span><br><span class="line">0  5  9</span><br><span class="line">2  5  9</span><br><span class="line">0  3  9</span><br><span class="line">100  1</span><br><span class="line">0  0  50</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0 10</span><br><span class="line">5 0</span><br><span class="line">5 0</span><br><span class="line">0 7</span><br><span class="line">0 51</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>用 Splay Tree 完成區間反轉，打個懶標記就可以完成，每個操作都可以在 <span>$\mathcal{O}(\log N)$</span><!-- Has MathJax --> 完成，說不定這一題用塊狀鏈表還比較容易處理，再加上快取效果還會快上很多。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1048576</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SPLAY_TREE</span> &#123;</span> <span class="comment">// Splay Tree</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1048576</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        <span class="keyword">static</span> Node *EMPTY;</span><br><span class="line">        Node *ch[<span class="number">2</span>], *fa;</span><br><span class="line">        <span class="keyword">char</span> rev, set, inv, val;</span><br><span class="line">        <span class="keyword">int</span> size;</span><br><span class="line">        <span class="keyword">int</span> sumw, sumb;</span><br><span class="line">        <span class="built_in">Node</span>() &#123;</span><br><span class="line">            ch[<span class="number">0</span>] = ch[<span class="number">1</span>] = fa = <span class="literal">NULL</span>;</span><br><span class="line">            rev = set = inv = <span class="number">0</span>;</span><br><span class="line">            val = sumw = sumb = <span class="number">0</span>, size = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">is_root</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> fa-&gt;ch[<span class="number">0</span>] != <span class="keyword">this</span> &amp;&amp; fa-&gt;ch[<span class="number">1</span>] != <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (rev) &#123;</span><br><span class="line">                <span class="keyword">if</span> (ch[<span class="number">0</span>] != EMPTY)	ch[<span class="number">0</span>]-&gt;rev ^= <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (ch[<span class="number">1</span>] != EMPTY)	ch[<span class="number">1</span>]-&gt;rev ^= <span class="number">1</span>;</span><br><span class="line">                <span class="built_in">swap</span>(ch[<span class="number">0</span>], ch[<span class="number">1</span>]);</span><br><span class="line">                rev ^= <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (set) &#123;</span><br><span class="line">            	<span class="keyword">if</span> (ch[<span class="number">0</span>] != EMPTY)	ch[<span class="number">0</span>]-&gt;set = set, ch[<span class="number">0</span>]-&gt;inv = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (ch[<span class="number">1</span>] != EMPTY)	ch[<span class="number">1</span>]-&gt;set = set, ch[<span class="number">1</span>]-&gt;inv = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (set == <span class="number">1</span>)	 <span class="comment">// white</span></span><br><span class="line">                	val = <span class="number">0</span>, sumw = sumw + sumb, sumb = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    val = <span class="number">1</span>, sumb = sumw + sumb, sumw = <span class="number">0</span>;</span><br><span class="line">                set = <span class="number">0</span>, inv = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (inv) &#123;</span><br><span class="line">                <span class="keyword">if</span> (ch[<span class="number">0</span>] != EMPTY) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (ch[<span class="number">0</span>]-&gt;set)	</span><br><span class="line">                        ch[<span class="number">0</span>]-&gt;set = <span class="number">3</span> - ch[<span class="number">0</span>]-&gt;set;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        ch[<span class="number">0</span>]-&gt;inv ^= <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (ch[<span class="number">1</span>] != EMPTY)	&#123;</span><br><span class="line">                	<span class="keyword">if</span> (ch[<span class="number">1</span>]-&gt;set)</span><br><span class="line">                		ch[<span class="number">1</span>]-&gt;set = <span class="number">3</span> - ch[<span class="number">1</span>]-&gt;set;</span><br><span class="line">                	<span class="keyword">else</span></span><br><span class="line">                        ch[<span class="number">1</span>]-&gt;inv ^= <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">swap</span>(sumw, sumb), val = !val;</span><br><span class="line">                inv = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (ch[<span class="number">0</span>] != EMPTY)	ch[<span class="number">0</span>]-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">            <span class="keyword">if</span> (ch[<span class="number">1</span>] != EMPTY)	ch[<span class="number">1</span>]-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">            sumw = sumb = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (val == <span class="number">0</span>)	sumw++;</span><br><span class="line">            <span class="keyword">else</span>			sumb++;</span><br><span class="line">            sumw += ch[<span class="number">0</span>]-&gt;sumw + ch[<span class="number">1</span>]-&gt;sumw;</span><br><span class="line">            sumb += ch[<span class="number">0</span>]-&gt;sumb + ch[<span class="number">1</span>]-&gt;sumb;</span><br><span class="line">            size = <span class="number">1</span> + ch[<span class="number">0</span>]-&gt;size + ch[<span class="number">1</span>]-&gt;size;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; _mem[MAXN];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> bufIdx;</span><br><span class="line">    SPLAY_TREE::Node *root;</span><br><span class="line">    <span class="built_in">SPLAY_TREE</span>() &#123;</span><br><span class="line">        Node::EMPTY = &amp;_mem[<span class="number">0</span>];</span><br><span class="line">        Node::EMPTY-&gt;fa = Node::EMPTY-&gt;ch[<span class="number">0</span>] = Node::EMPTY-&gt;ch[<span class="number">1</span>] = Node::EMPTY;</span><br><span class="line">        Node::EMPTY-&gt;size = Node::EMPTY-&gt;val = <span class="number">0</span>;</span><br><span class="line">        bufIdx = <span class="number">1</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        bufIdx = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Node *u = &amp;_mem[bufIdx++];</span><br><span class="line">        *u = <span class="built_in">Node</span>();</span><br><span class="line">        u-&gt;fa = u-&gt;ch[<span class="number">0</span>] = u-&gt;ch[<span class="number">1</span>] = Node::EMPTY;</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(Node *x)</span> </span>&#123;</span><br><span class="line">        Node *y;</span><br><span class="line">        <span class="keyword">int</span> d;</span><br><span class="line">        y = x-&gt;fa, d = y-&gt;ch[<span class="number">1</span>] == x ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        x-&gt;ch[d^<span class="number">1</span>]-&gt;fa = y, y-&gt;ch[d] = x-&gt;ch[d^<span class="number">1</span>];</span><br><span class="line">        x-&gt;ch[d^<span class="number">1</span>] = y;</span><br><span class="line">        <span class="keyword">if</span> (!y-&gt;<span class="built_in">is_root</span>())</span><br><span class="line">            y-&gt;fa-&gt;ch[y-&gt;fa-&gt;ch[<span class="number">1</span>] == y] = x;</span><br><span class="line">        x-&gt;fa = y-&gt;fa, y-&gt;fa = x;</span><br><span class="line">        y-&gt;<span class="built_in">pushup</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deal</span><span class="params">(Node *x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!x-&gt;<span class="built_in">is_root</span>())	<span class="built_in">deal</span>(x-&gt;fa);</span><br><span class="line">        x-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">find_rt</span><span class="params">(Node *x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (; x-&gt;fa != Node::EMPTY; x = x-&gt;fa);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(Node *x, Node *below)</span> </span>&#123;</span><br><span class="line">        Node *y, *z;</span><br><span class="line">        <span class="built_in">deal</span>(x);</span><br><span class="line">        <span class="keyword">while</span> (!x-&gt;<span class="built_in">is_root</span>() &amp;&amp; x-&gt;fa != below) &#123;</span><br><span class="line">            y = x-&gt;fa, z = y-&gt;fa;</span><br><span class="line">            <span class="keyword">if</span> (!y-&gt;<span class="built_in">is_root</span>() &amp;&amp; y-&gt;fa != below) &#123;</span><br><span class="line">                <span class="keyword">if</span> (y-&gt;ch[<span class="number">0</span>] == x ^ z-&gt;ch[<span class="number">0</span>] == y)</span><br><span class="line">                    <span class="built_in">rotate</span>(x);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="built_in">rotate</span>(y);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">rotate</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        x-&gt;<span class="built_in">pushup</span>();</span><br><span class="line">        <span class="keyword">if</span> (x-&gt;fa == Node::EMPTY)	root = x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">build</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, Node *p, <span class="keyword">char</span> s[])</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l &gt; r)	<span class="keyword">return</span> Node::EMPTY; </span><br><span class="line">        <span class="keyword">int</span> mid = (l + r)/<span class="number">2</span>;</span><br><span class="line">        Node *t = <span class="built_in">newNode</span>();</span><br><span class="line">        t-&gt;val = s[mid], t-&gt;fa = p;</span><br><span class="line">        <span class="keyword">if</span> (t-&gt;val == <span class="number">0</span>)	t-&gt;sumw ++;</span><br><span class="line">        <span class="keyword">else</span>				t-&gt;sumb ++;</span><br><span class="line">        t-&gt;ch[<span class="number">0</span>] = <span class="built_in">build</span>(l, mid<span class="number">-1</span>, t, s);</span><br><span class="line">        t-&gt;ch[<span class="number">1</span>] = <span class="built_in">build</span>(mid+<span class="number">1</span>, r, t, s);</span><br><span class="line">        t-&gt;<span class="built_in">pushup</span>();</span><br><span class="line">        <span class="keyword">if</span> (p == Node::EMPTY)	root = t;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(Node *u)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == Node::EMPTY) <span class="keyword">return</span>;</span><br><span class="line">        u-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">        <span class="built_in">debug</span>(u-&gt;ch[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, u-&gt;val);</span><br><span class="line">        <span class="built_in">debug</span>(u-&gt;ch[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">kthNode</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">    	Node *u = root;</span><br><span class="line">    	<span class="keyword">for</span> (<span class="keyword">int</span> t; u != Node::EMPTY;) &#123;</span><br><span class="line">    		u-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    		t = u-&gt;ch[<span class="number">0</span>]-&gt;size;</span><br><span class="line">    		<span class="keyword">if</span> (t+<span class="number">1</span> == pos)	<span class="keyword">return</span> u;</span><br><span class="line">    		<span class="keyword">if</span> (t &gt;= pos)</span><br><span class="line">    			u = u-&gt;ch[<span class="number">0</span>];</span><br><span class="line">    		<span class="keyword">else</span></span><br><span class="line">    			pos -= t+<span class="number">1</span>, u = u-&gt;ch[<span class="number">1</span>];</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="keyword">return</span> Node::EMPTY;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    	Node *p, *q, *r;</span><br><span class="line">    	p = <span class="built_in">kthNode</span>(pos), q = <span class="built_in">kthNode</span>(pos+<span class="number">1</span>);</span><br><span class="line">    	r = <span class="built_in">newNode</span>();</span><br><span class="line">    	<span class="built_in">splay</span>(p, Node::EMPTY);</span><br><span class="line">    	<span class="built_in">splay</span>(q, root);</span><br><span class="line">    	r-&gt;val = val, q-&gt;ch[<span class="number">0</span>] = r, r-&gt;fa = q;</span><br><span class="line">    	<span class="built_in">splay</span>(r, Node::EMPTY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">    	Node *p, *q;</span><br><span class="line">    	p = <span class="built_in">kthNode</span>(pos<span class="number">-1</span>), q = <span class="built_in">kthNode</span>(pos+<span class="number">1</span>);</span><br><span class="line">    	<span class="built_in">splay</span>(p, Node::EMPTY), <span class="built_in">splay</span>(q, root);</span><br><span class="line">    	q-&gt;ch[<span class="number">0</span>] = Node::EMPTY;</span><br><span class="line">    	<span class="built_in">splay</span>(q, Node::EMPTY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reverse</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    	Node *p, *q;</span><br><span class="line">    	p = <span class="built_in">kthNode</span>(l), q = <span class="built_in">kthNode</span>(r+<span class="number">2</span>);</span><br><span class="line">    	<span class="built_in">splay</span>(p, Node::EMPTY), <span class="built_in">splay</span>(q, root);</span><br><span class="line">    	q-&gt;ch[<span class="number">0</span>]-&gt;rev ^= <span class="number">1</span>;</span><br><span class="line">    	<span class="built_in">splay</span>(q-&gt;ch[<span class="number">0</span>], Node::EMPTY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inverse</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    	Node *p, *q;</span><br><span class="line">    	p = <span class="built_in">kthNode</span>(l), q = <span class="built_in">kthNode</span>(r+<span class="number">2</span>);</span><br><span class="line">    	<span class="built_in">splay</span>(p, Node::EMPTY), <span class="built_in">splay</span>(q, root);</span><br><span class="line">    	q-&gt;ch[<span class="number">0</span>]-&gt;inv ^= <span class="number">1</span>;</span><br><span class="line">    	<span class="built_in">splay</span>(q-&gt;ch[<span class="number">0</span>], Node::EMPTY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">        Node *p, *q;</span><br><span class="line">    	p = <span class="built_in">kthNode</span>(l), q = <span class="built_in">kthNode</span>(r+<span class="number">2</span>);</span><br><span class="line">    	<span class="built_in">splay</span>(p, Node::EMPTY), <span class="built_in">splay</span>(q, root);</span><br><span class="line">    	<span class="keyword">if</span> (c == <span class="number">1</span>) &#123;</span><br><span class="line">    		q-&gt;ch[<span class="number">0</span>]-&gt;set = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            q-&gt;ch[<span class="number">0</span>]-&gt;set = <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="built_in">splay</span>(q-&gt;ch[<span class="number">0</span>], Node::EMPTY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">stat</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    	Node *p, *q;</span><br><span class="line">    	p = <span class="built_in">kthNode</span>(l), q = <span class="built_in">kthNode</span>(r+<span class="number">2</span>);</span><br><span class="line">    	<span class="built_in">splay</span>(p, Node::EMPTY), <span class="built_in">splay</span>(q, root);</span><br><span class="line">    	<span class="keyword">return</span> <span class="built_in">make_pair</span>(q-&gt;ch[<span class="number">0</span>]-&gt;sumb, q-&gt;ch[<span class="number">0</span>]-&gt;sumw);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125; tree;</span><br><span class="line">SPLAY_TREE::Node *SPLAY_TREE::Node::EMPTY;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> s[<span class="number">1048576</span>] = &#123;&#125;; <span class="comment">// white</span></span><br><span class="line">    <span class="keyword">int</span> n, m, cmd, l, r, c;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m) == <span class="number">2</span>) &#123;</span><br><span class="line">    	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n+<span class="number">1</span>; i++)</span><br><span class="line">    		s[i] = <span class="number">0</span>;</span><br><span class="line">    	tree.<span class="built_in">init</span>();</span><br><span class="line">    	tree.<span class="built_in">build</span>(<span class="number">0</span>, n+<span class="number">1</span>, SPLAY_TREE::Node::EMPTY, s);</span><br><span class="line">    	pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; ret;</span><br><span class="line">    	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">    		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;cmd);</span><br><span class="line">    		<span class="keyword">if</span> (cmd == <span class="number">0</span>) &#123;</span><br><span class="line">    			<span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;l, &amp;r);</span><br><span class="line">    			ret = tree.<span class="built_in">stat</span>(l+<span class="number">1</span>, r+<span class="number">1</span>);</span><br><span class="line">    			<span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>, ret.first, ret.second);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;l, &amp;r);</span><br><span class="line">                tree.<span class="built_in">reverse</span>(l+<span class="number">1</span>, r+<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;l, &amp;r);</span><br><span class="line">                tree.<span class="built_in">inverse</span>(l+<span class="number">1</span>, r+<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">3</span>) &#123;</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;l, &amp;r, &amp;c);</span><br><span class="line">                tree.<span class="built_in">reset</span>(l+<span class="number">1</span>, r+<span class="number">1</span>, c);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-uva-13101" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/26/uva-13101/" class="article-date">
  <time datetime="2016-06-26T05:17:02.000Z" itemprop="datePublished">2016-06-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/26/uva-13101/">UVa 13101 - Tobby on Tree</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/06/26/uva-13101/" data-id="ckpaivc9f008gn8vn6k53g1r4" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/06/26/uva-13101/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LCT/">LCT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Link-Cut-Tree/">Link/Cut Tree</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>一場遊戲有 <span>$N$</span><!-- Has MathJax --> 個數，每一次挑兩個不同的數，將大的數字扣除小的數字，直到沒辦法挑出任何不同的數，亦即所有數皆相同，遊戲結果就是最後的數字值。</p>
<p>現在給予一棵樹，操作有兩種：</p>
<ul>
<li>詢問樹上兩點 <span>$u$</span><!-- Has MathJax --> 到 <span>$v$</span><!-- Has MathJax --> 的路徑上的數字，遊戲結果為何。</li>
<li>改變樹上某個節點 <span>$u$</span><!-- Has MathJax --> 的值為 <span>$c$</span><!-- Has MathJax -->。</li>
</ul>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">5 15 20 15 9</span><br><span class="line">0 2</span><br><span class="line">0 3</span><br><span class="line">3 1</span><br><span class="line">3 4</span><br><span class="line">3</span><br><span class="line">1 2 1</span><br><span class="line">2 3 3</span><br><span class="line">1 1 4</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>明顯地答案就是路徑上所有數字的最大公因數，充分利用 Link/Cut Tree 的特性，解決樹上詢問的詢問即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LCT</span> &#123;</span> <span class="comment">// Link-Cut Tree</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">262144</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        <span class="keyword">static</span> Node *EMPTY;</span><br><span class="line">        Node *ch[<span class="number">2</span>], *fa;</span><br><span class="line">        <span class="keyword">int</span> rev;</span><br><span class="line">        <span class="keyword">int</span> val, size;</span><br><span class="line">        <span class="keyword">int</span> gcd;</span><br><span class="line">        <span class="built_in">Node</span>() &#123;</span><br><span class="line">            ch[<span class="number">0</span>] = ch[<span class="number">1</span>] = fa = <span class="literal">NULL</span>;</span><br><span class="line">            rev = <span class="number">0</span>;</span><br><span class="line">            val = <span class="number">0</span>;</span><br><span class="line">            gcd = <span class="number">1</span>, size = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">is_root</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> fa-&gt;ch[<span class="number">0</span>] != <span class="keyword">this</span> &amp;&amp; fa-&gt;ch[<span class="number">1</span>] != <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (rev) &#123;</span><br><span class="line">                ch[<span class="number">0</span>]-&gt;rev ^= <span class="number">1</span>, ch[<span class="number">1</span>]-&gt;rev ^= <span class="number">1</span>;</span><br><span class="line">                <span class="built_in">swap</span>(ch[<span class="number">0</span>], ch[<span class="number">1</span>]);</span><br><span class="line">                rev ^= <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span> == EMPTY)	<span class="keyword">return</span> ;</span><br><span class="line">            gcd = <span class="keyword">this</span>-&gt;val, size = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (ch[<span class="number">0</span>] != EMPTY) &#123;</span><br><span class="line">            	gcd = __gcd(gcd, ch[<span class="number">0</span>]-&gt;gcd);</span><br><span class="line">                size += ch[<span class="number">0</span>]-&gt;size;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ch[<span class="number">1</span>] != EMPTY) &#123; </span><br><span class="line">                gcd = __gcd(gcd, ch[<span class="number">1</span>]-&gt;gcd);</span><br><span class="line">                size += ch[<span class="number">1</span>]-&gt;size;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125; _mem[MAXN];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> bufIdx;</span><br><span class="line">    <span class="built_in">LCT</span>() &#123;</span><br><span class="line">        Node::EMPTY = &amp;_mem[<span class="number">0</span>];</span><br><span class="line">        Node::EMPTY-&gt;fa = Node::EMPTY-&gt;ch[<span class="number">0</span>] = Node::EMPTY-&gt;ch[<span class="number">1</span>] = Node::EMPTY;</span><br><span class="line">        Node::EMPTY-&gt;size = <span class="number">0</span>;</span><br><span class="line">        bufIdx = <span class="number">1</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        bufIdx = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Node *u = &amp;_mem[bufIdx++];</span><br><span class="line">        *u = <span class="built_in">Node</span>();</span><br><span class="line">        u-&gt;fa = u-&gt;ch[<span class="number">0</span>] = u-&gt;ch[<span class="number">1</span>] = Node::EMPTY;</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(Node *x)</span> </span>&#123;</span><br><span class="line">        Node *y;</span><br><span class="line">        <span class="keyword">int</span> d;</span><br><span class="line">        y = x-&gt;fa, d = y-&gt;ch[<span class="number">1</span>] == x ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        x-&gt;ch[d^<span class="number">1</span>]-&gt;fa = y, y-&gt;ch[d] = x-&gt;ch[d^<span class="number">1</span>];</span><br><span class="line">        x-&gt;ch[d^<span class="number">1</span>] = y;</span><br><span class="line">        <span class="keyword">if</span> (!y-&gt;<span class="built_in">is_root</span>())</span><br><span class="line">            y-&gt;fa-&gt;ch[y-&gt;fa-&gt;ch[<span class="number">1</span>] == y] = x;</span><br><span class="line">        x-&gt;fa = y-&gt;fa, y-&gt;fa = x;</span><br><span class="line">        y-&gt;<span class="built_in">pushup</span>(), x-&gt;<span class="built_in">pushup</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deal</span><span class="params">(Node *x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!x-&gt;<span class="built_in">is_root</span>())	<span class="built_in">deal</span>(x-&gt;fa);</span><br><span class="line">        x-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(Node *x)</span> </span>&#123;</span><br><span class="line">        Node *y, *z;</span><br><span class="line">        <span class="built_in">deal</span>(x);</span><br><span class="line">        <span class="keyword">while</span> (!x-&gt;<span class="built_in">is_root</span>()) &#123;</span><br><span class="line">            y = x-&gt;fa, z = y-&gt;fa;</span><br><span class="line">            <span class="keyword">if</span> (!y-&gt;<span class="built_in">is_root</span>()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (y-&gt;ch[<span class="number">0</span>] == x ^ z-&gt;ch[<span class="number">0</span>] == y)</span><br><span class="line">                    <span class="built_in">rotate</span>(x);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="built_in">rotate</span>(y);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">rotate</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        x-&gt;<span class="built_in">pushup</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">access</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        Node *v = Node::EMPTY;</span><br><span class="line">        <span class="keyword">for</span> (; u != Node::EMPTY; u = u-&gt;fa) &#123;</span><br><span class="line">            <span class="built_in">splay</span>(u);</span><br><span class="line">            u-&gt;ch[<span class="number">1</span>] = v;</span><br><span class="line">            v = u;</span><br><span class="line">            v-&gt;<span class="built_in">pushup</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">mk_root</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">access</span>(u)-&gt;rev ^= <span class="number">1</span>, <span class="built_in">splay</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">cut</span><span class="params">(Node *x, Node *y)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">mk_root</span>(x);</span><br><span class="line">        <span class="built_in">access</span>(y), <span class="built_in">splay</span>(y);</span><br><span class="line">        y-&gt;ch[<span class="number">0</span>] = x-&gt;fa = Node::EMPTY;</span><br><span class="line">    &#125;</span><br><span class="line">    Node* _cut(Node *rt, Node *x) &#123;</span><br><span class="line">        Node *u, *v;</span><br><span class="line">        <span class="built_in">mk_root</span>(rt);</span><br><span class="line">        <span class="built_in">access</span>(x), <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="keyword">for</span> (v = x-&gt;ch[<span class="number">0</span>]; v-&gt;ch[<span class="number">1</span>] != Node::EMPTY; v = v-&gt;ch[<span class="number">1</span>]);</span><br><span class="line">        x-&gt;ch[<span class="number">0</span>]-&gt;fa = x-&gt;fa;</span><br><span class="line">        x-&gt;fa = x-&gt;ch[<span class="number">0</span>] = Node::EMPTY;</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">link</span><span class="params">(Node *x, Node *y)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">mk_root</span>(x);</span><br><span class="line">        x-&gt;fa = y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">find</span><span class="params">(Node *x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (x = <span class="built_in">access</span>(x); x-&gt;<span class="built_in">pushdown</span>(), x-&gt;ch[<span class="number">0</span>] != Node::EMPTY; x = x-&gt;ch[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">gcdPath</span><span class="params">(Node *x, Node *y)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">mk_root</span>(x);</span><br><span class="line">        <span class="built_in">access</span>(y), <span class="built_in">splay</span>(y);</span><br><span class="line">        <span class="keyword">return</span> y-&gt;gcd;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">changeNode</span><span class="params">(Node *x, <span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">    	<span class="built_in">mk_root</span>(x);</span><br><span class="line">    	x-&gt;val = c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; tree;</span><br><span class="line">LCT::Node *LCT::Node::EMPTY;</span><br><span class="line">LCT::Node *A[<span class="number">262144</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> W[<span class="number">131072</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m, cmd, x, y;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;W[i]);</span><br><span class="line">        tree.<span class="built_in">init</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            A[i] = tree.<span class="built_in">newNode</span>();</span><br><span class="line">            A[i]-&gt;val = W[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;y);</span><br><span class="line">            tree.<span class="built_in">link</span>(A[x], A[y]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;cmd, &amp;x, &amp;y);</span><br><span class="line">            <span class="keyword">if</span> (cmd == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, tree.<span class="built_in">gcdPath</span>(A[x], A[y]));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                tree.<span class="built_in">changeNode</span>(A[x], y);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">5 15 20 15 9</span></span><br><span class="line"><span class="comment">0 2</span></span><br><span class="line"><span class="comment">0 3</span></span><br><span class="line"><span class="comment">3 1</span></span><br><span class="line"><span class="comment">3 4</span></span><br><span class="line"><span class="comment">9999</span></span><br><span class="line"><span class="comment">1 2 1</span></span><br><span class="line"><span class="comment">1 1 3</span></span><br><span class="line"><span class="comment">2 3 3</span></span><br><span class="line"><span class="comment">1 1 4</span></span><br><span class="line"><span class="comment">1 1 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-uva-13000" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/24/uva-13000/" class="article-date">
  <time datetime="2016-06-24T07:39:02.000Z" itemprop="datePublished">2016-06-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/24/uva-13000/">UVa 13000 - VIP Treatment</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/06/24/uva-13000/" data-id="ckpaivc99007xn8vnfz54e516" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/06/24/uva-13000/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dinic/">dinic</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/maxflow/">maxflow</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/二分/">二分</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>有 <span>$N$</span><!-- Has MathJax --> 個工人和 <span>$M$</span><!-- Has MathJax --> 種工作，每一種工作分成兩種工作量 VIP 以及 Regular，有一些工作只能指派給特定工人完成。每名工人有各自的完成速度，請問最小化所有工作完成的最大時間為何？</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">3 3 10</span><br><span class="line">2 4 8</span><br><span class="line">2 3 1 1</span><br><span class="line">2 3 1 2</span><br><span class="line">2 4 1 3</span><br><span class="line">2 1 4</span><br><span class="line">2</span><br><span class="line">2 3 1 1</span><br><span class="line">3 2 1 1</span><br><span class="line">2 2 4</span><br><span class="line">1 2</span><br><span class="line">2 3 2 1 2</span><br><span class="line">3 2 2 1 2</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Case 1: 48</span><br><span class="line">Case 2: 18</span><br><span class="line">Case 3: 6</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>二分時間，利用 maxflow 流滿的情況判定是否可以讓所有工人在限時內合作完成所有工作。</p>
<p><code>source - worker - job - sink</code>，其中 source - worker 為工人能運作的最大工作量 <code>time/W[i]</code>，worker - job 根據指派工人的配置，job - sink 為工作的 VIP 和 Regular 量。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">40010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXE = MAXV * <span class="number">200</span> * <span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span> LLINF = <span class="number">1LL</span>&lt;&lt;<span class="number">62</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> v;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> cap, flow;</span><br><span class="line">    Edge *next, *re;</span><br><span class="line">&#125; Edge;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MaxFlow</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    Edge edge[MAXE], *adj[MAXV], *pre[MAXV], *arc[MAXV];</span><br><span class="line">    <span class="keyword">int</span> e, n, level[MAXV], lvCnt[MAXV], Q[MAXV];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        n = x, e = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) adj[i] = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Addedge</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">long</span> <span class="keyword">long</span> flow)</span></span>&#123;</span><br><span class="line">        edge[e].v = y, edge[e].cap = flow, edge[e].next = adj[x];</span><br><span class="line">        edge[e].re = &amp;edge[e+<span class="number">1</span>], adj[x] = &amp;edge[e++];</span><br><span class="line">        edge[e].v = x, edge[e].cap = <span class="number">0</span>, edge[e].next = adj[y];</span><br><span class="line">        edge[e].re = &amp;edge[e<span class="number">-1</span>], adj[y] = &amp;edge[e++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Bfs</span><span class="params">(<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> front = <span class="number">0</span>, rear = <span class="number">0</span>, r = <span class="number">0</span>, dis = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) level[i] = n, lvCnt[i] = <span class="number">0</span>;</span><br><span class="line">        level[v] = <span class="number">0</span>, ++lvCnt[<span class="number">0</span>];</span><br><span class="line">        Q[rear++] = v;</span><br><span class="line">        <span class="keyword">while</span> (front != rear)&#123;</span><br><span class="line">            <span class="keyword">if</span> (front == r) ++dis, r = rear;</span><br><span class="line">            v = Q[front++];</span><br><span class="line">            <span class="keyword">for</span> (Edge *i = adj[v]; i != <span class="literal">NULL</span>; i = i-&gt;next) &#123;</span><br><span class="line">                <span class="keyword">int</span> t = i-&gt;v;</span><br><span class="line">                <span class="keyword">if</span> (level[t] == n) level[t] = dis, Q[rear++] = t, ++lvCnt[dis];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">Maxflow</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> i, j;</span><br><span class="line">        <span class="built_in">Bfs</span>(t);</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) pre[i] = <span class="literal">NULL</span>, arc[i] = adj[i];</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; e; ++i) edge[i].flow = edge[i].cap;</span><br><span class="line">        i = s;</span><br><span class="line">        <span class="keyword">while</span> (level[s] &lt; n)&#123;</span><br><span class="line">            <span class="keyword">while</span> (arc[i] &amp;&amp; (level[i] != level[arc[i]-&gt;v]+<span class="number">1</span> || !arc[i]-&gt;flow)) </span><br><span class="line">                arc[i] = arc[i]-&gt;next;</span><br><span class="line">            <span class="keyword">if</span> (arc[i])&#123;</span><br><span class="line">                j = arc[i]-&gt;v;</span><br><span class="line">                pre[j] = arc[i];</span><br><span class="line">                i = j;</span><br><span class="line">                <span class="keyword">if</span> (i == t)&#123;</span><br><span class="line">                    <span class="keyword">long</span> <span class="keyword">long</span> update = LLINF;</span><br><span class="line">                    <span class="keyword">for</span> (Edge *p = pre[t]; p != <span class="literal">NULL</span>; p = pre[p-&gt;re-&gt;v])</span><br><span class="line">                        <span class="keyword">if</span> (update &gt; p-&gt;flow) update = p-&gt;flow;</span><br><span class="line">                    ret += update;</span><br><span class="line">                    <span class="keyword">for</span> (Edge *p = pre[t]; p != <span class="literal">NULL</span>; p = pre[p-&gt;re-&gt;v])</span><br><span class="line">                        p-&gt;flow -= update, p-&gt;re-&gt;flow += update;</span><br><span class="line">                    i = s;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">int</span> depth = n<span class="number">-1</span>;</span><br><span class="line">                <span class="keyword">for</span> (Edge *p = adj[i]; p != <span class="literal">NULL</span>; p = p-&gt;next)</span><br><span class="line">                    <span class="keyword">if</span> (p-&gt;flow &amp;&amp; depth &gt; level[p-&gt;v]) depth = level[p-&gt;v];</span><br><span class="line">                <span class="keyword">if</span> (--lvCnt[level[i]] == <span class="number">0</span>) <span class="keyword">return</span> ret;</span><br><span class="line">                level[i] = depth+<span class="number">1</span>;</span><br><span class="line">                ++lvCnt[level[i]];</span><br><span class="line">                arc[i] = adj[i];</span><br><span class="line">                <span class="keyword">if</span> (i != s) i = pre[i]-&gt;re-&gt;v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; g;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span> (testcase--) &#123;</span><br><span class="line">        <span class="keyword">int</span> M, N, K;</span><br><span class="line">        <span class="keyword">int</span> W[<span class="number">64</span>], V[<span class="number">64</span>], R[<span class="number">64</span>];</span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; WR[<span class="number">64</span>];</span><br><span class="line">        <span class="keyword">int</span> sumVIP = <span class="number">0</span>, maxW = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;M, &amp;N, &amp;K);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;W[i]), maxW = <span class="built_in">max</span>(maxW, W[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; M; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> n, x;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;V[i], &amp;R[i], &amp;n);</span><br><span class="line">            WR[i].<span class="built_in">clear</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x), x--;</span><br><span class="line">                WR[i].<span class="built_in">push_back</span>(x);</span><br><span class="line">            &#125;</span><br><span class="line">            sumVIP += V[i];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> l = <span class="number">0</span>, r = (<span class="keyword">long</span> <span class="keyword">long</span>) maxW * (sumVIP + K), mid, ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (l &lt;= r)  &#123;</span><br><span class="line">            mid = (l + r)/<span class="number">2</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> time = mid;</span><br><span class="line">            <span class="keyword">int</span> source = N + <span class="number">2</span>*M;</span><br><span class="line">            <span class="keyword">int</span> sink1 = N + <span class="number">2</span>*M + <span class="number">1</span>;	<span class="comment">// VIP</span></span><br><span class="line">            <span class="keyword">int</span> sink2 = N + <span class="number">2</span>*M + <span class="number">2</span>;	<span class="comment">// Regular</span></span><br><span class="line">            <span class="keyword">int</span> sink = N + <span class="number">2</span>*M + <span class="number">3</span>;</span><br><span class="line">            g.<span class="built_in">Init</span>(N + <span class="number">2</span>*M + <span class="number">5</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">                g.<span class="built_in">Addedge</span>(source, i, time / W[i]);</span><br><span class="line"><span class="comment">//				printf(&quot;e %d %d %d\n&quot;, source, i, time / W[i]);</span></span><br><span class="line">            &#125;</span><br><span class="line">            g.<span class="built_in">Addedge</span>(sink1, sink, sumVIP);</span><br><span class="line">            g.<span class="built_in">Addedge</span>(sink2, sink, K);</span><br><span class="line"><span class="comment">//			printf(&quot;e %d %d %d\n&quot;, sink1, sink, sumVIP);</span></span><br><span class="line"><span class="comment">//			printf(&quot;e %d %d %d\n&quot;, sink2, sink, K);</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; M; i++) &#123;</span><br><span class="line">                <span class="keyword">int</span> u1 = N + <span class="number">2</span>*i, u2 = N + <span class="number">2</span>*i + <span class="number">1</span>;</span><br><span class="line">                g.<span class="built_in">Addedge</span>(u1, sink1, V[i]);</span><br><span class="line">                g.<span class="built_in">Addedge</span>(u2, sink2, R[i]);</span><br><span class="line"><span class="comment">//				printf(&quot;e %d %d %d\n&quot;, u1, sink1, V[i]);</span></span><br><span class="line"><span class="comment">//				printf(&quot;e %d %d %d\n&quot;, u2, sink2, R[i]);</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; WR[i].<span class="built_in">size</span>(); j++) &#123;</span><br><span class="line">                    <span class="keyword">int</span> v = WR[i][j];</span><br><span class="line"><span class="comment">//					printf(&quot;e %d %d %d\n&quot;, v, u1, INF);</span></span><br><span class="line"><span class="comment">//					printf(&quot;e %d %d %d\n&quot;, v, u2, INF);</span></span><br><span class="line">                    g.<span class="built_in">Addedge</span>(v, u1, LLINF);</span><br><span class="line">                    g.<span class="built_in">Addedge</span>(v, u2, LLINF);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> flow = g.<span class="built_in">Maxflow</span>(source, sink);</span><br><span class="line"><span class="comment">//			printf(&quot;time %d: %d\n&quot;, time, flow);</span></span><br><span class="line">            <span class="keyword">if</span> (flow == sumVIP + K)</span><br><span class="line">                r = mid - <span class="number">1</span>, ret = time;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case %d: %lld\n&quot;</span>, ++cases, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/categories/解題區/">&laquo; Prev</a><a class="page-number" href="/categories/解題區/">1</a><span class="page-number current">2</span><a class="page-number" href="/categories/解題區/page/3/">3</a><a class="page-number" href="/categories/解題區/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/categories/解題區/page/64/">64</a><a class="extend next" rel="next" href="/categories/解題區/page/3/">Next &raquo;</a>
    </nav>
  
</section>
          
          
            <aside id="sidebar">
  <!-- <div id="ukagaka_panel"></div> -->
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">115</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算機圖學/">計算機圖學</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/">工作應用</a><span class="category-list-count">30</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Java/">Java</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Meme/">Meme</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/可持久化/">可持久化</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/鬼故事/">鬼故事</a><span class="category-list-count">9</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">44</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">633</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">483</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">77</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">45</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2021/05/30/java/java-memory-optimization-1/">
              
                <i class="icon-file-o"></i> 
              
            Java 優化內存使用 結構篇</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/diary-202101/">
              
                <i class="icon-file-o"></i> 
              
            二八進展</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-file-extension/">
              
                <i class="icon-file-o"></i> 
              
            File Extension</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-globl-var/">
              
                <i class="icon-file-o"></i> 
              
            Global Variable</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-handover/">
              
                <i class="icon-file-o"></i> 
              
            Handover</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-interview-recursion/">
              
                <i class="icon-file-o"></i> 
              
            Interview &amp; Recursion</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-job-build/">
              
                <i class="icon-file-o"></i> 
              
            Job Build</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-lang/">
              
                <i class="icon-file-o"></i> 
              
            Programming Language Impostors</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-machine-learning-newbie/">
              
                <i class="icon-file-o"></i> 
              
            Machine Learning for Newbie</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-parallel-gc/">
              
                <i class="icon-file-o"></i> 
              
            Parallel &amp; Garbage Collection</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
<script type="text/javascript">
  $('#ukagaka_panel').ukagaka();
</script>
  
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2021 Shiang-Yun Yang 
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>