<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>動態幾何 史蒂芙的泡泡 (解法 2) | Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="題目描述在處理完數以百計的政事後，受盡折磨的史蒂芙，打算回家好好地休息。 拖著疲倦的身軀，再也無法再容納任何一點複雜計算。從王宮走回寢居的路上， 發現身邊所見的事物都不再圓滑，看起來就像是粗糙的幾何多邊形構成的一切。 打算享受著泡泡浴的史蒂芙，看著眼前的多邊形泡泡，失去原本應有的色澤，那透涼的心境更蒙上了一層灰影 「為什麼是我呢？」感嘆道 伸出手戳著眼前的泡泡，卻飄了過去 「區區的泡泡也跟我作對，">
<meta name="keywords" content="pbds,rope">
<meta property="og:type" content="article">
<meta property="og:title" content="動態幾何 史蒂芙的泡泡 (解法 2)">
<meta property="og:url" content="http://morris821028.github.io/2019/02/16/zj-e021/index.html">
<meta property="og:site_name" content="Morris&#39; Blog">
<meta property="og:description" content="題目描述在處理完數以百計的政事後，受盡折磨的史蒂芙，打算回家好好地休息。 拖著疲倦的身軀，再也無法再容納任何一點複雜計算。從王宮走回寢居的路上， 發現身邊所見的事物都不再圓滑，看起來就像是粗糙的幾何多邊形構成的一切。 打算享受著泡泡浴的史蒂芙，看著眼前的多邊形泡泡，失去原本應有的色澤，那透涼的心境更蒙上了一層灰影 「為什麼是我呢？」感嘆道 伸出手戳著眼前的泡泡，卻飄了過去 「區區的泡泡也跟我作對，">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2021-05-30T02:04:42.575Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="動態幾何 史蒂芙的泡泡 (解法 2)">
<meta name="twitter:description" content="題目描述在處理完數以百計的政事後，受盡折磨的史蒂芙，打算回家好好地休息。 拖著疲倦的身軀，再也無法再容納任何一點複雜計算。從王宮走回寢居的路上， 發現身邊所見的事物都不再圓滑，看起來就像是粗糙的幾何多邊形構成的一切。 打算享受著泡泡浴的史蒂芙，看著眼前的多邊形泡泡，失去原本應有的色澤，那透涼的心境更蒙上了一層灰影 「為什麼是我呢？」感嘆道 伸出手戳著眼前的泡泡，卻飄了過去 「區區的泡泡也跟我作對，">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
  <link rel="import" href="/bower_components/app-layout/app-layout.html"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          
          <section id="main" style="width: 95%"><article id="post-zj-e021" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/16/zj-e021/" class="article-date">
  <time datetime="2019-02-16T01:11:22.000Z" itemprop="datePublished">2019-02-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      動態幾何 史蒂芙的泡泡 (解法 2)
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2019/02/16/zj-e021/" data-id="ckpaivcfo00njn8vngd73d3xs" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2019/02/16/zj-e021/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pbds/">pbds</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rope/">rope</a></li></ul>

    </footer>
    <div class="article-entry " itemprop="articleBody">
      
          
              <div id="toc" class="toc-article">
              <h2 class="toc-title"><span>contents</span></h2>
              
                  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#題目描述"><span class="toc-number">1.</span> <span class="toc-text">題目描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sample-Input"><span class="toc-number">2.</span> <span class="toc-text">Sample Input</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sample-Output"><span class="toc-number">3.</span> <span class="toc-text">Sample Output</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution"><span class="toc-number">4.</span> <span class="toc-text">Solution</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PBDS-SPLAY"><span class="toc-number">4.1.</span> <span class="toc-text">PBDS + SPLAY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PBDS-ROPE"><span class="toc-number">4.2.</span> <span class="toc-text">PBDS + ROPE</span></a></li></ol></li></ol>
              
              </div>
          
        
          <h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>在處理完數以百計的政事後，受盡折磨的史蒂芙，打算回家好好地休息。 拖著疲倦的身軀，再也無法再容納任何一點複雜計算。從王宮走回寢居的路上， 發現身邊所見的事物都不再圓滑，看起來就像是粗糙的幾何多邊形構成的一切。</p>
<p>打算享受著泡泡浴的史蒂芙，看著眼前的多邊形泡泡，失去原本應有的色澤，那透涼的心境更蒙上了一層灰影</p>
<p>「為什麼是我呢？」感嘆道</p>
<p>伸出手戳著眼前的泡泡，卻飄了過去</p>
<p>「區區的泡泡也跟我作對，嗚嗚」</p>
<p>將一個泡泡視為一個簡單多邊形 <span>$A$</span><!-- Has MathJax -->，方便起見用一個序列 <span>$a_0, a_1, ..., a_{n-1}$</span><!-- Has MathJax --> 表示多邊形 <span>$A$</span><!-- Has MathJax --> 的每一個頂點，則會有 <span>$n$</span><!-- Has MathJax --> 個線段 <span>$\overline{a_0 a_1}, \overline{a_1 a_2}, \cdots, \overline{a_{n-1} a_0}$</span><!-- Has MathJax -->。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">5 14</span><br><span class="line"></span><br><span class="line">0 0</span><br><span class="line">10 0 </span><br><span class="line">10 10</span><br><span class="line">0 10</span><br><span class="line">5 5</span><br><span class="line"></span><br><span class="line">1 0 0</span><br><span class="line">1 1 0</span><br><span class="line">1 2 1</span><br><span class="line">1 3 2</span><br><span class="line">3 5.5 5</span><br><span class="line">3 10 -1</span><br><span class="line">3 10 5</span><br><span class="line">1 4 1</span><br><span class="line">3 5.5 5</span><br><span class="line">3 10 -1</span><br><span class="line">3 10 5</span><br><span class="line">2 3</span><br><span class="line">3 5 7.5</span><br><span class="line">3 5 2.5</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>參閱 <a href="/2019/01/26/mproblem-dynamic-point-in-polygon/" title="動態幾何 史蒂芙的泡泡  (解法 1)">動態幾何 史蒂芙的泡泡  (解法 1)</a></p>
<p>相較於先前的解法 <span>$\mathcal{O}(\log n) - \mathcal{O}(\ast \sqrt{n})$</span><!-- Has MathJax -->，相當不穩定的嵌套 KD-BRH 的解法，實際上如果單純針對這一題，可以拋開 region search 的操作，只有完全的詢問點是否在多邊形內部，則可以做到 <span>$\mathcal{O}(\log^2 n)$</span><!-- Has MathJax -->。</p>
<p>如同一般的射線法，對詢問點拉出無限延長的線，找到與多邊形的邊相交個數。如果單純把每一條邊拿出來看，最暴力的複雜度為 <span>$\mathcal{O}(n)$</span><!-- Has MathJax -->，現在要減少查閱的邊數，且透過 rank tree 在 <span>$\mathcal{O}(\log n)$</span><!-- Has MathJax --> 累計相交數量。</p>
<p>由於給定的座標不需要動態，則著手離散化 <span>$X = x_0, x_1, \cdots, x_n$</span><!-- Has MathJax -->，線段樹中的每一個點 <span>$u$</span><!-- Has MathJax --> 維護一個 rank tree，把包含者個區段 <span>$[x_l, x_r]$</span><!-- Has MathJax --> 的線段通通放入，且保證放入的線段彼此之間不相交 (除了兩端點)。如此一來，當詢問一個點，需要探訪 <span>$\mathcal{O}(\log n)$</span><!-- Has MathJax --> 個節點，每個節點 <span>$u$</span><!-- Has MathJax --> 需要 <span>$\mathcal{O}(\log n)$</span><!-- Has MathJax --> 時間來計算相交數量，最後詢問的複雜度為 <span>$\mathcal{O}(\log^2 n)$</span><!-- Has MathJax -->。同理，修改點的操作也會在 <span>$\mathcal{O}(\log^2 n)$</span><!-- Has MathJax -->。</p>
<p>實作時，特別注意到與射線方向相同的線段不予處理，按照下面的寫法則是不處理垂直的線段，一來是射線法也不會去計算，二來是線段樹劃分的時候會造成一些邊界問題，由於我們對於點離散，父節點 <span>$[x_l, x_r]$</span><!-- Has MathJax -->，左右子樹控制的分別為 <span>$[x_l, x_\text{mid}]$</span><!-- Has MathJax -->、<span>$[x_\text{mid}, x_r]$</span><!-- Has MathJax -->，劃分時會共用中間點。</p>
<p>即使有了上述的概念來解題，我們仍需要維護 <a href="https://en.wikipedia.org/wiki/Rope_(data_structure">rope data structrue</a> 來維護節點的相鄰關係，可以自己實作任何的 binary tree 來達到 <span>$\mathcal{O}(\log n)$</span><!-- Has MathJax -->，這裡採用 splay tree 示範。</p>
<hr>
<p>接下來介紹內建黑魔法 PBDS (policy-based data structure) 和 rope。很多人都提及到這些非正式的 STL 函式庫，只有在 gcc/g++ 裡面才有附錄，如果是 clang 等其他編譯器可能是沒有辦法的。所以上傳相關代碼要看 OJ 是否採用純正的 gcc/g++。</p>
<p>參考資料：</p>
<ul>
<li><a href="https://codeforces.com/blog/entry/11080">C++ STL: Policy based data structures - Codeforces</a></li>
<li><a href="https://www.luogu.org/blog/Chanis/gnu-pbds">比STL还STL？——平板电视</a></li>
<li><a href="http://www.martinbroadhurst.com/stl/Rope.html">C++ STL: SGI rope</a></li>
</ul>
<p>PBDS 比較常用在 rank tree 和 heap，由於代碼量非常多，用內建防止 code length exceed limitation 的出現，也不妨是個好辦法。用 rank tree 的每一個詢問操作皆在 <span>$\mathcal{O}(\log n)$</span><!-- Has MathJax -->，而 heap 選擇 thin heap 或 pairing heap，除了 pop 操作外，皆為 <span>$\mathcal{O}(1)$</span><!-- Has MathJax -->，在對最短路徑問題上別有優勢。</p>
<p>而這一題不太適用 SGI rope，原因在於雖為 <span>$\mathcal{O}(\log n)$</span><!-- Has MathJax --> 操作，但它原本就為了仿作 string 而強迫變成可持久化的引數結構，導致每一個操作需要額外的開銷來減少內存使用。由於此題經常在單一元素上操作，SGI rope 對於單一元素效能不彰，以造成嚴重的逾時。</p>
<p>這裡仍提及和示範這些概念的資料結構，哪天正式編入標準函式庫，想必效能問題都已解決。</p>
<hr>
<ul>
<li>KD BRH AC(0.2s, 10 MB)</li>
<li>PBDS + SPLAY AC(0.3s, 38 MB)</li>
<li>PBDS + SGI rope AC(0.5s, 41 MB)<br>本機 MINGW gcc 4.9 c++ 11 編譯完運行最大的測資需要 20 倍慢於其他寫法，但是上傳到 ZJ 的 gcc 7 又追回去了。於是下載 CYGWIN gcc 7 測試結果與 ZJ 運行結果相當，對於需要調適的人，建議在新版上測試。</li>
</ul>
<p>用 splay tree 模擬 rope 的時候，會遇到循序非遞減的走訪，這時候若不斷地旋轉至根，會在之後的操作造成退化，常數稍微大一點，雖然在迭代過程中造就好的快取效能，很快地在 <span>$\mathcal{O}(1)$</span><!-- Has MathJax --> 訪問到相鄰的節點，卻在下一次的插入/刪除操作中變慢。一些變異的版本中，如只在插入/刪除操作中旋轉至根，在查找操作中不旋轉，或者限制旋轉的深度。雖然有一些特別的退化操作，splay 仍舊是某些 OS 場景中使用的資料結構，現實總是很特別的。</p>
<blockquote><p>In 2000, Danny Sleator and Robert Tarjan won the ACM Kanellakis Theory and Practice Award for their papers on splay trees and amortized analysis.  Splay trees are used in Windows NT (in the virtual memory, networking, and file system code), the gcc compiler and GNU C++ library, the sed string editor, Fore Systems network routers, the most popular implementation of Unix malloc, Linux loadable kernel modules, and in much other software.</p>
<footer><strong>Berkeley eecs April 23, 2014</strong><cite><a href="https://people.eecs.berkeley.edu/~jrs/61b/lec/36">people.eecs.berkeley.edu/~jrs/61b/lec/36</a></cite></footer></blockquote>

<h3 id="PBDS-SPLAY"><a href="#PBDS-SPLAY" class="headerlink" title="PBDS + SPLAY"></a>PBDS + SPLAY</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ext/pb_ds/assoc_container.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ext/pb_ds/tree_policy.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_pbds;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Mesh</span> &#123;</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">int</span> pt[MAXN][<span class="number">2</span>];</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; X;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;pt[i][<span class="number">0</span>], &amp;pt[i][<span class="number">1</span>]);</span><br><span class="line">        X.<span class="built_in">clear</span>(); X.<span class="built_in">reserve</span>(n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            X.<span class="built_in">push_back</span>(pt[i][<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">sort</span>(X.<span class="built_in">begin</span>(), X.<span class="built_in">end</span>());</span><br><span class="line">        X.<span class="built_in">erase</span>(<span class="built_in">unique</span>(X.<span class="built_in">begin</span>(), X.<span class="built_in">end</span>()), X.<span class="built_in">end</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125; mesh;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SplayTree</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        Node *ch[<span class="number">2</span>], *fa;</span><br><span class="line">        <span class="keyword">int</span> size; <span class="keyword">int</span> data;</span><br><span class="line">        <span class="built_in">Node</span>() &#123;</span><br><span class="line">            ch[<span class="number">0</span>] = ch[<span class="number">1</span>] = fa = <span class="literal">NULL</span>;</span><br><span class="line">            size = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">is_root</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> fa-&gt;ch[<span class="number">0</span>] != <span class="keyword">this</span> &amp;&amp; fa-&gt;ch[<span class="number">1</span>] != <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    Node *root, *EMPTY;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(Node *u)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u-&gt;ch[<span class="number">0</span>] != EMPTY)	<span class="built_in">pushdown</span>(u-&gt;ch[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">if</span> (u-&gt;ch[<span class="number">1</span>] != EMPTY)	<span class="built_in">pushdown</span>(u-&gt;ch[<span class="number">1</span>]);</span><br><span class="line">        u-&gt;size = <span class="number">1</span> + u-&gt;ch[<span class="number">0</span>]-&gt;size + u-&gt;ch[<span class="number">1</span>]-&gt;size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setch</span><span class="params">(Node *p, Node *u, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (p != EMPTY)	p-&gt;ch[i] = u;</span><br><span class="line">        <span class="keyword">if</span> (u != EMPTY)	u-&gt;fa = p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">SplayTree</span>() &#123;</span><br><span class="line">        EMPTY = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">        EMPTY-&gt;fa = EMPTY-&gt;ch[<span class="number">0</span>] = EMPTY-&gt;ch[<span class="number">1</span>] = EMPTY;</span><br><span class="line">        EMPTY-&gt;size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        root = EMPTY;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Node *u = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">        u-&gt;fa = u-&gt;ch[<span class="number">0</span>] = u-&gt;ch[<span class="number">1</span>] = EMPTY;</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(Node *x)</span> </span>&#123;</span><br><span class="line">        Node *y;</span><br><span class="line">        <span class="keyword">int</span> d;</span><br><span class="line">        y = x-&gt;fa, d = y-&gt;ch[<span class="number">1</span>] == x ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        x-&gt;ch[d^<span class="number">1</span>]-&gt;fa = y, y-&gt;ch[d] = x-&gt;ch[d^<span class="number">1</span>];</span><br><span class="line">        x-&gt;ch[d^<span class="number">1</span>] = y;</span><br><span class="line">        <span class="keyword">if</span> (!y-&gt;<span class="built_in">is_root</span>())</span><br><span class="line">            y-&gt;fa-&gt;ch[y-&gt;fa-&gt;ch[<span class="number">1</span>] == y] = x;</span><br><span class="line">        x-&gt;fa = y-&gt;fa, y-&gt;fa = x;</span><br><span class="line">        <span class="built_in">pushup</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deal</span><span class="params">(Node *x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!x-&gt;<span class="built_in">is_root</span>())	<span class="built_in">deal</span>(x-&gt;fa);</span><br><span class="line">        <span class="built_in">pushdown</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(Node *x, Node *below)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x == EMPTY)	<span class="keyword">return</span> ;</span><br><span class="line">        Node *y, *z;</span><br><span class="line">        <span class="built_in">deal</span>(x);</span><br><span class="line">        <span class="keyword">while</span> (!x-&gt;<span class="built_in">is_root</span>() &amp;&amp; x-&gt;fa != below) &#123;</span><br><span class="line">            y = x-&gt;fa, z = y-&gt;fa;</span><br><span class="line">            <span class="keyword">if</span> (!y-&gt;<span class="built_in">is_root</span>() &amp;&amp; y-&gt;fa != below) &#123;</span><br><span class="line">                <span class="keyword">if</span> (y-&gt;ch[<span class="number">0</span>] == x ^ z-&gt;ch[<span class="number">0</span>] == y)</span><br><span class="line">                    <span class="built_in">rotate</span>(x);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="built_in">rotate</span>(y);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">rotate</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">        <span class="keyword">if</span> (x-&gt;fa == EMPTY)	root = x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">prevNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">splay</span>(u, EMPTY);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">maxNode</span>(u-&gt;ch[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">nextNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">splay</span>(u, EMPTY);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">minNode</span>(u-&gt;ch[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">minNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        Node *p = u-&gt;fa;</span><br><span class="line">        <span class="keyword">for</span> (; <span class="built_in">pushdown</span>(u), u-&gt;ch[<span class="number">0</span>] != EMPTY; u = u-&gt;ch[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">splay</span>(u, p);</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">maxNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        Node *p = u-&gt;fa;</span><br><span class="line">        <span class="keyword">for</span> (; <span class="built_in">pushdown</span>(u), u-&gt;ch[<span class="number">1</span>] != EMPTY; u = u-&gt;ch[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">splay</span>(u, p);</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">findPos</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123; <span class="comment">// [0...]</span></span><br><span class="line">        <span class="keyword">for</span> (Node *u = root; u != EMPTY;) &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(u);</span><br><span class="line">            <span class="keyword">int</span> t = u-&gt;ch[<span class="number">0</span>]-&gt;size;</span><br><span class="line">            <span class="keyword">if</span> (t == pos) &#123;</span><br><span class="line">                <span class="built_in">splay</span>(u, EMPTY);</span><br><span class="line">                <span class="keyword">return</span> u;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (t &gt; pos)</span><br><span class="line">                u = u-&gt;ch[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                u = u-&gt;ch[<span class="number">1</span>], pos -= t + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> EMPTY;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">insert</span><span class="params">(<span class="keyword">int</span> data, <span class="keyword">int</span> pos)</span> </span>&#123;	<span class="comment">// make [pos] = data</span></span><br><span class="line">        Node *p, *q = <span class="built_in">findPos</span>(pos);</span><br><span class="line">        Node *x = <span class="built_in">newNode</span>(); x-&gt;data = data;</span><br><span class="line">        <span class="keyword">if</span> (q == EMPTY) &#123;</span><br><span class="line">            p = <span class="built_in">maxNode</span>(root), <span class="built_in">splay</span>(p, EMPTY);</span><br><span class="line">            <span class="built_in">setch</span>(x, p, <span class="number">0</span>);</span><br><span class="line">            <span class="built_in">splay</span>(x, EMPTY);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">splay</span>(q, EMPTY), p = q-&gt;ch[<span class="number">0</span>];</span><br><span class="line">            <span class="built_in">setch</span>(x, p, <span class="number">0</span>), <span class="built_in">setch</span>(x, q, <span class="number">1</span>);</span><br><span class="line">            <span class="built_in">setch</span>(q, EMPTY, <span class="number">0</span>);</span><br><span class="line">            <span class="built_in">splay</span>(q, EMPTY);</span><br><span class="line">            p = <span class="built_in">prevNode</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (p == EMPTY)	p = <span class="built_in">maxNode</span>(root);</span><br><span class="line">        <span class="keyword">if</span> (q == EMPTY)	q = <span class="built_in">minNode</span>(root);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_tuple</span>(p-&gt;data, data, q-&gt;data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">remove</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">        Node *x = <span class="built_in">findPos</span>(pos), *p, *q;</span><br><span class="line">        p = <span class="built_in">prevNode</span>(x), q = <span class="built_in">nextNode</span>(x);</span><br><span class="line">        <span class="keyword">if</span> (p != EMPTY &amp;&amp; q != EMPTY) &#123;</span><br><span class="line">            <span class="built_in">setch</span>(p, q, <span class="number">1</span>);</span><br><span class="line">            p-&gt;fa = EMPTY, <span class="built_in">splay</span>(q, EMPTY);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p != EMPTY) &#123;</span><br><span class="line">            p-&gt;fa = EMPTY, root = p;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            q-&gt;fa = EMPTY, root = q;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> del = x-&gt;data;</span><br><span class="line">        <span class="keyword">delete</span> x;</span><br><span class="line">        <span class="keyword">if</span> (p == EMPTY)	p = <span class="built_in">maxNode</span>(root);</span><br><span class="line">        <span class="keyword">if</span> (q == EMPTY)	q = <span class="built_in">minNode</span>(root);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_tuple</span>(p-&gt;data, del, q-&gt;data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> root == EMPTY ? <span class="number">0</span> : root-&gt;size;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; mlist;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pt</span> &#123;</span></span><br><span class="line">    <span class="keyword">double</span> x, y;</span><br><span class="line">    <span class="built_in">Pt</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">Pt</span>(<span class="keyword">int</span> xy[]):<span class="built_in">Pt</span>(xy[<span class="number">0</span>], xy[<span class="number">1</span>]) &#123;&#125;</span><br><span class="line">    <span class="built_in">Pt</span>(<span class="keyword">double</span> x, <span class="keyword">double</span> y):<span class="built_in">x</span>(x), <span class="built_in">y</span>(y) &#123;&#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Pt &amp;o) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (x != o.x)	<span class="keyword">return</span> x &lt; o.x;</span><br><span class="line">        <span class="keyword">return</span> y &lt; o.y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PtP</span> &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">double</span> x;</span><br><span class="line">    Pt p, q;</span><br><span class="line">    <span class="built_in">PtP</span>(Pt a, Pt b) &#123;</span><br><span class="line">        p = a, q = b;</span><br><span class="line">        <span class="keyword">if</span> (q &lt; p)</span><br><span class="line">            <span class="built_in">swap</span>(p, q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">interpolate</span><span class="params">(<span class="keyword">const</span> Pt&amp; p1, <span class="keyword">const</span> Pt&amp; p2, <span class="keyword">double</span>&amp; x)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (p1.x == p2.x) <span class="keyword">return</span> <span class="built_in">min</span>(p1.y, p2.y);</span><br><span class="line">        <span class="keyword">return</span> p1.y + (p2.y - p1.y) / (p2.x - p1.x) * (x - p1.x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> PtP &amp;o) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">interpolate</span>(p, q, x) &lt; <span class="built_in">interpolate</span>(o.p, o.q, x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">double</span> PtP::x = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegSeg</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        Node *lson, *rson;</span><br><span class="line">        tree&lt;pair&lt;PtP, <span class="keyword">int</span>&gt;, null_type, less&lt;pair&lt;PtP, <span class="keyword">int</span>&gt;&gt;, rb_tree_tag, tree_order_statistics_node_update&gt; segs;</span><br><span class="line">        <span class="built_in">Node</span>() &#123;</span><br><span class="line">            lson = rson = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    Node *root;</span><br><span class="line">    <span class="keyword">int</span> xn;</span><br><span class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">freeNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">free</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        root = <span class="literal">NULL</span>;</span><br><span class="line">        xn = mesh.X.<span class="built_in">size</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> p, q, r; <span class="built_in">tie</span>(p, q, r) = e;</span><br><span class="line">        <span class="built_in">remove</span>(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;<span class="built_in">PtP</span>(<span class="built_in">Pt</span>(mesh.pt[p]), <span class="built_in">Pt</span>(mesh.pt[r])), r&#125;);</span><br><span class="line">        <span class="built_in">insert</span>(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;<span class="built_in">PtP</span>(<span class="built_in">Pt</span>(mesh.pt[p]), <span class="built_in">Pt</span>(mesh.pt[q])), q&#125;);</span><br><span class="line">        <span class="built_in">insert</span>(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;<span class="built_in">PtP</span>(<span class="built_in">Pt</span>(mesh.pt[q]), <span class="built_in">Pt</span>(mesh.pt[r])), r&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> p, q, r; <span class="built_in">tie</span>(p, q, r) = e;</span><br><span class="line">        <span class="built_in">remove</span>(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;<span class="built_in">PtP</span>(<span class="built_in">Pt</span>(mesh.pt[p]), <span class="built_in">Pt</span>(mesh.pt[q])), q&#125;);</span><br><span class="line">        <span class="built_in">remove</span>(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;<span class="built_in">PtP</span>(<span class="built_in">Pt</span>(mesh.pt[q]), <span class="built_in">Pt</span>(mesh.pt[r])), r&#125;);</span><br><span class="line">        <span class="built_in">insert</span>(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;<span class="built_in">PtP</span>(<span class="built_in">Pt</span>(mesh.pt[p]), <span class="built_in">Pt</span>(mesh.pt[r])), r&#125;);</span><br><span class="line">    &#125;	</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">inside</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> </span>&#123;</span><br><span class="line">        PtP::x = x;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">count</span>(root, <span class="number">0</span>, xn<span class="number">-1</span>, x, y)&amp;<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">count</span><span class="params">(Node* u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ((mesh.X[l] &gt; x) != (mesh.X[r] &gt; x))</span><br><span class="line">            ret += u-&gt;segs.<span class="built_in">order_of_key</span>(&#123;<span class="built_in">PtP</span>(<span class="built_in">Pt</span>(x, y), <span class="built_in">Pt</span>(x, y)), <span class="number">-1</span>&#125;);</span><br><span class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= mesh.X[m])</span><br><span class="line">            ret += <span class="built_in">count</span>(u-&gt;lson, l, m, x, y);</span><br><span class="line">        <span class="keyword">if</span> (x &gt;= mesh.X[m])</span><br><span class="line">            ret += <span class="built_in">count</span>(u-&gt;rson, m, r, x, y);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, pair&lt;PtP, <span class="keyword">int</span>&gt; s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s.first.p.x != s.first.q.x)</span><br><span class="line">            <span class="built_in">insert</span>(root, l, r, s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, pair&lt;PtP, <span class="keyword">int</span>&gt; s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s.first.p.x != s.first.q.x)</span><br><span class="line">            <span class="built_in">remove</span>(root, l, r, s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Node* &amp;u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, pair&lt;PtP, <span class="keyword">int</span>&gt; s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</span><br><span class="line">            u = <span class="built_in">newNode</span>();</span><br><span class="line">        <span class="keyword">if</span> (s.first.p.x &lt;= mesh.X[l] &amp;&amp; mesh.X[r] &lt;= s.first.q.x) &#123;</span><br><span class="line">            PtP::x = (mesh.X[l] + mesh.X[r])/<span class="number">2.0</span>;</span><br><span class="line">            u-&gt;segs.<span class="built_in">insert</span>(s);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (s.first.q.x &lt;= mesh.X[m])			<span class="built_in">insert</span>(u-&gt;lson, l, m, s);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s.first.p.x &gt;= mesh.X[m])	<span class="built_in">insert</span>(u-&gt;rson, m, r, s);</span><br><span class="line">        <span class="keyword">else</span>	<span class="built_in">insert</span>(u-&gt;lson, l, m, s), <span class="built_in">insert</span>(u-&gt;rson, m, r, s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(Node* u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, pair&lt;PtP, <span class="keyword">int</span>&gt; s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (s.first.p.x &lt;= mesh.X[l] &amp;&amp; mesh.X[r] &lt;= s.first.q.x) &#123;</span><br><span class="line">            PtP::x = (mesh.X[l] + mesh.X[r])/<span class="number">2.0</span>;</span><br><span class="line">            u-&gt;segs.<span class="built_in">erase</span>(s);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (s.first.q.x &lt;= mesh.X[m])			<span class="built_in">remove</span>(u-&gt;lson, l, m, s);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s.first.p.x &gt;= mesh.X[m])	<span class="built_in">remove</span>(u-&gt;rson, m, r, s);</span><br><span class="line">        <span class="keyword">else</span>	<span class="built_in">remove</span>(u-&gt;lson, l, m, s), <span class="built_in">remove</span>(u-&gt;rson, m, r, s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; mbrh;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m, cmd, x, pos;</span><br><span class="line">    <span class="keyword">double</span> px, py;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    mesh.<span class="built_in">read</span>(n);</span><br><span class="line">    mlist.<span class="built_in">init</span>(), mbrh.<span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;cmd);</span><br><span class="line">        <span class="keyword">if</span> (cmd == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;pos);</span><br><span class="line">            mbrh.<span class="built_in">insert</span>(mlist.<span class="built_in">insert</span>(x, pos));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">            mbrh.<span class="built_in">remove</span>(mlist.<span class="built_in">remove</span>(x));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%lf %lf&quot;</span>, &amp;px, &amp;py);</span><br><span class="line">            <span class="built_in">puts</span>(mbrh.<span class="built_in">inside</span>(px, py) ? <span class="string">&quot;1&quot;</span> : <span class="string">&quot;0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="PBDS-ROPE"><a href="#PBDS-ROPE" class="headerlink" title="PBDS + ROPE"></a>PBDS + ROPE</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ext/rope&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_cxx;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ext/pb_ds/assoc_container.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ext/pb_ds/tree_policy.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_pbds;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Mesh</span> &#123;</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">int</span> pt[MAXN][<span class="number">2</span>];</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; X;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;pt[i][<span class="number">0</span>], &amp;pt[i][<span class="number">1</span>]);</span><br><span class="line">        X.<span class="built_in">clear</span>(); X.<span class="built_in">reserve</span>(n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            X.<span class="built_in">push_back</span>(pt[i][<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">sort</span>(X.<span class="built_in">begin</span>(), X.<span class="built_in">end</span>());</span><br><span class="line">        X.<span class="built_in">erase</span>(<span class="built_in">unique</span>(X.<span class="built_in">begin</span>(), X.<span class="built_in">end</span>()), X.<span class="built_in">end</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125; mesh;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rope</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    rope&lt;<span class="keyword">int</span>&gt; r;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        r.<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">next</span><span class="params">(rope&lt;<span class="keyword">int</span>&gt;::const_iterator it)</span> </span>&#123;</span><br><span class="line">        it++;</span><br><span class="line">        <span class="keyword">if</span> (it == r.<span class="built_in">end</span>())</span><br><span class="line">            <span class="keyword">return</span> *r.<span class="built_in">begin</span>();</span><br><span class="line">        <span class="keyword">return</span> *it;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">prev</span><span class="params">(rope&lt;<span class="keyword">int</span>&gt;::const_iterator it)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (it == r.<span class="built_in">begin</span>())</span><br><span class="line">            <span class="keyword">return</span> *r.<span class="built_in">rbegin</span>();</span><br><span class="line">        it--;</span><br><span class="line">        <span class="keyword">return</span> *it;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">insert</span><span class="params">(<span class="keyword">int</span> data, <span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">        r.<span class="built_in">insert</span>(pos, data);</span><br><span class="line">        <span class="keyword">auto</span> it = r.<span class="built_in">begin</span>() + pos;</span><br><span class="line">        <span class="keyword">int</span> p = <span class="built_in">prev</span>(it);</span><br><span class="line">        <span class="keyword">int</span> q = <span class="built_in">next</span>(it);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_tuple</span>(p, data, q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">remove</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> it = r.<span class="built_in">begin</span>() + pos;</span><br><span class="line">        <span class="keyword">int</span> del = *it;</span><br><span class="line">        <span class="keyword">int</span> p = <span class="built_in">prev</span>(it);</span><br><span class="line">        <span class="keyword">int</span> q = <span class="built_in">next</span>(it);</span><br><span class="line">        r.<span class="built_in">erase</span>(pos, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_tuple</span>(p, del, q);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; mlist;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pt</span> &#123;</span></span><br><span class="line">    <span class="keyword">double</span> x, y;</span><br><span class="line">    <span class="built_in">Pt</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">Pt</span>(<span class="keyword">int</span> xy[]):<span class="built_in">Pt</span>(xy[<span class="number">0</span>], xy[<span class="number">1</span>]) &#123;&#125;</span><br><span class="line">    <span class="built_in">Pt</span>(<span class="keyword">double</span> x, <span class="keyword">double</span> y):<span class="built_in">x</span>(x), <span class="built_in">y</span>(y) &#123;&#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Pt &amp;o) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (x != o.x)	<span class="keyword">return</span> x &lt; o.x;</span><br><span class="line">        <span class="keyword">return</span> y &lt; o.y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PtP</span> &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">double</span> x;</span><br><span class="line">    Pt p, q;</span><br><span class="line">    <span class="built_in">PtP</span>(Pt a, Pt b) &#123;</span><br><span class="line">        p = a, q = b;</span><br><span class="line">        <span class="keyword">if</span> (q &lt; p)</span><br><span class="line">            <span class="built_in">swap</span>(p, q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">interpolate</span><span class="params">(<span class="keyword">const</span> Pt&amp; p1, <span class="keyword">const</span> Pt&amp; p2, <span class="keyword">double</span>&amp; x)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (p1.x == p2.x) <span class="keyword">return</span> <span class="built_in">min</span>(p1.y, p2.y);</span><br><span class="line">        <span class="keyword">return</span> p1.y + (p2.y - p1.y) / (p2.x - p1.x) * (x - p1.x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> PtP &amp;o) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">interpolate</span>(p, q, x) &lt; <span class="built_in">interpolate</span>(o.p, o.q, x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">double</span> PtP::x = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegSeg</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        Node *lson, *rson;</span><br><span class="line">        tree&lt;pair&lt;PtP, <span class="keyword">int</span>&gt;, null_type, less&lt;pair&lt;PtP, <span class="keyword">int</span>&gt;&gt;, rb_tree_tag, tree_order_statistics_node_update&gt; segs;</span><br><span class="line">        <span class="built_in">Node</span>() &#123;</span><br><span class="line">            lson = rson = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    Node *root;</span><br><span class="line">    <span class="keyword">int</span> xn;</span><br><span class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        root = <span class="literal">NULL</span>;</span><br><span class="line">        xn = mesh.X.<span class="built_in">size</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> p, q, r; <span class="built_in">tie</span>(p, q, r) = e;</span><br><span class="line">        <span class="built_in">remove</span>(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;<span class="built_in">PtP</span>(<span class="built_in">Pt</span>(mesh.pt[p]), <span class="built_in">Pt</span>(mesh.pt[r])), r&#125;);</span><br><span class="line">        <span class="built_in">insert</span>(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;<span class="built_in">PtP</span>(<span class="built_in">Pt</span>(mesh.pt[p]), <span class="built_in">Pt</span>(mesh.pt[q])), q&#125;);</span><br><span class="line">        <span class="built_in">insert</span>(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;<span class="built_in">PtP</span>(<span class="built_in">Pt</span>(mesh.pt[q]), <span class="built_in">Pt</span>(mesh.pt[r])), r&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> p, q, r; <span class="built_in">tie</span>(p, q, r) = e;</span><br><span class="line">        <span class="built_in">remove</span>(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;<span class="built_in">PtP</span>(<span class="built_in">Pt</span>(mesh.pt[p]), <span class="built_in">Pt</span>(mesh.pt[q])), q&#125;);</span><br><span class="line">        <span class="built_in">remove</span>(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;<span class="built_in">PtP</span>(<span class="built_in">Pt</span>(mesh.pt[q]), <span class="built_in">Pt</span>(mesh.pt[r])), r&#125;);</span><br><span class="line">        <span class="built_in">insert</span>(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;<span class="built_in">PtP</span>(<span class="built_in">Pt</span>(mesh.pt[p]), <span class="built_in">Pt</span>(mesh.pt[r])), r&#125;);</span><br><span class="line">    &#125;	</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">inside</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> </span>&#123;</span><br><span class="line">        PtP::x = x;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">count</span>(root, <span class="number">0</span>, xn<span class="number">-1</span>, x, y)&amp;<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">count</span><span class="params">(Node* u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ((mesh.X[l] &gt; x) != (mesh.X[r] &gt; x))</span><br><span class="line">            ret += u-&gt;segs.<span class="built_in">order_of_key</span>(&#123;<span class="built_in">PtP</span>(<span class="built_in">Pt</span>(x, y), <span class="built_in">Pt</span>(x, y)), <span class="number">-1</span>&#125;);</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= mesh.X[m])</span><br><span class="line">            ret += <span class="built_in">count</span>(u-&gt;lson, l, m, x, y);</span><br><span class="line">        <span class="keyword">if</span> (x &gt;= mesh.X[m])</span><br><span class="line">            ret += <span class="built_in">count</span>(u-&gt;rson, m, r, x, y);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, pair&lt;PtP, <span class="keyword">int</span>&gt; s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s.first.p.x != s.first.q.x)</span><br><span class="line">            <span class="built_in">insert</span>(root, l, r, s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, pair&lt;PtP, <span class="keyword">int</span>&gt; s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s.first.p.x != s.first.q.x)</span><br><span class="line">            <span class="built_in">remove</span>(root, l, r, s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Node* &amp;u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, pair&lt;PtP, <span class="keyword">int</span>&gt; s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</span><br><span class="line">            u = <span class="built_in">newNode</span>();</span><br><span class="line">        <span class="keyword">if</span> (s.first.p.x &lt;= mesh.X[l] &amp;&amp; mesh.X[r] &lt;= s.first.q.x) &#123;</span><br><span class="line">            PtP::x = (mesh.X[l] + mesh.X[r])/<span class="number">2.0</span>;</span><br><span class="line">            u-&gt;segs.<span class="built_in">insert</span>(s);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (s.first.q.x &lt;= mesh.X[m])			<span class="built_in">insert</span>(u-&gt;lson, l, m, s);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s.first.p.x &gt;= mesh.X[m])	<span class="built_in">insert</span>(u-&gt;rson, m, r, s);</span><br><span class="line">        <span class="keyword">else</span>	<span class="built_in">insert</span>(u-&gt;lson, l, m, s), <span class="built_in">insert</span>(u-&gt;rson, m, r, s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(Node* &amp;u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, pair&lt;PtP, <span class="keyword">int</span>&gt; s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (s.first.p.x &lt;= mesh.X[l] &amp;&amp; mesh.X[r] &lt;= s.first.q.x) &#123;</span><br><span class="line">            PtP::x = (mesh.X[l] + mesh.X[r])/<span class="number">2.0</span>;</span><br><span class="line">            u-&gt;segs.<span class="built_in">erase</span>(s);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (s.first.q.x &lt;= mesh.X[m])			<span class="built_in">remove</span>(u-&gt;lson, l, m, s);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s.first.p.x &gt;= mesh.X[m])	<span class="built_in">remove</span>(u-&gt;rson, m, r, s);</span><br><span class="line">        <span class="keyword">else</span>	<span class="built_in">remove</span>(u-&gt;lson, l, m, s), <span class="built_in">remove</span>(u-&gt;rson, m, r, s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; mbrh;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m, cmd, x, pos;</span><br><span class="line">    <span class="keyword">double</span> px, py;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    mesh.<span class="built_in">read</span>(n);</span><br><span class="line">    mlist.<span class="built_in">init</span>(), mbrh.<span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;cmd);</span><br><span class="line">        <span class="keyword">if</span> (cmd == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;pos);</span><br><span class="line">            mbrh.<span class="built_in">insert</span>(mlist.<span class="built_in">insert</span>(x, pos));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">            mbrh.<span class="built_in">remove</span>(mlist.<span class="built_in">remove</span>(x));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%lf %lf&quot;</span>, &amp;px, &amp;py);</span><br><span class="line">            <span class="built_in">puts</span>(mbrh.<span class="built_in">inside</span>(px, py) ? <span class="string">&quot;1&quot;</span> : <span class="string">&quot;0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
      
    </div>

  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/08/09/diary-201908/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          我們是否交會於一點
        
      </div>
    </a>
  
  
    <a href="/2019/01/27/diary-201901/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">敲落的聲響</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
          
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2021 Shiang-Yun Yang 
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  var disqus_url = 'http://morris821028.github.io/2019/02/16/zj-e021/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>