<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Morris&#39; Blog">
<meta property="og:url" content="http://morris821028.github.io/page/7/index.html">
<meta property="og:site_name" content="Morris&#39; Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris&#39; Blog">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
  <link rel="import" href="/bower_components/app-layout/app-layout.html"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          
          <section id="main">
  
    <article id="post-diary-201701-3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/17/diary-201701-3/" class="article-date">
  <time datetime="2017-01-17T07:22:35.000Z" itemprop="datePublished">2017-01-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/HgNRb8L.jpg" rel="gallery_ckkknaei00039o4vr2l03uu1p">
        <img src="http://i.imgur.com/HgNRb8L.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/17/diary-201701-3/">優化小插曲 上篇</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/01/17/diary-201701-3/" data-id="ckkknaei00039o4vr2l03uu1p" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/01/17/diary-201701-3/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="2016・冬・始"><a href="#2016・冬・始" class="headerlink" title="2016・冬・始"></a>2016・冬・始</h2><h2 id="想想論文"><a href="#想想論文" class="headerlink" title="想想論文"></a>想想論文</h2><h3 id="第一階段"><a href="#第一階段" class="headerlink" title="第一階段"></a>第一階段</h3><p>在學長的催促下，一時興起想個論文題目，加上所學的一些技巧來實作資料結構，再搭配資料加速的方式，就能在某些約束大小下灑亂數，沒有平行的版本就能比序列化版本快上一點，但平行版本並沒有想像中成正比地加速，一不小心就被 data layout 打到殘廢，被 imbalance 的問題搞死，沒弄好 scheduling 根本玩不下去。</p>
<p>論文可比想像中的困難多了，大多有用的技巧沒有理論，實務上的技術卻不被看好，對這個世界感到失望啊！</p>
<p><img src="http://i.imgur.com/IWIkttO.jpg" alt="「那可比想像中的困難多了」－ 斯特拉的魔法"></p>
<p>找了一篇別人寫的論文拿來平行，接著在平行處理根據現在的計算機架構設計。若沒有設計好資料結構和算法，效能遲遲無法引出來，有時還牽涉到實作成面的技巧，各方面都要顧及。</p>
<p>然而，實作總是不被看好的那一塊，大部分的論文都沒有提及或提供代碼，其他的論文到底可不可信？這一點深感疑惑啊！說不定早就錯得離譜，還一直誤導未來的讀者，當然我自己也不例外。至於如何解決這些問題，也許從一開始就是無解的題目呢。</p>
<p><img src="http://i.imgur.com/r3Wtkk8.jpg" alt="「從一開始就是無解的題目呢」 － 果然我的青春戀愛喜劇搞錯了。"></p>
<p>有一次大學長回實驗室，無聊問有沒有題目可以寫，於是拿了想要做的論文題目過去，三十分鐘就想到兩年前那篇論文怎麼做，再過三十分鐘的話我就不用做了，或許我們競賽時的題目，就是別人花費好幾個月所寫的論文結果。開始膽怯自己能力所寫的論文是多麼地無用。</p>
<p>儘管如此，著手實作論文再加上自己的算法設計，開始進行大量的優化探討，快還要再更快！如果寫不出教授滿意的論文，至少自己滿意就好。</p>
<h3 id="第二階段"><a href="#第二階段" class="headerlink" title="第二階段"></a>第二階段</h3><p>從沒想過會因為論文關連，再次翻起去年因可能沒畢業而著手的研究項目，降時間常數、降空間常數 … 等各種版本的實作。當初研究一點也不透徹，需求才是推動發展的主因！</p>
<p><img src="http://i.imgur.com/EA2cSVE.jpg" alt="「我真是半吊子吶」 － 3 月的獅子"></p>
<p>研究中使用位元壓縮技術，將二元樹的記憶體配置弄得更好，又不能失去原本的操作性質，又要支持高效平行操作。折騰了好幾天，終於在常理測資範圍下，空間壓縮近 4 倍，平行加持下改善 25% 效能。回過頭來看看自己做了什麼，怎麼想都覺得很變態。</p>
<p><img src="http://i.imgur.com/cdtOok6.jpg" alt="「啊！」－ 斯特拉的魔法"></p>
<h3 id="第三階段"><a href="#第三階段" class="headerlink" title="第三階段"></a>第三階段</h3><p>因為需求一週就看了三四篇論文，連續過了好幾週，嘗試抽絲剝繭找到能用的工具，論文也許就是炒大鍋菜，但沒人告訴你加什麼料最好，更沒有人告訴你炒出來的那盤菜是否已經有人做過，做過就不能發論文了，一切只能靠自己，感覺起來就像在賭博，指導教授不見得有空理你呢。</p>
<p>實作技巧發揮到極致時，讓我們結合所有理論吧！一切皆為 <span>$O(1)$</span><!-- Has MathJax --> ，在平行上也 <span>$O(1)$</span><!-- Has MathJax --> 給你看。在十一月時，這一切發展得並不順利，根據理論推導的實作效能並不好，是不是有哪個傢伙的論文寫壞掉了？</p>
<p><img src="http://i.imgur.com/JKtJ1Qz.jpg" alt="「一個個都這樣 氣死我了」－ WWW.WORKING!! 迷糊餐廳"></p>
<h2 id="實習工作"><a href="#實習工作" class="headerlink" title="實習工作"></a>實習工作</h2><h3 id="工作機會"><a href="#工作機會" class="headerlink" title="工作機會"></a>工作機會</h3><p>實習工作在完全不懂的電路設計自動化 Cadence 公司，每一個名詞基本上只有電機系畢業的學生懂，而我卻要在設計工具上撰寫客製化的功能，聽起來是多麼不可思議。實習的日子裡，同時在思考自己適合哪一類型的工作環境，是否能在這種大公司工作，還是小公司下工作快樂些。</p>
<p>那些沒上研究所的小夥伴都跑去找工作，而我卻在論文迷惘下找了份實習，體驗一下未來的工作和生活型態是否為所需。聽者小夥伴如此地抱怨：</p>
<blockquote>
<p>「快把我變成社畜！不，算我求你了」友人如此哀求道<br>「這種需求我從來沒見過！」</p>
</blockquote>
<p>某天早上六點收到一封信，看著英文的信封標題，想說一定是沒有分類成功的廣告信，社畜就這麼一如往常地去上班！等待編譯如此地漫長，打混之際來看封信 … “Google 面試邀請，下周可談”，基於各種因素，最後還是辭退了這次邀請，畢竟沒學歷沒英文，實在無法讓自己滿意地去面試工作。</p>
<p><img src="http://i.imgur.com/ho7ywHW.jpg" alt="「噓！」－ 吹響吧！上低音號"></p>
<p>有些人覺得我浪費面試機會，但我足夠認識自己無法滿足他們的需求，現在還不是時候。你們才是更有機會的不是嗎？你們都擁有我想要的部分。</p>
<blockquote>
<p>他們當時是藉由 Github 和 Blog 找到我的，努力經營自己的成果吧！總有一天，有人會因此欣賞你的。若沒有，就作為自己的最後一份驕傲吧！</p>
</blockquote>
<h3 id="工作環境"><a href="#工作環境" class="headerlink" title="工作環境"></a>工作環境</h3><p>主管總是很有耐心跟我解釋顧客的需求和工具使用。身為一個工程師，對產品完全不熟悉怎麼跑測試，每一個元件之間的數學關係，多對一還是一對多，英文名詞聽得霧煞煞，有些還牽涉到多形和壓縮索引的格式。</p>
<p>相比從家教學生那兒聽來的，在一般公司就得自己摸，摸不好還要被主管嫌，而主管只會加油打氣，一點方向和意見都不給，甚至還導向錯誤的發展方向。仔細想想，這兒的工作環境挺不錯的。更沒想到公司在月底會替我們新進員工買生日蛋糕慶生，被排到十一月員工的慶生，心中很納悶明明過了快一個月，遲遲無法反應過來。</p>
<blockquote>
<p>「生日禮物」遞上<br>「？？」<br>「來一下，來吃生日蛋糕」<br>「？？？」</p>
</blockquote>
<p><img src="http://i.imgur.com/OYFhMvH.jpg" alt="「不管怎麼看 都是有人想找我茬」－ 吹響吧！上低音號"></p>
<p>各個 Team 的成員和主管都有來，要求我們說些願望什麼的，對於咱這個肥宅而言，一夥人吃蛋糕的場景可說是零經驗，心中的小鹿都不知道消失到哪了。</p>
<hr>
<p>2016・冬・上・結束</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-diary-201701-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/17/diary-201701-2/" class="article-date">
  <time datetime="2017-01-17T02:19:40.000Z" itemprop="datePublished">2017-01-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/Eyx2uSD.jpg" rel="gallery_ckkknaehy0036o4vrn53pxdhv">
        <img src="http://i.imgur.com/Eyx2uSD.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/17/diary-201701-2/">轉折序曲</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/01/17/diary-201701-2/" data-id="ckkknaehy0036o4vrn53pxdhv" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/01/17/diary-201701-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="2016・秋・始"><a href="#2016・秋・始" class="headerlink" title="2016・秋・始"></a>2016・秋・始</h2><h2 id="雜務生活"><a href="#雜務生活" class="headerlink" title="雜務生活"></a>雜務生活</h2><p>上一屆的學長被拖到七月最後一天才口試結束，快八月底才送論文離開，實驗室雜務頓時落到身上來，心情非常複雜。離開的學長留了了一句話「不用擔心，你永遠有學長！」的確，當兵休學的學長們還不確定何時回來，目前還有數不出來幾屆的學長，前人所經歷的驚濤駭浪無法想像。</p>
<p>不過對我來說，在這一年內轉變好多，已經可以自己騎腳踏車去光華採購實驗室器材，從一個不出門買東西的肥宅是相當挑戰的。然而，決定要買什麼仍然非常非常困難的，目標求在各種約束條件下，能購入物品價值在未來可能所需的期望值最高，這問題在競賽中的約束相當多，用到現實生活中，連輸入都不給！</p>
<h2 id="助教生涯結束"><a href="#助教生涯結束" class="headerlink" title="助教生涯結束"></a>助教生涯結束</h2><p>起初，因為沒有人願意接 PF 課程助教，實驗室成員首先發難接下，當下也不確定其他助教的素質，還是暫時性地接下來。就算是簡單的 C 語言，也不會每個大學畢業都很熟悉，連我也是半吊子的，要教台灣第一學府的莘莘學子們，沒有能力也要有責任學會，壓力並不小。</p>
<p>開學初助教名單尚未決定前，打開信箱十封中有八封都是助教工作相關的，沒意外地，第三輪噩夢即將開始，當然，助教這裡沒有必過法寶，寄信詢問是沒用的。</p>
<p><img src="http://i.imgur.com/9BzRvd3.jpg" alt="「我給你加油」－ 這個美術社大有問題！"></p>
<p>當助教聽起來不錯，但自己的未來呢？心想論文連個底都沒有，覺得自己做什麼都是在逃避。按照普遍的流程來看，不少人題目決定好就陸續在剩餘兩學期慢慢做。</p>
<p>也許，很多朋友會說「去找指導教授討論看看」當然，我也這麼嘗試過，教授總是回「自己回去想想」我想研究是一個人的戰爭，不然就沒有研究能力吧？別以為老師總會給你方向。如果你遇到貴人給你指點，不妨多留點感恩的心吧。</p>
<p><img src="http://i.imgur.com/7WOw5Yc.jpg" alt="「完全無法溝通」－ 這個美術社大有問題！"></p>
<p>先不談論文內容要寫些什麼，對我來說用英文寫才是最大的難關，於是老師今年連課程小考題目描述都不寫，叫助教輪番用英文寫，每一週都要替學生寫小考題目，為了領區區的七千元，寫題目描述、生測資、提供解答一手包辦，處理學生雜務外，還得處理額外的系統維護和新功能加入。</p>
<p>用「學生本業是學習，不是賺錢！」安慰自己，花了兩三天寫好的英文描述，上陣前被 PF 全改掉，嫌我們描述複雜且沒邏輯順序，條列式描述全被改成好幾段的故事描述。我想學生們也很困惑，到底是來練英文的，還是來學寫程式的，條列式不是很容易編寫程式嗎？我自己認為，初學者在英文單詞對應邏輯判斷的 <strong> 邊界條件 </strong> 非常難適應。這些不是我追尋的理想，也不是我喜歡的交流學習方式，再加上有實習工作來找我，於是推辭掉了助教工作。</p>
<p><img src="http://i.imgur.com/xQS8LHC.jpg" alt="「我要推辭掉」－ 這個美術社大有問題！"></p>
<p>推辭掉助教工作後，在職班博班學長向我問道「要不要去他們公司實習，目前論文也沒有方向吧？」仔細想想，換點環境做事也許能找到些什麼，於是帶著零基礎的英文去了外商公司實習，對方不嫌棄我這一部分讓我好感動。每週花個兩天到公司上班，其餘日子就在實驗室處理雜務接電話，教教學弟如何寫 C。</p>
<p>然而，去公司實習的過程並不順利，指導教授 PF 向我要求走學校正常管道，心裡這麼想</p>
<blockquote>
<p>「什麼是正常管道呢？產學合作嗎？」<br>「透過產學合作計畫不知道要申請多久，而產學合作當作論文發展的一部分嗎？」<br>「去年看著產學合作的情況，又不給數據進行實驗，猜想數據情況寫論文，他們也不採用得到的理論」<br>「系辦轉發的徵學碩的實習生的公司徵人信都有，為什麼我就不能去外頭看看？」</p>
</blockquote>
<p>老師只回了我一句「這可能是違法的，你還有領實驗室計畫的薪水」當下的我非常不能理解，這是嫌我工作時數不夠？別的實驗室研究生不一定有薪水可領，那我也沒有一定要領的使命。與其擔心我不領實驗室薪水會餓死，先想想一個月六千連吃飯都不夠，還不能外出打工的道理都不能理解，又不是在台北有家住。都來台北讀書了，那一點點錢的約束還不如自由點更省錢。</p>
<p>結果，老師擔心我助教時數不夠 <strong>「助教簽退時間不能造假」</strong>，更問我 <strong>「當初找你來做什麼的？」</strong>，畢竟系統大部分是我寫的，不然學弟們又要花一個學期從零開始撰寫系統。回顧當時問助教意願時，我只回了「能不當嗎？」心情更加地複雜，為什麼用這樣的口吻反問我這些？</p>
<p><img src="http://i.imgur.com/9k3D1ud.jpg" alt="「明明『活著』才是最痛苦的」－ 橘色奇蹟"></p>
<p>最後，相信自己所做的事情沒有錯，向系辦申請助教離職手續。</p>
<h2 id="指導學弟"><a href="#指導學弟" class="headerlink" title="指導學弟"></a>指導學弟</h2><p>雖說沒有接任助教一職，看著碩一學弟們弄小考題目、出測試資料到編寫程式風格，經驗和見解沒有預期中的多，於是夜間指導碩一學弟寫程式、操作環境，講著怎麼寫比較好、比較不容易出 bug、要怎麼抓 bug，多設計某個算法可以更快。回頭一想，是不是太過嘮叨了？</p>
<p>可是我好想從討論中挖掘更多更好的想法啊，在上研究所的這一年裡，能討論的對象大部分都不是現實生活身邊的人，跟著網友們學習。現在，請帶著愚蠢的我前進吧！</p>
<p><img src="http://i.imgur.com/1kC3GcW.jpg" alt="「真說起來我自己都不清楚自己對什麼感興趣」－ 斯特拉的魔法"></p>
<p>本實驗室管理機器是最麻煩的，大部分的經歷中都不會有管理伺服器，出事解決的經驗更少，而我也是學長慢慢指導和自己投入大量時間才會一些。當然，剩餘這一年中要把伺服器交給學弟！</p>
<p>在某一夜中，看學弟順利裝了兩台 server，卻莫名其妙卡在第三台無法安裝，於是一個一個排除可能性。</p>
<blockquote>
<ol>
<li>發現無法讀取 USB 開機，重新燒錄後的結果，仍無法抓取，連燒錄軟體都讀不到。</li>
<li>拿 Live 檢查的 USB 隨身碟，BIOS 自動偵測 bootable 裝置一時還沒反應，開機在失敗好幾次才進入 Live，隨後又偵測不到。</li>
<li>拿新的 USB 隨身碟燒錄最新版 iso，停在特定檔案燒錄十幾分鐘未果。(看來是壞掉)</li>
<li>回頭拿舊的 USB 隨身碟燒相同的 iso，順利進入並成功安裝！</li>
</ol>
</blockquote>
<p>不玩啦！一直重複開機一個小時過去、兩個小時過去 … 壞了兩個 USB，開新的還有問題，人品差到不行。</p>
<p><img src="http://i.imgur.com/XJQTQPW.jpg" alt="「看吧 這個世界中哪裡都沒有你的容身之處」－ 3 月的獅子"></p>
<h2 id="與同學相聚"><a href="#與同學相聚" class="headerlink" title="與同學相聚"></a>與同學相聚</h2><p>在十月的某個周末，我們來了個高中數學組的小小聚會。不知不覺經歷了五、六年，同學們各個厲害，有當警察在賺錢、目標當老師的、更有著決定往更高學府鑽研的，每個人說著自己的目標和生活的那份自信，讓我好羨慕！只有我找不到其他要做的事情，就只是寫覺得有趣的程式，卻不知道如何賺錢以及人生的下一步在哪。</p>
<p><img src="http://i.imgur.com/H5HCk8t.jpg" alt="「找不到其他要做的事情」－ 3 月的獅子"></p>
<h2 id="網友軼事"><a href="#網友軼事" class="headerlink" title="網友軼事"></a>網友軼事</h2><p>在 2016 秋這個時候上映動畫《你的名字》，靠小夥伴們訂票，這是我們圖片幕後團隊久違的聚會。在去看之前，那些情人氣氛早就在各處醞釀，而我走在人群中會被嘲笑吧？</p>
<p><img src="http://i.imgur.com/sVgOZQu.jpg" alt="「我就是覺得 自己在人群會被嘲笑」－ 斯特拉的魔法"></p>
<p>平時我有玩線上遊戲〈楓之谷〉，有一位好友在國中時認識，在研究所的時候再次在網路上被搭話，才發現早在好幾年前就認識，談著談著，好像只有我記得那段日子的事情。常常會發現某些事情，我記得太過清楚，甚至連自己在娃娃車上誰推我去哪裡玩，買些什麼都記在腦海裡。</p>
<p>雖說是女網友，說特別也倒沒什麼，不過有男朋友的人還傳封訊息「走 我們一起去看」給我，當下的我還正在同一建築物參加表親的婚禮，而她還說著自己一個人去看電影的情況。後來還發現到，因碩二搬到學校附近住，她居然還住在附近，能推薦些吃的給我知道，生病時還能幫我找間診所。</p>
<blockquote>
<p>機緣可說是巧妙呢</p>
</blockquote>
<hr>
<p>2016・秋・結束</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-diary-20170116" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/16/diary-20170116/" class="article-date">
  <time datetime="2017-01-16T06:42:38.000Z" itemprop="datePublished">2017-01-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/KnsUvCG.jpg" rel="gallery_ckkknaei4003io4vrha5e4bvj">
        <img src="http://i.imgur.com/KnsUvCG.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/16/diary-20170116/">轉折前奏曲</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/01/16/diary-20170116/" data-id="ckkknaei4003io4vrha5e4bvj" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/01/16/diary-20170116/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="2016・夏・始"><a href="#2016・夏・始" class="headerlink" title="2016・夏・始"></a>2016・夏・始</h2><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>距離上次寫日記已經超過六個月，大學時期還能一個月寫一篇，一到研究所就沒辦法隨心所欲發揮。這也收到不少朋友抱怨到部落格怎停了，其一原因在於寫一篇耗費數個小時，想做的事情太多，不想做的事情更多，在這些事情交替之下，寫一篇看似有內容的文章變得相當困難，也許這就是逐漸步入社會吧！怪不得有些人一進公司工作，接著就音訊全無，不久的我也會這樣吧，能繼續耍廢打混的日子不多了。</p>
<p>雖說沒辦法耗費心思寫文章，但還會在 Facebook 上發動態，不用擔心，接著就讓我整理一下這幾個月的動態吧！</p>
<h2 id="想要追到"><a href="#想要追到" class="headerlink" title="想要追到"></a>想要追到</h2><p>拿著在高等編譯器學到的知識，針對以前運行效果不佳的資料結構進行優化，有著更快更好的目標，想要追求到妳的那份心情無法抑制。研究算法與寫題目，就像追妹子一樣困難，也可以選擇兩方，但咱的目標不多，先優化下去追，追不到再嘗試開平行追！別說我犯規，有時候需要點不折手段，你說是吧？</p>
<p>七月時 —— 加速 Delaunay 三角剖分計算，實作平行版本的前置作業，優化弄得萌萌哒停不下來。</p>
<p><img src="http://i.imgur.com/ceJfRQu.jpg" alt="「現在的我 不想讓這個後悔留到 10 年後一直殘留」- 橘色奇蹟"></p>
<h2 id="學長畢業潮"><a href="#學長畢業潮" class="headerlink" title="學長畢業潮"></a>學長畢業潮</h2><p>才隔了一年，學長接二連三地畢業、休學、換實驗室，不像當初大學可以擁有三年的學長，來一年就要準備接管實驗室的一些雜事，當一屆只有一個男生時，管機器之類的顯得孤單。有一次一個人扛著 2U 伺服器回來，裡頭硬碟和四張顯卡都插滿笨重處理器，才發現一旁的警告標語要求兩人協力安裝，頓時才發現大家都要離開這兒，剩下我這一個不堪用的傢伙。</p>
<p>在這難熬的碩一升碩二暑假，還能每天看得到大二同學認真刷題，維護機器不能停，又不時想著自己的未來在哪，論文又要寫些、做些什麼。儘管如此，熬過一年也突破當初在這裡的誓言，早在一年前，休學與離開一事充斥在腦海裡，若沒有各位的支持，說實在難以在這環境下活著。</p>
<p><img src="http://i.imgur.com/AUxleXs.jpg" alt="「謝謝你們 我現在又有勇氣了」－ ReLIFE"></p>
<h2 id="至強融核"><a href="#至強融核" class="headerlink" title="至強融核"></a>至強融核</h2><blockquote>
<p>想必每個人看到這中文翻譯名稱，都會覺得太酷了！</p>
</blockquote>
<p>暑假都在忙著裝 Xeon Phi (中文翻譯: 至強融核)，參考各個網站提供的資訊，在一些奇奇怪怪的環境下安裝，弄了好幾週才開始寫在別於 GPU 的環境上寫平行，最後看到 200 個核心同時運行，內心相當激動。至於，這些研究對於論文有沒有幫助又是另一回事，過度期待是不好的，畢竟買來的 Xeon Phi 版本屬於 Knights Corner (騎士號角)，直到 Knights Landing (騎士登陸) 才是比較能抗衡 GPU 的版本。感謝各方的幫助，才完成環境設定，這中間充滿了 BUG 啊！</p>
<blockquote>
<p>「各位看到、聽到、體驗到的 BUG 只不過是冰山一角，真的。」<br>「沒有 BUG 的改版就像我的女朋友，沒有存在過。」</p>
</blockquote>
<p><img src="http://i.imgur.com/1lJDwXq.jpg" alt="「今天要向大神告白」－ ReLIFE"></p>
<p>接著，當然要在還有學長的時候，嘗試把 Xeon Phi 弄上 OJ 上，讓我們好好地挑戰平行極限，看看不同的平行環境的極致效能。然而，評測方法不常被討論，這變得是只能由自己定義，除了這些外，運行模式也不好處理，因為屬於協處理器，也可以提供特殊的運行流程，心中總沒有一個底。至今，由於尚未需要實驗，又暫時擱淺一陣子，只有出出例題來玩玩，但編譯器本身就有所不同，能加入的暗示也不一定有相同行為，這些都是很困難的。</p>
<p><img src="http://i.imgur.com/baJSNye.jpg" alt="「就算遇到困難 只要有你在 我一定能努力活下去」－ Re: 從零開始的異世界"></p>
<h2 id="暑期外出"><a href="#暑期外出" class="headerlink" title="暑期外出"></a>暑期外出</h2><p>在這暑期的最後一波，小夥伴約我參加 COSCUP 2016，看到一堆 LLVM、一堆 js 以及非常非常多的 Pokemon Go，不少講者先讓附近站點灑花後才開始講，好讓大家不會太無聊。最大收穫是能在前端跑接近原生的 C/C++，會議提到的 emscripten 也許能來個前端 OJ，來個壯烈的分散架構吧！</p>
<p>這次會議應用周邊有一堆 hubot，這不得聯想先前亂搞的 AIML 和 live2D 初階應用，感覺有很多有趣的玩法。在大神們提到一堆網頁架構，需要將之前寫的整份砍掉才行，先破壞再創造，追求效能極致的道路。最後，活動收尾還是來個板橋高中桌遊團，在 Inker 的指引下，得知有一本《あなたの知らない超絶技巧プログラミングの世界》神書，讓你不只會 C，還會讓你成為魔法師！</p>
<p><img src="http://i.imgur.com/6O7Ndmo.jpg" alt="(✪ω✪) － 這個美術社大有問題！"></p>
<hr>
<p>2016・夏・結束</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-2017-facebook-hacker-cup-round-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/16/2017-facebook-hacker-cup-round-1/" class="article-date">
  <time datetime="2017-01-16T03:30:15.000Z" itemprop="datePublished">2017-01-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/16/2017-facebook-hacker-cup-round-1/">2017 Facebook Hacker Cup Round 1</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/01/16/2017-facebook-hacker-cup-round-1/" data-id="ckkknaegq000po4vrledfx721" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/01/16/2017-facebook-hacker-cup-round-1/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <blockquote>
<p>感謝小夥伴妮可、茵可熱情支援</p>
</blockquote>
<h2 id="Facebook-2017-Hacker-Cup-Round-1"><a href="#Facebook-2017-Hacker-Cup-Round-1" class="headerlink" title="Facebook 2017 Hacker Cup Round 1"></a>Facebook 2017 Hacker Cup Round 1</h2><h3 id="A-Pie-Progress"><a href="#A-Pie-Progress" class="headerlink" title="A. Pie Progress"></a>A. Pie Progress</h3><p>單身狗的 <span>$N$</span><!-- Has MathJax --> 天日子中 (娛樂性質翻譯)，每天晚餐想要一道點心派搭配。每天早晨決定到當地的餅舖採購，每天一定會生產 <span>$M$</span><!-- Has MathJax --> 派，每一種派的價格也有所不同，不用考慮派會壞掉的情況，預先庫存保留著吃。為防止不當商人購買數量過多，當天若購買 <span>$K$</span><!-- Has MathJax --> 個派，需要額外支付 <span>$K^2$</span><!-- Has MathJax --> 的交易手續費，請問採購花費最少為何。</p>
<p>明顯地，每一天的狀態就是採購了多少個派，得到狀態 <span>$\text{dp}[i][j]$</span><!-- Has MathJax --> 表示前 <span>$i$</span><!-- Has MathJax --> 天總共採購 <span>$j$</span><!-- Has MathJax --> 個餅，轉移過程中要保證數量足夠支付每一天，意即只對 <span>$i \le j$</span><!-- Has MathJax --> 進行轉移。每一天窮舉購買的數量，窮舉採購的花費時，勢必要先排序每塊派的價格，每次只挑選前幾個小的，時間複雜度 <span>$O(N^2 M)$</span><!-- Has MathJax --> 。</p>
<span>$$\begin{align*}
dp[i][j] = \left\{\begin{matrix}
0 &amp;&amp; i = 0\;, j = 0\\
\min(dp[i-1][j-k-1] + \text{SumC}[k] + (k+1)^2) &amp;&amp; i \le j \\
\infty &amp;&amp; \text{otherwise}
\end{matrix}\right.
\end{align*}$$</span><!-- Has MathJax -->
<h3 id="B-Fighting-the-Zombies"><a href="#B-Fighting-the-Zombies" class="headerlink" title="B. Fighting the Zombies"></a>B. Fighting the Zombies</h3><p>在 D&amp;D 遊戲，身為一個魔法師要消滅地圖上的殭屍們。一次操作有兩個步驟，第一步驟圈選任意半徑內的所有殭屍，不改變其相對位置將他們進行轉移，第二步驟選擇長寬為 <span>$R$</span><!-- Has MathJax --> 的方形內的所有殭屍，請問一次操作最多可以消滅多少殭屍。</p>
<p>從第二步驟中觀察到消滅的大小是固定的，因此圈選半徑會被約束在 <span>$R$</span><!-- Has MathJax --> 內，實際上也不用考慮圓，因為方形被包含在圓裏。最後，我們直接求第一步驟的所有方形情況，將內部的殭屍全部移除後，再窮舉一次方形範圍內部的其他殭屍，所有可能取最大值即可。時間複雜度 <span>$O(N^6)$</span><!-- Has MathJax --> 。由於 <span>$N \le 50$</span><!-- Has MathJax --> ，六分鐘內是可以容忍的。</p>
<h3 id="C-Manic-Moving"><a href="#C-Manic-Moving" class="headerlink" title="C. Manic Moving"></a>C. Manic Moving</h3><p>搬家公司在 <span>$N$</span><!-- Has MathJax --> 個城鎮之間服務，貨車司機打算用最小的油量花費依序完成公司給定 <span>$K$</span><!-- Has MathJax --> 個訂單。第 <span>$i$</span><!-- Has MathJax --> 名客戶要求從 <span>$S_i$</span><!-- Has MathJax --> 地搬到 <span>$D_i$</span><!-- Has MathJax --> ，貨車一次可以載運兩名客戶的量。根據訂單順序，先來的就要載貨，同理也要先卸貨。</p>
<p>從題目中發現對於順序要求非常嚴苛，定出每一階段的狀態 <span>$dp[i][j][2]$</span><!-- Has MathJax --> 表示完成前 <span>$i$</span><!-- Has MathJax --> 個訂單、最後停留位置在 <span>$j$</span><!-- Has MathJax --> 地，最後的 <code>[2]</code> 表示前一個階段是否已經卸貨。分成兩種方式討論，時間複雜度 <span>$O(KN)$</span><!-- Has MathJax --> 。</p>
<h3 id="D-Beach-Umbrellas"><a href="#D-Beach-Umbrellas" class="headerlink" title="D. Beach Umbrellas"></a>D. Beach Umbrellas</h3><p>有 <span>$N$</span><!-- Has MathJax --> 個人各自帶著半徑 <span>$R_i$</span><!-- Has MathJax --> 的降落傘，在海岸進行降落，岸上有 <span>$M$</span><!-- Has MathJax --> 個降落點，每個降落點間隔一公尺，請問有多少種降落方式使得他們不會碰撞。</p>
<p>從題目給的說明中，我們發現到左右兩側的降落點比較特別，因為他們的傘的一部份可能會落在 <span>$M$</span><!-- Has MathJax --> 點之外，因此考慮窮舉降落在左右側的所有方法數 <span>$N^2$</span><!-- Has MathJax --> ，若要計算固定左右兩側的方法數，可以使用重複組合 H 得到 (滿足 <span>$x_1 + x_2 + \cdots + x_n = Y$</span><!-- Has MathJax --> 且每個數皆為非負整數的方法數)。然而，這樣計算方法缺少順序，最後補上排列計數 <span>$(N-2)!$</span><!-- Has MathJax --> 。</p>
<p>來講講窮舉左右兩側之後怎麼算出方法數</p>
<ul>
<li>左右兩側分別為 <span>$R_i$</span><!-- Has MathJax --> 和 <span>$R_j$</span><!-- Has MathJax --> 的情況</li>
<li>海岸左寬度增加 <span>$R_i$</span><!-- Has MathJax -->，同理右寬度增加 <span>$R_j$</span><!-- Has MathJax --> </li>
<li>如此一來，左右變數的情況就能套用重複組合分配 <span>$N$</span><!-- Has MathJax --> 個變數，總和為 <span>$M + R_i + R_j$</span><!-- Has MathJax --> ，每個變數至少大於等於 <span>$R_i$</span><!-- Has MathJax --></li>
</ul>
<p>特別地，變數 <span>$M$</span><!-- Has MathJax --> 過大。在窮舉所有情況中，組合類型最多 <span>$2R$</span><!-- Has MathJax --> 種，而非 <span>$N^2$</span><!-- Has MathJax --> 種。計算量多到必須預先建表，每一個組合數 <span>$C^{M+?}_{N}$</span><!-- Has MathJax --> ，由於底數是固定的，利用區間滑動在 <span>$O(1)$</span><!-- Has MathJax --> 轉換 (需要乘法反元素支援)。預先建表的時間 <span>$O(R)$</span><!-- Has MathJax -->，窮舉部分 <span>$O(N^2 \log R)$</span><!-- Has MathJax --> 。</p>
<h3 id="Solution-A"><a href="#Solution-A" class="headerlink" title="Solution A"></a>Solution A</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="keyword">int</span> N, M;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;N, &amp;M);</div><div class="line">        <span class="keyword">int</span> dp[<span class="number">305</span>][<span class="number">305</span>] = &#123;&#125;;</div><div class="line">        <span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= N; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= N; j++)</div><div class="line">                dp[i][j] = INF;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="keyword">int</span> A[<span class="number">305</span>];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; M; j++)</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;A[j]);</div><div class="line">            sort(A, A+M);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>, sum = <span class="number">0</span>; j &lt; M; j++) &#123;</div><div class="line">                sum += A[j];</div><div class="line">                A[j] = sum;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; N; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (dp[i][j] == INF)</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; M &amp;&amp; k+j &lt;= N; k++) &#123;</div><div class="line">                    dp[i+<span class="number">1</span>][j+k+<span class="number">1</span>] = min(dp[i+<span class="number">1</span>][j+k+<span class="number">1</span>], dp[i][j] + A[k] + (k+<span class="number">1</span>)*(k+<span class="number">1</span>));</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt;= N; j++)</div><div class="line">                dp[i+<span class="number">1</span>][j] = min(dp[i+<span class="number">1</span>][j], dp[i][j]);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d: %d\n"</span>, ++cases, dp[N][N]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Solution-B"><a href="#Solution-B" class="headerlink" title="Solution B"></a>Solution B</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="keyword">int</span> N, R;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;N, &amp;R);</div><div class="line">        <span class="built_in">vector</span>&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; A;</div><div class="line">        <span class="built_in">set</span>&lt;<span class="keyword">int</span>&gt; SX, SY;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="keyword">int</span> x, y;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;x, &amp;y);</div><div class="line">            A.push_back(make_pair(x, y));</div><div class="line">            SX.insert(x), SY.insert(y);</div><div class="line">        &#125;</div><div class="line">        sort(A.begin(), A.end());</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> LX : SX) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> LY : SY) &#123;</div><div class="line">                <span class="keyword">int</span> cnt = <span class="number">0</span>;</div><div class="line">                <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; used(N, <span class="number">0</span>);</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">                    <span class="keyword">if</span> (A[i].first &gt;= LX &amp;&amp; A[i].first &lt;= LX+R</div><div class="line">                        &amp;&amp; A[i].second &gt;= LY &amp;&amp; A[i].second &lt;= LY+R)</div><div class="line">                    cnt++, used[i] = <span class="number">1</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> TX : SX) &#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">auto</span> TY: SY) &#123;</div><div class="line">                        <span class="keyword">int</span> dd = <span class="number">0</span>;</div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">                            <span class="keyword">if</span> (used[i])</div><div class="line">                                <span class="keyword">continue</span>;</div><div class="line">                            <span class="keyword">if</span> (A[i].first &gt;= TX &amp;&amp; A[i].first &lt;= TX+R</div><div class="line">                                &amp;&amp; A[i].second &gt;= TY &amp;&amp; A[i].second &lt;= TY+R)</div><div class="line">                                dd++;</div><div class="line">                        &#125;</div><div class="line">                        ret = max(ret, dd+cnt);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d: %d\n"</span>, ++cases, ret);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Solution-C"><a href="#Solution-C" class="headerlink" title="Solution C"></a>Solution C</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="keyword">int</span> N, M, K;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;N, &amp;M, &amp;K);</div><div class="line">        </div><div class="line">        <span class="keyword">long</span> <span class="keyword">long</span> g[<span class="number">105</span>][<span class="number">105</span>] = &#123;&#125;;</div><div class="line">        <span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span> INF = <span class="number">1L</span>L&lt;&lt;<span class="number">60</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= N; j++)</div><div class="line">                g[i][j] = INF;</div><div class="line">            g[i][i] = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; M; i++) &#123;</div><div class="line">            <span class="keyword">int</span> A, B;</div><div class="line">            <span class="keyword">long</span> <span class="keyword">long</span> G;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %lld"</span>, &amp;A, &amp;B, &amp;G);</div><div class="line">            g[A][B] = min(g[A][B], G);</div><div class="line">            g[B][A] = min(g[B][A], G);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= N; k++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= N; j++)</div><div class="line">                    g[i][j] = min(g[i][j], g[i][k]+g[k][j]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line"><span class="comment">//		for (int i = 1; i &lt;= N; i++) &#123;</span></div><div class="line"><span class="comment">//			for (int j = 1; j &lt;= N; j++)</span></div><div class="line"><span class="comment">//				printf("%lld ", g[i][j]);</span></div><div class="line"><span class="comment">//			puts("");</span></div><div class="line"><span class="comment">//		&#125;</span></div><div class="line">        </div><div class="line">        <span class="keyword">int</span> S[<span class="number">5005</span>], D[<span class="number">5005</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; K; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;S[i], &amp;D[i]);</div><div class="line">        <span class="keyword">static</span> <span class="keyword">long</span> <span class="keyword">long</span> dp[<span class="number">5005</span>][<span class="number">105</span>][<span class="number">2</span>] = &#123;&#125;;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= K; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= N; j++)</div><div class="line">                dp[i][j][<span class="number">0</span>] = INF, dp[i][j][<span class="number">1</span>] = INF;;</div><div class="line">        &#125;</div><div class="line">        dp[<span class="number">0</span>][<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; K; i++) &#123;</div><div class="line">            <span class="keyword">int</span> s1 = S[i], d1 = D[i];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= N; j++) &#123;</div><div class="line">                <span class="keyword">long</span> <span class="keyword">long</span> cc;</div><div class="line">                cc = g[j][s1]+g[s1][d1];</div><div class="line">                dp[i+<span class="number">1</span>][d1][<span class="number">0</span>] = min(dp[i+<span class="number">1</span>][d1][<span class="number">0</span>], dp[i][j][<span class="number">0</span>] + cc);</div><div class="line">                cc = g[j][s1];</div><div class="line">                dp[i+<span class="number">1</span>][s1][<span class="number">1</span>] = min(dp[i+<span class="number">1</span>][s1][<span class="number">1</span>], dp[i][j][<span class="number">0</span>] + cc);</div><div class="line">                </div><div class="line">                <span class="keyword">if</span> (dp[i][j][<span class="number">1</span>] != INF &amp;&amp; i &gt; <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">int</span> sP = S[i<span class="number">-1</span>], dP = D[i<span class="number">-1</span>];</div><div class="line">                    cc = g[j][s1]+g[s1][dP];</div><div class="line">                    dp[i+<span class="number">1</span>][dP][<span class="number">1</span>] = min(dp[i+<span class="number">1</span>][dP][<span class="number">1</span>], dp[i][j][<span class="number">1</span>] + cc);</div><div class="line">                    cc = g[j][s1]+g[s1][dP]+g[dP][d1];</div><div class="line">                    dp[i+<span class="number">1</span>][d1][<span class="number">0</span>] = min(dp[i+<span class="number">1</span>][d1][<span class="number">0</span>], dp[i][j][<span class="number">1</span>] + cc);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line"><span class="comment">//			for (int j = 1; j &lt;= N; j++)</span></div><div class="line"><span class="comment">//				printf("%lld ", dp[i+1][j][0]);</span></div><div class="line"><span class="comment">//			puts("");</span></div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">-1</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (dp[K][i][<span class="number">0</span>] != INF)</div><div class="line">                ret = max(ret, dp[K][i][<span class="number">0</span>]);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d: %lld\n"</span>, ++cases, ret);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Solution-D"><a href="#Solution-D" class="headerlink" title="Solution D"></a>Solution D</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span> MOD = <span class="number">1000000007L</span>L;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">exgcd</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x, <span class="keyword">long</span> <span class="keyword">long</span> y, <span class="keyword">long</span> <span class="keyword">long</span> &amp;g, </span></span></div><div class="line"><span class="function"><span class="params">	<span class="keyword">long</span> <span class="keyword">long</span> &amp;a, <span class="keyword">long</span> <span class="keyword">long</span> &amp;b)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (y == <span class="number">0</span>)</div><div class="line">        g = x, a = <span class="number">1</span>, b = <span class="number">0</span>;</div><div class="line">    <span class="keyword">else</span></div><div class="line">        exgcd(y, x%y, g, b, a), b -= (x/y) * a;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">inverse</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x, <span class="keyword">long</span> <span class="keyword">long</span> p)</span> </span>&#123;</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> g, b, r;</div><div class="line">    exgcd(x, p, g, r, b);</div><div class="line">    <span class="keyword">if</span> (g &lt; <span class="number">0</span>)	r = -r;</div><div class="line">    <span class="keyword">return</span> (r%p + p)%p;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="keyword">int</span> N, M, R[<span class="number">2048</span>], S = <span class="number">0</span>, mxR = <span class="number">0</span>;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;N, &amp;M);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;R[i]), S += R[i], mxR = max(mxR, R[i]);</div><div class="line">        <span class="keyword">if</span> (N == <span class="number">1</span>) &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Case #%d: %lld\n"</span>, ++cases, M);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"%d %d %d\n"</span>, N, S, M);</div><div class="line">        <span class="keyword">long</span> <span class="keyword">long</span> invNplus = <span class="number">1</span>;</div><div class="line">        <span class="built_in">map</span>&lt;<span class="keyword">long</span> <span class="keyword">long</span>, <span class="keyword">long</span> <span class="keyword">long</span>&gt; C;</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">long</span> <span class="keyword">long</span> f = <span class="number">1</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++)</div><div class="line">                f = (f * i)%MOD;</div><div class="line">            invNplus = inverse(f, MOD);</div><div class="line">            </div><div class="line">            <span class="keyword">int</span> l = <span class="number">1</span>, r = <span class="number">1</span>;</div><div class="line">            f = <span class="number">1</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = M - <span class="number">2</span>*S; i &lt;= M - <span class="number">2</span>*S + <span class="number">2</span>*mxR; i++) &#123;</div><div class="line">                <span class="keyword">int</span> tM = i+N<span class="number">-1</span>;</div><div class="line">                <span class="keyword">if</span> (tM &lt; N)</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">int</span> L = tM-N+<span class="number">1</span>, R = tM;</div><div class="line">                <span class="keyword">if</span> (r &lt; L)</div><div class="line">                    l = r = f = L;</div><div class="line">                <span class="keyword">while</span> (l &lt; L)</div><div class="line">                    f = (f*inverse(l, MOD))%MOD, l++;</div><div class="line">                <span class="keyword">while</span> (r &lt; R)</div><div class="line">                    r++, f = (f * r)%MOD;</div><div class="line">                C[tM] = (f * invNplus)%MOD;</div><div class="line"><span class="comment">//				printf("C(%lld %d) = %lld, %lld\n", tM, N, C[tM], f);</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; N; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (i == j)</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">int</span> tM = M + R[i] + R[j] - <span class="number">2</span>*S;</div><div class="line">                <span class="keyword">if</span> (tM+N<span class="number">-1</span> &lt; N)</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line"><span class="comment">//				printf("add C(%d %d)\n", tM+N-1, N);</span></div><div class="line">                ret += C[tM+N<span class="number">-1</span>];</div><div class="line">                ret %= MOD;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">long</span> <span class="keyword">long</span> f = <span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N<span class="number">-2</span>; i++)</div><div class="line">            f = (f * i)%MOD;</div><div class="line">        ret = ret * f;</div><div class="line">        ret %= MOD;</div><div class="line">        assert(ret &gt;= <span class="number">0</span>);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d: %lld\n"</span>, ++cases, ret);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-2017-facebook-hacker-cup-qualification" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/16/2017-facebook-hacker-cup-qualification/" class="article-date">
  <time datetime="2017-01-16T02:23:56.000Z" itemprop="datePublished">2017-01-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/16/2017-facebook-hacker-cup-qualification/">2017 Facebook Hacker Cup 資格賽</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/01/16/2017-facebook-hacker-cup-qualification/" data-id="ckkknaegp000no4vrqavuzq74" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/01/16/2017-facebook-hacker-cup-qualification/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <blockquote>
<p>原本只是想推碩一學弟去寫，學弟邀著邀著，我這個老骨頭只好跟著寫</p>
</blockquote>
<h2 id="Facebook-Hacker-Cup-2017-Qualification-Round"><a href="#Facebook-Hacker-Cup-2017-Qualification-Round" class="headerlink" title="Facebook Hacker Cup 2017 Qualification Round"></a>Facebook Hacker Cup 2017 Qualification Round</h2><h3 id="A-Progress-Pie"><a href="#A-Progress-Pie" class="headerlink" title="A. Progress Pie"></a>A. Progress Pie</h3><p>給一個落在 <span>$(0, 0)\; , (100, 100)$</span><!-- Has MathJax --> 矩形內部的圓餅圖，並且從垂直十二點方向開始，順時針繞一圈 <span>$P \%$</span><!-- Has MathJax --> ，又額外給一座標，請問該點是黑色還是白色，並且保證任何一組詢問點，鄰近 <span>$10^{-6}$</span><!-- Has MathJax --> 都屬於相同顏色。</p>
<p>從最後一個條件來看，我們處理邊界條件的誤差是可以容忍的。由於輸入都是整數，完全在整數上操作的部分尚未想到，但我們可以透過內積外積得到詢問點是順時針轉了 <span>$R, \; 0 \le R &lt; 2 \pi$</span><!-- Has MathJax --> ，只需要判斷 <span>$R$</span><!-- Has MathJax --> 是否小於等於 <span>$P$</span><!-- Has MathJax --> 即可。</p>
<p>十二點鐘的方向向量為 <span>$\vec{v} = (0, 50)$</span><!-- Has MathJax --> ，詢問點與圓心的向量為 <span>$\vec{u} = (X-50, Y-50)$</span><!-- Has MathJax --> ，計算這兩個向量的夾角 <span>$\theta = \cos^{-1}(\frac{u \cdot v}{|u| |v|})$</span><!-- Has MathJax --> ，這樣算出來的角度只會落在 <span>$[0, \pi)$</span><!-- Has MathJax --> ，接著透過外積決定順時針還是逆時針，補回來即可。</p>
<h3 id="B-Lazy-Loading"><a href="#B-Lazy-Loading" class="headerlink" title="B. Lazy Loading"></a>B. Lazy Loading</h3><p>搬家公司的工人要搬運 <span>$N$</span><!-- Has MathJax --> 個重量不同的傢俱，主管要求每次搬運至少 50 磅，工人為了偷懶，每次只搬運一部份的傢俱，然而主管不會準確計算工人搬運的總重，只會問一次搬運的最大重量和個數，工人想藉由分配方法來增加工作天數，請問要怎麼符合需求達到最多搬運天數。</p>
<p>可想而知，我們只需要貪心計算即可，每次挑選最重的那一個，接著搭配當前最輕的來湊數，一超過 50 磅就當作一天的搬運方案，直到沒有物品。一開始排序好 <span>$O(N \log N)$</span><!-- Has MathJax --> ，接著只需要掃描一次 <span>$O(N)$</span><!-- Has MathJax --> 即可完成。</p>
<h3 id="C-Fighting-the-Zombie"><a href="#C-Fighting-the-Zombie" class="headerlink" title="C. Fighting the Zombie"></a>C. Fighting the Zombie</h3><p>在 D&amp;D 遊戲中，我們需要施放技能攻擊血量為 <span>$H$</span><!-- Has MathJax --> 的殭屍，施放採用擲骰子的方式，骰一個 <span>$Y$</span><!-- Has MathJax --> 面骰 <span>$X$</span><!-- Has MathJax --> 次得到的點數總和加上固定值 <span>$Z$</span><!-- Has MathJax --> ，請問一擊必殺的機率最高為何，由於盤面上有許多骰子可以挑選，請輸出機率最高的那個骰子的機率為何。</p>
<p>首先，我們必須先瞭解最基礎的六面骰，投擲 <span>$X$</span><!-- Has MathJax --> 總和的方法數怎麼計算，定義 <span>$\text{dp}[i][j]$</span><!-- Has MathJax --> 表示投擲 <span>$i$</span><!-- Has MathJax --> 次，點數總和為 <span>$j$</span><!-- Has MathJax --> 的方法數。我們得到</p>
<span>$$\begin{align*}
dp[i][j] = \left\{\begin{matrix}
1 &amp;&amp; i = 0\;, j = 0\\
dp[i-1][j-1] + dp[i-1][j-2] + \cdots + dp[i-1][j-6] &amp;&amp; i \le j \\
0 &amp;&amp; \text{otherwise}
\end{matrix}\right.
\end{align*}$$</span><!-- Has MathJax -->
<p>上述的遞迴考慮 <span>$i-1$</span><!-- Has MathJax --> 個骰子的總和方法數，再決定第 <span>$i$</span><!-- Has MathJax --> 個骰子擲出哪一種點數。然而，這種方法不適用此題計算機率，很容易發生 overflow，方法數的總和為 <span>$Y^X$</span><!-- Has MathJax --> ，所以一開始我們就採用機率的方式統計。</p>
<span>$$\begin{align*}
dp[i][j] = \left\{\begin{matrix}
1 &amp;&amp; i = 0\;, j = 0\\
(dp[i-1][j-1] + dp[i-1][j-2] + \cdots + dp[i-1][j-6])/6 &amp;&amp; i \le j \\
0 &amp;&amp; \text{otherwise}
\end{matrix}\right.
\end{align*}$$</span><!-- Has MathJax -->
<p>這樣的 DP 計算消耗時間 <span>$O(X^2 Y^2)$</span><!-- Has MathJax --> ，加上滑動窗口統計總和則可以落在 <span>$O(X^2 Y)$</span><!-- Has MathJax --> 。</p>
<blockquote>
<p>比賽當下寫的，思路不是很清楚，變數命名和邏輯判斷會有點醜，沒有好好整理。</p>
</blockquote>
<h3 id="Solution-A"><a href="#Solution-A" class="headerlink" title="Solution A"></a>Solution A</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-8</span>;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">double</span> pi = <span class="built_in">acos</span>(<span class="number">-1</span>);</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="keyword">int</span> P, X, Y;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;P, &amp;X, &amp;Y);</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (X == <span class="number">50</span> &amp;&amp; Y == <span class="number">50</span>) &#123;</div><div class="line">            ret = <span class="number">1</span>;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hypot(X<span class="number">-50</span>, Y<span class="number">-50</span>) &gt; <span class="number">50</span>) &#123;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (P == <span class="number">100</span>) &#123;</div><div class="line">            ret = <span class="number">1</span>;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (P == <span class="number">0</span>) &#123;</div><div class="line">            </div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">int</span> vx = X<span class="number">-50</span>, vy = Y<span class="number">-50</span>;</div><div class="line">            <span class="keyword">int</span> tx = <span class="number">0</span>, ty = <span class="number">50</span>;</div><div class="line">            <span class="keyword">double</span> theta = <span class="built_in">acos</span>((vx*tx+vy*ty)/hypot(vx, vy)/hypot(tx, ty));</div><div class="line">            <span class="keyword">if</span> (tx*vy - ty*vx &gt; <span class="number">0</span>)</div><div class="line">                theta = <span class="number">2</span>*pi-theta;</div><div class="line">            <span class="keyword">double</span> t = (<span class="keyword">double</span>) P/<span class="number">100.0</span>*<span class="number">2</span>*pi;</div><div class="line">            <span class="keyword">if</span> (theta &lt;= t)</div><div class="line">                ret = <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d: %s\n"</span>, ++cases, ret ? <span class="string">"black"</span> : <span class="string">"white"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Solution-B"><a href="#Solution-B" class="headerlink" title="Solution B"></a>Solution B</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="keyword">int</span> n;</div><div class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; A;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            <span class="keyword">int</span> x;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x);</div><div class="line">            A.push_back(x);</div><div class="line">        &#125;</div><div class="line">        sort(A.begin(), A.end());</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> r = n<span class="number">-1</span>, l = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (r &gt;= l) &#123;</div><div class="line">            <span class="keyword">int</span> need = ((<span class="number">50</span> + A[r]<span class="number">-1</span>) / A[r]);</div><div class="line">            <span class="keyword">if</span> (l + need<span class="number">-1</span> &gt; r)</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            l += need<span class="number">-1</span>, r--;</div><div class="line">            ret++;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d: %d\n"</span>, ++cases, ret);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Solution-C"><a href="#Solution-C" class="headerlink" title="Solution C"></a>Solution C</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="keyword">int</span> H, S;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;H, &amp;S);</div><div class="line">        <span class="built_in">vector</span>&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; A;</div><div class="line">        <span class="keyword">double</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; S; i++) &#123;</div><div class="line">            <span class="keyword">char</span> s[<span class="number">128</span>];</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>, s);</div><div class="line">            <span class="keyword">int</span> X = <span class="number">0</span>, Y = <span class="number">0</span>, Z = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>, x = <span class="number">0</span>, sign = <span class="number">1</span>, idx = <span class="number">0</span>; s[j]; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (<span class="built_in">isdigit</span>(s[j]))</div><div class="line">                    x = x * <span class="number">10</span> + s[j] - <span class="string">'0'</span>;</div><div class="line">                <span class="keyword">if</span> (s[j+<span class="number">1</span>] == <span class="string">'\0'</span> || !<span class="built_in">isdigit</span>(s[j])) &#123;</div><div class="line">                    x = x * sign;</div><div class="line">                    <span class="keyword">if</span> (idx == <span class="number">0</span>)</div><div class="line">                        X = x;</div><div class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (idx == <span class="number">1</span>)</div><div class="line">                        Y = x;</div><div class="line">                    <span class="keyword">else</span></div><div class="line">                        Z = x;</div><div class="line">                    <span class="keyword">if</span> (s[j] == <span class="string">'-'</span>)</div><div class="line">                        sign = <span class="number">-1</span>;</div><div class="line">                    <span class="keyword">else</span></div><div class="line">                        sign = <span class="number">1</span>;</div><div class="line">                    x = <span class="number">0</span>, idx++;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">int</span> l = X+Z, r = X*Y+Z;</div><div class="line">            <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> OFF = <span class="number">1024</span>;</div><div class="line">            <span class="keyword">static</span> <span class="keyword">double</span> dp[<span class="number">2</span>][OFF];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; OFF; i++)</div><div class="line">                dp[<span class="number">0</span>][i] = dp[<span class="number">1</span>][i] = <span class="number">0</span>;</div><div class="line">            dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; X; i++) &#123;</div><div class="line">                <span class="keyword">int</span> p = i&amp;<span class="number">1</span>, q = i&amp;<span class="number">1</span>^<span class="number">1</span>;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; OFF; j++)</div><div class="line">                    dp[q][j] = <span class="number">0</span>;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; OFF; j++) &#123;</div><div class="line">                    <span class="keyword">if</span> (dp[p][j] &lt;= <span class="number">0</span>)	<span class="keyword">continue</span>;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= Y; k++)</div><div class="line">                        dp[q][j+k] += dp[p][j]*((<span class="keyword">double</span>) <span class="number">1.f</span>/Y);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">double</span> sum = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= X*Y; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (j+Z &gt;= H)</div><div class="line">                    sum += dp[(X<span class="number">-1</span>)&amp;<span class="number">1</span>^<span class="number">1</span>][j];</div><div class="line">            &#125;</div><div class="line">            ret = max(ret, sum);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d: %.6lf\n"</span>,++cases, ret);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-20008" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/18/jg-20008/" class="article-date">
  <time datetime="2016-12-18T03:14:07.000Z" itemprop="datePublished">2016-12-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/出題解題/">出題解題</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/18/jg-20008/">淺談多重背包問題 (Multiple Knapsack Problem) 優化那些事</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/12/18/jg-20008/" data-id="ckkknaelc009jo4vroxwv0cwl" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/12/18/jg-20008/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DP/">DP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/monotone-queue/">monotone queue</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/優化/">優化</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/單調堆/">單調堆</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/背包問題/">背包問題</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <blockquote>
<p>收錄於 <a href="https://judgegirl.csie.org/problem/0/20008" target="_blank" rel="external">批改娘 20008. Fast Multiple Knapsack Problem</a></p>
<p>之所以出了這一題，源自於實驗室另一名同學跑實驗太久，進而撰寫優化程序。聽說原本跑了十分鐘的實驗，改善後提升了到一分鐘跑完。</p>
</blockquote>
<h2 id="輸入格式"><a href="#輸入格式" class="headerlink" title="輸入格式"></a>輸入格式</h2><p>每組測資第一行包含兩個正整數，分別代表背包大小 $M$ ($\leq 10^6$) 和物品個數 $N$ ($\leq 1000$)，下一行開始每行包含兩個正整數，分別代表物品價值 $P_i$ ($\leq 10^3$)、物品重量 $W_i$ ($ \leq 10^5$) 以及物品最多可以挑 $C_i$ 個 ($\le 100$)。</p>
<h2 id="輸出格式"><a href="#輸出格式" class="headerlink" title="輸出格式"></a>輸出格式</h2><p>對於每組測資，請輸出最大收益。</p>
<h2 id="範例輸入-1"><a href="#範例輸入-1" class="headerlink" title="範例輸入 1"></a>範例輸入 1</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">50 7</div><div class="line">66 31 1</div><div class="line">232 10 4</div><div class="line">49 20 1</div><div class="line">54 19 1</div><div class="line">426 4 3</div><div class="line">589 3 10</div><div class="line">10 6 4</div></pre></td></tr></table></figure>
<h2 id="範例輸出-1"><a href="#範例輸出-1" class="headerlink" title="範例輸出 1"></a>範例輸出 1</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">7178</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><blockquote>
<p>不管是 0/1 背包或者多重背包，兩者都屬於 bounded knapsack problem 問題。即便如此，優化上仍有些許的不同，請讓我緩緩道來。</p>
</blockquote>
<p>在此之前，您必須先理解上一篇《淺談背包問題 (0/1 Knapsack Problem) 優化那些事》的部分，不然會造成閱讀上的困難。</p>
<p>多重背包有一個二進制優化，也就是當物品限制最多拿 <span>$C$</span><!-- Has MathJax --> 個時，我們可以利用二進制組合的方式，轉換到 0/1 背包問題，因此我們會得到新的 <span>$N \log C$</span><!-- Has MathJax --> 個物品跑一次 0/1 背包，因此複雜度落在 <span>$O(N \log C \; W)$</span><!-- Has MathJax --> </p>
<p>然而，從公式定義上，在好幾年前的論文中，使用斜率優化降到 <span>$O(N \; W)$</span><!-- Has MathJax -->，推倒過程如下，</p>
<span>$j = k \; w_i + r, \; 0 \le r \le w_i - 1$</span><!-- Has MathJax -->
<span>$$\begin{align*}
dp[i][j] &amp;= \max\left\{dp[i-1][j], dp[i-1][j-w_i]+p_i, \cdots, dp[i-1][j-c_i \; w_i] + c_i \; p_i\right\} \\
&Tab;&amp;= \max\left\{dp[i-1][k \; w_i + r], dp[i-1][(k-1) \; w_i + r] + p_i, \cdots
&Tab;&Tab;, dp[i-1][(k-c_i) \; w_i + r] + c_i p_i\right\} \\
&Tab;&amp;= \max\left\{dp[i-1][k \; w_i + r] - k \; p_i, dp[i-1][(k-1) \; w_i + r] + (k-1) \; p_i, \cdots
&Tab;&Tab;, dp[i-1][(k-c_i) \; w_i + r] - (k-c_i) p_i\right\} + k \; p_i\\
\end{align*}$$</span><!-- Has MathJax -->
<p>隨著式子的轉移，我們發現每一個取值將不依賴相對位置，只跟自身的位置有關，那麼可以使用單調堆 (monotone queue) 運行 <span>$O(1)$</span><!-- Has MathJax --> 的 sliding windows 查找極值。最後，將相同餘數分堆處理，單調堆中最多存在 <span>$O(c)$</span><!-- Has MathJax --> 個元素。</p>
<h3 id="優化初夜"><a href="#優化初夜" class="headerlink" title="優化初夜"></a>優化初夜</h3><blockquote>
<p>如果只使用二進制優化，套上我們的 0/1 優化方案，將有大幅度地提升。</p>
</blockquote>
<p>加入 0/1 背包的優化策略，再套上最簡單的斜率優化算法，得到下面的程式。這裡很懶惰地，由於單調堆最多入隊 <span>$W$</span><!-- Has MathJax --> 次，不外乎地直接只用大小為 <span>$W$</span><!-- Has MathJax --> 的方式實作。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> &#123;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXW = <span class="number">1000005</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1005</span>;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BB</span> &#123;</span></div><div class="line">        <span class="keyword">int</span> w, v, c;</div><div class="line">        BB(<span class="keyword">int</span> w = <span class="number">0</span>, <span class="keyword">int</span> v = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>):</div><div class="line">            w(w), v(v), c(c) &#123;&#125;</div><div class="line">        <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> BB &amp;x) <span class="keyword">const</span> &#123;</div><div class="line">            <span class="keyword">return</span> w * c  &lt; x.w * x.c;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(BB A[], <span class="keyword">int</span> dp[], <span class="keyword">int</span> W, <span class="keyword">int</span> N)</span> </span>&#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">int</span> MQ[MAXW][<span class="number">2</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="keyword">int</span> w = A[i].w, v = A[i].v, c = A[i].c;</div><div class="line">            sum = min(sum + w*c, W);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; w; j++) &#123;</div><div class="line">                <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>;</div><div class="line">                MQ[l][<span class="number">0</span>] = <span class="number">0</span>, MQ[l][<span class="number">1</span>] = dp[j];</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k*w+j &lt;= sum; k++) &#123;</div><div class="line">                    <span class="keyword">if</span> (k - MQ[l][<span class="number">0</span>] &gt; c)	</div><div class="line">                        l++;</div><div class="line">                    <span class="keyword">int</span> dpv = dp[k*w+j] - k*v;</div><div class="line">                    <span class="keyword">while</span> (l &lt;= r &amp;&amp; MQ[r][<span class="number">1</span>] &lt;= dpv)</div><div class="line">                        r--;</div><div class="line">                    r++;</div><div class="line">                    MQ[r][<span class="number">0</span>] = k, MQ[r][<span class="number">1</span>] = dpv;</div><div class="line">                    dp[k*w+j] = max(dp[k*w+j], MQ[l][<span class="number">1</span>] + k*v);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;	</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">knapsack</span><span class="params">(<span class="keyword">int</span> C[][<span class="number">3</span>], <span class="keyword">int</span> N, <span class="keyword">int</span> W)</span> </span>&#123;</div><div class="line">        <span class="built_in">vector</span>&lt;BB&gt; A;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="keyword">int</span> w = C[i][<span class="number">0</span>], v = C[i][<span class="number">1</span>], c = C[i][<span class="number">2</span>];</div><div class="line">            A.push_back(BB(w, v, c));</div><div class="line">        &#125;</div><div class="line">        assert(N &lt; MAXN);</div><div class="line">        <span class="keyword">static</span> <span class="keyword">int</span> dp1[MAXW+<span class="number">1</span>], dp2[MAXW+<span class="number">1</span>];</div><div class="line">        BB Ar[<span class="number">2</span>][MAXN];</div><div class="line">        <span class="keyword">int</span> ArN[<span class="number">2</span>] = &#123;&#125;;</div><div class="line">        <span class="built_in">memset</span>(dp1, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp1[<span class="number">0</span>])*(W+<span class="number">1</span>));</div><div class="line">        <span class="built_in">memset</span>(dp2, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp2[<span class="number">0</span>])*(W+<span class="number">1</span>));</div><div class="line">        sort(A.begin(), A.end());</div><div class="line">        <span class="keyword">int</span> sum[<span class="number">2</span>] = &#123;&#125;;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="keyword">int</span> ch = sum[<span class="number">1</span>] &lt; sum[<span class="number">0</span>];</div><div class="line">            Ar[ch][ArN[ch]] = A[i];</div><div class="line">            ArN[ch]++;</div><div class="line">            sum[ch] = min(sum[ch] + A[i].w*A[i].c, W);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        run(Ar[<span class="number">0</span>], dp1, W, ArN[<span class="number">0</span>]);</div><div class="line">        run(Ar[<span class="number">1</span>], dp2, W, ArN[<span class="number">1</span>]);</div><div class="line"></div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = W, mx = <span class="number">0</span>; i &lt;= W; i++, j--) &#123;</div><div class="line">            mx = max(mx, dp2[i]);</div><div class="line">            ret = max(ret, dp1[j] + mx);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> W, N;</div><div class="line">    assert(<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;W, &amp;N) == <span class="number">2</span>);</div><div class="line">    <span class="keyword">int</span> C[MAXN][<span class="number">3</span>];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</div><div class="line">        assert(<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;C[i][<span class="number">1</span>], &amp;C[i][<span class="number">0</span>], &amp;C[i][<span class="number">2</span>]) == <span class="number">3</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, knapsack(C, N, W));</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>不幸地，相較於一般的斜率優化寫法，並沒有太大的改善。</p>
<h3 id="優化二夜"><a href="#優化二夜" class="headerlink" title="優化二夜"></a>優化二夜</h3><p>運行 sliding windows 操作時，前 <span>$c$</span><!-- Has MathJax --> 次，是不會進行 <code>pop_front()</code> 操作的，因此把迴圈分兩堆處理，增加 branch predict。以及在乘數運算上，使用強度減少 (strength reduction) 的技術，將乘法換成加法。</p>
<blockquote>
<p>只能些許地改善 5% 的效能。</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(BB A[], <span class="keyword">int</span> dp[], <span class="keyword">int</span> W, <span class="keyword">int</span> N)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> MQ[MAXW][<span class="number">2</span>];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">        <span class="keyword">int</span> w = A[i].w, v = A[i].v, c = A[i].c;</div><div class="line">        sum = min(sum + w*c, W);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; w; j++) &#123;</div><div class="line">            <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>;</div><div class="line">            MQ[l][<span class="number">0</span>] = <span class="number">0</span>, MQ[l][<span class="number">1</span>] = dp[j];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>, tw = w+j, tv = v; tw &lt;= sum &amp;&amp; k &lt;= c; k++, tw += w, tv += v) &#123;</div><div class="line">                <span class="keyword">int</span> dpv = dp[tw] - tv;</div><div class="line">                <span class="keyword">while</span> (l &lt;= r &amp;&amp; MQ[r][<span class="number">1</span>] &lt;= dpv)</div><div class="line">                    r--;</div><div class="line">                r++;</div><div class="line">                MQ[r][<span class="number">0</span>] = k, MQ[r][<span class="number">1</span>] = dpv;</div><div class="line">                dp[tw] = max(dp[tw], MQ[l][<span class="number">1</span>] + tv);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = c+<span class="number">1</span>, tw = (c+<span class="number">1</span>)*w+j, tv = (c+<span class="number">1</span>)*v; tw &lt;= sum; k++, tw += w, tv += v) &#123;</div><div class="line">                <span class="keyword">if</span> (k - MQ[l][<span class="number">0</span>] &gt; c)   </div><div class="line">                    l++;</div><div class="line">                <span class="keyword">int</span> dpv = dp[tw] - tv;</div><div class="line">                <span class="keyword">while</span> (l &lt;= r &amp;&amp; MQ[r][<span class="number">1</span>] &lt;= dpv)</div><div class="line">                    r--;</div><div class="line">                r++;</div><div class="line">                MQ[r][<span class="number">0</span>] = k, MQ[r][<span class="number">1</span>] = dpv;</div><div class="line">                dp[tw] = max(dp[tw], MQ[l][<span class="number">1</span>] + tv);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="優化三夜"><a href="#優化三夜" class="headerlink" title="優化三夜"></a>優化三夜</h3><p>後來發現，sliding windows 滑動時，我們常常看前看後，因此常常會發生 cache miss，因為他要跳躍一大段記憶體空間查找數值，所以可以考慮花點操作將極值放在 stack 上，視為一種 software cache 來加速，來減少 cache miss 的懲罰。</p>
<p>接著，在迴圈邊界比較時，我們可以算得更精準些，回到一般的 <code>i++</code> 的 format pattern，讓編譯器幫我們做常見的迴圈優化。</p>
<blockquote>
<p>改善了 10% 效能</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(BB A[], <span class="keyword">int</span> dp[], <span class="keyword">int</span> W, <span class="keyword">int</span> N)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> MQ[MAXW][<span class="number">2</span>];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">        <span class="keyword">int</span> w = A[i].w, v = A[i].v, c = A[i].c;</div><div class="line">        sum = min(sum + w*c, W);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; w; j++) &#123;</div><div class="line">            <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>;</div><div class="line">            MQ[l][<span class="number">0</span>] = <span class="number">0</span>, MQ[l][<span class="number">1</span>] = dp[j];</div><div class="line">            <span class="keyword">int</span> cache_max = MQ[l][<span class="number">1</span>], cache_idx = MQ[l][<span class="number">0</span>];</div><div class="line">            <span class="keyword">int</span> k_bound;</div><div class="line">            k_bound = min((sum-j)/w, c);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>, tw = w+j, tv = v; k &lt;= k_bound; k++, tw += w, tv += v) &#123;</div><div class="line">                <span class="comment">// tw = k*w+j, tv = k*v;</span></div><div class="line">                <span class="keyword">int</span> dpv = dp[tw] - tv;</div><div class="line">                <span class="keyword">while</span> (l &lt;= r &amp;&amp; MQ[r][<span class="number">1</span>] &lt;= dpv)</div><div class="line">                    r--;</div><div class="line">                r++;</div><div class="line">                MQ[r][<span class="number">0</span>] = k, MQ[r][<span class="number">1</span>] = dpv;</div><div class="line">                <span class="keyword">if</span> (r == l)    cache_max = dpv, cache_idx = k;</div><div class="line">                dp[tw] = max(dp[tw], cache_max + tv);</div><div class="line">            &#125;</div><div class="line">            k_bound = (sum-j)/w;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = c+<span class="number">1</span>, tw = (c+<span class="number">1</span>)*w+j, tv = (c+<span class="number">1</span>)*v; k &lt;= k_bound; k++, tw += w, tv += v) &#123;</div><div class="line">                <span class="keyword">int</span> dpv = dp[tw] - tv;</div><div class="line">                <span class="keyword">while</span> (l &lt;= r &amp;&amp; MQ[r][<span class="number">1</span>] &lt;= dpv)</div><div class="line">                    r--;</div><div class="line">                r++;</div><div class="line">                MQ[r][<span class="number">0</span>] = k, MQ[r][<span class="number">1</span>] = dpv;</div><div class="line">                <span class="keyword">if</span> (r == l)   </div><div class="line">                    cache_max = dpv, cache_idx = k;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (k - cache_idx &gt; c)   </div><div class="line">                    l++, cache_idx = MQ[l][<span class="number">0</span>], cache_max = MQ[l][<span class="number">1</span>];</div><div class="line">                dp[tw] = max(dp[tw], cache_max + tv);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125; </div></pre></td></tr></table></figure>
<h3 id="優化四夜"><a href="#優化四夜" class="headerlink" title="優化四夜"></a>優化四夜</h3><p>儘管上面使用的 software cache 的方式減少 cache miss，但 DP table 仍與數據結構的記憶體位置相當遙遠，為了使他們貼近，應使用環狀隊列的實作，空間從 <span>$O(W)$</span><!-- Has MathJax --> 將到 <span>$O(N)$</span><!-- Has MathJax -->，實作時，將大小限制在 <span>$2^k$</span><!-- Has MathJax -->，方便運行時使用 AND 運算取代耗時的模數運算。</p>
<p>由於限制個數分佈上，很容易造成貪心算法有解，因此先跑一次貪心，如果貪心沒辦法達到剛好大小，那麼再跑 DP 找解。DP 找解時，可以將物品嘗試進行二進制轉換，將等價物品合併，來觸發計算邊界的優化。完成的程序如下：</p>
<blockquote>
<p>最終加速，改善 10%，期待你我的分享增進。根據鴿籠原理，cp 直種類不多時，可以高達 10 倍以上的加速。</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> &#123;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXW = <span class="number">1000005</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1005</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXC = <span class="number">1</span>&lt;&lt;<span class="number">12</span>;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BB</span> &#123;</span></div><div class="line">        <span class="keyword">int</span> w, v, c;</div><div class="line">        BB(<span class="keyword">int</span> w = <span class="number">0</span>, <span class="keyword">int</span> v = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>):</div><div class="line">            w(w), v(v), c(c) &#123;&#125;</div><div class="line">        <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> BB &amp;x) <span class="keyword">const</span> &#123;</div><div class="line">            <span class="keyword">return</span> w * c  &lt; x.w * x.c;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">cmpByWeight</span><span class="params">(BB x, BB y)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> x.w &lt; y.w;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(BB A[], <span class="keyword">int</span> dp[], <span class="keyword">int</span> W, <span class="keyword">int</span> N)</span> </span>&#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">int</span> MQ[MAXC][<span class="number">2</span>];</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="keyword">int</span> w = A[i].w, v = A[i].v, c = A[i].c;</div><div class="line">            assert(c &lt; MAXC);</div><div class="line">            sum = min(sum + w*c, W);</div><div class="line">            <span class="keyword">if</span> (c != <span class="number">1</span>) &#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; w; j++) &#123;</div><div class="line">                    <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>;</div><div class="line">                    MQ[r][<span class="number">0</span>] = <span class="number">0</span>, MQ[r][<span class="number">1</span>] = dp[j];</div><div class="line">                    <span class="keyword">int</span> cache_max = MQ[r][<span class="number">1</span>], cache_idx = MQ[r][<span class="number">0</span>];</div><div class="line">                    <span class="keyword">int</span> k_bound;</div><div class="line">                    r = (r+<span class="number">1</span>)&amp;(MAXC<span class="number">-1</span>);</div><div class="line">                    k_bound = min((sum-j)/w, c);</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>, tw = w+j, tv = v; k &lt;= k_bound; k++, tw += w, tv += v) &#123;</div><div class="line">                        <span class="comment">// tw = k*w+j, tv = k*v;</span></div><div class="line">                        <span class="keyword">int</span> dpv = dp[tw] - tv;</div><div class="line">                        <span class="keyword">while</span> (l != r &amp;&amp; MQ[(r<span class="number">-1</span>+MAXC)&amp;(MAXC<span class="number">-1</span>)][<span class="number">1</span>] &lt;= dpv)</div><div class="line">                            r = (r<span class="number">-1</span>+MAXC)&amp;(MAXC<span class="number">-1</span>);</div><div class="line">                        MQ[r][<span class="number">0</span>] = k, MQ[r][<span class="number">1</span>] = dpv;</div><div class="line">                        <span class="keyword">if</span> (l == r)	cache_max = dpv, cache_idx = k;</div><div class="line">                        r = (r+<span class="number">1</span>)&amp;(MAXC<span class="number">-1</span>);</div><div class="line">                        dp[tw] = max(dp[tw], cache_max + tv);</div><div class="line">                    &#125;</div><div class="line">                    k_bound = (sum-j)/w;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = c+<span class="number">1</span>, tw = (c+<span class="number">1</span>)*w+j, tv = (c+<span class="number">1</span>)*v; k &lt;= k_bound; k++, tw += w, tv += v) &#123;</div><div class="line">                        <span class="keyword">int</span> dpv = dp[tw] - tv;</div><div class="line">                        <span class="keyword">while</span> (l != r &amp;&amp; MQ[(r<span class="number">-1</span>+MAXC)&amp;(MAXC<span class="number">-1</span>)][<span class="number">1</span>] &lt;= dpv)</div><div class="line">                            r--;</div><div class="line">                        MQ[r][<span class="number">0</span>] = k, MQ[r][<span class="number">1</span>] = dpv;</div><div class="line">                        <span class="keyword">if</span> (l == r)	cache_max = dpv, cache_idx = k;</div><div class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (k - cache_idx &gt; c)	</div><div class="line">                            l = (l+<span class="number">1</span>)&amp;(MAXC<span class="number">-1</span>), cache_idx = MQ[l][<span class="number">0</span>], cache_max = MQ[l][<span class="number">1</span>];</div><div class="line">                        r = (r+<span class="number">1</span>)&amp;(MAXC<span class="number">-1</span>);</div><div class="line">                        dp[tw] = max(dp[tw], cache_max + tv);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="number">1</span>) &#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = sum; j &gt;= w; j--)</div><div class="line">                    dp[j] = max(dp[j], dp[j-w]+v);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;	</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">greedy</span><span class="params">(<span class="keyword">int</span> C[][<span class="number">3</span>], <span class="keyword">int</span> N, <span class="keyword">int</span> W)</span> </span>&#123;</div><div class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">GB</span> &#123;</span></div><div class="line">            <span class="keyword">int</span> w, v, c;</div><div class="line">            GB(<span class="keyword">int</span> w = <span class="number">0</span>, <span class="keyword">int</span> v = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>):</div><div class="line">                w(w), v(v), c(c) &#123;&#125;</div><div class="line">            <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> GB &amp;x) <span class="keyword">const</span> &#123;</div><div class="line">                <span class="keyword">if</span> (v * x.w != x.v * w)</div><div class="line">                    <span class="keyword">return</span> v * x.w &gt; x.v * w;</div><div class="line">                <span class="keyword">return</span> c &gt; x.c;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="built_in">vector</span>&lt;GB&gt; A;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="keyword">int</span> w = C[i][<span class="number">0</span>], v = C[i][<span class="number">1</span>], c = C[i][<span class="number">2</span>];</div><div class="line">            A.push_back(GB(w, v, c));</div><div class="line">        &#125;</div><div class="line">        sort(A.begin(), A.end());</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="keyword">int</span> t = min(A[i].c, W/A[i].w);</div><div class="line">            <span class="keyword">if</span> (t == <span class="number">0</span>)</div><div class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">            W -= t*A[i].w;</div><div class="line">            ret += t*A[i].v;</div><div class="line">            <span class="keyword">if</span> (W == <span class="number">0</span>)</div><div class="line">                <span class="keyword">return</span> ret;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">knapsack</span><span class="params">(<span class="keyword">int</span> C[][<span class="number">3</span>], <span class="keyword">int</span> N, <span class="keyword">int</span> W)</span> </span>&#123;</div><div class="line">        <span class="comment">// filter</span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">int</span> filter = greedy(C, N, W);</div><div class="line">            <span class="keyword">if</span> (filter != <span class="number">-1</span>)</div><div class="line">                <span class="keyword">return</span> filter;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">vector</span>&lt;BB&gt; A;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="keyword">int</span> w = C[i][<span class="number">0</span>], v = C[i][<span class="number">1</span>], c = C[i][<span class="number">2</span>];</div><div class="line">            A.push_back(BB(w, v, c));</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// reduce</span></div><div class="line">        &#123;</div><div class="line">            sort(A.begin(), A.end(), cmpByWeight);</div><div class="line">            <span class="built_in">map</span>&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;, <span class="keyword">int</span>&gt; R;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</div><div class="line">                R[make_pair(A[i].w, A[i].v)] = i;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">                <span class="keyword">int</span> c = A[i].c;</div><div class="line">                <span class="built_in">map</span>&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;, <span class="keyword">int</span>&gt;::iterator it;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= c; k &lt;&lt;= <span class="number">1</span>) &#123;</div><div class="line">                    <span class="keyword">int</span> w = A[i].w * k, v = A[i].v * k;</div><div class="line">                    it = R.find(make_pair(w, v));</div><div class="line">                    <span class="keyword">if</span> (it != R.end() &amp;&amp; i != it-&gt;second) &#123;</div><div class="line">                        <span class="keyword">int</span> j = it-&gt;second;</div><div class="line">                        A[j].c ++;</div><div class="line">                        A[i].c -= k;</div><div class="line">                    &#125;</div><div class="line">                    c -= k;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (c &gt; <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">int</span> w = A[i].w * c, v = A[i].v * c;</div><div class="line">                    it = R.find(make_pair(w, v));</div><div class="line">                    <span class="keyword">if</span> (it != R.end() &amp;&amp; i != it-&gt;second) &#123;</div><div class="line">                        <span class="keyword">int</span> j = it-&gt;second;</div><div class="line">                        A[j].c ++;</div><div class="line">                        A[i].c -= c;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">int</span> dp1[MAXW+<span class="number">1</span>], dp2[MAXW+<span class="number">1</span>];</div><div class="line">        BB Ar[<span class="number">2</span>][MAXN];</div><div class="line">        <span class="keyword">int</span> ArN[<span class="number">2</span>] = &#123;&#125;;</div><div class="line">        <span class="built_in">memset</span>(dp1, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp1[<span class="number">0</span>])*(W+<span class="number">1</span>));</div><div class="line">        <span class="built_in">memset</span>(dp2, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp2[<span class="number">0</span>])*(W+<span class="number">1</span>));</div><div class="line">        sort(A.begin(), A.end());</div><div class="line">        <span class="keyword">int</span> sum[<span class="number">2</span>] = &#123;&#125;;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="keyword">int</span> ch = sum[<span class="number">1</span>] &lt; sum[<span class="number">0</span>];</div><div class="line">            Ar[ch][ArN[ch]] = A[i];</div><div class="line">            ArN[ch]++;</div><div class="line">            sum[ch] = min(sum[ch] + A[i].w*A[i].c, W);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        run(Ar[<span class="number">0</span>], dp1, W, ArN[<span class="number">0</span>]);</div><div class="line">        run(Ar[<span class="number">1</span>], dp2, W, ArN[<span class="number">1</span>]);</div><div class="line"></div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = W, mx = <span class="number">0</span>; i &lt;= W; i++, j--) &#123;</div><div class="line">            mx = max(mx, dp2[i]);</div><div class="line">            ret = max(ret, dp1[j] + mx);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> W, N;</div><div class="line">    assert(<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;W, &amp;N) == <span class="number">2</span>);</div><div class="line">    <span class="keyword">int</span> C[MAXN][<span class="number">3</span>];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</div><div class="line">        assert(<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;C[i][<span class="number">1</span>], &amp;C[i][<span class="number">0</span>], &amp;C[i][<span class="number">2</span>]) == <span class="number">3</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, knapsack(C, N, W));</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-20005" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/18/jg-20005/" class="article-date">
  <time datetime="2016-12-18T01:13:40.000Z" itemprop="datePublished">2016-12-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/出題解題/">出題解題</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/18/jg-20005/">淺談背包問題 (0/1 Knapsack Problem) 優化那些事</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/12/18/jg-20005/" data-id="ckkknael7009bo4vr0ahxnk83" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/12/18/jg-20005/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DP/">DP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/優化/">優化</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/背包問題/">背包問題</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <blockquote>
<p>收錄於 <a href="https://judgegirl.csie.org/problem/0/20005" target="_blank" rel="external">批改娘 20005. 0/1 Knapsack Problem</a>。之所以有機會談到這個問題，其原因於早期的背包問題，大多都是用 branch-and-bound 算法來完成，也因此學弟課程出了這一份作業，大部分的測資，使用 branch-and-bound 能跑得比一般記憶體化 DP 快上非常多。當然，作為一個 Morris(?) 怎能允許這樣的事情發生。</p>
<p>現在回顧一下背包問題的模型吧！</p>
</blockquote>
<h2 id="輸入格式"><a href="#輸入格式" class="headerlink" title="輸入格式"></a>輸入格式</h2><p>每組測資第一行包含兩個正整數，分別代表背包大小 $M$ ($\leq 5×10^6$) 和物品個數 $N$ ($\leq 1000$)，下一行開始每行包含兩個正整數，分別代表物品價值 $P_i$ ($\leq 10^5$)和物品重量 $W_i$ ($ \leq 10^5$)。</p>
<h2 id="輸出格式"><a href="#輸出格式" class="headerlink" title="輸出格式"></a>輸出格式</h2><p>對於每組測資，請輸出最大收益。</p>
<h2 id="範例輸入-1"><a href="#範例輸入-1" class="headerlink" title="範例輸入 1"></a>範例輸入 1</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">50 7</div><div class="line">70 31</div><div class="line">20 10</div><div class="line">39 20</div><div class="line">37 19</div><div class="line">7 4</div><div class="line">5 3</div><div class="line">10 6</div></pre></td></tr></table></figure>
<h2 id="範例輸出-1"><a href="#範例輸出-1" class="headerlink" title="範例輸出 1"></a>範例輸出 1</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">107</div></pre></td></tr></table></figure>
<h2 id="範例輸入-2"><a href="#範例輸入-2" class="headerlink" title="範例輸入 2"></a>範例輸入 2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">170 7</div><div class="line">442 41</div><div class="line">525 50</div><div class="line">511 49</div><div class="line">593 59</div><div class="line">546 55</div><div class="line">564 57</div><div class="line">617 60</div></pre></td></tr></table></figure>
<h2 id="範例輸出-2"><a href="#範例輸出-2" class="headerlink" title="範例輸出 2"></a>範例輸出 2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">1735</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><h3 id="Branch-and-bound"><a href="#Branch-and-bound" class="headerlink" title="Branch-and-bound"></a>Branch-and-bound</h3><blockquote>
<p><a href="http://www.or.deis.unibo.it/kp/Chapter3.pdf" target="_blank" rel="external">bound knapscak problem</a> 古耕竹同學提供</p>
</blockquote>
<p>如果物品可以被切割，那麼可以利用物品的 CP 值 (<span>$\textit{cp}_i = p_i/w_i$</span><!-- Has MathJax -->)排序，使用貪心算法在 <span>$O(N \log N)$</span><!-- Has MathJax --> 找到最佳解。然而，背包問題在於物品只能挑或不挑，一旦無法切割物品，那麼貪心算法無法將剩餘的部分填滿，進而可能產生更好的一組解填滿剩餘部分。</p>
<blockquote>
<p>想要更快嗎？多看論文且實作它吧！</p>
</blockquote>
<p>branch-and-bound 基本核心操作為</p>
<ul>
<li>按照 CP 值由大到小排序</li>
<li>貪心法最佳解 <span>$\textit{bound}$</span><!-- Has MathJax --></li>
<li>進行深度優先搜索，優先挑 CP 值大的入選<ul>
<li>當前挑選方案最佳解 <span>$g$</span><!-- Has MathJax --> + 剩餘物品使用貪心法最佳解 <span>$g$</span><!-- Has MathJax --> 小於等於當前最佳解 <span>$\textit{bound}$</span><!-- Has MathJax -->，則退出搜索。</li>
<li>更新 <span>$\textit{bound} = \max(\textit{bound}, g)$</span><!-- Has MathJax --></li>
<li>選擇加入 或 不加入 (註：學弟說我的某些測資，通通優先不選可以快個數十倍)</li>
</ul>
</li>
</ul>
<p>參考代碼</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Item</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> v, w;</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">cp</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (<span class="keyword">double</span>) v / w;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmpCP</span><span class="params">(Item a, Item b)</span> </span>&#123;</div><div class="line">    <span class="keyword">double</span> cpA = a.cp();</div><div class="line">    <span class="keyword">double</span> cpB = b.cp();</div><div class="line">    <span class="keyword">if</span> (cpA == cpB)</div><div class="line">        <span class="keyword">return</span> a.w &gt; b.w;</div><div class="line">    <span class="keyword">return</span> cpA &gt; cpB;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> n, m;</div><div class="line"><span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">Item items[<span class="number">1005</span>];</div><div class="line"><span class="keyword">int</span> prefixW[<span class="number">1005</span>];</div><div class="line"><span class="keyword">int</span> prefixV[<span class="number">1005</span>];</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">h</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> w, <span class="keyword">int</span> b, <span class="keyword">int</span> &amp;j, <span class="keyword">int</span> &amp;f)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> fw = i == <span class="number">0</span> ? w : (w + prefixW[i<span class="number">-1</span>]);</div><div class="line">    <span class="keyword">for</span> (j = max(b, i); j &lt; n &amp;&amp; prefixW[j] &lt;= fw; j++);</div><div class="line">    <span class="keyword">if</span> (j &gt;= n) &#123;</div><div class="line">        <span class="keyword">return</span> prefixV[n<span class="number">-1</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> v = <span class="number">0</span>;</div><div class="line">    f = <span class="number">0</span>;</div><div class="line">    v += prefixV[j<span class="number">-1</span>] - (i == <span class="number">0</span> ? <span class="number">0</span> : prefixV[i<span class="number">-1</span>]);</div><div class="line">    w -= prefixW[j<span class="number">-1</span>] - (i == <span class="number">0</span> ? <span class="number">0</span> : prefixW[i<span class="number">-1</span>]);</div><div class="line">    <span class="keyword">if</span> (w != <span class="number">0</span>) &#123;</div><div class="line">        f = <span class="number">1</span>;</div><div class="line">        <span class="keyword">float</span> k = (<span class="keyword">float</span>) w / items[j].w;</div><div class="line">        w -= k * items[j].w;</div><div class="line">        v += k * items[j].v;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> v;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">greedy</span><span class="params">(<span class="keyword">int</span> w)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> v = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)  &#123;</div><div class="line">        <span class="keyword">if</span> (w &gt;= items[i].w)&#123;</div><div class="line">            w -= items[i].w;</div><div class="line">            v += items[i].v;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> v;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> v;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> w, <span class="keyword">int</span> v, <span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (i &gt;= n) &#123;</div><div class="line">        ret = max(ret, v);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> j = n, f;</div><div class="line">    <span class="keyword">int</span> hv = v + h(i, w, b, j, f);</div><div class="line">    <span class="keyword">if</span> (hv &lt;= ret)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">if</span> (f == <span class="number">0</span>) &#123;</div><div class="line">        ret = max(ret, hv);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (w &gt;= items[i].w)</div><div class="line">        dfs(i + <span class="number">1</span>, w - items[i].w, v + items[i].v, j);</div><div class="line">    dfs(i + <span class="number">1</span>, w, v, j);</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;m, &amp;n) == <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;items[i].v, &amp;items[i].w);</div><div class="line">        stable_sort(items, items+n, cmpCP);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, w = <span class="number">0</span>, v = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            w += items[i].w;</div><div class="line">            v += items[i].v;</div><div class="line">            prefixW[i] = w;</div><div class="line">            prefixV[i] = v;</div><div class="line">        &#125;</div><div class="line">        ret = greedy(m);</div><div class="line">        dfs(<span class="number">0</span>, m, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h4><p>branch-and-bound 空間複雜度只跟 <span>$N$</span><!-- Has MathJax --> 有關，使用記憶體空間小，相較於記憶化搜索有較少的 cache miss，速度取決於搜索順序。對於同一 CP 的等價處理薄弱，一遇到這種情況，搜尋時間瞬間指數次方上去，可以等個昏天暗地。</p>
<h3 id="Dynamic-Programming"><a href="#Dynamic-Programming" class="headerlink" title="Dynamic Programming"></a>Dynamic Programming</h3><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><blockquote>
<p>請不要忘記背包問題屬於 NP-Complete，我們能做的事情只能優化計算，最慘的情況仍要面對，優化常數是可以努力的方向，讓我們嘗試變得更快吧。</p>
</blockquote>
<p>基礎寫法解說請參考 <a href="http://www.csie.ntnu.edu.tw/~u91029/KnapsackProblem.html#4" target="_blank" rel="external">DJWS - Bounded Knapsack Problem</a> 的說明。</p>
<p>從定義上，我們通常會宣告 <code>dp[i][j]</code> 表示放入前 <span>$i$</span><!-- Has MathJax --> 個物品時，總共最多為 <span>$j$</span><!-- Has MathJax --> 的最大價值為何。這樣空間宣告使用 <span>$\mathcal{O}(NW)$</span><!-- Has MathJax -->。在實作上，我們可以藉由運算順序將空間降為 <span>$\mathcal{O}(W)$</span><!-- Has MathJax -->。因此，寫出以下代碼並不難</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> dp[MAXW];</div><div class="line"><span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp));</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = W; j &gt;= w[i]; j--)</div><div class="line">        dp[j] = max(dp[j], dp[j-w[i]]+v[i]);</div></pre></td></tr></table></figure>
<h4 id="優化初夜"><a href="#優化初夜" class="headerlink" title="優化初夜"></a>優化初夜</h4><p>從實際運行上，我們可以發現每次跑 <span>$\mathcal{\theta}(W)$</span><!-- Has MathJax --> 非常浪費，只需要跑 <span>$\min(W, \sum w_i)$</span><!-- Has MathJax --> 即可。因此，第一份計算量優化如下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> dp[MAXW];</div><div class="line"><span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp));</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">    sum += w[i];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = min(W, sum); j &gt;= w[i]; j--)</div><div class="line">        dp[j] = max(dp[j], dp[j-w[i]]+v[i]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>計算邊界優化通常可以達到 2x 加速</p>
</blockquote>
<p>如此一來，在數量多權重小時，剛啟動的效能時可以賺到非常多。然而，不乏第一次就給權重的大的，目標最小化 <span>$\sum \text{sum}_i$</span><!-- Has MathJax -->，從數學觀念很明顯地瞭解，只要一開始將權重 <span>$w_i$</span><!-- Has MathJax --> 由小到大排序即可，這樣能保證最小化計算量！</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> dp[MAXW];</div><div class="line"><span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp));</div><div class="line">sort (w, v) by w</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">    sum += w[i];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = min(W, sum); j &gt;= w[i]; j--)</div><div class="line">        dp[j] = max(dp[j], dp[j-w[i]]+v[i]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>數學使得我們更進一步，達到 1.5x 加速</p>
</blockquote>
<h4 id="優化二夜"><a href="#優化二夜" class="headerlink" title="優化二夜"></a>優化二夜</h4><p>經由平行的訓練，也許我們可以更往上一層優化。</p>
<p>接下來，打算把物品拆成兩堆，再利用優化初夜學到的技巧，就能引爆更多計算邊界優化。如果拆成三堆以上，合併操作變得相當複雜，當只有兩堆時，保證合併效能一定在 <span>$\mathcal{\theta}(W)$</span><!-- Has MathJax --> 完成。</p>
<p>如何合併兩堆的計算結果，假設 <code>dp1[i]</code> 表示其中一堆重量小於等於 <span>$i$</span><!-- Has MathJax --> 的最佳解，同理 <code>dp2[j]</code> 的計算結果。</p>
<p>當要湊出重量為 <span>$W$</span><!-- Has MathJax --> 的最佳解時，窮舉其中一堆的重量 <span>$i$</span><!-- Has MathJax --> 維護其中一堆的前綴最大值 <span>$j$</span><!-- Has MathJax -->，相當於使用掃描線算法在線性時間內合併。合併操作如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = W, mx = <span class="number">0</span>; i &lt;= W; i++, j--) &#123;</div><div class="line">    mx = max(mx, dp2[i]);</div><div class="line">    ret = max(ret, dp1[j] + mx);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>Divide-and-Conquer，使得我們更快再更快！達到 1.5 加速</p>
</blockquote>
<p>然而，優化問題將轉移到最佳分堆策略，好的分堆策略將使得計算量下降更多。目標分兩堆，使得 <span>$\sum \text{sum1}_i + \sum \text{sum2}_i$</span><!-- Has MathJax --> 最小化。明顯地，由小到大排序物品重量，依序將物品放到總和最小的那一堆即可。最後，我們整合每一夜的結果如下：</p>
<blockquote>
<p>一個好的分堆，達到 1.2x 加速</p>
<p>相信在不久之後，還有更好的優化策略，也許不是延伸，而是全新的面貌。</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> &#123;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXW = <span class="number">5000005</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1005</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(<span class="keyword">int</span> A[][<span class="number">2</span>], <span class="keyword">int</span> dp[], <span class="keyword">int</span> W, <span class="keyword">int</span> N)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="keyword">int</span> w = A[i][<span class="number">0</span>], v = A[i][<span class="number">1</span>];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = min(W, sum + w); j &gt;= w; j--)</div><div class="line">                dp[j] = max(dp[j], dp[j-w]+v);</div><div class="line">            sum += w;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">knapsack</span><span class="params">(<span class="keyword">int</span> C[][<span class="number">2</span>], <span class="keyword">int</span> N, <span class="keyword">int</span> W)</span> </span>&#123;</div><div class="line">        <span class="built_in">vector</span>&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; A;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</div><div class="line">            A.push_back(make_pair(C[i][<span class="number">0</span>], C[i][<span class="number">1</span>]));</div><div class="line">        N = A.size();</div><div class="line">        assert(N &lt; MAXN);</div><div class="line">        <span class="keyword">static</span> <span class="keyword">int</span> dp1[MAXW+<span class="number">1</span>], dp2[MAXW+<span class="number">1</span>];</div><div class="line">        <span class="keyword">int</span> Ar[<span class="number">2</span>][MAXN][<span class="number">2</span>], ArN[<span class="number">2</span>] = &#123;&#125;;</div><div class="line">        <span class="built_in">memset</span>(dp1, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp1[<span class="number">0</span>])*(W+<span class="number">1</span>));</div><div class="line">        <span class="built_in">memset</span>(dp2, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp2[<span class="number">0</span>])*(W+<span class="number">1</span>));</div><div class="line">        sort(A.begin(), A.end());</div><div class="line">        <span class="keyword">int</span> sum[<span class="number">2</span>] = &#123;&#125;;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="keyword">int</span> ch = sum[<span class="number">1</span>] &lt; sum[<span class="number">0</span>];</div><div class="line">            Ar[ch][ArN[ch]][<span class="number">0</span>] = A[i].first;</div><div class="line">            Ar[ch][ArN[ch]][<span class="number">1</span>] = A[i].second;</div><div class="line">            ArN[ch]++;</div><div class="line">            sum[ch] += A[i].first;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        run(Ar[<span class="number">0</span>], dp1, W, ArN[<span class="number">0</span>]);</div><div class="line">        run(Ar[<span class="number">1</span>], dp2, W, ArN[<span class="number">1</span>]);</div><div class="line"></div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = W, mx = <span class="number">0</span>; i &lt;= W; i++, j--) &#123;</div><div class="line">            mx = max(mx, dp2[i]);</div><div class="line">            ret = max(ret, dp1[j] + mx);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> W, N, C[MAXN][<span class="number">2</span>];</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;W, &amp;N) == <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</div><div class="line">            assert(<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;C[i][<span class="number">1</span>], &amp;C[i][<span class="number">0</span>]) == <span class="number">2</span>);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, knapsack(C, N, W));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-parallel-opt" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/31/parallel-opt/" class="article-date">
  <time datetime="2016-07-31T12:15:17.000Z" itemprop="datePublished">2016-07-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/31/parallel-opt/">平行優化技巧－基礎篇</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/07/31/parallel-opt/" data-id="ckkknaenb00czo4vrc98krm5t" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/07/31/parallel-opt/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CUDA/">CUDA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenCL/">OpenCL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenMP/">OpenMP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/優化/">優化</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <p>在撰寫平行程式時，仍會使用到編譯器的技巧，大幅度地減少指令個數，有時候這些優化甚至會把寫壞的分享記憶體 (shared memory) 存取給移除掉，如果能充分理解這些不好的設計，就不會造成實驗上發生的謬誤，還以為自己跑得很慢，平行根本沒加速到，這樣草草交出的報告，助教也收到煩了 (這裡不討論實驗方法本身就是錯的情況)。</p>
<h2 id="內存篇"><a href="#內存篇" class="headerlink" title="內存篇"></a>內存篇</h2><p>首先，來談談 cache line 是什麼吧？現在的機器都有著記憶體階層架構 (memory hierarchy)，按照大小排序，其中最小的就是 cache line，接下來才是 L1, L2, L3 cache，最後是最大的主記憶體 (main memory)，但某些超級電腦的設計就不是如此，而有些輔助處理器 (如 intel xeon phi) 缺少 L3 cache，而像 GPU 則沒有 cache 設計，但有提供有 bank 存取資料。這些都跟處理問題的類型有關，才導致有那些特殊設計。</p>
<h3 id="Multicore"><a href="#Multicore" class="headerlink" title="Multicore"></a>Multicore</h3><h4 id="Cache-Size"><a href="#Cache-Size" class="headerlink" title="Cache Size"></a>Cache Size</h4><p>為什麼 cache line 很重要？因為存取速度最快，但能存放的資料也很小，通常是 64 bytes 或者 32 bytes。在快取設計中，一次把位址連續的資料一起搬靠近 CPU，這樣簡單的設計，導致我們在撰寫程式時，若能將結構定義得好便能讓使用率高，這非常仰賴編成者對於系統架構的了解。例如色彩 RGB，可以宣告成 <code>struct RGB {flaot R, G, B};</code> 或者 <code>float R[], G[], B[]</code>，如果 RGB 三者會共同計算，例如色彩轉換通常是三者交互作用的表達式，因此前者構造方式較為妥當。</p>
<blockquote>
<p>例題：批改娘 10087. Sparse Matrix Multiplication (OpenMP) </p>
</blockquote>
<h4 id="Cache-Hierarchy"><a href="#Cache-Hierarchy" class="headerlink" title="Cache Hierarchy"></a>Cache Hierarchy</h4><p>然而，有些情況充分使用反而不好，沒錯，就是平行程式，通常平行程式不外乎會有分享記憶體，這時候充分利用反而是一件壞事，因為我們需要讓數個核心 (core) 同時運行，因為每一個 core 都有各自的 cache line，若在不同 core 上同時修改相近的位址時，很容易產生 dirty bit，這導致要掉回 L3 cache (同一個 CPU，但分享在不同的 core 上) 進行同步。通常編譯器能做到 independent 分析，那麼就會利用暫存器配置來避開這問題，如果不行，就要靠自己手動來調整。</p>
<blockquote>
<p>例題：批改娘 10085. Parallel Count (debug)</p>
</blockquote>
<h3 id="GPU"><a href="#GPU" class="headerlink" title="GPU"></a>GPU</h3><p>GPU 的記憶體設計分成四種，經常分成 on-chip 和 off-chip，差別在於是不是內建焊死，因此 on-chip 內建記憶體有比較好的效能，而 off-chip 則是外接記憶體，存取速度相對於 on-chip 慢個三倍以上。特別注意，有好就有壞，提供越快存取速度的記憶體能存放的容量越小，因此非常不容易配置。</p>
<p>在編寫 CUDA 或者是 OpenCL 時，提供 shared memory 的設計，如果請求數量過大，將會自動轉入 global memory，這一點沒有明確告知，只有在執行時期才會發現突然變慢。若採用存取速度較快的寫法，有時候不見得比較快，</p>
<blockquote>
<p>例題：批改娘 10101. Fast Game of Life (CUDA) </p>
</blockquote>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-diary-201606-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/30/diary-201606-2/" class="article-date">
  <time datetime="2016-06-30T05:19:22.000Z" itemprop="datePublished">2016-06-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/iMNzqYL.jpg" rel="gallery_ckkknaehv002yo4vrbm836k65">
        <img src="http://i.imgur.com/iMNzqYL.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/30/diary-201606-2/">走在平行道路上－後篇</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/06/30/diary-201606-2/" data-id="ckkknaehv002yo4vrbm836k65" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/06/30/diary-201606-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <blockquote><p>到頭來，最好的平行就是不交流，最好的進展就是不溝通。－Antisocial Parallelism</p>
</blockquote>
<h2 id="崩壞季節"><a href="#崩壞季節" class="headerlink" title="崩壞季節"></a>崩壞季節</h2><p>在學期後半段，「四月是你的謊言，五月是否要換題目，六月是否要重新來過」聽到這些是否能明白我在說什麼呢？沒錯，就是傳奇的碩二崩壞日子，若是以畢業導向來讀研究所，花個一年或一年半修課，剩餘時間還要產出論文，想而知壓力是如此地大，有些領域甚至要實作一個系統，那麼忙碌程度就明顯不同，學長們崩壞的日子越來越近。</p>
<ul>
<li>[問卦] 實驗室學長為什麼都不會回家 ? <a href="https://www.ptt.cc/bbs/Gossiping/M.1460094845.A.753.html" target="_blank" rel="external">https://www.ptt.cc/bbs/Gossiping/M.1460094845.A.753.html</a></li>
<li>[問卦] 實驗室學長怎麼壞掉了 <a href="https://www.ptt.cc/bbs/Gossiping/M.1460445571.A.2AA.html" target="_blank" rel="external">https://www.ptt.cc/bbs/Gossiping/M.1460445571.A.2AA.html</a></li>
</ul>
<h2 id="平行助教"><a href="#平行助教" class="headerlink" title="平行助教"></a>平行助教</h2><h3 id="追求優化極致"><a href="#追求優化極致" class="headerlink" title="追求優化極致"></a>追求優化極致</h3><p>課堂作業的平行題目大多都是純數值計算，相當枯燥乏味，但優化技術屬於編譯器範疇，對於平行課程而言，只需要知道概念就能交差，對於這一點我也無可奈何，數次詢問老師是否要以速度作為評分標準，得到的回答都是「不」，心中帶點傷心，很想鼓勵那些寫得不錯又願意花時間鑽研的同學。看到沒有鑽研的同學嫌這門課簡單、好混，真的好想拉著他們一起來研究。</p>
<h3 id="與同學互動"><a href="#與同學互動" class="headerlink" title="與同學互動"></a>與同學互動</h3><p>相較於往年的平行課程，今天很多題目都被設計可以 Online Judge，但有批改娘後，同學在半夜用不錯的想法寫出較快的程序，剛睡醒的我馬上發現自己寫的程序不斷地被幹掉，又花了一個下午加上現有知識再追回去。反反覆覆地過著這種日子，每天醒來都會畏懼最好的寫法會使用什麼樣的概念。心裡過得很痛苦，即使如此我也挺開心的，同學不嫌棄廢廢的我球員兼裁判，還願意在我出的題目下花時間，在下非常感動。</p>
<p><img src="http://i.imgur.com/uSk8DUI.jpg" alt="「即使如此我也挺開心的」－《Re: 從零開始的異世界生活》"></p>
<p>當我拚命優化 local memory 存取，卻在替同學 debug 時發現意外地加速，於是新境界到來，順便跟同學交流一下加速部份，甚至連開檔時間都要省！一起追尋神乎其技的感覺非常不賴。</p>
<blockquote>
<p>效能進展 3571 ms (24-core CPU) -&gt; 2567 ms (GPU, partial local memory) -&gt; 2472 ms (GPU, full local memory) -&gt; 1675 ms (GPU, full local memory + work group opt) -&gt; 967 ms (GPU, global memory + I/O opt + embedded kernel code)</p>
</blockquote>
<p><img src="http://i.imgur.com/RUtql78.jpg" alt="「來吧 快和我一起來修行吧」－《田中君總是如此慵懶》"></p>
<p>「看著秒速被拉近，從 profiler 中看出當前問題卡在 memory bandwidth &amp; usage，要著手這一塊優化了對吧。」</p>
<p>「就算是 1 μs，也省給你看！」</p>
<p>「又有人刷新速度極限，睡覺時收到訊息很想裝死。要是再強一點就好了，又要等價交換什麼了嗎？只剩下生命了啊」</p>
<p>「相互學習競爭，別的實驗室好厲害啊，一不留意效能就輸了，得快點想辦法。」</p>
<p>「遇到第一次執行時慢 800 ms 左右，接下來都執行相同輸入又不見這消失的時間，難道是所謂的 library cache miss ? 可是執行檔不到 1 MB 耶。」</p>
<p>「照理來說，演算法迭代到後期的收斂是可預測的，所以硬體能猜測的效能會加快，從平行的結果卻是越跑越慢嗎？明明一開始贏了，後來卻輸了，咱不明白啊，一定是寫壞掉了」</p>
<p>「一早起床就發現相當疲勞，一打開批改娘就發現排名被刷掉。如果贏不了，起碼不能輸，不然這樣有辱實驗室之名！M 之神啊，請賜予我力量活著。不然沒有信心活下去 …」</p>
<p><img src="http://i.imgur.com/hCEuP2f.jpg" alt="「動用腦中所有的智慧考慮這個問題」－《熊巫女》"></p>
<p>事實上，這名跟我拚搏的學生只有一位 R04922075 古耕竹同學，就與 tmt514 談論的結果，一門課只需要有一位同學認真與助教一起學習就好，「一名足矣！」的精神已經深植我心。</p>
<p>後來才知道他之所以能在長時間拚搏都是因為住在實驗室裡，醒來就可以寫程式做實驗，累了就在實驗室睡，聽起來可是研究最高生活境界，當然聽起來是個廢人似的，但能省下龐大的住宿費相當吸引我，再加上在台北這種鬼地方，還得忍受每天一個多小時的通勤，先不談住宿有多昂貴，學校研究生宿舍不夠住真的不方便，不像以前中央大學，也許地理位置偏僻，研究生宿舍還一堆空位等著人去住呢！除非指導教授收不到學生，否則進住實驗室這件事情我還做不到啊。</p>
<p><img src="http://i.imgur.com/jFAVqtJ.jpg" alt="「我做不到啊」－《田中君總是如此慵懶》"></p>
<h3 id="出題考驗"><a href="#出題考驗" class="headerlink" title="出題考驗"></a>出題考驗</h3><p>老師每週只要求同學們撰寫幾支小程序，套用平行有快就好，但時候發生平行反而慢，或者不如預期效果時，通常是因為平行撰寫後，導致編譯器的優化等級起不來，可是老師又不想讓同學學習優化，在兩頭難的情況下，只好進行自主研究，包裝成線上評測只是單純方便實驗，為了減少 IO 導致實驗不準確，可是費了相當大的心力在思考如何出題。</p>
<p><img src="http://i.imgur.com/qMEqyld.jpg" alt="「你就隨便研究一下，然後自學吧！」－《田中君總是如此慵懶》"></p>
<p>在沒有任何經驗傳承下，大部分的程式碼都被學長摧毀，拼湊零碎的知識弄成一題，再寫各種版本進行測試，調校參數進行實驗，簡直是在做大規模的研究似的，每天都如此反覆地度過好幾個星期。</p>
<p><img src="http://i.imgur.com/OIgBxMV.jpg" alt="「現在我的心裡已經裝不下你了」－《田中君總是如此慵懶》"></p>
<p>思考如何解題、設計題目時，總會瞬間 CPU 全滿，誰也無法搶資源！這樣的日子過久了，覺得身心相當疲勞。</p>
<p><img src="http://i.imgur.com/fIs4P00.jpg" alt="「現在的我需要休息」－《熊巫女》"></p>
<p>到了學期後半，步入分散式計算的領域，但不知道能不能用單元測試的想法，建構出一套測試 Hadoop 題目的系統，雖然沒辦法完全模擬群集計算的環境，作為驗證程序正確性也有一定可靠性。採用 Hadoop Streaming 的方式進行 Judge。</p>
<blockquote>
<p>曾經未完成的夢，是否在這裡能找到答案？</p>
</blockquote>
<h2 id="超艱難修課進行式"><a href="#超艱難修課進行式" class="headerlink" title="超艱難修課進行式"></a>超艱難修課進行式</h2><h3 id="期中考"><a href="#期中考" class="headerlink" title="期中考"></a>期中考</h3><p>迎來在台大第二次期中考，遲遲無法適應這邊的考試方式，一部分原因也許是在以前學校大多都有考古題撐腰，而現在屬於無依無靠的情況下，又加上題目是一坨英文，看錯題目意思的機會太高，而在答題速度方面考試時間上會來不及，期中考變得一項大挑戰。其中一門課提供開書考，甚至允許同學上網搜尋答案，但是一打開試卷，突然冒出了一題「請看以下這一篇論文，然後回答下列問題」頓時的反射動作是直接跳過，經常看的英文論文通常是十幾頁在跳，考試時間兩個半小時，沒時間耗在這。</p>
<p>然而，在考試結束後，老師特別講到「作為一個研究生，看論文的能力很重要的」於是特地被老師點出來「你怎麼沒寫那一題呢？」只能苦笑地回應，在心中暗自地述說『因為我怕英文啊』那一題佔了 10% 成績，連看都沒看就放棄了，而那張試卷寫到最後一刻才把所有題目寫完，到底該不該慶幸沒去看那一題呢？</p>
<p><img src="http://i.imgur.com/fDijwFD.jpg" alt="「我一點兒也不知道」－《熊巫女》"></p>
<h2 id="心靈打擊"><a href="#心靈打擊" class="headerlink" title="心靈打擊"></a>心靈打擊</h2><p>這陣子受到強烈打擊，原因可以歸納出以下幾點：</p>
<ol>
<li>大學長火速交了女朋友並且擺脫魯蛇行列</li>
<li>弄了半天的環境，被橫插一行突然 PASS</li>
<li>寫得程序在不知名的情況下被女同學說很醜</li>
<li>程序一直寫不好、不快</li>
<li>愚蠢至極</li>
</ol>
<p>碩二學長則一直在暗示要抓交替，如報帳和財務管理、伺服器管理 … 等，準備進入三者皆無的狀態，徹底用到廢掉。</p>
<p><img src="http://i.imgur.com/gypx3yv.jpg" alt="「你真的被詛咒了嗎？」－《Re: 從零開始的異世界生活》"></p>
<h2 id="新生活挑戰"><a href="#新生活挑戰" class="headerlink" title="新生活挑戰"></a>新生活挑戰</h2><p>由於助教薪水大概一個月七千，但發送方式不是學校支付，拖了好幾個月才會到，當然一個月七千在台北吃飯，若要吃點好的，一個月七千一點也不夠，都到了這把歲數，還是要想辦法養活自己的一小部分吧。於是小夥伴表示「薪水到現在都還沒發出來，一個月六千哪能過生活。」最後在小夥伴的催促下，Morris 打開家教網找零工啦。但打電話是多麼令人害怕得一件事情 …</p>
<p><img src="http://i.imgur.com/ZJhzb86.jpg" alt="「我絕對不會這麼失敗的」－《田中君總是如此慵懶》"></p>
<p>被學長推去面試家教，明明都已經鼓起勇氣出發，卻又過程中潑冷水。去也不是，不去也不是，這搞得我好混亂，到底還能相信這世界什麼地方？</p>
<p><img src="http://i.imgur.com/hljjHxR.jpg" alt="「妳這麼關心我，真不好意思，其實你不用太在乎我的，我喜歡一個人待著。」－《田中君總是如此慵懶》"></p>
<h2 id="白活系列"><a href="#白活系列" class="headerlink" title="白活系列"></a>白活系列</h2><h3 id="加速-NPC"><a href="#加速-NPC" class="headerlink" title="加速 NPC"></a>加速 NPC</h3><p><img src="http://i.imgur.com/fR0IDd3.jpg" alt="「同樣都是人類，為什麼差距這麼大！」－《線上遊戲的老婆不可能是女生》"></p>
<p>當年在 NCPC 搞不出來的 Problem I Christmas Gifts (NP-hard)，在賽後用 DLX 運行效果不錯，在啟發函數加上延遲標記更是屹立排名前數位已久。最近又因為平行把題目挖回來討論，在去年釣到大一學弟來解，便以飛快的速度擊破測資，最後達到加速 20x。再把當初需要跑 30 秒的測資來運行，現在只需要短短的 50ms。而都這麼快了 … 應該不用平行吧。</p>
<h3 id="動態規劃"><a href="#動態規劃" class="headerlink" title="動態規劃"></a>動態規劃</h3><p>為了出題目，根據研究論文後的結果，出了一題常見的動態規劃題目，也就是 matrix chain multiplication，儘管算法最終可以加速到 $O(N^{\log_2 3})$，但在 30 年前就存在 matrix chain multiplication 的 $O(N \log N)$ 作法，那在 $O(N^3)$ 套了一堆剖分方便平行到底在窮忙什麼？</p>
<p>「當面對諸多選項時，我實在不曉得到底該選哪一個才不算錯。」當一個 Flag 打開之後，瞬間掉了不少 Performance …</p>
<h2 id="近期活動"><a href="#近期活動" class="headerlink" title="近期活動"></a>近期活動</h2><p>最近才把原本要出題目的測資補起來，論文誇張的加速似乎是跟非常非常蠢的版本比較，但快個兩三倍仍相當值得，編程複雜度也是增加兩三倍。各種層面的題目都已經全數實作好放上批改娘上提供線上評測。心想當研究一直發展下去，難道都不會窮盡？清單上的靶子長得越來越奇特，研究學者果真是一群變態啊。</p>
<p><img src="http://i.imgur.com/AUqO1eD.jpg" alt="「我已經失去活下去的信心」－《田中君總是如此慵懶》"></p>
<p>學期最後一堂 Workshop 結束，心裡總算舒坦了些，不用每周在廢物的羞恥 play 下度過。感謝上課同學們賜教予我！</p>
<p><img src="http://i.imgur.com/V3uOCmD.jpg" alt="「謝謝」－《田中君總是如此慵懶》"></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-diary-201606" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/29/diary-201606/" class="article-date">
  <time datetime="2016-06-29T11:56:18.000Z" itemprop="datePublished">2016-06-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/eHvfV1i.jpg" rel="gallery_ckkknaehx0032o4vrdivoelg7">
        <img src="http://i.imgur.com/eHvfV1i.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/29/diary-201606/">走在平行道路上－前篇</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/06/29/diary-201606/" data-id="ckkknaehx0032o4vrdivoelg7" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/06/29/diary-201606/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="前提摘要"><a href="#前提摘要" class="headerlink" title="前提摘要"></a>前提摘要</h2><p>這學期修課過得相當恐懼，期初上課就受到多方刺激，因為許多課第一堂都問說以前有沒有學過什麼，易想而知地，對學店逃出的我而言，只能默默在心中說「有聽過這個詞嗎？難道就沒辦法修課，這樣子根本沒有課程可以修。」幸好地，雖然沒有受過台大大學部課程的指導，大部分的內容以前都自己研究和玩過。</p>
<p>回頭看看，那些英文授課以及期末實作論文之類的，內心恐懼越來越深，而在下學期要報英文論文，學長因為連發音不正確或者用詞錯誤受到老師的深入指導，每一次開會都久戰一個多小時。而連基礎英文都只能靠 google 翻譯，為了確信實驗結果，都必須親自實作一番才行。腦子不斷地去喘測未來，估量這學期不間斷地抗戰的生活，然後還要受到老師嚴厲地批判。</p>
<p>接下來，就以圖文的方式回顧這一學期吧！</p>
<h2 id="解題相關"><a href="#解題相關" class="headerlink" title="解題相關"></a>解題相關</h2><p>逐漸地放下在 UVa Online Judge 的刷題日子，更沒有參與各種線上例行賽，由於曾經寫非常多的題目，仍然有不少人經常來詢問題目，不管是學校課程或者是 UVa 上的舊題目都會被拿來問。然而，有一些特殊案例是拿著世界總決賽等級的題目來問，一看就知道要寫個天昏地暗，說不定還不會的題目呢。</p>
<p><img src="http://i.imgur.com/yKnTlUf.jpg" alt="「來，請吧」-《為美好的世界獻上祝福》"></p>
<p>只是比別人稍微努力一點，對於高難度的題目反應是相當慢的。當然，我還是盡力回答，不過那陣子還要趕作業，閒暇時間一點也不想再開題目，一開下去不知道會不會一整天就過去，這樣可就沒辦法好好寫作業，滿腦子都是揮之不去的題目。所以有忽略一些人的提問，在此向大家說聲抱歉。</p>
<h2 id="實驗生活"><a href="#實驗生活" class="headerlink" title="實驗生活"></a>實驗生活</h2><h3 id="燃燒經費"><a href="#燃燒經費" class="headerlink" title="燃燒經費"></a>燃燒經費</h3><p>從碩一剛進來時，碩班學長已經擔任採購財務管理已經兩年，為什麼是兩年呢？這些就要留給本人來說，事實上這裡很多人都充滿兩年以上的回憶，若要成為這裡的一分子，負擔是非常沉重的。每學期都要消耗實驗室經費，經過半年的我仍然幫不上學長，沒有研究目標就不知道要怎麼樣的實驗環境，能提出的採購項目原則上都不會通過。</p>
<p><img src="http://i.imgur.com/rmSaE3L.jpg" alt="「對不起，我太沒用了」-《蒼之彼方的四重奏》"></p>
<p>那一陣子，由於要架設實驗室的群集計算，花了好個星期都沒辦法把網路架設好，一部分原因都是因為想要在虛擬機器如 Xen 上面維護，這時候網路設定和應用程式之間的權限開放變得困難，這些牽涉到軟體設計，參數總是不如預期地運作。</p>
<p>為了解決管理介面每天都睡不好，每到實驗室看著旁邊吵到不行的伺服器，不想接觸那無法運行的廢鐵們。這時候就提案買個 <strong>安眠藥</strong> 之類的，可想而知地被老師打槍，因不久之後因為課堂要使用，建造不起來的壓力非常大，再加上實驗室已經沒人有架設經驗，對系統比較熟的蕭大帥還要忙著畢業論文，只好用毅力嘗試架設。這故事的最後，採用原生的方式完成，暫時先別為了防止系統掛掉而採用虛擬化技術保護。</p>
<h3 id="巧遇英文"><a href="#巧遇英文" class="headerlink" title="巧遇英文"></a>巧遇英文</h3><p>蕭大帥學長看我破爛的英文，設想推薦我學習英文的方法，例如去學校語言中心聽力練習，或者到圖書館借閱英文文法書籍，又或者參與大一英文課程，然而都因為時間點不對，而且修課過重而沒有動力參加，英文帶來的恐懼對我來說不是一時造成的。但是看英文字幕的動畫不是問題，可惜地歐美翻譯速度慢，再加上翻譯味道對不上，一部分是文化上的不同，這導致要找到對應詞彙困難，有機會再來採用英文字幕看新番吧，擷圖一定非常有趣。</p>
<p><img src="http://i.imgur.com/CktUcN2.jpg" alt="「You were asleep for 15 years but still have a silver tongue」-《只有我不存在的街道》"></p>
<h3 id="路人搭訕"><a href="#路人搭訕" class="headerlink" title="路人搭訕"></a>路人搭訕</h3><p>每天過著早上九點左右到實驗室，晚上十一點左右回住的地方，其一原因是要避免上班族群和補習班下課學生。每天過著像上班族往常的通勤生活。</p>
<p>在某次下雨的夜晚，看到窗外的雨停了，便拿著來滴著雨水的傘提早離開，快速地走在人行道上，突然一旁有聲細語傳來「你正要回家嗎？」轉過頭來看，原來是名剛打完工妹子，心想『還好不是什麼怪人，但主動跟我搭話也有一點怪人成份吧？』心中充滿地慌張回道「是的，剛從實驗室離開。」</p>
<p>「哦，你是研究生嗎？我剛從打工那裡下班。今天都沒有少收錢，超開心的，之前經常少收錢」帶著愉悅的語調回道<br>「辛苦你啦，你在活動中心打工嗎？」因為沒見過面的面孔，為了確定身分還是問些資訊來吧。<br>「嗯嗯，在麥當勞打工。」<br>『…』帶有疑惑地，可是我一點也沒印象，去過幾次麥當勞，但店員的年齡對不上的。<br>「不過我都在內場忙，所以可能沒有見過吧。」</p>
<p>聊著聊著都走到捷運站上，一路上只應答一些簡單的句子，突然來個人靠在身邊聊天，難免不受到驚嚇。到了捷運站，一般都直接走樓梯而沒有特地走到有電扶梯的入口，也許就因為要跟著我走</p>
<p>「可以借我攙著嗎？」她攙著我的胳膊走下去，這時候幼小的心靈受到沉重打擊。<br>「你有在練肌肉嗎？感覺是有肌肉的觸感 …」<br>「沒啦！」聽到內心不斷地尖叫、嘶吼，這一切都來得太突然。</p>
<p><img src="http://i.imgur.com/vVeeJVB.jpg" alt="「確實在啊，腦子不正常的孩子。」-《為美好的世界獻上祝福》"></p>
<p>看來經常到實驗室打混的日子，導致逐漸地看到幻覺，總算可以達到擴充實境的地步，由衷地敬佩自己。</p>
<h3 id="算法數學分析"><a href="#算法數學分析" class="headerlink" title="算法數學分析"></a>算法數學分析</h3><p>經由學長的推薦，選修陳文進老師的「演算法數學分析」課程，這門課可說是各種演算法常見的數論技巧，在競賽中也非常容易見到，但從看過數學家是如何定義這些符號以及運算性質，這門課可說是增廣嚴謹數學定義與工具的好課。</p>
<p>然而，每週寫起作業來非常刺激，雖然水泥數學課本〈Concrete Mathematics〉大部分都有提供解答，但是解法就不太明確，有提供驗證答案正確性的參考，於是乎有各種神妙的解法，甚至不用套用課程所講的一些技法，老師也非常鼓勵同學用一些已知的知識來推論答案，有時還比教科書來得簡單扼要。</p>
<p>寫起作業每次大概花了一天到兩天，每週一個章節，老師沒講到的章節要自行閱讀，難度不會太高，花點時間坑一下基本上都能完成。作業推論則是經過一個星期的哀嚎，有時候六日推不出來，放著過好幾天才突然想到，數學的美妙近在眼前卻總是差一步就能推出。</p>
<p><img src="http://i.imgur.com/7tpuCB0.jpg" alt="「大家就愉快地化為塵土吧」-《為美好的世界獻上祝福》"></p>
<p>由於這門課已經很久沒開，沒法找到合適的人選擔任助教，而常見的球員兼裁判的人選卻不選這門課，於是每週作業大家輪著改。有一次我改大家的作業，看到許多神奇的寫法，但也非常地痛苦，腦補了好幾十分鐘仍猜不出這傢伙在寫什麼，而我們寫程式的人，又經常失去一些數學常識，如 <strong>程式的等號和數學的等號是不相同的</strong>。若這門課程有助教，這助教一定會崩潰的！</p>
<h3 id="奴工打雜"><a href="#奴工打雜" class="headerlink" title="奴工打雜"></a>奴工打雜</h3><p>老闆又叫我把批改娘架設給 Data Structrue and Algorithm (簡稱 DSA) 課程使用，雖然跟他們實驗室要了一台 伺服器安裝，經過三番測試終於架設起來，只有稍微跟他們說明如何建置題目和加入使用者。畢竟是做免錢的，剩下就看他們造化。</p>
<p>沒想到最後還是採用老方法，繼承他們 DSA 去年的腳本改作業，畢竟要設置批改系統非常不容易。而上次交給電機系使用，他們成功地運作這到讓我感到意外，資工系反而沒有花時間架起來玩。</p>
<p>過了不久收到 DSA 課程來信要徵助教，想到已經擔任一門課助教，再一門會往生，有人還認為我會想去當 DSA 的助教呢？若是當了，早就來一場助教與學生之間的效能拚搏，想到若要協助架設批改系統，多麼令人感到戰慄。</p>
<p><img src="http://i.imgur.com/gYcmE2D.jpg" alt="《無彩限的幻影世界》"></p>
<h3 id="超艱難修課挑戰"><a href="#超艱難修課挑戰" class="headerlink" title="超艱難修課挑戰"></a>超艱難修課挑戰</h3><p>清明連假都在寫作業，每天都看似好像有點進展，程序仍然沒辦法跑。覺得程式越寫越退化，退化到與組語奮戰。覺得各課程作業非常噁心，一年抵四年所學，都覺得快被後輩看起來認定是個廢物。如果寫不出來，是不是都是我的錯呢？</p>
<p><img src="http://i.imgur.com/0H6QdG2.jpg" alt="「不全都是你的錯嗎？」《好想大聲說出心底的話》"></p>
<p>看著作業需要的 LLVM API，看不懂文件只好猜呀猜，針對文件窮舉各種英文姿勢，歷經崩潰的驗證思路後，才察覺流程果然有點詭異，確定描述上的瑕疵後，換個思路打掉重來吧！也許還需要寫點測試，才能知道到底有沒有寫對。於是作業又再次進入輪迴，進度從零開始！</p>
<h2 id="平行助教"><a href="#平行助教" class="headerlink" title="平行助教"></a>平行助教</h2><h3 id="提前研究"><a href="#提前研究" class="headerlink" title="提前研究"></a>提前研究</h3><p>在學期開始前，預想而知地會受到老闆指派當平行程式助教，從上學期 C 語言程式助教那時開始，平行設計的課堂題目就開始實驗，把平行題目放上批改娘系統上，沒想到大一新生也有嘗試去解決那些題目，台大新生的學習能力遠遠超出我的想像。</p>
<p>研究如何平行程式不算難，但是寫得好與壞差別很多，大部分的情況都會快上一些，慘的時候甚至會慢上數倍，經過一層層地解析，研究為什麼會變慢，慢是因為什麼因素所導致？是架構嗎？還是運行流程？又或者是算法重複計算？當遇到瓶頸的時候，只能埋頭苦幹地研究，深刻地體會到研究並不會提升智力，只是增加知識層面而已，像我這種笨蛋卻過著研究生活，怎麼想都奇怪呢！</p>
<p><img src="http://i.imgur.com/NHvqBMk.jpg" alt="「也不會提升智力了」-《為美好的世界獻上祝福》"></p>
<h3 id="優化挑戰"><a href="#優化挑戰" class="headerlink" title="優化挑戰"></a>優化挑戰</h3><p>平行不只有平行，牽涉到硬體架構，隨著平行的需求所進行的算法設計，若整個算法對硬體友不友善，將會影響程式的快慢。最常見的就是快取問題，第一個遇到的是 Structure Of Array / Array Of Structure 的不同，針對使用層面，沒想到他們居然會差異到 10 ~ 20% 效能差異，也就是遠本跑 50 秒的程式，居然可以提升到 40 秒內跑完，若要發這種論文，想必需要知道很多硬體設計。</p>
<p><img src="http://i.imgur.com/inFI4p6.jpg" alt="「Study Hard」－《無彩限的幻影世界》"></p>
<h3 id="製作批改系統"><a href="#製作批改系統" class="headerlink" title="製作批改系統"></a>製作批改系統</h3><p>如果沒有正常執行完畢，莫名其妙伺服器的內存量增加，也找不到地方砍，重啟顯卡也沒辦法解決，眼睜睜地看著內存爆炸。OpenCL 要製作成 Judge 題目還有一段路要走，每次 Judge 就重新啟動 Server 是最慘的抉擇。</p>
<p><img src="http://i.imgur.com/Ldivp9f.jpg" alt="「這跟說好的不一樣啊？」－《Re: 從零開始的異世界生活》"></p>
<p>大致上知道 Memory Leak 的出現點，不管是程序有錯或被強制中斷都來不及執行釋放，少釋放一個物件造成內存少 100MB，經過兩三百個案例就得重開機。暫時解決方案是寫腳本偵測記憶體用量，指定超過用量自動重開，一旦沒寫好將變成不斷地重開。</p>
<p>好不容易架設好批改系統，但是測速度有嚴重的啟動損耗，有時候在沙盒裡面運行還特別慢，當只裝 nVidia driver，啟動 OpenCL 基本消耗一秒多。為了使用 Profiler，意外地安裝 CUDA 相關插件，頓時啟動消耗變成毫秒等級。為了解決這奇怪的現象，還一度把伺服器搞壞，整台重灌才順利解決。</p>
<p><img src="http://i.imgur.com/HZOgbzy.jpg" alt="《為美好的世界獻上祝福》"></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/6/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/85/">85</a><a class="extend next" rel="next" href="/page/8/">Next &raquo;</a>
    </nav>
  
</section>
          
          
            <aside id="sidebar">
  <!-- <div id="ukagaka_panel"></div> -->
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">115</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算機圖學/">計算機圖學</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/">工作應用</a><span class="category-list-count">29</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Java/">Java</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Meme/">Meme</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/可持久化/">可持久化</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/鬼故事/">鬼故事</a><span class="category-list-count">9</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">44</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">633</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">483</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">77</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">45</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2021/01/31/diary-202101/">
              
                <i class="icon-file-o"></i> 
              
            二八進展</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-interview-recursion/">
              
                <i class="icon-file-o"></i> 
              
            Interview &amp; Recursion</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-lang/">
              
                <i class="icon-file-o"></i> 
              
            Programming Language Impostors</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-handover/">
              
                <i class="icon-file-o"></i> 
              
            Handover</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-wfh-overwork/">
              
                <i class="icon-file-o"></i> 
              
            Work from Home &amp; Overwork Survey</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-parallel-unstable/">
              
                <i class="icon-file-o"></i> 
              
            Parallel &amp; Unstable</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-file-extension/">
              
                <i class="icon-file-o"></i> 
              
            File Extension</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-parallel-gc/">
              
                <i class="icon-file-o"></i> 
              
            Parallel &amp; Garbage Collection</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-job-build/">
              
                <i class="icon-file-o"></i> 
              
            Job Build</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-globl-var/">
              
                <i class="icon-file-o"></i> 
              
            Global Variable</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
<script type="text/javascript">
  $('#ukagaka_panel').ukagaka();
</script>
  
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2021 Shiang-Yun Yang 
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>