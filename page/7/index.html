<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Morris&#39; Blog">
<meta property="og:url" content="http://morris821028.github.io/page/7/index.html">
<meta property="og:site_name" content="Morris&#39; Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris&#39; Blog">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
  <!-- <link rel="import" href="/bower_components/app-layout/app-layout.html"> --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          
          <section id="main">
  
    <article id="post-uva-12310" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/08/uva-12310/" class="article-date">
  <time datetime="2018-07-08T07:32:38.000Z" itemprop="datePublished">2018-07-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/08/uva-12310/">UVa 12310 - Point Location</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2018/07/08/uva-12310/" data-id="ckw8q9fyl00psqwvn46ui4rg0" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2018/07/08/uva-12310/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Point-Location/">Point Location</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kd-tree/">kd-tree</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/幾何/">幾何</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/線段樹/">線段樹</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/計算幾何/">計算幾何</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>給定一平面上 <span>$n$</span><!-- Has MathJax --> 個點，接著拉 <span>$m$</span><!-- Has MathJax --> 個線段拼湊成不相交的區域，並將標記數個點位置所在的區域。接著有數個詢問「點在哪一個先前標記的同一區域內」。</p>
<p>這一問題常在幾何處理中出現，詳細可查閱 <a href="https://en.wikipedia.org/wiki/Point_location" target="_blank" rel="external">Wikipedia - Point location</a>，在此不額外說明。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">14 16 5 5</div><div class="line">0 0</div><div class="line">30 0</div><div class="line">40 0</div><div class="line">60 0</div><div class="line">60 50</div><div class="line">0 50</div><div class="line">20 40</div><div class="line">10 10</div><div class="line">30 10</div><div class="line">30 20</div><div class="line">40 20</div><div class="line">50 30</div><div class="line">50 40</div><div class="line">30 40</div><div class="line">1 2</div><div class="line">2 9</div><div class="line">9 8</div><div class="line">8 7</div><div class="line">7 9</div><div class="line">9 10</div><div class="line">10 11</div><div class="line">11 3</div><div class="line">3 4</div><div class="line">4 5</div><div class="line">5 6</div><div class="line">6 1</div><div class="line">12 13</div><div class="line">13 14</div><div class="line">14 12</div><div class="line">2 3</div><div class="line">20 20</div><div class="line">10 20</div><div class="line">35 10</div><div class="line">45 39</div><div class="line">1 60</div><div class="line">28 11</div><div class="line">29 14</div><div class="line">34 7</div><div class="line">40 38</div><div class="line">70 1</div><div class="line">0 0 0 0</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><h3 id="Previously"><a href="#Previously" class="headerlink" title="Previously"></a>Previously</h3><p>在大學修計算幾何的時候，知道這一類的題目要透過梯形剖分的方式，搭配的資料結構類似四分樹，分隔的基準是一個線段，將線段兩個端點分別拉出無限延長的垂直線，但這方法對於線段本身是垂直時，處理情況比較複雜，那時構思了好幾天沒個底，只好放棄。現在，在 Cadence 公司上班快滿一年，解決幾何操作不在少數，成長的我應該能解決這一題了吧。</p>
<h3 id="Detail"><a href="#Detail" class="headerlink" title="Detail"></a>Detail</h3><ul>
<li>相關問題 <a href="http://www.csie.ntnu.edu.tw/~u91029/Triangulation.html#4" target="_blank" rel="external">演算法筆記 - Polygon Partition / Polygon Trapezoidalization</a></li>
</ul>
<p>題目已經保證給予的線段除了端點外，彼此之間不會相交任何一點。便可以對所有線段建立空間分割相關的資料結構，好讓我們對於解決，從詢問點出發往 <span>$y$</span><!-- Has MathJax --> 無窮遠的射線，最後會打到哪一個線段。</p>
<p>處理的流程如下：</p>
<p><img src="https://i.imgur.com/GO1qBfd.png" alt="Step 1. 輸入線段"></p>
<p><img src="https://i.imgur.com/lJNUxQd.png" alt="Step 2. 套上邊界，需要能包含所有詢問點"></p>
<p><img src="https://i.imgur.com/kRrihgw.png" alt="Step 3. 對每一個相連的線段集合，找出 $y$ 軸最高的點，放出輔助射線"></p>
<p><img src="https://i.imgur.com/LQfivUD.png" alt="Step 4. 對每一個頂點進行極角排序，進行繞行分組"></p>
<p>首先，對於幾何剖分的問題，為處理方便，都會套上一個無限大的外框，把所有頂點包在裡面。你可以透過 GeoGebra 這套數學軟體，將處理過程中的資料丟進去，方便你除錯。如果要批次輸入一大筆，請透過上方的建立按鈕 (Button)，將 command 的語法以行為單位放入，語法類似 javascript。</p>
<p>接著，我們需要對每一個線段集合的最高點放出輔助射線 (這部分已經縮減了不少，原則上對每一個頂點放出射線也可以)，這些輔助射線用來解決內部的孤立形，要把整個圖串成一個連通圖。否則，當詢問屬於內部的孤立形狀的外部時，我們會缺少足夠的資訊連到包含這個孤立形的外框。</p>
<p>最後，對每一個頂點相連的邊進行極角排序，接著才能決定相鄰的邊，而任兩個相鄰的邊所夾的區域屬於同一個集合，因此我們需要對每一個有方向的邊進行編號，將邊與邊合併到同一個集合。對於每一個詢問，只需要對詢問點放出射線找到接觸的線段，便可以知道所在的集合。</p>
<ul>
<li>若使用 KD tree，即使交替選擇 <span>$x$</span><!-- Has MathJax -->-<span>$y$</span><!-- Has MathJax --> 軸分割，也沒辦法保證樹高。因為處理的是線段，而不是點，每一次挑選的分隔軸，將會產生三個子樹，中間的子樹為與分隔軸相交的線段。在大部分的情況下，整體時間複雜度落在 <span>$O(n \log n)$</span><!-- Has MathJax -->，空間複雜度 <span>$O(n)$</span><!-- Has MathJax --> 。</li>
<li>若使用線段樹，將在 <span>$x$</span><!-- Has MathJax --> 軸上劃分，每一個線段至多被拆成 <span>$O(\log n)$</span><!-- Has MathJax --> 個，詢問射線第一個碰觸的線段時，單一詢問的時間複雜度 <span>$O(\log n)$</span><!-- Has MathJax -->，常數相較於 KD tree 多。整體時間複雜度落在 <span>$O(n \log n)$</span><!-- Has MathJax -->，空間複雜度 <span>$O(n \log n)$</span><!-- Has MathJax --> 。</li>
</ul>
<p>還有許多 spatial data structure 可以考慮，這裡只挑選兩個出來實驗，上述皆為在線算法。也可以將所有操作離線，這時候將套用掃描線算法，但對於垂直線段如何在算法中維護二元樹，目前遇到一些實作上的問題，這將在未來才能給各位參考。</p>
<h3 id="KD-tree"><a href="#KD-tree" class="headerlink" title="KD tree"></a>KD tree</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt; </span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">float</span> eps = <span class="number">1e-6</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">float</span> BOX_MX = <span class="number">2000000</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pt</span> &#123;</span></div><div class="line">    <span class="keyword">float</span> x, y;</div><div class="line">    Pt() &#123;&#125;</div><div class="line">    Pt(<span class="keyword">float</span> a, <span class="keyword">float</span> b): x(a), y(b) &#123;&#125;</div><div class="line">    Pt <span class="keyword">operator</span>-(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Pt(x - a.x, y - a.y); &#125;</div><div class="line">    Pt <span class="keyword">operator</span>+(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Pt(x + a.x, y + a.y); &#125;</div><div class="line">    Pt <span class="keyword">operator</span>*(<span class="keyword">const</span> <span class="keyword">double</span> a) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Pt(x * a, y * a);  &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">fabs</span>(x - a.x) &gt; eps)	<span class="keyword">return</span> x &lt; a.x;</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">fabs</span>(y - a.y) &gt; eps)	<span class="keyword">return</span> y &lt; a.y;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">fabs</span>(x - a.x) &lt; eps &amp;&amp; <span class="built_in">fabs</span>(y - a.y) &lt; eps;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">println</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">    	<span class="built_in">printf</span>(<span class="string">"(%lf, %lf)\n"</span>, x, y);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Seg</span> &#123;</span></div><div class="line">    Pt s, e;</div><div class="line">    <span class="keyword">int</span> i;</div><div class="line">    Seg() &#123;&#125;</div><div class="line">    Seg(Pt a, Pt b, <span class="keyword">int</span> i):s(a), e(b), i(i) &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">println</span><span class="params">()</span> </span>&#123;</div><div class="line">    	<span class="built_in">printf</span>(<span class="string">"Segment((%lf, %lf), (%lf, %lf))\n"</span>, s.x, s.y, e.x, e.y);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">dot</span><span class="params">(Pt a, Pt b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> a.x * b.x + a.y * b.y;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">cross</span><span class="params">(Pt o, Pt a, Pt b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (a.x-o.x)*(b.y-o.y)-(a.y-o.y)*(b.x-o.x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">cross2</span><span class="params">(Pt a, Pt b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> a.x * b.y - a.y * b.x;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">between</span><span class="params">(Pt a, Pt b, Pt c)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> dot(c - a, b - a) &gt;= -eps &amp;&amp; dot(c - b, a - b) &gt;= -eps;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">onSeg</span><span class="params">(Pt a, Pt b, Pt c)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> between(a, b, c) &amp;&amp; <span class="built_in">fabs</span>(cross(a, b, c)) &lt; eps;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmpZero</span><span class="params">(<span class="keyword">float</span> v)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="built_in">fabs</span>(v) &gt; eps) <span class="keyword">return</span> v &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">-1</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Pt <span class="title">getIntersect</span><span class="params">(Seg a, Seg b)</span> </span>&#123;</div><div class="line">    Pt u = a.s - b.s;</div><div class="line">    <span class="keyword">double</span> t = cross2(b.e - b.s, u)/cross2(a.e - a.s, b.e - b.s);</div><div class="line">    <span class="keyword">return</span> a.s + (a.e - a.s) * t;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AngleCmp</span> &#123;</span></div><div class="line">    Pt o;</div><div class="line">    AngleCmp(Pt o = Pt()):o(o) &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="keyword">const</span> pair&lt;Pt, <span class="keyword">int</span>&gt;&amp; ppa, <span class="keyword">const</span> pair&lt;Pt, <span class="keyword">int</span>&gt;&amp; ppb)</span> </span>&#123;</div><div class="line">        Pt pa = ppa.first, pb = ppb.first;</div><div class="line">        Pt p1 = pa - o, p2 = pb - o;</div><div class="line">        <span class="keyword">if</span> (p1.y == <span class="number">0</span> &amp;&amp; p2.y == <span class="number">0</span> &amp;&amp; p1.x * p2.x &lt;= <span class="number">0</span>) <span class="keyword">return</span> p1.x &gt; p2.x;</div><div class="line">        <span class="keyword">if</span> (p1.y == <span class="number">0</span> &amp;&amp; p1.x &gt;= <span class="number">0</span> &amp;&amp; p2.y != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">        <span class="keyword">if</span> (p2.y == <span class="number">0</span> &amp;&amp; p2.x &gt;= <span class="number">0</span> &amp;&amp; p1.y != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span> (p1.y * p2.y &lt; <span class="number">0</span>) <span class="keyword">return</span> p1.y &gt; p2.y;</div><div class="line">        <span class="keyword">double</span> c = cross2(p1, p2);</div><div class="line">        <span class="keyword">return</span> c &gt; <span class="number">0</span> || (c == <span class="number">0</span> &amp;&amp; <span class="built_in">fabs</span>(p1.x) &lt; <span class="built_in">fabs</span>(p2.x));</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">static</span> Pt pts[<span class="number">10005</span>];</div><div class="line"><span class="keyword">static</span> Seg segs[<span class="number">30005</span>];</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BSP</span> &#123;</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">60005</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXNODE = <span class="number">60005</span>;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">        <span class="keyword">float</span> lx, ly, rx, ry;</div><div class="line">        Node *ls, *ms, *rs;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">extend</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</div><div class="line">                <span class="keyword">return</span> ;</div><div class="line">            lx = min(lx, u-&gt;lx), ly = min(ly, u-&gt;ly);</div><div class="line">            rx = max(rx, u-&gt;rx), ry = max(ry, u-&gt;ry);</div><div class="line">        &#125;</div><div class="line">    &#125; nodes[MAXNODE];</div><div class="line">    <span class="keyword">int</span> sn[MAXNODE];</div><div class="line">    Seg *seg[MAXNODE];</div><div class="line">    <span class="keyword">float</span> axis[MAXN];</div><div class="line">    Node *root;</div><div class="line">    <span class="keyword">int</span> size;</div><div class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</div><div class="line">        Node *p = &amp;nodes[size++];</div><div class="line">        assert(size &lt; MAXNODE);</div><div class="line">        p-&gt;ls = p-&gt;ms = p-&gt;rs = <span class="literal">NULL</span>;</div><div class="line">        sn[p-nodes] = <span class="number">0</span>;</div><div class="line">        <span class="keyword">return</span> p;</div><div class="line">    &#125;</div><div class="line">    Node* _build(<span class="keyword">int</span> k, Seg segs[], <span class="keyword">int</span> n) &#123;</div><div class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">        <span class="keyword">if</span> (k == <span class="number">2</span>)</div><div class="line">            k = <span class="number">0</span>;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> Lsize = <span class="number">0</span>, Msize = <span class="number">0</span>, Rsize = <span class="number">0</span>;</div><div class="line">        Seg *L = <span class="literal">NULL</span>, *M = <span class="literal">NULL</span>, *R = <span class="literal">NULL</span>;</div><div class="line">        <span class="keyword">if</span> (k == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">                axis[i&lt;&lt;<span class="number">1</span>] = segs[i].s.x, axis[i&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] = segs[i].e.x;</div><div class="line">            nth_element(axis, axis+n, axis+<span class="number">2</span>*n);</div><div class="line">            <span class="keyword">const</span> <span class="keyword">float</span> mval = axis[n];</div><div class="line">            L = segs;</div><div class="line">            R = <span class="built_in">std</span>::partition(segs, segs+n, [mval](<span class="keyword">const</span> Seg &amp;s) &#123;</div><div class="line">            	<span class="keyword">return</span> max(s.s.x, s.e.x) &lt;= mval;</div><div class="line">        	&#125;);</div><div class="line">        	M = <span class="built_in">std</span>::partition(R, segs+n, [mval](<span class="keyword">const</span> Seg &amp;s) &#123;</div><div class="line">            	<span class="keyword">return</span> min(s.s.x, s.e.x) &lt;= mval;</div><div class="line">        	&#125;);</div><div class="line">        	Msize = segs+n - M;</div><div class="line">        	Rsize = M - R;</div><div class="line">        	Lsize = R - segs;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">                axis[i&lt;&lt;<span class="number">1</span>] = segs[i].s.y, axis[i&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] = segs[i].e.y;</div><div class="line">            nth_element(axis, axis+n, axis+<span class="number">2</span>*n);</div><div class="line">            <span class="keyword">const</span> <span class="keyword">float</span> mval = axis[n];</div><div class="line">            L = segs;</div><div class="line">            R = <span class="built_in">std</span>::partition(segs, segs+n, [mval](<span class="keyword">const</span> Seg &amp;s) &#123;</div><div class="line">            	<span class="keyword">return</span> max(s.s.y, s.e.y) &lt;= mval;</div><div class="line">        	&#125;);</div><div class="line">        	M = <span class="built_in">std</span>::partition(R, segs+n, [mval](<span class="keyword">const</span> Seg &amp;s) &#123;</div><div class="line">            	<span class="keyword">return</span> min(s.s.y, s.e.y) &lt;= mval;</div><div class="line">        	&#125;);</div><div class="line">        	Msize = segs+n - M;</div><div class="line">        	Rsize = M - R;</div><div class="line">        	Lsize = R - segs;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        Node *u = newNode();</div><div class="line">        u-&gt;lx = BOX_MX, u-&gt;ly = BOX_MX; </div><div class="line">        u-&gt;rx = -BOX_MX, u-&gt;ry = -BOX_MX;</div><div class="line">        <span class="keyword">if</span> (Lsize == n || Rsize == n || Msize == n) &#123;</div><div class="line">            sn[u - nodes] = n, seg[u - nodes] = segs;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">                u-&gt;lx = min(u-&gt;lx, min(segs[i].s.x, segs[i].e.x));</div><div class="line">                u-&gt;rx = max(u-&gt;rx, max(segs[i].s.x, segs[i].e.x));</div><div class="line">                u-&gt;ly = min(u-&gt;ly, min(segs[i].s.y, segs[i].e.y));</div><div class="line">                u-&gt;ry = max(u-&gt;ry, max(segs[i].s.y, segs[i].e.y));</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            u-&gt;ls = _build(k+<span class="number">1</span>, L, Lsize), u-&gt;extend(u-&gt;ls);</div><div class="line">            u-&gt;ms = _build(k+<span class="number">1</span>, M, Msize), u-&gt;extend(u-&gt;ms);</div><div class="line">            u-&gt;rs = _build(k+<span class="number">1</span>, R, Rsize), u-&gt;extend(u-&gt;rs);</div><div class="line">        &#125;		</div><div class="line">        <span class="keyword">return</span> u;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build_tree</span><span class="params">(Seg s[], <span class="keyword">int</span> m)</span> </span>&#123;</div><div class="line">        size = <span class="number">0</span>;</div><div class="line">        root = _build(<span class="number">0</span>, s, m);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    Pt q_st, q_ed;</div><div class="line">    <span class="keyword">int</span> q_si;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rayhit</span><span class="params">(Seg &amp;seg)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (seg.s.x == seg.e.x) &#123;</div><div class="line">            <span class="keyword">if</span> (cmpZero(seg.s.x - q_st.x) == <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">double</span> low = min(seg.s.y, seg.e.y);</div><div class="line">                <span class="keyword">if</span> (low &gt; q_st.y &amp;&amp; low &lt; q_ed.y) &#123;</div><div class="line">                    q_ed.y = low;</div><div class="line">                    q_si = seg.i;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (max(seg.s.x, seg.e.x) &lt; q_st.x || min(seg.s.x, seg.e.x) &gt; q_st.x)</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">float</span> y = seg.s.y + (<span class="keyword">float</span>) (seg.e.y - seg.s.y) * (q_st.x - seg.s.x) / (seg.e.x - seg.s.x);</div><div class="line">        <span class="keyword">if</span> (y &gt; q_st.y &amp;&amp; y &lt; q_ed.y) &#123;</div><div class="line">            q_ed.y = y;</div><div class="line">            q_si = seg.i;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">if</span> (u-&gt;lx &gt; q_st.x || u-&gt;rx &lt; q_st.x || u-&gt;ry &lt;= q_st.y || u-&gt;ly &gt;= q_ed.y)</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sn[u - nodes]; i++)</div><div class="line">            rayhit(seg[u - nodes][i]);</div><div class="line">        search(u-&gt;ls);</div><div class="line">        search(u-&gt;ms);</div><div class="line">        search(u-&gt;rs);</div><div class="line">    &#125;</div><div class="line">    pair&lt;<span class="keyword">int</span>, Pt&gt; raycast(Pt st) &#123;</div><div class="line">        q_st = st; </div><div class="line">        q_ed = Pt(st.x, BOX_MX+<span class="number">1</span>);</div><div class="line">        q_si = <span class="number">-1</span>;</div><div class="line">        search(root);</div><div class="line">        <span class="keyword">return</span> &#123;q_si, q_ed&#125;;</div><div class="line">    &#125;</div><div class="line">&#125; tree;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Disjoint</span> &#123;</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">65536</span>;</div><div class="line">    <span class="keyword">uint16_t</span> parent[MAXN], weight[MAXN];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (n &gt;= MAXN)</div><div class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++)</div><div class="line">            parent[i] = i, weight[i] = <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findp</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> parent[x] == x ? x : parent[x] = findp(parent[x]);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">joint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        x = findp(x), y = findp(y);</div><div class="line">        <span class="keyword">if</span> (weight[x] &gt;= weight[y])</div><div class="line">            parent[y] = x, weight[x] += weight[y];</div><div class="line">        <span class="keyword">else</span></div><div class="line">            parent[x] = y, weight[y] += weight[x];</div><div class="line">    &#125;	</div><div class="line">&#125; egroup, sgroup;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n, m, p, q;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d %d %d"</span>, &amp;n, &amp;m, &amp;p, &amp;q) == <span class="number">4</span> &amp;&amp; n) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            <span class="keyword">int</span> x, y;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;x, &amp;y);</div><div class="line">            pts[i] = Pt(x, y);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        sgroup.init(n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="keyword">int</span> st_i, ed_i;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;st_i, &amp;ed_i);</div><div class="line">            st_i--, ed_i--;</div><div class="line">            segs[i] = Seg(pts[st_i], pts[ed_i], i);</div><div class="line">            sgroup.joint(st_i, ed_i);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        segs[m] = Seg(Pt(BOX_MX, BOX_MX), Pt(BOX_MX, -BOX_MX), m), m++;</div><div class="line">        segs[m] = Seg(Pt(BOX_MX, -BOX_MX), Pt(-BOX_MX, -BOX_MX), m), m++;</div><div class="line">        segs[m] = Seg(Pt(-BOX_MX, -BOX_MX), Pt(-BOX_MX, BOX_MX), m), m++;</div><div class="line">        segs[m] = Seg(Pt(-BOX_MX, BOX_MX), Pt(BOX_MX, BOX_MX), m), m++;</div><div class="line">        </div><div class="line">        <span class="keyword">static</span> <span class="built_in">map</span>&lt;Pt, <span class="built_in">vector</span>&lt;pair&lt;Pt, <span class="keyword">uint8_t</span>&gt;&gt;&gt; g; g.clear();</div><div class="line">        <span class="keyword">static</span> <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;Pt&gt;&gt; on_seg; on_seg.clear(); on_seg.resize(m);</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            on_seg[segs[i].i].reserve(<span class="number">4</span>);</div><div class="line">            on_seg[segs[i].i].push_back(segs[i].s);</div><div class="line">            on_seg[segs[i].i].push_back(segs[i].e);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line"><span class="comment">//		for (int i = 0; i &lt; n; i++)</span></div><div class="line"><span class="comment">//			pts[i].println();</span></div><div class="line"><span class="comment">//		for (int i = 0; i &lt; m; i++)</span></div><div class="line"><span class="comment">//			segs[i].println();</span></div><div class="line"></div><div class="line">        tree.build_tree(segs, m);</div><div class="line">        &#123;</div><div class="line">            Pt top[<span class="number">10005</span>];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">                top[i] = pts[i];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">                <span class="keyword">int</span> gid = sgroup.findp(i);</div><div class="line">                <span class="keyword">if</span> (top[gid].y &lt; pts[i].y)</div><div class="line">                    top[gid] = pts[i];</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (sgroup.findp(i) != i)</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">auto</span> p = top[i];</div><div class="line">                <span class="keyword">auto</span> hit = tree.raycast(p);</div><div class="line">                <span class="keyword">if</span> (hit.first &gt;= <span class="number">0</span>) &#123;</div><div class="line">                    on_seg[hit.first].emplace_back(hit.second);</div><div class="line">                    g[p].emplace_back(hit.second, <span class="number">1</span>);</div><div class="line">                    g[hit.second].emplace_back(p, <span class="number">1</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="built_in">vector</span>&lt;Pt&gt; &amp;a = on_seg[i];</div><div class="line">            sort(a.begin(), a.end());</div><div class="line">            a.resize(unique(a.begin(), a.end()) - a.begin());</div><div class="line">            <span class="keyword">auto</span> *prev = &amp;g[a[<span class="number">0</span>]];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; a.size(); j++) &#123;</div><div class="line">                prev-&gt;emplace_back(a[j], <span class="number">0</span>);</div><div class="line">                prev = &amp;g[a[j]];</div><div class="line">                prev-&gt;emplace_back(a[j<span class="number">-1</span>], <span class="number">0</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : g)</div><div class="line">            sort(e.second.begin(), e.second.end(), AngleCmp(e.first));</div><div class="line">        </div><div class="line">        <span class="keyword">static</span> <span class="built_in">map</span>&lt;Pt, <span class="built_in">map</span>&lt;Pt, <span class="keyword">int</span>&gt;&gt; R; R.clear();</div><div class="line">        <span class="keyword">int</span> Rsize = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : g) &#123;</div><div class="line">            <span class="keyword">int</span> sz = e.second.size();</div><div class="line">            <span class="built_in">map</span>&lt;Pt, <span class="keyword">int</span>&gt; &amp;Rg = R[e.first];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;f : e.second) &#123;</div><div class="line">                <span class="keyword">int</span> &amp;eid = Rg[f.first];</div><div class="line">                <span class="keyword">if</span> (eid == <span class="number">0</span>)</div><div class="line">                    eid = ++Rsize;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        egroup.init(Rsize);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : g) &#123;</div><div class="line">            <span class="keyword">int</span> sz = e.second.size();</div><div class="line">            <span class="built_in">map</span>&lt;Pt, <span class="keyword">int</span>&gt; &amp;Rg = R[e.first];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = sz<span class="number">-1</span>, j = <span class="number">0</span>; j &lt; sz; i = j++) &#123;</div><div class="line">                <span class="keyword">int</span> l = R[e.second[i].first][e.first];</div><div class="line">                <span class="keyword">int</span> r = Rg[e.second[j].first];</div><div class="line">                egroup.joint(l, r);</div><div class="line">                <span class="keyword">if</span> (e.second[i].second != <span class="number">0</span>) &#123;</div><div class="line">                    r = Rg[e.second[i].first];</div><div class="line">                    assert(l &gt; <span class="number">0</span> &amp;&amp; r &gt; <span class="number">0</span>);</div><div class="line">                    egroup.joint(l, r);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : g) &#123;</div><div class="line">            <span class="keyword">int</span> sz = e.second.size();</div><div class="line">            <span class="keyword">int</span> n = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sz; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (e.second[i].second == <span class="number">0</span>)</div><div class="line">                    e.second[n++] = e.second[i];</div><div class="line">            &#125;</div><div class="line">            e.second.resize(n);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">static</span> <span class="keyword">int</span> region[<span class="number">65536</span>]; <span class="built_in">memset</span>(region, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="number">0</span>)*Rsize);</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p; i++) &#123;</div><div class="line">            <span class="keyword">float</span> x, y;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%f %f"</span>, &amp;x, &amp;y);</div><div class="line">            pair&lt;<span class="keyword">int</span>, Pt&gt; hit = tree.raycast(Pt(x, y));</div><div class="line">            <span class="keyword">if</span> (hit.first &lt; <span class="number">0</span>)</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">                </div><div class="line">            <span class="keyword">if</span> (g.find(hit.second) != g.end()) &#123;</div><div class="line">                <span class="keyword">auto</span> &amp;adj = g[hit.second];</div><div class="line">                <span class="function">AngleCmp <span class="title">cmp</span><span class="params">(hit.second)</span></span>;</div><div class="line">                <span class="keyword">int</span> pos = <span class="number">0</span>;</div><div class="line">                pair&lt;Pt, <span class="keyword">int</span>&gt; q(Pt(x, y), i+<span class="number">1</span>);</div><div class="line">                pos = lower_bound(adj.begin(), adj.end(), q, cmp) - adj.begin() - <span class="number">1</span>;</div><div class="line">                assert(pos &gt;= <span class="number">0</span>);</div><div class="line">                <span class="keyword">int</span> l = R[adj[pos].first][hit.second];</div><div class="line">                assert(l &gt; <span class="number">0</span>);</div><div class="line">                l = egroup.findp(l);</div><div class="line">                region[l] = i+<span class="number">1</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">auto</span> &amp;adj = on_seg[hit.first];</div><div class="line">                Pt lpt = adj[<span class="number">0</span>], rpt = adj[<span class="number">1</span>];</div><div class="line">                <span class="keyword">int</span> l;</div><div class="line">                <span class="keyword">if</span> (cmpZero(cross(lpt, rpt, Pt(x, y))) &lt;= <span class="number">0</span>)</div><div class="line">                    l = R[lpt][rpt];</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    l = R[rpt][lpt];</div><div class="line">                assert(l &gt; <span class="number">0</span>);</div><div class="line">                l = egroup.findp(l);</div><div class="line">                region[l] = i+<span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; q; i++) &#123;</div><div class="line">            <span class="keyword">float</span> x, y;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%f %f"</span>, &amp;x, &amp;y);</div><div class="line">            pair&lt;<span class="keyword">int</span>, Pt&gt; hit = tree.raycast(Pt(x, y));</div><div class="line">            <span class="keyword">if</span> (hit.first &lt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"0\n"</span>);</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">                </div><div class="line">            <span class="keyword">if</span> (g.find(hit.second) != g.end()) &#123;</div><div class="line">                <span class="keyword">auto</span> &amp;adj = g[hit.second];</div><div class="line">                <span class="function">AngleCmp <span class="title">cmp</span><span class="params">(hit.second)</span></span>;</div><div class="line">                <span class="keyword">int</span> pos = <span class="number">0</span>;</div><div class="line">                pair&lt;Pt, <span class="keyword">int</span>&gt; q(Pt(x, y), i+<span class="number">1</span>);</div><div class="line">                pos = lower_bound(adj.begin(), adj.end(), q, cmp) - adj.begin() - <span class="number">1</span>;</div><div class="line">                assert(pos &gt;= <span class="number">0</span>);</div><div class="line">                <span class="keyword">int</span> l = R[adj[pos].first][hit.second];</div><div class="line">                assert(l &gt; <span class="number">0</span>);</div><div class="line">                l = egroup.findp(l);</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, region[l]);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">auto</span> &amp;adj = on_seg[hit.first];</div><div class="line">                Pt lpt = adj[<span class="number">0</span>], rpt = adj[<span class="number">1</span>];</div><div class="line">                <span class="keyword">int</span> l;</div><div class="line">                <span class="keyword">if</span> (cmpZero(cross(lpt, rpt, Pt(x, y))) &lt;= <span class="number">0</span>)</div><div class="line">                    l = R[lpt][rpt];</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    l = R[rpt][lpt];</div><div class="line">                assert(l &gt; <span class="number">0</span>);</div><div class="line">                l = egroup.findp(l);</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, region[l]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="線段樹"><a href="#線段樹" class="headerlink" title="線段樹"></a>線段樹</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt; </span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-8</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">double</span> BOX_MX = (<span class="number">3000000</span>);</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> AUXID = <span class="number">200000</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pt</span> &#123;</span></div><div class="line">    <span class="keyword">double</span> x, y;</div><div class="line">    Pt(<span class="keyword">double</span> a = <span class="number">0</span>, <span class="keyword">double</span> b = <span class="number">0</span>): x(a), y(b) &#123;&#125;</div><div class="line">    Pt <span class="keyword">operator</span>-(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Pt(x - a.x, y - a.y); &#125;</div><div class="line">    Pt <span class="keyword">operator</span>+(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Pt(x + a.x, y + a.y); &#125;</div><div class="line">    Pt <span class="keyword">operator</span>*(<span class="keyword">const</span> <span class="keyword">double</span> a) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Pt(x * a, y * a);  &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">fabs</span>(x - a.x) &gt; eps)	<span class="keyword">return</span> x &lt; a.x;</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">fabs</span>(y - a.y) &gt; eps)	<span class="keyword">return</span> y &lt; a.y;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">fabs</span>(x - a.x) &lt; eps &amp;&amp; <span class="built_in">fabs</span>(y - a.y) &lt; eps;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">println</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">    	<span class="built_in">printf</span>(<span class="string">"(%lf, %lf)\n"</span>, x, y);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Seg</span> &#123;</span></div><div class="line">    Pt s, e;</div><div class="line">    <span class="keyword">int</span> i;</div><div class="line">    Seg() &#123;&#125;</div><div class="line">    Seg(Pt a, Pt b, <span class="keyword">int</span> i):s(a), e(b), i(i) &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">println</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">    	<span class="built_in">printf</span>(<span class="string">"Segment((%lf, %lf), (%lf, %lf))\n"</span>, s.x, s.y, e.x, e.y);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">dot</span><span class="params">(Pt a, Pt b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> a.x * b.x + a.y * b.y;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">cross</span><span class="params">(Pt o, Pt a, Pt b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (a.x-o.x)*(b.y-o.y)-(a.y-o.y)*(b.x-o.x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">cross2</span><span class="params">(Pt a, Pt b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> a.x * b.y - a.y * b.x;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">between</span><span class="params">(Pt a, Pt b, Pt c)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> dot(c - a, b - a) &gt;= -eps &amp;&amp; dot(c - b, a - b) &gt;= -eps;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">onSeg</span><span class="params">(Pt a, Pt b, Pt c)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> between(a, b, c) &amp;&amp; <span class="built_in">fabs</span>(cross(a, b, c)) &lt; eps;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmpZero</span><span class="params">(<span class="keyword">double</span> v)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="built_in">fabs</span>(v) &gt; eps) <span class="keyword">return</span> v &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">-1</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Pt <span class="title">getIntersect</span><span class="params">(Seg a, Seg b)</span> </span>&#123;</div><div class="line">    Pt u = a.s - b.s;</div><div class="line">    <span class="keyword">double</span> t = cross2(b.e - b.s, u)/cross2(a.e - a.s, b.e - b.s);</div><div class="line">    <span class="keyword">return</span> a.s + (a.e - a.s) * t;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AngleCmp</span> &#123;</span></div><div class="line">    Pt o;</div><div class="line">    AngleCmp(Pt o = Pt()):o(o) &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="keyword">const</span> pair&lt;Pt, <span class="keyword">int</span>&gt;&amp; ppa, <span class="keyword">const</span> pair&lt;Pt, <span class="keyword">int</span>&gt;&amp; ppb)</span> </span>&#123;</div><div class="line">        Pt pa = ppa.first, pb = ppb.first;</div><div class="line">        Pt p1 = pa - o, p2 = pb - o;</div><div class="line">        <span class="keyword">if</span> (p1.y == <span class="number">0</span> &amp;&amp; p2.y == <span class="number">0</span> &amp;&amp; p1.x * p2.x &lt;= <span class="number">0</span>) <span class="keyword">return</span> p1.x &gt; p2.x;</div><div class="line">        <span class="keyword">if</span> (p1.y == <span class="number">0</span> &amp;&amp; p1.x &gt;= <span class="number">0</span> &amp;&amp; p2.y != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">        <span class="keyword">if</span> (p2.y == <span class="number">0</span> &amp;&amp; p2.x &gt;= <span class="number">0</span> &amp;&amp; p1.y != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span> (p1.y * p2.y &lt; <span class="number">0</span>) <span class="keyword">return</span> p1.y &gt; p2.y;</div><div class="line">        <span class="keyword">double</span> c = cross2(p1, p2);</div><div class="line">        <span class="keyword">return</span> c &gt; <span class="number">0</span> || (c == <span class="number">0</span> &amp;&amp; <span class="built_in">fabs</span>(p1.x) &lt; <span class="built_in">fabs</span>(p2.x));</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">static</span> Pt pts[<span class="number">10005</span>];</div><div class="line"><span class="keyword">static</span> Seg segs[<span class="number">30005</span>];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">double</span> <span class="title">interpolate</span><span class="params">(<span class="keyword">const</span> Pt&amp; p1, <span class="keyword">const</span> Pt&amp; p2, <span class="keyword">double</span>&amp; x)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (cmpZero(p1.x - p2.x) == <span class="number">0</span>) <span class="keyword">return</span> min(p1.y, p2.y);</div><div class="line">    <span class="keyword">return</span> p1.y + (<span class="keyword">double</span>)(p2.y - p1.y) / (p2.x - p1.x) * (x - p1.x);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CMP</span> &#123;</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">double</span> x;	    </div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="keyword">const</span> Seg &amp;i, <span class="keyword">const</span> Seg &amp;j)</span> </span>&#123;</div><div class="line">    	<span class="keyword">double</span> l = interpolate(i.s, i.e, x);</div><div class="line">    	<span class="keyword">double</span> r = interpolate(j.s, j.e, x);</div><div class="line">        <span class="keyword">return</span> l &lt; r;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">double</span> CMP::x;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BSP</span> &#123;</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">        <span class="keyword">double</span> ly, ry;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">            ly = BOX_MX, ry = -BOX_MX;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">extend</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</div><div class="line">                <span class="keyword">return</span> ;</div><div class="line">            ly = min(ly, u-&gt;ly);</div><div class="line">            ry = max(ry, u-&gt;ry);</div><div class="line">        &#125;</div><div class="line">    &#125; bbox[<span class="number">262144</span>];</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt; x;</div><div class="line">    <span class="built_in">set</span>&lt;Seg, CMP&gt; tree[<span class="number">524288</span>];</div><div class="line">    Seg segs[<span class="number">262144</span>];</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">        tree[k].clear();</div><div class="line">        bbox[k].init();</div><div class="line">        <span class="keyword">if</span> (l+<span class="number">1</span> &gt;= r)</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</div><div class="line">        clear(k&lt;&lt;<span class="number">1</span>, l, m);</div><div class="line">        clear(k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m, r);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Seg &amp;s, <span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (s.s.x &lt;= x[l] &amp;&amp; x[r] &lt;= s.e.x) &#123;</div><div class="line">            CMP::x = (x[l] + x[r])/<span class="number">2</span>;</div><div class="line">            tree[k].insert(s);</div><div class="line">            <span class="keyword">double</span> ly = interpolate(s.s, s.e, x[l]);</div><div class="line">            <span class="keyword">double</span> ry = interpolate(s.s, s.e, x[r]);</div><div class="line">            bbox[k].ly = min(bbox[k].ly, min(ly, ry));</div><div class="line">            bbox[k].ry = max(bbox[k].ry, max(ly, ry));</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (l+<span class="number">1</span> &gt;= r)</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</div><div class="line">        <span class="keyword">if</span> (s.s.x &lt;= x[m]) &#123;</div><div class="line">            insert(s, k&lt;&lt;<span class="number">1</span>, l, m);</div><div class="line">            bbox[k].extend(&amp;bbox[k&lt;&lt;<span class="number">1</span>]);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (s.e.x &gt; x[m]) &#123;</div><div class="line">            insert(s, k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m, r);</div><div class="line">            bbox[k].extend(&amp;bbox[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build_tree</span><span class="params">(Seg s[], <span class="keyword">int</span> m)</span> </span>&#123;</div><div class="line">        <span class="built_in">memcpy</span>(segs, s, <span class="keyword">sizeof</span>(segs[<span class="number">0</span>])*m);</div><div class="line">        </div><div class="line">        x.clear();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</div><div class="line">            x.push_back(segs[i].s.x), x.push_back(segs[i].e.x);</div><div class="line">        sort(x.begin(), x.end());</div><div class="line">        x.resize(unique(x.begin(), x.end()) - x.begin());</div><div class="line">        </div><div class="line">        clear(<span class="number">1</span>, <span class="number">0</span>, x.size()<span class="number">-1</span>);</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (segs[i].s.x &gt; segs[i].e.x)</div><div class="line">                swap(segs[i].s, segs[i].e);</div><div class="line">            <span class="keyword">if</span> (segs[i].s.x &lt; segs[i].e.x)</div><div class="line">                insert(segs[i], <span class="number">1</span>, <span class="number">0</span>, x.size()<span class="number">-1</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    Pt q_st, q_ed;</div><div class="line">    <span class="keyword">int</span> q_si;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (bbox[k].ly &gt;= q_ed.y || bbox[k].ry &lt;= q_st.y)</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">if</span> (x[l] &lt;= q_st.x &amp;&amp; q_st.x &lt;= x[r]) &#123;</div><div class="line">            CMP::x = q_st.x;</div><div class="line">            <span class="keyword">auto</span> it = tree[k].upper_bound(Seg(q_st, q_st, <span class="number">0</span>));</div><div class="line">            <span class="keyword">while</span> (it != tree[k].end()) &#123;</div><div class="line">                <span class="keyword">double</span> y = interpolate(it-&gt;s, it-&gt;e, CMP::x);</div><div class="line">                <span class="keyword">if</span> (y &gt; q_st.y) &#123;</div><div class="line">                    <span class="keyword">if</span> (y &lt; q_ed.y) &#123;</div><div class="line">                        q_ed.y = y;</div><div class="line">                        q_si = it-&gt;i;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                it++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (l+<span class="number">1</span> &gt;= r)</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</div><div class="line">        <span class="keyword">if</span> (q_st.x &lt;= x[m])</div><div class="line">            search(k&lt;&lt;<span class="number">1</span>, l, m);</div><div class="line">        <span class="keyword">if</span> (q_st.x &gt;= x[m])</div><div class="line">            search(k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m, r);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    pair&lt;<span class="keyword">int</span>, Pt&gt; raycast(Pt st) &#123;</div><div class="line">        q_st = st; </div><div class="line">        q_ed = Pt(st.x, BOX_MX+<span class="number">1</span>);</div><div class="line">        q_si = <span class="number">-1</span>;</div><div class="line">        search(<span class="number">1</span>, <span class="number">0</span>, x.size()<span class="number">-1</span>);</div><div class="line">        <span class="keyword">return</span> &#123;q_si, q_ed&#125;;</div><div class="line">    &#125;</div><div class="line">&#125; tree;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Disjoint</span> &#123;</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">65536</span>;</div><div class="line">    <span class="keyword">uint16_t</span> parent[MAXN], weight[MAXN];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (n &gt;= MAXN)</div><div class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++)</div><div class="line">            parent[i] = i, weight[i] = <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findp</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> parent[x] == x ? x : parent[x] = findp(parent[x]);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">joint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        x = findp(x), y = findp(y);</div><div class="line">        <span class="keyword">if</span> (weight[x] &gt;= weight[y])</div><div class="line">            parent[y] = x, weight[x] += weight[y];</div><div class="line">        <span class="keyword">else</span></div><div class="line">            parent[x] = y, weight[y] += weight[x];</div><div class="line">    &#125;	</div><div class="line">&#125; egroup, sgroup;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n, m, p, q;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d %d %d"</span>, &amp;n, &amp;m, &amp;p, &amp;q) == <span class="number">4</span> &amp;&amp; n) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            <span class="keyword">int</span> x, y;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;x, &amp;y);</div><div class="line">            pts[i] = Pt(x, y);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        sgroup.init(n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="keyword">int</span> st_i, ed_i;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;st_i, &amp;ed_i);</div><div class="line">            st_i--, ed_i--;</div><div class="line">            segs[i] = Seg(pts[st_i], pts[ed_i], i);</div><div class="line">            sgroup.joint(st_i, ed_i);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        segs[m] = Seg(Pt(BOX_MX, BOX_MX), Pt(BOX_MX, -BOX_MX), m), m++;</div><div class="line">        segs[m] = Seg(Pt(BOX_MX, -BOX_MX), Pt(-BOX_MX, -BOX_MX), m), m++;</div><div class="line">        segs[m] = Seg(Pt(-BOX_MX, -BOX_MX), Pt(-BOX_MX, BOX_MX), m), m++;</div><div class="line">        segs[m] = Seg(Pt(-BOX_MX, BOX_MX), Pt(BOX_MX, BOX_MX), m), m++;</div><div class="line">        </div><div class="line">        <span class="keyword">static</span> <span class="built_in">map</span>&lt;Pt, <span class="built_in">vector</span>&lt;pair&lt;Pt, <span class="keyword">uint8_t</span>&gt;&gt;&gt; g; g.clear();</div><div class="line">        <span class="keyword">static</span> <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;Pt&gt;&gt; on_seg; on_seg.clear(); on_seg.resize(m);</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            on_seg[segs[i].i].reserve(<span class="number">4</span>);</div><div class="line">            on_seg[segs[i].i].push_back(segs[i].s);</div><div class="line">            on_seg[segs[i].i].push_back(segs[i].e);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line"><span class="comment">//		for (int i = 0; i &lt; n; i++)</span></div><div class="line"><span class="comment">//			pts[i].println();</span></div><div class="line"><span class="comment">//		for (int i = 0; i &lt; m; i++)</span></div><div class="line"><span class="comment">//			segs[i].println();</span></div><div class="line"></div><div class="line">        tree.build_tree(segs, m);</div><div class="line">        &#123;</div><div class="line">            Pt top[<span class="number">10005</span>];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">                top[i] = pts[i];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">                <span class="keyword">int</span> gid = sgroup.findp(i);</div><div class="line">                <span class="keyword">if</span> (top[gid].y &lt; pts[i].y)</div><div class="line">                    top[gid] = pts[i];</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (sgroup.findp(i) != i)</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">auto</span> p = top[i];</div><div class="line">                <span class="keyword">auto</span> hit = tree.raycast(p);</div><div class="line">                <span class="keyword">if</span> (hit.first &gt;= <span class="number">0</span>) &#123;</div><div class="line">                    on_seg[hit.first].emplace_back(hit.second);</div><div class="line">                    g[p].emplace_back(hit.second, <span class="number">1</span>);</div><div class="line">                    g[hit.second].emplace_back(p, <span class="number">1</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="built_in">vector</span>&lt;Pt&gt; &amp;a = on_seg[i];</div><div class="line">            sort(a.begin(), a.end());</div><div class="line">            a.resize(unique(a.begin(), a.end()) - a.begin());</div><div class="line">            <span class="keyword">auto</span> *prev = &amp;g[a[<span class="number">0</span>]];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; a.size(); j++) &#123;</div><div class="line">                prev-&gt;emplace_back(a[j], <span class="number">0</span>);</div><div class="line">                prev = &amp;g[a[j]];</div><div class="line">                prev-&gt;emplace_back(a[j<span class="number">-1</span>], <span class="number">0</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : g)</div><div class="line">            sort(e.second.begin(), e.second.end(), AngleCmp(e.first));</div><div class="line">        </div><div class="line">        <span class="keyword">static</span> <span class="built_in">map</span>&lt;Pt, <span class="built_in">map</span>&lt;Pt, <span class="keyword">int</span>&gt;&gt; R; R.clear();</div><div class="line">        <span class="keyword">int</span> Rsize = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : g) &#123;</div><div class="line">            <span class="keyword">int</span> sz = e.second.size();</div><div class="line">            <span class="built_in">map</span>&lt;Pt, <span class="keyword">int</span>&gt; &amp;Rg = R[e.first];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;f : e.second) &#123;</div><div class="line">                <span class="keyword">int</span> &amp;eid = Rg[f.first];</div><div class="line">                <span class="keyword">if</span> (eid == <span class="number">0</span>)</div><div class="line">                    eid = ++Rsize;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        egroup.init(Rsize);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : g) &#123;</div><div class="line">            <span class="keyword">int</span> sz = e.second.size();</div><div class="line">            <span class="built_in">map</span>&lt;Pt, <span class="keyword">int</span>&gt; &amp;Rg = R[e.first];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = sz<span class="number">-1</span>, j = <span class="number">0</span>; j &lt; sz; i = j++) &#123;</div><div class="line">                <span class="keyword">int</span> l = R[e.second[i].first][e.first];</div><div class="line">                <span class="keyword">int</span> r = Rg[e.second[j].first];</div><div class="line">                egroup.joint(l, r);</div><div class="line">                <span class="keyword">if</span> (e.second[i].second != <span class="number">0</span>) &#123;</div><div class="line">                    r = Rg[e.second[i].first];</div><div class="line">                    assert(l &gt; <span class="number">0</span> &amp;&amp; r &gt; <span class="number">0</span>);</div><div class="line">                    egroup.joint(l, r);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : g) &#123;</div><div class="line">            <span class="keyword">int</span> sz = e.second.size();</div><div class="line">            <span class="keyword">int</span> n = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sz; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (e.second[i].second == <span class="number">0</span>)</div><div class="line">                    e.second[n++] = e.second[i];</div><div class="line">            &#125;</div><div class="line">            e.second.resize(n);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">static</span> <span class="keyword">int</span> region[<span class="number">65536</span>]; <span class="built_in">memset</span>(region, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="number">0</span>)*Rsize);</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p; i++) &#123;</div><div class="line">            <span class="keyword">float</span> x, y;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%f %f"</span>, &amp;x, &amp;y);</div><div class="line">            pair&lt;<span class="keyword">int</span>, Pt&gt; hit = tree.raycast(Pt(x, y));</div><div class="line">            <span class="keyword">if</span> (hit.first &lt; <span class="number">0</span>)</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">                </div><div class="line">            <span class="keyword">if</span> (g.find(hit.second) != g.end()) &#123;</div><div class="line">                <span class="keyword">auto</span> &amp;adj = g[hit.second];</div><div class="line">                <span class="function">AngleCmp <span class="title">cmp</span><span class="params">(hit.second)</span></span>;</div><div class="line">                <span class="keyword">int</span> pos = <span class="number">0</span>;</div><div class="line">                pair&lt;Pt, <span class="keyword">int</span>&gt; q(Pt(x, y), i+<span class="number">1</span>);</div><div class="line">                pos = lower_bound(adj.begin(), adj.end(), q, cmp) - adj.begin() - <span class="number">1</span>;</div><div class="line">                assert(pos &gt;= <span class="number">0</span>);</div><div class="line">                <span class="keyword">int</span> l = R[adj[pos].first][hit.second];</div><div class="line">                assert(l &gt; <span class="number">0</span>);</div><div class="line">                l = egroup.findp(l);</div><div class="line">                region[l] = i+<span class="number">1</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">auto</span> &amp;adj = on_seg[hit.first];</div><div class="line">                Pt lpt = adj[<span class="number">0</span>], rpt = adj[<span class="number">1</span>];</div><div class="line">                <span class="keyword">int</span> l;</div><div class="line">                <span class="keyword">if</span> (cmpZero(cross(lpt, rpt, Pt(x, y))) &lt;= <span class="number">0</span>)</div><div class="line">                    l = R[lpt][rpt];</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    l = R[rpt][lpt];</div><div class="line">                assert(l &gt; <span class="number">0</span>);</div><div class="line">                l = egroup.findp(l);</div><div class="line">                region[l] = i+<span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; q; i++) &#123;</div><div class="line">            <span class="keyword">float</span> x, y;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%f %f"</span>, &amp;x, &amp;y);</div><div class="line">            pair&lt;<span class="keyword">int</span>, Pt&gt; hit = tree.raycast(Pt(x, y));</div><div class="line">            <span class="keyword">if</span> (hit.first &lt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"0\n"</span>);</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">                </div><div class="line">            <span class="keyword">if</span> (g.find(hit.second) != g.end()) &#123;</div><div class="line">                <span class="keyword">auto</span> &amp;adj = g[hit.second];</div><div class="line">                <span class="function">AngleCmp <span class="title">cmp</span><span class="params">(hit.second)</span></span>;</div><div class="line">                <span class="keyword">int</span> pos = <span class="number">0</span>;</div><div class="line">                pair&lt;Pt, <span class="keyword">int</span>&gt; q(Pt(x, y), i+<span class="number">1</span>);</div><div class="line">                pos = lower_bound(adj.begin(), adj.end(), q, cmp) - adj.begin() - <span class="number">1</span>;</div><div class="line">                assert(pos &gt;= <span class="number">0</span>);</div><div class="line">                <span class="keyword">int</span> l = R[adj[pos].first][hit.second];</div><div class="line">                assert(l &gt; <span class="number">0</span>);</div><div class="line">                l = egroup.findp(l);</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, region[l]);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">auto</span> &amp;adj = on_seg[hit.first];</div><div class="line">                Pt lpt = adj[<span class="number">0</span>], rpt = adj[<span class="number">1</span>];</div><div class="line">                <span class="keyword">int</span> l;</div><div class="line">                <span class="keyword">if</span> (cmpZero(cross(lpt, rpt, Pt(x, y))) &lt;= <span class="number">0</span>)</div><div class="line">                    l = R[lpt][rpt];</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    l = R[rpt][lpt];</div><div class="line">                assert(l &gt; <span class="number">0</span>);</div><div class="line">                l = egroup.findp(l);</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, region[l]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-diary-201709-military-life" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/15/diary-201709-military-life/" class="article-date">
  <time datetime="2017-10-15T08:02:43.000Z" itemprop="datePublished">2017-10-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/15/diary-201709-military-life/">十二天軍旅生活 (前)</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/10/15/diary-201709-military-life/" data-id="ckw8q9fsl00arqwvnpyi0faoc" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/10/15/diary-201709-military-life/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="畢業至當兵前"><a href="#畢業至當兵前" class="headerlink" title="畢業至當兵前"></a>畢業至當兵前</h2><p>結束研究所離校手續後，便回到家裡等兵單。某方面來說不算等兵單，研發替代役可以上網填入營日期，選擇適合自己的梯次入伍即可。彌補好幾個寒暑假都沒回家的罪過，於是跑去報名汽車駕訓班，沒想到現在學開車外加考照要一個多月，那麼先前填的入伍時間來不及，在確定報名的日期前修改即可，往後延了一個梯次，直到九月中才進去服<strong>十二天</strong>的新訓。</p>
<h3 id="駕訓班"><a href="#駕訓班" class="headerlink" title="駕訓班"></a>駕訓班</h3><p>在這一個多月間，駕訓班平均兩天上一次課，每天排課差不多都是早上八、九點，其中突然有一陣子沒辦法練車，因為有某一梯次的學員要進行考試，好幾天就空著練筆試。上班時期才去學開車也許是個艱難的選項，而我們花蓮的駕訓班排課好像只到晚上六點，想必下班也會來不及。與公司、役政署那邊確定好時間，也要把這一人生階段任務完成。</p>
<p>大家都說以前駕訓班就學手排車，於是一開始學手排車，後來發現對離合器的協調性不足，換自排車繼續學。開了手排車幾堂課，轉換到自排車就覺得相當簡單，自排車比較不會打錯檔位，也許是因為檔位設計的問題吧！哪天教練車高檔一點說不定就好辦了。咱這點自尊先捨棄吧。</p>
<p>不曉得其他駕訓班是怎麼教開車，背口訣打方向盤的圈數、看後照鏡與標線之間的關係，一開始總是憑感覺打方向盤，結果常常被教練說嘴。心想那些口訣換了車就不一樣，而且每個人坐在駕駛坐看到的視角關係也不致相同，我到底該信什麼才好？內心好煎熬啊。</p>
<p>有時開車兩個人輪流開一台車，兩個學員相互看開車的情況，也不知道為什麼幾乎都是女孩子，而且開車技術都還算不錯，像頭文字 D 那般的快速打檔，感覺平常就有開車，坐在一旁都好佩服。後來才發現教練幾乎都帶女生，怪不得安排上都是跟女生居多。開 S 灣的時候壓到線時，當一旁人的一言不發，腦補病患可承受不住的。</p>
<p>直到考試當日，當日早上八點集合帶去監理站考試，筆試背罰金額度的總是相當惱人，那一天死記活拚也弄了個 97.5 分，明明不該是這麼困難的項目，帶著沒拿到滿分的遺憾迎來下午的場內考試。場內考試依舊是各教練分開安排，排隊上車進行測驗，由於監理站人手不足，其他教練評分時仍有全程攝影，待考生坐在後座看前一個考生跑完全程，六十多個人坐在安全島上等待考試。各自帶開後，不出所料這島都是女生，而另一頭都是男生，教練們的合格率賭盤就開始了！不得不說，大部分人都是考自排車，非常少數的人考手排車，大部分上坡起步退場的也都是手排車。</p>
<p>一般而言，大家都以為這樣就結束。「不是的」，像我這種總是可以走到特殊路線的人而言，恰好多了<strong>道路駕駛</strong>考試，也就是在今年六月開始強制上路的考試，必須在外頭繞一圈合格後才能拿到駕照。好在是在花蓮考試，如果在台北考道路駕駛也許不堪設想。開車出去前要口頭報出車況，我永遠不能明白當初定說要檢查車底的高就在想什麼，要蹲下去看車底高喊「<strong>車底無異物</strong>」，並且是車子四個方位都要走過去喊，想必在外頭沒有一個人可以做到這一點。為了安全考量看一次，但看到四次只有強迫症患者做得到吧。</p>
<p>說起如何練習道路考試，那是一件很有趣的故事，一般人會想說教練會帶著進行<strong>第一次</strong>的練習，結果我們教練要求讓家長帶我們去開過一次考試路線，不是家長開給你開，而是你開給家長看。多嚇過幾輪後，教練才會帶你出去練車。然而，礙於其他因素就沒拜託老爸帶我去開。於是－第一次開車上路，沒有經驗的我開車載妹子出去啦，教練還說「把這當載老婆小孩，一句話都不會說，你得一個人開車。」，幸好平安落幕。隨後幾次練車，曾跟著奇葩一起，坐在後頭都會嚇死，教練說道「<strong>輕踩壓車減速</strong>」，心中吶喊「等等，咱們突然停在路上，停了，真的停了」，原來他沒有騎過機車、腳踏車上路的經驗，當初還以為大家都會騎機車才考汽車，這世界還是很奇妙的。</p>
<p>拉著老爸練了一周的車，考試當天等了三個多小時才輪到最後一個我，坐在前一個考生後頭時，從頭到尾一直在喊「饒了咱吧，快把你的雙手放開，疊在一起放在方向盤上搖來搖去，咱的心臟要受不了」一個急轉彎壓了慢車道過去，全程超速駕駛，考官全程也不能說話，不知道那樣子還算過嗎。等到我開完路線，監考官叫我多開一段路回駕訓班，那時教練們聚著才開始抱怨「現在的年輕人啊…」</p>
<p>老爸拉著我去開台9、台11線，中間繞光豐公路，練習在山路上轉方向盤，開車還要閃遊覽車之類的驚悚橋段，一旁就是山溝，還有道路坍方的單向道，想起來還是得再多多加強。要練到開山路不踩剎車，再開始載人？</p>
<h3 id="練身體"><a href="#練身體" class="headerlink" title="練身體"></a>練身體</h3><p>雖然這年頭研發替代役只有十二天的新訓，人生這一階段還是練練身體。每天下午跑去附近公園跑個六、七圈，順便拉著老爸去運動。</p>
<p>覺得慢跑的最重要因素還是腿部和腰部肌肉。高中時間肥到 76kg 時，跑個 1600m 都覺得辛苦，剛上大學覺得自己是個一無是處廢物，大一的生活就有固定跑到宿舍旁邊的操場運動，「因為太廢了，這八圈是懲罰」<br>。然而，轉學後就一陣子沒運動，直到大三開始跟轉學生學長一起住，瘋了才去跑校園兩圈練半半馬 10km，後來還真的跑去參加半半馬，一個人在人群中擠來擠去。但上了研究所兩年完全沒運動過，每天走三十分鐘往返學校而已。突然跑起 3000m 還是很刺激的，調個一周才讓大腿適應。</p>
<p>後來被老爸抓去<strong>花蓮太平洋公園</strong>旁的道路跑步，第一次在下午三點太陽正熱，即使有海風吹著跑起來還是相當折磨，單程約有 2km，來回跑就有四公里多，在海邊跑步如此現充？不對，觀光客騎腳踏車、機車超輕鬆的從你旁邊呼嘯而過，而你只有看著狹長的海岸線估算要以何種步伐才得以抵達盡頭的份。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-diary-201707" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/08/diary-201707/" class="article-date">
  <time datetime="2017-07-08T10:54:36.000Z" itemprop="datePublished">2017-07-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/shCb0QO.jpg" rel="gallery_ckw8q9fps003uqwvn4xueqfy7">
        <img src="http://i.imgur.com/shCb0QO.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/08/diary-201707/">吶，還記得我們的「約定」嗎</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/07/08/diary-201707/" data-id="ckw8q9fps003uqwvn4xueqfy7" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/07/08/diary-201707/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="長途跋涉"><a href="#長途跋涉" class="headerlink" title="長途跋涉"></a>長途跋涉</h2><p>碩二下的剩餘幾個月裡，一般情況在口試前一個月開始把實驗補齊，前一週才把論文寫完，隨後口試完，再花個兩三週把論文丟到圖書館後離校，以上是一般碩士生的的常態生活，而我可能就有一點特別。碩二上學期結束時把論文概要想完，過年把中文論文寫個草稿，下學期便耗費數幾個月與老師來來回回地改了好幾輪，一下子就來到了學期結束。</p>
<p><img src="http://i.imgur.com/Pdusran.jpg" alt="「長篇化就拜託你了」－《情色漫畫老師》"></p>
<p>不得不說，內容改了好幾個月，把一些不太想說明、為什麼要說的部分釐清變得相當困難，大部分不想說明的內容、晦暗不明的語句依依剝離出來，反反覆覆地增加了四十幾張圖片，使用 Tikz 這等套件畫圖，可說是相當痛苦得一件事情，一張圖片可能就要花一整個早上來完成。</p>
<p>細節實作的「道理」與其實驗結果，逐一補上「為什麼要這麼做」、「為什麼會快」、「為什麼選用這種方法」諸如此類的問題。在撰寫時只覺得這麼做是對的，感覺上沒有錯，實驗上可以驗證是對的，一被問起來仍是一臉茫然地不知如何說明，還得回去思考到底要怎麼說才能容易明白。</p>
<p><img src="http://i.imgur.com/lm5A5Ro.jpg" alt="「這不是超過 100 頁了嗎？」－《情色漫畫老師》"></p>
<p>一路寫到五月底，而六月初口試的當下，口試現場來了四個教授來聽，相較於學長那時的三人排場的確更盛大點。壓縮簡報內容至一百頁內的投影片，才可能在四十分鐘內講完呢。那些不想細講的內容，在論文裡不說又會被老師要求，口試的時候能不能不說？百感交集下，硬著頭皮一路殺下去講純資料結構和算法的改進，對於一般做計畫而生的論文，我的內容肯定很無趣吧。要是我能強一點就好了。</p>
<p><img src="http://i.imgur.com/CSVvyzf.jpg" alt="「要是我能更強就好了」－《夏目友人帳》"></p>
<p>講完近一個小時的成果發表，講累的我還一度沒聽懂要開離教室，等待委員商議是否能通過的會議，口試的評分表不知道是以怎麼方式運行，坐在教室外的我焦慮地等待，心想「是不是做的內容有些瑕疵，還是已經有人做過了？還是內容不足以作為一個碩士研究？」</p>
<p>教室那鎖不好的木門聲響起「嘣」一聲，老師從門口向著我說「下去把 XX 一起叫上來」，走下樓把一起口試的同學都叫來教室，才聽到「恭喜你們通過口試」，讀了兩年就等待這一句話，那究竟是怎麼樣的體驗，感覺有點不切實際，就這樣子了？</p>
<p><img src="http://i.imgur.com/QtLx3Ns.jpg" alt="「這是奇蹟」－《正解的卡多》"></p>
<p>儘管已經提早口試，內心再怎麼雀躍，也無法順心地馬上離開這裡，每天依舊來來學校做點雜事，「鈴～鈴～」實驗室電話一響，電話那一頭「有其他人在嗎？那個誰在嗎？麻煩上來一下」，早上十點半的我只能無奈地「誰也不在，現在只有我」，收到「好吧，那你上來」的日常似乎沒有太大的差異。</p>
<p>口試通過後，就該加緊腳步離校了對吧？離校的兩大關卡——口試審定書和離校同意書，過了一關後，還有一關無法通過，那要怎麼通過老師給的離校同意書呢？方法可說是千奇百種啊，男生的最終武器應該是兵單吧，不然總是問最晚什麼時候你才會離開而避開要簽離校，也許還有另一種可能，讓老師覺得「留你也沒用」，幻想著跟老師說「老師啊，就算沒有我，地球也照樣繼續轉，留我做什麼呢？」</p>
<p><img src="http://i.imgur.com/vxjEtv7.jpg" alt="「就算沒有我，地球也照樣繼續轉」—《櫻花任務》"></p>
<p>六月初那時，別老是問我「為什麼不走？」，心想「如果能走的話，早就離開了」，這麼能輕易明白的道理，在我身上就這麼難以理解，萬事皆有因，而螢幕前的你是否能理解我呢？看著行事曆上的工作吧，「六月十九日，校定期末考週」這下明白了吧，原本以為可以託付給學弟撐著弄分散式部分，沒想到碩一期末時期這麼忙碌，弄個作業就兩三天不見人影，實驗室好幾週進入三班工作制。</p>
<p>撐過了幾週的工作準備和實驗環境修整，期末考週終於可以好好休息，考題總要給老師弄好，助教輕鬆地去監考就行了。期末考當天監考完，由於沒有確切的參考答案，當下也不知道怎麼向同學描述怎麼寫才是對的，要提示到哪種地步，當下感慨萬分，「對不起，這裡你要自己想，我不清楚」。</p>
<p>原以為老師很快就可以改好考卷，沒想到突如其來的論文 deadline，使得改考卷一事被拖延，然而送成績又是一週後的事情，先放個三天讓老師去改。催一下進度，發現一題也沒改完，先改了兩題，剩下的題目再給老師改。在放個兩天，還是沒有太多的進展，再跟老師要了兩題來改，到最後還是由我改了大部分的題目，為 … 為什麼會變成那樣？</p>
<p><img src="http://i.imgur.com/2B6vJgj.jpg" alt="「為 ... 為什麼會變成那樣」－《情色漫畫老師》"></p>
<p>七月初到，仍然沒有辦法離開學校，事情接踵而來，弄完轉系考才能離開，又有實驗室經費要花，交代事情的當下只有我在學校，「嗯？怎麼？」對於研究生要在一早十點九點到實驗室，想必是個相當難的議題，學長們可是曾經全員不在而被叫上去罵呢，而我嘗試支持了一年多，電話從我座位旁響起到接起已成為最佳化的結果。在空無一人的早晨接電話，對於指定任務交代給尚未清醒的學弟等。買伺服器時，得再三催廠商寄送發票；買耗材時，得催學弟別忘記。</p>
<p><img src="http://i.imgur.com/OhT853a.jpg" alt="「太奇怪了」－《愛麗絲與藏六》"></p>
<p>終於到辦公室跟老師提了兵單，才從老師口中說出「下週會簽離校，順便回去實驗室跟他們說」一回到實驗室說，便聽到「為什麼老師不願意簽我離校啦」，說出「下週可以簽離校」，感覺同學得知這消息倍感高興。而在那週開會的結束時，跟老師報告做的事情時，僅剩下我一人了，順帶把離校同意書一起簽。</p>
<p>回到實驗室，滿是「可以離校了」「什麼時候清東西」的議題，這些話題平時離我太遠，使得我無法參與討論。學弟反過來問「那你什麼時候打算簽？」說起這個傷心事，原來我總是比較特別的部分對吧！我不知道要提些什麼，悄敲地回應「為什麼覺得我沒簽呢？」然而，在簽之前，比我晚口試的古學長早在前幾天拿到畢業證書，而我才剛拿到手。不經開始懷疑自己的能力與價值。要從口中說出「拿到了」，內心可說是五味雜陳地說不出啊。</p>
<p><img src="http://i.imgur.com/TRXEKGC.jpg" alt="「我拿到了」－《情色漫畫老師》"></p>
<h2 id="突襲再訪"><a href="#突襲再訪" class="headerlink" title="突襲再訪"></a>突襲再訪</h2><p><strong>敬請期待</strong></p>
<h2 id="再續故事"><a href="#再續故事" class="headerlink" title="再續故事"></a>再續故事</h2><p><strong>敬請期待</strong></p>
<h2 id="可能走向"><a href="#可能走向" class="headerlink" title="可能走向"></a>可能走向</h2><p><strong>敬請期待</strong></p>
<h2 id="誌謝"><a href="#誌謝" class="headerlink" title="誌謝"></a>誌謝</h2><blockquote>
<p>以下收錄於論文中</p>
</blockquote>
<p>能順利地完成這篇論文，首先，感謝劉邦鋒和吳真貞老師的指導，在論文架構和描<br>述手法的教導，才使得篇幅雜亂的初稿便得更加地易於理解，討論過程中更加地精<br>練專業知識，學生在此衷心感謝老師。</p>
<p>特別感謝中央大學的郭人維學長，拉拔在演算法及資料結構領域上的研究，其給予<br>的助力使得論文開花結果。更感謝在網路上許許多多來自各方的朋友分享研究心得<br>，讓彼此切磋茁壯。</p>
<p>在進入臺灣大學研究所的這兩年中，感謝實驗室學長們的鼓勵與支持，本對於學術<br>研究文化和自身能力的迷茫，接受學長們的啟示後，最終得以撐過第一學年。在第<br>二年中，感謝共同奮戰論文的古耕竹、古君葳、鄭以琳、吳軒衡等同學，彼此加油<br>打氣，使得在撰寫論文的路上並不孤單，督促進展、協助撰寫與驗證想法更加地順<br>利，願你們也能順利畢業、研究出滿意的成果。</p>
<p>在研究實驗上，感謝實驗室學弟張逸寧、林明璟、蔡慶源、朱清福的參與，被迫實<br>作出放置於批改娘系統上題目，這些題目原本為論文的一小部分，可透過不同資料<br>結構與算法解決，在本篇追求效能極致的路上貢獻了一份心力，為本實驗結果給予<br>更有信心的立論基礎。願你們在接下來的一年裡，經過老師指導與同學們相互引領<br>下順利畢業。</p>
<p>此外，特別感謝高中時期帶入門的溫健順老師，在選擇領域分組時，相信我在資訊<br>領域上的發展，拉近資訊組培養，經歷三年的教導後，才能順利走向這一條道路。</p>
<p>最後，感謝家人們一路相伴，進入資訊工程領域後，經歷大學轉學、延畢到研究所<br>的路上，對我的選擇給予支持。</p>
<p>感謝上述的各位與師長們一路上的支持與資助。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-20021" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/01/jg-20021/" class="article-date">
  <time datetime="2017-07-01T07:38:49.000Z" itemprop="datePublished">2017-07-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/01/jg-20021/">批改娘 20021. Dynamic Range Sum</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/07/01/jg-20021/" data-id="ckw8q9fsj00anqwvnm5e437ii" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/07/01/jg-20021/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SIMD/">SIMD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>在二維平面上有 <span>$N$</span><!-- Has MathJax --> 個點，每一個點 <span>$p_i(x_i, y_i)$</span><!-- Has MathJax -->各自帶權重 <span>$w_i$</span><!-- Has MathJax -->，這些點不時會移動和改變權重。</p>
<p>現在 Morris 希望你幫忙撰寫線性搜索的函數，好讓他專注數據結構上的調整。函數詢問包含 </p>
<ul>
<li><span>$N$</span><!-- Has MathJax --> 個點的資訊 (以 SoA (Structure of Array) 的方式儲存，以達到最好的快取使用率) </li>
<li>詢問的矩形 <span>$\text{Rect}$</span><!-- Has MathJax --> (正交於兩軸)</li>
</ul>
<p>函數必須回傳在矩形內部的點權重和。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int32_t</span> search_range(Rect rect, <span class="keyword">int32_t</span> x[], <span class="keyword">int32_t</span> y[], <span class="keyword">int32_t</span> w[], <span class="keyword">int32_t</span> n);</div></pre></td></tr></table></figure>
<h3 id="main-c-測試用"><a href="#main-c-測試用" class="headerlink" title="main.c (測試用)"></a>main.c (測試用)</h3><ul>
<li>一開始，在二維空間 <span>$[0, R) \times [0, R)$</span><!-- Has MathJax --> 之間產生 <span>$N$</span><!-- Has MathJax --> 個點的資訊</li>
<li>接著，模擬 <span>$M$</span><!-- Has MathJax --> 次點的變化，並且呼叫 <code>search_range</code> </li>
<li>最後，將所有答案 HASH 輸出一個值</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"DRS.h"</span></span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> seed = <span class="number">0</span>;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">p_srand</span><span class="params">(<span class="keyword">uint32_t</span> x)</span> </span>&#123; seed = x;&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> uint32_t <span class="title">p_rand</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> seed = (seed*<span class="number">9301</span> + <span class="number">49297</span>);&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> *x, <span class="keyword">int</span> *y)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> tmp = *x;</div><div class="line">    *x = *y;</div><div class="line">    *y = tmp;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> Rect <span class="title">rand_rect</span><span class="params">(<span class="keyword">int</span> R)</span> </span>&#123;</div><div class="line">    Rect r;</div><div class="line">    r.lx = p_rand()%R;</div><div class="line">    r.ly = p_rand()%R;</div><div class="line">    r.rx = p_rand()%R;</div><div class="line">    r.ry = p_rand()%R;</div><div class="line">    <span class="keyword">if</span> (r.lx &gt; r.rx)	swap(&amp;r.lx, &amp;r.rx);</div><div class="line">    <span class="keyword">if</span> (r.ly &gt; r.ry)	swap(&amp;r.ly, &amp;r.ry);</div><div class="line">    <span class="keyword">return</span> r;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> R, <span class="keyword">int32_t</span> x[], <span class="keyword">int32_t</span> y[], <span class="keyword">int32_t</span> w[])</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">        x[i] = p_rand()%R;</div><div class="line">        y[i] = p_rand()%R;</div><div class="line">        w[i] = p_rand()%R;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">tick</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> R, <span class="keyword">int32_t</span> x[], <span class="keyword">int32_t</span> y[], <span class="keyword">int32_t</span> w[])</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)	&#123;</div><div class="line">        <span class="keyword">int</span> idx = p_rand()%N;</div><div class="line">        x[idx] = p_rand()%R;</div><div class="line">        y[idx] = p_rand()%R;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)	&#123;</div><div class="line">        <span class="keyword">int</span> idx = p_rand()%N;</div><div class="line">        w[idx] = p_rand()%R;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 1048576</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    p_srand(<span class="number">0</span>);</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int32_t</span> x[MAXN], y[MAXN], w[MAXN];</div><div class="line">    <span class="keyword">int</span> N = <span class="number">1000</span>, M = <span class="number">10000</span>, R = <span class="number">100</span>;</div><div class="line">    </div><div class="line">    init(N, R, x, y, w);</div><div class="line"></div><div class="line">    <span class="keyword">int32_t</span> hash = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> it = <span class="number">0</span>; it &lt; M; it++) &#123;</div><div class="line">        Rect rect = rand_rect(R);</div><div class="line">        <span class="keyword">int32_t</span> ret = search_range(rect, x, y, w, N);</div><div class="line">        hash ^= ret;</div><div class="line">        tick(N, R, x, y, w);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%"</span> PRIi32 <span class="string">"\n"</span>, hash);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="DRS-h"><a href="#DRS-h" class="headerlink" title="DRS.h"></a>DRS.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __DRS_H</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> __DRS_H</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Rect</span> &#123;</span></div><div class="line">    <span class="keyword">int32_t</span> lx, ly, rx, ry;</div><div class="line">&#125; Rect;</div><div class="line"></div><div class="line"><span class="keyword">int32_t</span> search_range(Rect rect, <span class="keyword">int32_t</span> x[], <span class="keyword">int32_t</span> y[], </div><div class="line">        <span class="keyword">int32_t</span> w[], <span class="keyword">int32_t</span> n);</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<h3 id="DRS-c"><a href="#DRS-c" class="headerlink" title="DRS.c"></a>DRS.c</h3><p>你的目標是要加速下述函數的計算，通過最低要求加速 2 倍以上。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"DRS.h"</span></span></div><div class="line"></div><div class="line"><span class="keyword">int32_t</span> search_range(Rect rect, <span class="keyword">int32_t</span> x[], <span class="keyword">int32_t</span> y[], </div><div class="line">        <span class="keyword">int32_t</span> w[], <span class="keyword">int32_t</span> n) &#123;</div><div class="line">    <span class="keyword">int32_t</span> ret = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (rect.lx &lt;= x[i] &amp;&amp; x[i] &lt;= rect.rx &amp;&amp;</div><div class="line">            rect.ly &lt;= y[i] &amp;&amp; y[i] &lt;= rect.ry) &#123;</div><div class="line">            ret += w[i];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="測資限制"><a href="#測資限制" class="headerlink" title="測資限制"></a>測資限制</h2><ul>
<li>$N \le 131072$</li>
<li>$R \le 32768$</li>
</ul>
<h2 id="範例輸入"><a href="#範例輸入" class="headerlink" title="範例輸入"></a>範例輸入</h2><p><strong><em>no input</em></strong></p>
<h2 id="範例輸出"><a href="#範例輸出" class="headerlink" title="範例輸出"></a>範例輸出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">8967</div></pre></td></tr></table></figure>
<h2 id="編譯參數"><a href="#編譯參數" class="headerlink" title="編譯參數"></a>編譯參數</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">all: main</div><div class="line"></div><div class="line">main: main.c</div><div class="line">    gcc -std=c99 -Ofast -march=native DRS.c -c -o DRS.o</div><div class="line">    gcc -std=c99 -Ofast -march=native main.c DRS.o -o main</div></pre></td></tr></table></figure>
<ul>
<li>當前測試機器 Intel CPU E5-2620v3</li>
<li><a href="https://software.intel.com/sites/landingpage/IntrinsicsGuide/#" target="_blank" rel="external">Intel Intrinsics Guide</a></li>
</ul>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>一般的線性作法，透過 <code>rect.lx &lt;= x[i] &amp;&amp; x[i] &lt;= rect.rx &amp;&amp; rect.ly &lt;= y[i] &amp;&amp; y[i] &lt;= rect.ry</code> 操作，翻譯成組合語言時，四次的 branch &amp; jump，在管線處理上的效能易受到影響。為了使這種 branch 減少而不使管線處理的效能下降，通常會使用查表法來完成，藉由并行的數值計算，在最後一步才進行 load/store 完成指定區塊的指令。</p>
<p>在這一題中，唯有條件式皆成立才執行，由於分枝操作上只有一種情況，故查表法就不適用於此。我們仍可以并行數個矩形判斷，並且存在至少一個矩形成立再運行 load 加總所需的資料，將會給予效能上的大幅提升。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"DRS.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;x86intrin.h&gt;</span></span></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">int32_t search_range(Rect rect, int32_t x[], int32_t y[], </span></div><div class="line"><span class="comment">		int32_t w[], int32_t n) &#123;</span></div><div class="line"><span class="comment">	int32_t ret = 0;</span></div><div class="line"><span class="comment">	for (int i = 0; i &lt; n; i++) &#123;</span></div><div class="line"><span class="comment">		if (rect.lx &lt;= x[i] &amp;&amp; x[i] &lt;= rect.rx &amp;&amp;</span></div><div class="line"><span class="comment">			rect.ly &lt;= y[i] &amp;&amp; y[i] &lt;= rect.ry) &#123;</span></div><div class="line"><span class="comment">			ret += w[i];</span></div><div class="line"><span class="comment">		&#125;</span></div><div class="line"><span class="comment">	&#125;</span></div><div class="line"><span class="comment">	return ret;</span></div><div class="line"><span class="comment">&#125;</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">int32_t</span> search_range(Rect rect, <span class="keyword">int32_t</span> x[], <span class="keyword">int32_t</span> y[], <span class="keyword">int32_t</span> w[], <span class="keyword">int32_t</span> n) &#123;</div><div class="line">    __m128i ret = _mm_set_epi32(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    rect.lx--, rect.ly--;</div><div class="line">    rect.rx++, rect.ry++;</div><div class="line">    __m128i lx = _mm_broadcastd_epi32(*((__m128i *) &amp;rect.lx));</div><div class="line">    __m128i ly = _mm_broadcastd_epi32(*((__m128i *) &amp;rect.ly));</div><div class="line">    __m128i rx = _mm_broadcastd_epi32(*((__m128i *) &amp;rect.rx));</div><div class="line">    __m128i ry = _mm_broadcastd_epi32(*((__m128i *) &amp;rect.ry));</div><div class="line">    __m128i zo = _mm_set_epi32(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    __m128i ic = _mm_set_epi32(<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>);</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i+<span class="number">4</span> &lt;= n; i += <span class="number">4</span>) &#123;</div><div class="line">        __m128i sx = _mm_load_si128((__m128i *) (x+i));</div><div class="line">        __m128i sy = _mm_load_si128((__m128i *) (y+i));</div><div class="line">        __m128i c1 = _mm_and_si128(_mm_cmplt_epi32(lx, sx), _mm_cmplt_epi32(sx, rx));</div><div class="line">        __m128i c2 = _mm_and_si128(_mm_cmplt_epi32(ly, sy), _mm_cmplt_epi32(sy, ry));</div><div class="line">        <span class="keyword">if</span> (_mm_testz_si128(c1, c2) == <span class="number">0</span>) &#123;</div><div class="line">            __m128i cc = _mm_and_si128(c1, c2);</div><div class="line">            __m128i vi = _mm_add_epi32(ic, _mm_set_epi32(i, i, i, i));</div><div class="line">            __m128i rs = _mm_mask_i32gather_epi32(zo, w+i, ic, cc, <span class="number">4</span>);</div><div class="line">            ret = _mm_add_epi32(ret, rs);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">int32_t</span> sum = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = (n&gt;&gt;<span class="number">2</span>)&lt;&lt;<span class="number">2</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (rect.lx &lt;= x[i] &amp;&amp; x[i] &lt;= rect.rx &amp;&amp;</div><div class="line">            rect.ly &lt;= y[i] &amp;&amp; y[i] &lt;= rect.ry) &#123;</div><div class="line">            sum += w[i];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int32_t</span> tmp[<span class="number">4</span>] __attribute__ ((aligned (<span class="number">16</span>)));</div><div class="line">    _mm_store_si128((__m128i*) &amp;tmp[<span class="number">0</span>], ret);</div><div class="line">    sum += tmp[<span class="number">0</span>] + tmp[<span class="number">1</span>] + tmp[<span class="number">2</span>] + tmp[<span class="number">3</span>];</div><div class="line">    <span class="keyword">return</span> sum;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-20020" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/01/jg-20020/" class="article-date">
  <time datetime="2017-07-01T05:47:41.000Z" itemprop="datePublished">2017-07-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/01/jg-20020/">批改娘 20020. Dot Product</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/07/01/jg-20020/" data-id="ckw8q9fse00aeqwvnadddul0h" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/07/01/jg-20020/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SIMD/">SIMD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>請嘗試使用 SIMD 技術 AVX/SSE/MMX 來加速以下的純數值計算。</p>
<h3 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h3><p>最低需求加速兩倍快</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">rotate_left</span><span class="params">(<span class="keyword">uint32_t</span> x, <span class="keyword">uint32_t</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span>  (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">encrypt</span><span class="params">(<span class="keyword">uint32_t</span> m, <span class="keyword">uint32_t</span> key)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (rotate_left(m, key&amp;<span class="number">31</span>) + key)^key;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">static</span> uint32_t <span class="title">f</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> off, <span class="keyword">uint32_t</span> key1, <span class="keyword">uint32_t</span> key2)</span> </span>&#123;</div><div class="line">    <span class="keyword">uint32_t</span> sum = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = off; i &lt; N; i++, j++)</div><div class="line">        sum += encrypt(j, key1) * encrypt(j, key2), i++, j++;</div><div class="line">    <span class="keyword">return</span> sum;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N;</div><div class="line">    <span class="keyword">uint32_t</span> key1, key2;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %"</span> PRIu32 <span class="string">" %"</span> PRIu32, &amp;N, &amp;key1, &amp;key2) == <span class="number">3</span>) &#123;</div><div class="line">        <span class="keyword">uint32_t</span> sum = f(N, <span class="number">0</span>, key1, key2);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%"</span> PRIu32 <span class="string">"\n"</span>, sum);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="輸入格式"><a href="#輸入格式" class="headerlink" title="輸入格式"></a>輸入格式</h2><p>有多組測資，每組一行包含三個整數 <span>$N, \; \text{key1}, \; \text{key2}$</span><!-- Has MathJax -->，表示向量長度 <span>$N$</span><!-- Has MathJax -->、向量 <span>$\vec{A}$</span><!-- Has MathJax --> 由亂數種子 <span>$\text{key1}$</span><!-- Has MathJax --> 產生、向量 <span>$\vec{B}$</span><!-- Has MathJax --> 由亂數種子 <span>$\text{key2}$</span><!-- Has MathJax --> 產生。</p>
<ul>
<li>$1 \le N \le 16777216$</li>
</ul>
<h2 id="輸出格式"><a href="#輸出格式" class="headerlink" title="輸出格式"></a>輸出格式</h2><p>對於每組測資輸出一行整數，為 <span>$\vec{A} \cdot \vec{B}$</span><!-- Has MathJax --> 的 unsigned 32-bit integer 結果。</p>
<h2 id="範例輸入"><a href="#範例輸入" class="headerlink" title="範例輸入"></a>範例輸入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">16777216 1 2</div><div class="line">16777216 3 5</div></pre></td></tr></table></figure>
<h2 id="範例輸出"><a href="#範例輸出" class="headerlink" title="範例輸出"></a>範例輸出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2885681152</div><div class="line">2147483648</div></pre></td></tr></table></figure>
<h2 id="編譯參數"><a href="#編譯參數" class="headerlink" title="編譯參數"></a>編譯參數</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc -std=c99 -O3 -march=native main.c -lm</div></pre></td></tr></table></figure>
<h2 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h2><ul>
<li>當前測試機器 Intel CPU E5-2620v3</li>
<li><a href="https://software.intel.com/sites/landingpage/IntrinsicsGuide/#" target="_blank" rel="external">Intel Intrinsics Guide</a></li>
</ul>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>對於數值計算時，SIMD 能充分地加速程序，每一個元素皆經過一連串的數學函數計算，那麼把一連串的數學式拆分，化成最簡的邏輯計算，並且找出常數向量存放到暫存器中。如在影像處理的程序，即使沒有 GPU 幫忙，搭配 SIMD 也是個不錯的選擇，可以加速 2~4 倍之多。</p>
<p>為了凸顯效能差異，題目設計時必須在計算單一元素結果上複雜些，防止大部分的加速效果是來自於減少 branch 操作 (loop unrolling)。</p>
<h3 id="AVX"><a href="#AVX" class="headerlink" title="AVX"></a>AVX</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;x86intrin.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">rotate_left</span><span class="params">(<span class="keyword">uint32_t</span> x, <span class="keyword">uint32_t</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span>  (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">encrypt</span><span class="params">(<span class="keyword">uint32_t</span> m, <span class="keyword">uint32_t</span> key)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (rotate_left(m, key&amp;<span class="number">31</span>) + key)^key;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> uint32_t <span class="title">SSE</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> off, <span class="keyword">uint32_t</span> key1, <span class="keyword">uint32_t</span> key2)</span> </span>&#123;</div><div class="line">    <span class="keyword">uint32_t</span> sum = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = (N&gt;&gt;<span class="number">3</span>)&lt;&lt;<span class="number">3</span>; i &lt; N; i++)</div><div class="line">        sum += encrypt(i+off, key1) * encrypt(i+off, key2);</div><div class="line">    __m256i s_i = _mm256_set_epi32(off, off+<span class="number">1</span>, off+<span class="number">2</span>, off+<span class="number">3</span>, off+<span class="number">4</span>, off+<span class="number">5</span>, off+<span class="number">6</span>, off+<span class="number">7</span>);</div><div class="line">    __m256i s_4 = _mm256_set_epi32(<span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>);</div><div class="line">    __m256i s_k1 = _mm256_set_epi32(key1, key1, key1, key1, key1, key1, key1, key1);</div><div class="line">    __m256i s_k2 = _mm256_set_epi32(key2, key2, key2, key2, key2, key2, key2, key2);</div><div class="line">    <span class="keyword">uint32_t</span> modk1 = key1&amp;<span class="number">31</span>;</div><div class="line">    <span class="keyword">uint32_t</span> modk2 = key2&amp;<span class="number">31</span>;</div><div class="line">    <span class="keyword">uint32_t</span> cmodk1 = <span class="number">32</span> - modk1;</div><div class="line">    <span class="keyword">uint32_t</span> cmodk2 = <span class="number">32</span> - modk2;</div><div class="line">    __m256i s_ret = _mm256_set_epi32(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    N &gt;&gt;= <span class="number">3</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> it = <span class="number">0</span>; it &lt; N; it++) &#123;</div><div class="line">        __m256i r_1 = _mm256_or_si256(_mm256_slli_epi32(s_i, modk1), _mm256_srli_epi32(s_i, cmodk1));</div><div class="line">        r_1 = _mm256_xor_si256(_mm256_add_epi32(r_1, s_k1), s_k1);</div><div class="line">        __m256i r_2 = _mm256_or_si256(_mm256_slli_epi32(s_i, modk2), _mm256_srli_epi32(s_i, cmodk2));</div><div class="line">        r_2 = _mm256_xor_si256(_mm256_add_epi32(r_2, s_k2), s_k2);</div><div class="line">        __m256i r_m = _mm256_mullo_epi32(r_1, r_2);</div><div class="line">        s_ret = _mm256_add_epi32(s_ret, r_m);</div><div class="line">        s_i = _mm256_add_epi32(s_i, s_4);</div><div class="line">    &#125;</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">int32_t</span> tmp[<span class="number">8</span>] __attribute__ ((aligned (<span class="number">32</span>)));</div><div class="line">        _mm256_store_si256((__m256i*) &amp;tmp[<span class="number">0</span>], s_ret);</div><div class="line">        sum += tmp[<span class="number">0</span>] + tmp[<span class="number">1</span>] + tmp[<span class="number">2</span>] + tmp[<span class="number">3</span>];</div><div class="line">        sum += tmp[<span class="number">4</span>] + tmp[<span class="number">5</span>] + tmp[<span class="number">6</span>] + tmp[<span class="number">7</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> sum;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N;</div><div class="line">    <span class="keyword">uint32_t</span> key1, key2;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %"</span> PRIu32 <span class="string">" %"</span> PRIu32, &amp;N, &amp;key1, &amp;key2) == <span class="number">3</span>) &#123;</div><div class="line">        <span class="keyword">uint32_t</span> sum = SSE(N, <span class="number">0</span>, key1, key2);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%"</span> PRIu32 <span class="string">"\n"</span>, sum);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SSE"><a href="#SSE" class="headerlink" title="SSE"></a>SSE</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;x86intrin.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">rotate_left</span><span class="params">(<span class="keyword">uint32_t</span> x, <span class="keyword">uint32_t</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span>  (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">encrypt</span><span class="params">(<span class="keyword">uint32_t</span> m, <span class="keyword">uint32_t</span> key)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (rotate_left(m, key&amp;<span class="number">31</span>) + key)^key;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> uint32_t <span class="title">SSE</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> off, <span class="keyword">uint32_t</span> key1, <span class="keyword">uint32_t</span> key2)</span> </span>&#123;</div><div class="line">    <span class="keyword">uint32_t</span> sum = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = N/<span class="number">4</span>*<span class="number">4</span>; i &lt; N; i++)</div><div class="line">        sum += encrypt(i+off, key1) * encrypt(i+off, key2);</div><div class="line">    __m128i s_i = _mm_set_epi32(off, off+<span class="number">1</span>, off+<span class="number">2</span>, off+<span class="number">3</span>);</div><div class="line">    __m128i s_4 = _mm_set_epi32(<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>);</div><div class="line">    __m128i s_k1 = _mm_set_epi32(key1, key1, key1, key1);</div><div class="line">    __m128i s_k2 = _mm_set_epi32(key2, key2, key2, key2);</div><div class="line">    <span class="keyword">uint32_t</span> modk1 = key1&amp;<span class="number">31</span>;</div><div class="line">    <span class="keyword">uint32_t</span> modk2 = key2&amp;<span class="number">31</span>;</div><div class="line">    <span class="keyword">uint32_t</span> cmodk1 = <span class="number">32</span> - modk1;</div><div class="line">    <span class="keyword">uint32_t</span> cmodk2 = <span class="number">32</span> - modk2;</div><div class="line">    __m128i s_ret = _mm_set_epi32(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    N &gt;&gt;= <span class="number">2</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> it = <span class="number">0</span>; it &lt; N; it++) &#123;</div><div class="line">        __m128i r_1 = _mm_or_si128(_mm_slli_epi32(s_i, modk1), _mm_srli_epi32(s_i, cmodk1));</div><div class="line">        r_1 = _mm_xor_si128(_mm_add_epi32(r_1, s_k1), s_k1);</div><div class="line">        __m128i r_2 = _mm_or_si128(_mm_slli_epi32(s_i, modk2), _mm_srli_epi32(s_i, cmodk2));</div><div class="line">        r_2 = _mm_xor_si128(_mm_add_epi32(r_2, s_k2), s_k2);</div><div class="line">        __m128i r_m = _mm_mullo_epi32(r_1, r_2);</div><div class="line">        s_ret = _mm_add_epi32(s_ret, r_m);</div><div class="line">        s_i = _mm_add_epi32(s_i, s_4);</div><div class="line">    &#125;</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">int32_t</span> tmp[<span class="number">4</span>] __attribute__ ((aligned (<span class="number">16</span>)));</div><div class="line">        _mm_store_si128((__m128i*) &amp;tmp[<span class="number">0</span>], s_ret);</div><div class="line">        sum += tmp[<span class="number">0</span>] + tmp[<span class="number">1</span>] + tmp[<span class="number">2</span>] + tmp[<span class="number">3</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> sum;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N;</div><div class="line">    <span class="keyword">uint32_t</span> key1, key2;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %"</span> PRIu32 <span class="string">" %"</span> PRIu32, &amp;N, &amp;key1, &amp;key2) == <span class="number">3</span>) &#123;</div><div class="line">        <span class="keyword">uint32_t</span> sum = SSE(N, <span class="number">0</span>, key1, key2);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%"</span> PRIu32 <span class="string">"\n"</span>, sum);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-20018" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/01/jg-20018/" class="article-date">
  <time datetime="2017-07-01T05:27:09.000Z" itemprop="datePublished">2017-07-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/01/jg-20018/">批改娘 20018. Square Root of Vector Elements</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/07/01/jg-20018/" data-id="ckw8q9fsd00abqwvn053xyulr" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/07/01/jg-20018/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SIMD/">SIMD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>Intel 公司在 X86 指令集上提供了 AVX (Advanced Vector Extensions)、SSE (Streaming SIMD Extensions) 的特殊指令，這些在 SIMD 指令上提供強力的加速。</p>
<h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>現在給你長度為 <span>$N$</span><!-- Has MathJax --> 的 32-bit floating point，分別將其開根號回傳。</p>
<ul>
<li>你可能會需要函數庫 <code>#include &lt;x86intrin.h&gt;</code></li>
<li>你可能會需要 AVX/SSE 開根指令 <a href="https://software.intel.com/en-us/cpp-compiler-18.0-developer-guide-and-reference-mm256-sqrt-ps" target="_blank" rel="external"><code>__m256 _mm256_sqrt_ps(__m256 a);</code></a></li>
</ul>
<h3 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"VSQRT.h"</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">float</span> a[<span class="number">1048576</span>], b[<span class="number">1048576</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</div><div class="line">        a[i] = i;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> it = <span class="number">0</span>; it &lt; <span class="number">20</span>; it++)</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">memcpy</span>(b, a, <span class="keyword">sizeof</span>(a[<span class="number">0</span>])*N);</div><div class="line">        <span class="keyword">clock_t</span> t = clock();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</div><div class="line">            sqrt2(b, b+N);</div><div class="line">        t = clock() - t;</div><div class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"It took me %f seconds.\n"</span>, ((<span class="keyword">float</span>) t)/CLOCKS_PER_SEC);</div><div class="line">        <span class="keyword">float</span> sum = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</div><div class="line">            sum += b[i];</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%f\n"</span>, sum);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="VSQRT-h"><a href="#VSQRT-h" class="headerlink" title="VSQRT.h"></a>VSQRT.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __VSQRT_H</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> __VSQRT_H</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sqrt2</span><span class="params">(<span class="keyword">float</span> *begin, <span class="keyword">float</span> *end)</span></span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<h3 id="VSQRT-c"><a href="#VSQRT-c" class="headerlink" title="VSQRT.c"></a>VSQRT.c</h3><p>請嘗試加速以下程式碼。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"VSQRT.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sqrt2</span><span class="params">(<span class="keyword">float</span> *begin, <span class="keyword">float</span> *end)</span> </span>&#123;</div><div class="line">     <span class="keyword">for</span> (; begin != end; begin++)</div><div class="line">         *begin = <span class="built_in">sqrt</span>(*begin);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Sample-Input-stdin"><a href="#Sample-Input-stdin" class="headerlink" title="Sample Input (stdin)"></a>Sample Input (stdin)</h2><p><strong><em> no input </em></strong></p>
<h2 id="Sample-Output-stdout"><a href="#Sample-Output-stdout" class="headerlink" title="Sample Output (stdout)"></a>Sample Output (stdout)</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>這裡我們使用 Intel CPU 撰寫 SIMD 指令時，透過編譯參數 <code>-msse -mavx ...</code> 指定相關的指令集進行調適。這些單一指令多資料處理的操作，使得在指定層級得到較高的平行度。</p>
<p>為了使用它們，我們需要較多的前置處理，例如要把資料載入和儲存時，必然要符合對齊的標準，若記憶體位址不是 32 的倍數 (AVX 的 256 bits) 或者 16 的倍數 (SSE 的 128 bits)，則系統會產生 trap，進而導致程式運行中斷而發生錯誤。這方面必須特別小心，有時編譯器恰好幫你對齊而正常運行，若增加其他變數時，對齊就有可能跑掉，這時候再去找錯誤會變得相當瑣碎。</p>
<p>通常些 SSE/AVX 加速指令，將會在 <code>gcc -Ofast</code> 中使用，而在 <code>-O3</code> 下仍有可能尚未開啟。而在 LLVM 中的 <code>clang -O2</code> 編譯下就會自動開啟 SSE。無論如何，要明白開啟這些的并行指令的代價，數據小造成運行效能低落，隨著資料量遽增才會明顯加速，若牽涉到浮點數計算，務必注意精準度的需求。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"VSQRT.h"</span></span></div><div class="line"> </div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;x86intrin.h&gt;</span></span></div><div class="line"> </div><div class="line"><span class="comment">//#undef __AVX__</span></div><div class="line"><span class="comment">//#undef __SSE__</span></div><div class="line"> </div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(__AVX__)</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sqrt2</span><span class="params">(<span class="keyword">float</span> *a, <span class="keyword">float</span> *end)</span> </span>&#123;</div><div class="line">    <span class="keyword">uint32_t</span> offset = ((<span class="keyword">void</span> *) a - (<span class="keyword">void</span> *) <span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span> (; a &lt; end &amp;&amp; (offset&amp;<span class="number">31</span>); a++, offset += <span class="keyword">sizeof</span>(<span class="keyword">float</span>))</div><div class="line">        *a = <span class="built_in">sqrt</span>(*a);</div><div class="line">    __m256* ptr = (__m256*) a;</div><div class="line">    <span class="keyword">for</span> (; a + <span class="number">8</span> &lt;= end; a += <span class="number">8</span>, ptr++)</div><div class="line">        _mm256_store_ps(a, _mm256_sqrt_ps(*ptr));</div><div class="line">    <span class="keyword">for</span> (; a &lt; end; a++)</div><div class="line">        *a = <span class="built_in">sqrt</span>(*a);</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__SSE__)</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sqrt2</span><span class="params">(<span class="keyword">float</span> *a, <span class="keyword">float</span> *end)</span> </span>&#123;</div><div class="line">    <span class="keyword">uint32_t</span> offset = ((<span class="keyword">void</span> *) a - (<span class="keyword">void</span> *) <span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span> (; a &lt; end &amp;&amp; (offset&amp;<span class="number">15</span>); a++, offset += <span class="keyword">sizeof</span>(<span class="keyword">float</span>))</div><div class="line">        *a = <span class="built_in">sqrt</span>(*a);</div><div class="line">    __m128* ptr = (__m128*) a;</div><div class="line">    <span class="keyword">for</span> (; a + <span class="number">4</span> &lt;= end; a += <span class="number">4</span>, ptr++)</div><div class="line">        _mm_store_ps(a, _mm_sqrt_ps(*ptr));</div><div class="line">    <span class="keyword">for</span> (; a &lt; end; a++)</div><div class="line">        *a = <span class="built_in">sqrt</span>(*a);</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sqrt2</span><span class="params">(<span class="keyword">float</span> *begin, <span class="keyword">float</span> *end)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (; begin != end; begin++)</div><div class="line">        *begin = sqrtf(*begin);</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-parallel-TA" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/01/parallel-TA/" class="article-date">
  <time datetime="2017-07-01T02:02:25.000Z" itemprop="datePublished">2017-07-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/W9PD2EB.jpg" rel="gallery_ckw8q9ftp00dnqwvn21d0krca">
        <img src="http://i.imgur.com/W9PD2EB.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/01/parallel-TA/">助教生涯－平行總結</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/07/01/parallel-TA/" data-id="ckw8q9ftp00dnqwvn21d0krca" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/07/01/parallel-TA/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/實作技巧/">實作技巧</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <p>從碩班入學開始的這兩年內，助教一職圍繞在身邊許久，不擅長教別人的我卻非得接下這份工作－「教練，我可以不當助教嗎？」一轉眼兩年過去，當了三個學期半的助教，兩年間也不過四個學期，我想這些經歷肯定對於其他人是特別的，甚至會覺得有博班學長跟你一起當助教。不幸地，沒人可以給你經驗學習當助教－「從今天開始，你就是課程助教了！」</p>
<h2 id="關於作業"><a href="#關於作業" class="headerlink" title="關於作業"></a>關於作業</h2><p>大部分的課程都會使用的相同作業，助教只需要發下去給同學們寫就好。若加點變化，這就讓助教苦了，那是為什麼呢？一個小小的更動將更新參考答案、增加檢測方法、準備應付學生難以理解題目的諮詢，單兵作業的情況下，要如何做到全面防守便是一場長期消耗戰。</p>
<p>在學校課程中，也只有幾堂課是週週出作業、交作業，那週週改作業是怎麼一回事！那麼就是一個完全的管線處理，一下子從期初忙到期末，作業格式要找老師檢查、課堂中督導學生撰寫、課後收作業批閱、收到補交作業批改、接獲隔週作業需求設計、進行初步實驗和作業規劃、郵件通知學生 … 等，每週這樣子循環，有時候在想要是突然生病或消失，會出什麼事情呢？好想知道，希望是個可以找個人接替的日子，那麼就能好好地做自己的事情。</p>
<p>永無止盡地思考——這樣的設計會不會出事？誰能來提供更好的解法，能不能再設計得更好了一些？你是否也有相同的煩惱呢？</p>
<h2 id="關於考試"><a href="#關於考試" class="headerlink" title="關於考試"></a>關於考試</h2><p>考試不像作業有一陣子的緩衝期，出題面向與準備方向需要跟老師確定，一旦沒有喬好，就會在學生和老師間被踢來踢去，要是讓學生準備方向錯誤，那麼一定會件很可怕的事情。檢查再檢查，還是會有一些描述在當下造成學生無法理解的部分。更擔心的是，知道考題內容也沒有附上參考答案和配分方法。當問答題時更為頭痛，總會有那些出乎意料的答題方法，學生考試當下詢問時，這要怎麼辦呢？例外處理要怎麼給分？</p>
<p>考卷批改又是另一回事，由老師改還是助教改呢？改完就要準備讓學生檢討「助教？為什麼這會錯？為什麼他寫那樣就會對，我寫就不對？」有時候，文字描述總是很可怕的，當我們充分理解這位仁兄時，看考卷的觀點會變成「假設你懂」相反地就是「假設你不懂」，通常都要以後者為主，但如果偏向實作課程時，對於那些實作能力很好，卻不想背誦專有名詞定義的高手而感到惋惜。</p>
<p>最好的解決方法，就是助教都認得出來每個學生和表現，這樣也許會好上一些，一個學期能不能認識一個班級的人呢？有些很少出現和表現的同學，到底要怎麼認識啊！</p>
<h2 id="關於環境架設"><a href="#關於環境架設" class="headerlink" title="關於環境架設"></a>關於環境架設</h2><p>在程式撰寫方面，替學生進行環境設定相當苦惱，因為有分成標準與不標準，像我這種非正規教育出來的，只知道一堆網路搜索的資訊結果，哪一種解決方法才是最好的，能帶到下一個運行版本下持續運作，長遠性的規劃！只發現以前課程所遺留下來的資料，大多都有一些毛病在，還有一些尚未描述清楚的部分。「咱很笨，能教教我嗎？上上上屆學長們，你們消失到哪了？」</p>
<p><img src="http://i.imgur.com/s8NlOr9.jpg" alt="「原來我之前什麼都不明白啊」—《正解的卡多 KADO》"></p>
<h2 id="雜言"><a href="#雜言" class="headerlink" title="雜言"></a>雜言</h2><p><img src="http://i.imgur.com/cBeZmFH.jpg" alt="「無言」－《從零開始的魔法書》"></p>
<p>當收到同學問程式，時常忘記給予任何嘗試的足跡，只有一份有錯的程序，接著就要助教幫忙通靈找錯誤，你先可以問問一起修課的同學嗎？每次都這樣子的話，咱已經受不了啊，一年、兩年過去，也疲於應付這些，我也想要屬於我自己的救贖啊！</p>
<p><img src="http://i.imgur.com/Rv1eT0c.jpg" alt="「」－《為美好的世界獻上祝福》"></p>
<p>每週跟課三個多小時，又要確定作業題目、生測資和測試，我自己也想鑽研作業，所追求的作業是沒有底的標準，能更好就更好，多給一點意見，讓我也能從中學習吧，為什麼都只有作業寫好就完事？有點傷心，不甘如此地結束，你能驚艷我的，對吧？</p>
<p>從系統環境架設、考試準備、通知學生和課程時替學生除錯，製作課程簡報，修正幾代學長遺留下來的錯誤，撰寫參考解答，追求更好的效能與算法，行政事項的準備，還有外來的委託架設。該經歷的都經歷了，只是一個人忙不太過來，也一直撐不住這麼多龐大的壓力。</p>
<p>然而，要準備離開學校的當下，信箱不時有一些待申請的大一新生信件，其中還會有外系學生想要使用我們課程中使用的系統來學習。系上的轉系考要我弄環境、考題，看來我的人生很不平靜呢 … 一些邏輯說不通的事情發生在身上時，過得是多麼無力呀。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-diary-201705-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/04/diary-201705-2/" class="article-date">
  <time datetime="2017-05-04T03:46:34.000Z" itemprop="datePublished">2017-05-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/BsbOqhH.jpg" rel="gallery_ckw8q9fpu003xqwvnznaw3mm2">
        <img src="http://i.imgur.com/BsbOqhH.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/04/diary-201705-2/">純粹 Part 2</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/05/04/diary-201705-2/" data-id="ckw8q9fpu003xqwvnznaw3mm2" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/05/04/diary-201705-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <p>接續上一篇所講，繼續說下去吧。</p>
<p>「神明曾向某個青年下了詛咒，那是看到悲傷之人就會全身感到痛苦的詛咒。青年為了避免自己痛苦，於是向所有悲傷的人伸出了援手 —— 神明著著他的樣子，仿製了一個外貌、動作與他一模一樣的假貨，他也像真正的青年一樣對所有悲傷的人伸出了援手。神明分別為他們起了名字 —— 一方為善，另一方為偽善。你覺得哪個是善，哪個是偽善？」－《重啟咲良田》</p>
<p>純粹究竟是什麼樣子？不帶有任何的自我意識，完全地無意識到周遭，更不會去評斷做了什麼，就只是去做，最終是好是壞那又是什麼？不是我們給予一個行為或結果的解釋嗎，都只是解釋的話，真相有必要探究嗎？若是純粹，那還可以被稱作人？還是被稱為機器人合適？</p>
<p>純粹地，想知道。</p>
<h2 id="日常篇"><a href="#日常篇" class="headerlink" title="日常篇"></a>日常篇</h2><p>原本只是想做一個簡單的平行算法，從趕 Conference 論文換成 Transaction 論文，原本 Conference 論文頁數不得超過十頁，導致很多提及的數據結構都不太想仔細說明，咱的指導老師只好先改其他人的論文投 Conference，而我被安排到投 Transaction，沒有任何時間壓力。</p>
<p>三月中是個分水嶺，同屆的只剩下我要寫論文，其他人已經不用到校 (只要不接助教工作，事實上不必總是到實驗室)，而我還接下了平行助教的工作，到學校等著論文修改的 on call，平常實驗室只剩下我和學弟們，不時跟他們討些作業來做，亦或者討論計畫所需要的算法。也許有人會想問，那實驗室的博班學長呢？只有 meeting 那一天有機會在實驗室見著，平常是完全的零交流，是非常平行的實驗室呢！</p>
<p>當助教的日子裡，就像去年一樣「我不知道該怎麼辦，但覺得這樣下去不太行。」，若跟其他人一樣顧好自己畢業，其他事都不管的話，這裡的許許多多事情終究會重複上演。設計題目出測資，看相關論文後，做個簡單的簡報，在每週跟課的時候跟同學說明，為了設計新的題目而調整系統，按照這個行程走，每天都有一些工作需要處理。</p>
<p><img src="http://i.imgur.com/KFoit6t.jpg" alt="「和其他人一起努力的話，很多問題可以迎刃而解」－《3月的獅子》"></p>
<p>然而，做的一切還會被同學嫌。要說這裡是台大嗎？讓我這個半吊子當助教本身就是錯的，我是來學習的，不是來工作的！真正值得學習的對象卻很少出現在我眼前給予我指導，曾經的我也好想在這裡永遠追隨某人、想和其他人一起努力，但每個人都有自己的規則和約束，能一起努力的機會就更少了，有著各自的工作與理念，即使在第一學府眾多的人群中，也未必能找到能共事的同事。</p>
<p>助教工作時看著自己專研過的算法和代碼，不時地仍會看著其他人的程序學習，儘管在運行上可能不是很有效率、邏輯不漂亮。別因為追不到我的程序就放棄努力，我仍然可以向妳學習「就差那麼一步，你的想法將會推翻整個局面，本該如此的美麗，卻少了最後那份信心。」《3月的獅子》，別過於相信我，我並沒你們想像中地強大。</p>
<p><img src="http://i.imgur.com/IiwHJgw.jpg" alt="「本應如此地美麗」－《3月的獅子》"></p>
<p>論文從十頁放寬到二十五頁的限制，能放置的圖表更加地豐富，老師要我從祖宗十八代的算法開始描述，必且要講得可以不查閱其他論文和資料就能閱讀，大部分的內容都被要求重寫，提及約十個算法、快二十張圖片說明，製圖耗費的經歷更加地多 (原因都來自於版本控制的需求，畫圖都像寫程式一般)，調整描寫順序，用最簡單的方法講清楚一件事情，於是一下子就到了快二十五頁。改我論文的痛苦已經充分展現在老師的臉書塗鴉牆，那大概是老師有生之年第一次這麼辛苦。</p>
<p><img src="http://i.imgur.com/moKcWOd.jpg" alt="「為了創作出傑作，我正在養精蓄銳」－《我的妹妹是黃漫老師》"></p>
<p>別太期待會有什麼特別的，自己覺得挺簡單的，可能還沒有什麼用呢。</p>
<h2 id="計畫篇"><a href="#計畫篇" class="headerlink" title="計畫篇"></a>計畫篇</h2><p>因為要回學校當助教又要改論文，暫時辭去了實習工作 (留職停薪？為什麼不打算讓我離職，怎麼想都很奇怪，這麼照顧我，真的辛苦你們了)，畢業之後又會到哪裡，做些什麼事情，不經讓我想起《秒速五釐米》的那段話，</p>
<p><img src="http://i.imgur.com/4HcqoP1.jpg" alt="「總之這幾年裡，我很想向前邁進，想觸及那無法觸及的事物，儘管不知道那具體指什麼。我不知道這份勉強的感情是從何處如何孕育而生，只能一味地工作，等回過神來，日漸喪失彈性的心靈是如此傷痛。接著某天早上，我意識到過去那份銘刻於心的感情已消失得無影無踪，我知道自己到了極限，於是辭去了工作。」─《秒速五釐米》"></p>
<p>那份心情到底要如何醞釀？為了什麼而活的心情？想等待著什麼樣的日子？太多太多的問題想要知道，還是不需要去想意義，若是每一件事情都去找意義，那就不能做事了，那先做看看吧，誰也不知道答案！當然，接受包養的情況也是可以接受的！</p>
<p><img src="http://i.imgur.com/GnoM6AI.jpg" alt="「請包養我！我真的不想去工作」－《不正經的魔術講師雨禁忌教典》"></p>
<h2 id="理念篇"><a href="#理念篇" class="headerlink" title="理念篇"></a>理念篇</h2><p>在台大讀研究所，有時會覺得佔了某人的位置，畢竟一開始的我並不在這裡，而應該出現在這裡的人卻又不怎麼出現，我出現在這裡合適嗎？如果合適的話，為什麼要這樣對我？如果不合適的話，又為什麼要這樣要求我？不得不去思考這些問題，否則就很難邁出下一步。</p>
<p><img src="http://i.imgur.com/B6QVTEZ.jpg" alt="「有時我會覺得佔了某人的位置，這讓我感到難過。比方說，活在世上就是一種浪費，霸佔了其他人的位置，他們也許能活出更有意義的人生」－《愛在來世》"></p>
<p>很想追祢，也很想追妳，在同一個次元也罷，不同次元也行，那是成為一般人且獲得認同的證明，對於我是如此地渴望。</p>
<p><img src="http://i.imgur.com/zNKmBDF.jpg" alt="「就算是距離無法縮短，也不能成為我不前進的理由」－《3月的獅子》"></p>
<p>人們說那種東西只是個雙保險，也許，只是害怕一個人待著，那晚的事情我還記得很清楚，晚上十點多寫完程式闔上筆電，跟家人說聲晚安，走上樓睡覺時，覺得今晚是如此地奇怪，總覺得從另一個視角看著自己，但什麼事情也沒發生，無疑地躺上床後，馬上被寫程式的疲累帶進夢裡。</p>
<p>半夜突然驚醒，正要拿起手機看時間，坐在床上都會倒下，在半夜裡無助地喊著，一邊思考著「是不是要結束人生了，我的腦已經要停止運作了嗎？」還好那時在家裡，半夜還能被送去急診，無力的我還得被推著輪椅進去，醫師只跟我說明是「腸胃炎」，那時的我不怎麼相信，畢竟腸胃炎都得過多少次了，都還沒遇過這種情況。</p>
<p>躺在上休息的我，吃不下也喝不下，就只是發呆著，等著可以分清楚方向，那時朋友仍用著我的帳號在臉書發圖文，家人還以為我已經好到可以用手機發文，誰都不知道、也沒發現早已陣亡的我，一如往常地回覆我。這才發現不需要我也可以正常運作，這世界的容錯能力很好，一瞬間就可以修正我這個錯誤。之後的我更沒想過會失去平衡一個多月，車也不敢騎，頭也不敢回，快速轉個頭可能就要跌倒，那究竟是什麼情況，至今還不清楚。</p>
<p><img src="http://i.imgur.com/6GEwa39.jpg" alt="「我十七歲的時候還在妄想著『自己會不會成為很厲害的人啊』」－《3月的獅子》"></p>
<p>曾經的幻想「自己會不會成為很厲害的人啊」，到了考大學的結果才發現一點也不行，有些東西就是學不來，真的學不來呀，怎麼樣追逐的速度都跟不上，只能在一旁一味地看著自己離大家越來越遠，最後吊了車尾。</p>
<p><img src="http://i.imgur.com/0xciq0c.jpg" alt="「想到要為了賺錢，埋首研究如何讓日常生活更便利，就受不了，我要為了思考而思考」－《世紀天才》"></p>
<p>我想要為了思考而思考，找了工作後，身旁的人就很在意薪水多高，不斷地吹捧那薪水價值，但我想那都不是重點，回顧一個常見的小故事——</p>
<p>〈說話的藝術〉的小故事「如果你說一個女大學生，晚上去夜總會陪酒，聽起來就不太好，可如果你說一個夜總會小姐，白天堅持去大學聽課，就滿滿的正能量了。如果你說你是一個學者，開了個公司，會被鄙視，認為你俗，真是斯文敗類。可是如果你說你是一個商人，經商之餘還專研學術，別人會肅然起敬，尊稱你為儒商。所以說話的時候，順序特別重要。」</p>
<p>我想說得差不多對照類似的意思，強調的順序反了！理念上感到非常奇怪的點。</p>
<blockquote>
<p>貼了圖不久，就收到了訊息<br>「你可以為了思考而思考」<br>「然後錢給我，幫你花！」</p>
</blockquote>
<p>此時，我的心情寫照</p>
<p><img src="http://i.imgur.com/V6SsDfC.jpg" alt="「你這麼說的話，不就是在表達想跟我永遠在一起嗎」－《從零開始的魔法書》"></p>
<p>儘管知道這只是純粹的話，仍必須好好地建造高牆，否則容易受到動搖。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-diary-201705" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/03/diary-201705/" class="article-date">
  <time datetime="2017-05-03T11:51:34.000Z" itemprop="datePublished">2017-05-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/QfgFMVC.jpg" rel="gallery_ckw8q9fpm003cqwvnrm3xpu6l">
        <img src="http://i.imgur.com/QfgFMVC.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/03/diary-201705/">純粹 Part 1</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/05/03/diary-201705/" data-id="ckw8q9fpm003cqwvnrm3xpu6l" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/05/03/diary-201705/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <p>從二月到五月這段日子，發生了許多事情，也有些不變的日常。其中，有一段疲於應付的日子過得水生火熱，又在其中穿插了幾段小趣事，獻給想到聽八卦的朋友們，接下來將分成感情、日常、計畫與理念四篇。</p>
<p>感情篇——在一月時已提及了大部分感情篇的要素，那些沒有後續的故事，通常不太想去提及、不想去談論，那是純粹的還是虛偽的感情？這些問題隨著這段日子不斷反覆思考著。</p>
<p>日常篇——講著大部分的實驗室的情況，我的日常不是一般的日常，回家就是睡，醒來就會在實驗室，說是一般的娛樂，也都是在學校度過。其原因可以歸納在「反正我沒有朋友、沒有女朋友，有著大把大把的時間可以去思考。」</p>
<p>計畫篇——計畫著下一階段要怎麼運行，一旦失去學生身份，就得開始履行當兵義務，而當完兵又是怎麼樣的日子，我應該要以什麼的理念活下去？</p>
<p>理念篇——從國小曾思考著「世界是否從我眼界下才開始構築」，到現在不斷地加深自己的理念，與其拓展到個方位上的思考轉換，那些思考有什麼意義？</p>
<h2 id="感情篇"><a href="#感情篇" class="headerlink" title="感情篇"></a>感情篇</h2><p>明白和揣測對方的想法，就像寫程序就能想到執行的預期結果是怎麼樣子，只要構築環境與每一步的指令都相當明確，那麼結果必然呼之欲出。這個能力用於寫程式很方便，一旦用到了感情上就不被接受。</p>
<p>當朋友身邊有著不錯的對象，也有著像漫畫劇情般那樣發展，在對方尚未開口的處境下，喜歡與不喜歡就決定於下一步，有可能錯過一個表明心意的機會，人生就差了十萬八千里遠。基於上述，學弟和朋友們開始喧鬧「不試著找個機會告白嗎？」「她應該在等你了吧」… 等。</p>
<p><img src="http://i.imgur.com/RPDNDzV.jpg" alt="「其實我不善與人交談」－《風夏》"></p>
<p>「別鬧了，你們不夠理解她，她本來就是這樣子的人 …」那些無法用語言表述的推測，明確地告訴我，對方本質加上輸入後的結果－不會成功、也不會失敗，沒有機會告白，也不會有機會告白，我試著將這些跟朋友說到，但是誰也不信我。</p>
<p>然後到了某天早晨，在意識不清的情況下，傳了一張圖片過去，上頭這麼寫著「我有著一種能力，喜歡的對象總會有男朋友」想著考慮要交男朋友的她，我的能力也許能幫上她，「妳交上男朋友了嗎？」如此地問道，收拾著包包去學校，在等十字路口紅綠燈時，看到走在一旁男女國中生們，才想起稍早些到底做了什麼蠢事 …</p>
<p>看著中午時，手機傳來了訊息通知，在開啟之前，內心感覺就像是考卷在發的過程中，在台下能明確地幻想到下五分鐘的未來，那種心境和感覺在此刻重現，「求你了，我所想的預測不要成真」忍了很久，開啟的第一句話大致上說明故事已經落幕，心裡早就知道的事情，真實呈現時的痛苦啊！</p>
<p><img src="http://i.imgur.com/4ETQPBD.jpg" alt="「雖然知道會這樣，不過還是很痛苦啊」－《清戀》"></p>
<p>沒事兒，至少在情人節之前挑戰過了，失敗就可以給各位朋友一個交代，心中也鬆了一口氣</p>
<p>「我已經不要緊了」「連我的心靈支柱 … 我以為的心靈支柱都這麼說 …」</p>
<p><img src="http://i.imgur.com/2kFa8WO.jpg" alt="「失敗就意味著挑戰過了」－《3月的獅子》"></p>
<hr>
<p>那件事情也過了一陣子，開學前就要忙於論文報告和助教工作的準備，這段忙碌的日子過了好一陣子</p>
<blockquote>
<p>「Hello, 我來了」在晚上九點多的實驗室門口傳來熟悉的聲音  </p>
<p>「Hello, 妳怎麼突然來了？」還來不及反應過來，只能隨手抓個詞應答道  </p>
<p>「剛 meeting 結束，過來看看你們」<br>「你還記得我的論文做些什麼嗎？」</p>
<p>「還記得些，我記得是運行 XXX YYYY 達到 XXXX」對於記憶有點信心，至少認為特別的或重要的事情不會忘</p>
<p>「沒錯！今天老師跟我說 …」</p>
</blockquote>
<p>憑藉著演算法的那些小伎倆，在不擅長的領域到指出自己的想法，希望我還可以派上用場！在這一晚，我想在一旁的學弟又會開始幻想些什麼，儘管在失敗後告誡他們別再拿我的蠢事開玩笑。想著沒有信心地講完後，又要無奈地應對他們，這一晚的關卡好難過。</p>
<p>又過了一陣子，某個晚上</p>
<blockquote>
<p>「Hello, 我來了」這種開場白，不知道為什麼總是這麼有趣<br>「你們實驗室有 XXX 可以借用一下嗎？急用」<br>「我們不是做那一領域的，不會有的，你有問過其他實驗室嗎？」<br>「沒耶，第一個想到的就是問你」</p>
<p>此時，我心中的寫照 <img src="http://i.imgur.com/jLbRRFQ.jpg" alt="《廢天使加百列》"><br>『妳這樣子說，等等我要怎麼跟學弟解釋啊』這個誤會嚴重影響到擅長腦補的朋友們啊！</p>
<p>四處問了下相關領域的學長們是否能租借，最後只能安慰著「明天老實跟老師說吧，沒關係的」</p>
</blockquote>
<p>又過了一陣子，某個下午</p>
<blockquote>
<p>「Hi」又聽到熟悉的聲音，但下午寫程序到了一半，暫時不想停止手邊的工作。<br>「你們實驗室有 XXX 可以借用一下嗎？」</p>
<p>學弟起身，翻著好久沒有整理的紙箱仍沒有結果。工作告一段落的我，加入搜尋的行列<br>「看起來是沒有，就算有，那可以用嗎？」</p>
<p>「應該可以吧？」</p>
<p>繼續翻著箱子說道「看起來是沒有耶」</p>
<p>「ㄟㄟ，你在寫些什麼？」走到我的位子上，稍微看著螢幕上的程序說道</p>
<p>「那個 … 我在寫學弟的作業」身為學長寫著學弟的作業，完全感受不到威嚴</p>
<p>「我的論文重要？還是學弟作業重要！」</p>
<p>突然間，實驗室的人都在竊笑，想必此生的我已經結束了，這跳進黃河也洗不清。<br><img src="http://i.imgur.com/Cv8vxz7.jpg" alt="《廢天使加百列》"></p>
</blockquote>
<hr>
<p>四月初仍忙著論文撰寫，在這修改的煎熬日子裡，不是等待回應，就是將描述手法改來改去。然後，之前在遊戲《楓之谷》認識的交大某數已經提早把論文寫完等畢業，週末突然問我要不要去拜月老，一個剛跟女友分手的正常人和一個從未正常交過女友的肥宅就這麼約著網友聚會去龍山寺拜月老。</p>
<p>不知道那天是怎了，想把手上的事情放掉，鐵了心想做了不同的事情，但是關於「出門拜月老？」這個出遊議題，在內心掙扎著「出門就輸了，若去的話就驗證我二十多年來的失敗 …」最終，由於沒有任何不去的理由，隔天一早就出發了。</p>
<p>當日頂著大太陽，什麼事前調查都沒準備，那麼拜也沒什麼效用，想著當作觀光之旅來看待。至於月老求姻緣的部分，秉持著平常心看待囉！好久沒有拿著香在寺廟裡晃來晃去，有拜學業、拜健康、拜姻緣還有拜商業 … 等。想到自己要來拜個姻緣？嗯，這種無法明確努力的項目，就像天生註定的，我想行為只是基因的載體，意識到自己從未有過，再想著有過與沒有過的差別，我的確不是那一型的個性，那麼沒有也是很正常的吧。</p>
<p>然而，都來了一趟，仍硬是要我問問關於姻緣，心想求姻緣要連續三個聖筊，這個的機率這麼低，如果沒有對於對象任何要求的話，我有機會嗎？先來個二分搜尋法，</p>
<blockquote>
<p>「五年內有機會遇的到嗎？」<br>「不會」神如此回應<br>「那 … 十年內遇的到嗎？」大膽突破點地詢問<br>「沒辦法」神明搖著頭說道<br>「二十年內呢？」作為人而言，我的想法太奢求了<br>「沒有」<br>「這一生有可能嗎？」人生要果斷點，也許才有機會<br>「沒有」</p>
</blockquote>
<p>內心憔悴，先來個中場休息吧。若是再擲下去，探究真理的我也許會想問「還需要活下去嗎？神」看著一旁有人頂著大太陽折騰了好幾十分鐘「兄弟呀，我理解機率是多麼地困難」</p>
<blockquote>
<p>「她跟我不同次元對吧？」換個說法看看吧，希望是找出來的<br>「對」<br>「這樣的我可以活得開心吧」淚水不斷地在內心流淌，原來神告訴我的真理是這個樣子，至今我都沒好好對待。<br>「可以」</p>
</blockquote>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-uva-13154" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/28/uva-13154/" class="article-date">
  <time datetime="2017-04-28T11:40:58.000Z" itemprop="datePublished">2017-04-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/28/uva-13154/">UVa 13154 - Extreme XOR Sum</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/04/28/uva-13154/" data-id="ckw8q9g0h00tvqwvn0kqcfb5u" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/04/28/uva-13154/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/二項係數/">二項係數</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/優化輸入/">優化輸入</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/塊狀表/">塊狀表</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>給一長度為 <span>$N$</span><!-- Has MathJax --> 的整數序列，詢問任意區間的極端異或和 Extreme XOR Sum。</p>
<p>定義 Extreme XOR Sum 為一系列操作的最後一個值</p>
<ul>
<li>當長度 <span>$n&gt;1$</span><!-- Has MathJax --> 時，將陣列縮小為 <span>$n-1$</span><!-- Has MathJax --></li>
<li>對 <span>$[a_0, a_1, a_2, \cdots, a_{n-1}]$</span><!-- Has MathJax -->，每一個元素與後一個元素運行互斥或，將會被轉換成 <span>$[a_0 \oplus a_1, a_1\oplus a_2, a_2 \oplus  a_3, \cdots, a_{n-2}\oplus a_{n-1}]$</span><!-- Has MathJax --></li>
<li>直到只剩下一個元素，即為 Extreme XOR Sum</li>
</ul>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">5</div><div class="line">1  4  6  7  8</div><div class="line">3</div><div class="line">0  0</div><div class="line">0  1</div><div class="line">2  4</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Case 1:</div><div class="line">1</div><div class="line">5</div><div class="line">14</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>這題詢問次數非常多，一般運行將對每一個詢問達到 <span>$O(N)$</span><!-- Has MathJax --> 的複雜度，這很容易得到 TLE。從大多的數據結構，如線段樹、塊狀表 … 等，他們提供高效率的查找效能，但也必須符合某些條件才能使用。因此，在此題若要符合結合律將變得相當困難。</p>
<h3 id="觀察"><a href="#觀察" class="headerlink" title="觀察"></a>觀察</h3><p>假設要計算陣列 <span>$[1,  4,  6,  7,  8]$</span><!-- Has MathJax --> 的值時</p>
<ul>
<li>第一步，<span>$[1 \oplus 4,  4 \oplus 6,  6 \oplus 7,  7 \oplus 8]$</span><!-- Has MathJax --></li>
<li>第二步，<span>$[1 \oplus 4 \oplus 4 \oplus 6,  \cdots]$</span><!-- Has MathJax --></li>
<li>如此類推下去，XOR 有結合律，我們發現到各別使用了 1 次 <span>$a_0$</span><!-- Has MathJax -->、4 次 <span>$a_1$</span><!-- Has MathJax -->、6 次 <span>$a_2$</span><!-- Has MathJax -->、4 次 <span>$a_3$</span><!-- Has MathJax --> 和 1 次 <span>$a_4$</span><!-- Has MathJax --></li>
</ul>
<p>對於不同的長度，我們發現到是二項係數的配對情況。由於偶數次的 XOR 會互消，只需要計算出現奇數次的即可，因此我們列出二項次數模二的情況，進而得到 Sierpinski triangle/Sierpinski sieve。即使知道 Sierpinski sieve 是二項係數模二的結果，我們仍不知道要怎麼套用結合律達到剖分加速的條件。</p>
<p>二項係數的公式如下</p>
<span>$$\begin{align*}
\binom{n}{m} &amp;= \binom{n-1}{m-1} + \binom{n-1}{m} \\
&Tab;&Tab;&Tab;&amp;= \frac{n!}{m!(n-m)!}
\end{align*}$$</span><!-- Has MathJax -->
<p>階層運算在數學運算上的性質並不多，逼得我們只好往碎形上觀察，以下列出前幾項的結果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">1 1</div><div class="line">1 0 1</div><div class="line">1 1 1 1</div><div class="line">1 0 0 0 1</div><div class="line">1 1 0 0 1 1</div><div class="line">1 0 1 0 1 0 1</div><div class="line">1 1 1 1 1 1 1 1</div><div class="line">1 0 0 0 0 0 0 0 1</div><div class="line">1 1 0 0 0 0 0 0 1 1</div><div class="line">1 0 1 0 0 0 0 0 1 0 1</div><div class="line">1 1 1 1 0 0 0 0 1 1 1 1</div><div class="line">1 0 0 0 1 0 0 0 1 0 0 0 1</div><div class="line">1 1 0 0 1 1 0 0 1 1 0 0 1 1</div><div class="line">1 0 1 0 1 0 1 0 1 0 1 0 1 0 1</div><div class="line">1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</div></pre></td></tr></table></figure>
<p>發現它是一個很有趣的碎形，每個三角形大小都是以二的冪次的。我們按照 <span>$2^3 = 8$</span><!-- Has MathJax --> 切割一下上圖，並且把右邊斜的補上 0 得到下圖。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">1 1</div><div class="line">1 0 1</div><div class="line">1 1 1 1</div><div class="line">1 0 0 0 1</div><div class="line">1 1 0 0 1 1</div><div class="line">1 0 1 0 1 0 1</div><div class="line">1 1 1 1 1 1 1 1</div><div class="line">^---------------</div><div class="line">1 0 0 0 0 0 0 0 |1 0 0 0 0 0 0 0</div><div class="line">1 1 0 0 0 0 0 0 |1 1 0 0 0 0 0 0</div><div class="line">1 0 1 0 0 0 0 0 |1 0 1 0 0 0 0 0</div><div class="line">1 1 1 1 0 0 0 0 |1 1 1 1 0 0 0 0</div><div class="line">1 0 0 0 1 0 0 0 |1 0 0 0 1 0 0 0</div><div class="line">1 1 0 0 1 1 0 0 |1 1 0 0 1 1 0 0</div><div class="line">1 0 1 0 1 0 1 0 |1 0 1 0 1 0 1 0</div><div class="line">1 1 1 1 1 1 1 1 |1 1 1 1 1 1 1 1</div><div class="line">^----------------^--------------</div><div class="line">1 0 0 0 0 0 0 0 |0 0 0 0 0 0 0 0 |1 0 0 0 0 0 0 0</div><div class="line">1 1 0 0 0 0 0 0 |0 0 0 0 0 0 0 0 |1 1 0 0 0 0 0 0</div><div class="line">1 0 1 0 0 0 0 0 |0 0 0 0 0 0 0 0 |1 0 1 0 0 0 0 0</div><div class="line">1 1 1 1 0 0 0 0 |0 0 0 0 0 0 0 0 |1 1 1 1 0 0 0 0</div><div class="line">1 0 0 0 1 0 0 0 |0 0 0 0 0 0 0 0 |1 0 0 0 1 0 0 0</div><div class="line">1 1 0 0 1 1 0 0 |0 0 0 0 0 0 0 0 |1 1 0 0 1 1 0 0</div><div class="line">1 0 1 0 1 0 1 0 |0 0 0 0 0 0 0 0 |1 0 1 0 1 0 1 0</div><div class="line">1 1 1 1 1 1 1 1 |0 0 0 0 0 0 0 0 |1 1 1 1 1 1 1 1</div><div class="line">^                ^                ^ </div><div class="line">箭頭表示本身也是 Sierpinski sieve</div><div class="line"></div><div class="line">區塊縮影得到 miniature pattern 也是 Sierpinski sieve</div><div class="line">1</div><div class="line">1 1</div><div class="line">1 0 1</div></pre></td></tr></table></figure>
<p>得到數個一模一樣的子圖，上述全零和非零的區塊，又恰好構成 Sierpinski sieve。這告訴我們任何操作全都要以二的冪次為基準，且合併區段時須以二項係數為係數。設定 pattern 大小為 <span>$M=2^{\lceil \log_2 N\rceil}$</span><!-- Has MathJax -->，最後得到 miniature pattern。在同一層中，非零構成的條紋都是相同的模式，例如上述得圖中，最後一層的箭號組合必然是 101 或者是 000，最後得到下列公式計算條紋。</p>
<span>$A_{i, j} = A_{i-1}{j} \oplus A_{i-1,j+M}$</span><!-- Has MathJax -->
<p>接下來，我們將需要確定每一個條紋 (stripe) 是否使用全零或者非零，只需要查找 miniature pattern 相應的係數即可。</p>
<h3 id="如何在-Sierpinski-sieve-找到非零係數的位置"><a href="#如何在-Sierpinski-sieve-找到非零係數的位置" class="headerlink" title="如何在 Sierpinski sieve 找到非零係數的位置"></a>如何在 Sierpinski sieve 找到非零係數的位置</h3><p>若 <span>$\binom{n}{i} \mod 2 = 1$</span><!-- Has MathJax -->，必滿足 <span>$n\&amp;i = i$</span><!-- Has MathJax -->。其證明從數學歸納法來，由二冪次的長度碎形著手，移除最高位的 1 得到 <span>$i&apos;$</span><!-- Has MathJax -->，從 <span>$i&apos;$</span><!-- Has MathJax --> 舊有位置集合，保留此集合，並對每一個元素增加二的冪次得到碎形的另一邊。</p>
<p>故可利用下述算法，準確地找到每一個非零的係數位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">for (int pos = n; pos; pos = (pos-1)&amp;n)</div><div class="line">    C[n][pos] mod 2 = 1</div></pre></td></tr></table></figure>
<p>最後附上優化後得到 Rank 1 的程序 0.040 s</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> M = (<span class="number">1</span>&lt;&lt;<span class="number">7</span>);</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">10005</span>;</div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> A[M+<span class="number">1</span>][MAXN];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">miniature</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i*M &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j+i*M &lt; n; j++)</div><div class="line">            A[i][j] = A[i<span class="number">-1</span>][j] ^ A[i<span class="number">-1</span>][j+M];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">extract</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> n = r-l;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> m = n/M;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> o = n%M;</div><div class="line">    <span class="keyword">int</span> ret = A[m][l];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = o; i; i = (i<span class="number">-1</span>)&amp;o)</div><div class="line">        ret ^= A[m][l+i];</div><div class="line">    <span class="keyword">return</span> ret;	</div><div class="line">&#125;</div><div class="line"><span class="keyword">namespace</span> MM &#123;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readchar</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> buf[N];</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> *p = buf, *end = buf;</div><div class="line">        <span class="keyword">if</span>(p == end) &#123;</div><div class="line">            <span class="keyword">if</span>((end = buf + fread(buf, <span class="number">1</span>, N, <span class="built_in">stdin</span>)) == buf) <span class="keyword">return</span> EOF;</div><div class="line">            p = buf;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> *p++;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ReadInt</span><span class="params">(<span class="keyword">int</span> *x)</span> </span>&#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> c, neg;</div><div class="line">        <span class="keyword">while</span>((c = readchar()) &lt; <span class="string">'-'</span>)    &#123;<span class="keyword">if</span>(c == EOF) <span class="keyword">return</span> <span class="number">0</span>;&#125;</div><div class="line">        neg = (c == <span class="string">'-'</span>) ? <span class="number">-1</span> : <span class="number">1</span>;</div><div class="line">        *x = (neg == <span class="number">1</span>) ? c-<span class="string">'0'</span> : <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span>((c = readchar()) &gt;= <span class="string">'0'</span>)</div><div class="line">            *x = (*x &lt;&lt; <span class="number">3</span>) + (*x &lt;&lt; <span class="number">1</span>) + c-<span class="string">'0'</span>;</div><div class="line">        *x *= neg;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Print</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">        <span class="keyword">char</span> buf[N], *p, *end;</div><div class="line">        Print() &#123;</div><div class="line">            p = buf, end = buf + N - <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">printInt</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">char</span> padding)</span> </span>&#123;</div><div class="line">            <span class="keyword">static</span> <span class="keyword">char</span> stk[<span class="number">16</span>];</div><div class="line">            <span class="keyword">int</span> idx = <span class="number">0</span>;</div><div class="line">            stk[idx++] = padding;</div><div class="line">            <span class="keyword">if</span> (!x)	</div><div class="line">                stk[idx++] = <span class="string">'0'</span>;</div><div class="line">            <span class="keyword">while</span> (x)</div><div class="line">                stk[idx++] = x%<span class="number">10</span> + <span class="string">'0'</span>, x /= <span class="number">10</span>;</div><div class="line">            <span class="keyword">while</span> (idx) &#123;</div><div class="line">                <span class="keyword">if</span> (p == end) &#123;</div><div class="line">                    *p = <span class="string">'\0'</span>;</div><div class="line">                    <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf), p = buf;</div><div class="line">                &#125;</div><div class="line">                *p = stk[--idx], p++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">flush</span><span class="params">()</span> </span>&#123;</div><div class="line">        	*p = <span class="string">'\0'</span>, p = buf;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf);</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">online_printInt</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">            <span class="keyword">static</span> <span class="keyword">char</span> ch[<span class="number">16</span>];</div><div class="line">            <span class="keyword">static</span> <span class="keyword">int</span> idx;</div><div class="line">            idx = <span class="number">0</span>;</div><div class="line">            <span class="keyword">if</span> (x == <span class="number">0</span>)	ch[++idx] = <span class="number">0</span>;</div><div class="line">            <span class="keyword">while</span> (x &gt; <span class="number">0</span>) ch[++idx] = x % <span class="number">10</span>, x /= <span class="number">10</span>;</div><div class="line">            <span class="keyword">while</span> (idx) </div><div class="line">                <span class="built_in">putchar</span>(ch[idx--]+<span class="number">48</span>);</div><div class="line">        &#125;</div><div class="line">        ~Print() &#123;</div><div class="line">            *p = <span class="string">'\0'</span>;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf);</div><div class="line">        &#125;</div><div class="line">    &#125; bprint;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> n, m;</div><div class="line"><span class="comment">//	scanf("%d", &amp;testcase);</span></div><div class="line">    MM::ReadInt(&amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line"><span class="comment">//		scanf("%d", &amp;n);</span></div><div class="line">        MM::ReadInt(&amp;n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line"><span class="comment">//			scanf("%d", &amp;A[0][i]);</span></div><div class="line">            MM::ReadInt(&amp;A[<span class="number">0</span>][i]);</div><div class="line">        miniature(n);</div><div class="line"><span class="comment">//		scanf("%d", &amp;m);</span></div><div class="line">        MM::ReadInt(&amp;m);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case %d:\n"</span>, ++cases);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="keyword">int</span> l, r;</div><div class="line"><span class="comment">//			scanf("%d %d", &amp;l, &amp;r);</span></div><div class="line">            MM::ReadInt(&amp;l), MM::ReadInt(&amp;r);</div><div class="line"><span class="comment">//			printf("%d\n", extract(l, r));</span></div><div class="line">            MM::bprint.printInt(extract(l, r), <span class="string">'\n'</span>);</div><div class="line">        &#125;</div><div class="line">        MM::bprint.flush();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">1</span></div><div class="line"><span class="comment">5</span></div><div class="line"><span class="comment">1  4  6  7  8</span></div><div class="line"><span class="comment">3</span></div><div class="line"><span class="comment">0  0</span></div><div class="line"><span class="comment">0  1</span></div><div class="line"><span class="comment">2  4</span></div><div class="line"><span class="comment">*/</span></div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/6/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/86/">86</a><a class="extend next" rel="next" href="/page/8/">Next &raquo;</a>
    </nav>
  
</section>
          
          
            <aside id="sidebar">
  <!-- <div id="ukagaka_panel"></div> -->
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">115</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算機圖學/">計算機圖學</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/">工作應用</a><span class="category-list-count">38</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Java/">Java</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Meme/">Meme</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/其他/">其他</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/可持久化/">可持久化</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/鬼故事/">鬼故事</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">52</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">633</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">483</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">77</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">45</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2021/11/21/diary-20211121-encrypt/">
              
                <i class="icon-file-o"></i> 
              
            《批改娘串起得那段經歷·肆》</a>
          </li>
        
          <li>
            <a class="text" href="/2021/11/12/diary-20211112-encrypt/">
              
                <i class="icon-file-o"></i> 
              
            《批改娘串起得那段經歷·參》</a>
          </li>
        
          <li>
            <a class="text" href="/2021/10/31/diary-20211031-encrypt/">
              
                <i class="icon-file-o"></i> 
              
            《批改娘串起得那段經歷·貳》</a>
          </li>
        
          <li>
            <a class="text" href="/2021/10/28/diary-202110-encrypt/">
              
                <i class="icon-file-o"></i> 
              
            《批改娘串起得那段經歷·序》</a>
          </li>
        
          <li>
            <a class="text" href="/2021/10/28/diary-202110/">
              
                <i class="icon-file-o"></i> 
              
            好多個 28 在這個時刻</a>
          </li>
        
          <li>
            <a class="text" href="/2021/10/28/work/company-ghost-story-14/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 14</a>
          </li>
        
          <li>
            <a class="text" href="/2021/09/12/work/appreciation-letter/">
              
                <i class="icon-file-o"></i> 
              
            Shiny People 感謝</a>
          </li>
        
          <li>
            <a class="text" href="/2021/09/12/work/company-ghost-story-13/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 13</a>
          </li>
        
          <li>
            <a class="text" href="/2021/08/15/diary-202108/">
              
                <i class="icon-file-o"></i> 
              
            被預告要開始管人的我，今天開始學管理？</a>
          </li>
        
          <li>
            <a class="text" href="/2021/08/14/work/company-ghost-story-12/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 12</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
        <ul>
          <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
        </ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
  
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2021 Shiang-Yun Yang 
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>