<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Morris&#39; Blog">
<meta property="og:url" content="http://morris821028.github.io/page/10/index.html">
<meta property="og:site_name" content="Morris&#39; Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris&#39; Blog">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
  <link rel="import" href="/bower_components/app-layout/app-layout.html"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          
          <section id="main">
  
    <article id="post-uva-13079" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/24/uva-13079/" class="article-date">
  <time datetime="2016-06-24T03:11:55.000Z" itemprop="datePublished">2016-06-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/24/uva-13079/">UVa 13079 - On the beach</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/06/24/uva-13079/" data-id="ckgyo55qe00s13cvrnq5e39hs" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/06/24/uva-13079/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/掃描線/">掃描線</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/貪心/">貪心</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>在炎炎夏日的海邊，需要建立地下通道，把所有海岸飯店聯通在一起，請問最少地下通道個數為何？</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">4</div><div class="line">1  4</div><div class="line">6  15</div><div class="line">2  10</div><div class="line">12  20</div><div class="line">2</div><div class="line">1  4</div><div class="line">4  8</div><div class="line">2</div><div class="line">1  4</div><div class="line">3  8</div><div class="line">0</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">2</div><div class="line">2</div><div class="line">1</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>把這些區間排序，根據左端點由小到大開始貪心，可行解若看成一個區間，隨著區間加入，右端點會逐漸地靠近左端點，若產生無解，勢必要建立一個新通道。不斷地貪心，最後可得到最少通道個數。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;N) == <span class="number">1</span> &amp;&amp; N) &#123;</div><div class="line">        <span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt; A;</div><div class="line">        <span class="keyword">int</span> L, R;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;L, &amp;R);</div><div class="line">            A.push_back(make_pair(L, R));</div><div class="line">        &#125;</div><div class="line">        sort(A.begin(), A.end());</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> PQ = INT_MAX;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="keyword">int</span> line_x = A[i].first;</div><div class="line">            <span class="keyword">if</span> (PQ != INT_MAX &amp;&amp; PQ &lt;= line_x) &#123;</div><div class="line">                ret++;</div><div class="line">                PQ = INT_MAX;</div><div class="line">            &#125;</div><div class="line">            PQ = min(PQ, A[i].second);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (PQ != INT_MAX)</div><div class="line">            ret++;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-10038" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/24/jg-10038/" class="article-date">
  <time datetime="2016-06-24T02:28:47.000Z" itemprop="datePublished">2016-06-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/fR0IDd3.jpg" rel="gallery_ckgyo55cb005v3cvrivgllvt0">
        <img src="http://i.imgur.com/fR0IDd3.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/24/jg-10038/">批改娘 10038. Fast Covering Problem</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/06/24/jg-10038/" data-id="ckgyo55cb005v3cvrivgllvt0" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/06/24/jg-10038/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DLX/">DLX</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/branch-and-reduce-algorithm/">branch-and-reduce algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/最少重複覆蓋/">最少重複覆蓋</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/最少點集覆蓋/">最少點集覆蓋</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="題目背景"><a href="#題目背景" class="headerlink" title="題目背景"></a>題目背景</h2><p>終於把所有練習題都放上 Judge Girl，測資都已經確認過一遍，某 M 打算離開一陣子。「反正是個令人唾棄的助教吧 …」</p>
<h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>考試出題總很難讓所有人滿意，老師決定給予學生們選擇考試出題方向，但每一個人只能提出兩種意見，接著老師會出一套方案滿足每一位學生的其中一種意見。由於出一套題步驟繁瑣，把數個意見出在同一題非常困難，最後每一種意見將單獨被出成一道題。</p>
<p>由於助教們要負責出測資、檢驗測資正確與可行性，希望題目數量越少越好，否則助教會忙翻天。現在要找到最少題目來滿足所有學生的需求。</p>
<p>例如 :</p>
<ul>
<li>現在有 4 名學生的意見</li>
<li>四名學生分別提案 $(0, 1), (100, 1), (100, 0), (100, 200)$</li>
<li>如果選擇 ${ 0, 100 }$ 或者是 ${ 1, 100 }$ 都是最好的選擇，助教只需要完成 2 題的檢驗。相反地，如果 ${0, 100, 200 }$ 雖然可以滿足所有學生，但需要出成 3 道題目。</li>
</ul>
<h2 id="輸入格式"><a href="#輸入格式" class="headerlink" title="輸入格式"></a>輸入格式</h2><p>只有一組測資，每組第一行會有一個整數 $N$，表示有多少位學生，接下來會有 $N$ 行，每 $i$ 行上會有兩個整數 $A_i, B_i$ 表示第 $i$ 個學生的出題意見。</p>
<ul>
<li>$0 &lt; N \le 1000$</li>
<li>$0 \le A_i, \; B_i \le 10000$</li>
<li>意見類型總數不超過 100 種</li>
</ul>
<h2 id="輸出格式"><a href="#輸出格式" class="headerlink" title="輸出格式"></a>輸出格式</h2><p>對於每一組測資輸出一行，表示最少要準備的方案數量能滿足所有學生。</p>
<h2 id="範例輸入"><a href="#範例輸入" class="headerlink" title="範例輸入"></a>範例輸入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">4</div><div class="line">0 1</div><div class="line">100 1</div><div class="line">100 0</div><div class="line">100 200</div></pre></td></tr></table></figure>
<h2 id="範例輸出"><a href="#範例輸出" class="headerlink" title="範例輸出"></a>範例輸出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2</div></pre></td></tr></table></figure>
<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>DLX </p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>當年在 NCPC 搞不出來的 Problem I Christmas Gifts (NP-hard)，在賽後用 DLX 運行效果不錯，在啟發函數加上延遲標記更是屹立排名前數位已久。最近又因為平行把題目挖回來討論，在去年釣到大一學弟來解，便以飛快的速度擊破測資，最後達到加速 20x。再把當初需要跑 30 秒的測資來運行，現在只需要短短的 50ms。</p>
<blockquote>
<p>原本要拿來出平行題目，看到這麼驚人的速度，想必就不要出題。</p>
</blockquote>
<p>通用解法 DLX 加上啟發式函數就能解決最少重複覆蓋，然而在圖論的最少點集覆蓋問題中，性質又變得更加強烈。當不選某一個點時，必然與其相連的邊為了要覆蓋，另一端必然成為必選點。這時候搜索空間大幅度地下降。若在一般 DLX 算法中提及的最少可能的列中，窮舉某行來覆蓋一些列，那麼就很難看到搜索空間下降的性質。</p>
<p>因此，步驟簡單分成下列步驟：</p>
<ol>
<li>將圖轉換成某行可以覆蓋哪幾列，轉換成 Dancing Links 的格式</li>
<li>找到可以覆蓋最多尚未覆蓋列最多的那一行<ol>
<li>選擇這一行，並且移除這一行所有覆蓋列，遞迴窮舉。</li>
<li>移除這一行，選擇必選行，並嘗試移除等價行。</li>
</ol>
</li>
</ol>
<hr>
<p>附錄：和交通大學謝旻錚(Min-Zheng Shieh) 教練的討論</p>
<blockquote>
<p>在想確實能用 dancing links 來搞，還要搭配維護 degree order，不過這算法吳邦一老師是說 worst case 為 3 regular graph。<br>另外先前找過日本人 iwi 的論文，他也搞了個高級 VC solver 並做了測試，詳見論文 Branch-and-reduce exponential/FPT algorithms in practice: A case study of vertex cover, Takuya Akiba, Yoichi Iwata </p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXNODE 100000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXCOL 5005</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 5005</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DancingNode</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> left, right, up, down;</div><div class="line">    <span class="keyword">int</span> ch, rh;</div><div class="line">&#125; DL[MAXNODE];</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HelperNode</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> head, size, next, prev;</div><div class="line">&#125; HN[MAXNODE];</div><div class="line"><span class="keyword">int</span> help_head;</div><div class="line"><span class="keyword">int</span> s[MAXCOL];</div><div class="line"><span class="keyword">int</span> head, size, Ans, Dep;</div><div class="line"><span class="keyword">int</span> markStk[MAXNODE], markIdx = <span class="number">-1</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Remove</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[c].down; i != c; i = DL[i].down) &#123;</div><div class="line">    	<span class="keyword">if</span> (HN[DL[i].rh].head == i)</div><div class="line">    		HN[DL[i].rh].head = DL[i].left;</div><div class="line">    	HN[DL[i].rh].size--;</div><div class="line">        DL[DL[i].right].left = DL[i].left;</div><div class="line">        DL[DL[i].left].right = DL[i].right;</div><div class="line">        s[DL[i].ch]--;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Resume</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[c].down; i != c; i = DL[i].down) &#123;</div><div class="line">    	<span class="keyword">if</span> (HN[DL[i].rh].head == i)</div><div class="line">    		HN[DL[i].rh].head = DL[i].right;</div><div class="line">    	HN[DL[i].rh].size++;</div><div class="line">        DL[DL[i].right].left = i;</div><div class="line">        DL[DL[i].left].right = i;</div><div class="line">        s[DL[i].ch]++;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Reduce</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> t = DL[i].rh;</div><div class="line">    HN[HN[t].next].prev = HN[t].prev;</div><div class="line">    HN[HN[t].prev].next = HN[t].next;</div><div class="line">    s[DL[i].ch]--;</div><div class="line">    DL[DL[i].down].up = DL[i].up;</div><div class="line">    DL[DL[i].up].down = DL[i].down;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = DL[i].right; k != i; k = DL[k].right) &#123;</div><div class="line">        DL[DL[k].down].up = DL[k].up;</div><div class="line">        DL[DL[k].up].down = DL[k].down;</div><div class="line">        s[DL[k].ch]--;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Recover</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> t = DL[i].rh;</div><div class="line">    HN[HN[t].next].prev = t;</div><div class="line">    HN[HN[t].prev].next = t;</div><div class="line">    s[DL[i].ch]++;</div><div class="line">    DL[DL[i].down].up = i;</div><div class="line">    DL[DL[i].up].down = i;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = DL[i].right; k != i; k = DL[k].right) &#123;</div><div class="line">        DL[DL[k].down].up = k;</div><div class="line">        DL[DL[k].up].down = k;</div><div class="line">        s[DL[k].ch]++;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Select</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> s = DL[i].rh;</div><div class="line">    HN[HN[s].next].prev = HN[s].prev;</div><div class="line">    HN[HN[s].prev].next = HN[s].next;</div><div class="line">    Remove(i);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = DL[i].right; j != i; j = DL[j].right)</div><div class="line">        Remove(j);</div><div class="line">    Dep++;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cancel</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> s = DL[i].rh;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = DL[i].right; j != i; j = DL[j].right)</div><div class="line">        Resume(j);</div><div class="line">    Resume(i);    </div><div class="line">    HN[HN[s].next].prev = s;</div><div class="line">    HN[HN[s].prev].next = s;</div><div class="line">    Dep--;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Decision</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> has = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[head].right; i != head; i = DL[i].right) &#123;</div><div class="line">        <span class="keyword">if</span> (s[i] == <span class="number">1</span>) &#123;</div><div class="line">            Select(DL[i].down);</div><div class="line">            markStk[++markIdx] = DL[i].down;</div><div class="line">            has = <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> has;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Subset</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;	<span class="comment">// 0: x in y, 1: y in x </span></div><div class="line">    assert(DL[x].ch == DL[y].ch);</div><div class="line">    <span class="keyword">int</span> a = <span class="number">0</span>, b = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> i, j;</div><div class="line">    <span class="keyword">for</span> (i = DL[x].right, j = DL[y].right; i != x &amp;&amp; j != y; ) &#123;</div><div class="line">        <span class="keyword">if</span> (DL[i].ch == DL[j].ch)</div><div class="line">            i = DL[i].right, j = DL[j].right;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (DL[i].ch &lt; DL[j].ch)</div><div class="line">            i = DL[i].right, a = <span class="number">1</span>;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            j = DL[j].right, b = <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (a &amp;&amp; b)</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (i != x)    a = <span class="number">1</span>;</div><div class="line">    <span class="keyword">if</span> (j != y)    b = <span class="number">1</span>;</div><div class="line">    <span class="keyword">return</span> a || b ? (a - b) : <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Duplicate</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> has = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[head].right; i != head; i = DL[i].right) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = DL[i].down; j != i; j = DL[j].down) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = DL[j].down; k != j &amp;&amp; k != i; k = DL[k].down) &#123;</div><div class="line">                <span class="keyword">int</span> cmp = Subset(j, k);</div><div class="line">                <span class="keyword">if</span> (cmp == <span class="number">0</span>)</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">if</span> (cmp == <span class="number">1</span>) &#123;</div><div class="line">                	markStk[++markIdx] = j;</div><div class="line">                	Select(j);</div><div class="line">            	&#125; <span class="keyword">else</span> &#123;</div><div class="line">            		markStk[++markIdx] = k;</div><div class="line">                	Select(k);</div><div class="line">                &#125;</div><div class="line">                has = <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> has;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">H</span><span class="params">(<span class="keyword">int</span> limit)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> c, ret, i, j, time = <span class="number">0</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> used[MAXCOL] = &#123;&#125;;</div><div class="line">    <span class="keyword">for</span> (c = DL[head].right, ++time, ret = <span class="number">0</span>; c != head; c = DL[c].right) &#123;</div><div class="line">        <span class="keyword">if</span> (used[c] == time)</div><div class="line">        	<span class="keyword">continue</span>;</div><div class="line">    	ret ++, used[c] = time;</div><div class="line">    	<span class="keyword">if</span> (ret &gt;= limit)	<span class="keyword">return</span> ret;</div><div class="line">        <span class="keyword">for</span> (i = DL[c].down; i != c; i = DL[i].down) &#123;</div><div class="line">            <span class="keyword">for</span> (j = DL[i].right; j != i; j = DL[j].right)</div><div class="line">            	used[DL[j].ch] = time;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> hval = H(Ans - Dep);</div><div class="line">    <span class="keyword">if</span> (DL[head].right == head &amp;&amp; Dep &lt; Ans)</div><div class="line">    	Ans = Dep;</div><div class="line">    <span class="keyword">if</span> (Dep + hval &gt;= Ans)</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    <span class="keyword">int</span> cover_max = <span class="number">-1</span>, cover_idx = <span class="number">-1</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = HN[help_head].next; i != help_head; i = HN[i].next) &#123;</div><div class="line">        <span class="keyword">if</span> (HN[i].size &gt; cover_max) &#123;</div><div class="line">            cover_max = HN[i].size;</div><div class="line">            cover_idx = HN[i].head;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    Select(cover_idx);</div><div class="line">    DFS();</div><div class="line">    Cancel(cover_idx);</div><div class="line">    </div><div class="line">    Reduce(cover_idx);</div><div class="line">    <span class="keyword">int</span> markEsp = markIdx;</div><div class="line">    <span class="keyword">while</span> (!Decision() &amp;&amp; !Duplicate());</div><div class="line">    DFS();</div><div class="line">    <span class="keyword">while</span> (markIdx &gt; markEsp)</div><div class="line">        Cancel(markStk[markIdx--]);</div><div class="line">    Recover(cover_idx);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">new_node</span><span class="params">(<span class="keyword">int</span> up, <span class="keyword">int</span> down, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</div><div class="line">    DL[size].up = up, DL[size].down = down;</div><div class="line">    DL[size].left = left, DL[size].right = right;</div><div class="line">    DL[up].down = DL[down].up = DL[left].right = DL[right].left = size;</div><div class="line">    <span class="keyword">return</span> size++;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">new_row</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> Row[], <span class="keyword">int</span> rh)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> r, row = <span class="number">-1</span>, k;</div><div class="line">    <span class="keyword">int</span> h = size;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        r = Row[i];</div><div class="line">        DL[size].ch = r, s[r]++;</div><div class="line">        DL[size].rh = rh;</div><div class="line">        <span class="keyword">if</span> (row == <span class="number">-1</span>) &#123;</div><div class="line">            row = new_node(DL[DL[r].ch].up, DL[r].ch, size, size);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            k = new_node(DL[DL[r].ch].up, DL[r].ch, DL[row].left, row);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    HN[rh].size = n;</div><div class="line">    HN[rh].head = h;</div><div class="line">    HN[rh].next = HN[help_head].next;</div><div class="line">    HN[rh].prev = help_head;</div><div class="line">    HN[HN[help_head].next].prev = rh;</div><div class="line">    HN[help_head].next = rh;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</div><div class="line">    size = <span class="number">0</span>;</div><div class="line">    help_head = <span class="number">0</span>, HN[help_head].next = HN[help_head].prev = help_head;</div><div class="line">    head = new_node(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    <span class="keyword">int</span> i;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= m; i++) &#123;</div><div class="line">        new_node(i, i, DL[head].left, head);</div><div class="line">        DL[i].ch = i, s[i] = <span class="number">0</span>;</div><div class="line">        DL[i].rh = <span class="number">0</span>;	<span class="comment">// important pointer (fail pointer)</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) == <span class="number">1</span> &amp;&amp; n) &#123;</div><div class="line">    	<span class="keyword">int</span> A[MAXN], B[MAXN];</div><div class="line">        <span class="keyword">int</span> toy[<span class="number">10005</span>] = &#123;&#125;, R[MAXCOL];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;A[i], &amp;B[i]);</div><div class="line">            toy[A[i]]++, toy[B[i]]++;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        init(n);</div><div class="line">        <span class="keyword">int</span> run_id = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">10000</span>; i++) &#123;</div><div class="line">            <span class="keyword">int</span> nt = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (A[j] == i || B[j] == i)</div><div class="line">                    R[nt++] = j;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (nt) &#123;</div><div class="line">                run_id++;</div><div class="line">                new_row(nt, R, run_id);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        Ans = n;</div><div class="line">        Dep = <span class="number">0</span>, markIdx = <span class="number">-1</span>;</div><div class="line">        Decision();</div><div class="line">        DFS();</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, Ans);</div><div class="line">        fflush(<span class="built_in">stdout</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-10093" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/30/jg-10093/" class="article-date">
  <time datetime="2016-04-30T07:07:14.000Z" itemprop="datePublished">2016-04-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/30/jg-10093/">批改娘 10093. Fast Matrix Chain Multiplication (OpenMP)</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/04/30/jg-10093/" data-id="ckgyo55cs006s3cvrui5xqabx" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/04/30/jg-10093/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenMP/">OpenMP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dp/">dp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>計算矩陣鏈乘積 <span>$A_{r_1, c_1} B_{r_2, c_2} \cdots$</span><!-- Has MathJax --> 的值。</p>
<h3 id="sample-c"><a href="#sample-c" class="headerlink" title="sample.c"></a>sample.c</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// generate matrix, row-major</span></div><div class="line"><span class="keyword">uint32_t</span>* rand_gen(<span class="keyword">uint32_t</span> seed, <span class="keyword">int</span> R, <span class="keyword">int</span> C) &#123;</div><div class="line">    <span class="keyword">uint32_t</span> *m = (<span class="keyword">uint32_t</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * R*C);</div><div class="line">    <span class="keyword">uint32_t</span> x = <span class="number">2</span>, n = R*C;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; R; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; C; j++) &#123;</div><div class="line">            x = (x * x + seed + i + j)%n;</div><div class="line">            m[i*C + j] = x;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> m;</div><div class="line">&#125;</div><div class="line"><span class="keyword">uint32_t</span> hash(<span class="keyword">uint32_t</span> x) &#123;</div><div class="line">    <span class="keyword">return</span> (x * <span class="number">2654435761L</span>U);</div><div class="line">&#125;</div><div class="line"><span class="comment">// output</span></div><div class="line"><span class="keyword">uint32_t</span> signature(<span class="keyword">uint32_t</span> *A, <span class="keyword">int</span> r, <span class="keyword">int</span> c) &#123;</div><div class="line">    <span class="keyword">uint32_t</span> h = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; r; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; c; j++)</div><div class="line">            h = hash(h + A[i*c + j]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> h;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="輸入格式"><a href="#輸入格式" class="headerlink" title="輸入格式"></a>輸入格式</h2><p>有多組測資，每組第一行會有一個整數 $N$ 表示矩陣鏈上有 $N$ 個矩陣，第二行上會有 $N+1$ 個整數 $Z_i$，表示矩陣鏈的每一個行列大小，例如當 $N = 3$ 時，輸入 <code>10 30 5 60</code> 表示矩陣 <span>$A_{10, 30} B_{30, 5} C_{5, 60}$</span><!-- Has MathJax --> 相乘。第三行會有 $N$ 個整數，第 $i$ 個整數 <span>$S_i$</span><!-- Has MathJax --> 為第 $i$ 個矩陣生成種子。</p>
<ul>
<li>$1 \le N \le 100$</li>
<li><span>$1 \le Z_i \le 1000$</span><!-- Has MathJax --></li>
<li><span>$0 \le S_i \le 32767$</span><!-- Has MathJax -->
</li>
</ul>
<h2 id="輸出格式"><a href="#輸出格式" class="headerlink" title="輸出格式"></a>輸出格式</h2><p>對於每組測資輸出一行，將最後的矩陣結果輸出雜湊值。</p>
<h2 id="範例輸入"><a href="#範例輸入" class="headerlink" title="範例輸入"></a>範例輸入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">2</div><div class="line">2 2 2</div><div class="line">2 5</div><div class="line"></div><div class="line">3</div><div class="line">10 30 5 60</div><div class="line">0 0 0</div><div class="line"></div><div class="line">3</div><div class="line">1 5 20 1</div><div class="line">0 0 0</div><div class="line"></div><div class="line">3</div><div class="line">5 10 20 35</div><div class="line">0 0 0 </div><div class="line"></div><div class="line">6</div><div class="line">30 35 15 5 10 20 25</div><div class="line">0 0 0 0 0 0</div></pre></td></tr></table></figure>
<h2 id="範例輸出"><a href="#範例輸出" class="headerlink" title="範例輸出"></a>範例輸出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">573770929</div><div class="line">1762797124</div><div class="line">1738984832</div><div class="line">354147713</div><div class="line">3544048495</div></pre></td></tr></table></figure>
<h2 id="備註"><a href="#備註" class="headerlink" title="備註"></a>備註</h2><blockquote>
<p>輸出請用 <code>printf(&quot;%u&quot;, answer);</code>，計算 Dynamic Programming 時，請使用 64-bit 型態紀錄，因為最慘情況下會超過 32-bit 所能容納的範圍。</p>
</blockquote>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>充分地運用當初在演算法學到的，計算矩陣鍊乘積的最少乘法數，接著再針對優化後的乘法順序進行平行。平行可以從單純矩陣乘法，又或者針對可以同時進行矩陣乘法操作開始。甚至可以套用編譯器學到的最少暫存器算法，想辦法從少量的空間換取好的快取效果。</p>
<p>下述程式只針對矩陣乘法計算平行，而非兩個乘法同時進行，其一原因在於很難保證 load balance。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 128</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LOOP_UNROLL 8</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INF (1LL&lt;&lt;60)</span></div><div class="line"><span class="keyword">int</span> N, SZ[MAXN], SEED[MAXN];</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> dp[MAXN][MAXN] = &#123;&#125;;</div><div class="line"><span class="keyword">int</span> argdp[MAXN][MAXN];</div><div class="line"><span class="keyword">uint32_t</span>* rand_gen(<span class="keyword">uint32_t</span> c, <span class="keyword">int</span> R, <span class="keyword">int</span> C) &#123;</div><div class="line">    <span class="keyword">uint32_t</span> *m = (<span class="keyword">uint32_t</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * R*C);</div><div class="line">    assert(m != <span class="literal">NULL</span>);</div><div class="line">    <span class="keyword">uint32_t</span> x = <span class="number">2</span>, n = R*C;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; R; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; C; j++) &#123;</div><div class="line">            x = (x * x + c + i + j)%n;</div><div class="line">            m[i*C + j] = x;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> m;</div><div class="line">&#125;</div><div class="line"><span class="keyword">uint32_t</span>* multiplyAndDel(<span class="keyword">uint32_t</span> *A, <span class="keyword">uint32_t</span> *B, <span class="keyword">int</span> r, <span class="keyword">int</span> rc, <span class="keyword">int</span> c) &#123;</div><div class="line">    <span class="keyword">uint32_t</span> *C = (<span class="keyword">uint32_t</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * r * c);</div><div class="line">    <span class="keyword">uint32_t</span> *tB = (<span class="keyword">uint32_t</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * rc * c);</div><div class="line">    assert(C != <span class="literal">NULL</span>);</div><div class="line">    assert(tB != <span class="literal">NULL</span>);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rc; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; c; j++)</div><div class="line">            tB[j*rc + i] = B[i*c + j];</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">free</span>(B);</div><div class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = r<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = c<span class="number">-1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</div><div class="line">            <span class="keyword">register</span> <span class="keyword">uint32_t</span> sum = <span class="number">0</span>;</div><div class="line">            <span class="keyword">uint32_t</span> *a = &amp;A[i*rc], *b = &amp;tB[j*rc];</div><div class="line">            <span class="keyword">int</span> k = rc;</div><div class="line">            <span class="keyword">switch</span> (k % LOOP_UNROLL) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">do</span> &#123; sum += *a * *b, a++, b++;</div><div class="line">                <span class="keyword">case</span> <span class="number">7</span>: sum += *a * *b, a++, b++;</div><div class="line">                <span class="keyword">case</span> <span class="number">6</span>: sum += *a * *b, a++, b++;</div><div class="line">                <span class="keyword">case</span> <span class="number">5</span>: sum += *a * *b, a++, b++;</div><div class="line">                <span class="keyword">case</span> <span class="number">4</span>: sum += *a * *b, a++, b++;</div><div class="line">                <span class="keyword">case</span> <span class="number">3</span>: sum += *a * *b, a++, b++;</div><div class="line">                <span class="keyword">case</span> <span class="number">2</span>: sum += *a * *b, a++, b++;</div><div class="line">                <span class="keyword">case</span> <span class="number">1</span>: sum += *a * *b, a++, b++;</div><div class="line">                &#125; <span class="keyword">while</span> ((k -= LOOP_UNROLL) &gt; <span class="number">0</span>);</div><div class="line">            &#125;</div><div class="line">            C[i*c + j] = sum;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">free</span>(A), <span class="built_in">free</span>(tB);</div><div class="line">    <span class="keyword">return</span> C;</div><div class="line">&#125;</div><div class="line"><span class="keyword">uint32_t</span> hash(<span class="keyword">uint32_t</span> x) &#123;</div><div class="line">    <span class="keyword">return</span> (x * <span class="number">2654435761L</span>U);</div><div class="line">&#125;</div><div class="line"><span class="keyword">uint32_t</span> signatureAndDel(<span class="keyword">uint32_t</span> *A, <span class="keyword">int</span> r, <span class="keyword">int</span> c) &#123;</div><div class="line">    <span class="keyword">uint32_t</span> h = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; r; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; c; j++)</div><div class="line">            h = hash(h + A[i*c + j]);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">free</span>(A);</div><div class="line">    <span class="keyword">return</span> h;</div><div class="line">&#125;</div><div class="line"><span class="keyword">uint32_t</span>* dfs(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> *mR, <span class="keyword">int</span> *mC) &#123;</div><div class="line">    <span class="keyword">if</span> (l == r) &#123;</div><div class="line">        *mR = SZ[l], *mC = SZ[l+<span class="number">1</span>];</div><div class="line">        <span class="keyword">return</span> rand_gen(SEED[l], *mR, *mC);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> split = argdp[l][r];</div><div class="line">    <span class="keyword">int</span> r1, r2, c1, c2;</div><div class="line">    <span class="keyword">uint32_t</span> *A, *B;</div><div class="line">    A = dfs(l, split, &amp;r1, &amp;c1);</div><div class="line">    B = dfs(split+<span class="number">1</span>, r, &amp;r2, &amp;c2);</div><div class="line">    assert(c1 == r2);</div><div class="line">    *mR = r1, *mC = c2;</div><div class="line">    <span class="keyword">return</span> multiplyAndDel(A, B, r1, c1, c2);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;N) == <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= N; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;SZ[i]);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;SEED[i]);</div><div class="line">        <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp));</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j+i &lt; N; j++) &#123;</div><div class="line">                <span class="keyword">int</span> l = j, r = j+i;</div><div class="line">                dp[l][r] = INF;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = l; k &lt; r; k++) &#123;</div><div class="line">                    <span class="keyword">long</span> <span class="keyword">long</span> t = dp[l][k] + dp[k+<span class="number">1</span>][r] + (<span class="keyword">long</span> <span class="keyword">long</span>) SZ[l] * SZ[k+<span class="number">1</span>] * SZ[r+<span class="number">1</span>];</div><div class="line">                    <span class="keyword">if</span> (t &lt; dp[l][r])</div><div class="line">                        dp[l][r] = t, argdp[l][r] = k;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> retR, retC;</div><div class="line">        <span class="keyword">uint32_t</span> *retM;</div><div class="line">        <span class="keyword">uint32_t</span> hval;</div><div class="line">        retM = dfs(<span class="number">0</span>, N<span class="number">-1</span>, &amp;retR, &amp;retC);</div><div class="line">        hval = signatureAndDel(retM, retR, retC);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%u\n"</span>, hval);</div><div class="line"> </div><div class="line">        <span class="keyword">long</span> <span class="keyword">long</span> test = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</div><div class="line">            test += SZ[<span class="number">0</span>] * SZ[i] * SZ[i+<span class="number">1</span>];</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"best %lld, origin %lld, %lf\n"</span>, dp[<span class="number">0</span>][N<span class="number">-1</span>], test, dp[<span class="number">0</span>][N<span class="number">-1</span>]*<span class="number">1.f</span> / test);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-10094" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/30/jg-10094/" class="article-date">
  <time datetime="2016-04-30T06:54:49.000Z" itemprop="datePublished">2016-04-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/30/jg-10094/">批改娘 10094. Fast 0/1 Knapsack Problem</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/04/30/jg-10094/" data-id="ckgyo55cw006z3cvrcrudhycj" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/04/30/jg-10094/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenMP/">OpenMP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dp/">dp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>有 $N$ 個重量和價值分別為 $W_i, V_i$ 的物品，現在要從這些物品中選出總重量不超過 $M$ 的物品，求所有挑選方案中的總價值最大值為何。</p>
<h2 id="輸入格式"><a href="#輸入格式" class="headerlink" title="輸入格式"></a>輸入格式</h2><p>輸入只有一組測資，第一行會有兩個整數 $N, M$ 分別表示物品數量和背包能容大的最大重量 $M$。接下來會有 $N$ 行，第 $i$ 行上會有兩個整數 $W_i, V_i$，分別為物品 $i$ 的重量和價值。</p>
<ul>
<li>$1 \le N \le 10000$</li>
<li>$1 \le M \le 1000000$</li>
<li>$1 \le W_i, \; V_i \le 100000$</li>
</ul>
<h2 id="輸出格式"><a href="#輸出格式" class="headerlink" title="輸出格式"></a>輸出格式</h2><p>輸出一行整數，挑選方案中的最大價值 $B$。</p>
<h2 id="範例輸入"><a href="#範例輸入" class="headerlink" title="範例輸入"></a>範例輸入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">4 5</div><div class="line">2 3</div><div class="line">1 2 </div><div class="line">3 4</div><div class="line">2 2</div></pre></td></tr></table></figure>
<h2 id="範例輸出"><a href="#範例輸出" class="headerlink" title="範例輸出"></a>範例輸出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">7</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>遞迴公式</p>
<span>$$\begin{align*}
f(i, j) = \max(f(i-1, j-w)+v, f(i-1, j))
\end{align*}$$</span><!-- Has MathJax -->
<p>最單純採用滾動數組完成，也就是所謂的 double buffer 的技巧，可以大幅度節省記憶體，但先決條件是他們的相依關係必須獨立。</p>
<p>在平行處理上的另一種解法，就是分成前 $N/2$ 個物品和後 $N/2$ 物品分開計算，之後再藉由 $\mathcal{O}(M)$ 合併答案，由於算法的限制，最多拆分兩組。而不像滾動數組的平行於最內層的迴圈，平行度有限，但在較少核心的處理上非常快速，其一原因是空間使用比較有效率。</p>
<ul>
<li>Server (32 cores)<ul>
<li>分組合併: Accepted (768 ms, 8320 KB)</li>
<li>滾動數組: Accepted (380 ms, 8 MB)</li>
</ul>
</li>
<li>PC (4 cores)<ul>
<li>分組合併: 600ms</li>
<li>滾動數組: 900ms</li>
</ul>
</li>
</ul>
<h3 id="滾動數組"><a href="#滾動數組" class="headerlink" title="滾動數組"></a>滾動數組</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"> </div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXM 1000005</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 10005</span></div><div class="line"><span class="keyword">int</span> dp[<span class="number">2</span>][MAXM];</div><div class="line"><span class="keyword">int</span> W[MAXN], V[MAXN];</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> max(a, b) (a &gt; b ? a : b)</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N, M;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;N, &amp;M) == <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;W[i], &amp;V[i]);</div><div class="line">        <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp));</div><div class="line"> </div><div class="line">        <span class="keyword">int</span> p = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="keyword">int</span> q = <span class="number">1</span> - p;</div><div class="line">            <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel</span></div><div class="line">            &#123;</div><div class="line">                <span class="keyword">int</span> pp = p, qq = q;</div><div class="line">                <span class="keyword">int</span> v = V[i], w = W[i];</div><div class="line">                <span class="meta">#<span class="meta-keyword">pragma</span> omp for</span></div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = w; i &lt;= M; i++)</div><div class="line">                    dp[qq][i] = max(dp[pp][i-w]+v, dp[pp][i]);</div><div class="line">                <span class="meta">#<span class="meta-keyword">pragma</span> omp for</span></div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)</div><div class="line">                    dp[qq][i] = dp[pp][i];</div><div class="line">            &#125;</div><div class="line">            p = <span class="number">1</span> - p;</div><div class="line">        &#125;</div><div class="line"> </div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, dp[p][M]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="分組合併"><a href="#分組合併" class="headerlink" title="分組合併"></a>分組合併</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> a &gt; b ? a : b;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">subKnapsack</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m, <span class="keyword">int</span> w[], <span class="keyword">int</span> v[], <span class="keyword">int</span> dp[])</span> </span>&#123;</div><div class="line">    <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp[<span class="number">0</span>]) * (m+<span class="number">1</span>));</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">int</span> vv = v[i], ww = w[i];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = m; j &gt;= ww; j--)</div><div class="line">            dp[j] = max(dp[j], dp[j-ww]+vv);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXM 1000005</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 100005</span></div><div class="line"><span class="keyword">int</span> W[MAXN], V[MAXN];</div><div class="line"><span class="keyword">int</span> dp[<span class="number">2</span>][MAXM];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N, M;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;N, &amp;M) == <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;W[i], &amp;V[i]);</div><div class="line">        <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp));</div><div class="line"> </div><div class="line">        <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel sections</span></div><div class="line">        &#123;</div><div class="line">            <span class="meta">#<span class="meta-keyword">pragma</span> omp section</span></div><div class="line">            subKnapsack(N/<span class="number">2</span>, M, W, V, dp[<span class="number">0</span>]);</div><div class="line">            <span class="meta">#<span class="meta-keyword">pragma</span> omp section</span></div><div class="line">            subKnapsack(N-N/<span class="number">2</span>, M, W+N/<span class="number">2</span>, V+N/<span class="number">2</span>, dp[<span class="number">1</span>]);</div><div class="line">        &#125;</div><div class="line"> </div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = M, j = <span class="number">0</span>, mx = <span class="number">0</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">            mx = max(mx, dp[<span class="number">1</span>][j]), j++;</div><div class="line">            ret = max(ret, dp[<span class="number">0</span>][i] + mx);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-10027" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/30/jg-10027/" class="article-date">
  <time datetime="2016-04-30T06:30:07.000Z" itemprop="datePublished">2016-04-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/30/jg-10027/">批改娘 10027. Fast Sudoku</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/04/30/jg-10027/" data-id="ckgyo55c6005o3cvrr8bj18x1" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/04/30/jg-10027/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IDA/">IDA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenMP/">OpenMP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p><img src="http://i.imgur.com/PHbnGMp.png" alt="不過，還想做得更好"></p>
<p>但這個世界卻要求神通廣大、無所不知，那不聰明的我又該何去何從 …</p>
<h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>給一張 $9 \times 9$ 數獨，必須滿足每行每列的 1 到 9 的數字不重複，同時在九個 $3 \times 3$ 方格內的 1 到 9 數字也不重複。請計算可填入的方法數。</p>
<h2 id="輸入格式"><a href="#輸入格式" class="headerlink" title="輸入格式"></a>輸入格式</h2><p>測資只有一筆，共有九行，每一行上有九個整數，第 $i$ 行上的第 $j$ 個整數表示 $\text{grid}[i][j]$ 填入的數字，若 $\text{grid}[i][j] = 0$ 表示尚未填入。</p>
<h2 id="輸出格式"><a href="#輸出格式" class="headerlink" title="輸出格式"></a>輸出格式</h2><p>對於每一組測資輸出一行一個整數，表示數獨共有幾種填法。</p>
<h2 id="範例輸入"><a href="#範例輸入" class="headerlink" title="範例輸入"></a>範例輸入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">0 6 0 0 0 4 0 5 0</div><div class="line">0 0 8 3 0 5 6 0 0</div><div class="line">2 0 0 0 0 0 0 0 1</div><div class="line">8 0 0 4 0 7 0 0 6</div><div class="line">0 0 6 0 0 0 3 0 0</div><div class="line">7 0 0 9 0 1 0 0 4</div><div class="line">5 0 0 0 0 0 0 0 2</div><div class="line">0 0 7 2 0 6 9 0 0</div><div class="line">0 4 0 5 0 8 0 7 0</div></pre></td></tr></table></figure>
<h2 id="範例輸出"><a href="#範例輸出" class="headerlink" title="範例輸出"></a>範例輸出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2</div></pre></td></tr></table></figure>
<h2 id="範例輸入-2"><a href="#範例輸入-2" class="headerlink" title="範例輸入 2"></a>範例輸入 2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">0 0 0 0 0 0 0 0 0</div><div class="line">0 0 3 6 0 0 0 0 0</div><div class="line">0 7 0 0 9 0 2 0 0</div><div class="line">0 5 0 0 0 7 0 0 0</div><div class="line">0 0 0 0 4 5 7 0 0</div><div class="line">0 0 0 1 0 0 0 3 0</div><div class="line">0 0 1 0 0 0 0 6 8</div><div class="line">0 0 8 5 0 0 0 1 0</div><div class="line">0 9 0 0 0 0 4 0 0</div></pre></td></tr></table></figure>
<h2 id="範例輸出-2"><a href="#範例輸出-2" class="headerlink" title="範例輸出 2"></a>範例輸出 2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">292</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>牽涉到 load balance 問題，大部分都要先廣度搜尋一次，把狀態展開後，再利用 dynamic scheduling 進行分配工作，效果會好上許多。為了解決狀態展開而後不浪費記憶體空間，IDA* 會是一種好的選擇。當然在 OpenMP 3.0 以上有提供 task 來幫忙做到類似的事情，但搜索展開會變成寫死，估計上會比較困難。</p>
<ul>
<li>IDA: Accepted (946 ms, 10752 KB)</li>
<li>OpenMP task: Accepted (1321 ms, 2560 KB)</li>
<li>DLX: Accepted (1208 ms, 56940 KB)</li>
</ul>
<p>當然 DLX 在建表處理會變得很討厭，overhead 相較於其他的算法都高出許多，因此狀態展開不可以太多，因為他本身就搜得非常快，撰寫這一類搜索問題時，特別小心 <code>#pragma omp private()</code> 的使用，複製操作原則上都是根據 <code>sizeof()</code> 決定複製空間大小。因此若複製目標為函數參數，很容易只有複製到指標。</p>
<h3 id="IDA"><a href="#IDA" class="headerlink" title="IDA"></a>IDA</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 65536</span></div><div class="line"> </div><div class="line"><span class="keyword">int</span> C[<span class="number">81</span>][<span class="number">2</span>], N;</div><div class="line"><span class="keyword">int</span> R[<span class="number">9</span>][<span class="number">3</span>] = &#123;&#125;, P[MAXN*<span class="number">9</span>][<span class="number">9</span>][<span class="number">3</span>], Pidx;</div><div class="line"><span class="keyword">int</span> ida_dep;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">IDA</span><span class="params">(<span class="keyword">int</span> idx, <span class="keyword">int</span> state[][<span class="number">3</span>])</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (idx == ida_dep) &#123;</div><div class="line">        <span class="built_in">memcpy</span>(P[Pidx], state, <span class="keyword">sizeof</span>(P[<span class="number">0</span>])), Pidx++;</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> x = C[idx][<span class="number">0</span>], y = C[idx][<span class="number">1</span>];</div><div class="line">    <span class="keyword">int</span> c = x/<span class="number">3</span>*<span class="number">3</span> + y/<span class="number">3</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</div><div class="line">        <span class="keyword">int</span> mask = <span class="number">1</span>&lt;&lt;i;</div><div class="line">        <span class="keyword">if</span> ((state[x][<span class="number">0</span>]&amp;mask) || (state[y][<span class="number">1</span>]&amp;mask) ||</div><div class="line">                (state[c][<span class="number">2</span>]&amp;mask))</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        state[x][<span class="number">0</span>] |= mask;</div><div class="line">        state[y][<span class="number">1</span>] |= mask;</div><div class="line">        state[c][<span class="number">2</span>] |= mask;</div><div class="line">        IDA(idx+<span class="number">1</span>, state);</div><div class="line">        state[x][<span class="number">0</span>] ^= mask;</div><div class="line">        state[y][<span class="number">1</span>] ^= mask;</div><div class="line">        state[c][<span class="number">2</span>] ^= mask;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> idx, <span class="keyword">int</span> state[][<span class="number">3</span>])</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (idx == N)</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> x = C[idx][<span class="number">0</span>], y = C[idx][<span class="number">1</span>];</div><div class="line">    <span class="keyword">int</span> c = x/<span class="number">3</span>*<span class="number">3</span> + y/<span class="number">3</span>, sum = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</div><div class="line">        <span class="keyword">int</span> mask = <span class="number">1</span>&lt;&lt;i;</div><div class="line">        <span class="keyword">if</span> ((state[x][<span class="number">0</span>]&amp;mask) || (state[y][<span class="number">1</span>]&amp;mask) ||</div><div class="line">                (state[c][<span class="number">2</span>]&amp;mask))</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        state[x][<span class="number">0</span>] |= mask;</div><div class="line">        state[y][<span class="number">1</span>] |= mask;</div><div class="line">        state[c][<span class="number">2</span>] |= mask;</div><div class="line">        sum += dfs(idx+<span class="number">1</span>, state);</div><div class="line">        state[c][<span class="number">2</span>] ^= mask;</div><div class="line">        state[y][<span class="number">1</span>] ^= mask;</div><div class="line">        state[x][<span class="number">0</span>] ^= mask;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> sum;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">incomplete_bfs</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (ida_dep = <span class="number">1</span>; ida_dep &lt;= N; ida_dep++) &#123;</div><div class="line">        Pidx = <span class="number">0</span>;</div><div class="line">        IDA(<span class="number">0</span>, R);</div><div class="line">        <span class="keyword">if</span> (Pidx &gt;= MAXN)</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (ida_dep == N+<span class="number">1</span>)</div><div class="line">        <span class="keyword">return</span> Pidx;</div><div class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for schedule(guided) reduction(+: ret) </span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Pidx; i++)</div><div class="line">        ret += dfs(ida_dep, P[i]);</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> g[<span class="number">9</span>][<span class="number">9</span>], n = <span class="number">9</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;g[i][j]);</div><div class="line">    N = <span class="number">0</span>;</div><div class="line">    <span class="built_in">memset</span>(R, <span class="number">0</span>, <span class="keyword">sizeof</span>(R));</div><div class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">         <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</div><div class="line">             <span class="keyword">if</span> (g[i][j]) &#123;</div><div class="line">                 g[i][j]--;</div><div class="line">                 R[i][<span class="number">0</span>] |= <span class="number">1</span>&lt;&lt;g[i][j];</div><div class="line">                 R[j][<span class="number">1</span>] |= <span class="number">1</span>&lt;&lt;g[i][j];</div><div class="line">                 R[i/<span class="number">3</span>*<span class="number">3</span>+j/<span class="number">3</span>][<span class="number">2</span>] |= <span class="number">1</span>&lt;&lt;g[i][j];</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                 C[N][<span class="number">0</span>] = i, C[N][<span class="number">1</span>] = j;</div><div class="line">                 N++;</div><div class="line">             &#125;</div><div class="line">         &#125;</div><div class="line">     &#125;</div><div class="line">    <span class="keyword">int</span> ret = incomplete_bfs();</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 65536</span></div><div class="line"> </div><div class="line"><span class="keyword">int</span> C[<span class="number">81</span>][<span class="number">2</span>], N;</div><div class="line"><span class="keyword">int</span> R[<span class="number">9</span>][<span class="number">3</span>] = &#123;&#125;;</div><div class="line"><span class="keyword">int</span> threadcount = <span class="number">0</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">pragma</span> omp threadprivate(threadcount)</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs_serial</span><span class="params">(<span class="keyword">int</span> idx, <span class="keyword">int</span> state[][<span class="number">3</span>])</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (idx == N) &#123;</div><div class="line">        threadcount++;</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> x = C[idx][<span class="number">0</span>], y = C[idx][<span class="number">1</span>];</div><div class="line">    <span class="keyword">int</span> c = x/<span class="number">3</span>*<span class="number">3</span> + y/<span class="number">3</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) </div><div class="line">    &#123;</div><div class="line">        <span class="keyword">int</span> mask = <span class="number">1</span>&lt;&lt;i;</div><div class="line">        <span class="keyword">if</span> ((state[x][<span class="number">0</span>]&amp;mask) || (state[y][<span class="number">1</span>]&amp;mask) ||</div><div class="line">                (state[c][<span class="number">2</span>]&amp;mask)) </div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        state[x][<span class="number">0</span>] |= mask;</div><div class="line">        state[y][<span class="number">1</span>] |= mask;</div><div class="line">        state[c][<span class="number">2</span>] |= mask;</div><div class="line">        dfs_serial(idx+<span class="number">1</span>, state);</div><div class="line">        state[c][<span class="number">2</span>] ^= mask;</div><div class="line">        state[y][<span class="number">1</span>] ^= mask;</div><div class="line">        state[x][<span class="number">0</span>] ^= mask;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> idx, <span class="keyword">int</span> state[][<span class="number">3</span>])</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (idx == N) &#123;</div><div class="line">        threadcount++;</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> x = C[idx][<span class="number">0</span>], y = C[idx][<span class="number">1</span>];</div><div class="line">    <span class="keyword">int</span> c = x/<span class="number">3</span>*<span class="number">3</span> + y/<span class="number">3</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) </div><div class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp task untied</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">int</span> mask = <span class="number">1</span>&lt;&lt;i;</div><div class="line">        <span class="keyword">if</span> ((state[x][<span class="number">0</span>]&amp;mask) || (state[y][<span class="number">1</span>]&amp;mask) ||</div><div class="line">                (state[c][<span class="number">2</span>]&amp;mask)) &#123;</div><div class="line"> </div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">int</span> S[<span class="number">9</span>][<span class="number">3</span>] = &#123;&#125;;</div><div class="line">            <span class="built_in">memcpy</span>(S, state, <span class="keyword">sizeof</span>(S));</div><div class="line"><span class="comment">//            int (*S)[3] = malloc(sizeof(int)*9*3);</span></div><div class="line"><span class="comment">//            memcpy(S, state, sizeof(int)*9*3);</span></div><div class="line">            S[x][<span class="number">0</span>] |= mask;</div><div class="line">            S[y][<span class="number">1</span>] |= mask;</div><div class="line">            S[c][<span class="number">2</span>] |= mask;</div><div class="line">            <span class="keyword">if</span> (idx &gt;= <span class="number">6</span>) &#123;</div><div class="line">                dfs_serial(idx+<span class="number">1</span>, S);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                dfs(idx+<span class="number">1</span>, S);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp taskwait</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">incomplete_bfs</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel</span></div><div class="line">    &#123;</div><div class="line">        <span class="meta">#<span class="meta-keyword">pragma</span> omp single</span></div><div class="line">        &#123;</div><div class="line">            dfs(<span class="number">0</span>, R);</div><div class="line">        &#125;</div><div class="line">        <span class="meta">#<span class="meta-keyword">pragma</span> omp critical</span></div><div class="line">            ret += threadcount;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> g[<span class="number">9</span>][<span class="number">9</span>], n = <span class="number">9</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;g[i][j]);</div><div class="line">    N = <span class="number">0</span>;</div><div class="line">    <span class="built_in">memset</span>(R, <span class="number">0</span>, <span class="keyword">sizeof</span>(R));</div><div class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">         <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</div><div class="line">             <span class="keyword">if</span> (g[i][j]) &#123;</div><div class="line">                 g[i][j]--;</div><div class="line">                 R[i][<span class="number">0</span>] |= <span class="number">1</span>&lt;&lt;g[i][j];</div><div class="line">                 R[j][<span class="number">1</span>] |= <span class="number">1</span>&lt;&lt;g[i][j];</div><div class="line">                 R[i/<span class="number">3</span>*<span class="number">3</span>+j/<span class="number">3</span>][<span class="number">2</span>] |= <span class="number">1</span>&lt;&lt;g[i][j];</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                 C[N][<span class="number">0</span>] = i, C[N][<span class="number">1</span>] = j;</div><div class="line">                 N++;</div><div class="line">             &#125;</div><div class="line">         &#125;</div><div class="line">     &#125;</div><div class="line">    <span class="keyword">int</span> ret = incomplete_bfs();</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="DLX"><a href="#DLX" class="headerlink" title="DLX"></a>DLX</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 65536</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXR 1024</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> byte;</div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> left, right, up, down;</div><div class="line">    <span class="keyword">int</span> ch;</div><div class="line">&#125; Node;</div><div class="line"><span class="comment">// DLX header</span></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> (* <span class="keyword">const</span> sudoku) (byte [][<span class="number">9</span>]);</div><div class="line">&#125; DLX_namespace;</div><div class="line"><span class="comment">// DLX body begin</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">DLX_remove</span><span class="params">(<span class="keyword">int</span> c, Node DL[], <span class="keyword">int</span> s[])</span> </span>&#123;</div><div class="line">    DL[DL[c].right].left = DL[c].left;</div><div class="line">    DL[DL[c].left].right = DL[c].right;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[c].down; i != c; i = DL[i].down) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = DL[i].right; j != i; j = DL[j].right) &#123;</div><div class="line">            DL[DL[j].down].up = DL[j].up;</div><div class="line">            DL[DL[j].up].down = DL[j].down;</div><div class="line">            s[DL[j].ch]--;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">DLX_resume</span><span class="params">(<span class="keyword">int</span> c, Node DL[], <span class="keyword">int</span> s[])</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[c].down; i != c; i = DL[i].down) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = DL[i].left; j != i; j = DL[j].left) &#123;</div><div class="line">            DL[DL[j].down].up = j;</div><div class="line">            DL[DL[j].up].down = j;</div><div class="line">            s[DL[j].ch]++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    DL[DL[c].right].left = c;</div><div class="line">    DL[DL[c].left].right = c;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">DLX_dfs</span><span class="params">(<span class="keyword">int</span> k, Node DL[], <span class="keyword">int</span> s[], <span class="keyword">int</span> head)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (DL[head].right == head)</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> t = INT_MAX, c;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[head].right; i != head; i = DL[i].right) &#123;</div><div class="line">        <span class="keyword">if</span> (s[i] &lt; t) &#123;</div><div class="line">            t = s[i], c = i;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</div><div class="line">    DLX_remove(c, DL, s);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[c].down; i != c; i = DL[i].down) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = DL[i].right; j != i; j = DL[j].right)</div><div class="line">            DLX_remove(DL[j].ch, DL, s);</div><div class="line">        ans += DLX_dfs(k+<span class="number">1</span>, DL, s, head);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = DL[i].left; j != i; j = DL[j].left)</div><div class="line">            DLX_resume(DL[j].ch, DL, s);</div><div class="line">    &#125;</div><div class="line">    DLX_resume(c, DL, s);</div><div class="line">    <span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">DLX_newnode</span><span class="params">(<span class="keyword">int</span> up, <span class="keyword">int</span> down, <span class="keyword">int</span> left, <span class="keyword">int</span> right, Node DL[], <span class="keyword">int</span> *size)</span> </span>&#123;</div><div class="line">    DL[*size].up = up, DL[*size].down = down;</div><div class="line">    DL[*size].left = left, DL[*size].right = right;</div><div class="line">    DL[up].down = DL[down].up = DL[left].right = DL[right].left = *size;</div><div class="line">    assert(*size &lt; MAXN);</div><div class="line">    <span class="keyword">return</span> (*size)++;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">DLX_newrow</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> Row[], Node DL[], <span class="keyword">int</span> s[], <span class="keyword">int</span> *size)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> a, r, row = <span class="number">-1</span>, k;</div><div class="line">    <span class="keyword">for</span> (a = <span class="number">0</span>; a &lt; n; a++) &#123;</div><div class="line">        r = Row[a];</div><div class="line">        DL[*size].ch = r, s[r]++;</div><div class="line">        <span class="keyword">if</span> (row == <span class="number">-1</span>) &#123;</div><div class="line">            row = DLX_newnode(DL[DL[r].ch].up, DL[r].ch, *size, *size, DL, size);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            k = DLX_newnode(DL[DL[r].ch].up, DL[r].ch, DL[row].left, row, DL, size);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">DLX_init</span><span class="params">(<span class="keyword">int</span> m, Node DL[], <span class="keyword">int</span> s[], <span class="keyword">int</span> *size, <span class="keyword">int</span> *head)</span> </span>&#123;</div><div class="line">    *size = <span class="number">0</span>;</div><div class="line">    *head = DLX_newnode(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, DL, size);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</div><div class="line">        DLX_newnode(i, i, DL[*head].left, *head, DL, size);</div><div class="line">        DL[i].ch = i, s[i] = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">DLX_sudoku</span><span class="params">(byte g[][<span class="number">9</span>])</span> </span>&#123;</div><div class="line">    Node DL[MAXN + MAXR];</div><div class="line">    <span class="keyword">int</span> s[MAXR], head, size;</div><div class="line">    <span class="keyword">int</span> row[<span class="number">10</span>];</div><div class="line">    <span class="keyword">int</span> used[<span class="number">4</span>][<span class="number">10</span>][<span class="number">10</span>] = &#123;&#125;, isValid = <span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> n = <span class="number">9</span>, tn = <span class="number">3</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</div><div class="line">            <span class="keyword">if</span> (g[i][j]) &#123;</div><div class="line">                <span class="keyword">int</span> x = g[i][j];</div><div class="line">                <span class="keyword">int</span> y = i/<span class="number">3</span>*<span class="number">3</span> + j/<span class="number">3</span>;</div><div class="line">                <span class="keyword">if</span> (used[<span class="number">1</span>][i][x])    isValid = <span class="number">0</span>;</div><div class="line">                <span class="keyword">if</span> (used[<span class="number">2</span>][j][x])    isValid = <span class="number">0</span>;</div><div class="line">                <span class="keyword">if</span> (used[<span class="number">3</span>][y][x])    isValid = <span class="number">0</span>;</div><div class="line">                used[<span class="number">0</span>][i][j] = <span class="number">1</span>;</div><div class="line">                used[<span class="number">1</span>][i][x] = used[<span class="number">2</span>][j][x] = used[<span class="number">3</span>][y][x] = <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (!isValid)</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"> </div><div class="line">    <span class="keyword">int</span> OFF[<span class="number">4</span>] = &#123;&#125;;</div><div class="line">    <span class="keyword">int</span> label[<span class="number">4</span>][<span class="number">10</span>][<span class="number">10</span>] = &#123;&#125;;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</div><div class="line">            <span class="keyword">if</span> (used[<span class="number">0</span>][i][j] == <span class="number">0</span>)</div><div class="line">                label[<span class="number">0</span>][i][j] = ++OFF[<span class="number">0</span>];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt; <span class="number">4</span>; k++) &#123;</div><div class="line">        OFF[k] = OFF[k<span class="number">-1</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (used[k][i][j] == <span class="number">0</span>) &#123;</div><div class="line">                    label[k][i][j] = ++OFF[k];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    DLX_init(OFF[<span class="number">3</span>], DL, s, &amp;size, &amp;head);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</div><div class="line">            <span class="keyword">if</span> (g[i][j])    <span class="keyword">continue</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= n; k++) &#123;</div><div class="line">                <span class="keyword">int</span> x = k;</div><div class="line">                <span class="keyword">int</span> y = i/<span class="number">3</span>*<span class="number">3</span> + j/<span class="number">3</span>;</div><div class="line">                <span class="keyword">if</span> (used[<span class="number">1</span>][i][x])    <span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">if</span> (used[<span class="number">2</span>][j][x])    <span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">if</span> (used[<span class="number">3</span>][y][x])    <span class="keyword">continue</span>;</div><div class="line"> </div><div class="line">                row[<span class="number">0</span>] = label[<span class="number">0</span>][i][j];</div><div class="line">                row[<span class="number">1</span>] = label[<span class="number">1</span>][i][k];</div><div class="line">                row[<span class="number">2</span>] = label[<span class="number">2</span>][j][k];</div><div class="line">                row[<span class="number">3</span>] = label[<span class="number">3</span>][y][k];</div><div class="line">                DLX_newrow(<span class="number">4</span>, row, DL, s, &amp;size);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> DLX_dfs(<span class="number">0</span>, DL, s, head);</div><div class="line">&#125;</div><div class="line">DLX_namespace <span class="keyword">const</span> DLX = &#123;DLX_sudoku&#125;;</div><div class="line"><span class="comment">// DLX body end</span></div><div class="line"> </div><div class="line"><span class="comment">// parallel utils</span></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></div><div class="line">    byte b[<span class="number">9</span>][<span class="number">9</span>];    <span class="comment">// board</span></div><div class="line">    <span class="keyword">bool</span> r[<span class="number">9</span>][<span class="number">9</span>], c[<span class="number">9</span>][<span class="number">9</span>], g[<span class="number">9</span>][<span class="number">9</span>];    <span class="comment">// row, column, grid</span></div><div class="line">&#125; Board;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">gridID</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> x / <span class="number">3</span> * <span class="number">3</span> + y / <span class="number">3</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">board_init</span><span class="params">(Board *b)</span> </span>&#123;</div><div class="line">    <span class="built_in">memset</span>(b, <span class="number">0</span>, <span class="keyword">sizeof</span>(Board));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">board_test</span><span class="params">(<span class="keyword">const</span> Board *b, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> b-&gt;b[x][y] == <span class="number">0</span> &amp;&amp; b-&gt;r[x][v<span class="number">-1</span>] == <span class="number">0</span> &amp;&amp; b-&gt;c[y][v<span class="number">-1</span>] == <span class="number">0</span> &amp;&amp; b-&gt;g[gridID(x, y)][v<span class="number">-1</span>] == <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">board_fill</span><span class="params">(Board *b, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">    b-&gt;b[x][y] = v;</div><div class="line">    b-&gt;r[x][v<span class="number">-1</span>] = b-&gt;c[y][v<span class="number">-1</span>] = b-&gt;g[gridID(x, y)][v<span class="number">-1</span>] = <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">incomplete_bfs</span><span class="params">(<span class="keyword">int</span> g[][<span class="number">9</span>])</span> </span>&#123;</div><div class="line">    Board origin;</div><div class="line">    <span class="keyword">int</span> n = <span class="number">9</span>;</div><div class="line">    <span class="keyword">int</span> A[<span class="number">81</span>][<span class="number">2</span>], m = <span class="number">0</span>;</div><div class="line">    board_init(&amp;origin);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</div><div class="line">            <span class="keyword">if</span> (g[i][j]) &#123;</div><div class="line">                board_fill(&amp;origin, i, j, g[i][j]);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                A[m][<span class="number">0</span>] = i, A[m][<span class="number">1</span>] = j, m++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXQMEM 8192</span></div><div class="line">    <span class="keyword">static</span> Board Q[<span class="number">2</span>][MAXQMEM*<span class="number">9</span>];</div><div class="line">    <span class="keyword">int</span> Qcnt[<span class="number">2</span>] = &#123;&#125;, Qflag = <span class="number">0</span>;</div><div class="line">    Q[Qflag][Qcnt[Qflag]] = origin, Qcnt[Qflag]++;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> it = <span class="number">0</span>; it &lt; m; it++) &#123;</div><div class="line">        <span class="keyword">const</span> <span class="keyword">int</span> x = A[it][<span class="number">0</span>], y = A[it][<span class="number">1</span>];</div><div class="line">        Qcnt[!Qflag] = <span class="number">0</span>;</div><div class="line">        <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Qcnt[Qflag]; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= <span class="number">9</span>; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (!board_test(&amp;Q[Qflag][i], x, y, j))</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">int</span> pIdx;</div><div class="line">                <span class="meta">#<span class="meta-keyword">pragma</span> omp critical</span></div><div class="line">                &#123;</div><div class="line">                    pIdx = Qcnt[!Qflag]++;</div><div class="line">                &#125;</div><div class="line">                Q[!Qflag][pIdx] = Q[Qflag][i];</div><div class="line">                board_fill(&amp;Q[!Qflag][pIdx], x, y, j);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (Qcnt[!Qflag] &gt;= MAXQMEM) &#123;</div><div class="line">            <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">            <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for reduction(+:ret)</span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Qcnt[Qflag]; i++) &#123;</div><div class="line">                ret += DLX.sudoku(Q[Qflag][i].b);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> ret;</div><div class="line">        &#125;</div><div class="line">        Qflag = !Qflag;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> Qcnt[Qflag];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> g[<span class="number">9</span>][<span class="number">9</span>], n = <span class="number">9</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;g[i][j]);</div><div class="line"> </div><div class="line">    <span class="keyword">int</span> ret = incomplete_bfs(g);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-10087" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/30/jg-10087/" class="article-date">
  <time datetime="2016-04-30T05:52:42.000Z" itemprop="datePublished">2016-04-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/30/jg-10087/">批改娘 10087. Sparse Matrix Multiplication (OpenMP)</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/04/30/jg-10087/" data-id="ckgyo55cr006q3cvr6lq2klyj" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/04/30/jg-10087/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenMP/">OpenMP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>稀疏矩陣為大部份元素皆為零的矩陣，在科學與工程領域中求解線性模型時經常出現大型的稀疏矩陣。現在給予最常見的 Coordinate Format (簡稱 COO 格式)，請問兩個矩陣相乘結果為何。</p>
<p>給予矩陣 <span>$A_{n, m}$</span><!-- Has MathJax --> 和 <span>$B_{m, r}$</span><!-- Has MathJax -->，請計算稀疏矩陣相乘。</p>
<span>$$A_{4,4} = \begin{bmatrix}
0 &amp; 0 &amp; 0 &amp; 0 \\
5 &amp; 8 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 3 &amp; 0 \\
0 &amp; 6 &amp; 0 &amp; 0 \\
\end{bmatrix}, \qquad
B_{4,4} = \begin{bmatrix}
0 &amp; 0 &amp; 1 &amp; 3 \\
0 &amp; 5 &amp; 2 &amp; 0 \\
3 &amp; 5 &amp; 0 &amp; 0 \\
0 &amp; 2 &amp; 0 &amp; 0 \\
\end{bmatrix}$$</span><!-- Has MathJax -->
<p>根據 COO 格式，分別轉換矩陣 $A$ 和 $B$ 的所有非零元素，如下表所示</p>
<h3 id="COO-of-Matrix-A"><a href="#COO-of-Matrix-A" class="headerlink" title="COO of Matrix $A$"></a>COO of Matrix $A$</h3><table>
<thead>
<tr>
<th><code>row_index</code></th>
<th><code>col_index</code></th>
<th><code>value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>0</td>
<td>5</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>8</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>3</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>6</td>
</tr>
</tbody>
</table>
<h3 id="COO-of-Matrix-B"><a href="#COO-of-Matrix-B" class="headerlink" title="COO of Matrix $B$"></a>COO of Matrix $B$</h3><table>
<thead>
<tr>
<th><code>row_index</code></th>
<th><code>col_index</code></th>
<th><code>value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>0</td>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>5</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>2</td>
<td>0</td>
<td>3</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>5</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>2</td>
</tr>
</tbody>
</table>
<h2 id="輸入格式"><a href="#輸入格式" class="headerlink" title="輸入格式"></a>輸入格式</h2><p>測資只有一組，第一行會有三個整數 $N, \; M, \; R$，分別表示矩陣 $A, \; B$ 的大小。下一行會有兩個整數 $N_A, \; N_B$，接下來會有 $N_A$ 行，每一行表示矩陣 $A$ 的 COO 格式，隨後會有 $N_B$ 行，每一行表示矩陣 $B$ 的 COO 格式。</p>
<ul>
<li>$0 &lt; N, \; M, \; R \le 10^6$</li>
<li>$0 &lt; N_A, \; N_B \le 10^6$</li>
</ul>
<p>給予 COO 格式時，先按照 <code>row_index</code> 由小到大，相同情況由 <code>col_index</code> 由小到大的方式給定，保證不會有重複，每一個元素值 $v$ 介於 $1$ 到 $2^{31}-1$ 之間。</p>
<h2 id="輸出格式"><a href="#輸出格式" class="headerlink" title="輸出格式"></a>輸出格式</h2><p>輸出 <span>$C_{n, r} = A_{n, m} \times B_{m, r}$</span><!-- Has MathJax --> 的雜湊值。</p>
<p>定義 <span>$\mathit{hash}(C_{n, r}) = \sum\nolimits_{e_{i, j} \in C \text{ and } e_{i, j} \neq 0} \mathit{encrypt}((i+1)*(j+1), e_{i, j})$</span><!-- Has MathJax -->，實際運作的 <strong>流程</strong> 可參考以下作法，當然你沒辦法宣告 $N \times M$ 的空間使用：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">rotate_left</span><span class="params">(<span class="keyword">uint32_t</span> x, <span class="keyword">uint32_t</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span>  (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">encrypt</span><span class="params">(<span class="keyword">uint32_t</span> m, <span class="keyword">uint32_t</span> key)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (rotate_left(m, key&amp;<span class="number">31</span>) + key)^key;</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 1024</span></div><div class="line"><span class="keyword">uint32_t</span> A[MAXN][MAXN], B[MAXN][MAXN];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> x, y, v;</div><div class="line">    <span class="keyword">int</span> N, M, R, nA, nB;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;N, &amp;M, &amp;R);</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;nA, &amp;nB);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nA; i++)</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;x, &amp;y, &amp;v), A[x][y] = v;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nB; i++)</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;x, &amp;y, &amp;v), B[x][y] = v;</div><div class="line">    </div><div class="line">    <span class="keyword">uint32_t</span> hash = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; R; j++) &#123;</div><div class="line">            <span class="keyword">uint32_t</span> sum = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; M; k++)</div><div class="line">                sum += A[i][k] * B[k][j];</div><div class="line">            <span class="keyword">if</span> (sum)</div><div class="line">                hash += encrypt((i+<span class="number">1</span>)*(j+<span class="number">1</span>), sum);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%u\n"</span>, hash);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="範例輸入"><a href="#範例輸入" class="headerlink" title="範例輸入"></a>範例輸入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">4 4 4</div><div class="line">4 7</div><div class="line"></div><div class="line">1 0 5</div><div class="line">1 1 8</div><div class="line">2 2 3</div><div class="line">3 1 6</div><div class="line"></div><div class="line">0 2 1</div><div class="line">0 3 3</div><div class="line">1 1 5</div><div class="line">1 2 2</div><div class="line">2 0 3</div><div class="line">2 1 5</div><div class="line">3 1 2</div></pre></td></tr></table></figure>
<h2 id="範例輸出"><a href="#範例輸出" class="headerlink" title="範例輸出"></a>範例輸出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">13093438</div></pre></td></tr></table></figure>
<h2 id="範例解釋"><a href="#範例解釋" class="headerlink" title="範例解釋"></a>範例解釋</h2><span>$$A_{n, m} \times B_{m, r} = C_{4,4}=\begin{bmatrix}
0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 40 &amp; 21 &amp; 15 \\
9 &amp; 15 &amp; 0 &amp; 0 \\
0 &amp; 30 &amp; 12 &amp; 0 \\
\end{bmatrix}$$</span><!-- Has MathJax -->
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><ul>
<li>傳統處理 Array of Structure: Accepted (14964 ms, 29104 KB)</li>
<li>傳統處理 Structure of Array: Accepted (12537 ms, 45568 KB)</li>
<li>額外空間 Array of Structure: Accepted (5711 ms, 29152 KB)</li>
<li>額外空間 Structure of Array: Accepted (5202 ms, 29056 KB)</li>
</ul>
<p>Array of Structure 簡稱 AOS，而 Structure of Array 簡稱 SOA，這兩種寫法的差異在於運用 structure 時的寫法，根據 cache line 的設計，有時候一個 struct 下會有很多變數，然而我們只需要使用部分的變數，這時候沒有使用的變數仍會跟著一起進入 cache，很容易造成 cache 效率偏低，因此回歸原始寫出 SOA 的版本。</p>
<h3 id="傳統處理"><a href="#傳統處理" class="headerlink" title="傳統處理"></a>傳統處理</h3><p>如果是兩個稀疏方陣，用 COO 格式需要先對後面那個矩陣轉置，接著在三欄 $(i, j, v)$ 的表格下，按照字典順序排序。此時會有兩個三欄 $A(i, j, v), \; B(i, j, v)$ (別忘記 $B$ 矩陣已經轉置過)，要計算 $A \times B = C$，為得到 <span>$C_{i, j}$</span><!-- Has MathJax -->，<span>$C_{i, j} = \sum A(i, k, v) B(j, k, v)$</span><!-- Has MathJax -->，由於已經排序好，那麼找到共同的 $k$ 不是難事，按照合併排序的手法，能在 $\mathcal{O}(N)$ 完成。</p>
<p>因此在最稠密的矩陣下，仍需要 $\mathcal{O}(N^3)$ 才能完成。</p>
<h4 id="AOS"><a href="#AOS" class="headerlink" title="AOS"></a>AOS</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 1048576</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXL (MAXN&lt;&lt;2)</span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">rotate_left</span><span class="params">(<span class="keyword">uint32_t</span> x, <span class="keyword">uint32_t</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span>  (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">encrypt</span><span class="params">(<span class="keyword">uint32_t</span> m, <span class="keyword">uint32_t</span> key)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (rotate_left(m, key&amp;<span class="number">31</span>) + key)^key;</div><div class="line">&#125;</div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ELE</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> i, j;</div><div class="line">    <span class="keyword">uint32_t</span> v;</div><div class="line">&#125; ELE;</div><div class="line">ELE LA[MAXL], LB[MAXL];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">SpMV</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> M, <span class="keyword">int</span> R, ELE LA[], <span class="keyword">int</span> na, ELE LB[], <span class="keyword">int</span> nb)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ma = <span class="number">0</span>, mb = <span class="number">0</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> aoff[MAXN], boff[MAXN];</div><div class="line"> </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, p = <span class="number">-1</span>; i &lt; na; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (LA[i].i != p)</div><div class="line">            aoff[ma++] = i, p = LA[i].i;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, p = <span class="number">-1</span>; i &lt; nb; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (LB[i].i != p)</div><div class="line">            boff[mb++] = i, p = LB[i].i;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="keyword">uint32_t</span> hash = <span class="number">0</span>;</div><div class="line">    aoff[ma] = na, boff[mb] = nb;</div><div class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for reduction(+: hash)</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ma; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; mb; j++) &#123;</div><div class="line">            <span class="keyword">int</span> idx1 = aoff[i], idx2 = boff[j];</div><div class="line">            <span class="keyword">int</span> top1 = aoff[i+<span class="number">1</span>], top2 = boff[j+<span class="number">1</span>];</div><div class="line">            <span class="keyword">uint32_t</span> sum = <span class="number">0</span>;</div><div class="line">            <span class="keyword">int</span> r = LA[idx1].i, c = LB[idx2].i;</div><div class="line">            <span class="keyword">while</span> (idx1 &lt; top1 &amp;&amp; idx2 &lt; top2) &#123;</div><div class="line">                <span class="keyword">if</span> (LA[idx1].j == LB[idx2].j)</div><div class="line">                    sum += LA[idx1].v * LB[idx2].v, idx1++, idx2++;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (LA[idx1].j &lt; LB[idx2].j)</div><div class="line">                    idx1++;</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    idx2++;                    </div><div class="line">            &#125;</div><div class="line"> </div><div class="line">            <span class="keyword">if</span> (sum)</div><div class="line">                hash += encrypt((r+<span class="number">1</span>)*(c+<span class="number">1</span>), sum);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%u\n"</span>, hash);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> ELE &amp;a, <span class="keyword">const</span> ELE &amp;b)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (a.i != b.i)</div><div class="line">        <span class="keyword">return</span> a.i &lt; b.i;</div><div class="line">    <span class="keyword">return</span> a.j &lt; b.j;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N, M, R, nA, nB;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;N, &amp;M, &amp;R) == <span class="number">3</span>) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;nA, &amp;nB);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nA; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;LA[i].i, &amp;LA[i].j, &amp;LA[i].v);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nB; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;LB[i].j, &amp;LB[i].i, &amp;LB[i].v);</div><div class="line">        sort(LB, LB+nB, cmp);</div><div class="line">        SpMV(N, M, R, LA, nA, LB, nB);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="SOA"><a href="#SOA" class="headerlink" title="SOA"></a>SOA</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 1048576</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXL (MAXN&lt;&lt;2)</span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">rotate_left</span><span class="params">(<span class="keyword">uint32_t</span> x, <span class="keyword">uint32_t</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span>  (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">encrypt</span><span class="params">(<span class="keyword">uint32_t</span> m, <span class="keyword">uint32_t</span> key)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (rotate_left(m, key&amp;<span class="number">31</span>) + key)^key;</div><div class="line">&#125;</div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ELE</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> i[MAXL], j[MAXL];</div><div class="line">    <span class="keyword">uint32_t</span> v[MAXL];</div><div class="line">&#125; ELE;</div><div class="line">ELE LA, LB, LT;</div><div class="line"><span class="keyword">int</span> D[MAXL];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">SpMV</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> M, <span class="keyword">int</span> R, ELE &amp;LA, <span class="keyword">int</span> na, ELE &amp;LB, <span class="keyword">int</span> nb)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ma = <span class="number">0</span>, mb = <span class="number">0</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> aoff[MAXN], boff[MAXN];</div><div class="line"> </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, p = <span class="number">-1</span>; i &lt; na; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (LA.i[i] != p)</div><div class="line">            aoff[ma++] = i, p = LA.i[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, p = <span class="number">-1</span>; i &lt; nb; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (LB.i[i] != p)</div><div class="line">            boff[mb++] = i, p = LB.i[i];</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="keyword">uint32_t</span> hash = <span class="number">0</span>;</div><div class="line">    aoff[ma] = na, boff[mb] = nb;</div><div class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for reduction(+: hash)</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ma; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; mb; j++) &#123;</div><div class="line">            <span class="keyword">int</span> idx1 = aoff[i], idx2 = boff[j];</div><div class="line">            <span class="keyword">int</span> top1 = aoff[i+<span class="number">1</span>], top2 = boff[j+<span class="number">1</span>];</div><div class="line">            <span class="keyword">uint32_t</span> sum = <span class="number">0</span>;</div><div class="line">            <span class="keyword">int</span> r = LA.i[idx1], c = LB.i[idx2];</div><div class="line">            <span class="keyword">while</span> (idx1 &lt; top1 &amp;&amp; idx2 &lt; top2) &#123;</div><div class="line">                <span class="keyword">if</span> (LA.j[idx1] &lt; LB.j[idx2])</div><div class="line">                    idx1++;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (LA.j[idx1] &gt; LB.j[idx2])</div><div class="line">                    idx2++;                    </div><div class="line">                <span class="keyword">else</span></div><div class="line">                    sum += LA.v[idx1] * LB.v[idx2], idx1++, idx2++;</div><div class="line">            &#125;</div><div class="line"> </div><div class="line">            <span class="keyword">if</span> (sum)</div><div class="line">                hash += encrypt((r+<span class="number">1</span>)*(c+<span class="number">1</span>), sum);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%u\n"</span>, hash);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (LT.i[a] != LT.i[b])</div><div class="line">        <span class="keyword">return</span> LT.i[a] &lt; LT.i[b];</div><div class="line">    <span class="keyword">return</span> LT.j[a] &lt; LT.j[b];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N, M, R, nA, nB;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;N, &amp;M, &amp;R) == <span class="number">3</span>) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;nA, &amp;nB);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nA; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;LA.i[i], &amp;LA.j[i], &amp;LA.v[i]);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nB; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &lt;.j[i], &lt;.i[i], &lt;.v[i]);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nB; i++)</div><div class="line">            D[i] = i;</div><div class="line">        sort(D, D+nB, cmp);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nB; i++)</div><div class="line">            LB.i[i] = LT.i[D[i]], LB.j[i] = LT.j[D[i]], LB.v[i] = LT.v[D[i]];</div><div class="line">        SpMV(N, M, R, LA, nA, LB, nB);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="額外空間"><a href="#額外空間" class="headerlink" title="額外空間"></a>額外空間</h3><p>若採用額外空間處理，一開始就不用對 $B$ 轉置，<span>$C_{i, j} = \sum A(i, k, v) B(k, j, v)$</span><!-- Has MathJax -->。每一次解決 $C$ 的第 $i$ 列上的所有元素值，此時 $A(i, k, v)$ 按照 $k$ 遞增排列，$B(k, j, v)$ 要配對 $A(i, k, v)$，會恰好掃描完整的 $B$，累加元素值會不按照順序累加到 <span>$C_{i, j}$</span><!-- Has MathJax -->。</p>
<p>因此在最稠密的矩陣下，仍需要 $\mathcal{O}(N^3)$ 才能完成。</p>
<h4 id="AOS-1"><a href="#AOS-1" class="headerlink" title="AOS"></a>AOS</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">rotate_left</span><span class="params">(<span class="keyword">uint32_t</span> x, <span class="keyword">uint32_t</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span>  (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">encrypt</span><span class="params">(<span class="keyword">uint32_t</span> m, <span class="keyword">uint32_t</span> key)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (rotate_left(m, key&amp;<span class="number">31</span>) + key)^key;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 1048576</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXL 1048576</span></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ELE</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> i, j;</div><div class="line">    <span class="keyword">uint32_t</span> v;</div><div class="line">&#125; ELE;</div><div class="line">ELE LA[MAXL], LB[MAXL];</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">SpMV</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> M, <span class="keyword">int</span> R, ELE LA[], <span class="keyword">int</span> na, ELE LB[], <span class="keyword">int</span> nb)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ma = <span class="number">0</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> aoff[MAXN];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, p = <span class="number">-1</span>; i &lt; na; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (LA[i].i != p)</div><div class="line">            aoff[ma++] = i, p = LA[i].i;</div><div class="line">    &#125;</div><div class="line">    aoff[ma] = na;</div><div class="line"> </div><div class="line">    <span class="keyword">uint32_t</span> hash = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> chunk = <span class="number">8</span>;</div><div class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for schedule(dynamic, chunk) reduction(+: hash)</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ma; i++) &#123;</div><div class="line">        <span class="keyword">int</span> idx1 = aoff[i], top1 = aoff[i+<span class="number">1</span>];</div><div class="line">        <span class="keyword">int</span> r = LA[idx1].i;</div><div class="line">        <span class="keyword">uint32_t</span> *C = (<span class="keyword">uint32_t</span> *) <span class="built_in">calloc</span>(R, <span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>));</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> idx2 = <span class="number">0</span>; idx2 &lt; nb &amp;&amp; idx1 &lt; top1; ) &#123;</div><div class="line">            <span class="keyword">if</span> (LA[idx1].j == LB[idx2].i) &#123;</div><div class="line">                C[LB[idx2].j] += LA[idx1].v * LB[idx2].v;</div><div class="line">                idx2++;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (idx2 &lt; nb &amp;&amp; LA[idx1].j != LB[idx2].i) &#123;</div><div class="line">                <span class="keyword">if</span> (LA[idx1].j &lt; LB[idx2].i)</div><div class="line">                    idx1++;</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    idx2++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; R; j++) &#123;</div><div class="line">            <span class="keyword">if</span> (C[j])</div><div class="line">                hash += encrypt((r+<span class="number">1</span>)*(j+<span class="number">1</span>), C[j]);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">free</span>(C);</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%u\n"</span>, hash);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">uint32_t</span> N, M, R, nA, nB;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;N, &amp;M, &amp;R) == <span class="number">3</span>) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;nA, &amp;nB);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nA; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;LA[i].i, &amp;LA[i].j, &amp;LA[i].v);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nB; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;LB[i].i, &amp;LB[i].j, &amp;LB[i].v);</div><div class="line">        SpMV(N, M, R, LA, nA, LB, nB);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="SOA-1"><a href="#SOA-1" class="headerlink" title="SOA"></a>SOA</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">rotate_left</span><span class="params">(<span class="keyword">uint32_t</span> x, <span class="keyword">uint32_t</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span>  (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">encrypt</span><span class="params">(<span class="keyword">uint32_t</span> m, <span class="keyword">uint32_t</span> key)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (rotate_left(m, key&amp;<span class="number">31</span>) + key)^key;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 1048576</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXL 1048576</span></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ELE</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> i[MAXL], j[MAXL];</div><div class="line">    <span class="keyword">uint32_t</span> v[MAXL];</div><div class="line">&#125; ELE;</div><div class="line">ELE LA, LB;</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">SpMV</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> M, <span class="keyword">int</span> R, ELE &amp;LA, <span class="keyword">int</span> na, ELE &amp;LB, <span class="keyword">int</span> nb)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ma = <span class="number">0</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> aoff[MAXN];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, p = <span class="number">-1</span>; i &lt; na; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (LA.i[i] != p)</div><div class="line">            aoff[ma++] = i, p = LA.i[i];</div><div class="line">    &#125;</div><div class="line">    aoff[ma] = na;</div><div class="line"> </div><div class="line">    <span class="keyword">uint32_t</span> hash = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> chunk = <span class="number">8</span>;</div><div class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for schedule(dynamic, chunk) reduction(+: hash)</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ma; i++) &#123;</div><div class="line">        <span class="keyword">int</span> idx1 = aoff[i], top1 = aoff[i+<span class="number">1</span>];</div><div class="line">        <span class="keyword">int</span> r = LA.i[idx1];</div><div class="line">        <span class="keyword">uint32_t</span> *C = (<span class="keyword">uint32_t</span> *) <span class="built_in">calloc</span>(R, <span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>));</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> idx2 = <span class="number">0</span>; idx2 &lt; nb &amp;&amp; idx1 &lt; top1; ) &#123;</div><div class="line">            <span class="keyword">if</span> (LA.j[idx1] == LB.i[idx2]) &#123;</div><div class="line">                C[LB.j[idx2]] += LA.v[idx1] * LB.v[idx2];</div><div class="line">                idx2++;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (idx2 &lt; nb &amp;&amp; LA.j[idx1] != LB.i[idx2]) &#123;</div><div class="line">                <span class="keyword">if</span> (LA.j[idx1] &lt; LB.i[idx2])</div><div class="line">                    idx1++;</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    idx2++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; R; j++) &#123;</div><div class="line">            <span class="keyword">if</span> (C[j])</div><div class="line">                hash += encrypt((r+<span class="number">1</span>)*(j+<span class="number">1</span>), C[j]);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">free</span>(C);</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%u\n"</span>, hash);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">uint32_t</span> N, M, R, nA, nB;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;N, &amp;M, &amp;R) == <span class="number">3</span>) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;nA, &amp;nB);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nA; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;LA.i[i], &amp;LA.j[i], &amp;LA.v[i]);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nB; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;LB.i[i], &amp;LB.j[i], &amp;LB.v[i]);</div><div class="line">        SpMV(N, M, R, LA, nA, LB, nB);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-uva-13009" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/30/uva-13009/" class="article-date">
  <time datetime="2016-04-30T05:37:44.000Z" itemprop="datePublished">2016-04-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/30/uva-13009/">UVa 13009 - Fence the vegetables fail</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/04/30/uva-13009/" data-id="ckgyo55pb00qj3cvr6uv1wbue" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/04/30/uva-13009/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BIT/">BIT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/掃描線/">掃描線</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>給一個平行兩軸的簡單多邊形花圃以及一堆蔬菜的座標，請問有多少蔬菜在柵欄的外部，把那些在外部的蔬菜編號加總後輸出。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">4 8</div><div class="line">1 2</div><div class="line">1 0</div><div class="line">5 3</div><div class="line">3 4</div><div class="line">0 1</div><div class="line">6 1</div><div class="line">6 4</div><div class="line">4 4</div><div class="line">4 3</div><div class="line">2 3</div><div class="line">2 5</div><div class="line">0 5</div><div class="line">6 12</div><div class="line">6 5</div><div class="line">1 9</div><div class="line">3 6</div><div class="line">3 4</div><div class="line">2 0</div><div class="line">4 4</div><div class="line">5 8</div><div class="line">5 3</div><div class="line">2 3</div><div class="line">2 5</div><div class="line">4 5</div><div class="line">4 7</div><div class="line">0 7</div><div class="line">0 1</div><div class="line">7 1</div><div class="line">7 10</div><div class="line">0 10</div><div class="line">0 8</div><div class="line">1 4</div><div class="line">1 1</div><div class="line">2 0</div><div class="line">2 2</div><div class="line">0 2</div><div class="line">0 0</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">6</div><div class="line">15</div><div class="line">0</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>判斷一個點是否在簡單多邊形內部可以使用射線法，然而有很多點詢問，單筆詢問複雜度 $\mathcal{O}(N)$，這樣很明顯地會 TLE。</p>
<p>為了加速判斷，採用掃描線算法，依序放入平行 x 軸的線段，掃描過程中離線詢問某點往 y 軸負方向的射線交點個數為何，維護求交點個數可以利用 binary indexed tree 維護前綴和，前綴和相當於射線交點個數。就能在 $\mathcal{O}(N \log N)$ 完成所有詢問。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pt</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> x, y, v;</div><div class="line">    Pt(<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>):</div><div class="line">    x(a), y(b) &#123;&#125;</div><div class="line">    Pt <span class="keyword">operator</span>-(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> Pt(x - a.x, y - a.y);</div><div class="line">    &#125;</div><div class="line">    Pt <span class="keyword">operator</span>+(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> Pt(x + a.x, y + a.y);</div><div class="line">    &#125;</div><div class="line">    Pt <span class="keyword">operator</span>*(<span class="keyword">const</span> <span class="keyword">double</span> a) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> Pt(x * a, y * a);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">if</span> (x != a.x)</div><div class="line">            <span class="keyword">return</span> x &lt; a.x;</div><div class="line">        <span class="keyword">if</span> (y != a.y)</div><div class="line">            <span class="keyword">return</span> y &lt; a.y;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Seg</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> xl, xr, y;</div><div class="line">    Seg(<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>):</div><div class="line">    xl(a), xr(b), y(c) &#123;&#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Seg &amp;u) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> xl &lt; u.xl;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">Pt P[<span class="number">131072</span>], D[<span class="number">131072</span>];</div><div class="line"><span class="keyword">int</span> BIT[<span class="number">262144</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val, <span class="keyword">int</span> L)</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span> (x &lt;= L)</div><div class="line">        BIT[x] += val, x += x&amp;(-x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> (x)</div><div class="line">        sum += BIT[x], x -= x&amp;(-x);</div><div class="line">    <span class="keyword">return</span> sum;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> M)</span> </span>&#123;</div><div class="line">    <span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; RX, RY;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</div><div class="line">        RX[P[i].x] = RY[P[i].y] = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; M; i++)</div><div class="line">        RX[D[i].x] = RY[D[i].y] = <span class="number">0</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">int</span> label_x = <span class="number">0</span>, label_y = <span class="number">0</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;x : RX)</div><div class="line">        x.second = ++label_x;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;y : RY)</div><div class="line">        y.second = ++label_y;</div><div class="line">    </div><div class="line">    <span class="built_in">memset</span>(BIT, <span class="number">0</span>, <span class="keyword">sizeof</span>(BIT));</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</div><div class="line">        P[i].x = RX[P[i].x], P[i].y = RY[P[i].y];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; M; i++)</div><div class="line">        D[i].x = RX[D[i].x], D[i].y = RY[D[i].y];</div><div class="line">    </div><div class="line">    <span class="built_in">vector</span>&lt;Seg&gt; segs;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; M; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (D[i].y == D[(i+<span class="number">1</span>)%M].y) &#123;</div><div class="line">            <span class="keyword">int</span> xl = min(D[i].x, D[(i+<span class="number">1</span>)%M].x);</div><div class="line">            <span class="keyword">int</span> xr = max(D[i].x, D[(i+<span class="number">1</span>)%M].x);</div><div class="line">            segs.push_back(Seg(xl, xr, D[i].y));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> outer_val = <span class="number">0</span>;</div><div class="line">    sort(P, P+N);</div><div class="line">    sort(segs.begin(), segs.end());</div><div class="line">    <span class="keyword">int</span> Pidx = <span class="number">0</span>;</div><div class="line">    <span class="built_in">set</span>&lt;<span class="built_in">std</span>::pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt; PQ;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, line_x = <span class="number">1</span>; line_x &lt;= label_x; line_x++) &#123;</div><div class="line">        <span class="keyword">while</span> (Pidx &lt; N &amp;&amp; P[Pidx].x &lt;= line_x) &#123;</div><div class="line">            <span class="keyword">int</span> intersect = query(P[Pidx].y);</div><div class="line">            <span class="keyword">if</span> (intersect%<span class="number">2</span> == <span class="number">0</span>)</div><div class="line">                outer_val += P[Pidx].v;</div><div class="line">            Pidx++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">while</span> (!PQ.empty() &amp;&amp; PQ.begin()-&gt;first &lt;= line_x)</div><div class="line">            modify(PQ.begin()-&gt;second, <span class="number">-1</span>, label_y), PQ.erase(PQ.begin());</div><div class="line">        <span class="keyword">while</span> (i &lt; segs.size() &amp;&amp; segs[i].xl == line_x) &#123;</div><div class="line">            modify(segs[i].y, <span class="number">1</span>, label_y);</div><div class="line">            PQ.insert(make_pair(segs[i].xr, segs[i].y));</div><div class="line">            i++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, outer_val);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N, M;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;N, &amp;M) == <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;P[i].x, &amp;P[i].y);</div><div class="line">            P[i].v = i+<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; M; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;D[i].x, &amp;D[i].y);</div><div class="line">        </div><div class="line">        solve(N, M);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-uva-13046" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/30/uva-13046/" class="article-date">
  <time datetime="2016-04-30T04:06:06.000Z" itemprop="datePublished">2016-04-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/30/uva-13046/">UVa 13046 - Bus Collisions</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/04/30/uva-13046/" data-id="ckgyo55pw00r93cvrqrn9nffg" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/04/30/uva-13046/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/模擬/">模擬</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>給予兩個公車行駛路線，每台公車的速度都相同，分別從起始位置出發，請問第一個碰撞位置為何？</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">2</div><div class="line">4</div><div class="line">0  4</div><div class="line">2  4</div><div class="line">2  5</div><div class="line">0  5</div><div class="line">4</div><div class="line">1  7</div><div class="line">1  2</div><div class="line">3  2</div><div class="line">3  7</div><div class="line">4</div><div class="line">5  0</div><div class="line">6  0</div><div class="line">6  1</div><div class="line">5  1</div><div class="line">4</div><div class="line">7  0</div><div class="line">8  0</div><div class="line">8  1</div><div class="line">7  1</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Case 1: 1 5</div><div class="line">Case 2: No Collision</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>抓路線長度的最小公倍數，一定能在這段時間內找到碰撞位置，否則不存在碰撞地點。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pt</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> x, y;</div><div class="line">    Pt(<span class="keyword">int</span> x = <span class="number">0</span>, <span class="keyword">int</span> y = <span class="number">0</span>): x(x), y(y) &#123;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">dist</span><span class="params">(Pt u)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">abs</span>(x - u.x) + <span class="built_in">abs</span>(y - u.y);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> Pt &amp;u) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> x == u.x &amp;&amp; y == u.y;</div><div class="line">    &#125;</div><div class="line">    Pt <span class="keyword">operator</span>-(<span class="keyword">const</span> Pt &amp;u) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> Pt(x - u.x, y - u.y);</div><div class="line">    &#125;</div><div class="line">    Pt <span class="keyword">operator</span>+(<span class="keyword">const</span> Pt &amp;u) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> Pt(x + u.x, y + u.y);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> N[<span class="number">2</span>], x, y;</div><div class="line">    Pt R[<span class="number">2</span>][<span class="number">64</span>];</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="keyword">int</span> Len[<span class="number">2</span>] = &#123;&#125;;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;N[i]);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; N[i]; j++) &#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;x, &amp;y);</div><div class="line">                R[i][j] = Pt(x, y);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; N[i]; j++)</div><div class="line">                Len[i] += R[i][j].dist(R[i][(j+<span class="number">1</span>)%N[i]]);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case %d: "</span>, ++cases);</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> simT = Len[<span class="number">0</span>]/__gcd(Len[<span class="number">0</span>], Len[<span class="number">1</span>])*Len[<span class="number">1</span>];</div><div class="line">        <span class="keyword">int</span> posIdx[<span class="number">2</span>], has = <span class="number">0</span>;</div><div class="line">        Pt posXY[<span class="number">2</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</div><div class="line">            posIdx[i] = <span class="number">0</span>, posXY[i] = R[i][<span class="number">0</span>];</div><div class="line">            </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> it = <span class="number">0</span>; it &lt; simT; it++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</div><div class="line">                <span class="comment">// move</span></div><div class="line">                <span class="keyword">if</span> (posXY[i] == R[i][posIdx[i]])</div><div class="line">                    posIdx[i] = (posIdx[i]+<span class="number">1</span>)%N[i];</div><div class="line">                Pt dv = R[i][posIdx[i]] - posXY[i];</div><div class="line">                <span class="keyword">int</span> lenDv = <span class="built_in">abs</span>(dv.x) + <span class="built_in">abs</span>(dv.y);</div><div class="line">                dv.x /= lenDv, dv.y /= lenDv;</div><div class="line">                posXY[i] = posXY[i] + dv;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (posXY[<span class="number">0</span>] == posXY[<span class="number">1</span>]) &#123;</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>, posXY[<span class="number">0</span>].x, posXY[<span class="number">0</span>].y);</div><div class="line">                has = <span class="number">1</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (!has)</div><div class="line">            <span class="built_in">puts</span>(<span class="string">"No Collision"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-uva-1718" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/30/uva-1718/" class="article-date">
  <time datetime="2016-04-30T03:39:02.000Z" itemprop="datePublished">2016-04-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/30/uva-1718/">UVa 1718 - Tile Cutting</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/04/30/uva-1718/" data-id="ckgyo55st00v73cvrc0kbai7e" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/04/30/uva-1718/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FFT/">FFT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NTT/">NTT</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>請問在網格中，若頂點設置在網格邊上，構成平行四邊形的面積介於 $[l, r]$，最多的方法數和面積分別為多少。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">2</div><div class="line">4 4</div><div class="line">2 6</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">48</div><div class="line">620</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>由於是平行四邊形，假設矩形被劃分的兩個對稱三角形的底高 $a, b, c, d$，且 $a, b, c, d &gt; 0$。</p>
<p>得到平行四邊形面積為 </p>
<span>$$\begin{align*}
\text{Area} &amp;= (a + c)(b + d) - 2 \times 0.5 \times a b - 2 \times 0.5 \times c d \\
&Tab;&Tab;&Tab;&amp;= ad + bc
\end{align*}$$</span><!-- Has MathJax -->
<p>最後找到構成方法數為 ways of area = #(a, b, c, d) sat. ad + bc = Area。分別統計兩數相乘為 $x$ 的方法數 <span>$W_x$</span><!-- Has MathJax -->，可以構成多項式 <span>$W_1 x + W_2 x^2 + \cdots W_n x^n$</span><!-- Has MathJax -->，多項式相乘後，得到的係數就是所有的方法數。套用 FFT 的卷積計算即可。</p>
<h3 id="FFT"><a href="#FFT" class="headerlink" title="FFT"></a>FFT</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;complex&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Complex</span> &#123;</span></div><div class="line">    <span class="keyword">double</span> x, y;</div><div class="line">    Complex(<span class="keyword">double</span> x = <span class="number">0</span>, <span class="keyword">double</span> y = <span class="number">0</span>): x(x), y(y) &#123;&#125;</div><div class="line">    Complex <span class="keyword">operator</span>-(<span class="keyword">const</span> Complex &amp;v) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> Complex(x-v.x,y-v.y);</div><div class="line">    &#125;</div><div class="line">    Complex <span class="keyword">operator</span>+(<span class="keyword">const</span> Complex &amp;v) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> Complex(x+v.x,y+v.y);</div><div class="line">    &#125;</div><div class="line">    Complex <span class="keyword">operator</span>*(<span class="keyword">const</span> Complex &amp;v) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> Complex(x*v.x-y*v.y,x*v.y+y*v.x);</div><div class="line">    &#125;</div><div class="line">    Complex <span class="keyword">operator</span>/(<span class="keyword">const</span> <span class="keyword">int</span> &amp;v) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> Complex(x/v,y/v);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">real</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> x;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="class"><span class="keyword">class</span> <span class="title">TOOL_FFT</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> UINT32;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN (1048576&lt;&lt;1)</span></div><div class="line">    Complex p[<span class="number">2</span>][MAXN];</div><div class="line">    <span class="keyword">int</span> pre_n;</div><div class="line">    T PI;</div><div class="line">    TOOL_FFT() &#123;</div><div class="line">        pre_n = <span class="number">0</span>;</div><div class="line">        PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">NumberOfBitsNeeded</span><span class="params">(<span class="keyword">int</span> PowerOfTwo)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; ; ++i) &#123;</div><div class="line">            <span class="keyword">if</span> (PowerOfTwo &amp; (<span class="number">1</span> &lt;&lt; i)) &#123;</div><div class="line">                <span class="keyword">return</span> i;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> UINT32 <span class="title">FastReverseBits</span><span class="params">(UINT32 a, <span class="keyword">int</span> NumBits)</span> </span>&#123;</div><div class="line">        a = ( ( a &amp; <span class="number">0x55555555</span>U ) &lt;&lt; <span class="number">1</span> ) | ( ( a &amp; <span class="number">0xAAAAAAAA</span>U ) &gt;&gt; <span class="number">1</span> ) ;</div><div class="line">        a = ( ( a &amp; <span class="number">0x33333333</span>U ) &lt;&lt; <span class="number">2</span> ) | ( ( a &amp; <span class="number">0xCCCCCCCC</span>U ) &gt;&gt; <span class="number">2</span> ) ;</div><div class="line">        a = ( ( a &amp; <span class="number">0x0F0F0F0F</span>U ) &lt;&lt; <span class="number">4</span> ) | ( ( a &amp; <span class="number">0xF0F0F0F0</span>U ) &gt;&gt; <span class="number">4</span> ) ;</div><div class="line">        a = ( ( a &amp; <span class="number">0x00FF00FF</span>U ) &lt;&lt; <span class="number">8</span> ) | ( ( a &amp; <span class="number">0xFF00FF00</span>U ) &gt;&gt; <span class="number">8</span> ) ;</div><div class="line">        a = ( ( a &amp; <span class="number">0x0000FFFF</span>U ) &lt;&lt; <span class="number">16</span> ) | ( ( a &amp; <span class="number">0xFFFF0000</span>U ) &gt;&gt; <span class="number">16</span> ) ;</div><div class="line">        <span class="keyword">return</span> a &gt;&gt; (<span class="number">32</span> - NumBits);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">FFT</span><span class="params">(<span class="keyword">bool</span> InverseTransform, <span class="built_in">vector</span>&lt;Complex&gt;&amp; In, <span class="built_in">vector</span>&lt;Complex&gt;&amp; Out)</span> </span>&#123;</div><div class="line">        <span class="comment">// simultaneous data copy and bit-reversal ordering into outputs</span></div><div class="line">        <span class="keyword">int</span> NumSamples = In.size();</div><div class="line">        <span class="keyword">int</span> NumBits = NumberOfBitsNeeded(NumSamples);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NumSamples; ++i) &#123;</div><div class="line">            Out[FastReverseBits(i, NumBits)] = In[i];</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// the FFT process</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= NumBits; i++) &#123;</div><div class="line">            <span class="keyword">int</span> BlockSize = <span class="number">1</span>&lt;&lt;i, BlockEnd = BlockSize&gt;&gt;<span class="number">1</span>, BlockCnt = NumSamples/BlockSize;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> j = <span class="number">0</span>; j &lt; NumSamples; j += BlockSize) &#123;</div><div class="line">                Complex *t = p[InverseTransform];</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> k = <span class="number">0</span>; k &lt; BlockEnd; k++, t += BlockCnt) &#123;</div><div class="line">                    Complex a = (*t) * Out[k+j+BlockEnd];</div><div class="line">                    Out[k+j+BlockEnd] = Out[k+j] - a;</div><div class="line">                    Out[k+j] = Out[k+j] + a;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// normalize if inverse transform</span></div><div class="line">        <span class="keyword">if</span> (InverseTransform) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NumSamples; ++i) &#123;</div><div class="line">                Out[i] = Out[i] / NumSamples;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">prework</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (pre_n == n)</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        pre_n = n;</div><div class="line">        p[<span class="number">0</span>][<span class="number">0</span>] = Complex(<span class="number">1</span>, <span class="number">0</span>);</div><div class="line">        p[<span class="number">1</span>][<span class="number">0</span>] = Complex(<span class="number">1</span>, <span class="number">0</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</div><div class="line">            p[<span class="number">0</span>][i] = Complex(<span class="built_in">cos</span>(<span class="number">2</span>*i*PI / n ) , <span class="built_in">sin</span>(<span class="number">2</span>*i*PI / n ));</div><div class="line">            p[<span class="number">1</span>][i] = Complex(<span class="built_in">cos</span>(<span class="number">2</span>*i*PI / n ) , -<span class="built_in">sin</span>(<span class="number">2</span>*i*PI / n ));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">vector</span>&lt;T&gt; convolution(Complex *a, Complex *b, <span class="keyword">int</span> n) &#123;</div><div class="line">        prework(n);</div><div class="line">        <span class="built_in">vector</span>&lt;Complex&gt; s(a, a+n), d1(n), d2(n), y(n);</div><div class="line">        <span class="built_in">vector</span>&lt;T&gt; ret(n);</div><div class="line">        FFT(<span class="literal">false</span>, s, d1);</div><div class="line">        s[<span class="number">0</span>] = b[<span class="number">0</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j = n<span class="number">-1</span>; i &lt; n; ++i, --j)</div><div class="line">            s[i] = b[j];</div><div class="line">        FFT(<span class="literal">false</span>, s, d2);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</div><div class="line">            y[i] = d1[i] * d2[i];</div><div class="line">        &#125;</div><div class="line">        FFT(<span class="literal">true</span>, y, s);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</div><div class="line">            ret[i] = s[i].real();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">TOOL_FFT&lt;<span class="keyword">double</span>&gt; tool;</div><div class="line"></div><div class="line">Complex a[MAXN], b[MAXN];</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt; c;</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> ret[<span class="number">1048576</span>];</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> pr[<span class="number">1048576</span>] = &#123;&#125;;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> m;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">500000</span>;</div><div class="line">    <span class="keyword">for</span> (m = <span class="number">1</span>; m &lt; (N&lt;&lt;<span class="number">1</span>); m &lt;&lt;= <span class="number">1</span>);</div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">		(a + c)(b + d) - 2 * 0.5 * (a b) - 2 * 0.5 * (c * d)</span></div><div class="line"><span class="comment">		= ad + bc = area</span></div><div class="line"><span class="comment">		a, b, c, d &gt; 0,</span></div><div class="line"><span class="comment">		ways of area = #(a, b, c, d) sat. ad + bc = area</span></div><div class="line"><span class="comment">	*/</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</div><div class="line">    	<span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt;= N; j += i)</div><div class="line">    		pr[j]++;</div><div class="line">    &#125;	</div><div class="line">    </div><div class="line">    <span class="built_in">memset</span>(a, <span class="number">0</span>, <span class="keyword">sizeof</span>(a[<span class="number">0</span>]) * m);</div><div class="line">    <span class="built_in">memset</span>(b, <span class="number">0</span>, <span class="keyword">sizeof</span>(b[<span class="number">0</span>]) * m);</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</div><div class="line">        a[i] = Complex(pr[i], <span class="number">0</span>);</div><div class="line">        b[m-i] = Complex(pr[i], <span class="number">0</span>);</div><div class="line">    &#125;	</div><div class="line">    </div><div class="line">    c = tool.convolution(a, b, m);</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++)</div><div class="line">        ret[i] = (<span class="keyword">long</span> <span class="keyword">long</span>) (c[i] + <span class="number">0.5</span>);</div><div class="line">        </div><div class="line">    <span class="keyword">int</span> testcase, L, R;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase) == <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">while</span> (testcase--)	 &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;L, &amp;R);</div><div class="line">            assert(L &lt;= R);</div><div class="line">            assert(L &gt;= <span class="number">1</span> &amp;&amp; R &lt;= <span class="number">500000</span>);</div><div class="line">            <span class="keyword">int</span> mxA = L;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= R; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (ret[i] &gt; ret[mxA])</div><div class="line">                    mxA = i;</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d %lld\n"</span>, mxA, ret[mxA]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="NTT"><a href="#NTT" class="headerlink" title="NTT"></a>NTT</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;complex&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> UINT32;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> INT64;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TOOL_NTT</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN (1048576&lt;&lt;1)</span></div><div class="line">    <span class="keyword">const</span> INT64 P = (<span class="number">479</span> &lt;&lt; <span class="number">21</span>) + <span class="number">1L</span>L; <span class="comment">// prime m = kn+1</span></div><div class="line">    <span class="keyword">const</span> INT64 G = <span class="number">3</span>;</div><div class="line">    INT64 wn[<span class="number">22</span>];</div><div class="line">    INT64 s[MAXN], d1[MAXN], d2[MAXN], y[MAXN];</div><div class="line">    TOOL_NTT() &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">22</span>; i++)</div><div class="line">            wn[i] = mod_pow(G, (P<span class="number">-1</span>) / (<span class="number">1</span>&lt;&lt;i), P);</div><div class="line">    &#125;</div><div class="line">    <span class="function">INT64 <span class="title">mod_mul</span><span class="params">(INT64 a, INT64 b, INT64 mod)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (a*b - (<span class="keyword">long</span> <span class="keyword">long</span>)(a/(<span class="keyword">long</span> <span class="keyword">double</span>)mod*b+<span class="number">1e-3</span>)*mod+mod)%mod;</div><div class="line"><span class="comment">//              INT64 ret = 0;</span></div><div class="line"><span class="comment">//              for (a = a &gt;= mod ? a%mod : a, b = b &gt;= mod ? b%mod : b; b != 0; b&gt;&gt;=1, a &lt;&lt;= 1, a = a &gt;= mod ? a - mod : a) &#123;</span></div><div class="line"><span class="comment">//                  if (b&amp;1) &#123;</span></div><div class="line"><span class="comment">//                      ret += a;</span></div><div class="line"><span class="comment">//                      if (ret &gt;= mod)</span></div><div class="line"><span class="comment">//                          ret -= mod;</span></div><div class="line"><span class="comment">//                  &#125;</span></div><div class="line"><span class="comment">//              &#125;</span></div><div class="line"><span class="comment">//              return ret;</span></div><div class="line">    &#125;</div><div class="line">    <span class="function">INT64 <span class="title">mod_pow</span><span class="params">(INT64 n, INT64 e, INT64 m)</span> </span>&#123;</div><div class="line">        INT64 x = <span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span> (n = n &gt;= m ? n%m : n; e; e &gt;&gt;= <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (e&amp;<span class="number">1</span>)</div><div class="line">                x = mod_mul(x, n, m);</div><div class="line">            n = mod_mul(n, n, m);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> x;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">NumberOfBitsNeeded</span><span class="params">(<span class="keyword">int</span> PowerOfTwo)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;; ++i) &#123;</div><div class="line">            <span class="keyword">if</span> (PowerOfTwo &amp; (<span class="number">1</span> &lt;&lt; i)) &#123;</div><div class="line">                <span class="keyword">return</span> i;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> UINT32 <span class="title">FastReverseBits</span><span class="params">(UINT32 a, <span class="keyword">int</span> NumBits)</span> </span>&#123;</div><div class="line">        a = ( ( a &amp; <span class="number">0x55555555</span>U ) &lt;&lt; <span class="number">1</span> ) | ( ( a &amp; <span class="number">0xAAAAAAAA</span>U ) &gt;&gt; <span class="number">1</span> ) ;</div><div class="line">        a = ( ( a &amp; <span class="number">0x33333333</span>U ) &lt;&lt; <span class="number">2</span> ) | ( ( a &amp; <span class="number">0xCCCCCCCC</span>U ) &gt;&gt; <span class="number">2</span> ) ;</div><div class="line">        a = ( ( a &amp; <span class="number">0x0F0F0F0F</span>U ) &lt;&lt; <span class="number">4</span> ) | ( ( a &amp; <span class="number">0xF0F0F0F0</span>U ) &gt;&gt; <span class="number">4</span> ) ;</div><div class="line">        a = ( ( a &amp; <span class="number">0x00FF00FF</span>U ) &lt;&lt; <span class="number">8</span> ) | ( ( a &amp; <span class="number">0xFF00FF00</span>U ) &gt;&gt; <span class="number">8</span> ) ;</div><div class="line">        a = ( ( a &amp; <span class="number">0x0000FFFF</span>U ) &lt;&lt; <span class="number">16</span> ) | ( ( a &amp; <span class="number">0xFFFF0000</span>U ) &gt;&gt; <span class="number">16</span> ) ;</div><div class="line">        <span class="keyword">return</span> a &gt;&gt; (<span class="number">32</span> - NumBits);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">(<span class="keyword">int</span> on, INT64 *In, INT64 *Out, <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> NumBits = NumberOfBitsNeeded(n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</div><div class="line">            Out[FastReverseBits(i, NumBits)] = In[i];</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> h = <span class="number">2</span>, id = <span class="number">1</span>; h &lt;= n; h &lt;&lt;= <span class="number">1</span>, id++) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j += h) &#123;</div><div class="line">                INT64 w = <span class="number">1</span>, u, t;</div><div class="line">                <span class="keyword">int</span> block = h/<span class="number">2</span>, blockEnd = j + h/<span class="number">2</span>;</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k = j; k &lt; blockEnd; k++) &#123;</div><div class="line">                    u = Out[k], t = mod_mul(w, Out[k+block], P);</div><div class="line">                    Out[k] = u + t;</div><div class="line">                    Out[k + block] = u - t + P;</div><div class="line">                    <span class="keyword">if</span> (Out[k] &gt;= P)        Out[k] -= P;</div><div class="line">                    <span class="keyword">if</span> (Out[k+block] &gt;= P)  Out[k+block] -= P;</div><div class="line">                    w = mod_mul(w, wn[id], P);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (on == <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n/<span class="number">2</span>; i++)</div><div class="line">                swap(Out[i], Out[n-i]);</div><div class="line">            INT64 invn = mod_pow(n, P<span class="number">-2</span>, P);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">                Out[i] = mod_mul(Out[i], invn, P);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">convolution</span><span class="params">(INT64 *a, INT64 *b, <span class="keyword">int</span> n, INT64 *c)</span> </span>&#123;</div><div class="line">        NTT(<span class="number">0</span>, a, d1, n);</div><div class="line">        s[<span class="number">0</span>] = b[<span class="number">0</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i)</div><div class="line">            s[i] = b[n-i];</div><div class="line">        NTT(<span class="number">0</span>, s, d2, n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            s[i] = mod_mul(d1[i], d2[i], P);</div><div class="line">        NTT(<span class="number">1</span>, s, c, n);</div><div class="line">    &#125;</div><div class="line">&#125; tool;</div><div class="line"></div><div class="line">INT64 a[MAXN], b[MAXN], c[MAXN];</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> ret[<span class="number">1048576</span>];</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> pr[<span class="number">1048576</span>] = &#123;&#125;;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> m;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">500000</span>;</div><div class="line">    <span class="keyword">for</span> (m = <span class="number">1</span>; m &lt; (N&lt;&lt;<span class="number">1</span>); m &lt;&lt;= <span class="number">1</span>);</div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">		(a + c)(b + d) - 2 * 0.5 * (a b) - 2 * 0.5 * (c * d)</span></div><div class="line"><span class="comment">		= ad + bc = area</span></div><div class="line"><span class="comment">		a, b, c, d &gt; 0,</span></div><div class="line"><span class="comment">		ways of area = #(a, b, c, d) sat. ad + bc = area</span></div><div class="line"><span class="comment">	*/</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</div><div class="line">    	<span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt;= N; j += i)</div><div class="line">    		pr[j]++;</div><div class="line">    &#125;	</div><div class="line">    </div><div class="line">    <span class="built_in">memset</span>(a, <span class="number">0</span>, <span class="keyword">sizeof</span>(a[<span class="number">0</span>]) * m);</div><div class="line">    <span class="built_in">memset</span>(b, <span class="number">0</span>, <span class="keyword">sizeof</span>(b[<span class="number">0</span>]) * m);</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</div><div class="line">        a[i] = pr[i];</div><div class="line">        b[m-i] = pr[i];</div><div class="line">    &#125;	</div><div class="line">    </div><div class="line">    tool.convolution(a, b, m, c);</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++)</div><div class="line">        ret[i] = c[i];</div><div class="line">        </div><div class="line">    <span class="keyword">int</span> testcase, L, R;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase) == <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">while</span> (testcase--)	 &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;L, &amp;R);</div><div class="line">            assert(L &lt;= R);</div><div class="line">            assert(L &gt;= <span class="number">1</span> &amp;&amp; R &lt;= <span class="number">500000</span>);</div><div class="line">            <span class="keyword">int</span> mxA = L;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = L; i &lt;= R; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (ret[i] &gt; ret[mxA])</div><div class="line">                    mxA = i;</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d %lld\n"</span>, mxA, ret[mxA]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-uva-801" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/30/uva-801/" class="article-date">
  <time datetime="2016-04-30T03:31:48.000Z" itemprop="datePublished">2016-04-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/30/uva-801/">UVa 801 - Flight Planning</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/04/30/uva-801/" data-id="ckgyo55tq00we3cvr89eodsl8" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/04/30/uva-801/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dp/">dp</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>給予飛機在平流層飛行資訊，在每一種高度下維持飛行的耗油量成線性關係，以及每一段飛行旅程上的平流層的風速為何，藉由線性內插得到在某高度下的飛行速度，忽略在轉換高度時的耗油量，問從起點到終點的最少耗油量為何 (無條件進位)。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">2</div><div class="line">2</div><div class="line">1500 -50 50</div><div class="line">1000 0 0</div><div class="line">3</div><div class="line">1000 50 0</div><div class="line">2000 0 20</div><div class="line">1800 50 100</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Flight 1: 35 30 13986</div><div class="line">Flight 2: 20 30 30 23502</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>單源最短路徑，只是每一點要使用 $20$ 個狀態維護抵達那一層時在哪一種高度下飛行。必須窮舉轉移到下一層的所有高度，因為有可能飛行慢而增加耗油時間。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Leg</span> &#123;</span></div><div class="line">    <span class="keyword">double</span> mile, f20, f40;</div><div class="line">&#125; legs[<span class="number">1024</span>];</div><div class="line"><span class="keyword">const</span> <span class="keyword">double</span> VCRUISE = <span class="number">400</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">double</span> AOPT = <span class="number">30000</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">double</span> GPHOPT = <span class="number">2000</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">double</span> GPHEXTRA = <span class="number">10</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">double</span> CLIMBCOST = <span class="number">50</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1024</span>;	<span class="comment">// maximum #legs</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXH = <span class="number">45</span>;	<span class="comment">// between 20,000 and 40,000 feet</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">double</span> DINF = <span class="number">1e+20</span>;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">inter</span><span class="params">(Leg a, <span class="keyword">double</span> h)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> a.f20 + (a.f40 - a.f20) * (h - <span class="number">20000</span>) / (<span class="number">40000</span> - <span class="number">20000</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">double</span> dp[MAXN][MAXH];</div><div class="line">    <span class="keyword">int</span> from[MAXN][MAXH];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= <span class="number">40</span>; j++)</div><div class="line">            dp[i][j] = DINF;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;	<span class="comment">// leg 0: altitude 0</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= <span class="number">40</span>; j++) &#123;</div><div class="line">            <span class="keyword">if</span> (dp[i][j] &gt;= DINF)</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            <span class="keyword">double</span> alti_a = j * <span class="number">1000.f</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">20</span>; k &lt;= <span class="number">40</span>; k++) &#123;</div><div class="line">                <span class="keyword">double</span> cc = <span class="number">0</span>, alti_b;</div><div class="line">                alti_b = k * <span class="number">1000.f</span>;</div><div class="line">                </div><div class="line">                <span class="keyword">if</span> (alti_b &gt; alti_a)</div><div class="line">                    cc += CLIMBCOST * (alti_b - alti_a) / <span class="number">1000.f</span>;</div><div class="line">                <span class="keyword">double</span> v = VCRUISE + inter(legs[i+<span class="number">1</span>], alti_b);</div><div class="line">                <span class="keyword">if</span> (v &lt;= <span class="number">0</span>)</div><div class="line">                	<span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">double</span> c = <span class="built_in">fabs</span>(alti_b - AOPT) * GPHEXTRA / <span class="number">1000.f</span> + GPHOPT;</div><div class="line">                cc += c * legs[i+<span class="number">1</span>].mile / v;</div><div class="line">                <span class="keyword">if</span> (dp[i][j] + cc &lt; dp[i+<span class="number">1</span>][k])</div><div class="line">                    dp[i+<span class="number">1</span>][k] = dp[i][j] + cc, from[i+<span class="number">1</span>][k] = j;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">double</span> ret = DINF;</div><div class="line">    <span class="keyword">int</span> last = <span class="number">-1</span>;</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; solution;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">20</span>; i &lt;= <span class="number">40</span>; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (dp[n][i] &lt; ret)</div><div class="line">            ret = dp[n][i], last = i;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt; <span class="number">0</span>; i--) &#123;</div><div class="line">        solution.push_back(last);</div><div class="line">        last = from[i][last];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--)</div><div class="line">        <span class="built_in">printf</span>(<span class="string">" %d"</span>, solution[i]);</div><div class="line">    <span class="comment">// tricky </span></div><div class="line">    <span class="built_in">printf</span>(<span class="string">" %.0lf\n"</span>, <span class="built_in">ceil</span>(ret));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> n;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%lf %lf %lf"</span>,</div><div class="line">                  &amp;legs[i].mile, &amp;legs[i].f20, &amp;legs[i].f40);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Flight %d:"</span>, ++cases);</div><div class="line">        solve(n);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/9/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/83/">83</a><a class="extend next" rel="next" href="/page/11/">Next &raquo;</a>
    </nav>
  
</section>
          
          
            <aside id="sidebar">
  <!-- <div id="ukagaka_panel"></div> -->
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">115</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算機圖學/">計算機圖學</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/">工作應用</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/可持久化/">可持久化</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/鬼故事/">鬼故事</a><span class="category-list-count">6</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">633</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">483</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">77</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">45</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2020/10/31/lesson/ada-2020-hw1-p3/">
              
                <i class="icon-file-o"></i> 
              
            ADA 2020 Fall P3. ADA Party</a>
          </li>
        
          <li>
            <a class="text" href="/2020/10/31/lesson/ada-2020-hw1-p2/">
              
                <i class="icon-file-o"></i> 
              
            ADA 2020 Fall P2. Bomb Game</a>
          </li>
        
          <li>
            <a class="text" href="/2020/10/25/diary-202010/">
              
                <i class="icon-file-o"></i> 
              
            資訊科學的偏科生 面試者篇</a>
          </li>
        
          <li>
            <a class="text" href="/2020/10/24/work/company-ghost-story-6/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 6</a>
          </li>
        
          <li>
            <a class="text" href="/2020/09/30/work/company-ghost-story-5/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 5</a>
          </li>
        
          <li>
            <a class="text" href="/2020/09/26/work/company-ghost-story-4/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 4</a>
          </li>
        
          <li>
            <a class="text" href="/2020/09/20/java/java-stream/">
              
                <i class="icon-file-o"></i> 
              
            為什麼不推薦用 Java Stream 改寫迴圈</a>
          </li>
        
          <li>
            <a class="text" href="/2020/09/20/work/company-ghost-story-3/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 3</a>
          </li>
        
          <li>
            <a class="text" href="/2020/09/13/work/company-ghost-story-2/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 2</a>
          </li>
        
          <li>
            <a class="text" href="/2020/09/13/work/company-ghost-story-1/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 1</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
<script type="text/javascript">
  $('#ukagaka_panel').ukagaka();
</script>
  
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2020 Shiang-Yun Yang 
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>