<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Morris&#39; Blog">
<meta property="og:url" content="http://morris821028.github.io/page/54/index.html">
<meta property="og:site_name" content="Morris&#39; Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris&#39; Blog">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
  <!-- <link rel="import" href="/bower_components/app-layout/app-layout.html"> --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          
          <section id="main">
  
    <article id="post-oj/uva/uva-12607" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/26/oj/uva/uva-12607/" class="article-date">
  <time datetime="2014-10-26T09:00:21.000Z" itemprop="datePublished">2014-10-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/26/oj/uva/uva-12607/">UVa 12607 - Amazing Maze</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/10/26/oj/uva/uva-12607/" data-id="ckq8np16l03701wvnj8q8jzt9" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/10/26/oj/uva/uva-12607/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bfs/">bfs</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>在一個迷宮中有 M x N 個房間，每個房間有四個門，並且以逆時針的順序依次出現，每一個時間每個房間只會有一個門通往另一個地方。</p>
<p>必須從左上角開始，花最少時間收集到 K 個寶物後抵達右下角。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">2 2</div><div class="line">EE</div><div class="line">NN</div><div class="line">1</div><div class="line">1 2</div><div class="line">0 0</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>分析狀態，由於 K 不大，直接 2^K 狀態下去，而只會有四個門，因此時間論替只需要考慮 mod 4 的結果，最後 <code>dist[x][y][4][1&lt;&lt;8]</code> 抵達 (x, y) 時的門狀態、同時身上帶了多少寶物 (用 bitmask 去壓縮)。</p>
<p>BFS 一下就過去，記得要注意可以在同一個房間內等待下一個時刻。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> dx[] = &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>&#125;; <span class="comment">// N E S W </span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> dy[] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;;</div><div class="line"><span class="keyword">int</span> used[<span class="number">100</span>][<span class="number">100</span>][<span class="number">4</span>][<span class="number">1</span>&lt;&lt;<span class="number">8</span>] = &#123;&#125;, testcase = <span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> dist[<span class="number">100</span>][<span class="number">100</span>][<span class="number">4</span>][<span class="number">1</span>&lt;&lt;<span class="number">8</span>] = &#123;&#125;;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N, M, K, x, y;</div><div class="line">    <span class="keyword">char</span> g[<span class="number">128</span>][<span class="number">128</span>];</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;N, &amp;M) == <span class="number">2</span> &amp;&amp; N+M) &#123;</div><div class="line">        <span class="keyword">int</span> treasure[<span class="number">128</span>][<span class="number">128</span>] = &#123;&#125;, dirg[<span class="number">128</span>][<span class="number">128</span>] = &#123;&#125;;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>, g[i]);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; M; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (g[i][j] == <span class="string">'N'</span>)</div><div class="line">                    dirg[i][j] = <span class="number">0</span>;			</div><div class="line">                <span class="keyword">if</span> (g[i][j] == <span class="string">'E'</span>)</div><div class="line">                    dirg[i][j] = <span class="number">1</span>;	</div><div class="line">                <span class="keyword">if</span> (g[i][j] == <span class="string">'S'</span>)</div><div class="line">                    dirg[i][j] = <span class="number">2</span>;	</div><div class="line">                <span class="keyword">if</span> (g[i][j] == <span class="string">'W'</span>)</div><div class="line">                    dirg[i][j] = <span class="number">3</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;K);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; K; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;x, &amp;y);</div><div class="line">            x--, y--;</div><div class="line">            assert(treasure[x][y] == <span class="number">0</span>);</div><div class="line">            treasure[x][y] = i + <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; X, Y, D, T;</div><div class="line">        <span class="keyword">int</span> x = <span class="number">0</span>, y = <span class="number">0</span>, d = <span class="number">0</span>, t = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> tx, ty, td, tt;</div><div class="line">        <span class="keyword">if</span> (treasure[x][y])</div><div class="line">            t |= <span class="number">1</span>&lt;&lt;(treasure[x][y] - <span class="number">1</span>);</div><div class="line">        X.push(x), Y.push(y), D.push(d), T.push(t);</div><div class="line">        testcase++;</div><div class="line">        used[x][y][d][t] = testcase;</div><div class="line">        dist[x][y][d][t] = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (!X.empty()) &#123;</div><div class="line">            x = X.front(), X.pop();</div><div class="line">            y = Y.front(), Y.pop();</div><div class="line">            d = D.front(), D.pop();</div><div class="line">            t = T.front(), T.pop();	</div><div class="line">                    </div><div class="line">            tx = x, ty = y, td = (d + <span class="number">1</span>)%<span class="number">4</span>, tt = t;</div><div class="line">            <span class="keyword">if</span> (used[tx][ty][td][tt] != testcase) &#123;</div><div class="line">                used[tx][ty][td][tt] = testcase;</div><div class="line">                dist[tx][ty][td][tt] = dist[x][y][d][t] + <span class="number">1</span>;</div><div class="line">                X.push(tx), Y.push(ty), D.push(td), T.push(tt);</div><div class="line">                <span class="keyword">if</span> (tx == N - <span class="number">1</span> &amp;&amp; ty == M - <span class="number">1</span> &amp;&amp; tt == (<span class="number">1</span>&lt;&lt;K) - <span class="number">1</span>)</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            <span class="keyword">int</span> dir = (dirg[x][y] + d)%<span class="number">4</span>;</div><div class="line">            tx = x + dx[dir], ty = y + dy[dir], td = (d + <span class="number">1</span>)%<span class="number">4</span>, tt = t;</div><div class="line">            <span class="keyword">if</span> (tx &lt; <span class="number">0</span> || ty &lt; <span class="number">0</span> || tx &gt;= N || ty &gt;= M)</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            <span class="keyword">if</span> (treasure[tx][ty])</div><div class="line">                tt |= <span class="number">1</span>&lt;&lt;(treasure[tx][ty] - <span class="number">1</span>);</div><div class="line">            <span class="keyword">if</span> (used[tx][ty][td][tt] != testcase) &#123;</div><div class="line">                used[tx][ty][td][tt] = testcase;</div><div class="line">                dist[tx][ty][td][tt] = dist[x][y][d][t] + <span class="number">1</span>;</div><div class="line">                X.push(tx), Y.push(ty), D.push(td), T.push(tt);</div><div class="line">                <span class="keyword">if</span> (tx == N - <span class="number">1</span> &amp;&amp; ty == M - <span class="number">1</span> &amp;&amp; tt == (<span class="number">1</span>&lt;&lt;K) - <span class="number">1</span>)</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0x3f3f3f3f</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (used[N<span class="number">-1</span>][M<span class="number">-1</span>][i][(<span class="number">1</span>&lt;&lt;K)<span class="number">-1</span>] == testcase)</div><div class="line">                ret = min(ret, dist[N<span class="number">-1</span>][M<span class="number">-1</span>][i][(<span class="number">1</span>&lt;&lt;K)<span class="number">-1</span>]);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">2 2</span></div><div class="line"><span class="comment">EE</span></div><div class="line"><span class="comment">NN</span></div><div class="line"><span class="comment">1</span></div><div class="line"><span class="comment">1 2</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">1 1</span></div><div class="line"><span class="comment">E</span></div><div class="line"><span class="comment">1</span></div><div class="line"><span class="comment">1 1</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">1 2</span></div><div class="line"><span class="comment">NE</span></div><div class="line"><span class="comment">1</span></div><div class="line"><span class="comment">1 2</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">0 0</span></div><div class="line"><span class="comment">*/</span></div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/geometry-mid" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/26/lesson/geometry-mid/" class="article-date">
  <time datetime="2014-10-26T01:15:32.000Z" itemprop="datePublished">2014-10-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/計算幾何/">計算幾何</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/26/lesson/geometry-mid/">計算幾何 - 期中考練習</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/10/26/lesson/geometry-mid/" data-id="ckq8np0g802dz1wvnz5eo4l7g" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/10/26/lesson/geometry-mid/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/計算幾何/">計算幾何</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <ol>
<li>(15 points total)<br>a.    (10 points) Given a set of points that are presorted by their x-coordinate value, provide an algorithm that computes the convex hull of these points in O(n).<br>b.    (5 points) If more than 2 points are possibly on an edge of convex hull, explain briefly how your algorithm handles this case.</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">int cross(Pt o, Pt a, Pt b) &#123;</div><div class="line">    return (a.x-o.x)*(b.y-o.y)-(a.y-o.y)*(b.x-o.x);</div><div class="line">&#125;</div><div class="line">int monotone(int n, Pt p[], Pt ch[]) &#123;</div><div class="line">    sort(p, p+n);</div><div class="line">    int i, m = 0, t;</div><div class="line">    for(i = 0; i &lt; n; i++) </div><div class="line">        while(m &gt;= 2 &amp;&amp; cross(ch[m-2], ch[m-1], p[i]) &lt;= 0)</div><div class="line">            m--;</div><div class="line">        ch[m++] = p[i];</div><div class="line">    for(i = n-1, t = m+1; i &gt;= 0; i--) </div><div class="line">        while(m &gt;= t &amp;&amp; cross(ch[m-2], ch[m-1], p[i]) &lt;= 0)</div><div class="line">            m--;</div><div class="line">        ch[m++] = p[i];</div><div class="line">    return m - 1;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>會將三點一線段的中間那一點替除掉，直到一個線段上只經過兩個點。</p>
<ol>
<li>(20 points total)<br>a.    (5 points) What are the types of event points in the plane sweep algorithm for line segment intersection problem?<br>b.    (10 points) Explain briefly when each type of event points is inserted to the event queue. Create a simple example (with 2 line segments) to demonstrate how it works.<br>c.    (5 points) When will the plane sweep algorithm for line segment intersection problem not suitable? Give a quantitative answer (i.e., describe your answer by using the Big-O notations). In addition, why is applying plane sweep algorithm on subdivision overlay in general a good idea?    </li>
</ol>
<hr>
<ul>
<li>掃描時遇到的三種情況<ol>
<li>碰到開始的左端點 (加入此線段)</li>
<li>碰到結束的右端點 (移除此線段)</li>
<li>碰到線段之間的交點 (預測下個最近的相交點後，將其包含這個交點線段移除後，重新加入)</li>
</ol>
</li>
<li>很簡單的，請參考上述三種情況繪製。</li>
<li>當交集的數量在<span>$\Theta(n^{2})$</span><!-- Has MathJax --> 的時候，複雜度是<span>$\Theta(n^{2}log n)$</span><!-- Has MathJax -->，還不如直接窮舉任兩個線段計算交點<span>$\Theta(n^{2})$</span><!-- Has MathJax -->，就算要去重複，常數也比掃描線算法來得低。</li>
</ul>
<ol>
<li>(20 points total)<br>a.    (10 points) Draw a simple polygon with 4 different types of vertices. Mark each vertex with its type. In addition, which two out of these 4 types are NOT allowed in a y-monotone piece?<br>b.    (5 points) Mark the “helper” for each of the vertices in your part (a) simple polygon that are not allowed in a y-monotone piece.<br>c.    (5 points) The triangulation of a y-monotone piece (with n vertices) can be done in linear time. Explain briefly why.</li>
</ol>
<hr>
<ul>
<li>start, split, end, merge, regular vertex 明明有五種！</li>
<li>split, merge vertex 不符合 y-monotone piece</li>
<li>加入 helper，對於 split 而言要往下找 split 或者是 regular vertex 相連，對 merge 而言要往上找 merge 或者是 regular 相連。</li>
<li>因為往左可以根據維護凹性在 O(n) 時間內完成三角化，同理往右走訪。</li>
</ul>
<ol>
<li>(20 points total)<br>a.    (5 points) What is the worst-case time complexity for the algorithm that solves the 2-dimensional linear programming problem?<br>b.    (5 points) Simplex algorithm is known to solve the linear programming problem in Operational Research. Why don’t we simple apply Simplex algorithm for the 2-dimensional linear programming problem?<br>c.    (10 points) Let (H, c) be a linear program. We number the half-planes h1, h2,…, hn. Let Hi be the set of the first i constraints, together with the special constraints m1 and m2 (i.e., the bound so that the solution space is limited). Let vi be the optimal point in Hi that satisfies the constraints. Explain why vi = vi-1 if vi-1 is contained in hi.</li>
</ol>
<hr>
<p>*<span>$O(n^{2})$</span><!-- Has MathJax --> incremental LP problem，每加入一個半平面，都必須重新計算最佳交集。</p>
<ul>
<li>Simplex algorithm O(n log n)，在 2D 限制下，可以做到 O(n)。</li>
<li>其實這是一個廢話，因為 hi 加上去，只會讓最佳解更糟，如果最佳解沒變，那麼最佳解仍然維持。</li>
</ul>
<ol>
<li>(15 points total)<br>a.     (10 points) Briefly explain what a “split node” is. Create a balanced one-dimensional search tree with 8 leave nodes to be “1”, “2”, “3”, “4”, “5”, “6”, “7”, and “8”, and a range query [2, 6] to show where the split node is and how it helps to find all numbers in the range.<br>b.    (5 points) Both kd-trees and range trees are designed to do range query. Give one scenario that the kd-trees should be used and another scenario that the range trees should be adopted.</li>
</ol>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">           [4]</div><div class="line">          /   \</div><div class="line">         /     \</div><div class="line">        /       \</div><div class="line">     [2]        [6]</div><div class="line">    /   \       / \</div><div class="line">  [1]  [3]    [5]  \</div><div class="line">  /\    /\     /\   \</div><div class="line">[1][2][3][4] [5][6] [7]</div></pre></td></tr></table></figure>
<p>找到其中一邊的 split node 的寫法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">v = root</div><div class="line">while v is not leaf &amp;&amp; (r &lt;= xv || xv&apos; &gt; l)</div><div class="line">    if l &lt;= xv&apos;</div><div class="line">        v = lc(v)</div><div class="line">    else</div><div class="line">        v = rc(v)</div></pre></td></tr></table></figure>
<p>最後我們找到兩個 <code>split node [1], [7]</code>，在兩個 split node 之間的葉節點都是答案，對於葉節點可以利用建造時，使用一個 linked list 去完成。</p>
<ul>
<li>對於多維度範圍查找用 range tree 最好，可以保證在<span>$O(log^{d} n)$</span><!-- Has MathJax --> 以內找到解，kd-tree 在這種情況很容易退化。</li>
<li>對於最鄰近點搜索則是使用 kd-tree 最好，range tree 反而沒辦法支持這種操作。</li>
</ul>
<ol>
<li>(20 points)<br>a.    (5 points) Draw the trapezoidal map of the following given figure. Note that the bounding box is provided already. (Give each trapezoid a number, which will be used in part (b).)<br>b.    (10 points) Follow the algorithm to construct the search structure D for the trapezoidal map in part a). The segments are inserted in the order of s4, s3, s2, and s1.<br>c.    (5 points) In the trapezoidal algorithm, the endpoints of line segments are assumed to have different x-coordinate value (i.e., so-called general position). While a method was provided to relax this constraint, explain briefly why the composite-number method (i.e., transform (x, y) to (x|y, y|x)) which has been used in kd-trees and range trees to deal with the similar constraint was not adopted?</li>
</ol>
<hr>
<ul>
<li>因為它們是 range query，對於相同的 x 值仍然要算相同，利用偏斜的效果不利於操作。</li>
</ul>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/geometry-hw3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/26/lesson/geometry-hw3/" class="article-date">
  <time datetime="2014-10-25T22:49:32.000Z" itemprop="datePublished">2014-10-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/計算幾何/">計算幾何</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/26/lesson/geometry-hw3/">計算幾何 - HW03</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/10/26/lesson/geometry-hw3/" data-id="ckq8np0i702gq1wvnccdbd8ay" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/10/26/lesson/geometry-hw3/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/計算幾何/">計算幾何</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Master-Theorem"><a href="#Master-Theorem" class="headerlink" title="Master Theorem"></a>Master Theorem</h2><span>$$T(n) = 
\begin{cases}
aT(n/b) + n^{c} &amp; \text{ if } n &gt; 1 \\
d &amp; \text{ if } n = 1
\end{cases}$$</span><!-- Has MathJax -->
<p>1.<span>$\text{if } log_{b}a &lt; c, T(n) = \theta(n^{c})$</span><!-- Has MathJax --><br>2.<span>$\text{if } log_{b}a = c, T(n) = \theta(n^{c} log n)$</span><!-- Has MathJax --><br>3.<span>$\text{if } log_{b}a &gt; c, T(n) = \theta(n^{log_{b}a})$</span><!-- Has MathJax --></p>
<h2 id="Extend-Master-Theorem"><a href="#Extend-Master-Theorem" class="headerlink" title="Extend Master Theorem"></a>Extend Master Theorem</h2><span>$$T(n) = 
\begin{cases}
aT(n/b) + f(n) &amp; \text{ if } n &gt; 1 \\
d &amp; \text{ if } n = 1
\end{cases} \\

E = log_{b}(a)$$</span><!-- Has MathJax -->
<p>1.<span>$\text{if } f(n) = O(n^{E} (log_{b}n)^{\alpha} ) \text{ and } \alpha &lt; -1, T(n) = \theta(n^{E})$</span><!-- Has MathJax --><br>2.<span>$\text{if } f(n) = O(n^{E} (log_{b}n)^{\alpha} ) \text{ and } \alpha = -1, T(n) = \theta(n^{E} log_{b} log_{b}(n))$</span><!-- Has MathJax --><br>3.<span>$\text{if } f(n) = O(n^{E} (log_{b}n)^{\alpha} ) \text{ and } \alpha &gt; -1, T(n) = \theta(n^{E}(log_{b}n)^{\alpha + 1})$</span><!-- Has MathJax --></p>
<h1 id="Chapter-5"><a href="#Chapter-5" class="headerlink" title="Chapter 5"></a>Chapter 5</h1><h2 id="5-1"><a href="#5-1" class="headerlink" title="5.1"></a>5.1</h2><p>In the proof of the query time of the kd-tree we found the following<br>recurrence:<br><span>$$Q(n) = 
\begin{cases}
O(1) &amp; \text{ if } n = 1 \\
2 + 2Q(n/4)&amp; \text{ if } n &gt; 1
\end{cases}$$</span><!-- Has MathJax --><br>Prove that this recurrence solves to Q(n) = O(√n). Also show that Ω(√n) is a lower bound for querying in a kd-tree by defining a set of n points and a query rectangle appropriately.</p>
<hr>
<ol>
<li>by master theorem,<span>$a = 2, b = 4, c = 0 \Rightarrow Q(n) = \Theta(\sqrt{n})$</span><!-- Has MathJax --><br>2.<span>$\Omega(\sqrt{n})$</span><!-- Has MathJax --> 是 kd-tree 的 lower_bound。如果 + 號存在的行都一直被執行，另外 - 號行都不會被執行，那麼複雜度就會達到<span>$\Omega(\sqrt{n})$</span><!-- Has MathJax -->，要明白如何加上 report 則會更慢，必須將包含的點依序回報。找一個不包含所有點的細長矩形於正中央即可，每次循環切割到 x 時，保證會留下 n/4 個節點。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Algorithm: SEARCHKDTREE(v, R) </div><div class="line">if v is leaf</div><div class="line">    report the points stored at v if it lies in R.</div><div class="line">else</div><div class="line">-	if region(lc(v)) contains R</div><div class="line">        report subtree lc(v)</div><div class="line">+	else if lc(v) intersects R</div><div class="line">        SEARCHKDTREE(lc(v), R)</div><div class="line">  </div><div class="line">-	if region(rc(v)) contains R</div><div class="line">        report subtree rc(v)</div><div class="line">+ 	else if rc(v) intersects R</div><div class="line">        SEARCHKDTREE(rc(v), R)</div></pre></td></tr></table></figure>  
<h2 id="5-3"><a href="#5-3" class="headerlink" title="5.3"></a>5.3</h2><p>In Section 5.2 it was indicated that kd-trees can also be used to store sets of points in higher-dimensional space. Let P be a set of n points in d-dimensional space. In parts a. and b. you may consider d to be a constant.</p>
<ol>
<li>Describe an algorithm to construct a d-dimensional kd-tree for the points in P. Prove that the tree uses linear storage and that your algorithm takes<span>$O(n log n)$</span><!-- Has MathJax --> time.</li>
<li>Describe the query algorithm for performing a d-dimensional range query. Prove that the query time is bounded by<span>$O(n^{1&minus;1/d} +k)$</span><!-- Has MathJax -->.</li>
<li>Show that the dependence on d in the amount of storage is linear, that is, show that the amount of storage is<span>$O(dn)$</span><!-- Has MathJax --> if we do not consider d to be a constant. Give the dependence on d of the construction time and the query time as well.</li>
</ol>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Algorithm : build(int k, int l, int r, int dep)</div><div class="line">    if l &gt; r</div><div class="line">        return NULL</div><div class="line">    m = (l + r)/2</div><div class="line">    Node ret = median axis[k%K] of point[l, r] ----- O(n)</div><div class="line">    split points[l, r] by median               ----- O(n), C++ std::nth_element()</div><div class="line">    ret.lson = build((k+1)%K, l, m-1);</div><div class="line">    ret.rson = build((k+1)%K, m+1, r);</div><div class="line">    return ret;</div></pre></td></tr></table></figure>
<ol>
<li>利用 median of medians 算法找到中位數，數據儲存用指針來完成搜索，不用移動資料。<br>以上代碼根據遞迴公式<span>$T(n) = 2T(n/2) + O(n) \Rightarrow T(n) = \Theta(n log n)$</span><!-- Has MathJax -->，而 kd-tree 是一個 full binary tree，每一個節點都代表一個實際資料，因此空間複雜度<span>$O(n)$</span><!-- Has MathJax --> </li>
<li>假設在 d 為空間，Q(n) 表示 n 個點的詢問，依序按照維度切割 (ex. x, y, z, x …)，現在只關注 x 軸上的切割，假設詢問範圍包含所有的 y, z，那麼在 2ed x 節點中，每一個節點具有<span>$n/2^{d}$</span><!-- Has MathJax --> 資料，而同一層會有<span>$2^{d-1}$</span><!-- Has MathJax --> 個 x 維度的子節點。然後遞迴詢問<span>$2^{d-1}$</span><!-- Has MathJax --> 所包含的範圍查找。<br>藉由 master theorem,<span>$a = 2^{d-1}, b = 2^{d}, c = 0 \Rightarrow Q(n) = \Theta(n^{1 - 1/d})$</span><!-- Has MathJax -->  <span>$$Q(n) =
\begin{cases}
O(1) &amp; \text{ if } n &lt; 2^{d} \\
2^{d-1} + 2^{d-1} Q(n/2^{d}) &amp; \text{ if } n \geq 2^{d}
\end{cases}$$</span><!-- Has MathJax --></li>
<li>如果 d 不是常數，每一個內部節點空間 O(d)，有 n 個節點則需 O(dn) 的儲存空間。詢問上，需要在 intersected 花 O(d) 時間決定是否存在交集、包含，再來判斷是否走訪子樹，因此詢問是<span>$2dQ(n) = O(dn^{1-1/d})$</span><!-- Has MathJax -->，加上回報的效率為<span>$2dQ(n) = O(dn^{1-1/d} + k)$</span><!-- Has MathJax -->。</li>
</ol>
<h2 id="5-5"><a href="#5-5" class="headerlink" title="5.5"></a>5.5</h2><p>Algorithm SEARCHKDTREE can also be used when querying with other ranges than rectangles. For example, a query is answered correctly if the range is a triangle.</p>
<p>a. Show that the query time for range queries with triangles is linear in the worst case, even if no answers are reported at all. Hint: Choose all points to be stored in the kd-tree on the line y = x.<br>b. Suppose that a data structure is needed that can answer triangular range queries, but only for triangles whose edges are horizontal, vertical, or have slope +1 or −1. Develop a linear size data structure that answers such range queries in O(n3/4+k) time, where k is the number of points reported. Hint: Choose 4 coordinate axes in the plane and use a 4-dimensional kd-tree.<br>c. Improve the query time to O(n2/3+k). Hint: Solve Exercise 5.4 first.</p>
<hr>
<ol>
<li>最慘情況是 O(n)－詢問範圍為三角形。<br>詢問的範圍如圖，所有點落在 y = x 上，三角形範圍是一個很貼近 y = x 的三角形，三角形並沒有包含任何一個點，卻與所有劃分的區域有交集，因此必須走訪所有節點。</li>
<li>如果要支持三角形範圍查找 (三角形的邊要不垂直、平行、斜率 +1、斜率 -1)。找到一個詢問<span>$O(n^{3/4} + k)$</span><!-- Has MathJax --> 的資料結構。<br>類似 kd-tree，但是輪替的標準為 <strong> x 軸 </strong>、<strong> y 軸 </strong>、<strong> 斜率 1 </strong>、<strong> 斜率 -1 </strong>，根據 5.3(b) 的公式，相當於 d = 4 的情況，得到<span>$O(n^{1 - 1/4} + k) = O(n^{3/4} + k)$</span><!-- Has MathJax -->。</li>
<li>加快到<span>$O(n^{2/3} + k)$</span><!-- Has MathJax --> 的詢問時間。<br>在這裡想到是建立兩個 kd-tree，其中一個順序為 <strong> x 軸 </strong>、<strong> 斜率 1 </strong>、<strong> 斜率 -1 </strong>，另一個順序為 <strong> y 軸 </strong>、<strong> 斜率 1 </strong>、<strong> 斜率 -1 </strong>。前者可以回答向上、向下三角形，後者回答向左、向右三角形。相當於 d = 3 的切割，最多拆成 4 個範圍查找<span>$O(4n^{1 - 1/3} + k) = O(n^{2/3} + k)$</span><!-- Has MathJax -->。<ol>
<li>在詢問矩形時，拆成四個三角形查找 (向上、向下、向左、向右三角形)</li>
<li>在詢問三角形時，拆成兩個三角形查找</li>
</ol>
</li>
</ol>
<h2 id="5-9"><a href="#5-9" class="headerlink" title="5.9"></a>5.9</h2><p>One can use the data structures described in this chapter to determine whether a particular point (a,b) is in a given set by performing a range query with range [a : a]×[b : b]. </p>
<ol>
<li>Prove that performing such a range query on a kd-tree takes time O(logn).</li>
<li>What is the time bound for such a query on a range tree? Prove your answer.</li>
</ol>
<hr>
<ol>
<li>對於 kd-tree 所消耗的時間 O(log n) 說明。  <span>$[a:a] \times [b:b]$</span><!-- Has MathJax --> 並不會跨區間。在 SEARCHKDTREE(v, R) 函數中，Line SEARCHKDTREE(lc(v), R) 和 SEARCHKDTREE(rc(v), R) 只會有一個符合。<span>$$Q(n) =
\begin{cases}
O(1) &amp; \text{ if } n = 1 \\
1 + Q(n/2) &amp; \text{ if } n &gt; 1
\end{cases}$$</span><!-- Has MathJax --></li>
<li>對於 kd-tree 所消耗的時間 O(d log n) 說明。<br>首先能知道會先在第一維度探訪<span>$[a:a]$</span><!-- Has MathJax --> 的葉節點，中間經過 log n 個節點最後到葉節點，然後在其相對應的 y 軸 tree 中查找<span>$[b:b]$</span><!-- Has MathJax --> 也是 log n。因此是<span>$O(\sum{i = 1}^{d} log n) = O(d log n)$</span><!-- Has MathJax --></li>
</ol>
<h2 id="5-11"><a href="#5-11" class="headerlink" title="5.11"></a>5.11</h2><p>Let S1 be a set of n disjoint horizontal line segments and let S2 be a set<br>of m disjoint vertical line segments. Give a plane-sweep algorithm that<br>counts in O((n+m) log(n+m)) time how many intersections there are<br>in S1 ∪ S2.</p>
<hr>
<p>給 n 個不相交的水平線段、m 個不相交的垂直線段，在 O((n+m) log (n+m)) 的時間內找到焦點個數。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Algorithm:</div><div class="line">    1. sort all x-coordinate ----- O((n+m) log (n+m))</div><div class="line">    2. sweep x from small to large, maintain a segment tree or range tree.</div><div class="line"></div><div class="line">    for x = -oo to oo</div><div class="line">        for each horizontal line (sx, y)-(ex, y) in x</div><div class="line">            if sx = x</div><div class="line">                1Drangetree.add(y) 				----- O(log (n+m))</div><div class="line">        for each vertical line (x, sy)-(x, ey) in x</div><div class="line">            ret += 1Drangetree.query(sy, ey) 	----- O(log (n+m))</div><div class="line">        for each horizontal line (sx, y)-(ex, y) in x</div><div class="line">            if ex = x</div><div class="line">                1Drangetree.remove(y) 			----- O(log (n+m))</div><div class="line">    return ret</div></pre></td></tr></table></figure>
<h1 id="Chapter-6"><a href="#Chapter-6" class="headerlink" title="Chapter 6"></a>Chapter 6</h1><h2 id="6-1"><a href="#6-1" class="headerlink" title="6.1"></a>6.1</h2><p>Draw the graph of the search structure D for the set of segments depicted<br>in the margin, for some insertion order of the segments.</p>
<hr>
<p>雖然沒有加入順序的考量，但是手爆一個 17 個線段、平面空間 29 個的建造 … 也許有點瘋狂，用最簡單的由上而下掃描，造成一個傾斜的樹也是各種不容易。</p>
<h2 id="6-2"><a href="#6-2" class="headerlink" title="6.2"></a>6.2</h2><p>Give an example of a set of n line segments with an order on them that<br>makes the algorithm create a search structure of size Θ(n2) and worst-case<br>query time Θ(n).</p>
<hr>
<p>找到一個最慘空間<span>$\Theta(n^{2})$</span><!-- Has MathJax -->，最慘詢問時間<span>$\Theta(n)$</span><!-- Has MathJax -->。</p>
<p>n 個線段，將其中 n/2 放置在同一個水平線上，對於剩餘 n/2 個：</p>
<p>每次加入的順序 s1, s2, …, si，每次的線段的 x 值會包含前一個線段<span>$s_{i}.lx &lt; s_{i-1}.lx, s_{i}.rx &gt; s_{i-1}.rx$</span><!-- Has MathJax -->，美加入一個線段，會增加 n/2 個內部節點，並且最大深度增加 1。總計加入 n/2 次，增加的節點數量 O(n/2 x n/2) = O(n^2)，深度 O(n/2) = O(n)。</p>
<h2 id="6-5"><a href="#6-5" class="headerlink" title="6.5"></a>6.5</h2><p>Given a convex polygon P as an array of its n vertices in sorted order along the boundary. Show that, given a query point q, it can be tested in time O(logn) whether q lies inside P.</p>
<hr>
<p>由於詢問次數相當多，必須將複雜度降到 O(log n)，採用的方式將凸包其中一個點當作基準，則如果在凸包的點而言，一定會落在某個以基點拉出的三角形內部中，為了方便計算，則可以拿外積的正負邊界上。得到可能的三角形後，從邊界中可以藉由外積計算是否同側。</p>
<p>採用射線法 O(n) 肯定是吃大虧的。</p>
<figure class="highlight plain"><figcaption><span>part of UVa 12048 - Inhabitants</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">double cross(Pt o, Pt a, Pt b) &#123;</div><div class="line">    return (a.x-o.x)*(b.y-o.y)-(a.y-o.y)*(b.x-o.x);</div><div class="line">&#125;</div><div class="line">int inside_convex(const Pt &amp;p, Pt ch[], int n) &#123;</div><div class="line">    if(n &lt; 3)</div><div class="line">        return false;</div><div class="line">    if(cross(ch[0], p, ch[1]) &gt; eps)</div><div class="line">        return false;</div><div class="line">    if(cross(ch[0], p, ch[n-1]) &lt; -eps)</div><div class="line">        return false;</div><div class="line">    </div><div class="line">    int l = 2, r = n-1;</div><div class="line">    int line = -1;</div><div class="line">    while(l &lt;= r) &#123;</div><div class="line">        int mid = (l + r)&gt;&gt;1;</div><div class="line">        if(cross(ch[0],p, ch[mid]) &gt; -eps) &#123;</div><div class="line">            line = mid;</div><div class="line">            r = mid - 1;</div><div class="line">        &#125; else l = mid + 1;</div><div class="line">    &#125;</div><div class="line">    return cross(ch[line-1], p, ch[line]) &lt; eps;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/NLP-hw1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/25/lesson/NLP-hw1/" class="article-date">
  <time datetime="2014-10-25T12:59:20.000Z" itemprop="datePublished">2014-10-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/自然語言/">自然語言</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/25/lesson/NLP-hw1/">自然語言處理 - HW01</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/10/25/lesson/NLP-hw1/" data-id="ckq8np0dv02ay1wvnc5n3gpjc" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/10/25/lesson/NLP-hw1/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/自然語言/">自然語言</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="編譯環境"><a href="#編譯環境" class="headerlink" title="編譯環境"></a>編譯環境</h2><p>Dev-C++ 5.6.3</p>
<h2 id="Language-model-implementation"><a href="#Language-model-implementation" class="headerlink" title="Language model implementation"></a>Language model implementation</h2><p>實作語言處理模型，要求讀入一連串的英文語句做為基底，接著詢問一句的正確性為多少，也就是這句話是正確拼讀的機率為何，算是一個可用的句子嗎？</p>
<span>$$P(w_{i}) = \frac{Count(w_{i})}{\sum_{j} Count(w_{j})} \\
P(w_{i}, w_{i+1}) = \frac{Count(w_{i}, w_{i+1})}{\sum_{j} Count(w_{j}, w_{j+1})} \\
P(w_{i+1}|w_{i}) = \frac{P(w_{i}, w_{i+1})}{P(w_{i})}$$</span><!-- Has MathJax -->
<p>上述分別是一個單詞的機率，以及計算相鄰兩個單詞的機率，最後推估在這個單詞下，它們相鄰的機率。請查閱 <strong> 貝氏定理 </strong>。</p>
<blockquote><ul>
<li>P(A)是A的先驗機率或邊緣機率。之所以稱為”先驗”是因為它不考慮任何B方面的因素。</li>
<li>P(A|B)是已知B發生後A的條件機率，也由於得自B的取值而被稱作A的後驗機率。</li>
<li>P(B|A)是已知A發生後B的條件機率，也由於得自A的取值而被稱作B的後驗機率。</li>
<li>P(B)是B的先驗機率或邊緣機率，也作標准化常量（normalizing constant）.</li>
</ul>
<footer><strong>貝氏定理（Bayes' theorem）</strong><cite><a href="http://zh.wikipedia.org/wiki/%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%AE%9A%E7%90%86" target="_blank" rel="external">zh.wikipedia.org/wiki/%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%AE%9A%E7%90%86</a></cite></footer></blockquote>
<span>$P(s) = P(w_{0}) \times P(w_{1}|w_{0}) \times ... \times P(w_{n-1}|w_{n-2})$</span><!-- Has MathJax -->
<p>上述為一個句子的機率，一個句子可以表示成一個序列單詞，利用連乘積將機率算出。當句子越常時，很容易發現機率陡降的速度相當快，就算是數個字詞，機率大約也是在<span>$10^{-3}$</span><!-- Has MathJax --> 左右。因此這麼算下去，長句子的正確性就會大幅減少，但是在邏輯上，如果句子都是短短幾個單詞也是相當奇怪的，口語上也許是，文章判讀上就難說。至於要不要取<span>$\sqrt[n]{x}$</span><!-- Has MathJax --> 值得思考。</p>
<span>$$\begin{cases}
Count^{*}(w_{i}) = (Count(w_{i})+1) \times \frac{N_{Count(w_{i})+1}}{N_{Count(w_{i})}} &amp; \text{ if } Count(w_{i}) &lt; k \\ 
Count^{*}(w_{i}) = Count(w_{i}) &amp; \text{ if } Count(w_{i}) \geq k 
\end{cases} \\
\text{unigram } N_{0} = 80000$$</span><!-- Has MathJax -->
<p>當我們去計算一個單詞的機率時，必須相對於其他單詞的出現機率，然而像介係詞、助詞等，出現次數是相對高出取多，必須取一個閥值，來忽略過高無用的機率，以免將其他的單詞的機率過低不均。</p>
<span>$$\begin{cases}
Count^{*}(w_{i}, w_{i+1}) = (Count(w_{i}, w_{i+1})+1) \times \frac{N_{Count(w_{i}, w_{i+1})+1}}{N_{Count(w_{i}, w_{i+1})}} &amp; \text{ if } Count(w_{i}, w_{i+1}) &lt; k \\ 
Count^{*}(w_{i}, w_{i+1}) = Count(w_{i}, w_{i+1}) &amp; \text{ if } Count(w_{i}, w_{i+1}) \geq k
\end{cases} \\
\text{bigram } N_{0} = 80000 \times 80000$$</span><!-- Has MathJax -->
<p>在計算相鄰兩個單詞的出現次數時，一樣會遇到這種情況。既然在計算次數上需要做 smoothing 的調整，在機率處理上也是一樣動作。</p>
<span>$$\begin{cases}
 P(w_{i}) = \frac{N_{1}}{N} &amp; \text{ if } Count(w_{i}) = 0 \\ 
 P(w_{i}) = \frac{Count^{*}(w_{i})}{N} &amp; \text{ if } Count(w_{i}) &lt; K \\ 
 P(w_{i}) = \frac{Count(w_{i})}{N} &amp; \text{ if } Count(w_{i}) \geq K
\end{cases}$$</span><!-- Has MathJax -->
<span>$$\begin{cases}
 P(w_{i}, w_{i+1}) = \frac{Count^{*}(w_{i}, w_{i+1})}{N} &amp; \text{ if } Count(w_{i}, w_{i+1}) &lt; K \\ 
 P(w_{i}, w_{i+1}) = \frac{Count(w_{i}, w_{i+1})}{N} &amp; \text{ if } Count(w_{i}, w_{i+1}) \geq K
\end{cases}$$</span><!-- Has MathJax -->
<p>在單詞出現次數很少時，就必須使用 smoothing，因為出現 1 次、2 次、3 次 … 的單詞次數，之間大小關係不保證嚴格遞增或遞減，</p>
<h2 id="實作細節"><a href="#實作細節" class="headerlink" title="實作細節"></a>實作細節</h2><ul>
<li>公式都已經給定，基本上麻煩就是在於資料紀錄而已，其他就照著流程跑。</li>
<li>雖然沒有規定語言，以下代碼在 Dev-C++ 下編過，別問 VS 到底行不行。</li>
</ul>
<p>原則上，讀檔案，建立模型可以在 1.4 秒內完成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">processing dataset.txt ...</div><div class="line">read file end. Start prepare language model ...</div><div class="line">input a sentence in a line :</div><div class="line">  </div><div class="line">--------------------------------</div><div class="line">Process exited after 1.493 seconds with return value 0</div></pre></td></tr></table></figure>
<h2 id="測試輸入"><a href="#測試輸入" class="headerlink" title="測試輸入"></a>測試輸入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">causes AIDS and is associated with AIDS cases primarily in West Africa</div><div class="line">AIDS cases primarily in West Africa</div><div class="line">AIDS cases primarily at West Africa</div><div class="line">AIDS cases primarily AIDS West Africa</div><div class="line">morris</div><div class="line">West Africa</div><div class="line">East Africa</div><div class="line">Taiwan Africa</div></pre></td></tr></table></figure>
<h2 id="測式輸出"><a href="#測式輸出" class="headerlink" title="測式輸出"></a>測式輸出</h2><p>考量長句子的機率，採用 log 平均結果，輸出應該為負值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">-4.597715</div><div class="line">-4.796396</div><div class="line">-5.992288</div><div class="line">-7.245960</div><div class="line">-1.857392</div><div class="line">-4.639120</div><div class="line">-8.003706</div><div class="line">-8.003706</div></pre></td></tr></table></figure>
<p>原始版本，直接輸出 P(s)，這裡採用科學記號表示法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">1.101764e-026</div><div class="line">2.622182e-015</div><div class="line">6.068425e-019</div><div class="line">9.372080e-023</div><div class="line">2.436068e-002</div><div class="line">9.031667e-007</div><div class="line">3.733396e-011</div><div class="line">3.733396e-011</div></pre></td></tr></table></figure>
<h2 id="結語"><a href="#結語" class="headerlink" title="結語"></a>結語</h2><p>有 STL library，代碼不用太長，跑得時間也不會太久。想到插手別學校的自然語言處理，玩了一下他們作業，把同學的代碼效率修得好一點，其實也不錯玩得，只是在公式計算上比較沒有，但是要求高效率的搜索結構，讀檔案進來後，依據什麼建表、該用什麼順序完成是很重要的。</p>
<p>切記，在寫這種程式時，發現跑的速度太久，一部分是因為使用太多的標準輸出，也就是用太多 <code>printf()</code>、<code>cout &lt;&lt;</code> 或 <code>System.out.println()</code> 之類的在進行流程監控。輸出的效率必須將檔案寫到螢幕顯示的 memory buffer，因此 context-switch 什麼，消耗時間太大，盡可能不要輸出，要不然就是按比例輸出，速度可以快個數百倍。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DEBUG</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">    <span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">int</span>&gt; Count;</div><div class="line">    <span class="built_in">map</span>&lt;pair&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;, <span class="keyword">int</span>&gt; Count2;</div><div class="line">    <span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; Ni;</div><div class="line">    <span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; Ni2;</div><div class="line">    <span class="keyword">int</span> totalCountWord, totalCount2Word;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> K;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> V;</div><div class="line">    <span class="function"><span class="built_in">string</span> <span class="title">str2lower</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++)</div><div class="line">            s[i] = <span class="built_in">tolower</span>(s[i]);</div><div class="line">        <span class="keyword">return</span> s;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</div><div class="line">        totalCountWord = totalCount2Word = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">int</span>&gt;::iterator it = Count.begin();</div><div class="line">            it != Count.end(); it++) &#123;</div><div class="line">            Ni[it-&gt;second]++;</div><div class="line">            totalCountWord += it-&gt;second;</div><div class="line"><span class="comment">//#ifdef DEBUG</span></div><div class="line"><span class="comment">//			if (it-&gt;second &gt; 1000)</span></div><div class="line"><span class="comment">//			printf("Count(%s) = %d\n", it-&gt;first.c_str(), it-&gt;second);</span></div><div class="line"><span class="comment">//#endif</span></div><div class="line">        &#125;	</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">map</span>&lt;pair&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;, <span class="keyword">int</span>&gt;::iterator it = Count2.begin();</div><div class="line">            it != Count2.end(); it++) &#123;</div><div class="line">            Ni2[it-&gt;second]++;</div><div class="line">            totalCount2Word += it-&gt;second;</div><div class="line">        &#125;		</div><div class="line">        <span class="keyword">int</span> smooth = <span class="number">0x3f3f3f3f</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;::iterator it = Ni.begin();</div><div class="line">            it != Ni.end(); it++) &#123;</div><div class="line"><span class="comment">//			smooth = min(smooth, it-&gt;second);</span></div><div class="line"><span class="comment">//			it-&gt;second = smooth;</span></div><div class="line"><span class="comment">//#ifdef DEBUG</span></div><div class="line"><span class="comment">//			printf("N(%d) = %d\n", it-&gt;first, it-&gt;second);</span></div><div class="line"><span class="comment">//			getchar();</span></div><div class="line"><span class="comment">//#endif</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">getN</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123; <span class="comment">// N_&#123;Count(w)&#125;</span></div><div class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>)	<span class="keyword">return</span> <span class="number">80000</span>;</div><div class="line">        <span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;::iterator it = Ni.lower_bound(i), jt;</div><div class="line">        <span class="keyword">if</span> (it == Ni.begin())	<span class="keyword">return</span> it == Ni.end() ? <span class="number">1</span> : it-&gt;second;</div><div class="line">        jt = it, jt--;</div><div class="line">        <span class="keyword">double</span> sx = jt-&gt;first, sy = jt-&gt;second, ex = it-&gt;first, ey = it-&gt;second;</div><div class="line">        <span class="keyword">return</span> sy + (ey - sy) / (ex - sx) * (i - sx);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">getN2</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123; <span class="comment">// N_&#123;Count(w_&#123;i&#125;, w_&#123;i+1&#125;)&#125;</span></div><div class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>)	<span class="keyword">return</span> <span class="number">80000.0</span> * <span class="number">80000.0</span>;</div><div class="line">        <span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;::iterator it = Ni2.lower_bound(i), jt;</div><div class="line">        <span class="keyword">if</span> (it == Ni2.begin())	<span class="keyword">return</span> it == Ni2.end() ? <span class="number">1</span> : it-&gt;second;</div><div class="line">        jt = it, jt--;</div><div class="line">        <span class="keyword">double</span> sx = jt-&gt;first, sy = jt-&gt;second, ex = it-&gt;first, ey = it-&gt;second;</div><div class="line">        <span class="keyword">return</span> sy + (ey - sy) / (ex - sx) * (i - sx);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">getCountStar</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span> &amp;w)</span> </span>&#123; <span class="comment">// Count^&#123;*&#125;(w_&#123;i&#125;)</span></div><div class="line">        <span class="keyword">int</span> n = Count[w];</div><div class="line">        <span class="keyword">if</span> (n &lt; K) &#123;</div><div class="line">            <span class="keyword">return</span> (<span class="keyword">double</span>) (n + <span class="number">1</span>) * (getN(n + <span class="number">1</span>) / getN(n));</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> n;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">getCountStar2</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span> &amp;w1, <span class="keyword">const</span> <span class="built_in">string</span> &amp;w2)</span> </span>&#123; <span class="comment">// Count^&#123;*&#125;(w_&#123;i&#125;, w_&#123;i+1&#125;)</span></div><div class="line">        <span class="keyword">int</span> n = Count2[make_pair(w1, w2)];</div><div class="line">        <span class="keyword">if</span> (n &lt; K) &#123;</div><div class="line">            <span class="keyword">return</span> (<span class="keyword">double</span>) (n + <span class="number">1</span>) * (getN2(n + <span class="number">1</span>) / getN2(n));</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> n;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">getPofW1</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span> &amp;w)</span> </span>&#123; <span class="comment">// P(w_&#123;i&#125;) = \frac&#123;Count(w_&#123;i&#125;)&#125;&#123;\sum_&#123;j&#125; Count(w_&#123;j&#125;)&#125;</span></div><div class="line">        <span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">int</span>&gt;::iterator it = Count.find(w);</div><div class="line">        <span class="keyword">if</span> (it == Count.end() || it-&gt;second == <span class="number">0</span>) &#123; <span class="comment">// Count(w_&#123;i&#125;) = 0</span></div><div class="line">            <span class="keyword">double</span> Nu0 = V - Count.size();</div><div class="line">            <span class="keyword">return</span> (<span class="keyword">double</span>) getN(<span class="number">1</span>) / Nu0 / totalCountWord; <span class="comment">// \frac&#123;N_&#123;1&#125;&#125;&#123;N&#125;</span></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (it-&gt;second &lt; K) &#123; <span class="comment">// 0 &lt; Count(w_&#123;i&#125;) &lt; K</span></div><div class="line">            <span class="keyword">return</span> (<span class="keyword">double</span>) getCountStar(w) / totalCountWord; <span class="comment">// \frac&#123;Count^&#123;*&#125;(w_&#123;i&#125;)&#125;&#123;N&#125;</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// Count(w_&#123;i&#125;) \geq K</span></div><div class="line">            <span class="keyword">return</span> (<span class="keyword">double</span>) it-&gt;second / totalCountWord; <span class="comment">// \frac&#123;Count(w_&#123;i&#125;)&#125;&#123;N&#125;</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">getPofW2</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span> &amp;w1, <span class="keyword">const</span> <span class="built_in">string</span> &amp;w2)</span> </span>&#123; <span class="comment">// P(w_&#123;i&#125;, w_&#123;i+1&#125;)</span></div><div class="line">        <span class="built_in">map</span>&lt; pair&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;, <span class="keyword">int</span>&gt;::iterator it = Count2.find(make_pair(w1, w2));</div><div class="line">        <span class="keyword">if</span> (it == Count2.end() || it-&gt;second == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">double</span> Nb0 = (<span class="keyword">double</span>) V * V - Count2.size();</div><div class="line">            <span class="keyword">return</span> (<span class="keyword">double</span>) getN2(<span class="number">1</span>) / Nb0 / totalCount2Word;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (it-&gt;second &lt; K) &#123; <span class="comment">// Count(w_&#123;i&#125;, w_&#123;i+1&#125;) &lt; K</span></div><div class="line">            <span class="keyword">return</span> (<span class="keyword">double</span>) getCountStar2(w1, w2) / totalCount2Word; <span class="comment">// \frac&#123;Count^&#123;*&#125;(w_&#123;i&#125;, w_&#123;i+1&#125;)&#125;&#123;N&#125;</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// Count(w_&#123;i&#125;, w_&#123;i+1&#125;) \geq K</span></div><div class="line">            <span class="keyword">return</span> (<span class="keyword">double</span>) it-&gt;second / totalCount2Word; <span class="comment">// \frac&#123;Count(w_&#123;i&#125;, w_&#123;i+1&#125;)&#125;&#123;N&#125;</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">parseStmt</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; &amp;stmt)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; stmt.size(); i++) &#123;</div><div class="line">            stmt[i] = str2lower(stmt[i]);</div><div class="line">            Count[stmt[i]]++;</div><div class="line">            <span class="keyword">if</span> (i)</div><div class="line">                Count2[make_pair(stmt[i<span class="number">-1</span>], stmt[i])]++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">getPs</span><span class="params">(<span class="built_in">string</span> in)</span> </span>&#123;</div><div class="line">        <span class="function"><span class="built_in">stringstream</span> <span class="title">sin</span><span class="params">(in)</span></span>;</div><div class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; stmt;</div><div class="line">        <span class="built_in">string</span> token;</div><div class="line">        <span class="keyword">while</span> (<span class="built_in">sin</span> &gt;&gt; token)</div><div class="line">            stmt.push_back(str2lower(token));</div><div class="line">        <span class="comment">// P(s) = P(w_&#123;0&#125;) \times P(w_&#123;1&#125;|w_&#123;0&#125;) \times ... \times P(w_&#123;n-1&#125;|w_&#123;n-2&#125;)</span></div><div class="line">        <span class="keyword">double</span> p = <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (stmt.size() &gt; <span class="number">0</span>)</div><div class="line">            p = getPofW1(stmt[<span class="number">0</span>]);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; stmt.size(); i++ ) &#123;</div><div class="line">            p *= getPofW2(stmt[i<span class="number">-1</span>], stmt[i]) / getPofW1(stmt[i<span class="number">-1</span>]);</div><div class="line"><span class="comment">//			printf("%lf\n", getPofW2(stmt[i-1], stmt[i]) / getPofW1(stmt[i-1]));</span></div><div class="line"><span class="comment">//			cout &lt;&lt; stmt[i-1] &lt;&lt; " "  &lt;&lt; stmt[i]  &lt;&lt; endl; </span></div><div class="line"><span class="comment">//			printf("%lf\n", getPofW2(stmt[i-1], stmt[i]));</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> p;</div><div class="line">    &#125;</div><div class="line">&#125; tool;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> Model::K = <span class="number">10</span>, Model::V = <span class="number">80000</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="function">ifstream <span class="title">fin</span><span class="params">(<span class="string">"dataset.txt"</span>)</span></span>;</div><div class="line"><span class="comment">//	freopen("tmp.txt", "w+t", stdout); </span></div><div class="line">    <span class="built_in">string</span> token, line;</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; stmt;</div><div class="line">    <span class="built_in">puts</span>(<span class="string">"processing dataset.txt ..."</span>);</div><div class="line">    <span class="keyword">while</span> (getline(fin, line)) &#123;</div><div class="line">        <span class="function"><span class="built_in">stringstream</span> <span class="title">sin</span><span class="params">(line)</span></span>;</div><div class="line">        stmt.clear();</div><div class="line">        <span class="keyword">while</span> (<span class="built_in">sin</span> &gt;&gt; token) &#123;</div><div class="line">            stmt.push_back(token);</div><div class="line">        &#125;</div><div class="line">        tool.parseStmt(stmt);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">puts</span>(<span class="string">"read file end. Start prepare language model ..."</span>);</div><div class="line">    tool.prepare();</div><div class="line">    <span class="built_in">puts</span>(<span class="string">"input a sentence in a line :"</span>);</div><div class="line">    <span class="keyword">while</span> (getline(<span class="built_in">cin</span>, line)) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"P*('%s') : %.10e\n"</span>, line.c_str(), tool.getPs(line));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">causes AIDS and is associated with AIDS cases primarily in West Africa</span></div><div class="line"><span class="comment">AIDS cases primarily in West Africa</span></div><div class="line"><span class="comment">AIDS cases primarily at West Africa</span></div><div class="line"><span class="comment">AIDS cases primarily AIDS West Africa</span></div><div class="line"><span class="comment">morris</span></div><div class="line"><span class="comment">IL-2 is a gene .</span></div><div class="line"><span class="comment">IL-2 is an gene .</span></div><div class="line"><span class="comment">*/</span></div><div class="line"></div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/civilization-w5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/25/lesson/civilization-w5/" class="article-date">
  <time datetime="2014-10-25T01:28:47.000Z" itemprop="datePublished">2014-10-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/通識課程/">通識課程</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/25/lesson/civilization-w5/">[通識] 文明的進程 Week 5</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/10/25/lesson/civilization-w5/" data-id="ckq8np0eq02c21wvngwondzhl" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/10/25/lesson/civilization-w5/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/通識/">通識</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <blockquote>
<p>文明化的過程，有可能整個記憶封鎖在過去的盒子中。</p>
</blockquote>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本周上課講述的內容為 <strong> 痰盂 </strong>，在 18 世紀時，這盆子可說是相當受到歡迎，當我們發現吐痰這事衛生上有所疑慮，找了一個盆子還裝，就跟尿壺類似。但是問別人痰盂是何物時，大概也沒幾個人見過。</p>
<p>為什麼經過了 2 個世紀，痰盂就不見了，應該說是不被需要，<strong> 吐痰 </strong> 這件事從正常行為，到不需要吐痰，當然還是有人或在某個狀態下會吐痰 (生病)，由於環境的改善，尤其是空氣汙染的關係，痰並沒有必要性。</p>
<h2 id="談吐痰行為"><a href="#談吐痰行為" class="headerlink" title="談吐痰行為"></a>談吐痰行為</h2><p>早期到處可見吐痰，可說是隨地大小便的程度，吐痰在地上踏踏輾輾即可，中間開始注意到衛生，不管東方西方都曾出現過 <strong> 痰盂 </strong>，甚至在大大小小的照片中還一起入鏡呢，外觀上與一般花盆無異，只是裡面裝的東西不同罷了。</p>
<p>後來開始用法規、法款來制止人們隨地吐痰，從不吐在室內開始，也許允許往外吐是件很可笑的事情，但是在過度時期也算個進步，至少人們還知道吐痰這個行為需要被約束。到了二十世紀仍然會有使用罰款的方式來告誡人們，那為什麼現在根本沒有看過這些警告標語呢？「<strong> 請不要隨地吐痰 </strong>」</p>
<blockquote>
<p>他制到自制：外部或他人而遵守戒律 → 內化到自我強制</p>
</blockquote>
<h2 id="談約束禮儀"><a href="#談約束禮儀" class="headerlink" title="談約束禮儀"></a>談約束禮儀</h2><blockquote>
<p>任何一個爛事，找一個 powerful 的理由，也能昇華！</p>
</blockquote>
<p>在一個民主平等的社會中，才能用衛生健康的理由來約束人們。如果在那種貧富不均，又有階級高低之分的社會，物質分配不均，光是活著就有困擾，遵守禮儀這件事情何止奢侈可說。</p>
<p>如果看看在傳統菜市場買賣的人，用呼喊的方式叫賣，那樣的行為舉止，在有限的資源下，你還說什麼禮儀嗎，能賣出去就好，下次還要搶攤位賣呢。</p>
<p>社會組織的方式將會影響心理生活的可塑性，根據國情不同、情操與行為的主旨不同，心理上要適應新的規則模式，反應上也會有所不同。基於什麼樣的條件，接受某些事情的難易度不同。 (文理組織差，相互學習對方領域的可塑性也會有差別)</p>
<h2 id="談我們"><a href="#談我們" class="headerlink" title="談我們"></a>談我們</h2><p>美當我們成長，越來越會覺得小孩子很吵，那我們還能這麼吵嗎？兇不起來的人類？越來越退化了嗎？接受禮儀的約束，在何種環境下，才能拿回被約束的習慣。</p>
<p>「當我們不只遵守禮儀，也會開始要求別人遵守禮儀」這必須看看台灣最強的人肉搜索，不外乎一個人做錯事情，馬上就會被人肉出來，必且大眾強力苛責這個人的行為，可見我們多麼要求別人遵守禮儀。在某些條件下，例如家裡、年紀之差，容忍不禮貌的程度也會不同。</p>
<h2 id="幾件趣事"><a href="#幾件趣事" class="headerlink" title="幾件趣事"></a>幾件趣事</h2><p>結合民族自尊心推動宣傳，當我們厭惡、崇尚其他民族時，它們活生生的例子就會是很好的宣傳，例如：西方人多麼高雅、韓國人常在體育賽事作弊 … 等，約束力相當好。</p>
<p>在早期哪有什麼裸體抗議，大家都是赤裸裸地睡覺、洗澡，不赤裸睡覺必有身體上的缺陷，不想引人猜疑，那時都是安妥妥地赤裸。而現在卻不同，赤裸居然可以拿來做為抗議手段，用一個羞恥力來擊倒敵人！</p>
<p>在人來人往的地方生活，就會不由自主地意識到他人的存在，任何行為不管是否被他人看見，都會論及自己是否會 <strong> 貶值 </strong> 的行為，做了某件事情，我是否就貶值了呢？因此焦慮心情在城市中也常在人們身上發現。</p>
<p>成人與小孩的衝突有時只是世代的價值衝突，而非禮儀上的學習多寡，當沒有過去世代的記憶，沒有那些曾經被拋下的某些行為經驗，不知道不做的原因，為何不做？</p>
<p>為什麼常有人不碰別人用過的東西？人際關係的 <strong> 獨立 </strong> 與 <strong> 疏離 </strong>，總覺得人越來越不是人了，說是昆蟲也不為過，之後就各自獨立生存，最終進化呢。</p>
<blockquote>
<p>沒有一個時代的狀態可以做為 <strong> 絕對化標準 </strong></p>
</blockquote>
<p>少在那邊自己為是，可以說自己不夠好，但是絕不能批評別人太差，看到別人用你不曾使用的行為模式活著，才是訝異敬佩的地方－「<strong> 原來還可以這麼活著！ </strong>」</p>
<blockquote>
<p>用範例教育成人該做、不該做的事情，也就是說什麼都能說，何必忌諱任何一個汙穢的事情。</p>
</blockquote>
<p>越要說明一個真理，請拋開羞恥心去描述它吧。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-mproblem-feed" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/23/mproblem-feed/" class="article-date">
  <time datetime="2014-10-23T06:03:56.000Z" itemprop="datePublished">2014-10-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/出題解題/">出題解題</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/67stm68.jpg" rel="gallery_ckq8noznf00ak1wvnv8p6a45e">
        <img src="http://i.imgur.com/67stm68.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/23/mproblem-feed/">[ACM 題目] 最近餐館</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/10/23/mproblem-feed/" data-id="ckq8noznf00ak1wvnv8p6a45e" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/10/23/mproblem-feed/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kd-tree/">kd-tree</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/計算幾何/">計算幾何</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>每到吃飼料時間，某 M 正思考要去哪裡解決，雖然有很多很多地方可以去吃，由於某 M 對於美食沒有特別需求，所以只會到最近的幾個地點即可，然後再以循環輪食的方式日復一日。</p>
<p>某 M 現在的位置與每個餐館的位置都用一個笛卡爾坐標系中的點表示，每個點與每個點的距離為歐幾里得距離。</p>
<p>x = (x1,…,xn) 和 y = (y1,…,yn) 之間的距離為</p>
<p><img src="http://i.imgur.com/5TwGwBs.png" alt="test"></p>
<p>現給出在 K 維空間中某 M 所處的位置座標，以及 N 個餐館位置，請觀察某 M 會到哪裡吃飼料。. </p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>輸入有多組測資，</p>
<p>每一組第一行會有兩個整數 N, K，</p>
<p>接下來會有 N 行，每行包含 K 個整數，表示第 i 個餐館座標。</p>
<p>接下來一行，包含一個整數 Q，表示某 M 的可能座標 。</p>
<p>接下來會有 Q 行，每一組詢問會有兩行，第一行會有 K 個整數，表示某 M 所在的座標，第二行會有一個整數 P。</p>
<p>(N &lt; 8192, K &lt; 6, Q &lt; 10,000, P &lt; 11, 座標值 0 &lt; x, y &lt; 10,000)</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>對於每一組詢問，輸出一行 <code>Case #:</code>，第一個整數為 P，接下來 P 個整數按照距離由小到大輸出餐館編號，如果相同則輸出編號小的。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">2 2</div><div class="line">1 1</div><div class="line">3 3</div><div class="line">1</div><div class="line">2 2</div><div class="line">1</div><div class="line"></div><div class="line">3 2</div><div class="line">1 1</div><div class="line">1 3</div><div class="line">3 4</div><div class="line">2</div><div class="line">2 3</div><div class="line">2</div><div class="line">2 3</div><div class="line">1</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Case 1: 1 1</div><div class="line">Case 2: 2 2 3</div><div class="line">Case 3: 1 2</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 8192</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXD 8</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x3f3f3f3f</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">kdTree</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:	</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">PointD</span> &#123;</span></div><div class="line">        <span class="keyword">int</span> d[MAXD];</div><div class="line">        <span class="keyword">int</span> label;</div><div class="line">    &#125;;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">    	Node *lson, *rson;</div><div class="line">    	<span class="keyword">int</span> label;</div><div class="line">    &#125;;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">cmp</span> &#123;</span></div><div class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> PointD* x, <span class="keyword">const</span> PointD* y)</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">    		<span class="keyword">return</span> x-&gt;d[sortDidx] &lt; y-&gt;d[sortDidx];</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">pQcmp</span> &#123;</span></div><div class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &amp;a, pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &amp;b)</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        	<span class="keyword">if</span> (a.first != b.first)	<span class="keyword">return</span> a.first &lt; b.first;</div><div class="line">        	<span class="keyword">return</span> a.second &lt; b.second;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> sortDidx;</div><div class="line">    priority_queue&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;, <span class="built_in">vector</span>&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt;, pQcmp&gt; pQ; <span class="comment">// &lt;dist, label&gt;</span></div><div class="line">    Node buf[MAXN], *root;</div><div class="line">    PointD pt[MAXN], *A[MAXN];</div><div class="line">    <span class="keyword">int</span> bufsize, K;</div><div class="line">    <span class="keyword">int</span> Q[MAXD], max_dist, qM;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">prepare</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        bufsize = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">        	A[i] = &amp;pt[i];</div><div class="line">        root = build(<span class="number">0</span>, <span class="number">0</span>, n - <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">build</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(l &gt; r)	<span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">        <span class="keyword">int</span> m = (l + r)/<span class="number">2</span>;</div><div class="line">        Node *ret = &amp;buf[bufsize++];</div><div class="line">        sortDidx = k;</div><div class="line">        nth_element(A + l, A + m, A + r + <span class="number">1</span>, cmp());</div><div class="line">        ret-&gt;label = A[m]-&gt;label, ret-&gt;lson = ret-&gt;rson = <span class="literal">NULL</span>;</div><div class="line">        <span class="keyword">if</span>(l != r) &#123;</div><div class="line">            ret-&gt;lson = build((k+<span class="number">1</span>)%K, l, m<span class="number">-1</span>);</div><div class="line">            ret-&gt;rson = build((k+<span class="number">1</span>)%K, m+<span class="number">1</span>, r);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">dist</span><span class="params">(<span class="keyword">int</span> idx)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; K; i++)</div><div class="line">            ret += (pt[idx].d[i] - Q[i]) * (pt[idx].d[i] - Q[i]);</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">h_func</span><span class="params">(<span class="keyword">int</span> h[])</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; K; i++)	ret += h[i];</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">findNearest</span><span class="params">(Node *u, <span class="keyword">int</span> k, <span class="keyword">int</span> h[])</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(u == <span class="literal">NULL</span> || h_func(h) &gt;= max_dist)</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        <span class="keyword">int</span> d = dist(u-&gt;label);</div><div class="line">        <span class="keyword">if</span> (d &lt; max_dist) &#123;</div><div class="line">            pQ.push(make_pair(d, u-&gt;label));</div><div class="line">            <span class="keyword">if</span> (pQ.size() == qM + <span class="number">1</span>) &#123;</div><div class="line">                max_dist = pQ.top().first, pQ.pop();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> old_hk = h[k];</div><div class="line">        <span class="keyword">if</span> (Q[k] &lt;= pt[u-&gt;label].d[k]) &#123;</div><div class="line">            <span class="keyword">if</span> (u-&gt;lson != <span class="literal">NULL</span>)</div><div class="line">                findNearest(u-&gt;lson, (k+<span class="number">1</span>)%K, h);</div><div class="line">            <span class="keyword">if</span> (u-&gt;rson != <span class="literal">NULL</span>) &#123;</div><div class="line">                h[k] = (pt[u-&gt;label].d[k] - Q[k]) * (pt[u-&gt;label].d[k] - Q[k]);</div><div class="line">                findNearest(u-&gt;rson, (k+<span class="number">1</span>)%K, h);</div><div class="line">                h[k] = old_hk;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span> (u-&gt;lson != <span class="literal">NULL</span>) &#123;</div><div class="line">                h[k] = (pt[u-&gt;label].d[k] - Q[k]) * (pt[u-&gt;label].d[k] - Q[k]);</div><div class="line">                findNearest(u-&gt;lson, (k+<span class="number">1</span>)%K, h);</div><div class="line">                h[k] = old_hk;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(u-&gt;rson != <span class="literal">NULL</span>)</div><div class="line">                findNearest(u-&gt;rson, (k+<span class="number">1</span>)%K, h);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> p[], <span class="keyword">int</span> M)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; K; i++)</div><div class="line">            Q[i] = p[i];</div><div class="line">        max_dist = INF, qM = M;</div><div class="line">        <span class="keyword">int</span> h[MAXD] = &#123;&#125;;</div><div class="line">        findNearest(root, <span class="number">0</span>, h);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d"</span>, M);</div><div class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ret;</div><div class="line">        <span class="keyword">while</span> (!pQ.empty())</div><div class="line">            ret.push_back(pQ.top().second), pQ.pop();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = ret.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</div><div class="line">        	<span class="built_in">printf</span>(<span class="string">" %d"</span>, ret[i] + <span class="number">1</span>);</div><div class="line">        <span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line">&#125;;	</div><div class="line"><span class="keyword">int</span> kdTree::sortDidx;</div><div class="line"></div><div class="line">kdTree tree;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">//	freopen("in.txt", "r+t", stdin);</span></div><div class="line"><span class="comment">//	freopen("out.txt", "w+t", stdout); </span></div><div class="line">    <span class="keyword">int</span> n, m, q, p[MAXD], x;</div><div class="line">    <span class="keyword">int</span> cases = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;n, &amp;m) == <span class="number">2</span>) &#123;</div><div class="line">    	tree.K = m;</div><div class="line">    	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">    		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</div><div class="line">    			<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;tree.pt[i].d[j]);</div><div class="line">    		tree.pt[i].label = i;</div><div class="line">    	&#125;</div><div class="line">    	tree.prepare(n);</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;q);</div><div class="line">        <span class="keyword">while</span> (q--) &#123;</div><div class="line">        	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</div><div class="line">        		<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;p[i]);</div><div class="line">        	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x);</div><div class="line">        	<span class="built_in">printf</span>(<span class="string">"Case %d: "</span>, ++cases);</div><div class="line">        	tree.query(p, x);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">2 2</span></div><div class="line"><span class="comment">1 1</span></div><div class="line"><span class="comment">3 3</span></div><div class="line"><span class="comment">1</span></div><div class="line"><span class="comment">2 2</span></div><div class="line"><span class="comment">1</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">3 2</span></div><div class="line"><span class="comment">1 1</span></div><div class="line"><span class="comment">1 3</span></div><div class="line"><span class="comment">3 4</span></div><div class="line"><span class="comment">2</span></div><div class="line"><span class="comment">2 3</span></div><div class="line"><span class="comment">2</span></div><div class="line"><span class="comment">2 3</span></div><div class="line"><span class="comment">1</span></div><div class="line"><span class="comment">*/</span> </div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-12524" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/23/oj/uva/uva-12524/" class="article-date">
  <time datetime="2014-10-23T01:28:11.000Z" itemprop="datePublished">2014-10-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/23/oj/uva/uva-12524/">UVa 12524 - Arranging Heaps</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/10/23/oj/uva/uva-12524/" data-id="ckq8np15w036c1wvni4ckmgjl" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/10/23/oj/uva/uva-12524/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dp/">dp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/斜率優化/">斜率優化</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>現在有 n 個堆，位於位置 xi 的堆重量 wi，對於每一堆可以移動到位置大的地方，移動的成本為<code>(xj - xi) * wi</code>，請問集中 k 堆的最少花費為何。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">3 1</div><div class="line">20 1</div><div class="line">30 1</div><div class="line">40 1</div><div class="line">3 1</div><div class="line">11 3</div><div class="line">12 2</div><div class="line">13 1</div><div class="line">6 2</div><div class="line">10 15</div><div class="line">12 17</div><div class="line">16 18</div><div class="line">18 13</div><div class="line">30 10</div><div class="line">32 1</div><div class="line">6 3</div><div class="line">10 15</div><div class="line">12 17</div><div class="line">16 18</div><div class="line">18 13</div><div class="line">30 10</div><div class="line">32 1</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">30</div><div class="line">8</div><div class="line">278</div><div class="line">86</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>參考 <a href="http://blog.csdn.net/work_freedom/article/details/8915965" target="_blank" rel="external">work_freedom的专栏</a></p>
<p><code>dp[i][j]</code> : 表示放入 i 堆，集中 j 堆的最少花費</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dp[i][j] = dp[k][j-1] + X[i] * (sumW[i] - sumW[k]) - (sumXW[i] - sumXW[k])</div><div class="line">dp[k][j-1] + sumXW[k] = X[i] * sumW[k] + dp[i][j] + sumXW[i] - sumW[i] * X[i]</div><div class="line">^^^^^^^^^^^^^^^^^^^^^   ^^^^   ^^^^^^^   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</div><div class="line">y = a x + b, a : monotone increasing, maintain upper convex</div></pre></td></tr></table></figure>
<p>將公式調整為上述結果，會發現我們依序帶入的 X[i] 遞增，也就是斜率會越來越高，要使後半部常數越大越好，保證此線會相交於凸包的頂點上。</p>
<p>凸包點 <code>(sumW[k], dp[k][j-1] + sumXW[k])</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 1024</span></div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> dp[MAXN][MAXN], X[MAXN], W[MAXN];</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> sumW[MAXN] = &#123;&#125;, sumXW[MAXN] = &#123;&#125;;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SlopeDP</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> front, rear;</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> X[MAXN], Y[MAXN];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;front = <span class="number">0</span>, rear = <span class="number">-1</span>;&#125;</div><div class="line">    <span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">cross</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x1, <span class="keyword">long</span> <span class="keyword">long</span> y1, <span class="keyword">long</span> <span class="keyword">long</span> x2, <span class="keyword">long</span> <span class="keyword">long</span> y2)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> x1 * y2 - y1 * x2;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x, <span class="keyword">long</span> <span class="keyword">long</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (front &lt; rear &amp;&amp; cross(X[rear]-X[rear<span class="number">-1</span>], Y[rear]-Y[rear<span class="number">-1</span>], x-X[rear<span class="number">-1</span>], y-Y[rear<span class="number">-1</span>]) &lt; <span class="number">0</span>)</div><div class="line">            rear--;</div><div class="line">        rear++;</div><div class="line">        X[rear] = x, Y[rear] = y;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">get</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> m)</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (front &lt; rear &amp;&amp; Y[front+<span class="number">1</span>]-Y[front] &lt; (X[front+<span class="number">1</span>]-X[front]) * m)</div><div class="line">            front++;</div><div class="line">        <span class="keyword">return</span> Y[front] - m * X[front];</div><div class="line">    &#125;</div><div class="line">&#125; dpTool;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N, M;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;N, &amp;M) == <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%lld %lld"</span>, &amp;X[i], &amp;W[i]);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</div><div class="line">            sumW[i] = sumW[i<span class="number">-1</span>] + W[i];</div><div class="line">            sumXW[i] = sumXW[i<span class="number">-1</span>] + X[i] * W[i];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= N; i++)</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= M; j++) </div><div class="line">                dp[i][j] = <span class="number">1L</span>L&lt;&lt;<span class="number">60</span>;</div><div class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line"><span class="comment">//		for (int i = 1; i &lt;= N; i++) &#123;</span></div><div class="line"><span class="comment">//			for (int j = 1; j &lt;= M; j++) &#123;</span></div><div class="line"><span class="comment">//				for (int k = 0; k &lt; i; k++)</span></div><div class="line"><span class="comment">//					dp[i][j] = min(dp[i][j], dp[k][j-1] + X[i] * (sumW[i] - sumW[k]) - (sumXW[i] - sumXW[k]));</span></div><div class="line"><span class="comment">//			&#125;</span></div><div class="line"><span class="comment">//		&#125;</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= M; i++) &#123;</div><div class="line">            dpTool.init();</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt;= N; j++) &#123;</div><div class="line">                dpTool.add(sumW[j<span class="number">-1</span>], dp[j<span class="number">-1</span>][i<span class="number">-1</span>] + sumXW[j<span class="number">-1</span>]);</div><div class="line">                <span class="keyword">long</span> <span class="keyword">long</span> val = dpTool.get(X[j]);</div><div class="line">                dp[j][i] = val - (sumXW[j] - sumW[j] * X[j]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, dp[N][M]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">dp[i][j] = dp[k][j-1] + X[i] * (sumW[i] - sumW[k]) - (sumXW[i] - sumXW[k])</span></div><div class="line"><span class="comment">dp[k][j-1] + sumXW[k] = X[i] * sumW[k] + dp[i][j] + sumXW[i] - sumW[i] * X[i]</span></div><div class="line"><span class="comment">^^^^^^^^^^^^^^^^^^^^^   ^^^^   ^^^^^^^   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></div><div class="line"><span class="comment">y = a x + b, a : monotone increasing, maintain upper convex</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">3 1</span></div><div class="line"><span class="comment">20 1</span></div><div class="line"><span class="comment">30 1</span></div><div class="line"><span class="comment">40 1</span></div><div class="line"><span class="comment">3 1</span></div><div class="line"><span class="comment">11 3</span></div><div class="line"><span class="comment">12 2</span></div><div class="line"><span class="comment">13 1</span></div><div class="line"><span class="comment">6 2</span></div><div class="line"><span class="comment">10 15</span></div><div class="line"><span class="comment">12 17</span></div><div class="line"><span class="comment">16 18</span></div><div class="line"><span class="comment">18 13</span></div><div class="line"><span class="comment">30 10</span></div><div class="line"><span class="comment">32 1</span></div><div class="line"><span class="comment">6 3</span></div><div class="line"><span class="comment">10 15</span></div><div class="line"><span class="comment">12 17</span></div><div class="line"><span class="comment">16 18</span></div><div class="line"><span class="comment">18 13</span></div><div class="line"><span class="comment">30 10</span></div><div class="line"><span class="comment">32 1</span></div><div class="line"><span class="comment">*/</span></div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-12141" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/23/oj/uva/uva-12141/" class="article-date">
  <time datetime="2014-10-23T01:13:04.000Z" itemprop="datePublished">2014-10-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/23/oj/uva/uva-12141/">UVa 12141 - Line Chart</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/10/23/oj/uva/uva-12141/" data-id="ckq8np12x033e1wvnrk4uar8a" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/10/23/oj/uva/uva-12141/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dp/">dp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/線段樹/">線段樹</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>給 n 個點趨勢圖，可以選擇忽略某些點，忽略的點會被剩餘點補上靠左。</p>
<p>請問要恰好 k 個 peak 的情況，有多少不同的趨勢圖貌。這別要求兩個相鄰的點不可以有相同 y 值。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">3</div><div class="line">6 1</div><div class="line">320 3</div><div class="line">306 1</div><div class="line">401 3</div><div class="line">325 4</div><div class="line">393 5</div><div class="line">380 2</div><div class="line">4 1</div><div class="line">101 3</div><div class="line">102 2</div><div class="line">103 2</div><div class="line">104 4</div><div class="line">3 0</div><div class="line">102 2</div><div class="line">101 1</div><div class="line">103 3</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Case 1: 20</div><div class="line">Case 2: 1</div><div class="line">Case 3: 8</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>TLE 版本，答案是正確的。 O(n^2 m)</p>
<p>其實這有點接近貪心作法，狀態為 <code>dp[i][k][3]</code> 表示加入第 i 個點，產生 k 個 peak，並且下一次要接 y 值較高、較低、等於的點。</p>
<p>而考慮當前 k 個 peak y[i]，對於三種高地要求，我們只會轉移到不同的 y 值，也就是對於後面如果存有 y[p] = y[q], p &lt; q，盡可能選擇 p 小的，否則會重複計算，要忽略 q 大的。</p>
<p>從下面樸素算法中，可以獲得基礎的遞迴公式。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">int</span> dp[<span class="number">10005</span>][<span class="number">64</span>][<span class="number">3</span>] = &#123;&#125;;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">1000000</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    freopen(<span class="string">"in.txt"</span>, <span class="string">"r+t"</span>, <span class="built_in">stdin</span>);</div><div class="line">    freopen(<span class="string">"out.txt"</span>, <span class="string">"w+t"</span>, <span class="built_in">stdout</span>);</div><div class="line">    <span class="keyword">int</span> testcase, n, m, x, y;</div><div class="line">    <span class="keyword">int</span> cases = <span class="number">0</span>;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;n, &amp;m);</div><div class="line">        <span class="built_in">vector</span>&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; D;</div><div class="line">        <span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; R;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;x, &amp;y);</div><div class="line">            R[y] = <span class="number">0</span>;</div><div class="line">            D.push_back(make_pair(x, y));</div><div class="line">        &#125;</div><div class="line">        sort(D.begin(), D.end());</div><div class="line">        <span class="keyword">int</span> v = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;::iterator it = R.begin();</div><div class="line">            it != R.end(); it++)</div><div class="line">            it-&gt;second = v++;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            D[i].second = R[D[i].second];</div><div class="line">        <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp));</div><div class="line">        <span class="keyword">int</span> used[<span class="number">10005</span>] = &#123;&#125;;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (used[D[i].second] == <span class="number">0</span>) &#123;</div><div class="line">                dp[i][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>; <span class="comment">// =</span></div><div class="line">                dp[i][<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span>; <span class="comment">// &lt;</span></div><div class="line">                dp[i][<span class="number">0</span>][<span class="number">2</span>] = <span class="number">1</span>; <span class="comment">// &gt; next time</span></div><div class="line">                used[D[i].second] = <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span> (m == <span class="number">0</span>)</div><div class="line">            ret++;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            ret = (ret + dp[i][m][<span class="number">0</span>])%mod;</div><div class="line">            <span class="built_in">memset</span>(used, <span class="number">0</span>, <span class="keyword">sizeof</span>(used));</div><div class="line"><span class="comment">//			for (int k = 0; k &lt;= m; k++) </span></div><div class="line"><span class="comment">//					printf("[%d %d] %d %d %d\n", i, k, dp[i][k][0], dp[i][k][1], dp[i][k][2]);</span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt; n; j++) &#123;					</div><div class="line">                <span class="keyword">if</span> (used[D[j].second])	<span class="keyword">continue</span>;</div><div class="line">                used[D[j].second] = <span class="number">1</span>;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;= m; k++) &#123;</div><div class="line">                    <span class="keyword">if</span> (D[j].second &gt; D[i].second) &#123; <span class="comment">// larger</span></div><div class="line">                        dp[j][k][<span class="number">0</span>] = (dp[j][k][<span class="number">0</span>] + dp[i][k][<span class="number">2</span>])%mod;</div><div class="line">                        dp[j][k+<span class="number">1</span>][<span class="number">1</span>] = (dp[j][k+<span class="number">1</span>][<span class="number">1</span>] + dp[i][k][<span class="number">2</span>])%mod;</div><div class="line">                        dp[j][k][<span class="number">2</span>] = (dp[j][k][<span class="number">2</span>] + dp[i][k][<span class="number">2</span>])%mod;</div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (D[j].second == D[i].second) &#123;</div><div class="line"><span class="comment">//						dp[j][k][0] = (dp[j][k][0] + dp[i][k][0])%mod;</span></div><div class="line"><span class="comment">//						dp[j][k][1] = (dp[j][k][1] + dp[i][k][0])%mod;</span></div><div class="line"><span class="comment">//						dp[j][k][2] = (dp[j][k][2] + dp[i][k][0])%mod;</span></div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        dp[j][k][<span class="number">0</span>] = (dp[j][k][<span class="number">0</span>] + dp[i][k][<span class="number">1</span>])%mod;</div><div class="line">                        dp[j][k][<span class="number">1</span>] = (dp[j][k][<span class="number">1</span>] + dp[i][k][<span class="number">1</span>])%mod;</div><div class="line">                        dp[j][k+<span class="number">1</span>][<span class="number">2</span>] = (dp[j][k+<span class="number">1</span>][<span class="number">2</span>] + dp[i][k][<span class="number">1</span>])%mod;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case %d: %d\n"</span>, ++cases, ret);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用 binary indexed tree 優化 O(nm log n)</p>
<p>使用前綴總和來完成狀態轉移。為了防止相同 <code>y[p] = y[q], p &lt; q</code>，由於會先拜訪到 p 進行狀態轉移，特別考慮 y[q] 基底的轉移狀態必須被扣除 y[p] 的結果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt; </div><div class="line">#include &lt;vector&gt;</div><div class="line">#include &lt;string.h&gt;</div><div class="line">#include &lt;algorithm&gt;</div><div class="line">#include &lt;map&gt;</div><div class="line">#include &lt;assert.h&gt;</div><div class="line">using namespace std;</div><div class="line"></div><div class="line">#define MAXN 10050</div><div class="line">int dp[MAXN][64][3] = &#123;&#125;;</div><div class="line">int UBIT[64][3][MAXN], DBIT[64][3][MAXN];</div><div class="line">int shift[64][3][MAXN] = &#123;&#125;;</div><div class="line">const int mod = 1000000;</div><div class="line">int query(int A[], int idx) &#123;</div><div class="line">    int sum = 0;</div><div class="line">    while (idx)</div><div class="line">        sum = (sum + A[idx])%mod, idx -= idx&amp;(-idx);</div><div class="line">    return sum;</div><div class="line">&#125;</div><div class="line">void modify(int A[], int idx, int val, int L) &#123;</div><div class="line">    while (idx &lt;= L)</div><div class="line">        A[idx] = (A[idx] + val)%mod, idx += idx&amp;(-idx);</div><div class="line">&#125;</div><div class="line">int main() &#123;</div><div class="line">//	freopen(&quot;in.txt&quot;, &quot;r+t&quot;, stdin);</div><div class="line">//	freopen(&quot;out2.txt&quot;, &quot;w+t&quot;, stdout);</div><div class="line">    int testcase, n, m, x, y;</div><div class="line">    int cases = 0;</div><div class="line">    scanf(&quot;%d&quot;, &amp;testcase);</div><div class="line">    while (testcase--) &#123;</div><div class="line">        scanf(&quot;%d %d&quot;, &amp;n, &amp;m);</div><div class="line">        vector&lt; pair&lt;int, int&gt; &gt; D;</div><div class="line">        map&lt;int, int&gt; R;</div><div class="line">        for (int i = 0; i &lt; n; i++) &#123;</div><div class="line">            scanf(&quot;%d %d&quot;, &amp;x, &amp;y);</div><div class="line">            R[y] = 0;</div><div class="line">            D.push_back(make_pair(x, y));</div><div class="line">        &#125;</div><div class="line">        sort(D.begin(), D.end());</div><div class="line">        int L = 1;</div><div class="line">        for (map&lt;int, int&gt;::iterator it = R.begin();</div><div class="line">            it != R.end(); it++)</div><div class="line">            it-&gt;second = L++;</div><div class="line">        for (int i = 0; i &lt; n; i++)</div><div class="line">            D[i].second = R[D[i].second];</div><div class="line">        memset(UBIT, 0, sizeof(UBIT));</div><div class="line">        memset(DBIT, 0, sizeof(DBIT));</div><div class="line">        memset(shift, 0, sizeof(shift));		</div><div class="line">        int used[10005] = &#123;&#125;;</div><div class="line">        for (int i = 0; i &lt; n; i++) &#123;</div><div class="line">            if (used[D[i].second] == 0) &#123;</div><div class="line">                shift[0][0][D[i].second] = -1; // =</div><div class="line">                used[D[i].second] = 1;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        modify(UBIT[0][1], 1, 1, L);</div><div class="line">        modify(UBIT[0][2], 1, 1, L);</div><div class="line">        int ret = 0;</div><div class="line">        if (m == 0)</div><div class="line">            ret++;</div><div class="line">        for (int i = 0; i &lt; n; i++) &#123;</div><div class="line">            for (int k = 0; k &lt;= m; k++) &#123;</div><div class="line">                int dp0 = query(UBIT[k][0], D[i].second) + query(DBIT[k][0], L - D[i].second-1) - shift[k][0][D[i].second];</div><div class="line">                int dp1 = query(UBIT[k][1], D[i].second) + query(DBIT[k][1], L - D[i].second-1) - shift[k][1][D[i].second];</div><div class="line">                int dp2 = query(UBIT[k][2], D[i].second) + query(DBIT[k][2], L - D[i].second-1) - shift[k][2][D[i].second];</div><div class="line">//				printf(&quot;[%d %d] %d %d %d\n&quot;, i, k, dp0, dp1, dp2);</div><div class="line">                dp0 %= mod, dp1 %= mod, dp2 %= mod;</div><div class="line">                shift[k][0][D[i].second] += dp0;</div><div class="line">                shift[k][1][D[i].second] += dp1;</div><div class="line">                shift[k][2][D[i].second] += dp2;</div><div class="line">                if (k == m)		ret = (ret + dp0)%mod;</div><div class="line">                if (dp2) &#123;</div><div class="line">                    modify(UBIT[k][0], D[i].second+1, dp2, L);</div><div class="line">                    modify(UBIT[k+1][1], D[i].second+1, dp2, L);</div><div class="line">                    modify(UBIT[k][2], D[i].second+1, dp2, L);</div><div class="line">                &#125;</div><div class="line">                if (dp1) &#123;</div><div class="line">                    modify(DBIT[k][0], L - D[i].second, dp1, L);</div><div class="line">                    modify(DBIT[k][1], L - D[i].second, dp1, L);</div><div class="line">                    modify(DBIT[k+1][2], L - D[i].second, dp1, L);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        printf(&quot;Case %d: %d\n&quot;, ++cases, (ret + mod)%mod);</div><div class="line">    &#125;</div><div class="line">    return 0;</div><div class="line">&#125;</div><div class="line">/*</div><div class="line">3</div><div class="line">3 0</div><div class="line">1 1</div><div class="line">2 1</div><div class="line">3 1</div><div class="line"></div><div class="line">3 1</div><div class="line">101 3</div><div class="line">102 2</div><div class="line">104 4</div><div class="line"></div><div class="line">3</div><div class="line">6 1</div><div class="line">320 3</div><div class="line">306 1</div><div class="line">401 3</div><div class="line">325 4</div><div class="line">393 5</div><div class="line">380 2</div><div class="line">4 1</div><div class="line">101 3</div><div class="line">102 2</div><div class="line">103 2</div><div class="line">104 4</div><div class="line">3 0</div><div class="line">102 2</div><div class="line">101 1</div><div class="line">103 3</div><div class="line">*/</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-11910" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/23/oj/uva/uva-11910/" class="article-date">
  <time datetime="2014-10-23T01:07:43.000Z" itemprop="datePublished">2014-10-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/23/oj/uva/uva-11910/">UVa 11910 - Closest Fractions</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/10/23/oj/uva/uva-11910/" data-id="ckq8np0zs030a1wvnwgv065r0" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/10/23/oj/uva/uva-11910/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/二分/">二分</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/建表/">建表</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>對於每一個浮點數，找到一個最靠近的分數，分子分母限制在 <code>[1, 1000]</code> 的整數。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">3.141592654</div><div class="line">66.66666666</div><div class="line">333.3333333</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Input : 3.141592654</div><div class="line">    1 : 3.141592920 =  355 / 113</div><div class="line">    2 : 3.141630901 =  732 / 233</div><div class="line">    3 : 3.141552511 =  688 / 219</div><div class="line">Input : 66.66666666</div><div class="line">    1 : 66.66666667 =  200 / 3</div><div class="line">    2 : 66.64285714 =  933 / 14</div><div class="line">    3 : 66.69230769 =  867 / 13</div><div class="line">Input : 333.3333333</div><div class="line">    1 : 333.3333333 = 1000 / 3</div><div class="line">    2 : 333.5000000 =  667 / 2</div><div class="line">    3 : 333.0000000 =  333 / 1</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>預先將所有分數建表，然後每一次二分搜索。</p>
<p>最麻煩在於輸出要保證長度 10 位，細讀 printf() 後，發現頂多限制小數點後的位數、小數點前的位數，如果要同時限制還是要自己來。</p>
<p>最後使用 <code>%*.*f</code>，<code>*</code> 號部分要自己帶入參數。如果用 substring 會造成四捨五入的地方消失而拿到 WA。</p>
<p>原本想不建表，直接用鄰近搜索，誤差害死人。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Frac</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">    <span class="keyword">int</span> x, y;</div><div class="line">    Frac(<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>):</div><div class="line">        x(a), y(b) &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">toDouble</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (<span class="keyword">double</span>) x/y;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Frac &amp;a) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> toDouble() &lt; a.toDouble();</div><div class="line">    &#125;</div><div class="line">&#125; D[<span class="number">1048576</span>];</div><div class="line"><span class="keyword">double</span> DD[<span class="number">1048576</span>];</div><div class="line"><span class="keyword">double</span> cmpv;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(Frac a, Frac b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">fabs</span>(a.toDouble() - cmpv) &lt; <span class="built_in">fabs</span>(b.toDouble() - cmpv);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">double</span> v)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (v &gt;= <span class="number">1000</span>)	<span class="keyword">return</span> <span class="number">4</span>;</div><div class="line">    <span class="keyword">if</span> (v &gt;= <span class="number">100</span>)	<span class="keyword">return</span> <span class="number">3</span>;</div><div class="line">    <span class="keyword">if</span> (v &gt;= <span class="number">10</span>)	<span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">//	freopen("in.txt", "r+t", stdin);</span></div><div class="line"><span class="comment">//	freopen("out.txt", "w+t", stdout); </span></div><div class="line">    <span class="keyword">int</span> n = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">1</span>; y &lt;= <span class="number">1000</span>; y++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt;= <span class="number">1000</span>; x++) &#123;</div><div class="line">            <span class="keyword">if</span> (__gcd(x, y) == <span class="number">1</span>)</div><div class="line">                D[n++] = Frac(x, y);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    sort(D, D + n);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">        DD[i] = D[i].toDouble();</div><div class="line">    <span class="keyword">char</span> s[<span class="number">32</span>];</div><div class="line">    <span class="keyword">double</span> v;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%s"</span>, s) == <span class="number">1</span>) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Input : %s\n"</span>, s);</div><div class="line">        <span class="built_in">sscanf</span>(s, <span class="string">"%lf"</span>, &amp;v);</div><div class="line">        <span class="keyword">int</span> pos = lower_bound(DD, DD + n, v) - DD;</div><div class="line">        <span class="built_in">vector</span>&lt;Frac&gt; A;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = max(<span class="number">0</span>, pos - <span class="number">6</span>); i &lt; min(n, pos + <span class="number">6</span>); i++)</div><div class="line">            A.push_back(D[i]);</div><div class="line">        cmpv = v;</div><div class="line">        sort(A.begin(), A.end(), cmp);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">1</span>; i &lt; <span class="number">3</span> &amp;&amp; i &lt; A.size(); i++, j++)</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"    %d : %*.*lf = %4d / %d\n"</span>, j, f(A[i].toDouble()), <span class="number">10</span> - f(A[i].toDouble()), A[i].toDouble(), A[i].x, A[i].y);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-11768" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/23/oj/uva/uva-11768/" class="article-date">
  <time datetime="2014-10-23T01:02:42.000Z" itemprop="datePublished">2014-10-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/23/oj/uva/uva-11768/">UVa 11768 - Lattice Point or Not</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/10/23/oj/uva/uva-11768/" data-id="ckq8np0yn02z51wvnq57cn1p9" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/10/23/oj/uva/uva-11768/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/擴充歐幾里德/">擴充歐幾里德</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>給一個浮點數一位的線段，請問中間經過多少個整數點。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">3</div><div class="line">10.1 10.1 11.2 11.2</div><div class="line">10.2 100.3 300.3 11.1</div><div class="line">1.0 1.0 2.0 2.0</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">0</div><div class="line">2</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>找到原本線段 ax + by = c 的線，為了使其落在整數座標上調整為 10a x + 10b y = c，在這個情況下找到符合的 (x, y) 整數解，但是其結果要被限制上線段上。</p>
<p>努力地做細部微調 …</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">gcd</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x, <span class="keyword">long</span> <span class="keyword">long</span> y)</span> </span>&#123;</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> t;</div><div class="line">    <span class="keyword">while</span> (x%y)</div><div class="line">        t = x, x = y, y = t%y; </div><div class="line">    <span class="keyword">return</span> y;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">exgcd</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x, <span class="keyword">long</span> <span class="keyword">long</span> y, <span class="keyword">long</span> <span class="keyword">long</span> &amp;a, <span class="keyword">long</span> <span class="keyword">long</span> &amp;b)</span> </span>&#123;</div><div class="line">    <span class="comment">// ax + by = gcd(x,y)</span></div><div class="line">    <span class="keyword">int</span> flag = <span class="number">0</span>;</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> t, la = <span class="number">1</span>, lb = <span class="number">0</span>, ra = <span class="number">0</span>, rb = <span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span>(x%y) &#123;</div><div class="line">        <span class="keyword">if</span>(flag == <span class="number">0</span>)</div><div class="line">            la -= x/y*ra, lb -= x/y*rb;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            ra -= x/y*la, rb -= x/y*lb;</div><div class="line">        t = x, x = y, y = t%y;</div><div class="line">        flag = <span class="number">1</span> - flag;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(flag == <span class="number">0</span>)</div><div class="line">        a = ra, b = rb;</div><div class="line">    <span class="keyword">else</span></div><div class="line">        a = la, b = lb;</div><div class="line">    <span class="keyword">return</span> y;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">countSolution</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> n1, <span class="keyword">long</span> <span class="keyword">long</span> n2, <span class="keyword">long</span> <span class="keyword">long</span> n, </span></span></div><div class="line"><span class="function"><span class="params">					<span class="keyword">long</span> <span class="keyword">long</span> lx, <span class="keyword">long</span> <span class="keyword">long</span> rx, <span class="keyword">long</span> <span class="keyword">long</span> ly, <span class="keyword">long</span> <span class="keyword">long</span> ry)</span> </span>&#123;</div><div class="line"><span class="comment">//	printf("%lld %lld %lld\n", n1, n2, n);</span></div><div class="line">    <span class="keyword">if</span> (lx &gt; rx || ly &gt; ry)	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span> (n1 == <span class="number">0</span>)	<span class="keyword">return</span> rx - lx + <span class="number">1</span>;</div><div class="line">    <span class="keyword">if</span> (n2 == <span class="number">0</span>)	<span class="keyword">return</span> ry - ly + <span class="number">1</span>;</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> a, b, g;</div><div class="line">    g = exgcd(n1, n2, a, b); <span class="comment">// a*n1 + b*n2 = gcd(n1,2)</span></div><div class="line">    <span class="keyword">if</span>(n%g) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> k = n/g, k1, k2;</div><div class="line">    a *= k, b *= k;<span class="comment">// a*n1 + b*n2 = n</span></div><div class="line">    <span class="comment">// (a+F)*n1 + (b+G)*n2 = n =&gt;  Fn1 + Gn2 = 0, F = lcm(n1, n2)/n1 * i, G = lcm(n1, n2)/n2 * i</span></div><div class="line">    k1 = n1*n2/g/n1, k2 = n1*n2/g/n2;</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> x1, x2, x3, x4, y1, y2, y3, y4;</div><div class="line">    k = (a - lx)/k1;</div><div class="line">    a -= k*k1, b += k*k2;</div><div class="line">    <span class="keyword">while</span> (a &lt; lx) &#123;</div><div class="line">    	<span class="keyword">if</span> (k1 &lt; <span class="number">0</span>)	a -= k1, b += k2;</div><div class="line">    	<span class="keyword">else</span>		a += k1, b -= k2;</div><div class="line">    &#125;</div><div class="line">    x1 = a, y1 = b;</div><div class="line">    </div><div class="line">    k = (b - ly)/k2;</div><div class="line">    a += k*k1, b -= k*k2;  </div><div class="line">    <span class="keyword">while</span> (b &lt; ly) &#123;</div><div class="line">    	<span class="keyword">if</span> (k2 &lt; <span class="number">0</span>)	a += k1, b -= k2;</div><div class="line">    	<span class="keyword">else</span>		a -= k1, b += k2;</div><div class="line">    &#125;</div><div class="line">    x3 = a, y3 = b;  </div><div class="line">    </div><div class="line">    k = (a - rx)/k1;</div><div class="line">    a -= k*k1, b += k*k2;</div><div class="line">    <span class="keyword">while</span> (a &gt; rx) &#123;</div><div class="line">    	<span class="keyword">if</span> (k1 &lt; <span class="number">0</span>)	a += k1, b -= k2;</div><div class="line">    	<span class="keyword">else</span>		a -= k1, b += k2;</div><div class="line">    &#125;</div><div class="line">    x2 = a, y2 = b;</div><div class="line">    </div><div class="line">    k = (b - ry)/k2;</div><div class="line">    a += k*k1, b -= k*k2;</div><div class="line">    <span class="keyword">while</span> (b &gt; ry) &#123;</div><div class="line">    	<span class="keyword">if</span> (k2 &lt; <span class="number">0</span>)	a -= k1, b += k2;</div><div class="line">    	<span class="keyword">else</span>		a += k1, b -= k2;</div><div class="line">    &#125;</div><div class="line">    x4 = a, y4 = b;</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> l1 = <span class="number">0</span>, r1 = (x2 - x1)/ k1;</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> l2 = (x3 - x1)/k1, r2 = (x4 - x1)/k1;</div><div class="line">    <span class="keyword">if</span> (l2 &gt; r2)	swap(l2, r2);</div><div class="line">    <span class="keyword">if</span> (x1 &gt; x2 || y3 &gt; y4)	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"><span class="comment">//    printf("%lld %lld %lld %lld\n", x1, y1, x2, y2);</span></div><div class="line"><span class="comment">//    printf("%lld %lld %lld %lld\n", x3, y3, x4, y4);</span></div><div class="line"><span class="comment">//    printf("%lld %lld %lld %lld\n", l1, r1, l2, r2);</span></div><div class="line">    l1 = max(l1, l2), r1 = min(r1, r2);</div><div class="line">    <span class="keyword">if</span> (l1 &lt;= r1)	<span class="keyword">return</span> r1 - l1 + <span class="number">1</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">read1Float</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> x, y;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%lld.%lld"</span>, &amp;x, &amp;y);</div><div class="line">    <span class="keyword">return</span> x * <span class="number">10</span> + y;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;    </div><div class="line"><span class="comment">//	freopen("in.txt","r+t",stdin);</span></div><div class="line"><span class="comment">//  freopen("out2.txt","w+t",stdout);</span></div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> sx, sy, ex, ey;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        sx = read1Float();</div><div class="line">        sy = read1Float();</div><div class="line">        ex = read1Float();</div><div class="line">        ey = read1Float();</div><div class="line">        <span class="keyword">long</span> <span class="keyword">long</span> minx, miny, maxx, maxy;</div><div class="line">        minx = <span class="built_in">ceil</span>(min(sx, ex)/<span class="number">10.0</span>);</div><div class="line">        maxx = <span class="built_in">floor</span>(max(sx, ex)/<span class="number">10.0</span>);</div><div class="line">        miny = <span class="built_in">ceil</span>(min(sy, ey)/<span class="number">10.0</span>);</div><div class="line">        maxy = <span class="built_in">floor</span>(max(sy, ey)/<span class="number">10.0</span>);</div><div class="line">        <span class="keyword">long</span> <span class="keyword">long</span> a, b, c;</div><div class="line">        a = (ey - sy), b = (sx - ex), c = (a * sx + b * sy);</div><div class="line">        a = a * <span class="number">10</span>, b = b * <span class="number">10</span>;</div><div class="line"><span class="comment">//		printf("[%lld %lld] [%lld %lld]\n", minx, maxx, miny, maxy);</span></div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, countSolution(a, b, c, minx, maxx, miny, maxy));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">5</span></div><div class="line"><span class="comment">10.1 10.1 11.2 11.2</span></div><div class="line"><span class="comment">10.2 100.3 300.3 11.1</span></div><div class="line"><span class="comment">1.0 1.0 2.0 2.0</span></div><div class="line"><span class="comment">1.0 1.0 1.0 1.0</span></div><div class="line"><span class="comment">1.0 3.0 1.0 7.0</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">100</span></div><div class="line"><span class="comment">74779.7 170072.4 114261.9 224.6</span></div><div class="line"><span class="comment">12284.7 149345.2 89292.2 24355.6</span></div><div class="line"><span class="comment">119238.0 59748.9 153776.5 88822.9</span></div><div class="line"><span class="comment">146984.2 79235.1 116519.4 144150.1</span></div><div class="line"><span class="comment">75703.5 8776.5 147012.5 132491.5</span></div><div class="line"><span class="comment">93698.8 27585.7 137374.4 134649.2</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">100</span></div><div class="line"><span class="comment">142566.2 47373.1 4487.9 81130.6</span></div><div class="line"><span class="comment">122932.1 117873.7 7944.5 24862.7</span></div><div class="line"><span class="comment">164852.3 50346.6 58670.9 47341.7</span></div><div class="line"><span class="comment">140828.3 21325.9 141292.5 16763.8</span></div><div class="line"><span class="comment">144206.3 130562.5 96260.1 53203.7</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">100</span></div><div class="line"><span class="comment">175593.7 137910.8 151744.6 21975.7</span></div><div class="line"><span class="comment">66918.0 141841.9 170688.8 108941.3</span></div><div class="line"><span class="comment">110334.9 103217.3 145166.0 126201.0</span></div><div class="line"><span class="comment">40233.7 62521.1 116634.3 146758.8</span></div><div class="line"><span class="comment">187820.7 131930.2 69771.4 66737.3</span></div><div class="line"><span class="comment">*/</span></div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/53/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/52/">52</a><a class="page-number" href="/page/53/">53</a><span class="page-number current">54</span><a class="page-number" href="/page/55/">55</a><a class="page-number" href="/page/56/">56</a><span class="space">&hellip;</span><a class="page-number" href="/page/85/">85</a><a class="extend next" rel="next" href="/page/55/">Next &raquo;</a>
    </nav>
  
</section>
          
          
            <aside id="sidebar">
  <!-- <div id="ukagaka_panel"></div> -->
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">115</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算機圖學/">計算機圖學</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/">工作應用</a><span class="category-list-count">32</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Java/">Java</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Meme/">Meme</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/可持久化/">可持久化</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/鬼故事/">鬼故事</a><span class="category-list-count">10</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">633</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">483</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">77</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">45</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2021/06/21/diary-202106/">
              
                <i class="icon-file-o"></i> 
              
            疫情下的工作變化</a>
          </li>
        
          <li>
            <a class="text" href="/2021/06/21/work/company-ghost-story-10/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 10</a>
          </li>
        
          <li>
            <a class="text" href="/2021/05/30/diary-202105/">
              
                <i class="icon-file-o"></i> 
              
            前思後想 新居落成</a>
          </li>
        
          <li>
            <a class="text" href="/2021/05/30/java/java-memory-optimization-2/">
              
                <i class="icon-file-o"></i> 
              
            Java 優化內存使用 組合篇</a>
          </li>
        
          <li>
            <a class="text" href="/2021/05/30/java/java-memory-optimization-1/">
              
                <i class="icon-file-o"></i> 
              
            Java 優化內存使用 結構篇</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/diary-202101/">
              
                <i class="icon-file-o"></i> 
              
            二八進展</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-globl-var/">
              
                <i class="icon-file-o"></i> 
              
            Global Variable</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-file-extension/">
              
                <i class="icon-file-o"></i> 
              
            File Extension</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-handover/">
              
                <i class="icon-file-o"></i> 
              
            Handover</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-interview-recursion/">
              
                <i class="icon-file-o"></i> 
              
            Interview &amp; Recursion</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
  
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2021 Shiang-Yun Yang 
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>