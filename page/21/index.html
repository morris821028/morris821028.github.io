<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Morris&#39; Blog">
<meta property="og:url" content="http://morris821028.github.io/page/21/index.html">
<meta property="og:site_name" content="Morris&#39; Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris&#39; Blog">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
  <link rel="import" href="/bower_components/app-layout/app-layout.html"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          
          <section id="main">
  
    <article id="post-zj-b418" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/07/02/zj-b418/" class="article-date">
  <time datetime="2015-07-01T22:15:41.000Z" itemprop="datePublished">2015-07-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/02/zj-b418/">b418. 八成真物</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/07/02/zj-b418/" data-id="ckh8skfvt00zn78vr9dtgqlmm" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/07/02/zj-b418/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bitset/">bitset</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/窮舉/">窮舉</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><blockquote>
<p>「偽物比真物更有價值」—貝木泥舟<br>「真物和偽物一樣有價值」—忍野咩咩<br>「偽娘比真娘更有價值」—精英島民</p>
</blockquote>
<p>任兩個物品的相似度<span>$sim(A, B) = \frac{|A \cap B|}{|A \cup B|}$</span><!-- Has MathJax -->，換句話說把 <span>$A$</span><!-- Has MathJax --> 具有的特徵和 <span>$B$</span><!-- Has MathJax --> 具有的特徵類型取交集、聯集個數，相除就能得到其相似度。例如有 5 個特徵，若 A 表示成 11001、B 表示成 01100<span>$sim(A, B) = \frac{|{2}|}{|{1, 2, 3, 5}|} = 0.25$</span><!-- Has MathJax -->。</p>
<p>現在盤面上有 N 個物品、M 種特徵，請問相似度大於等於 0.8 的相似對數 <span>$S$</span><!-- Has MathJax --> 有多少種。為了讓這一題更有趣味，算法允許偽物，輸出<span>$\frac{S}{N(N-1)/2} \times 100$</span><!-- Has MathJax -->。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">8 10</div><div class="line">0111101101</div><div class="line">0111101100</div><div class="line">0111101100</div><div class="line">0111101101</div><div class="line">1100101010</div><div class="line">0111101100</div><div class="line">0111101100</div><div class="line">0011101111</div><div class="line">  </div><div class="line">8 10</div><div class="line">1111101100</div><div class="line">1011101100</div><div class="line">1010101100</div><div class="line">1010111010</div><div class="line">0100110100</div><div class="line">1011101100</div><div class="line">1110110000</div><div class="line">1011111100</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">53.57</div><div class="line">25.00</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>利用 <code>std::bitset</code> 加速交集和聯集運算，將數個屬性壓縮到一個 32-bits 單位，然後藉 bitcount 盡可能在 <span>$O(1)$</span><!-- Has MathJax --> 的時間內完成，就有機會通過這一題。一般的 <span>$O(N^2 M)$</span><!-- Has MathJax --> 比 <span>$O(N^2 M/32)$</span><!-- Has MathJax --> 慢個五六倍。</p>
<p>此外，特別小心浮點數計算誤差，<code>5.0/4.0 &gt;= 0.8 == false</code>，用乘法判定大於閥值的操作。</p>
<p>關於 LSH 的部分，還在進行測試，若 signature 計算太慢，還不如直接暴力法，若能分散找到 signature 或者是預先有辦法處理好，那分桶計算就會好一點。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt; </span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n, m;</div><div class="line">    <span class="keyword">char</span> s[<span class="number">1024</span>];</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;n, &amp;m) == <span class="number">2</span>) &#123;</div><div class="line">        <span class="built_in">bitset</span>&lt;512&gt; attr[n];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>, s);</div><div class="line">            attr[i] = <span class="built_in">bitset</span>&lt;<span class="number">512</span>&gt;(s);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">double</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt; n; j++) &#123;</div><div class="line">                <span class="keyword">int</span> a = (attr[i]&amp;attr[j]).count();</div><div class="line">                <span class="keyword">int</span> b = (attr[i]|attr[j]).count();</div><div class="line">                <span class="keyword">if</span> (<span class="number">5</span> * a &gt;= <span class="number">4</span> * b)</div><div class="line">                    ret++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%.2lf\n"</span>, ret * <span class="number">100</span> / (n * (n<span class="number">-1</span>)/<span class="number">2</span>));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-zj-b413" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/29/zj-b413/" class="article-date">
  <time datetime="2015-06-28T23:09:51.000Z" itemprop="datePublished">2015-06-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/29/zj-b413/">b413. 虛擬女友</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/29/zj-b413/" data-id="ckh8skfvl00zd78vrae9yofuz" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/29/zj-b413/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/并查集/">并查集</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>曾經有一部採訪影片《BBC 紀錄片：別和日本人談性 No Sex. We’re Japanese.》在網路上流傳，其中有一段談到虛擬遊戲中的生活，不少男性以遊戲中的女角發生關係，其中以一款遊戲「Love Plus」為大宗，即使是擁有現實和虛擬的生活，若要選擇其中一方站，不少男性仍然「我選擇死亡」回答。</p>
<p>現在先不解決男女雙方的問題、在彼此關係上要如何運作，如何回到早些年沒有遊戲機、沒有網路、更沒有虛擬女友的交際生活，只有同性朋友要怎麼交流呢？於是有一場專門為這些男性舉行的一場交友會，規則如下所述：</p>
<ul>
<li>一開始全場男性都彼此不認識</li>
<li>每一個男性分別喜歡各自的虛擬女友 (可以是同一個)</li>
<li>每一個時刻，其中兩個男性會因談論遊戲而成為朋友</li>
<li>自己朋友的朋友也會成為朋友</li>
<li>如果朋友的虛擬女友的類型不同，他們有可能會因偏好女友類型不同而爭吵，稱為不穩定對。</li>
</ul>
<p>請問每一個時刻下，有多少穩定對朋友。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">2</div><div class="line"></div><div class="line">3 2</div><div class="line">1 2 1</div><div class="line">1 2</div><div class="line">2 3</div><div class="line"></div><div class="line">4 4</div><div class="line">1 2 2 1</div><div class="line">1 2</div><div class="line">2 3</div><div class="line">1 3</div><div class="line">2 4</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">0</div><div class="line">1</div><div class="line">0</div><div class="line">1</div><div class="line">1</div><div class="line">2</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>IPSC 2015 F 那一題發生於男女雙方都會進行聯集，而這一題只有男方會進行聯集。</p>
<p>合併兩團男時，只有下標 (女友類型) 相同會成為穩定對，可以利用合併排序來完成，能發生合併表示男的彼此之間不認識，只要考慮有多少女方相同即可。每一次將小堆合併到大堆中，由於要計數合併複雜度需要 <span>$O(min(|A|, |B|) \times \log N)$</span><!-- Has MathJax -->，若搭配 hash 可以降到 <span>$O(min(|A|, |B|)$</span><!-- Has MathJax -->。一般并查集 joint 複雜度為 <span>$O(1)$</span><!-- Has MathJax -->，整體操作只需要 <span>$O(N)$</span><!-- Has MathJax -->，但為了要計數，整體的複雜度為 <span>$O(N \log N)$</span><!-- Has MathJax -->。</p>
<p>可以選擇合併排序來完成，每一次把兩堆的女方列出來，把兩堆相同類型的次數相乘，列出來可以循序做，或者是串列完成，每一次保證堆裡面的女方順序是由小排到大，合併複雜度就為 <span>$O(|A| + |B|)$</span><!-- Has MathJax -->，均攤下複雜度為 <span>$O(N \log N)$</span><!-- Has MathJax -->，當測資不夠隨機複雜度會掉到 <span>$O(N^2)$</span><!-- Has MathJax -->，情況是每一次只把大小為 1 的堆合併到大小 i-1 的堆。</p>
<p>在測資隨機生成下，第二種作法會來得比第一種快。第一種做法要搭配 <code>ordered_map</code> 或者是 <code>unordered_map</code>，寫起來會比較不方便。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">65536</span>;</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; son[MAXN];</div><div class="line"><span class="keyword">int</span> parent[MAXN], A[MAXN];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, n, m;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;n, &amp;m);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;A[i]);</div><div class="line">        <span class="keyword">long</span> <span class="keyword">long</span> tot_pair = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> x, y;</div><div class="line">        <span class="built_in">map</span>&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;, <span class="keyword">int</span> &gt; R;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            parent[i] = i;</div><div class="line">            son[i].resize(<span class="number">1</span>, i);</div><div class="line">            R[pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;(i, A[i])] = <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;x, &amp;y);</div><div class="line">            x--, y--;</div><div class="line">            x = parent[x], y = parent[y];</div><div class="line">            <span class="keyword">if</span> (x != y) &#123; <span class="comment">// merge small to large</span></div><div class="line">                <span class="keyword">if</span> (son[x].size() &gt; son[y].size())</div><div class="line">                    swap(x, y);</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e: son[x]) &#123;</div><div class="line">                    pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; t(parent[e], A[e]);</div><div class="line">                    R[t]--;</div><div class="line">                    <span class="keyword">if</span> (R[t] == <span class="number">0</span>)  R.erase(t);</div><div class="line">                    parent[e] = y;</div><div class="line">                    son[y].push_back(e);</div><div class="line">                    tot_pair += R[pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;(parent[e], A[e])];</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e: son[x])</div><div class="line">                    R[pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;(parent[e], A[e])]++;</div><div class="line">                son[x].clear();</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, tot_pair);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-zj-b416" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/27/zj-b416/" class="article-date">
  <time datetime="2015-06-27T13:34:13.000Z" itemprop="datePublished">2015-06-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/27/zj-b416/">b416. 誤會妹子序列</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/27/zj-b416/" data-id="ckh8skfvu00zp78vrgcijv8k5" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/27/zj-b416/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BIT/">BIT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/可持久化/">可持久化</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/掃描線/">掃描線</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/莫隊算法/">莫隊算法</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>在 2015 年 6 月的 Facebook 上，不少以「靠北」為前綴命名的粉絲頁面，就如 靠北工程師 為例，不少業界工程師匿名在上面抱怨工作過時、主管、生活 … 等。突然有一篇 #靠北工程師7257 抱怨著編程競賽的零零種種，從回應中能明白存在業界工程師不清楚編程競賽，以 UI 介面、cmd 指令 … 等方式理解比賽的目標、運行。</p>
<p>網路處處有答案，演算法和資料結構到底重不重要？抄下來能用就行，大部分的要求是不講求效率的，但對於曾經在編程競賽待過一陣子的小夥伴而言，看到他們的理解方式開始感到憤憤不平，進行了一陣子的爭吵。</p>
<p>過一陣子，大批的學生開始進入 靠北工程師 裡發文，開始爭論學校、系所哪個是比較有未來的，突然間有一位資管系的同學發問這一道算法題 ‪#‎靠北工程師7780‬ ，結果一不小心就看錯題目，把種類數誤看成個數，於是討論了不少其他的算法來完成，現在就把這個問題交給你。</p>
<p>用各種算法解決這個誤解的題目。</p>
<h3 id="問題描述"><a href="#問題描述" class="headerlink" title="問題描述"></a>問題描述</h3><p>Autumn 和 Bakser 又在研究 Gty 的妹子序列了！</p>
<p>但他們遇到了一個難題，對於一段妹子們，他們想讓你幫忙求出這之內美麗度 <span>$s_i \in [a, b]$</span><!-- Has MathJax --> 的妹子個數。為了方便，我們規定妹子們的美麗度全都在 <span>$[1,n]$</span><!-- Has MathJax --> 中。</p>
<p>給定一個長度為 <span>$n$</span><!-- Has MathJax --> ( <span>$1 \le n \le 100000$</span><!-- Has MathJax --> ) 的正整數序列 <span>$s$</span><!-- Has MathJax --> (<span>$1 \le s_i \le n$</span><!-- Has MathJax -->)，對於 <span>$m$</span><!-- Has MathJax --> ( <span>$1 \le m \le 1000000$</span><!-- Has MathJax -->) 次詢問 <span>$l, r, a, b$</span><!-- Has MathJax -->，每次輸出 <span>$[s_l, \text{... },s_r]$</span><!-- Has MathJax --> 中，權值 <span>$s_i \in [a, b]$</span><!-- Has MathJax --> 的個數。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">10 10</div><div class="line">4 4 5 1 4 1 5 1 2 1</div><div class="line">5 9 1 2</div><div class="line">3 4 7 9</div><div class="line">4 4 2 5</div><div class="line">2 3 4 7</div><div class="line">5 10 4 4</div><div class="line">3 9 1 1</div><div class="line">1 4 5 9</div><div class="line">8 9 3 3</div><div class="line">2 2 1 6</div><div class="line">8 9 1 4</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">3</div><div class="line">0</div><div class="line">0</div><div class="line">2</div><div class="line">1</div><div class="line">3</div><div class="line">1</div><div class="line">0</div><div class="line">1</div><div class="line">2</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>相較於 b414. BZOJ 3809 Gty 的二逼妹子序列 解法會相對多樣，單純計數就會變得比較簡單。</p>
<p>在這一題中，這裡提供三種解法：</p>
<ul>
<li>莫隊算法<br>只能離線處理，無法強制在線詢問，算法複雜度由分塊降到 <span>$O(N^{1.5})$</span><!-- Has MathJax -->。可參考 b414 的解法。</li>
<li>掃描線 + BIT<br>只能離線處理，把題目轉換成二維情況 <span>$(i, A[i])$</span><!-- Has MathJax -->，詢問相當於找到矩形內部 <span>$[l, r] \times [a, b]$</span><!-- Has MathJax --> 有多少點座標，所以可以當作二維前綴來完成計數 <span>$f(l, r, a, b) = f(r, b) - f(l-1, b) - f(r, a-1) - f(l-1, a-1)$</span><!-- Has MathJax -->。<span>$f(x, y)$</span><!-- Has MathJax --> 表示從原點 <span>$(0, 0)$</span><!-- Has MathJax --> 到 <span>$(x, y)$</span><!-- Has MathJax --> 的點數量，這樣的方式記憶體過多，利用掃描線算法降下來，對 x 由小掃描到大，依序將點插入詢問 <span>$f(x, y)$</span><!-- Has MathJax --> 會在掃瞄到 x 時，詢問 <span>$[0, y]$</span><!-- Has MathJax --> 之間的累計個數得到，最後將每一個詢問離線成四個詢問，掃描一次即可。</li>
<li>可持久化線段樹<br>必須預處理，支持在線詢問，不帶操作修改。將序列權值排序 <span>$(A[i], i)$</span><!-- Has MathJax -->，依序索引值插入線段樹，紀錄每一個插入完的線段樹狀態，接著當詢問 <span>$l, r, a, b$</span><!-- Has MathJax -->，相當於在版本 <code>ver_b - ver_a</code> 查詢線段樹區間 <span>$[l, r]$</span><!-- Has MathJax --> 的總和。由於是計數符合區間減法才能這樣做，否則持久化線段樹還要套別的小技巧來完成。</li>
</ul>
<p>補充一點，雖然 KD-tree 效能是 <span>$O(\sqrt{N} + K)$</span><!-- Has MathJax -->，它也支持 range searching，但必須搭配 report K 操作，那個 <span>$O(\sqrt{N})$</span><!-- Has MathJax --> 的花費是伴隨著 report 存在，因此單一筆計數詢問是無法達到 <span>$O(\sqrt{N})$</span><!-- Has MathJax -->，天真的我寫下去直接 TLE。</p>
<h3 id="莫隊算法"><a href="#莫隊算法" class="headerlink" title="莫隊算法"></a>莫隊算法</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt; </span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100005</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">100005</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">1000005</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXSQRTV = <span class="number">512</span>;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Offline</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Event</span> &#123;</span></div><div class="line">        <span class="keyword">static</span> <span class="keyword">int</span> PILE, belong[MAXV];</div><div class="line">        <span class="keyword">int</span> l, r, x, y, qid;</div><div class="line">        Event(<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>, <span class="keyword">int</span> d = <span class="number">0</span>, <span class="keyword">int</span> e = <span class="number">0</span>):</div><div class="line">            l(a), r(b), x(c), y(d), qid(e) &#123;&#125;</div><div class="line">        <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Event &amp;x) <span class="keyword">const</span> &#123;</div><div class="line">            <span class="keyword">if</span> (belong[l] != belong[x.l])</div><div class="line">                <span class="keyword">return</span> l &lt; x.l;</div><div class="line">            <span class="keyword">return</span> r &lt; x.r; </div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">int</span> A[MAXN], N, qsize;</div><div class="line">    Event event[MAXQ];</div><div class="line">    <span class="keyword">int</span> ret[MAXQ];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>-&gt;N = N, qsize = <span class="number">0</span>;</div><div class="line">        <span class="built_in">memset</span>(pile, <span class="number">0</span>, <span class="keyword">sizeof</span>(pile));</div><div class="line">        <span class="built_in">memset</span>(val_count, <span class="number">0</span>, <span class="keyword">sizeof</span>(val_count));</div><div class="line">        val_PILE = Event::PILE = <span class="built_in">sqrt</span>(N);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = N; i &gt;= <span class="number">1</span>; i--)</div><div class="line">            val_belong[i] = Event::belong[i] = i / Event::PILE;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">q_add</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">        event[qsize] = Event(l, r, a, b, qsize);</div><div class="line">        qsize++;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        sort(event, event+qsize);</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> l = <span class="number">1</span>, r = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; qsize; i++) &#123;</div><div class="line">            <span class="keyword">while</span> (r &lt; event[i].r)	r++, update(A[r], <span class="number">1</span>);</div><div class="line">            <span class="keyword">while</span> (r &gt; event[i].r)	update(A[r], <span class="number">-1</span>), r--;</div><div class="line">            <span class="keyword">while</span> (l &gt; event[i].l)	l--, update(A[l], <span class="number">1</span>);</div><div class="line">            <span class="keyword">while</span> (l &lt; event[i].l)	update(A[l], <span class="number">-1</span>), l++;</div><div class="line">            ret[event[i].qid] = query(event[i].x, event[i].y);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="comment">// unrolled</span></div><div class="line">    <span class="keyword">int</span> pile[MAXSQRTV], val_count[MAXV], val_belong[MAXV], val_PILE;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">        val_count[x] += val;</div><div class="line">        pile[val_belong[x]] += val;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span> (val_belong[a] == val_belong[b]) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = a; i &lt;= b; i++)</div><div class="line">                ret += val_count[i];</div><div class="line">            <span class="keyword">return</span> ret;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = val_belong[a]+<span class="number">1</span>; i &lt; val_belong[b]; i++)</div><div class="line">            ret += pile[i];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = (val_belong[a]+<span class="number">1</span>)*val_PILE<span class="number">-1</span>; i &gt;= a; i--)</div><div class="line">            ret += val_count[i];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = (val_belong[b])*val_PILE; i &lt;= b; i++)</div><div class="line">            ret += val_count[i];</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">&#125; off;</div><div class="line"><span class="keyword">int</span> Offline::Event::PILE = <span class="number">16</span>, Offline::Event::belong[MAXV];</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> mLocalStream &#123;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readchar</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> buf[N];</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> *p = buf, *end = buf;</div><div class="line">        <span class="keyword">if</span>(p == end) &#123;</div><div class="line">            <span class="keyword">if</span>((end = buf + fread(buf, <span class="number">1</span>, N, <span class="built_in">stdin</span>)) == buf) <span class="keyword">return</span> EOF;</div><div class="line">            p = buf;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> *p++;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ReadInt</span><span class="params">(<span class="keyword">int</span> *x)</span> </span>&#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> c, neg;</div><div class="line">        <span class="keyword">while</span>((c = readchar()) &lt; <span class="string">'-'</span>)    &#123;<span class="keyword">if</span>(c == EOF) <span class="keyword">return</span> <span class="number">0</span>;&#125;</div><div class="line">        neg = (c == <span class="string">'-'</span>) ? <span class="number">-1</span> : <span class="number">1</span>;</div><div class="line">        *x = (neg == <span class="number">1</span>) ? c-<span class="string">'0'</span> : <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span>((c = readchar()) &gt;= <span class="string">'0'</span>)</div><div class="line">            *x = (*x &lt;&lt; <span class="number">3</span>) + (*x &lt;&lt; <span class="number">1</span>) + c-<span class="string">'0'</span>;</div><div class="line">        *x *= neg;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Print</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">        <span class="keyword">char</span> buf[N], *p, *end;</div><div class="line">        Print() &#123;</div><div class="line">            p = buf, end = buf + N - <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">printInt</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">            <span class="keyword">static</span> <span class="keyword">char</span> stk[<span class="number">16</span>];</div><div class="line">            <span class="keyword">int</span> idx = <span class="number">0</span>;</div><div class="line">            stk[idx++] = <span class="string">'\n'</span>;</div><div class="line">            <span class="keyword">if</span> (!x)	</div><div class="line">                stk[idx++] = <span class="string">'0'</span>;</div><div class="line">            <span class="keyword">while</span> (x)</div><div class="line">                stk[idx++] = x%<span class="number">10</span> + <span class="string">'0'</span>, x /= <span class="number">10</span>;</div><div class="line">            <span class="keyword">while</span> (idx) &#123;</div><div class="line">                <span class="keyword">if</span> (p == end) &#123;</div><div class="line">                    *p = <span class="string">'\0'</span>;</div><div class="line">                    <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf), p = buf;</div><div class="line">                &#125;</div><div class="line">                *p = stk[--idx], p++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        ~Print() &#123;</div><div class="line">            *p = <span class="string">'\0'</span>;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf);</div><div class="line">        &#125;		</div><div class="line">    &#125; bprint;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n, m, l, r, a, b;</div><div class="line">    <span class="keyword">while</span> (mLocalStream::ReadInt(&amp;n)) &#123;</div><div class="line">        mLocalStream::ReadInt(&amp;m);</div><div class="line">        off.init(n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</div><div class="line">            mLocalStream::ReadInt(&amp;off.A[i]);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            mLocalStream::ReadInt(&amp;l);</div><div class="line">            mLocalStream::ReadInt(&amp;r);</div><div class="line">            mLocalStream::ReadInt(&amp;a);</div><div class="line">            mLocalStream::ReadInt(&amp;b);</div><div class="line">            off.q_add(l, r, a, b);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        off.run();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</div><div class="line">            mLocalStream::bprint.printInt(off.ret[i]);</div><div class="line"><span class="comment">//			printf("%d\n", off.ret[i]);</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="掃描線"><a href="#掃描線" class="headerlink" title="掃描線"></a>掃描線</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//#include &lt;bits/stdc++.h&gt;</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100005</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">1000005</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Event</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> y, qid, qtype;</div><div class="line">    Event(<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>):</div><div class="line">    y(a), qid(b), qtype(c) &#123;&#125;</div><div class="line">&#125;;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BIT</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">int</span> v[MAXN], N;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>-&gt;N = N;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= N; i++)</div><div class="line">            v[i] = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (x &lt;= N) &#123;</div><div class="line">            v[x] += val;</div><div class="line">            x += x&amp;(-x);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (x) &#123;</div><div class="line">            sum += v[x];</div><div class="line">            x -= x&amp;(-x);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> sum;</div><div class="line">    &#125;</div><div class="line">&#125; bit;</div><div class="line"><span class="keyword">namespace</span> mLocalStream &#123;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readchar</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> buf[N];</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> *p = buf, *end = buf;</div><div class="line">        <span class="keyword">if</span>(p == end) &#123;</div><div class="line">            <span class="keyword">if</span>((end = buf + fread(buf, <span class="number">1</span>, N, <span class="built_in">stdin</span>)) == buf) <span class="keyword">return</span> EOF;</div><div class="line">            p = buf;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> *p++;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ReadInt</span><span class="params">(<span class="keyword">int</span> *x)</span> </span>&#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> c, neg;</div><div class="line">        <span class="keyword">while</span>((c = readchar()) &lt; <span class="string">'-'</span>)    &#123;<span class="keyword">if</span>(c == EOF) <span class="keyword">return</span> <span class="number">0</span>;&#125;</div><div class="line">        neg = (c == <span class="string">'-'</span>) ? <span class="number">-1</span> : <span class="number">1</span>;</div><div class="line">        *x = (neg == <span class="number">1</span>) ? c-<span class="string">'0'</span> : <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span>((c = readchar()) &gt;= <span class="string">'0'</span>)</div><div class="line">            *x = (*x &lt;&lt; <span class="number">3</span>) + (*x &lt;&lt; <span class="number">1</span>) + c-<span class="string">'0'</span>;</div><div class="line">        *x *= neg;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Print</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">        <span class="keyword">char</span> buf[N], *p, *end;</div><div class="line">        Print() &#123;</div><div class="line">            p = buf, end = buf + N - <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">printInt</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">            <span class="keyword">static</span> <span class="keyword">char</span> stk[<span class="number">16</span>];</div><div class="line">            <span class="keyword">int</span> idx = <span class="number">0</span>;</div><div class="line">            stk[idx++] = <span class="string">'\n'</span>;</div><div class="line">            <span class="keyword">if</span> (!x)</div><div class="line">                stk[idx++] = <span class="string">'0'</span>;</div><div class="line">            <span class="keyword">while</span> (x)</div><div class="line">                stk[idx++] = x%<span class="number">10</span> + <span class="string">'0'</span>, x /= <span class="number">10</span>;</div><div class="line">            <span class="keyword">while</span> (idx) &#123;</div><div class="line">                <span class="keyword">if</span> (p == end) &#123;</div><div class="line">                    *p = <span class="string">'\0'</span>;</div><div class="line">                    <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf), p = buf;</div><div class="line">                &#125;</div><div class="line">                *p = stk[--idx], p++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        ~Print() &#123;</div><div class="line">            *p = <span class="string">'\0'</span>;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf);</div><div class="line">        &#125;		</div><div class="line">    &#125; bprint;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> n, m, A[MAXN], ret[MAXQ];</div><div class="line"><span class="built_in">vector</span>&lt;Event&gt; event[MAXN]; <span class="comment">// event[pos]</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span> (mLocalStream::ReadInt(&amp;n)) &#123;</div><div class="line">        mLocalStream::ReadInt(&amp;m);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</div><div class="line">            mLocalStream::ReadInt(A+i), event[i].clear();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="keyword">int</span> l, r, a, b;</div><div class="line">            mLocalStream::ReadInt(&amp;l);</div><div class="line">            mLocalStream::ReadInt(&amp;r);</div><div class="line">            mLocalStream::ReadInt(&amp;a);</div><div class="line">            mLocalStream::ReadInt(&amp;b);</div><div class="line">            <span class="comment">// area [l, a] - [r, b] = [r, b] - [l-1, b] - [r, a-1] + [l-1, a-1]</span></div><div class="line">            event[r].push_back(Event(b, i, <span class="number">1</span>));</div><div class="line">            event[l<span class="number">-1</span>].push_back(Event(b, i, <span class="number">-1</span>));</div><div class="line">            event[r].push_back(Event(a<span class="number">-1</span>, i, <span class="number">-1</span>));</div><div class="line">            event[l<span class="number">-1</span>].push_back(Event(a<span class="number">-1</span>, i, <span class="number">1</span>));</div><div class="line">            ret[i] = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        bit.init(n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">            bit.add(A[i], <span class="number">1</span>);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e: event[i]) &#123;</div><div class="line">                <span class="keyword">int</span> val = bit.query(e.y);</div><div class="line">                ret[e.qid] += e.qtype * val;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret[i]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="可持久化"><a href="#可持久化" class="headerlink" title="可持久化"></a>可持久化</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXNODE = <span class="number">3000000</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100005</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">100005</span>;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SegementTree</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">        Node *lson, *rson;</div><div class="line">        <span class="keyword">int</span> val;</div><div class="line">    &#125; nodes[MAXNODE];</div><div class="line">    <span class="keyword">int</span> nodesize, L, R;</div><div class="line">    <span class="function">Node* <span class="title">init</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">        nodesize = <span class="number">0</span>;</div><div class="line">        L = l, R = r;</div><div class="line">        Node* root = build(l, r);</div><div class="line">        <span class="keyword">return</span> root;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (nodesize &gt;= MAXNODE)</div><div class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">        <span class="keyword">return</span> &amp;nodes[nodesize++];</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">cloneNode</span><span class="params">(Node *p)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (nodesize &gt;= MAXNODE)</div><div class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">        Node* u = &amp;nodes[nodesize++];</div><div class="line">        *u = *p;</div><div class="line">        <span class="keyword">return</span> u;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">build</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (l &gt; r)  <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">        Node *u = newNode();</div><div class="line">        u-&gt;lson = u-&gt;rson = <span class="literal">NULL</span>;</div><div class="line">        <span class="keyword">if</span> (l == r) &#123;</div><div class="line">            u-&gt;val = <span class="number">0</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">int</span> m = (l + r)/<span class="number">2</span>;</div><div class="line">            u-&gt;lson = build(l, m);</div><div class="line">            u-&gt;rson = build(m+<span class="number">1</span>, r);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> u;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">add</span><span class="params">(Node *p, <span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> add(p, x, val, L, R);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(Node *tp, Node *tq, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> query(tp, tq, L, R, x, y);</div><div class="line">    &#125;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="function">Node* <span class="title">add</span><span class="params">(Node *p, <span class="keyword">int</span> x, <span class="keyword">int</span> val, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">        Node *u = cloneNode(p);</div><div class="line">        u-&gt;val += val;</div><div class="line">        <span class="keyword">if</span> (l == r) &#123;</div><div class="line">            <span class="keyword">return</span> u;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">int</span> mid = (l + r)/<span class="number">2</span>;</div><div class="line">            <span class="keyword">if</span> (x &lt;= mid)</div><div class="line">                u-&gt;lson = add(p-&gt;lson, x, val, l, mid);</div><div class="line">            <span class="keyword">else</span></div><div class="line">                u-&gt;rson = add(p-&gt;rson, x, val, mid+<span class="number">1</span>, r);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> u;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(Node *tp, Node *tq, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (x &lt;= l &amp;&amp; r &lt;= y)</div><div class="line">            <span class="keyword">return</span> tq-&gt;val - tp-&gt;val;</div><div class="line">        <span class="keyword">int</span> mid = (l+r)/<span class="number">2</span>;</div><div class="line">        <span class="keyword">if</span> (y &lt;= mid)</div><div class="line">            <span class="keyword">return</span> query(tp-&gt;lson, tq-&gt;lson, l, mid, x, y);</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (x &gt; mid)</div><div class="line">            <span class="keyword">return</span> query(tp-&gt;rson, tq-&gt;rson, mid+<span class="number">1</span>, r, x, y);</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">return</span> query(tp-&gt;lson, tq-&gt;lson, l, mid, x, mid) +</div><div class="line">                query(tp-&gt;rson, tq-&gt;rson, mid+<span class="number">1</span>, r, mid+<span class="number">1</span>, y);</div><div class="line">    &#125;</div><div class="line">&#125; segTree;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> mLocalStream &#123;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readchar</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> buf[N];</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> *p = buf, *end = buf;</div><div class="line">        <span class="keyword">if</span>(p == end) &#123;</div><div class="line">            <span class="keyword">if</span>((end = buf + fread(buf, <span class="number">1</span>, N, <span class="built_in">stdin</span>)) == buf) <span class="keyword">return</span> EOF;</div><div class="line">            p = buf;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> *p++;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ReadInt</span><span class="params">(<span class="keyword">int</span> *x)</span> </span>&#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> c, neg;</div><div class="line">        <span class="keyword">while</span>((c = readchar()) &lt; <span class="string">'-'</span>)    &#123;<span class="keyword">if</span>(c == EOF) <span class="keyword">return</span> <span class="number">0</span>;&#125;</div><div class="line">        neg = (c == <span class="string">'-'</span>) ? <span class="number">-1</span> : <span class="number">1</span>;</div><div class="line">        *x = (neg == <span class="number">1</span>) ? c-<span class="string">'0'</span> : <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span>((c = readchar()) &gt;= <span class="string">'0'</span>)</div><div class="line">            *x = (*x &lt;&lt; <span class="number">3</span>) + (*x &lt;&lt; <span class="number">1</span>) + c-<span class="string">'0'</span>;</div><div class="line">        *x *= neg;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Print</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">        <span class="keyword">char</span> buf[N], *p, *end;</div><div class="line">        Print() &#123;</div><div class="line">            p = buf, end = buf + N - <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">printInt</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">            <span class="keyword">static</span> <span class="keyword">char</span> stk[<span class="number">16</span>];</div><div class="line">            <span class="keyword">int</span> idx = <span class="number">0</span>;</div><div class="line">            stk[idx++] = <span class="string">'\n'</span>;</div><div class="line">            <span class="keyword">if</span> (!x)</div><div class="line">                stk[idx++] = <span class="string">'0'</span>;</div><div class="line">            <span class="keyword">while</span> (x)</div><div class="line">                stk[idx++] = x%<span class="number">10</span> + <span class="string">'0'</span>, x /= <span class="number">10</span>;</div><div class="line">            <span class="keyword">while</span> (idx) &#123;</div><div class="line">                <span class="keyword">if</span> (p == end) &#123;</div><div class="line">                    *p = <span class="string">'\0'</span>;</div><div class="line">                    <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf), p = buf;</div><div class="line">                &#125;</div><div class="line">                *p = stk[--idx], p++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        ~Print() &#123;</div><div class="line">            *p = <span class="string">'\0'</span>;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf);</div><div class="line">        &#125;		</div><div class="line">    &#125; bprint;</div><div class="line">&#125;</div><div class="line"></div><div class="line">SegementTree::Node *ver[MAXQ];</div><div class="line">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; A[MAXN];</div><div class="line"><span class="keyword">int</span> fver[MAXN];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n, m, x;</div><div class="line">    <span class="keyword">while</span> (mLocalStream::ReadInt(&amp;n)) &#123;</div><div class="line">        mLocalStream::ReadInt(&amp;m);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</div><div class="line">            mLocalStream::ReadInt(&amp;x), A[i] = make_pair(x, i);</div><div class="line">        sort(A+<span class="number">1</span>, A+n+<span class="number">1</span>);</div><div class="line">        </div><div class="line">        ver[<span class="number">0</span>] = segTree.init(<span class="number">1</span>, n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">            ver[i] = segTree.add(ver[i<span class="number">-1</span>], A[i].second, <span class="number">1</span>);</div><div class="line">            fver[i] = A[i].first;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="keyword">int</span> l, r, a, b;</div><div class="line">            mLocalStream::ReadInt(&amp;l);</div><div class="line">            mLocalStream::ReadInt(&amp;r);</div><div class="line">            mLocalStream::ReadInt(&amp;a);</div><div class="line">            mLocalStream::ReadInt(&amp;b);</div><div class="line">            <span class="keyword">int</span> va = (<span class="keyword">int</span>) (lower_bound(fver+<span class="number">1</span>, fver+n+<span class="number">1</span>, a) - fver) - <span class="number">1</span>;</div><div class="line">            <span class="keyword">int</span> vb = (<span class="keyword">int</span>) (upper_bound(fver+<span class="number">1</span>, fver+n+<span class="number">1</span>, b) - fver) - <span class="number">1</span>;</div><div class="line">            mLocalStream::bprint.printInt(segTree.query(ver[va], ver[vb], l, r));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-zj-b414" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/27/zj-b414/" class="article-date">
  <time datetime="2015-06-27T13:20:08.000Z" itemprop="datePublished">2015-06-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/27/zj-b414/">b414. BZOJ 3809 Gty 的二逼妹子序列</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/27/zj-b414/" data-id="ckh8skfvo00zh78vr3s851ef5" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/27/zj-b414/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分塊/">分塊</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/莫隊算法/">莫隊算法</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Autumn 和 Bakser 又在研究 Gty 的妹子序列了！</p>
<p>但他們遇到了一個難題，對於一段妹子們，他們想讓你幫忙求出這之內美麗度 <span>$s_i \in [a, b]$</span><!-- Has MathJax --> 的妹子的美麗度的種類數。為了方便，我們規定妹子們的美麗度全都在 <span>$[1,n]$</span><!-- Has MathJax --> 中。</p>
<p>給定一個長度為 <span>$n$</span><!-- Has MathJax --> ( <span>$1 \le n \le 100000$</span><!-- Has MathJax --> ) 的正整數序列 <span>$s$</span><!-- Has MathJax --> (<span>$1 \le s_i \le n$</span><!-- Has MathJax -->)，對於 <span>$m$</span><!-- Has MathJax --> ( <span>$1 \le m \le 1000000$</span><!-- Has MathJax -->) 次詢問 <span>$l, r, a, b$</span><!-- Has MathJax -->，每次輸出 <span>$[s_l, \text{... },s_r]$</span><!-- Has MathJax --> 中，權值 <span>$s_i \in [a, b]$</span><!-- Has MathJax --> 的權值種類數。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">10 10</div><div class="line">4 4 5 1 4 1 5 1 2 1</div><div class="line">5 9 1 2</div><div class="line">3 4 7 9</div><div class="line">4 4 2 5</div><div class="line">2 3 4 7</div><div class="line">5 10 4 4</div><div class="line">3 9 1 1</div><div class="line">1 4 5 9</div><div class="line">8 9 3 3</div><div class="line">2 2 1 6</div><div class="line">8 9 1 4</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">2</div><div class="line">0</div><div class="line">0</div><div class="line">2</div><div class="line">1</div><div class="line">1</div><div class="line">1</div><div class="line">0</div><div class="line">1</div><div class="line">2</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>解決區間內數字在某個值域內部的種類數。</p>
<p><strong> 前情提要 </strong>，如果單純問區間種類數 (獨特)，可以轉換成找區間內部有多少數字大於右端點，要預處理每一個數字的下一個相同數字的位置，只要符合大於右端點的條件即為獨特。可以使用持久化線段樹來做這件事情，依序加入序列數字，貪心去保留最右側的相同數字是獨特的，藉由多版本的區間相減來完成。</p>
<p>現在特別要求在某個值域內部，那就沒有好方法可解，可以使用莫隊下去完成。但是莫隊算法在區間轉移 (example <code>[l, r] to [l, r+1]</code>) 的效能要縮小到 <span>$O(1)$</span><!-- Has MathJax -->，若使用一般樹結構，莫隊算法會衰退到 <span>$O(N^{1.5} \log N)$</span><!-- Has MathJax -->，還不如修改快一點 <span>$O(1)$</span><!-- Has MathJax -->，詢問慢一點 <span>$O(\sqrt{N})$</span><!-- Has MathJax -->，將值域使用塊狀表方式記錄，來達到 <span>$O(N^{1.5} + Q \sqrt{N})$</span><!-- Has MathJax --></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt; </span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100005</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">100005</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">1000005</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXSQRTV = <span class="number">512</span>;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Offline</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Event</span> &#123;</span></div><div class="line">        <span class="keyword">static</span> <span class="keyword">int</span> PILE, belong[MAXV];</div><div class="line">        <span class="keyword">int</span> l, r, x, y, qid;</div><div class="line">        Event(<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>, <span class="keyword">int</span> d = <span class="number">0</span>, <span class="keyword">int</span> e = <span class="number">0</span>):</div><div class="line">            l(a), r(b), x(c), y(d), qid(e) &#123;&#125;</div><div class="line">        <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Event &amp;x) <span class="keyword">const</span> &#123;</div><div class="line">            <span class="keyword">if</span> (belong[l] != belong[x.l])</div><div class="line">                <span class="keyword">return</span> l &lt; x.l;</div><div class="line">            <span class="keyword">return</span> r &lt; x.r; </div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">int</span> A[MAXN], N, qsize;</div><div class="line">    Event event[MAXQ];</div><div class="line">    <span class="keyword">int</span> ret[MAXQ];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>-&gt;N = N, qsize = <span class="number">0</span>;</div><div class="line">        <span class="built_in">memset</span>(pile, <span class="number">0</span>, <span class="keyword">sizeof</span>(pile));</div><div class="line">        <span class="built_in">memset</span>(val_count, <span class="number">0</span>, <span class="keyword">sizeof</span>(val_count));</div><div class="line">        val_PILE = Event::PILE = <span class="built_in">sqrt</span>(N);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = N; i &gt;= <span class="number">1</span>; i--)</div><div class="line">            val_belong[i] = Event::belong[i] = i / Event::PILE;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">q_add</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">        event[qsize] = Event(l, r, a, b, qsize);</div><div class="line">        qsize++;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        sort(event, event+qsize);</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> l = <span class="number">1</span>, r = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; qsize; i++) &#123;</div><div class="line">            <span class="keyword">while</span> (r &lt; event[i].r)	r++, update(A[r], <span class="number">1</span>);</div><div class="line">            <span class="keyword">while</span> (r &gt; event[i].r)	update(A[r], <span class="number">-1</span>), r--;</div><div class="line">            <span class="keyword">while</span> (l &gt; event[i].l)	l--, update(A[l], <span class="number">1</span>);</div><div class="line">            <span class="keyword">while</span> (l &lt; event[i].l)	update(A[l], <span class="number">-1</span>), l++;</div><div class="line">            ret[event[i].qid] = query(event[i].x, event[i].y);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="comment">// unrolled</span></div><div class="line">    <span class="keyword">int</span> pile[MAXSQRTV], val_count[MAXV], val_belong[MAXV], val_PILE;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">        val_count[x] += val;</div><div class="line">        <span class="keyword">if</span> (val == <span class="number">-1</span> &amp;&amp; val_count[x] == <span class="number">0</span>)</div><div class="line">            pile[val_belong[x]]--;</div><div class="line">        <span class="keyword">if</span> (val == <span class="number">1</span> &amp;&amp; val_count[x] == <span class="number">1</span>)</div><div class="line">            pile[val_belong[x]]++;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span> (val_belong[a] == val_belong[b]) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = a; i &lt;= b; i++)</div><div class="line">                ret += val_count[i] &gt; <span class="number">0</span>;</div><div class="line">            <span class="keyword">return</span> ret;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = val_belong[a]+<span class="number">1</span>; i &lt; val_belong[b]; i++)</div><div class="line">            ret += pile[i];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = (val_belong[a]+<span class="number">1</span>)*val_PILE<span class="number">-1</span>; i &gt;= a; i--)</div><div class="line">            ret += val_count[i] &gt; <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = (val_belong[b])*val_PILE; i &lt;= b; i++)</div><div class="line">            ret += val_count[i] &gt; <span class="number">0</span>;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">&#125; off;</div><div class="line"><span class="keyword">int</span> Offline::Event::PILE = <span class="number">16</span>, Offline::Event::belong[MAXV];</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> mLocalStream &#123;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readchar</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> buf[N];</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> *p = buf, *end = buf;</div><div class="line">        <span class="keyword">if</span>(p == end) &#123;</div><div class="line">            <span class="keyword">if</span>((end = buf + fread(buf, <span class="number">1</span>, N, <span class="built_in">stdin</span>)) == buf) <span class="keyword">return</span> EOF;</div><div class="line">            p = buf;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> *p++;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ReadInt</span><span class="params">(<span class="keyword">int</span> *x)</span> </span>&#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> c, neg;</div><div class="line">        <span class="keyword">while</span>((c = readchar()) &lt; <span class="string">'-'</span>)    &#123;<span class="keyword">if</span>(c == EOF) <span class="keyword">return</span> <span class="number">0</span>;&#125;</div><div class="line">        neg = (c == <span class="string">'-'</span>) ? <span class="number">-1</span> : <span class="number">1</span>;</div><div class="line">        *x = (neg == <span class="number">1</span>) ? c-<span class="string">'0'</span> : <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span>((c = readchar()) &gt;= <span class="string">'0'</span>)</div><div class="line">            *x = (*x &lt;&lt; <span class="number">3</span>) + (*x &lt;&lt; <span class="number">1</span>) + c-<span class="string">'0'</span>;</div><div class="line">        *x *= neg;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Print</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">        <span class="keyword">char</span> buf[N], *p, *end;</div><div class="line">        Print() &#123;</div><div class="line">            p = buf, end = buf + N - <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">printInt</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">            <span class="keyword">static</span> <span class="keyword">char</span> stk[<span class="number">16</span>];</div><div class="line">            <span class="keyword">int</span> idx = <span class="number">0</span>;</div><div class="line">            stk[idx++] = <span class="string">'\n'</span>;</div><div class="line">            <span class="keyword">if</span> (!x)	</div><div class="line">                stk[idx++] = <span class="string">'0'</span>;</div><div class="line">            <span class="keyword">while</span> (x)</div><div class="line">                stk[idx++] = x%<span class="number">10</span> + <span class="string">'0'</span>, x /= <span class="number">10</span>;</div><div class="line">            <span class="keyword">while</span> (idx) &#123;</div><div class="line">                <span class="keyword">if</span> (p == end) &#123;</div><div class="line">                    *p = <span class="string">'\0'</span>;</div><div class="line">                    <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf), p = buf;</div><div class="line">                &#125;</div><div class="line">                *p = stk[--idx], p++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        ~Print() &#123;</div><div class="line">            *p = <span class="string">'\0'</span>;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf);</div><div class="line">        &#125;		</div><div class="line">    &#125; bprint;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n, m, l, r, a, b;</div><div class="line">    <span class="keyword">while</span> (mLocalStream::ReadInt(&amp;n)) &#123;</div><div class="line">        mLocalStream::ReadInt(&amp;m);</div><div class="line">        off.init(n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</div><div class="line">            mLocalStream::ReadInt(&amp;off.A[i]);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            mLocalStream::ReadInt(&amp;l);</div><div class="line">            mLocalStream::ReadInt(&amp;r);</div><div class="line">            mLocalStream::ReadInt(&amp;a);</div><div class="line">            mLocalStream::ReadInt(&amp;b);</div><div class="line">            off.q_add(l, r, a, b);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        off.run();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</div><div class="line">            mLocalStream::bprint.printInt(off.ret[i]);</div><div class="line"><span class="comment">//			printf("%d\n", off.ret[i]);</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-zj-b415" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/26/zj-b415/" class="article-date">
  <time datetime="2015-06-25T23:13:24.000Z" itemprop="datePublished">2015-06-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/26/zj-b415/">b415. 輸出優化練習</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/26/zj-b415/" data-id="ckh8skfvq00zk78vrazl2pgyi" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/26/zj-b415/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/優化輸入/">優化輸入</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/優化輸出/">優化輸出</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>寫題目不只會遇到算法複雜度問題，還會遇到語法上的瓶頸，了解更深入的作業系統架構、語言特性，了解每一個函數的實作方法，就能把代碼效能發揮到淋淋盡緻。當然，對於代碼轉成執行檔的最佳化技巧也是如此，接下來就來做個基礎題吧。</p>
<p>現在請處理一個偽隨機數計算，輸出前 <span>$m$</span><!-- Has MathJax --> 個值。</p>
<span>$x_{i+1} \equiv x_{i}^{2} \mod n$</span><!-- Has MathJax -->
<p>有興趣的同學，可以查閱 Blum Blum Shub (BBS) Generator 相關隨機數算法。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">90 141 5</div><div class="line">52 57 5</div><div class="line">19 129 5</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">90 63 21 18 42</div><div class="line">52 25 55 4 16</div><div class="line">19 103 31 58 10</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>手動轉字串，減少函數 <code>printf()</code> 的呼叫，一次將答案吐出來便可以達到加速，由於有一部分時間都花在取模，速度最多提升個兩到三倍。</p>
<p>用 <code>putchar()</code> 速度也會比 <code>printf()</code> 快一點，但沒有實作 buffer 來得快。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt; </span></span></div><div class="line">  </div><div class="line"><span class="keyword">namespace</span> mLocalStream &#123;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readchar</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> buf[N];</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> *p = buf, *end = buf;</div><div class="line">        <span class="keyword">if</span>(p == end) &#123;</div><div class="line">            <span class="keyword">if</span>((end = buf + fread(buf, <span class="number">1</span>, N, <span class="built_in">stdin</span>)) == buf) <span class="keyword">return</span> EOF;</div><div class="line">            p = buf;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> *p++;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ReadInt</span><span class="params">(<span class="keyword">int</span> *x)</span> </span>&#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> c, neg;</div><div class="line">        <span class="keyword">while</span>((c = readchar()) &lt; <span class="string">'-'</span>)    &#123;<span class="keyword">if</span>(c == EOF) <span class="keyword">return</span> <span class="number">0</span>;&#125;</div><div class="line">        neg = (c == <span class="string">'-'</span>) ? <span class="number">-1</span> : <span class="number">1</span>;</div><div class="line">        *x = (neg == <span class="number">1</span>) ? c-<span class="string">'0'</span> : <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span>((c = readchar()) &gt;= <span class="string">'0'</span>)</div><div class="line">            *x = (*x &lt;&lt; <span class="number">3</span>) + (*x &lt;&lt; <span class="number">1</span>) + c-<span class="string">'0'</span>;</div><div class="line">        *x *= neg;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Print</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">        <span class="keyword">char</span> buf[N], *p, *end;</div><div class="line">        Print() &#123;</div><div class="line">            p = buf, end = buf + N - <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">printInt</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">char</span> padding)</span> </span>&#123;</div><div class="line">            <span class="keyword">static</span> <span class="keyword">char</span> stk[<span class="number">16</span>];</div><div class="line">            <span class="keyword">int</span> idx = <span class="number">0</span>;</div><div class="line">            stk[idx++] = padding;</div><div class="line">            <span class="keyword">if</span> (!x)	</div><div class="line">                stk[idx++] = <span class="string">'0'</span>;</div><div class="line">            <span class="keyword">while</span> (x)</div><div class="line">                stk[idx++] = x%<span class="number">10</span> + <span class="string">'0'</span>, x /= <span class="number">10</span>;</div><div class="line">            <span class="keyword">while</span> (idx) &#123;</div><div class="line">                <span class="keyword">if</span> (p == end) &#123;</div><div class="line">                    *p = <span class="string">'\0'</span>;</div><div class="line">                    <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf), p = buf;</div><div class="line">                &#125;</div><div class="line">                *p = stk[--idx], p++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">online_printInt</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">            <span class="keyword">static</span> <span class="keyword">char</span> ch[<span class="number">16</span>];</div><div class="line">            <span class="keyword">static</span> <span class="keyword">int</span> idx;</div><div class="line">            idx = <span class="number">0</span>;</div><div class="line">            <span class="keyword">if</span> (x == <span class="number">0</span>)	ch[++idx] = <span class="number">0</span>;</div><div class="line">            <span class="keyword">while</span> (x &gt; <span class="number">0</span>) ch[++idx] = x % <span class="number">10</span>, x /= <span class="number">10</span>;</div><div class="line">            <span class="keyword">while</span> (idx) </div><div class="line">                <span class="built_in">putchar</span>(ch[idx--]+<span class="number">48</span>);</div><div class="line">        &#125;</div><div class="line">        ~Print() &#123;</div><div class="line">            *p = <span class="string">'\0'</span>;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf);</div><div class="line">        &#125;</div><div class="line">    &#125; bprint;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> x0, p, n;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;x0, &amp;p, &amp;n) == <span class="number">3</span>) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            mLocalStream::bprint.printInt(x0, i == n<span class="number">-1</span> ? <span class="string">'\n'</span> : <span class="string">' '</span>);</div><div class="line"><span class="comment">//			mLocalStream::Print::online_printInt(x0);</span></div><div class="line"><span class="comment">//			putchar(i == n-1 ? '\n' : ' ');</span></div><div class="line">            x0 = ((<span class="keyword">long</span> <span class="keyword">long</span>) x0 * x0)%p;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-speech-terry" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/25/speech-terry/" class="article-date">
  <time datetime="2015-06-24T23:36:50.000Z" itemprop="datePublished">2015-06-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/8vmTV11.png" rel="gallery_ckh8skfh500eq78vrevajn09q">
        <img src="http://i.imgur.com/8vmTV11.png" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/25/speech-terry/">我的世界在路上 外出紀錄</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/25/speech-terry/" data-id="ckh8skfh500eq78vrevajn09q" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/25/speech-terry/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/中央大學/">中央大學</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/服務學習/">服務學習</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>隔了一周，又跑中原參加一場講座。門檻壓力好可怕、好可怕，別人輕易跨過的事實成為令人怯步的記憶。人生總有那麼一兩個小事，會發現自己就是那 1% 不到的缺陷，那微乎其微基因突變雖不足以殺人，但足以折磨心理。</p>
<p>這一天，帶著平淡的心情出發，路程上想著一道題目，坐在陌生的圖書館中，時而發愣地等待靈感的出現，上帝並沒有給予我太多，那愚蠢又怪異舉止是在與內心世界掙扎的反應，在一旁的人群也許覺得是個怪人，人滿為患的情況下，身旁的位置總是空的，也許多慮了吧。</p>
<p>在講座開始前，把自己出在 zerojudge 的題目 b414, b416 寫了幾個不同解法，即使網路上有一些片段心得，有些事情還是得親自嘗試才能更加地體會。題目告一段落後，放下心去參與接下來的講座。</p>
<p>感謝舉辦活動的同學，願意讓我這外校生參加講座、特地向學校申請證明給我，以為這世界的人都朝著進度服從，規定之外、不在規定內事情都沒辦法做，「麻煩別人」對我而言需要 <strong> 勇氣 </strong>。</p>
<p><img src="http://i.imgur.com/ypvQXE1.png" alt="《吹響吧！低音號》那時，我明白了"></p>
<h2 id="狀態"><a href="#狀態" class="headerlink" title="狀態"></a>狀態</h2><p>這次邀請的是旅行作家 Terry，聽到「旅行」「作家」兩個關鍵字，曾經在網路上瀏覽的文章給予的感覺，就是一個陳腔濫調的講座對吧？</p>
<p>事實有點不一樣，怎麼說呢，在正式開始前他分享了幾個小故事，說著他去分享講座、所遇到的人，講座中他給予別人什麼樣的經驗，而別人又是如何改變自己。在不同的國中小演講，他發現環境影響一個人的夢想，不能跟哥哥姊姊一樣聰敏的學生 A，在另一個領域演說、作文上有所才能，參與不少演說比賽的 A，卻突然不參與任何比賽，這件事情讓老師有所顧慮，父母那一句「功課要跟哥哥、姊姊一樣好，之後才不會像我一樣。」類似的話語使得 A 放棄自己的才能，而去想辦法在功課上與哥哥姊姊一樣好。</p>
<blockquote>
<p>聽到這一半段，心想「這也是我放棄比賽的原因嗎？」還是 EVA 那一段話「不能逃避！不能逃避！」的掙扎，「無法做得比別人好，那就放棄吧。」回響著。</p>
</blockquote>
<p><img src="http://i.imgur.com/pYUoNka.jpg" alt="《吹響吧！低音號》不甘心地快死了"></p>
<p>他這麼對 A 說「那你有發現你的作文演說比哥哥姊姊來得好嗎？」，學生應答「有。」接著 Terry 回了一段有趣的回答「那跟爸媽要求哥哥姊姊要在這一塊做跟你自己一樣好？」這時突然茫了，原來打破僵局這麼簡單，摸摸鼻子，暗自竊笑一番，笑著自己為什麼預期不到這樣的回答，把別人要求自己當作習慣，要求別人成了反常舉止，以後好好要求別人做得比我還好！像我如此笨拙的人，大家一定可以做得比我還好。</p>
<blockquote>
<p>「演講時，跟那群小朋友說什麼大道理『要堅強、不要逃避、面對挫折沒有什麼大不了』他們聽不懂的啦，倒不如講講，踩過各種狗類型的屎分享，再去跟踩鳥屎的反應差別，還會有同學跟你分享踩牛屎的體驗呢。」</p>
</blockquote>
<p><img src="http://i.imgur.com/NxOuJiA.png" alt="《飆速宅男》"></p>
<p>他曾經想要單車環島，卻苦於沒有單車，將一段訊息說了出來，於是有 Terry 朋友從花蓮載了一台單車到台中給他，Terry 覺得也奇怪，那要怎麼把單車還給 Terry 朋友呢？Terry 朋友居然回答道「騎回花蓮給我吧！」聽到這一句我也傻了，住花蓮的我都清楚搭火車到西部都嫌煩，繞了半個台灣是很長的。對角線的最近距離是很短，但那段山路爬坡不是好方案。</p>
<blockquote>
<p>「一生中總會有那麼幾個壞朋友，當你要去做一件事情時，在一旁煽火推你，<strong> 就好像死的是你，不是他 </strong>。也會有幾個好朋友，總會在你身旁告誡你，那樣做很危險的！不要不要啦！」－ Terry</p>
</blockquote>
<p><img src="http://i.imgur.com/RjXax02.png" alt="《Fate/Stay Night UBW》幹得好，你們這群壞朋友 (誤配)"></p>
<p>大眾化的描述還真有 Terry 的風格，搭配肢體表達那該死的壞朋友，要跟聽者有所共鳴果然要這麼做吧！「說大道理我不懂，但你這麼一說我好像就明白」的那種心情，這方面我還得多學學呢。</p>
<p>「瘋子和勇氣只有一線之隔，而我常常是瘋子那一塊。」於是他出發了，在四、五天內穿過中央山脈到了花蓮，又經過好幾天才能下床走路，他在一年之初做了一件瘋狂的事情呢，今年的我又做了什麼創舉呢？寫寫心得、代碼、出個題目都不算什麼，咱居然 <strong> 出門 </strong> 聽了這場演講！我的一小步是人生的一大步。</p>
<p>曾經是在一家公司上班的 Terry，做在小小辦公桌的他，那時都有著一個普遍的夢想「幹掉老闆，那個位子就是我的！」這夢想是每個工程師的心言。29 歲的他第一次出國，不做幹掉老闆的夢想，出門玩玩最近火熱的 <strong> Gap Year </strong> 的舉止，看看有什麼更有趣的自己，並不是花錢出門看看別人，在別的地點用自己的努力換資源活著，拿著自己街頭賣藝的才藝，出去招搖撞騙？ (笑笑就好)，跟著朋友來個計劃「收集微笑」放映一段有趣的影片，看了好一陣子各國人的微笑影片，不自覺地自己也跟著笑「看著別人微笑，你的嘴角是否上揚了？」</p>
<blockquote>
<p>前輩們要是過著更有希望的生活，我想我也可以過得很有希望，誰來替前輩們找到工作啊。</p>
</blockquote>
<p>藉由沙發衝浪找旅宿，交換人生經驗、文化，他就這麼帶著烏克麗麗發送請求住宿，附加黑暗中華料理才藝「反正他們多數也不知道真正的中華料理，只要說我做的一定是中華料理就行了，太鹹、太油、太甜一切都沒問題的。」這樣招搖撞騙真的沒問題嗎？這時候暗自竊笑著，也許真物也不是那麼重要了，帶著自己有一點點的經驗，非專業都沒問題。</p>
<p><img src="http://i.imgur.com/gH2okoO.png" alt="《果然我的青春戀愛物語搞錯了》世上到底有沒有真心呢"></p>
<p>「交談怕什麼嗎？語言不好？有 Google 翻譯就行啦，這又不是考試。」想到英文考試就是一肚子的痛，Google 翻譯真的好用，翻譯品質不會是最好，能溝通就行啦！「而且沙發衝浪偏好找老人，因為老人說話慢，談話比較能聽得懂的啦！」這樣的出國技巧還真是磨練的淋淋盡致，真是無比佩服這位 <strong> 計畫通 </strong>，看似和藹可親的面容下，居然藏著一顆腹黑的心。</p>
<p>「這樣七十多歲的人都出國沙發衝浪」甚至在台灣 Terry 家住宿過，還隨手打著毛線。人啊，學個技能、改變第一步是困難的，但也沒有什麼不可能，那七十多歲的老騷包，還特地擔心跟著 Terry 一起拍攝影片的服裝呢，覺得衣著不好看還在那挑來挑去，身為一個教職退休的老人，要在彼此認識的小鎮做出收集微笑的活動，那還真是 <strong> 害羞 </strong> 呢。七十多歲的老人都在街頭做著平時只有年輕人做的事情，我是否也可以做點不一樣的？</p>
<p><img src="http://i.imgur.com/XL8VOUO.png" alt="《吹響吧！低音號》你一個人臉紅個什麼呢？"></p>
<p>「成功不能複製，失敗可以學習。」要讓家人支持自己出國嘗試，要做些什麼？首先，先來個小旅行，逐漸地把時間拉長，讓家人明白你自己可以解決問題，對外宣稱「台灣是熱情的國家，遇到問題只要敢發問，就會有人幫忙。」對自己小孩是怎麼說「外面可怕，要小心陌生人，要注意場合。」這兩面情要怎麼讓孩子理解，到底是求助於人好、還是不求於人好？也許當前問題要先解決這個呢。</p>
<p>有比別人多一個機會到外處學習，回來要怎麼 <strong> 分享經驗 </strong> 呢？「說說自己遇到的問題，順道說說如何解決，這樣的內容才有人看啊，老媽肯定會講『看吧，就說會遇到這種情況』，分享那裏有多好玩、那裏長得如何，很少人想去聽的。」這一點到沒錯呢，覺得在 FaceBook 是一個反常的存在。不管如何，就是不喜歡看一個沒有整理過的長時間紀錄片，一定會打瞌睡。</p>
<h2 id="節錄"><a href="#節錄" class="headerlink" title="節錄"></a>節錄</h2><ul>
<li>「出了遠門忘了帶錢，沒法賒帳，回家一趟也太遙遠，現場演奏怒賺菜錢，回頭結帳！爽。(高傲貌)」</li>
<li>「旅行是一個機會，可以理解到自己的專長、發掘自己的可能性，是個機會，沒有一定。」</li>
<li>「曾經為了搭個便車，在路旁等了五、六個小時，若你去問問女孩子通常等了多久『10 分鐘』沒錯，女孩子受到幫助的機會非常高啊，在我等了一個小時後，甚至想女裝一下，看能不能提高搭乘機率啊。」 </li>
<li>「不要說只有女孩子危險，男孩子在外搭便車也是很危險的啊，哪有什麼比較強壯什麼的，大家都是人吼。」</li>
<li>「你看到男性提供者限定女性沙發衝浪，女性們怕不怕，若限定男性沙發衝浪，你說男性們怕不怕。怕啊。」</li>
</ul>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>在場聽者不多，講者仍講得相當有生動，沒有被空位的壓力屈服，話語讓我整個人都熱血起來。講著講著，好像能踏出第一步了，「對不起，看到離近的兩大門檻前，還是選擇退一步，在逃離畢業資格考前，沒辦法像用 Google 翻譯那樣地活著。」這場講座是個有趣的經驗，不僅僅是人生未來挖掘方法，也看到如何作為一個講者去描述事情的方法。</p>
<p><img src="http://i.imgur.com/DNBMbPG.png" alt="《灰色樂園》這輩子都將銘記於心"></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-zj-d476" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/25/zj-d476/" class="article-date">
  <time datetime="2015-06-24T23:05:28.000Z" itemprop="datePublished">2015-06-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/25/zj-d476/">d476. 區間查詢</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/25/zj-d476/" data-id="ckh8skfyj013978vr8raq1irf" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/25/zj-d476/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/整體二分/">整體二分</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/離線處理/">離線處理</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>一個長度為 n 的序列，支持兩種操作：</p>
<ol>
<li>输出 <span>$[A, B]$</span><!-- Has MathJax --> 區間第 k 小的數 (從小到大排序後第 k 個)</li>
<li>修改第 I 個數為 W</li>
</ol>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">5 3</div><div class="line">1 2 3 4 5</div><div class="line">Q 1 4 2</div><div class="line">C 2 5</div><div class="line">Q 1 4 2</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2</div><div class="line">3</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>在討論用一些雜七雜八的樹類結構去跟莫隊算法搏鬥之餘，用了轉幾何方向去兜資料結構，隨後發現題目尋找的是 unique 而非計數，因此很多想法就垮台，當然出成另一道題目也是不錯。決定尋找其他想法！</p>
<h3 id="開始"><a href="#開始" class="headerlink" title="開始"></a>開始</h3><p>整體二分是什麼呢？假設操作只有修改、詢問，不包含插入、刪除，而且詢問是一個數值結果，這個數值結果可以藉由二分 + 掃描來完成，那就可以使用整體二分來離線支持。</p>
<p>對答案值域分治，將相關操作分治在一起，同時要保留順序性，分治過程中會不斷地累加每一個詢問的掃描數值，最後滿溢時紀錄答案。每一個操作最多在 <span>$\log \text{MAXV}$</span><!-- Has MathJax --> 層計算，因此複雜度是 <span>$O(Q \log \text{MAXV})$</span><!-- Has MathJax -->。</p>
<p>好處是可以用常數較低的結構，所以會比較快？</p>
<h4 id="應用"><a href="#應用" class="headerlink" title="應用"></a>應用</h4><p>這一道經典題有很多作法，如持久化線段樹、塊狀鏈表、歸併樹、劃分樹、 … 等。其中能支持修改的有塊狀鏈表、複雜的持久化線段樹 (主席樹)。</p>
<p>帶修改的區間 K 小，概略說明二分答案 <span>$x$</span><!-- Has MathJax -->，然後去查找小於等於 <span>$x$</span><!-- Has MathJax --> 的數字在區間 <span>$[l, r]$</span><!-- Has MathJax --> 內出現的次數是否大於等於 <span>$K$</span><!-- Has MathJax -->。然後修改元素有加入跟移除，二分答案 mid，要將加入、移除會影響的 <span>$A[i] \le mid$</span><!-- Has MathJax -->，加入或移除時對該數字的索引值 <span>$i$</span><!-- Has MathJax --> 建造統計方案。</p>
<p>對於(位置, 值) <span>$\left \langle i, A[i] \right \rangle$</span><!-- Has MathJax --> 來說，一開始的前 <span>$N$</span><!-- Has MathJax --> 個操作是加入 <span>$\left \langle i, A[i] \right \rangle$</span><!-- Has MathJax -->，二分答案時，用一個 binary indexed tree 去維護 index 的個數，也就是說，對於修改元素 <span>$\left \langle i, A[i] \right \rangle$</span><!-- Has MathJax --> 相當於在二分答案 mid 時，插入 <code>BIT.add(i, 1)</code>，那對於區間詢問，相當於查找 <code>BIT.query([l, r])</code> 如此一來就能知道區間 <span>$[l, r]$</span><!-- Has MathJax --> 在 mid 以內有幾個數字符合。</p>
<p>假設計數大於 k，詢問往左放，反之扣除已知 mid 以內的數量，詢問往右放，如此一來就完成了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt; </span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">65536</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">65536</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Offline</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Event</span> &#123;</span></div><div class="line">        <span class="keyword">int</span> x, y, k, qtype, qid;</div><div class="line">        <span class="keyword">int</span> calc; <span class="comment">//</span></div><div class="line">        Event(<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>, <span class="keyword">int</span> d = <span class="number">0</span>, <span class="keyword">int</span> e = <span class="number">0</span>, <span class="keyword">int</span> f = <span class="number">0</span>):</div><div class="line">            x(a), y(b), k(c), qtype(d), qid(e), calc(f) &#123;&#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="built_in">vector</span>&lt;Event&gt; event;</div><div class="line">    <span class="keyword">int</span> N, ret[MAXQ];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>-&gt;N = N;</div><div class="line">        event.clear();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addEvent</span><span class="params">(<span class="keyword">int</span> qtype, <span class="keyword">int</span> qid, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">        event.push_back(Event(x, y, k, qtype, qid));</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        DC(<span class="number">0</span>, event.size()<span class="number">-1</span>, <span class="number">0</span>, INF);</div><div class="line">    &#125;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="comment">// buffer</span></div><div class="line">    <span class="keyword">int</span> buf[MAXQ];</div><div class="line">    Event ebuf1[MAXQ], ebuf2[MAXQ];</div><div class="line">    <span class="comment">// binary indexed tree</span></div><div class="line">    <span class="keyword">int</span> bit[MAXN];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (x &lt;= N) &#123;</div><div class="line">            bit[x] += val;</div><div class="line">            x += (x)&amp;(-x);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (x) &#123;</div><div class="line">            ret += bit[x];</div><div class="line">            x -= (x)&amp;(-x);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DC</span><span class="params">(<span class="keyword">int</span> q_l, <span class="keyword">int</span> q_r, <span class="keyword">int</span> val_l, <span class="keyword">int</span> val_r)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (q_l &gt; q_r)	<span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">if</span> (val_l == val_r) &#123;	<span class="comment">// find</span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = q_l; i &lt;= q_r; i++)</div><div class="line">                <span class="keyword">if</span> (event[i].qtype == <span class="number">2</span>)</div><div class="line">                    ret[event[i].qid] = val_l;</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> mid = (val_l + val_r)/<span class="number">2</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = q_l; i &lt;= q_r; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (event[i].qtype == <span class="number">0</span> &amp;&amp; event[i].y &lt;= mid)</div><div class="line">                add(event[i].x, <span class="number">1</span>);</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (event[i].qtype == <span class="number">1</span> &amp;&amp; event[i].y &lt;= mid)</div><div class="line">                add(event[i].x, <span class="number">-1</span>);</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (event[i].qtype == <span class="number">2</span>)</div><div class="line">                buf[i] = query(event[i].y) - query(event[i].x<span class="number">-1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = q_l; i &lt;= q_r; i++) &#123; <span class="comment">// resume</span></div><div class="line">            <span class="keyword">if</span> (event[i].qtype == <span class="number">0</span> &amp;&amp; event[i].y &lt;= mid)</div><div class="line">                add(event[i].x, <span class="number">-1</span>);</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (event[i].qtype == <span class="number">1</span> &amp;&amp; event[i].y &lt;= mid)</div><div class="line">                add(event[i].x, <span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> lidx = <span class="number">0</span>, ridx = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = q_l; i &lt;= q_r; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (event[i].qtype == <span class="number">0</span> || event[i].qtype == <span class="number">1</span>) &#123;</div><div class="line">                <span class="keyword">if</span> (event[i].y &lt;= mid)</div><div class="line">                    ebuf1[lidx++] = event[i];</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    ebuf2[ridx++] = event[i];</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">if</span> (event[i].calc + buf[i] &gt; event[i].k - <span class="number">1</span>)</div><div class="line">                    ebuf1[lidx++] = event[i];</div><div class="line">                <span class="keyword">else</span> &#123;</div><div class="line">                    event[i].calc += buf[i];</div><div class="line">                    ebuf2[ridx++] = event[i];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lidx; i++)</div><div class="line">            event[q_l+i] = ebuf1[i];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ridx; i++)</div><div class="line">            event[q_l+lidx+i] = ebuf2[i];</div><div class="line">        DC(q_l, q_l+lidx<span class="number">-1</span>, val_l, mid);</div><div class="line">        DC(q_l+lidx, q_r, mid+<span class="number">1</span>, val_r);</div><div class="line">    &#125;</div><div class="line">&#125; off;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n, m, x, y, k, v;</div><div class="line">    <span class="keyword">int</span> A[<span class="number">65536</span>];</div><div class="line">    <span class="keyword">char</span> cmd[<span class="number">10</span>];</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;n, &amp;m) == <span class="number">2</span>) &#123;</div><div class="line">        off.init(n);</div><div class="line">        <span class="comment">// qtype 0:add, 1:remove, 2: query</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;A[i]);</div><div class="line">            off.addEvent(<span class="number">0</span>, <span class="number">0</span>, i, A[i], <span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> qid = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>, cmd);</div><div class="line">            <span class="keyword">if</span> (cmd[<span class="number">0</span>] == <span class="string">'Q'</span>) &#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;x, &amp;y, &amp;k);</div><div class="line">                off.addEvent(<span class="number">2</span>, qid++, x, y, k);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;x, &amp;v);</div><div class="line">                off.addEvent(<span class="number">1</span>, <span class="number">0</span>, x, A[x], <span class="number">0</span>);</div><div class="line">                off.addEvent(<span class="number">0</span>, <span class="number">0</span>, x, v, <span class="number">0</span>);</div><div class="line">                A[x] = v;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        off.run();		</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; qid; i++)</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, off.ret[i]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-security-notes7" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/23/security-notes7/" class="article-date">
  <time datetime="2015-06-23T00:06:29.000Z" itemprop="datePublished">2015-06-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/資訊安全/">資訊安全</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/23/security-notes7/">近代加密 小額付費</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/23/security-notes7/" data-id="ckh8skfgy00ee78vrm94jbahm" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/23/security-notes7/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/密碼學/">密碼學</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="關於小額付費"><a href="#關於小額付費" class="headerlink" title="關於小額付費"></a>關於小額付費</h2><p>另一個名稱為 <strong> 微支付 </strong> (Micropayment)，簡單來說提供顧客 (Consumer) - 銀行 (Broker) - 商家 (Vendor) 三方的交易。小額付費標明在交易金額小，因此交易成本也應該小，否則交易手續的計算能量就超過交易金額，更別說要扣除交易物品的成本。通常要在以下三點最小化</p>
<ul>
<li>計算資源：<br>在先前提到的加密算法中，key 的 bit-length 相當長，導致計算的能量消耗大。倘若只消費 1 元，耗電成本就佔了 1% 以上，甚至更多，那麼是划不來的。</li>
<li>儲存空間花費：<br>計算每一組交易明細所需要的空間要最小，例如記錄金額需要 32-bit，那麼 n 次交易就需要 n 個 32-bit 的空間，在其他細節中還需要紀錄額外的購買來源、 … 等。</li>
<li>管理成本：<br>第三方 (通常是銀行) 要管理顧客的金額花費、商家是否能取用顧客的錢。銀行要怎麼紀錄顧客的狀態、如何驗證商家真的有跟顧客交易 … 等。</li>
</ul>
<p>由於交易金額小，即使被破解對雙方的損失也不大。但通常破解手段需要的時間、資源往往超過交易金額，因此不太會有人去破解這個。</p>
<h2 id="應用層面"><a href="#應用層面" class="headerlink" title="應用層面"></a>應用層面</h2><h3 id="網路電子報："><a href="#網路電子報：" class="headerlink" title="網路電子報："></a>網路電子報：</h3><p>一份電子報可能有一些特別的標題內容，若要深入查閱內文，需要讀者付費觀看。這一部分更具有彈性，對於一份具有相當多面向的電子報而言，有些人只看幾個專欄就必須花費購買一整本的金額，有些時候是浪費的。</p>
<h3 id="網路期刊購買、資料庫詢問"><a href="#網路期刊購買、資料庫詢問" class="headerlink" title="網路期刊購買、資料庫詢問"></a>網路期刊購買、資料庫詢問</h3><p>網路學術期刊就跟電子報的情況一樣。資料庫詢問比較特別，花費小金額來交換資料庫服務的次數。</p>
<h3 id="廣告"><a href="#廣告" class="headerlink" title="廣告"></a>廣告</h3><p>互動式影片、廣告商為了誘拐大眾仔細觀看廣告，由廣告商付錢給觀看者。例如回答問卷回饋、機率性地抽獎回饋 … 等。</p>
<h3 id="網頁閱讀"><a href="#網頁閱讀" class="headerlink" title="網頁閱讀"></a>網頁閱讀</h3><p>類似向大眾徵文，鼓勵分享知識。徵求到的文章，由平台供應者支付。</p>
<h2 id="何時用"><a href="#何時用" class="headerlink" title="何時用"></a>何時用</h2><p>使用者付費，而非訂閱長時間的垃圾訊息或服務。在大多數的服務商中，會提供時間內無限使用或按照次數計費兩種方案，在大多數的情況下，時間內無限使用是對商家有利，可以預先得到使用者的投資，但使用者在後續時間內可能沒有去使用、或者沒時間去用。</p>
<p>不是 <strong> 按照次數計費全然好 </strong>，就如 <strong> 電話費 </strong>，打了多少通電話、講了多久，只有電信商知道，即便告訴花費相當多金額，通話明細也是由他們提供，很難證明到底花了多少，這是對使用者的不利。相較起來，小額付費比較接近投幣式的公共電話，投了多少就打多少，等到快沒有餘額時，再進行補充。</p>
<p>先付款給商家會對使用者不利，有可能取得不好的服務，後付款給商家會對商家不利，因為使用者可能沒有足夠的金額。正因為小額交易，適時地刷新狀態 (再投幣) 就能在之間達到平衡。</p>
<h2 id="數學"><a href="#數學" class="headerlink" title="數學"></a>數學</h2><p>由制定 RSA 那伙人 Rivest, Shamir 提供 Payword scheme 的方法。</p>
<p>首先，概念建立在假設不用數字儲存金額 (減少儲存空間、管理花費)，而是用運算次數來知道花費金額 (用簡單運算來完成，防止能源消耗過大)。金額花費是整數，由最小單位 1 元構成，如果是在通貨膨脹的國家，最小單位可能不一樣？</p>
<p>那麼可以建立一個儲值金額 n 元的串列如下。</p>
<span>$x_0 \leftarrow x_1 \leftarrow x_2 \leftarrow \text{ ... } \leftarrow x_{n-1} \leftarrow x_n$</span><!-- Has MathJax -->
<p>由使用者拿一個<span>$x_n$</span><!-- Has MathJax --> 初始化，接著利用 hash<span>$x_i = h(x_{i+1})$</span><!-- Has MathJax --> 得到每一個硬幣<span>$x_i$</span><!-- Has MathJax -->。用數學表示遞迴公式<span>$x_i = h^{n-i}(x_n)$</span><!-- Has MathJax -->。</p>
<p>當顧客跟商家交易時，簽一份簽章 (例如用 RSA 或者是 DSA 等方式) 給商家。簽章內容為</p>
<span>$\text{Sign}_C(\text{Merchant-ID} || x_0 || \text{Cert})$</span><!-- Has MathJax -->
<p>其中 <span>$\text{Cert}$</span><!-- Has MathJax --> 是由第三方信任銀行簽署給用戶的內容 (類似銀行帳戶的確認)。最後發送給商家資訊為</p>
<span>$\text{Sign}_C(\text{Merchant-ID} || x_0 || \text{Cert}), \text{Merchant-ID}, x_0, \text{Cert}$</span><!-- Has MathJax -->
<p>由商人去驗證 (檢查簽證內容、拿對方的 public key 打開，再去拿銀行的 public key 驗證 <span>$\text{Cert}$</span><!-- Has MathJax -->  是否正確) 是否是可信任的顧客或者是顧客是否存在。</p>
<p>接下來交易採用最笨的方案，每一次交易 1 元，交付 i 元時，顧客就告知<span>$x_i$</span><!-- Has MathJax --> 值給商家，這裡顧客得到硬幣方法為重新計算<span>$x_i = h^{n-i}(x_n)$</span><!-- Has MathJax -->，可以不事先用記憶體儲存<span>$[x_0, x_n]$</span><!-- Has MathJax -->，保留 <span>$n$</span><!-- Has MathJax --> 和<span>$x_n$</span><!-- Has MathJax --> 即可。</p>
<p>之後商家拿著 i 元<span>$x_i$</span><!-- Has MathJax --> 和<span>$\text{Sign}_C(\text{Merchant-ID} || x_0 || \text{Cert})$</span><!-- Has MathJax --> 的資訊給銀行，銀行計算 <span>$i$</span><!-- Has MathJax --> 次 hash<span>$x_0 = h^i(x_i)$</span><!-- Has MathJax --> 查看是否正確，若檢驗沒問題，則銀行從客戶存簿撥款給商家。</p>
<h3 id="為什麼可行"><a href="#為什麼可行" class="headerlink" title="為什麼可行"></a>為什麼可行</h3><p>運算過程中使用 hash，hash 提供不可逆的操作，因此商家無法有更多金額的索取，假設從顧客手中得到<span>$x_i$</span><!-- Has MathJax -->，無法計算出<span>$x_{i+1}$</span><!-- Has MathJax --> 究竟是什麼，具有一定安全性。而顧客必須由銀行索取簽證，來表示當前的狀態是合法的，顧客沒辦法竄改自己的狀態，使得自己有更多的金錢，銀行那裏會有最新一組的簽章在？應該是吧，銀行會在商家發送驗證資訊時發生異狀檢查顧客是否竄改。</p>
<p>數學之美。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-diary-20150622" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/23/diary-20150622/" class="article-date">
  <time datetime="2015-06-22T22:39:00.000Z" itemprop="datePublished">2015-06-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/Owisoua.png" rel="gallery_ckh8skfa1002u78vrfu11v0o5">
        <img src="http://i.imgur.com/Owisoua.png" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/23/diary-20150622/">服務學習心得指南系列 曾經何時 那份信任</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/23/diary-20150622/" data-id="ckh8skfa1002u78vrfu11v0o5" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/23/diary-20150622/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/中央大學/">中央大學</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/服務學習/">服務學習</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="真實短篇"><a href="#真實短篇" class="headerlink" title="真實短篇"></a>真實短篇</h2><p> 補繳外出活動證明走向服務中心，骨氣勇氣向工讀生說道<br>「上次繳交的證明是活動單位發錯了 … 這是一份新的。」</p>
<p>工讀生轉向交給後頭的領導，在那談了不久，我開始心有點緊張，也許是該結束了吧，那兒的領導走了過來，緩慢地說</p>
<p>「關於這份參加證明，後來有打電話去問，確定沒錯。」<br>「恩恩，我這個是補繳的。」</p>
<p>沒想到他們還主動聯絡，也許我要對它們改觀了，查證方面卻是格外的嚴格。但在百般愉悅之下，馬上迎來沉重的第二段話</p>
<p>「但是你寫的心得是抄網站上的，有同學參加那活動且心得寫得不錯。」<br>「沒這樣的吧，我根本沒注意活動官網上寫什麼。」</p>
<p>為什麼，難道就這樣子了嗎？原來我已經只剩下宣傳式海報的心得流了嗎？之前在辦公桌上，看到有人用字體 8 印出不到幾個字的心得，原來我就只有這樣啊。</p>
<p>「如果你有去的話，應該就能寫比較多吧，這個都是抄網站上的，這樣不行，要不然我開給你看看。」<br>「算了，好吧。」</p>
<p>挫折感是如此地沉重，我不想寫了，到底什麼是心得、至今我又寫了什麼。沮喪地走出服務台，沒想到走出這棟建築物是如此地困難 … 原來天已經這麼黑了 …</p>
<p>「不對！文章我有寫到動漫、美劇，這官網上不會有的吧。」</p>
<p>趕緊回頭再問個清楚，回到服務台招著手問「等等，你說的網站是哪一個？」</p>
<p>「正在印那個網站下來。」</p>
<p>聽著那列表機刷刷的聲音，已經預想到如果不在那個時間點回來，我的心得就會隨著那幾張紙釘起來拿去退件區存放。然後，曾經存在過的證明就消失了。</p>
<p>遞著剛印有網站內容的紙張給我「你看吧，這就是那個網站。」</p>
<p>「那是我的部落格 …」</p>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>這件事情他們也很辛苦，畢竟這個時間點的心得大多都是抄襲，平常不參加活動的宅宅為了畢業去弄心得繳交來獲得認可，而我就是其中一個。</p>
<p>非常不屑 <strong> 服務學習時數 </strong> 制度，不敢說自己有多麼深有感觸，也不能說具有完善的能力，這樣的制度一開始的用意是好的，相較於其他大學是 <strong> 完全自主 </strong>，別的大學靠著修課參與就會滿足時數需求，中央大學是全台國立大學中最特別的一個。</p>
<p>曾經訪問過服務學習辦公室這件事情「有多少人會因為這個不能畢業」他們是這麼回答的「微乎其微」這此我又問了一個問題「心得審核中，聽說不少劣質內容也可以申請成功」他們是這麼回答的「這樣的事情應該是沒有，我們都有嚴格把關。」當時基於信任機制，就這麼相信他們說出的內容寫下報告繳交。</p>
<p>台灣之所以開始舉行「服務學習」為畢業門檻，原因是學老美那一套「<strong> 它是一種『服務』與『學習』並重的經驗教育方式 </strong>」那台灣現況又是如何呢？大約有五種類型如下描述</p>
<ul>
<li>有大學提供課程規劃完成時數認證</li>
<li>有大學提供導師課程，師生一起規劃</li>
<li>有大學不存在服務學習時數為畢業門檻</li>
<li>有大學不拿服務學習時數為畢業門檻，累積時數換通識課程學分</li>
<li>有大學提供全自主完成時數認證</li>
</ul>
<p>舉辦服務學習需要心力跟人力，因為要認證 <strong> 成長 </strong> 情況，所以內容就相當大眾才能被認可吧，寫一些奇葩的內容會被給予什麼評語呢？成腔濫調的成長是值得寫下的嗎？基於每一個人對自我成長的觀點不同，認可這件事情就成了奇怪的制度，自我的成長卻要由別人來劃分定奪。</p>
<p>就我看來，實際運行就是制度上，麻痺自我的簽名參加，就好像做了服務學習，若去問服務中心就會得到回答「<strong> 這是自己選的，也有不少人參加活動是相當用心參與 </strong>」反正在某些情況躺著過也是被認可的，如果要去就要做到好，要是預期做不好參與，那也沒有必要麻痺欺瞞自己去參加。如果四年內學到的是欺瞞制度，這股風氣就會延長吧。</p>
<p>這又讓我想到有門課「<strong> 比起內容更注重報告 </strong>」程式做了什麼不重要，即便你們做了很少，報告看起來很有料就是加分。問了其他學校的助理教授看法「報告吸引錢的方法，實作並不能。」心中頓悟，原來世界並不是想像中的理想。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-TIOJ-1475" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/22/TIOJ-1475/" class="article-date">
  <time datetime="2015-06-22T01:24:23.000Z" itemprop="datePublished">2015-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/22/TIOJ-1475/">TIOJ 1475 錄製專輯 (Record)</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/22/TIOJ-1475/" data-id="ckh8skf96001c78vrpsb3ufux" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/22/TIOJ-1475/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dp/">dp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/大數/">大數</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Jolin 是個愛唱歌的小孩，每次總喜歡邊唱邊用電腦把自己的歌聲錄下來，因此長久下來，在她的電腦裡，已儲存了為數不小的個人歌唱作品。由於耶誕節快要到了，為了準備一份特別的耶誕禮物給爸爸，Jolin 準備從電腦中儲存的個人歌唱作品，挑選幾首歌製成一張個人專輯 CD。由於每張 CD 的容量有限，而Jolin 的個人歌唱作品早已遠遠超過一張 CD 可收錄的容量，因此 Jolin 希望你可以幫她想辦法，讓她所製作的專輯中，能有數目最多的歌曲（請注意：每一首歌只能被收錄一次），同時必需剛好裝滿整張 CD，不留下任何未使用的空間。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">5</div><div class="line">10 50 30 70 60</div><div class="line">80 </div><div class="line">5</div><div class="line">10 50 30 70 60</div><div class="line">20</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2 4</div><div class="line">0 0</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>實作 C++ 簡單的加法、乘法大數，直接把別提的拿過來用。</p>
<p>套用 0/1 背包問題，額外增加大數紀錄方法數，最後乘上 <span>$N!$</span><!-- Has MathJax --> 即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt; </span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BigInteger</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">long</span> <span class="keyword">long</span>&gt; v;</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> MAXC;</div><div class="line">    BigInteger(<span class="keyword">int</span> x = <span class="number">0</span>) &#123;</div><div class="line">        v = <span class="built_in">vector</span>&lt;<span class="keyword">long</span> <span class="keyword">long</span>&gt;(<span class="number">10</span>, <span class="number">0</span>);</div><div class="line">        v[<span class="number">0</span>] = x;</div><div class="line">        MAXC = <span class="number">100000000</span>;</div><div class="line">        normal();</div><div class="line">    &#125;</div><div class="line">    BigInteger <span class="keyword">operator</span>+(<span class="keyword">const</span> BigInteger &amp;x) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="function">BigInteger <span class="title">r</span><span class="params">(<span class="number">0</span>)</span></span>;</div><div class="line">        r.v.resize(max(v.size(), x.v.size()) + <span class="number">2</span>, <span class="number">0</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; v.size(); i++)</div><div class="line">            r.v[i] += v[i];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; x.v.size(); i++)</div><div class="line">            r.v[i] += x.v[i];</div><div class="line">        r.normal();</div><div class="line">        <span class="keyword">return</span> r;</div><div class="line">    &#125;</div><div class="line">    BigInteger <span class="keyword">operator</span>*(<span class="keyword">const</span> BigInteger &amp;x) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="function">BigInteger <span class="title">r</span><span class="params">(<span class="number">0</span>)</span></span>;</div><div class="line">        r.v.resize(v.size() + x.v.size() + <span class="number">2</span>, <span class="number">0</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; v.size(); i++) &#123;</div><div class="line">            <span class="keyword">if</span> (v[i] == <span class="number">0</span>)</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; x.v.size(); j++)</div><div class="line">                r.v[i+j] += v[i] * x.v[j];</div><div class="line">        &#125;</div><div class="line">        r.normal();</div><div class="line">        <span class="keyword">return</span> r;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">normal</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; v.size(); i++) &#123;</div><div class="line">            <span class="keyword">if</span> (v[i] &gt;= MAXC) &#123;</div><div class="line">                v[i+<span class="number">1</span>] += v[i] / MAXC;</div><div class="line">                v[i] %= MAXC;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> s = (<span class="keyword">int</span>) v.size() - <span class="number">1</span>;</div><div class="line">        <span class="keyword">while</span> (s &gt; <span class="number">0</span> &amp;&amp; v[s] == <span class="number">0</span>)</div><div class="line">            s--;</div><div class="line">        v.resize(s+<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isZero</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (v.size() &gt; <span class="number">1</span>)   <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">return</span> v[<span class="number">0</span>] == <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> BigInteger &amp;x) <span class="keyword">const</span> &#123;</div><div class="line">    	<span class="keyword">if</span> (v.size() != x.v.size())</div><div class="line">    		<span class="keyword">return</span> v.size() &lt; x.v.size();</div><div class="line">    	<span class="keyword">for</span> (<span class="keyword">int</span> i = v.size()<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">    		<span class="keyword">if</span> (v[i] != x.v[i])</div><div class="line">    			<span class="keyword">return</span> v[i] &lt; x.v[i];</div><div class="line">    	&#125;</div><div class="line">    	<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> BigInteger &amp;x)  <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">if</span> (v.size() != x.v.size())</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = v.size()<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--)</div><div class="line">            <span class="keyword">if</span> (v[i] != x.v[i])</div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%lld"</span>, v[v.size()<span class="number">-1</span>]);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = (<span class="keyword">int</span>) v.size() - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--)</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%08lld"</span>, v[i]);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N, M, A[<span class="number">128</span>];</div><div class="line">    BigInteger f[<span class="number">128</span>] = &#123;&#125;;</div><div class="line">    f[<span class="number">0</span>] = BigInteger(<span class="number">1</span>);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">128</span>; i++)</div><div class="line">        f[i] = f[i<span class="number">-1</span>] * BigInteger(i);</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;N) == <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;A[i]);</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;M);</div><div class="line">        </div><div class="line">        sort(A, A + N);</div><div class="line">        <span class="keyword">int</span> dp[<span class="number">10005</span>] = &#123;&#125;;</div><div class="line">        BigInteger dp2[<span class="number">10005</span>] = &#123;&#125;;</div><div class="line">        dp2[<span class="number">0</span>] = BigInteger(<span class="number">1</span>), dp[<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="keyword">int</span> x = A[i];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = M; j &gt;= x; j--) &#123;</div><div class="line">                <span class="keyword">if</span> (dp[j] &lt; dp[j-x] + <span class="number">1</span> &amp;&amp; !dp2[j-x].isZero())</div><div class="line">                    dp[j] = dp[j-x] + <span class="number">1</span>, dp2[j] = BigInteger(<span class="number">0</span>);</div><div class="line">                <span class="keyword">if</span> (dp[j] == dp[j-x] + <span class="number">1</span> &amp;&amp; !dp2[j-x].isZero())</div><div class="line">                    dp2[j] = dp2[j] + dp2[j-x];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> a = dp[M];</div><div class="line">        BigInteger b = dp2[M] * f[a];</div><div class="line">        </div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d "</span>, a);</div><div class="line">        b.print();</div><div class="line">        <span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">5</span></div><div class="line"><span class="comment">10 50 30 70 60</span></div><div class="line"><span class="comment">20 </span></div><div class="line"><span class="comment">*/</span></div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/20/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><a class="page-number" href="/page/20/">20</a><span class="page-number current">21</span><a class="page-number" href="/page/22/">22</a><a class="page-number" href="/page/23/">23</a><span class="space">&hellip;</span><a class="page-number" href="/page/83/">83</a><a class="extend next" rel="next" href="/page/22/">Next &raquo;</a>
    </nav>
  
</section>
          
          
            <aside id="sidebar">
  <!-- <div id="ukagaka_panel"></div> -->
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">115</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算機圖學/">計算機圖學</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/">工作應用</a><span class="category-list-count">17</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/可持久化/">可持久化</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/鬼故事/">鬼故事</a><span class="category-list-count">8</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">633</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">483</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">77</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">45</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2020/11/08/work/company-ghost-story-8/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 8</a>
          </li>
        
          <li>
            <a class="text" href="/2020/11/01/work/company-ghost-story-7/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 7</a>
          </li>
        
          <li>
            <a class="text" href="/2020/10/31/lesson/ada-2020-hw1-p3/">
              
                <i class="icon-file-o"></i> 
              
            ADA 2020 Fall P3. ADA Party</a>
          </li>
        
          <li>
            <a class="text" href="/2020/10/31/lesson/ada-2020-hw1-p2/">
              
                <i class="icon-file-o"></i> 
              
            ADA 2020 Fall P2. Bomb Game</a>
          </li>
        
          <li>
            <a class="text" href="/2020/10/25/diary-202010/">
              
                <i class="icon-file-o"></i> 
              
            資訊科學的偏科生 面試者篇</a>
          </li>
        
          <li>
            <a class="text" href="/2020/10/24/work/company-ghost-story-6/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 6</a>
          </li>
        
          <li>
            <a class="text" href="/2020/09/30/work/company-ghost-story-5/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 5</a>
          </li>
        
          <li>
            <a class="text" href="/2020/09/26/work/company-ghost-story-4/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 4</a>
          </li>
        
          <li>
            <a class="text" href="/2020/09/20/java/java-stream/">
              
                <i class="icon-file-o"></i> 
              
            為什麼不推薦用 Java Stream 改寫迴圈</a>
          </li>
        
          <li>
            <a class="text" href="/2020/09/20/work/company-ghost-story-3/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 3</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
<script type="text/javascript">
  $('#ukagaka_panel').ukagaka();
</script>
  
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2020 Shiang-Yun Yang 
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>