<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Morris&#39; Blog">
<meta property="og:url" content="http://morris821028.github.io/page/80/index.html">
<meta property="og:site_name" content="Morris&#39; Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris&#39; Blog">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
  <!-- <link rel="import" href="/bower_components/app-layout/app-layout.html"> --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          
          <section id="main">
  
    <article id="post-oj/uva/uva-177" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/27/oj/uva/uva-177/" class="article-date">
  <time datetime="2014-05-26T23:35:58.000Z" itemprop="datePublished">2014-05-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/27/oj/uva/uva-177/">UVa 177 - Paper Folding</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/27/oj/uva/uva-177/" data-id="ckvd6e9xm03ex9cvnxuhqwkw2" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/27/oj/uva/uva-177/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/遞迴/">遞迴</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>If a large sheet of paper is folded in half, then in half again, etc, with all the folds parallel, then opened up flat, there are a series of parallel creases, some pointing up and some down, dividing the paper into fractions of the original length. If the paper is only opened <code>half-way&#39;&#39; up, so every crease forms a 90 degree angle, then (viewed end-on) it forms a</code>dragon curve’’. For example, if four successive folds are made, then the following curve is seen (note that it does not cross itself, but two corners touch):</p>
<p><img src="/img/177img1.gif" alt="UVa 177"></p>
<p>Write a program to draw the curve which appears after N folds. The exact specification of the curve is as follows:</p>
<ul>
<li>The paper starts flat, with the ``start edge’’ on the left, looking at it from above.</li>
<li>The right half is folded over so it lies on top of the left half, then the right half of the new double sheet is folded on top of the left, to form a 4-thick sheet, and so on, for N folds.</li>
<li>Then every fold is opened from a 180 degree bend to a 90 degree bend.</li>
<li>Finally the bottom edge of the paper is viewed end-on to see the dragon curve. </li>
</ul>
<p>From this view, the only unchanged part of the original paper is the piece containing the <code>start edge</code>, and this piece will be horizontal, with the <code>start edge</code> on the left. This uniquely defines the curve. In the above picture, the <code>start edge</code> is the left end of the rightmost bottom horizontal piece (marked <code>s</code>). Horizontal pieces are to be displayed with the underscore character <code>_</code>, and vertical pieces with the <code>|</code> character.</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>Input will consist of a series of lines, each with a single number N (1 &lt;= N &lt;= 13). The end of the input will be marked by a line containing a zero.</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>Output will consist of a series of dragon curves, one for each value of N in the input. Your picture must be shifted as far left, and as high as possible. Note that for large N, the picture will be greater than 80 characters wide, so it will look messy on the screen. The pattern for each different number of folds is terminated by a line containing a single `^’.</p>
<h2 id="Sample-input"><a href="#Sample-input" class="headerlink" title="Sample input"></a>Sample input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">2</div><div class="line">4</div><div class="line">1</div><div class="line">0</div></pre></td></tr></table></figure>
<h2 id="Sample-output"><a href="#Sample-output" class="headerlink" title="Sample output"></a>Sample output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">|_</div><div class="line"> _|</div><div class="line">^</div><div class="line">   _   _</div><div class="line">  |_|_| |_</div><div class="line">   _|    _|</div><div class="line">|_|</div><div class="line">^</div><div class="line">_|</div><div class="line">^</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p><strong> 題目描述：</strong></p>
<p>將一個長條紙水平擺放，接著將右手邊的紙摺疊到左上邊的紙上面，接著又再重複做幾次，直到 <code>N</code> 次 ( 若將其攤平則會有 2<sup>N</sup> 個折疊區塊 )。摺疊完後，依序將其攤開，攤開的方式為：將前一次摺疊的 (想像與 <code>s</code> 重疊的那一片) 從 180 度旋轉到 90 度位置，依序攤開 N 次。</p>
<p><strong> 題目解法：</strong></p>
<p>這一題就是題目理解麻煩點，但是不難發現肯定是有遞迴需要處理的。</p>
<p>假設我們定義展開的每一根，分別為往上下左右的射線，會發現其對應關係，新的尾會跟舊的頭對照，依序對照到中間部分。</p>
<p>最後得到關係</p>
<ul>
<li>上 變成 左</li>
<li>下 變成 右</li>
<li>左 變成 下</li>
<li>右 變成 上</li>
</ul>
<p>輸出處理方面，利用一個 map 結構去完成。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="built_in">set</span>&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; &gt; P;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> A[<span class="number">1</span>&lt;&lt;<span class="number">15</span>];</div><div class="line">    <span class="comment">// 0 up, 1 down, 2 left, 3 right</span></div><div class="line">    <span class="keyword">int</span> trans[] = &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>&#125;;</div><div class="line">    <span class="keyword">int</span> m = <span class="number">1</span>;</div><div class="line">    A[<span class="number">0</span>] = <span class="number">3</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = m - <span class="number">1</span>, k = m; j &gt;= <span class="number">0</span>; j--, k++)</div><div class="line">            A[k] = trans[A[j]];</div><div class="line">        m = m &lt;&lt; <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> x = <span class="number">-1</span>, y = <span class="number">0</span>, px = <span class="number">0</span>, py = <span class="number">0</span>;</div><div class="line">    P.clear();</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">        <span class="keyword">if</span>(A[i] == <span class="number">0</span>)		x = px&lt;&lt;<span class="number">1</span>, y = py;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(A[i] == <span class="number">1</span>)	x = px&lt;&lt;<span class="number">1</span>, y = py - <span class="number">1</span>;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(A[i] == <span class="number">2</span>)	x = (px&lt;&lt;<span class="number">1</span>)<span class="number">-1</span>, y = py;</div><div class="line">        <span class="keyword">else</span>				x = (px&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>, y = py;</div><div class="line">        <span class="comment">//printf("%d %d %d - %d %d\n", px, py, A[i], x, y);</span></div><div class="line">        <span class="keyword">if</span>(A[i] == <span class="number">0</span>) &#123;</div><div class="line">            P[y].insert(make_pair(x, <span class="number">0</span>));</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(A[i] == <span class="number">1</span>) &#123;</div><div class="line">            P[y].insert(make_pair(x, <span class="number">1</span>));</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(A[i] == <span class="number">2</span>) &#123;</div><div class="line">            P[y].insert(make_pair(x, <span class="number">2</span>));</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            P[y].insert(make_pair(x, <span class="number">3</span>));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(A[i] == <span class="number">0</span>)		py++;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(A[i] == <span class="number">1</span>)	py--;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(A[i] == <span class="number">2</span>)	px--;</div><div class="line">        <span class="keyword">else</span>				px++;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> n; <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) == <span class="number">1</span> &amp;&amp; n; ) &#123;</div><div class="line">        build(n);</div><div class="line">        <span class="keyword">int</span> mxy = <span class="number">-0x3f3f3f3f</span>, mnx = <span class="number">0x3f3f3f3f</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="built_in">set</span>&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; &gt;::iterator it = P.begin();</div><div class="line">        it != P.end(); it++) &#123;</div><div class="line">            mxy = max(mxy, it-&gt;first);</div><div class="line">            <span class="keyword">for</span>(<span class="built_in">set</span>&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt;::iterator jt = it-&gt;second.begin();</div><div class="line">                jt != it-&gt;second.end(); jt++) &#123;</div><div class="line">                mnx = min(mnx, jt-&gt;first);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="built_in">set</span>&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; &gt;::reverse_iterator it = P.rbegin();</div><div class="line">        it != P.rend(); it++) &#123;</div><div class="line">            <span class="keyword">int</span> i = mnx;</div><div class="line">            <span class="keyword">for</span>(<span class="built_in">set</span>&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt;::iterator jt = it-&gt;second.begin();</div><div class="line">                jt != it-&gt;second.end(); jt++) &#123;</div><div class="line">                <span class="keyword">while</span>(i &lt; jt-&gt;first)	<span class="built_in">putchar</span>(<span class="string">' '</span>), i++;</div><div class="line">                i++;</div><div class="line">                <span class="keyword">if</span>(jt-&gt;second == <span class="number">0</span> || jt-&gt;second == <span class="number">1</span>)</div><div class="line">                    <span class="built_in">putchar</span>(<span class="string">'|'</span>);</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    <span class="built_in">putchar</span>(<span class="string">'_'</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//printf("%d %d\n", mxy, mnx);</span></div><div class="line">        <span class="built_in">puts</span>(<span class="string">"^"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-132" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/26/oj/uva/uva-132/" class="article-date">
  <time datetime="2014-05-25T22:59:01.000Z" itemprop="datePublished">2014-05-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/26/oj/uva/uva-132/">UVa 132 - Bumpy Objects</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/26/oj/uva/uva-132/" data-id="ckvd6e9tw03bh9cvngc4xy7hs" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/26/oj/uva/uva-132/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/凸包/">凸包</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/幾何/">幾何</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p><img src="/img/132img1.gif" alt="132img1"></p>
<p>Consider objects such as these. They are polygons, specified by the coordinates of a centre of mass and their vertices. In the figure, centres of mass are shown as black squares. The vertices will be numbered consecutively anti-clockwise as shown.</p>
<p>An object can be rotated to stand stably if two vertices can be found that can be joined by a straight line that does not intersect the object, and, when this line is horizontal, the centre of mass lies above the line and strictly between its endpoints. There are typically many stable positions and each is defined by one of these lines known as its base line. A base line, and its associated stable position, is identified by the highest numbered vertex touched by that line.</p>
<p>Write a program that will determine the stable position that has the lowest numbered base line. Thus for the above objects, the desired base lines would be 6 for object 1, 6 for object 2 and 2 for the square. You may assume that the objects are possible, that is they will be represented as non self-intersecting polygons, although they may well be concave.</p>
<h2 id="Input-and-Output"><a href="#Input-and-Output" class="headerlink" title="Input and Output"></a>Input and Output</h2><p>Successive lines of a data set will contain: a string of less than 20 characters identifying the object; the coordinates of the centre of mass; and the coordinates of successive points terminated by two zeroes (0 0), on one or more lines as necessary. There may be successive data sets (objects). The end of data will be defined by the string ‘#’.</p>
<p>Output will consist of the identification string followed by the number of the relevant base line.</p>
<h2 id="Sample-input"><a href="#Sample-input" class="headerlink" title="Sample input"></a>Sample input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Object2</div><div class="line">4 3</div><div class="line">3 2  5 2  6 1  7 1  6 3  4 7  1 1  2 1  0 0</div><div class="line">Square </div><div class="line">2 2</div><div class="line">1 1  3 1  3 3  1 3  0 0</div><div class="line">#</div></pre></td></tr></table></figure>
<h2 id="Sample-output"><a href="#Sample-output" class="headerlink" title="Sample output"></a>Sample output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Object2             6</div><div class="line">Square              2</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p><strong> 題目描述： </strong></p>
<p>給定一個多邊形，將會給予這個多邊形的質心和頂點。在圖中，質心表示成黑色正方形的小點，而頂點將會使用連續編號逆時針給點。</p>
<p>多邊形可以藉由旋轉放置於水平，並且穩定立起。這時可以發現，會有兩個頂點拉起的水平線，並且質心會位於水平線上的兩個端點之間。</p>
<p>通常一個多邊形具有多個這種水平放置方法，對於一個水平放置方式，可以用在水平線上最大編號的頂點描述。</p>
<p>請輸出最小水平放置的編號。</p>
<p><strong> 題目解法： </strong></p>
<p>對多邊形著手凸包計算，這裡使用單調鍊去完成凸包。接著利用內積找到質心是否在兩個水平線端點 (segment 的上方) 之間。</p>
<p>可以利用外積判斷是否在線 (line) 上。</p>
<p>好好利用數學運算，將可以在簡短的代碼完成。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> eps 1e-6</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pt</span> &#123;</span></div><div class="line">    <span class="keyword">double</span> x, y;</div><div class="line">    Pt(<span class="keyword">double</span> a = <span class="number">0</span>, <span class="keyword">double</span> b = <span class="number">0</span>):</div><div class="line">    	x(a), y(b) &#123;&#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">fabs</span>(x-a.x) &gt; eps)</div><div class="line">            <span class="keyword">return</span> x &lt; a.x;</div><div class="line">        <span class="keyword">return</span> y &lt; a.y;</div><div class="line">    &#125;</div><div class="line">    Pt <span class="keyword">operator</span>-(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</div><div class="line">        Pt ret;</div><div class="line">        ret.x = x - a.x;</div><div class="line">        ret.y = y - a.y;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">dot</span><span class="params">(Pt a, Pt b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> a.x * b.x + a.y * b.y;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">cross2</span><span class="params">(Pt a, Pt b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> a.x * b.y - a.y * b.x;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">cross</span><span class="params">(Pt o, Pt a, Pt b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (a.x-o.x)*(b.y-o.y)-(a.y-o.y)*(b.x-o.x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">between</span><span class="params">(Pt a, Pt b, Pt c)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> dot(c - a, b - a) &gt;= <span class="number">0</span> &amp;&amp; dot(c - b, a - b) &gt;= <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">onSeg</span><span class="params">(Pt a, Pt b, Pt c)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> between(a, b, c) &amp;&amp; <span class="built_in">fabs</span>(cross(a, b, c)) &lt; eps;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">monotone</span><span class="params">(<span class="keyword">int</span> n, Pt p[], Pt ch[])</span> </span>&#123;</div><div class="line">    sort(p, p+n);</div><div class="line">    <span class="keyword">int</span> i, m = <span class="number">0</span>, t;</div><div class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">while</span>(m &gt;= <span class="number">2</span> &amp;&amp; cross(ch[m<span class="number">-2</span>], ch[m<span class="number">-1</span>], p[i]) &lt;= <span class="number">0</span>)</div><div class="line">            m--;</div><div class="line">        ch[m++] = p[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(i = n<span class="number">-1</span>, t = m+<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">        <span class="keyword">while</span>(m &gt;= t &amp;&amp; cross(ch[m<span class="number">-2</span>], ch[m<span class="number">-1</span>], p[i]) &lt;= <span class="number">0</span>)</div><div class="line">            m--;</div><div class="line">        ch[m++] = p[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> m - <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">char</span> testcase[<span class="number">105</span>];</div><div class="line">    Pt P[<span class="number">1024</span>], CH[<span class="number">1024</span>], IN[<span class="number">1024</span>];</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%s"</span>, testcase) == <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">if</span>(!<span class="built_in">strcmp</span>(testcase, <span class="string">"#"</span>))</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">double</span> 	x, y;</div><div class="line">        <span class="keyword">int</span> 	n = <span class="number">0</span>, m;</div><div class="line">        Pt mc;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%lf %lf"</span>, &amp;mc.x, &amp;mc.y);</div><div class="line">        <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%lf %lf"</span>, &amp;x, &amp;y) == <span class="number">2</span>) &#123;</div><div class="line">            <span class="keyword">if</span>(x == <span class="number">0</span> &amp;&amp; y == <span class="number">0</span>)</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            IN[n] = P[n] = Pt(x, y);</div><div class="line">            n++;</div><div class="line">        &#125;</div><div class="line">        m = monotone(n, P, CH);</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0x3f3f3f3f</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>, j = m - <span class="number">1</span>; i &lt; m; j = i++) &#123;</div><div class="line">            <span class="keyword">if</span>(between(CH[i], CH[j], mc)) &#123;</div><div class="line">                <span class="keyword">int</span> mn = <span class="number">0</span>;</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n; k++)</div><div class="line">                    <span class="keyword">if</span>(onSeg(CH[i], CH[j], IN[k]))</div><div class="line">                        mn = max(mn, k);</div><div class="line">                ret = min(ret, mn);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%-20s%d\n"</span>, testcase, ret + <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/hw-multiprocess-and-multithread" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/25/lesson/hw-multiprocess-and-multithread/" class="article-date">
  <time datetime="2014-05-25T12:15:47.000Z" itemprop="datePublished">2014-05-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/作業系統/">作業系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/25/lesson/hw-multiprocess-and-multithread/">作業系統 multiprocess &amp; multithread 作業</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/25/lesson/hw-multiprocess-and-multithread/" data-id="ckvd6e8za02dq9cvn02h1ywrn" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/25/lesson/hw-multiprocess-and-multithread/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/multiprocess/">multiprocess</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/multithread/">multithread</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="A-班程式要求"><a href="#A-班程式要求" class="headerlink" title="A 班程式要求"></a>A 班程式要求</h1><p>請使用所熟悉的程式開發環境設計單一行程產生子行程 ( Child Process ) 與 多執行緒 ( Multi-Thread) 的程式，意即完成下列傳統 for loop 之列印工作，將其改寫成多行程與多執行緒，由不同的行程與執行緒列印不同 i 值。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"output i = %d\n"</span>, i);</div></pre></td></tr></table></figure>
<h1 id="注意事項"><a href="#注意事項" class="headerlink" title="注意事項"></a>注意事項</h1><ul>
<li><strong> 嚴禁從網路抄襲作業 </strong>。每份程式作業將被程式比對軟體檢查，一旦發現抄襲，該份作業以零分計，並且這學期作業系統作業成績以零分計。</li>
<li>後略</li>
</ul>
<blockquote>
<p>這種作業不抄來抄去也難。但是作業格式不清楚，所以也有不同理解方式就是了。</p>
</blockquote>
<h1 id="開始動手"><a href="#開始動手" class="headerlink" title="開始動手"></a>開始動手</h1><p>對於將 for 迴圈改寫，我們必須認知到幾項</p>
<ul>
<li>是否要按照順序輸出？</li>
<li>平台 M$, Linux, or Max OS？</li>
</ul>
<blockquote>
<p>此篇假設目標是一模一樣的輸出</p>
</blockquote>
<h2 id="multiprocess"><a href="#multiprocess" class="headerlink" title="multiprocess"></a>multiprocess</h2><p><code>child process</code> 屬於 multiprocess 中的一種方式。為什麼這麼說呢？multiprocess 只是要求一個 CPU 中有多個工作同時在進行，藉由排程器去進行工作分配。</p>
<p>先不管這些，要實作 <code>child process</code> 看起來只有走向 <code>fork()</code> 一途。而之前 inker 大神則是走非 child process 使用類似 <code>./nachos -e ../test/test1 -e ../test/test1</code> 的方式去運行。</p>
<p>為了實作按照順序輸出，我們需要 process 共同擁有的 shared memory，這個 shared memory 將要紀錄原本 for 裡面的 <code>i</code> 值和一個 <code>sem_t</code>，來保證 process 和 process 之間不會同時搶先動作，<code>sem_t</code> 也許是不需要的，這裡留給實驗者去測試。</p>
<p>為了使輸出一致，在 <code>fork()</code> 完之後，使用 <code>wait()</code> 來等待所有子程序結束。這樣會造成當 for loop 需要跑 n 次，就會總共 n 個 process，也就是一整條鏈下去。</p>
<ul>
<li>思考 <code>wait()</code> 和 <code>sem_t</code> 都不是這麼必要？// 這個要看寫法</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;semaphore.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span>  MAP_ANONYMOUS</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span>  MAP_ANON</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAP_ANONYMOUS MAP_ANON</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> *glob_var;</div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> n = <span class="number">32</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    glob_var = (<span class="keyword">int</span> *)mmap(<span class="literal">NULL</span>, <span class="keyword">sizeof</span> *glob_var, PROT_READ | PROT_WRITE,</div><div class="line">                    MAP_SHARED | MAP_ANONYMOUS, <span class="number">-1</span>, <span class="number">0</span>);</div><div class="line">    </div><div class="line">    <span class="keyword">sem_t</span> *sema = (<span class="keyword">sem_t</span> *)mmap(<span class="literal">NULL</span>, <span class="keyword">sizeof</span>(sema),</div><div class="line">                       PROT_READ |PROT_WRITE,MAP_SHARED|MAP_ANONYMOUS,</div><div class="line">                       <span class="number">-1</span>, <span class="number">0</span>);</div><div class="line">    sem_init(sema, <span class="number">1</span>, <span class="number">0</span>);</div><div class="line">    *glob_var = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> (*glob_var &lt; n) &#123;</div><div class="line">        sem_wait(sema);</div><div class="line">        <span class="keyword">int</span> pid = fork();</div><div class="line">        <span class="keyword">int</span> output = (*glob_var)++;</div><div class="line">        <span class="keyword">if</span> (output &lt; n)</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d, pid = %d\n"</span>, output, pid);</div><div class="line">        sem_post(sema);</div><div class="line">        <span class="keyword">int</span> wpid, status = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> ((wpid = wait(&amp;status)) &gt; <span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="comment">//printf("Exit status of %d was %d (%s)\n", (int)wpid, status, (status &gt; 0) ? "accept" : "reject");</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    munmap(glob_var, <span class="keyword">sizeof</span> *glob_var);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="multithread"><a href="#multithread" class="headerlink" title="multithread"></a>multithread</h2><p>Thread 就相當簡單，因為它們是共用同一個記憶體區段，因此沒有 share memory 的問題。<br>雖然使用 <code>sem_wait(&amp;sem)</code> 和 <code>sem_post(&amp;sem)</code> 來保證區域內的代碼不會同時有多個 thread 在運行，但仍遇到 <code>i = 0</code> 同時在多個 Thread 噴出的情況，這一點百思不得其解，為了解決這一切問題，使用課本提到的 <code>Producer–consumer problem</code> 寫法。</p>
<p>希望能從代碼中看懂。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;semaphore.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></div><div class="line"><span class="keyword">int</span> i = <span class="number">0</span>, n = <span class="number">16</span>;</div><div class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line"><span class="keyword">sem_t</span> sem;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_THREAD = <span class="number">4</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> *<span class="title">Producer</span><span class="params">(<span class="keyword">void</span> *arg)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n;) &#123;</div><div class="line">        sem_wait(&amp;sem);</div><div class="line">        <span class="keyword">if</span>(count == <span class="number">1</span>) &#123;</div><div class="line">            sem_post(&amp;sem);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        count++;</div><div class="line">        <span class="comment">// printf("\nProducer is :%d\n", count);</span></div><div class="line">        sem_post(&amp;sem);</div><div class="line">        i++;</div><div class="line">    &#125;</div><div class="line">    pthread_exit(<span class="literal">NULL</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> *<span class="title">runPrint</span><span class="params">(<span class="keyword">void</span> *arg)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> id = *((<span class="keyword">int</span> *) arg);</div><div class="line">    <span class="keyword">for</span> (; i &lt; n ;) &#123;</div><div class="line">        sem_wait(&amp;sem);</div><div class="line">        <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</div><div class="line">            sem_post(&amp;sem);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        count--;</div><div class="line">        i++;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"loop i = %d, thread id %d\n"</span>, i, id);</div><div class="line">        sem_post(&amp;sem);</div><div class="line">    &#125;</div><div class="line">    pthread_exit(<span class="literal">NULL</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">pthread_t</span> *threads;</div><div class="line">    sem_init(&amp;sem, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    threads = (<span class="keyword">pthread_t</span> *) <span class="built_in">malloc</span>(MAX_THREAD * <span class="keyword">sizeof</span>(<span class="keyword">pthread_t</span>));</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_THREAD; i++) &#123;</div><div class="line">        <span class="keyword">int</span> *p = (<span class="keyword">int</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</div><div class="line">        *p = i;</div><div class="line">        pthread_create(&amp;threads[i], <span class="literal">NULL</span>, runPrint, (<span class="keyword">void</span> *)(p));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">pthread_t</span> producer;</div><div class="line">    <span class="keyword">int</span> *p = (<span class="keyword">int</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</div><div class="line">    *p = <span class="number">-1</span>;</div><div class="line">    pthread_create(&amp;producer, <span class="literal">NULL</span>, Producer, (<span class="keyword">void</span> *)(p));</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; MAX_THREAD; i++) &#123;</div><div class="line">        pthread_join(threads[i], <span class="literal">NULL</span>);</div><div class="line">    &#125;</div><div class="line">    sem_destroy(&amp;sem);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="後記"><a href="#後記" class="headerlink" title="後記"></a>後記</h2><p>代碼沒有寫得很完整，也就是能達到輸出相同且用符合需求，這一點是有很多漏洞的，前人也是鑽漏洞交作業的。相較之下，我們 B 班的作業略顯兇殘，但是網路上資料還真是少呢，雖然還是找地方抄和理解。</p>
<p>測試的時候，為了保證輸出是穩定的，記得得多測試幾次，並且把數字範圍作變調，當然能不能讓一個 create thread 跑完整個迴圈呢？畢竟加上 main thread 就算是 multithread？haha</p>
<h1 id="執行"><a href="#執行" class="headerlink" title="執行"></a>執行</h1><h2 id="編譯"><a href="#編譯" class="headerlink" title="編譯"></a>編譯</h2><ul>
<li><p>Mac OSX</p>
<pre><code>$ clang -pthread x.cpp -o x
</code></pre></li>
<li><p>Linux</p>
<pre><code>$ gcc -lpthread x.cpp -o x
</code></pre><h2 id="運行"><a href="#運行" class="headerlink" title="運行"></a>運行</h2></li>
<li><p>Linux &amp; Max OSX</p>
<pre><code>$ ./x
</code></pre></li>
</ul>
<h1 id="Mac-運行問題"><a href="#Mac-運行問題" class="headerlink" title="Mac 運行問題"></a>Mac 運行問題</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#ifndef  MAP_ANONYMOUS</div><div class="line">#ifdef  MAP_ANON</div><div class="line">#define MAP_ANONYMOUS MAP_ANON</div><div class="line">#endif</div><div class="line">#endif</div></pre></td></tr></table></figure>
<p>不知道為什麼 clang 中沒有定義 <code>MAP_ANONYMOUS</code>，增加上述代碼後正確運行。</p>
<h1 id="其他作業"><a href="#其他作業" class="headerlink" title="其他作業"></a>其他作業</h1><p><a href="http://morris821028.github.io/2014/05/18/operating-system-hw-thread/">B 班程式作業 1</a><br><a href="http://morris821028.github.io/2014/05/24/hw-nachos4/">B 班程式作業 2</a></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/consumption-item-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/25/lesson/consumption-item-1/" class="article-date">
  <time datetime="2014-05-25T06:22:22.000Z" itemprop="datePublished">2014-05-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/通識課程/">通識課程</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/img/sungirl3.jpg" rel="gallery_ckvd6e8y402ca9cvn85v1bw7t">
        <img src="/img/sungirl3.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/25/lesson/consumption-item-1/">當代消費文化與社會 (2)</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/25/lesson/consumption-item-1/" data-id="ckvd6e8y402ca9cvn85v1bw7t" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/25/lesson/consumption-item-1/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/通識/">通識</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="母親節篇"><a href="#母親節篇" class="headerlink" title="母親節篇"></a>母親節篇</h2><ol>
<li>請簡述母親節與消費文化的關聯性 ?<br>母親節與消費文化原本是扯不上邊的，後來商人們藉由這些推銷的活動，給予不知道母親節要怎麼犒勞養育辛勞的兒女們一項消費選擇，因此提供了相關的優惠活動方便消費者，母親節就逐漸跟情人節送禮一樣的氣氛。</li>
<li>舉例說明母親節有哪些消費現象 ?<br>相關女性用品優惠，對於餐飲業而言就是雙人、多人套餐，而觀光景點就是帶著母親出遊享優惠 … 等等。</li>
<li>您決定購買什麼禮物送媽媽及其理由 ?<br>身為一個程序猿，買禮物卻沒有思路，寫卡片卻沒有語言，在這樣的情況下，按照自己最常做的事情下手設計，但最近還有其他程序要趕，大概是趕不上這個母親節專案了。</li>
</ol>
<h2 id="血色月灣"><a href="#血色月灣" class="headerlink" title="血色月灣"></a>血色月灣</h2><div class="video-container"><iframe src="//www.youtube.com/embed/ypeW6lSeUFc" frameborder="0" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=ypeW6lSeUFc" target="_blank" rel="external">Youtube</a></p>
<p>在這場被隱藏的殺戮中，繼上次壽司造成的魚類問題，沒想到日本又在海洋造成了更大的傷害，不管是不是海豚，也許有人會因為海豚可愛而在這一次的血色海灣而保護它，在我們不喜歡的動物上，說不定也有類似的問題。</p>
<p>最令人訝異的是，即使在國際會議中，也有隱瞞事實的大人物在，果然要執行某些事情，不是會議或者是組織所為，而是來自個人的發起。這句話有額外的啟發，為了背後國民的飯碗或支持，這些代表人物不得不說謊的情境，假使一開始錯了，他們便會一直錯下去，這樣的情況令人相當惋惜。</p>
<p>海豚的確很有靈性，在他們受到如此的遭遇，難免會感受到如新世界中，那些因為外表被看成不同種的情況，而受到摧殘的可能，對於靈性的動物，在受到傷害，我們給予同情，在其他情況下則沒有這麼強烈的反應。</p>
<h2 id="消費型科技商品"><a href="#消費型科技商品" class="headerlink" title="消費型科技商品"></a>消費型科技商品</h2><p>現在出門一定有 GPS 衛星導航的裝置，才能穿梭於大街小巷，這些裝置給我們相當大的便利，不用攜帶大量的地圖資訊出門，不會迷路、不用煩惱就可以輕鬆出門。</p>
<p>科技所帶來的便利，使得停下來思考的機會少了，也不會看看四周的景色，追求更快速地抵達目的地，目的地以外的機緣就越來越少了。比起問人，問機器更來得有信任感，這也表示著相信別人給的知識也不是那麼重要。根據新聞的研究報導，也許我們正在改變記憶方式，開始不擅長記繁瑣的事物，而開始擅長去哪裡找資料、如何使用資料。</p>
<p>因此，也常發生因衛星導航所造成的交通事故，被引導到錯誤地方或者是進入不合適的地點。這也反應使用者即使發現了不合理之處，最後仍相信訊息給的答案。假使衛星給了錯誤訊息，或者被惡意修改成錯誤訊息，很容易造就嚴重事故，我們已經被訓練得無法自己處理這些資訊。</p>
<p>也許老師會問我「那你認為到底要不要買衛星導航？」這一點還真的是要看需求，身為宅的人們不喜歡出門呢。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/hw-nachos4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/24/lesson/hw-nachos4/" class="article-date">
  <time datetime="2014-05-24T00:14:43.000Z" itemprop="datePublished">2014-05-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/作業系統/">作業系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/24/lesson/hw-nachos4/">向 NachOS 4.0 作業進發 (1)</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/24/lesson/hw-nachos4/" data-id="ckvd6e8zf02dx9cvnzxjystyy" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/24/lesson/hw-nachos4/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NachOS/">NachOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/作業系統/">作業系統</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="關於-NachOS-4-0"><a href="#關於-NachOS-4-0" class="headerlink" title="關於 NachOS 4.0"></a>關於 NachOS 4.0</h1><p>作為教學用作業系統，需要實現簡單並且儘量縮小與實際作業系統之間的差距，所以我們採用 Nachos 作為作業系統課程的教學實踐平臺。Nachos 是美國加州大學伯克萊分校在作業系統課程中已多次使用的作業系統課程設計平臺，在美國很多大學中得到了應用，它在作業系統教學方面具有一下幾個突出的優點：</p>
<ul>
<li>採用通用虛擬機器</li>
<li>簡單而易於擴展    </li>
<li>物件導向性</li>
<li>… 略</li>
</ul>
<blockquote>
<p>簡單地來說，就是一個模擬作業系統的軟體</p>
</blockquote>
<h1 id="安裝"><a href="#安裝" class="headerlink" title="安裝"></a>安裝</h1><p>課程頁面：<a href="http://networklab.csie.ncu.edu.tw/2014_os/osweb.html#download" target="_blank" rel="external">http://networklab.csie.ncu.edu.tw/2014_os/osweb.html#download</a></p>
<ul>
<li>Platform: Linux or Linux over VMware <pre><code>RedHat Linux 9.0 
</code></pre>  在 Ubuntu 上面運行無法</li>
<li>Install steps<ul>
<li>Get NachOS-4.0<pre><code>wget ../nachos-4.0.tar.gz
</code></pre></li>
<li>Get Cross Compiler<pre><code>wget ../mips-decstation.linux-xgcc.tgz
</code></pre></li>
<li>Move Cross Compiler to /<pre><code>mv ./mips-decstation.linux-xgcc.tgz /
</code></pre></li>
<li>Untar Cross Compiler<pre><code>tar zxvf ./mips-decstation.linux-xgcc.tgz
</code></pre></li>
<li>Untar NachOS-4.0<pre><code>tar zxvf ./nachos-4.0.tar.gz
</code></pre></li>
<li>Make NachOS-4.0<pre><code>cd ./nachos-4.0/code
make
</code></pre></li>
<li>Test if installation is succeeded<pre><code>cd ./userprog
./nachos -e ../test/test1
./nachos -e ../test/test2
</code></pre></li>
</ul>
</li>
</ul>
<p>預期運行結果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">Total threads number is 1</div><div class="line">Thread ../test/test1 is executing.</div><div class="line">Print integer:9</div><div class="line">Print integer:8</div><div class="line">Print integer:7</div><div class="line">Print integer:6</div><div class="line">return value:0</div><div class="line">No threads ready or runnable, and no pending interrupts.</div><div class="line">Assuming the program completed.</div><div class="line">Machine halting!</div><div class="line">                                                                                </div><div class="line">Ticks: total 200, idle 66, system 40, user 94</div><div class="line">Disk I/O: reads 0, writes 0</div><div class="line">Console I/O: reads 0, writes 0</div><div class="line">Paging: faults 0</div><div class="line">Network I/O: packets received 0, sent 0</div><div class="line"></div><div class="line">Total threads number is 1</div><div class="line">Thread ../test/test2 is executing.</div><div class="line">Print integer:20</div><div class="line">Print integer:21</div><div class="line">Print integer:22</div><div class="line">Print integer:23</div><div class="line">Print integer:24</div><div class="line">Print integer:25</div><div class="line">return value:0</div><div class="line">No threads ready or runnable, and no pending interrupts.</div><div class="line">Assuming the program completed.</div><div class="line">Machine halting!</div><div class="line"></div><div class="line">Ticks: total 200, idle 32, system 40, user 128</div><div class="line">Disk I/O: reads 0, writes 0</div><div class="line">Console I/O: reads 0, writes 0</div><div class="line">Paging: faults 0</div><div class="line">Network I/O: packets received 0, sent 0</div></pre></td></tr></table></figure></p>
<h1 id="作業階段"><a href="#作業階段" class="headerlink" title="作業階段"></a>作業階段</h1><h2 id="Multiprogramming"><a href="#Multiprogramming" class="headerlink" title="Multiprogramming"></a>Multiprogramming</h2><p>執行下述指令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./nachos –e ../test/test1 –e ../test/test2</div></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><figcaption><span>test1.c</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"syscall.h"</span></span></div><div class="line">main() &#123;</div><div class="line">    <span class="keyword">int</span> n;</div><div class="line">    <span class="keyword">for</span> (n=<span class="number">9</span>;n&gt;<span class="number">5</span>;n--)</div><div class="line">        PrintInt(n);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>test2.c</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"syscall.h"</span></span></div><div class="line"></div><div class="line">main() &#123;</div><div class="line">    <span class="keyword">int</span> n;</div><div class="line">    <span class="keyword">for</span> (n=<span class="number">20</span>;n&lt;=<span class="number">25</span>;n++)</div><div class="line">        PrintInt(n);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在開始動工前，發現在 Multithread 操作會有錯誤，test1 程序會遞減輸出，而 test2 程序會遞增輸出，但是根據運行結果，兩個程式都會遞增輸出。</p>
<p>目標運行結果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">Total threads number is 2</div><div class="line">Thread ../test/test1 is executing.</div><div class="line">Thread ../test/test2 is executing.</div><div class="line">Print integer:9</div><div class="line">Print integer:8</div><div class="line">Print integer:7</div><div class="line">Print integer:20</div><div class="line">Print integer:21</div><div class="line">Print integer:22</div><div class="line">Print integer:23</div><div class="line">Print integer:24</div><div class="line">Print integer:6</div><div class="line">return value:0</div><div class="line">Print integer:25</div><div class="line">return value:0</div><div class="line">No threads ready or runnable, and no pending interrupts.</div><div class="line">Assuming the program completed.</div><div class="line">Machine halting!</div><div class="line"> </div><div class="line">Ticks: total 300, idle 8, system 70, user 222</div><div class="line">Disk I/O: reads 0, writes 0</div><div class="line">Console I/O: reads 0, writes 0</div><div class="line">Paging: faults 0</div><div class="line">Network I/O: packets received 0, sent 0</div></pre></td></tr></table></figure></p>
<ul>
<li>為什麼兩個程式都會遞增輸出？<br>明顯地是兩個程式匯入時，操作到相同區域的 code segment。如果發現各別遞增和遞減，但是輸出 <code>n</code> 的結果錯誤，則可以想到是 <code>context-switch</code> 上發生問題。</li>
</ul>
<h3 id="解決"><a href="#解決" class="headerlink" title="解決"></a>解決</h3><p>需要為 physical address 做標記，這個 physical address 就是在 main memory 裡面的位置。而每一個 process 都會有一個 AddrSpace，然後紀錄 logical address 所對應在 physical address，也就是 <code>pageTable</code> 對應到 <code>pageTable[i].physicalPage</code>。</p>
<p>也就是說，當要執行 process 某一頁的程序，則將會去找 pageTable 所對應的 physicalPage，然後去運行。在作業一開始給的代碼中，會發現所有程序的 physicalPage 都共用，如此一來當然會執行到同一份 code。</p>
<p>首先，我們需要一個全局的標記，來記錄 main memory page 的情況。<br><figure class="highlight cpp"><figcaption><span>usrprog/addrspace.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddrSpace</span> &#123;</span></div><div class="line">  <span class="keyword">public</span>:</div><div class="line">    ...</div><div class="line">    <span class="keyword">static</span> <span class="keyword">bool</span> usedPhyPage[NumPhysPages];</div><div class="line">  <span class="keyword">private</span>:</div><div class="line">    ...</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>接著，在 addrspace.cc 宣告實體，並且初始化是 <code>0</code>，表示全部都還沒有用過。</p>
<figure class="highlight cpp"><figcaption><span>usrprog/addrspace.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"copyright.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"main.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"addrspace.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"machine.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"noff.h"</span></span></div><div class="line">    ...</div><div class="line"><span class="keyword">bool</span> AddrSpace::usedPhyPage[NumPhysPages] = &#123;<span class="number">0</span>&#125;;</div><div class="line">    ...</div></pre></td></tr></table></figure>
<p>當 process 執行成功後，將會釋放資源。此時將要把標記使用的 page 設回未使用。<br><figure class="highlight cpp"><figcaption><span>usrprog/addrspace.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">AddrSpace::~AddrSpace()</div><div class="line">&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numPages; i++)</div><div class="line">        AddrSpace::usedPhyPage[pageTable[i].physicalPage] = <span class="literal">false</span>;</div><div class="line">   <span class="keyword">delete</span> pageTable;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最後，就是稍微麻煩的地方，當將程序載入記憶體時，要去填入 <code>pageTable[]</code> 對應的 <code>physicalPage</code>，這裡使用線性時間去搜索第一個未使用的 page 進行填入。</p>
<p>載入確定後，便要開始執行，執行的時候要去算程序進入點，進入點的位置即是 main memory address。</p>
<p><code>mainMemory[pageTable[noffH.code.virtualAddr/PageSize].physicalPage * PageSize + (noffH.code.virtualAddr%PageSize)]</code></p>
<p>首先算出第幾頁，然後乘上 <code>PageSize</code> 就是 page base，而 page offset 則是 <code>code.address mod PageSize</code>。</p>
<p>最後，<code>page base + page offset</code> 就是我們所需要的程序進入點。</p>
<figure class="highlight cpp"><figcaption><span>usrprog/addrspace.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">bool</span> AddrSpace::Load(<span class="keyword">char</span> *fileName) &#123;</div><div class="line">    OpenFile *executable = kernel-&gt;fileSystem-&gt;Open(fileName);</div><div class="line">    NoffHeader noffH;</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> size;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (executable == <span class="literal">NULL</span>) &#123;</div><div class="line">    <span class="built_in">cerr</span> &lt;&lt; <span class="string">"Unable to open file "</span> &lt;&lt; fileName &lt;&lt; <span class="string">"\n"</span>;</div><div class="line">    <span class="keyword">return</span> FALSE;</div><div class="line">    &#125;</div><div class="line">    executable-&gt;ReadAt((<span class="keyword">char</span> *)&amp;noffH, <span class="keyword">sizeof</span>(noffH), <span class="number">0</span>);</div><div class="line">    <span class="keyword">if</span> ((noffH.noffMagic != NOFFMAGIC) &amp;&amp; </div><div class="line">        (WordToHost(noffH.noffMagic) == NOFFMAGIC))</div><div class="line">    	SwapHeader(&amp;noffH);</div><div class="line">    ASSERT(noffH.noffMagic == NOFFMAGIC);</div><div class="line"></div><div class="line"><span class="comment">// how big is address space?</span></div><div class="line">    size = noffH.code.size + noffH.initData.size + noffH.uninitData.size </div><div class="line">            + UserStackSize;	<span class="comment">// we need to increase the size</span></div><div class="line">                        <span class="comment">// to leave room for the stack</span></div><div class="line">    numPages = divRoundUp(size, PageSize);</div><div class="line"><span class="comment">//	cout &lt;&lt; "number of pages of " &lt;&lt; fileName&lt;&lt; " is "&lt;&lt; numPages &lt;&lt; endl;</span></div><div class="line"><span class="comment">// morris add</span></div><div class="line">    pageTable = <span class="keyword">new</span> TranslationEntry[numPages];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; numPages; i++) &#123;</div><div class="line">        pageTable[i].virtualPage = i;</div><div class="line">        <span class="keyword">while</span>(j &lt; NumPhysPages &amp;&amp; AddrSpace::usedPhyPage[j] == <span class="literal">true</span>)</div><div class="line">            j++;</div><div class="line">        AddrSpace::usedPhyPage[j] = <span class="literal">true</span>;</div><div class="line">        pageTable[i].physicalPage = j;</div><div class="line">        pageTable[i].valid = <span class="literal">true</span>;</div><div class="line">        pageTable[i].use = <span class="literal">false</span>;</div><div class="line">        pageTable[i].dirty = <span class="literal">false</span>;</div><div class="line">        pageTable[i].readOnly = <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line"><span class="comment">// end morris add</span></div><div class="line">    size = numPages * PageSize;</div><div class="line"></div><div class="line">    ASSERT(numPages &lt;= NumPhysPages);		<span class="comment">// check we're not trying</span></div><div class="line">                        <span class="comment">// to run anything too big --</span></div><div class="line">                        <span class="comment">// at least until we have</span></div><div class="line">                        <span class="comment">// virtual memory</span></div><div class="line"></div><div class="line">    DEBUG(dbgAddr, <span class="string">"Initializing address space: "</span> &lt;&lt; numPages &lt;&lt; <span class="string">", "</span> &lt;&lt; size);</div><div class="line"></div><div class="line"><span class="comment">// then, copy in the code and data segments into memory</span></div><div class="line">    <span class="keyword">if</span> (noffH.code.size &gt; <span class="number">0</span>) &#123;</div><div class="line">        DEBUG(dbgAddr, <span class="string">"Initializing code segment."</span>);</div><div class="line">    DEBUG(dbgAddr, noffH.code.virtualAddr &lt;&lt; <span class="string">", "</span> &lt;&lt; noffH.code.size);</div><div class="line"><span class="comment">// morris add</span></div><div class="line">        	executable-&gt;ReadAt(</div><div class="line">        &amp;(kernel-&gt;machine-&gt;mainMemory[pageTable[noffH.code.virtualAddr/PageSize].physicalPage * PageSize + (noffH.code.virtualAddr%PageSize)]), </div><div class="line">            noffH.code.size, noffH.code.inFileAddr);</div><div class="line"><span class="comment">// end morris add</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (noffH.initData.size &gt; <span class="number">0</span>) &#123;</div><div class="line">        DEBUG(dbgAddr, <span class="string">"Initializing data segment."</span>);</div><div class="line">    DEBUG(dbgAddr, noffH.initData.virtualAddr &lt;&lt; <span class="string">", "</span> &lt;&lt; noffH.initData.size);</div><div class="line"><span class="comment">// morris add</span></div><div class="line">        executable-&gt;ReadAt(</div><div class="line">        &amp;(kernel-&gt;machine-&gt;mainMemory[pageTable[noffH.initData.virtualAddr/PageSize].physicalPage * PageSize + (noffH.code.virtualAddr%PageSize)]),</div><div class="line">            noffH.initData.size, noffH.initData.inFileAddr);</div><div class="line"><span class="comment">// end morris add</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">delete</span> executable;			<span class="comment">// close file</span></div><div class="line">    <span class="keyword">return</span> TRUE;			<span class="comment">// success</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h2 id="Sleep-System-call"><a href="#Sleep-System-call" class="headerlink" title="Sleep() System call"></a>Sleep() System call</h2><p>撰寫自己的 Sleep function，將該 Thread 進入休眠。</p>
<h3 id="測試檔案"><a href="#測試檔案" class="headerlink" title="測試檔案"></a>測試檔案</h3><p>與一開始的 <code>test1.c</code> 很像，這裡先做個簡單測試。<br><figure class="highlight cpp"><figcaption><span>/code/test/sleep.c</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"syscall.h"</span></span></div><div class="line">main() &#123;</div><div class="line">    <span class="keyword">int</span> i;</div><div class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</div><div class="line">        Sleep(<span class="number">10000000</span>);</div><div class="line">        PrintInt(<span class="number">50</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>因為整個測試檔案是要能在 nachOS 上面跑，所以不能使用一般的編譯方式？所以把這些訊息寫入 <code>Makefile</code> 中，之後下 <code>$ make</code> 產出 <code>sleep</code> 即可。<br><figure class="highlight cpp"><figcaption><span>/code/test/Makefile</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">all: halt shell matmult sort test1 test2 sleep</div><div class="line">...</div><div class="line">sleep: sleep.o start.o</div><div class="line">    &lt;span&gt;$(LD)$&lt;/span&gt;&lt;!-- Has MathJax --&gt;(LDFLAGS) start.o sleep.o -o sleep.coff</div><div class="line">    ../bin/coff2noff sleep.coff sleep</div><div class="line">...</div></pre></td></tr></table></figure></p>
<blockquote>
<p>如果無法在 <code>/code/test</code> 下 <code>$ make</code> 順利產出，則請參照 <strong> 其他指令 </strong>，將原本下載的 <code>mips-decstation.linux-xgcc.gz</code> 解壓縮產生的 <code>/usr</code> 移動到正確位置。</p>
</blockquote>
<h3 id="解決-1"><a href="#解決-1" class="headerlink" title="解決"></a>解決</h3><p>首先，要模仿 <code>PrintInt()</code>，找到切入的宣告位置。努力地尾隨前人。</p>
<figure class="highlight cpp"><figcaption><span>/code/userprog/syscall.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SC_PrintInt	11</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SC_Sleep	12</span></div><div class="line">...</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">PrintInt</span><span class="params">(<span class="keyword">int</span> number)</span></span>;	<span class="comment">//my System Call</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Sleep</span><span class="params">(<span class="keyword">int</span> number)</span></span>;         <span class="comment">// morris add</span></div><div class="line">...</div></pre></td></tr></table></figure>
<p>接著，找一下 ASM。<br>以下部分就不得而知了，為什麼會出現在 <code>/code/test</code> 目錄下。<br><figure class="highlight cpp"><figcaption><span>/code/test/start.s</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">    ...</div><div class="line">PrintInt:</div><div class="line">    addiu   &lt;span&gt;$2,$&lt;/span&gt;&lt;!-- Has MathJax --&gt;0,SC_PrintInt</div><div class="line">    syscall</div><div class="line">    j       $<span class="number">31</span></div><div class="line">    .end    PrintInt</div><div class="line"></div><div class="line">    .globl  Sleep</div><div class="line">    .ent	Sleep</div><div class="line">Sleep:</div><div class="line">    addiu   &lt;span&gt;$2,$&lt;/span&gt;&lt;!-- Has MathJax --&gt;0,SC_Sleep</div><div class="line">    syscall</div><div class="line">    j	$<span class="number">31</span></div><div class="line">    .end	Sleep</div><div class="line">    ...</div></pre></td></tr></table></figure></p>
<p>最後，確定 nachOS 會處理我們的例外操作。</p>
<figure class="highlight cpp"><figcaption><span>/code/userprog/exception.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">    ...</div><div class="line"><span class="keyword">case</span> SC_PrintInt:</div><div class="line">    val=kernel-&gt;machine-&gt;ReadRegister(<span class="number">4</span>);</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Print integer:"</span> &lt;&lt; val &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span>;</div><div class="line"><span class="keyword">case</span> SC_Sleep:</div><div class="line">    val=kernel-&gt;machine-&gt;ReadRegister(<span class="number">4</span>);</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Sleep Time "</span> &lt;&lt; val &lt;&lt; <span class="string">"(ms) "</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    kernel-&gt;alarm-&gt;WaitUntil(val);</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">    ...</div></pre></td></tr></table></figure>
<blockquote>
<p>到這裡需要喘口氣，剛找了一陣子的代碼。接著才是重頭戲，因為你看到了 <code>kernel-&gt;alarm-&gt;WaitUntil(val);</code> 出現了。沒錯！我們需要撰寫那邊的代碼。</p>
</blockquote>
<p>既然 kernel 存有 <code>alarm</code>，也就是說每隔固定一段間，就會呼叫 <code>Alarm::CallBack()</code>，因此，對於這個鬧鐘來個累加器 <code>Bedroom::_current_interrupt</code>，全局去記數，當作毫秒 (ms) 看待就可以，每加一次就相當於過了 1 毫秒 (ms)。</p>
<p>假設現在某一個 <code>time = _current_interrupt</code> 呼叫 <code>Sleep(x)</code> 後，將 <code>(Thread address, _current_interrupt + x)</code> 丟入 List，則期望在 <code>_current_interrupt + x</code> 的時候甦醒。因此，每當 _current_interrupt++ 就去檢查 List 中，誰的預期時間小於 _current_interrupt，就將其從 List 中清除。</p>
<blockquote>
<p>這裡先不考慮 _current_interrupt Overflow 的問題，根據電腦效率，可能在 5 ~ 10 秒內就發生一次，此時會造成所有 Thread 沉眠很久。若察覺 Sleep 太久，則是發生 Overflow。</p>
</blockquote>
<ul>
<li>當有程序呼叫 <code>Sleep()</code> 時，會呼叫 <code>WaitUntil()</code>，然後將其丟入 <code>Bedroom</code> 安眠。</li>
<li>然後在 <code>CallBlack()</code> 被呼叫時，來去 <code>Bedroom</code> 檢查誰該醒來了。</li>
</ul>
<figure class="highlight cpp"><figcaption><span>/code/threads/alarm.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"copyright.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"utility.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"callback.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"timer.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"thread.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bedroom</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        Bedroom():_current_interrupt(<span class="number">0</span>) &#123;&#125;;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">PutToBed</span><span class="params">(Thread *t, <span class="keyword">int</span> x)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">MorningCall</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">IsEmpty</span><span class="params">()</span></span>;</div><div class="line">    <span class="keyword">private</span>:</div><div class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Bed</span> &#123;</span></div><div class="line">            <span class="keyword">public</span>:</div><div class="line">                Bed(Thread* t, <span class="keyword">int</span> x):</div><div class="line">                    sleeper(t), when(x) &#123;&#125;;</div><div class="line">                Thread* sleeper;</div><div class="line">                <span class="keyword">int</span> when;</div><div class="line">        &#125;;</div><div class="line">    </div><div class="line">    <span class="keyword">int</span> _current_interrupt;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">list</span>&lt;Bed&gt; _beds;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// The following class defines a software alarm clock. </span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Alarm</span> :</span> <span class="keyword">public</span> CallBackObj &#123;</div><div class="line">  <span class="keyword">public</span>:</div><div class="line">    Alarm(<span class="keyword">bool</span> doRandomYield);	<span class="comment">// Initialize the timer, and callback </span></div><div class="line">                <span class="comment">// to "toCall" every time slice.</span></div><div class="line">    ~Alarm() &#123; <span class="keyword">delete</span> timer; &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">WaitUntil</span><span class="params">(<span class="keyword">int</span> x)</span></span>;	<span class="comment">// suspend execution until time &gt; now + x</span></div><div class="line"></div><div class="line">  <span class="keyword">private</span>:</div><div class="line">    Timer *timer;		<span class="comment">// the hardware timer device</span></div><div class="line">    Bedroom _bedroom;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CallBack</span><span class="params">()</span></span>;		<span class="comment">// called when the hardware</span></div><div class="line">                <span class="comment">// timer generates an interrupt</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>確定有哪些 method 就可以開始實作了。</p>
<figure class="highlight cpp"><figcaption><span>/code/threads/alarm.cc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> Alarm::CallBack() &#123;</div><div class="line">    Interrupt *interrupt = kernel-&gt;interrupt;</div><div class="line">    MachineStatus status = interrupt-&gt;getStatus();</div><div class="line">    <span class="keyword">bool</span> woken = _bedroom.MorningCall();</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (status == IdleMode &amp;&amp; !woken &amp;&amp; _bedroom.IsEmpty()) &#123;<span class="comment">// is it time to quit?</span></div><div class="line">        <span class="keyword">if</span> (!interrupt-&gt;AnyFutureInterrupts()) &#123;</div><div class="line">        timer-&gt;Disable();	<span class="comment">// turn off the timer</span></div><div class="line">    &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;			<span class="comment">// there's someone to preempt</span></div><div class="line">    interrupt-&gt;YieldOnReturn();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Alarm::WaitUntil(<span class="keyword">int</span> x) &#123;</div><div class="line">    IntStatus oldLevel = kernel-&gt;interrupt-&gt;SetLevel(IntOff);</div><div class="line">    Thread* t = kernel-&gt;currentThread;</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Alarm::WaitUntil go sleep"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    _bedroom.PutToBed(t, x);</div><div class="line">    kernel-&gt;interrupt-&gt;SetLevel(oldLevel);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">bool</span> Bedroom::IsEmpty() &#123;</div><div class="line">    <span class="keyword">return</span> _beds.size() == <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Bedroom::PutToBed(Thread*t, <span class="keyword">int</span> x) &#123;</div><div class="line">    ASSERT(kernel-&gt;interrupt-&gt;getLevel() == IntOff);</div><div class="line">    _beds.push_back(Bed(t, _current_interrupt + x));</div><div class="line">    t-&gt;Sleep(<span class="literal">false</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">bool</span> Bedroom::MorningCall() &#123;</div><div class="line">    <span class="keyword">bool</span> woken = <span class="literal">false</span>;</div><div class="line"></div><div class="line">    _current_interrupt ++;</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="built_in">std</span>::<span class="built_in">list</span>&lt;Bed&gt;::iterator it = _beds.begin(); </div><div class="line">        it != _beds.end(); ) &#123;</div><div class="line">        <span class="keyword">if</span>(_current_interrupt &gt;= it-&gt;when) &#123;</div><div class="line">            woken = <span class="literal">true</span>;</div><div class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"Bedroom::MorningCall Thread woken"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">            kernel-&gt;scheduler-&gt;ReadyToRun(it-&gt;sleeper);</div><div class="line">            it = _beds.erase(it);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            it++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> woken;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>到這裡我們就完成 <code>Sleep()</code> 製作。</p>
<p>在下一階段，將要加入排程的製作。</p>
<h2 id="Scheduling"><a href="#Scheduling" class="headerlink" title="Scheduling"></a>Scheduling</h2><p>目標完成 SJF, RR, FIFO。<br>請參閱 “向 NachOS 4.0 作業進發 (2)”</p>
<h1 id="其他指令"><a href="#其他指令" class="headerlink" title="其他指令"></a>其他指令</h1><ul>
<li><p>打包轉移 // 交作業前，將檔案包出傳送，此指令不是壓縮用途</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ tar cvf FileName.tar DirName</div></pre></td></tr></table></figure>
</li>
<li><p>複製資料夾 // 將 nachos gcc library 搬移至 <code>/usr/local/nachos ...</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cp -a DirName TARGET_PATH</div></pre></td></tr></table></figure>
</li>
<li><p>轉移至 root 權限 // 如果指令權限不夠，需要下達此指令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ su</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="備忘"><a href="#備忘" class="headerlink" title="備忘"></a>備忘</h1><ul>
<li>網路上有幾個 Java 版本的 NachOS，架構稍微不同，如果發現文章說明有點怪怪的，請看一下他是用 JAVA 版本還是 C++ 版本。</li>
<li>至於怎麼將檔案從 Red Hat，這有點惱人，可以想辦法安裝其他瀏覽器，然後開 e-mail 送出，或者使用 terminal 上的 wget 安裝 … 一堆辦法。最後我自己用 nodejs 寫一個簡單的 upload server 傳出來。</li>
</ul>
<h1 id="代碼下載"><a href="#代碼下載" class="headerlink" title="代碼下載"></a>代碼下載</h1><p><a href="https://github.com/morris821028/hw-nachos-4.0" target="_blank" rel="external">Github</a></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-134-" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/23/oj/uva/uva-134-/" class="article-date">
  <time datetime="2014-05-23T00:08:43.000Z" itemprop="datePublished">2014-05-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/23/oj/uva/uva-134-/">UVa 134 - Loglan-A Logical Language</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/23/oj/uva/uva-134-/" data-id="ckvd6e9u003bk9cvnhx0t93u2" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/23/oj/uva/uva-134-/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LL-1/">LL(1)</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/編譯器/">編譯器</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Loglan is a synthetic speakable language designed to test some of the fundamental problems of linguistics, such as the Sapir Whorf hypothesis. It is syntactically unambiguous, culturally neutral and metaphysically parsimonious. What follows is a gross over-simplification of an already very small grammar of some 200 rules.</p>
<p>Loglan sentences consist of a series of words and names, separated by spaces, and are terminated by a period (.). Loglan words all end with a vowel; names, which are derived extra-linguistically, end with a consonant. Loglan words are divided into two classes–little words which specify the structure of a sentence, and predicates which have the form CCVCV or CVCCV where C represents a consonant and V represents a vowel (see examples later).</p>
<p>The subset of Loglan that we are considering uses the following grammar:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">A             →  a | e | i | o | u</div><div class="line">MOD           →  ga | ge | gi | go | gu</div><div class="line">BA            →  ba | be | bi | bo | bu</div><div class="line">DA            →  da | de | di | do | du</div><div class="line">LA            →  la | le | li | lo | lu</div><div class="line">NAM           →  &#123;all names&#125;</div><div class="line">PREDA         →  &#123;all predicates&#125;</div><div class="line">&lt;sentence&gt;    →  &lt;statement&gt; | &lt;predclaim&gt;</div><div class="line">&lt;predclaim&gt;   →  &lt;predname&gt; BA &lt;preds&gt; | DA &lt;preds&gt;</div><div class="line">&lt;preds&gt;       →  &lt;predstring&gt; | &lt;preds&gt; A &lt;predstring&gt;</div><div class="line">&lt;predname&gt;    →  LA &lt;predstring&gt; | NAM</div><div class="line">&lt;predstring&gt;  →  PREDA | &lt;predstring&gt; PREDA</div><div class="line">&lt;statement&gt;   →  &lt;predname&gt; &lt;verbpred&gt; &lt;predname&gt; | &lt;predname&gt; &lt;verbpred&gt;</div><div class="line">&lt;verbpred&gt;    →  MOD &lt;predstring&gt;</div></pre></td></tr></table></figure>
<p>Write a program that will read a succession of strings and determine whether or not they are correctly formed Loglan sentences.</p>
<h2 id="Input-and-Output"><a href="#Input-and-Output" class="headerlink" title="Input and Output"></a>Input and Output</h2><p>Each Loglan sentence will start on a new line and will be terminated by a period (.). The sentence may occupy more than one line and words may be separated by more than one whitespace character. The input will be terminated by a line containing a single `#’. You can assume that all words will be correctly formed.</p>
<p>Output will consist of one line for each sentence containing either <code>Good&#39; or</code>Bad!’.</p>
<h2 id="Sample-input"><a href="#Sample-input" class="headerlink" title="Sample input"></a>Sample input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">la mutce bunbo mrenu bi ditca.</div><div class="line">la fumna bi le mrenu.</div><div class="line">djan ga vedma le negro ketpi.</div><div class="line">#</div></pre></td></tr></table></figure>
<h2 id="Sample-output"><a href="#Sample-output" class="headerlink" title="Sample output"></a>Sample output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Good</div><div class="line">Bad!</div><div class="line">Good</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>其實這一題有比較好的解法，但是在正在學編譯器，因此把 LL(1) parser 運用在此題<br>，所以代碼會稍微長一點。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;sentence&gt;    -&gt;  &lt;common_pre&gt;</div><div class="line">&lt;sentence&gt;    -&gt;  DA &lt;preds&gt;</div><div class="line">&lt;common_pre&gt;  -&gt;  &lt;predname&gt; &lt;suffix&gt;</div><div class="line">&lt;suffix&gt;      -&gt;  &lt;predclaim&gt;</div><div class="line">&lt;suffix&gt;      -&gt;  &lt;statement&gt;</div><div class="line">&lt;predclaim&gt;   -&gt;  BA &lt;preds&gt;</div><div class="line">&lt;preds&gt;       -&gt;  &lt;preds_head&gt; &lt;preds_tail&gt;</div><div class="line">&lt;preds_head&gt;  -&gt;  &lt;predstring&gt;</div><div class="line">&lt;preds_tail&gt;  -&gt;  A &lt;predstring&gt; &lt;preds_tail&gt;</div><div class="line">&lt;preds_tail&gt;  -&gt;  l</div><div class="line">&lt;predname&gt;    -&gt;  LA &lt;predstring&gt;</div><div class="line">&lt;predname&gt;    -&gt;  NAM</div><div class="line">&lt;predstring&gt;  -&gt;  PREDA &lt;predstr_tail&gt;</div><div class="line">&lt;predstr_tail&gt; -&gt; PREDA &lt;predstr_tail&gt;</div><div class="line">&lt;predstr_tail&gt; -&gt; l</div><div class="line">&lt;statement&gt;   -&gt;  &lt;verbpred&gt; &lt;statement_s&gt;</div><div class="line">&lt;statement_s&gt; -&gt;  &lt;predname&gt;</div><div class="line">&lt;statement_s&gt; -&gt;  l</div><div class="line">&lt;verbpred&gt;    -&gt;  MOD &lt;predstring&gt;</div></pre></td></tr></table></figure>
<p>為了要符合 LL(1) 的形式，要想辦法將 Grammar 符合規格，也就是每一條 production rule 的 predict set 不會有模稜兩個的情況，也就是說當我看到某個 non-terminal 在 stack 上，在去看下一個 token，然後可以對於 (non-terminal, token) 只找到一條規則去匹配。</p>
<p>predict set 是根據每一條 production rule 所產生的，也就是說這個推論可以產生的第一個 token 是什麼，假使有相同的前綴時，則必須拉出做調整。// 因為這將會造成模稜兩可的情況。</p>
<p>遇到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">A -&gt; BCx</div><div class="line">A -&gt; BCy</div></pre></td></tr></table></figure></p>
<p>應調整成<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">A -&gt; BCW</div><div class="line">W -&gt; x</div><div class="line">W -&gt; y</div></pre></td></tr></table></figure></p>
<p>在 parsing 問題上，應避免替換的無限迴圈。<br>遇到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">A -&gt; AC</div><div class="line">A -&gt; X</div><div class="line">A -&gt; Y</div></pre></td></tr></table></figure></p>
<p>應調整成<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">A -&gt; WD</div><div class="line">D -&gt; CD</div><div class="line">D -&gt; lambda</div><div class="line">W -&gt; X</div><div class="line">W -&gt; Y</div></pre></td></tr></table></figure></p>
<p>發現對照課本的 parsing function 撰寫起來才發現有些不完善的地方，對於 <code>lldriver()</code> 會沒有辦法應對輸入結束，要吐出 lambda 的問題。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Production</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        <span class="built_in">string</span> 			LHS;</div><div class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; 	RHS;</div><div class="line">        <span class="keyword">int</span> 			label;</div><div class="line">        </div><div class="line">        Production(<span class="built_in">string</span> L = <span class="string">""</span>, <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; R = <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;()) &#123;</div><div class="line">            LHS = L;</div><div class="line">            RHS = R;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%s -&gt; "</span>, LHS.c_str());</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; RHS.size(); i++)</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%s"</span>, RHS[i].c_str());</div><div class="line">        &#125;</div><div class="line">&#125;;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grammar</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">string</span> 		lambda;</div><div class="line">        <span class="built_in">string</span> 						start_symbol;</div><div class="line">        <span class="built_in">vector</span>&lt;Production&gt; 			rules;</div><div class="line">        <span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; &gt; 	first_set;</div><div class="line">        <span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; &gt; 	follow_set;</div><div class="line">        <span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">bool</span>&gt; 			derives_lambda;</div><div class="line">        <span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="built_in">map</span>&lt;<span class="built_in">string</span>, Production&gt; &gt;	lltable;</div><div class="line">        </div><div class="line">        <span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">bool</span>&gt; mark_lambda();</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">fill_first_set</span><span class="params">()</span></span>;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">fill_follow_set</span><span class="params">()</span></span>;</div><div class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">isNonterminal</span><span class="params">(<span class="built_in">string</span> token)</span></span>;</div><div class="line">        <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; compute_first(<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; rhs);</div><div class="line">        <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; get_predict_set(Production p);</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">fill_lltable</span><span class="params">()</span></span>;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">lldriver</span><span class="params">(<span class="built_in">queue</span>&lt;<span class="built_in">string</span>&gt; tokens)</span></span>;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">const</span> <span class="built_in">string</span> Grammar::lambda(<span class="string">"l"</span>);</div><div class="line"></div><div class="line"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; Grammar::compute_first(<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; rhs) &#123;</div><div class="line">    <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; result;</div><div class="line">    <span class="keyword">size_t</span> i;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span>(rhs.size() == <span class="number">0</span> || rhs[<span class="number">0</span>] == Grammar::lambda) &#123;</div><div class="line">        result.insert(Grammar::lambda);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        result = first_set[rhs[<span class="number">0</span>]];</div><div class="line">        <span class="keyword">for</span>(i = <span class="number">1</span>; i &lt; rhs.size() &amp;&amp; </div><div class="line">            first_set[rhs[i<span class="number">-1</span>]].find(Grammar::lambda) != first_set[rhs[i<span class="number">-1</span>]].end(); i++) &#123;</div><div class="line">            <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; f = first_set[rhs[i]];</div><div class="line">            f.erase(Grammar::lambda);</div><div class="line">            result.insert(f.begin(), f.end());	</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(i == rhs.size() </div><div class="line">            &amp;&amp; first_set[rhs[i<span class="number">-1</span>]].find(Grammar::lambda) != first_set[rhs[i<span class="number">-1</span>]].end()) &#123;</div><div class="line">            result.insert(Grammar::lambda);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            result.erase(Grammar::lambda);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125; </div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * please call get_predict_set() after fill_follow_set() and fill_first_set()</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; Grammar::get_predict_set(Production p) &#123;</div><div class="line">    <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; result;</div><div class="line">    <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; rfirst;</div><div class="line">    </div><div class="line">    rfirst = compute_first(p.RHS);</div><div class="line">    <span class="keyword">if</span>(rfirst.find(Grammar::lambda) != rfirst.end()) &#123;</div><div class="line">        rfirst.erase(Grammar::lambda);</div><div class="line">        result.insert(rfirst.begin(), rfirst.end());</div><div class="line">        rfirst = follow_set[p.LHS];</div><div class="line">        result.insert(rfirst.begin(), rfirst.end());</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        result.insert(rfirst.begin(), rfirst.end());</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">void</span> Grammar::fill_lltable() &#123;</div><div class="line">    <span class="built_in">string</span>		A; <span class="comment">// nonterminal</span></div><div class="line">    Production 	p;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</div><div class="line">        p = rules[i];</div><div class="line">        A = p.LHS;</div><div class="line">        <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; predict_set = get_predict_set(p);</div><div class="line">        </div><div class="line">        <span class="keyword">for</span>(<span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;::iterator it = predict_set.begin();</div><div class="line">            it != predict_set.end(); it++) &#123;</div><div class="line">            assert(lltable[A].find(*it) == lltable[A].end());</div><div class="line">            lltable[A][*it] = p;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"><span class="keyword">bool</span> Grammar::isNonterminal(<span class="built_in">string</span> token) &#123;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span>(token[<span class="number">0</span>] == <span class="string">'&lt;'</span> &amp;&amp; token[token.length() - <span class="number">1</span>] == <span class="string">'&gt;'</span>)</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">bool</span>&gt; Grammar::mark_lambda() &#123;</div><div class="line">    <span class="keyword">bool</span> 				rhs_derives_lambda;</div><div class="line">    <span class="keyword">bool</span> 				changes;</div><div class="line">    Production 			p;</div><div class="line">    </div><div class="line">    derives_lambda.clear();</div><div class="line">    </div><div class="line">    <span class="comment">/* initially, nothing is marked. */</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</div><div class="line">        derives_lambda[rules[i].LHS] = <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">do</span> &#123;</div><div class="line">        changes = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</div><div class="line">            p = rules[i];</div><div class="line">            <span class="keyword">if</span>(!derives_lambda[p.LHS]) &#123;</div><div class="line">                <span class="keyword">if</span>(p.RHS.size() == <span class="number">0</span> || p.RHS[<span class="number">0</span>] == Grammar::lambda) &#123;</div><div class="line">                    changes = derives_lambda[p.LHS] = <span class="literal">true</span>;</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">/* does each part of RHS derive lambda ? */</span></div><div class="line">                rhs_derives_lambda = derives_lambda[<span class="built_in">string</span>(p.RHS[<span class="number">0</span>])];</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">size_t</span> j = <span class="number">1</span>; j &lt; p.RHS.size(); j++) &#123;</div><div class="line">                    rhs_derives_lambda &amp;= derives_lambda[p.RHS[j]];</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>(rhs_derives_lambda) &#123;</div><div class="line">                    changes = <span class="literal">true</span>;</div><div class="line">                    derives_lambda[p.LHS] = <span class="literal">true</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">while</span>(changes);</div><div class="line">    <span class="keyword">return</span> derives_lambda;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Grammar::fill_first_set() &#123;</div><div class="line">    </div><div class="line">    <span class="built_in">string</span> 		A; <span class="comment">// nonterminal</span></div><div class="line">    <span class="built_in">string</span> 		a; <span class="comment">// terminal</span></div><div class="line">    Production 	p;</div><div class="line">    <span class="keyword">bool</span> 		changes;</div><div class="line">        </div><div class="line">    mark_lambda();</div><div class="line">    first_set.clear();</div><div class="line">    </div><div class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</div><div class="line">        A = rules[i].LHS;</div><div class="line">        <span class="keyword">if</span>(derives_lambda[A])</div><div class="line">            first_set[A].insert(Grammar::lambda);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> j = <span class="number">0</span>; j &lt; rules[i].RHS.size(); j++) &#123;</div><div class="line">            a = rules[i].RHS[j];</div><div class="line">            <span class="keyword">if</span>(!isNonterminal(a)) &#123;</div><div class="line">                <span class="keyword">if</span>(a != Grammar::lambda)</div><div class="line">                    first_set[a].insert(a);</div><div class="line">                <span class="keyword">if</span>(j == <span class="number">0</span>) &#123; <span class="comment">// A -&gt; aXX</span></div><div class="line">                    first_set[rules[i].LHS].insert(a);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">do</span> &#123;</div><div class="line">        changes = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</div><div class="line">            p = rules[i];</div><div class="line">            <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; rfirst = compute_first(p.RHS);</div><div class="line">            <span class="keyword">size_t</span> oldsize = first_set[p.LHS].size();</div><div class="line">            first_set[p.LHS].insert(rfirst.begin(), rfirst.end());</div><div class="line">            <span class="keyword">size_t</span> newsize = first_set[p.LHS].size();</div><div class="line">            <span class="keyword">if</span>(oldsize != newsize)</div><div class="line">                changes = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">while</span>(changes);</div><div class="line">&#125; </div><div class="line"></div><div class="line"><span class="keyword">void</span> Grammar::fill_follow_set() &#123;</div><div class="line">    <span class="built_in">string</span> 	A, B; <span class="comment">// nonterminal</span></div><div class="line">    Production 	p;</div><div class="line">    <span class="keyword">bool</span> 	changes;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</div><div class="line">        A = rules[i].LHS;</div><div class="line">        follow_set[A].clear();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    follow_set[start_symbol].insert(Grammar::lambda);</div><div class="line">        </div><div class="line">    <span class="keyword">do</span> &#123;</div><div class="line">        changes = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; rules.size(); i++) &#123;</div><div class="line">            <span class="comment">/* A -&gt; a B b</span></div><div class="line"><span class="comment">			 * I.e. for each production and each occurrence</span></div><div class="line"><span class="comment">			 * of a nonterminal in its right-hand side. </span></div><div class="line"><span class="comment">			 */</span></div><div class="line">            p = rules[i];</div><div class="line">            A = p.LHS;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">size_t</span> j = <span class="number">0</span>; j &lt; p.RHS.size(); j++) &#123;</div><div class="line">                B = p.RHS[j];</div><div class="line">                <span class="keyword">if</span>(isNonterminal(B)) &#123;</div><div class="line">                    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; beta(p.RHS.begin() + j + <span class="number">1</span>, p.RHS.end());</div><div class="line">                    <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; rfirst = compute_first(beta);</div><div class="line">                    <span class="keyword">size_t</span> oldsize = follow_set[B].size();</div><div class="line">                    </div><div class="line">                    <span class="keyword">if</span>(rfirst.find(Grammar::lambda) == rfirst.end()) &#123;</div><div class="line">                        follow_set[B].insert(rfirst.begin(), rfirst.end());	</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        rfirst.erase(Grammar::lambda);</div><div class="line">                        follow_set[B].insert(rfirst.begin(), rfirst.end());	</div><div class="line">                        rfirst = follow_set[A];</div><div class="line">                        follow_set[B].insert(rfirst.begin(), rfirst.end());</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">size_t</span> newsize = follow_set[B].size();			</div><div class="line">                    <span class="keyword">if</span>(oldsize != newsize)</div><div class="line">                        changes = <span class="literal">true</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">while</span>(changes);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Grammar::lldriver(<span class="built_in">queue</span>&lt;<span class="built_in">string</span>&gt; tokens) &#123;</div><div class="line">    <span class="built_in">stack</span>&lt;<span class="built_in">string</span>&gt; 	stk;</div><div class="line">    <span class="built_in">string</span> 			X;</div><div class="line">    <span class="built_in">string</span>			a;</div><div class="line">    Production		p;</div><div class="line">    <span class="comment">/* Push the Start Symbol onto an empty stack */</span></div><div class="line">    stk.push(start_symbol);</div><div class="line">    </div><div class="line">    <span class="keyword">while</span>(!stk.empty() &amp;&amp; !tokens.empty()) &#123;</div><div class="line">        X = stk.top();</div><div class="line">        a = tokens.front();</div><div class="line">        <span class="comment">// cout &lt;&lt; X &lt;&lt; " " &lt;&lt; a &lt;&lt; endl;</span></div><div class="line">        <span class="keyword">if</span>(isNonterminal(X) &amp;&amp; lltable[X].find(a) != lltable[X].end()) &#123;</div><div class="line">            p = lltable[X][a];</div><div class="line">            stk.pop();</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = p.RHS.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">                <span class="keyword">if</span>(p.RHS[i] == Grammar::lambda)</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                stk.push(p.RHS[i]);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(X == a) &#123;</div><div class="line">            stk.pop();</div><div class="line">            tokens.pop();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(lltable[X].find(Grammar::lambda) != lltable[X].end()) &#123;</div><div class="line">            stk.pop();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">/* Process syntax error. */</span></div><div class="line">            <span class="built_in">puts</span>(<span class="string">"Bad!"</span>);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">while</span>(!stk.empty()) &#123;</div><div class="line">        X = stk.top();</div><div class="line">        <span class="keyword">if</span>(lltable[X].find(Grammar::lambda) != lltable[X].end())</div><div class="line">            stk.pop();</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(tokens.size() == <span class="number">0</span> &amp;&amp; stk.size() == <span class="number">0</span>)</div><div class="line">        <span class="built_in">puts</span>(<span class="string">"Good"</span>);</div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="built_in">puts</span>(<span class="string">"Bad!"</span>);</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">aVowel</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</div><div class="line">    <span class="keyword">switch</span>(c) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'a'</span>:<span class="keyword">case</span> <span class="string">'e'</span>:<span class="keyword">case</span> <span class="string">'i'</span>:<span class="keyword">case</span> <span class="string">'o'</span>:<span class="keyword">case</span> <span class="string">'u'</span>:</div><div class="line">            <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="built_in">string</span> <span class="title">token2symbol</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span> &amp;str)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n = str.length();</div><div class="line">    <span class="keyword">if</span> (!<span class="built_in">islower</span>(str[n - <span class="number">1</span>]) || !aVowel(str[n - <span class="number">1</span>])) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"NAM"</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">switch</span> (n) &#123;</div><div class="line">    	<span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">return</span> <span class="string">"A"</span>;</div><div class="line">    	<span class="keyword">case</span> <span class="number">5</span>:</div><div class="line">        n = aVowel(str[<span class="number">4</span>]);</div><div class="line">        n |= ((aVowel(str[<span class="number">0</span>]) &lt;&lt; <span class="number">4</span>) | (aVowel(str[<span class="number">1</span>]) &lt;&lt; <span class="number">3</span>));</div><div class="line">        n |= ((aVowel(str[<span class="number">2</span>]) &lt;&lt; <span class="number">2</span>) | (aVowel(str[<span class="number">3</span>]) &lt;&lt; <span class="number">1</span>));</div><div class="line">        <span class="keyword">return</span> (n == <span class="number">5</span> || n == <span class="number">9</span>) ? <span class="string">"PREDA"</span> : <span class="string">"UN"</span>;</div><div class="line">    	<span class="keyword">case</span> <span class="number">2</span>:</div><div class="line">        	<span class="keyword">switch</span> (str[<span class="number">0</span>]) &#123;</div><div class="line">        		<span class="keyword">case</span> <span class="string">'g'</span>: <span class="keyword">return</span> <span class="string">"MOD"</span>;</div><div class="line">        		<span class="keyword">case</span> <span class="string">'b'</span>: <span class="keyword">return</span> <span class="string">"BA"</span>;</div><div class="line">        		<span class="keyword">case</span> <span class="string">'d'</span>: <span class="keyword">return</span> <span class="string">"DA"</span>;</div><div class="line">        		<span class="keyword">case</span> <span class="string">'l'</span>: <span class="keyword">return</span> <span class="string">"LA"</span>;</div><div class="line">        	&#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="string">"UN"</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">parsingProduction</span><span class="params">(<span class="built_in">string</span> r, Grammar &amp;g)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> 		production_label = <span class="number">0</span>;</div><div class="line">    <span class="function"><span class="built_in">stringstream</span> 	<span class="title">sin</span><span class="params">(r)</span></span>;</div><div class="line">    <span class="built_in">string</span> 			lhs, foo;</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; 	tokens;</div><div class="line">    <span class="built_in">sin</span> &gt;&gt; lhs &gt;&gt; foo;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">sin</span> &gt;&gt; foo)</div><div class="line">        tokens.push_back(foo);</div><div class="line">    <span class="function">Production <span class="title">p</span><span class="params">(lhs, tokens)</span></span>;</div><div class="line">    p.label = ++production_label;</div><div class="line">    g.rules.push_back(p);</div><div class="line">&#125; </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    Grammar g;</div><div class="line">    parsingProduction(<span class="string">"&lt;sentence&gt;    -&gt;  &lt;common_pre&gt;"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;sentence&gt;    -&gt;  DA &lt;preds&gt;"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;common_pre&gt;  -&gt;  &lt;predname&gt; &lt;suffix&gt;"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;suffix&gt;      -&gt;  &lt;predclaim&gt;"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;suffix&gt;	  	 -&gt;  &lt;statement&gt;"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;predclaim&gt;   -&gt;  BA &lt;preds&gt;"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;predclaim&gt;   -&gt;  DA &lt;preds&gt;"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;preds&gt;       -&gt;  &lt;preds_head&gt; &lt;preds_tail&gt;"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;preds_head&gt;  -&gt;  &lt;predstring&gt;"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;preds_tail&gt;  -&gt;  A &lt;predstring&gt; &lt;preds_tail&gt;"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;preds_tail&gt;  -&gt;  l"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;predname&gt;    -&gt;  LA &lt;predstring&gt;"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;predname&gt;    -&gt;  NAM"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;predstring&gt;  -&gt;  PREDA &lt;predstr_tail&gt;"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;predstr_tail&gt; -&gt; PREDA &lt;predstr_tail&gt;"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;predstr_tail&gt; -&gt; l"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;statement&gt;   -&gt;  &lt;verbpred&gt; &lt;statement_s&gt;"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;statement_s&gt; -&gt;  &lt;predname&gt;"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;statement_s&gt; -&gt;  l"</span>, g);</div><div class="line">    parsingProduction(<span class="string">"&lt;verbpred&gt;    -&gt;  MOD &lt;predstring&gt;"</span>, g);</div><div class="line">    </div><div class="line">    g.start_symbol = <span class="string">"&lt;sentence&gt;"</span>;</div><div class="line">        </div><div class="line">    g.fill_first_set();</div><div class="line">    g.fill_follow_set();</div><div class="line">    g.fill_lltable();</div><div class="line">    </div><div class="line">    <span class="built_in">queue</span>&lt;<span class="built_in">string</span>&gt; SYMBOL;</div><div class="line">    <span class="keyword">for</span>(<span class="built_in">string</span> token; <span class="built_in">cin</span> &gt;&gt; token &amp;&amp; token != <span class="string">"#"</span>;) &#123;</div><div class="line">        <span class="keyword">size_t</span> pos = token.find(<span class="string">'.'</span>);</div><div class="line">        <span class="keyword">if</span>(pos == <span class="built_in">string</span>::npos) &#123;</div><div class="line">            SYMBOL.push(token2symbol(token));</div><div class="line">            <span class="comment">//cout &lt;&lt; token2symbol(token) &lt;&lt; " ";</span></div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        token.erase(token.length() - <span class="number">1</span>);</div><div class="line">        <span class="comment">//cout &lt;&lt; token2symbol(token) &lt;&lt; endl;</span></div><div class="line">        <span class="keyword">if</span>(token.length() &gt; <span class="number">0</span>)</div><div class="line">            SYMBOL.push(token2symbol(token));</div><div class="line">        g.lldriver(SYMBOL);</div><div class="line">        </div><div class="line">        <span class="keyword">while</span>(!SYMBOL.empty())</div><div class="line">            SYMBOL.pop();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-note/hardware-interview" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/22/note/hardware-interview/" class="article-date">
  <time datetime="2014-05-22T00:26:37.000Z" itemprop="datePublished">2014-05-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/雜言筆記/">雜言筆記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/img/1400100597593.jpg" rel="gallery_ckvd6e90u02fw9cvnea54334u">
        <img src="/img/1400100597593.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/22/note/hardware-interview/">大神面試紀錄 Hardware Interview</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/22/note/hardware-interview/" data-id="ckvd6e90u02fw9cvnea54334u" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/22/note/hardware-interview/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/硬體/">硬體</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/面試/">面試</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="序"><a href="#序" class="headerlink" title="序"></a>序</h1><p>本篇文章記錄身邊大神去面試時所遇到的神祕問題，對於現在大三的我只能旁觀，雖然在計算機組織這一類的硬體課程修完不久，但是看到這些問題，還真的不知所措。</p>
<p>面試的時候，可以帶上會協助您的小夥伴們一起面試，這一點相當地奇特，面試不再是單打獨鬥。當然，小夥伴有事也沒有關係，將可以使用線上 call out。</p>
<p>也是這些原因，才有機會參與這些問題的討論。</p>
<h1 id="面試題目"><a href="#面試題目" class="headerlink" title="面試題目"></a>面試題目</h1><blockquote>
<p>以下附錄僅為討論，不代表正確答案。</p>
</blockquote>
<p>面試採用漸進式，由高階至低階開始追問，同時也會問到 <code>Hardware Algorithm</code>。</p>
<ul>
<li><p>用 <code>C/C++</code> 寫一個九九乘法表</p>
<p>  這邊就不多加以描述，通常採用兩層迴圈的寫法和一個 <code>printf</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">9</span>; i++)</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= <span class="number">9</span>; j++)</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d x %d = %d\n"</span>, i, j, i * j);</div></pre></td></tr></table></figure></li>
<li><p><code>printf(format, arg)</code> 怎麼實作的？</p>
<p>  請準備 <code>stdio.h</code> 開始查閱，不過當下要想出來還真的挺難的，不過在 linux 下，stdin, stderr, stdout 都是一個檔案形式，這是在呼叫 <code>printf</code>後會去導入的目標所在。但如何解決 <code>arg</code>，要查閱一下 <code>va_start</code> 怎麼運作的，若上網搜尋得到。</p>
<figure class="highlight cpp"><figcaption><span>printf</span><a href="https://sourceware.org/git/?p=glibc.git;a=blob;f=stdio-common/printf.c;h=9bf28949cb0f9968dead004e7d6aea38513d6db6;hb=HEAD" target="_blank" rel="external">link</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;libioP.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdarg.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">undef</span> printf</span></div><div class="line"></div><div class="line"><span class="comment">/* Write formatted output to stdout from the format string FORMAT.  */</span></div><div class="line"><span class="comment">/* VARARGS1 */</span></div><div class="line"><span class="keyword">int</span></div><div class="line">__printf (<span class="keyword">const</span> <span class="keyword">char</span> *format, ...)</div><div class="line">&#123;</div><div class="line">  va_list arg;</div><div class="line">  <span class="keyword">int</span> done;</div><div class="line"></div><div class="line">  va_start (arg, format);</div><div class="line">  done = <span class="built_in">vfprintf</span> (<span class="built_in">stdout</span>, format, arg);</div><div class="line">  va_end (arg);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> done;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">undef</span> _IO_printf</span></div><div class="line">ldbl_strong_alias (__printf, <span class="built_in">printf</span>);</div><div class="line"><span class="comment">/* This is for libg++.  */</span></div><div class="line">ldbl_strong_alias (__printf, _IO_printf);</div></pre></td></tr></table></figure>
<p>  多變數到底是如何在這裡實作的，這一點要去考量 <code>va_start</code>，他會將參數位置丟入 <code>va_list arg</code> 中，但是如果參數個數或者是型態不符合 format，則運行的時候指針會指到錯誤的地方而噴出 RE，嘗試所及就到這裡了。</p>
</li>
<li><p>CPU 怎麼實作這些？</p>
<p>  CPU 的 pipeline 的五個階段和實作，IF, ID, EX, MEM, WB<br>  擷取指令、指定解析、執行運算、寫入記憶體、寫回暫存器。<br>  然後如何 pipeline，如果有類型的不同的時候，pipeline 會猜測到底要不要 branch，如果真的要 branch，要將 branch 之後的指令清掉 … 計組忘得一乾二淨。</p>
</li>
</ul>
<hr>
<ul>
<li><p>實作一個 n bits 加法器 adder，在平行的情況下，最多能多快。</p>
<p>  一般而言，要在 n 個 clock 後才能得到，這麼做就太慢了，之前上課有提到 carry lookahead adder, carry saved adder, … 等，這些雖然能在比一般時間更快得到是否要進位，但問題是要怎麼知道加完之後的結果！</p>
<p>  所以通常是切塊，然後賭前一塊到底會不會進位過來，把兩個答案都先算出，最後再利用 selector 去選擇正確的那個結果。</p>
<p>  如果單純是要得到是否會 overflow，最快可以在 <code>O(log n)</code> 時間內得到，採用分治的方式去考慮進位問題。</p>
<p>  分治算法看起來很接近線段樹的做法，藉由上一步，把兩種可能的答案都先算出，我們已經在 <code>O(log n)</code> 時間內把線段樹建出，接著對每一個元素做前綴的區間查詢，全部并行可以在 <code>O(log n)</code> 時間內完成，然後調用 selector 決定我們的答案。</p>
<blockquote>
<p>太多平行，平行處理的效能分析和處理資料的優先順序，很少在 ACM 使用，只好在此刻 yy 了。</p>
</blockquote>
</li>
<li><p>給很多區間 <code>[l, r]</code>，接著詢問某個點 <code>x</code> 被多少區間覆蓋。</p>
<p>  線段樹處理，搭配區間的懶操作，直接對區間 <code>[l, r]</code> 所有元素 + 1 即可，在 <code>O(n log n)</code> 時間內建表，然後單點查詢 <code>A[x]</code> 的值為何，這種做法可以動態支持。</p>
</li>
<li><p>給一般圖進行匹配，假設不使用標準的帶花樹算法，使用自己的算法，請問誤差為多少。</p>
<p>  貪婪策略：<br>  每次對一個鄰居最少的點，找到其鄰居 (他的鄰居也最少) 進行匹配，然後把這些點都拿掉，繼續遞迴匹配。</p>
<p>  至於誤差－只能想辦法找到一個反例，來確定誤差一定大於某個值，要詳細證明什麼的，大概可以順便報一篇論文了。</p>
<p>  <img src="/img/snakeooxx.png" alt="天祥反例"></p>
<p>  一群人在思考反例，想了很久都沒有結果，最後由天祥大神找到一個誤差有 <code>20%</code> 的反例，詳細如上圖所述，如果一開始拿到 AD 或者是 HI，則會把匹配數最多拿到 4 個，事實上為 5 個。</p>
</li>
</ul>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>相當可怕，學得都忘得一乾二淨，無法精準回答。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/icpc-4020" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/22/oj/uva/icpc-4020/" class="article-date">
  <time datetime="2014-05-22T00:14:25.000Z" itemprop="datePublished">2014-05-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/22/oj/uva/icpc-4020/">ICPC 4020 - Hard Rode</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/22/oj/uva/icpc-4020/" data-id="ckvd6e99002qp9cvn719pnryx" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/22/oj/uva/icpc-4020/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/窮舉/">窮舉</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>The road to Shu is hard, even harder than climbing to the blue sky. A poem by Li Po from Tang Dynasty 1,200 years ago described the difficulty in travelling into Sichuan.</p>
<p>\epsfbox{p4020.eps}</p>
<p>However the above old saying is no longer true as a convenient communication network of railway, highway, waterway and air transport has come into being. Railways cover a total mileage of 2,693 km, consisting of five trunk lines including the BaojiChengdu and Chengdu-Chongqing railways, eight feeder lines and four local railways. The total mileage of highways stretches to nearly 80,000 km, ranking at the forefront in China. Now a highway network with the provincial capital of Chengdu as the center radiating to all cities in the province has been formed. A total of 500 km of expressways have been built. It is very easy to transfer passengers and freights between Sichuan and other provinces. After a nationwide railway speed acceleration launched in last year, trains can be allowed to run at a speed above 120 km per hour. However, the average speed of a train depends on its make-up. There is only single railway track between stations from Baoji to Chengdu, A primary task for dispatchers is to arrange for trains to meet and pass each other. You are requested to write a program to make the arrangement for a series of trains of different speeds from one station to its next station in the least amount of time.</p>
<p>What you should pay attention to while writing this program is that since there is a single railway track from Baoji to Chengdu, two trains are not allowed to pass the same spot at the same time, or they would be collision, and that because of the limited staff, there should be a fixed interval time between two trains out of the station, what’s more, the trains could pull into the station at the same time, but never get out at the same time.</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The input consists of several test cases. Each test case begins with a line containing 3 integers L (1 &lt;= L &lt;= 100000) , N (1 &lt;= N &lt;= 8) and T (1 &lt; T &lt; 10000) which indicate the distance between two stations (unit is meter), the number of trains, as well as the interval time of adjacent trains when trains leave the start (unit is second).</p>
<p>The next N lines contain average speeds of N trains (unit is m/s).</p>
<p>A single line with L = 0 indicates the end of input file and should not be processed by your program.</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For each test case, your output should be in one line with the minimum time(round to integer) needed by the trains pulling into the terminal as indicated in the sample output.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">100000 6 300 </div><div class="line">3 </div><div class="line">4 </div><div class="line">5 </div><div class="line">6 </div><div class="line">2 </div><div class="line">1 </div><div class="line">0</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Case 1: 101500</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p><strong> 題目描述：</strong></p>
<p>從 陝西省寶雞市 到 四川省成都市 有一條鐵軌，而這一條鐵軌一次有好幾台火車在運行，但是不會發生追撞事件，然而每台火車的速度不一樣，而且站務人員會每隔固定時間發一班車，在不發生碰撞的情況下，最後一台火車到達成都市的最少時間為何？</p>
<p><strong> 題目解法：</strong></p>
<p>在這樣的情況，有可能慢車先出發，然在在 <code>T</code> 秒之後，快車恰好追到慢車，這樣的情況會更好。但是實際數據應該長成什麼樣子沒有仔細考慮。</p>
<p>如果使用慢車最後出發，這樣能確保一定不會產生碰撞，但不確定是否是最佳解。</p>
<p>所以使用 <code>O(n!)</code> 的窮舉來計算答案。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> L, N, T, cases = <span class="number">0</span>;</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> speed[<span class="number">10</span>];</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;L, &amp;N, &amp;T) == <span class="number">3</span> &amp;&amp; L) &#123;</div><div class="line">        <span class="keyword">int</span> p[<span class="number">10</span>] = &#123;&#125;;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%lld"</span>, &amp;speed[i]);</div><div class="line">            p[i] = i;</div><div class="line">        &#125;</div><div class="line">        sort(speed, speed + N);</div><div class="line">        <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">0x3f3f3f3f</span>;</div><div class="line">        <span class="keyword">do</span> &#123;</div><div class="line">            <span class="keyword">double</span> start = T, lastTime = L / speed[p[<span class="number">0</span>]];</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</div><div class="line">                <span class="keyword">double</span> time = L / speed[p[i]] + start;</div><div class="line">                <span class="keyword">if</span>(time &gt;= lastTime) &#123;</div><div class="line">                    start += T;</div><div class="line">                    lastTime = time;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    lastTime = <span class="number">0x3f3f3f3f</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                    <span class="comment">// start += T + (lastTime - time);</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            ret = min(ret, (<span class="keyword">long</span> <span class="keyword">long</span>) <span class="built_in">ceil</span>(lastTime));</div><div class="line">        &#125; <span class="keyword">while</span> (next_permutation(p, p + N));</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case %d: %lld\n"</span>, ++cases, ret);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-10320" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/21/oj/uva/uva-10320/" class="article-date">
  <time datetime="2014-05-20T23:33:18.000Z" itemprop="datePublished">2014-05-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/21/oj/uva/uva-10320/">UVa 10320 - Cow Trouble! Help Please</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/21/oj/uva/uva-10320/" data-id="ckvd6e9an02sh9cvnztt2ug37" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/21/oj/uva/uva-10320/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/幾何/">幾何</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>There are many classic problem with cows/goats and grass field in the world of mathematics. One of such problems is shown in the picture (left one) below. A goat is tied at point C which is on the edge of a round field with a rope of length R. One has to determine the length R when the cow can eat 50% grass of the round field. But in this problem we will consider a slightly different scenario which is shown in the second figure. In a field of infinite area there is a house ABDC. A cow is tied with pillar B of the house with a rope of length R. The length and width of the house is l and w. If the house was not there the cow could eat all the grass in the round green field (The round green field is a circle of radius R). But the presence of the house will certainly reduce his ability as the cow cannot enter the house nor can any part of the rope. You will have to determine the area the cow can now roam around and eat grass.</p>
<p>Fig 1: A classic Problem with a Goat</p>
<p>Fig 2: The Current Classic Problem with Cow</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The input file contains several lines of input. Each line contains three floating point numbers l, w and R as described in the problem statement. All numbers are less than 10000. Input is terminated by end of file.</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For each line of input produce one line of output. This output denotes the area that the cow can cover by not entering the house. This value should contain ten digits after the decimal point. Output will be checked with special judge. So you should not worry about very small precision errors.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">10 5 5</div><div class="line">10 4 8</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">58.9048622548</div><div class="line">163.3628179867</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p><strong> 題目描述：</strong><br>有一頭牛被一根長度 R 的繩子拴在一棟建築物 ABCD 的 B 點上，草地的範圍為無限大，求牛可以吃到的草的範圍。Input 會給l, w 和 R 表示建築物長寬和繩長；l, w, R &lt; 10000。Output 要輸到小數點第 10 位。</p>
<p><strong> 題目解法：</strong></p>
<p>就是根據 R 的四種情況去討論，其中最麻煩的是對於 <code>R &gt; l + w</code>，這種情況會需要討論重疊的區域，算出三角形夾角然後分別算兩個扇形面積，再弄回重疊區域三角形中的哪一塊有草。</p>
<p>其實這一題的題解網路上是有的，但是 PO 出來是因為自己卡在 WA，原因是這樣子的，假使 <code>A = 0.5 * B</code> 和 <code>A = B / 2</code>，這兩者寫法並無不同，但是後者的精準度比較好，很多次的 WA 都掛在這一點。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">double</span> w, l, r;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">double</span> pi = <span class="built_in">acos</span>(<span class="number">-1</span>);</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%lf %lf %lf"</span>, &amp;l, &amp;w, &amp;r) == <span class="number">3</span>) &#123;</div><div class="line">        <span class="keyword">if</span>(w &gt; l)</div><div class="line">            swap(w, l);</div><div class="line">        <span class="keyword">double</span> area;</div><div class="line">        <span class="keyword">if</span>(r &lt;= w)</div><div class="line">            area = r * r * pi * <span class="number">3</span> / <span class="number">4.0</span>;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(r &lt;= l)</div><div class="line">            area = r * r * pi * <span class="number">3</span> / <span class="number">4.0</span> + (r - w) * (r - w) * pi / <span class="number">4.0</span>;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(r &lt;= l + w)</div><div class="line">            area = r * r * pi * <span class="number">3</span> / <span class="number">4.0</span> + (r - w) * (r - w) * pi / <span class="number">4.0</span> </div><div class="line">                    + (r - l) * (r - l) * pi / <span class="number">4.0</span>;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">double</span> a = <span class="built_in">atan2</span>(l, w), b, c;</div><div class="line">            <span class="keyword">double</span> la, lb, lc;</div><div class="line">            </div><div class="line">            la = hypot(w, l);</div><div class="line">            lb = r - w;</div><div class="line">            lc = r - l;</div><div class="line">            b = <span class="built_in">acos</span>((la*la + lb*lb - lc*lc)/(<span class="number">2</span>*la*lb)) + a;</div><div class="line">            c = <span class="built_in">acos</span>((la*la + lc*lc - lb*lb)/(<span class="number">2</span>*la*lc)) + (pi /<span class="number">2</span>) - a;</div><div class="line">                        </div><div class="line">            area = r * r * pi * <span class="number">3</span> / <span class="number">4.0</span>;</div><div class="line">            area += (r - w) * (r - w) * (pi - b) / <span class="number">2</span>;</div><div class="line">            area += (r - l) * (r - l) * (pi - c) / <span class="number">2</span>;</div><div class="line">            area += lb * la * <span class="built_in">sin</span>(b - a) / <span class="number">2</span>;</div><div class="line">            area -= w * l / <span class="number">2</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%0.10lf\n"</span>, area);			</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/hw-computational-intelligence" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/19/lesson/hw-computational-intelligence/" class="article-date">
  <time datetime="2014-05-19T11:47:28.000Z" itemprop="datePublished">2014-05-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/19/lesson/hw-computational-intelligence/">計算型智慧 程式作業</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/19/lesson/hw-computational-intelligence/" data-id="ckvd6e8z702dn9cvnh3fd2twc" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/19/lesson/hw-computational-intelligence/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Fuzzy-System/">Fuzzy System</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GA/">GA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PSO/">PSO</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="Computational-Intelligence-計算型智慧"><a href="#Computational-Intelligence-計算型智慧" class="headerlink" title="Computational Intelligence 計算型智慧"></a>Computational Intelligence 計算型智慧</h1><p>本課程將會有三階段程式，將三個算法依序加入程式中，為了要實作這些算法，必須先作出模擬器。</p>
<h2 id="Lv-0-模擬器"><a href="#Lv-0-模擬器" class="headerlink" title="Lv. 0 模擬器"></a>Lv. 0 模擬器</h2><p>在一個 2D 平面中，以一個圓形當作車子，道路為線段的方式進行描述。為了在隨後的擴充，將地圖內容物分成可行區域多邊形和障礙物多邊形。</p>
<ul>
<li>要支持車子下一秒的擺角，並且按下推動鍵會根據方程式進行移動。</li>
<li>可以將車子兩側的感測器進行角度調整，並且可以根據感測器角度進行距離計算。</li>
<li>並且在呈現 2D 平面時，附加顯示座標軸的比例。</li>
</ul>
<p><img src="/img/hw-ci-0.PNG" alt="完成圖"></p>
<p>由於私心，有一些額外產物。</p>
<ul>
<li>完成可以自動置中的設定</li>
<li>提供地圖縮放和讀取操作</li>
<li>製作地圖產生器 (other project)</li>
<li>模擬器的彈木遊戲番外篇 (other project)</li>
<li>提供運行欄位的縮起</li>
</ul>
<h2 id="Lv-1-模糊系統"><a href="#Lv-1-模糊系統" class="headerlink" title="Lv. 1 模糊系統"></a>Lv. 1 模糊系統</h2><p>車子運行公式</p>
<p><img src="/img/hw-ci-1.PNG" alt="運行公式"></p>
<p>其中 Φ(t) 是模型車與水平軸的角度，b 是模型車的長度，x 與 y 是模型車的座標位置， Θ(t) 是模型車方向盤所打的角度，我們對模擬的輸入輸出變數限制如下：</p>
<p><code>-40 deg &lt;= Θ(t) &lt;= 40 deg</code></p>
<p>寫一個程式使用模糊系統、理論模擬車子行徑，並且想辦法最佳化。</p>
<ul>
<li>考慮擴充性，以後車子的運行公式可能會替換，因此建造一個 <code>Engine class</code>。</li>
<li>模糊系統的幾個特性拆分成數個 method，並且使用不同的數學計算採用繼承關係。</li>
<li>最困難得地方在於計算函數交集，採用離散取點是最後的手段</li>
</ul>
<h3 id="函數實驗"><a href="#函數實驗" class="headerlink" title="函數實驗"></a>函數實驗</h3><ol>
<li>經過實驗，三個感測器分別坐落於前方 (90度)、左右各偏轉 50 度左右的夾角比左右 90 度更好。用以應付多變的轉角彎度，防止模稜兩可的擺動。</li>
<li>不管哪裡種去模糊化系統，由於題目限制擺角於 [-40, 40] 度之間，因此很容易在加權平均、質心、離散化而導致邊界擺角的機率甚低，當越多函數則稀釋程度越高。因此函數定義可以超過限制擺角，只需要在去模糊化時，約束至條件內即可。</li>
<li>設計函數時，要討論向其中一個方向偏轉，也就是不能設計過於對稱的圖形，否則將會在死胡同裡打轉。</li>
</ol>
<h3 id="函數設計"><a href="#函數設計" class="headerlink" title="函數設計"></a>函數設計</h3><p>d1 為前方感測器，d2 為右方感測器，d3 為左方感測器。</p>
<ol>
<li>d1 歸屬函數為<br><img src="/img/hw-ci-2.PNG" alt="d1 歸屬函數"><br>d2, d3 歸屬函數為<br><img src="/img/hw-ci-3.PNG" alt="d2, d3 歸屬函數">    </li>
<li>函數式加權平均<pre><code>If d3 large, θ = 55
If d2 large, θ = -55
If d2 medium, θ = -40
If d3 medium, θ = 40
If d1 large and d2 small, θ = -30
If d1 large and d3 small, θ = 30
If d1 small, θ = -60
</code></pre>規則如上述七條，以最簡單的常數關係。測試結果還算不錯。<br><code>if condition, then statement</code>，statement 中的變數不存在於 condition 去做調整，後來發現由於太複雜去討論而一直失敗。</li>
<li><p>重心法、最大平均法、修正型最大平均法、中心平均法<br>為了方便計算連續函數，採用離散取點，間隔 0.1 抓取 [-60, 60] 之間的點座標。對於以下四種方法討論於簡單彎道的過程記錄：<br><code>If d3 large</code><br><img src="/img/hw-ci-4.png" alt="If d3 large"><br>If d2 large<br><img src="/img/hw-ci-5.png" alt="If d2 large"><br>If d2 medium<br><img src="/img/hw-ci-6.png" alt="If d2 medium"><br>If d3 medium<br><img src="/img/hw-ci-7.png" alt="If d3 medium"><br>If d1 large and d2 small<br><img src="/img/hw-ci-8.png" alt="If d1 large and d2 small"><br>If d1 large and d3 small<br><img src="/img/hw-ci-9.png" alt="If d1 large and d3 small"><br>If d1 small, θ = -60<br><img src="/img/hw-ci-10.png" alt="If d1 small"></p>
<ul>
<li>重心法<br>當中表現最為穩健，而且路徑平滑。</li>
<li>最大平均法<br>由於定義的函數較為簡單，而且大多都是以梯形的方式存在，雖然能在機率高的情況下走完全程，路徑中會呈現左右擺盪情況。並且大多都已極值的方式出現。</li>
<li>修正型最大平均法<br>情況會稍微好一些，但是對於並沒有向重心法一樣的圓滑曲線，仍是因為原先的函數設計所惹的問題。</li>
</ul>
<p>對於某一種方法而去定義相關的函數進行測較好，而在最大平均法的部分，必須使用較具有變化性的曲線，否則很容易在極值狀況下擺動。</p>
</li>
</ol>
<hr>
<h2 id="Lv-2-GA"><a href="#Lv-2-GA" class="headerlink" title="Lv 2. GA"></a>Lv 2. GA</h2><p><img src="/img/hw-ci-RBF.PNG" alt="RBF"></p>
<p>「放射狀基底函數網路 RBF」，基本上，其網路架構如圖1所示，為兩層的網路；假設輸入維度是p ，以及隱藏層類神經元的數目是J ，那麼網路的輸入可以表示成：<br><img src="/img/hw-ci-RBF-f1.PNG" alt=""><br>其中選用高斯型基底函數：<br><img src="/img/hw-ci-RBF-f2.PNG" alt=""><br>其中 x = (x1,x2,…,xp) 、mj = (mj1,mj2,…,mjp) 、||  || 代表向量絕對值<br>適應函數為：<br><img src="/img/hw-ci-RBF-f3.PNG" alt=""></p>
<p>請用實數型基因演算法，找出wj , mj , σj，在不同的數字J下，最好的基因向量 (例如J為9、輸入x為3維向量，則表示基因向量是1+9+3x9+9=46維度的向量，請注意這裡不是指族群數；又例如J為7、輸入x為3維向量，則表示基因向量是1+7+3x7+7=36維度的向量)下，評估函數E(式1)為越小越好。其中基因向量維度公式為 1+J + p<em>J+J = (p+2)</em>J+1維向量( ,w1 , w2 ,.., wJ , m11, m12,.., m1p, m21, m22,.., m2p,.., mJ1, mJ2,…, mJp, σ1, σ2, …, σJ)。</p>
<p>參數說明 : </p>
<ul>
<li>N 作業1產生的N筆成功到達目的訓練資料(換不同起始點)</li>
<li>y<sub>n</sub> 表示訓練資料的方向盤期望輸出值 P.s.如果配合wj值的範圍為0~1之間，在此則必須把yn由-40~+40度正規化到 0~1之間；如果不想正規化  就必須把 wj的值範圍調整到 -40~40之間 範圍為0~1之間</li>
<li>W<sub>j</sub> 範圍為 0~1 (或是-40~40)之間 P.s.此需配合訓練集的yn跟F(n)值範圍，所以皆需正規化到0~1之間；若不正規化，wj的值範圍為 -40~40之間</li>
<li>m<sub>j</sub> 範圍跟X範圍一樣，如以提供的範例檔則為 0~30</li>
<li>σ<sub>j</sub> 範圍為0~10之間；也可以設定更大的範圍做探討。</li>
</ul>
<blockquote>
<p><strong> 實作概要 </strong>：<br>把參數編碼成 DNA，使用 GA 算法改變 DNA，然後用之前的模糊系統的結果，讓 RBF 接近之前定義的模糊系統。需要拿模糊系統的一些測資當作訓練資料，收集之後餵給 GA 做訓練。</p>
</blockquote>
<h3 id="實驗方法"><a href="#實驗方法" class="headerlink" title="實驗方法"></a>實驗方法</h3><ol>
<li>核心代碼，對於每次迭代，著手適應、選擇、交配、突變。</li>
<li>細部 “交配” 代碼，採用實數型的分離和聚集兩種情況。</li>
<li>細部 “突變” 代碼，採用微量雜訊，唯一不同的地方在於，這個微量雜訊會根據當前數值的比例有關，為了避免大數字對於微量雜訊的干擾不夠強烈。</li>
</ol>
<h3 id="實驗結果"><a href="#實驗結果" class="headerlink" title="實驗結果"></a>實驗結果</h3><ol>
<li>運行結果 J = 3, p = 3<br>( ,w1 , w2 ,.., wJ , m11, m12,.., m1p, m21, m22,.., m2p,.., mJ1, mJ2,…, mJp, σ1, σ2, …, σJ) = (0.163568 0.851471 1.594151 1.379580 13.092824 0.000505 12.611789 30.000000 0.000368 18.715240 0.000850 2.708967 30.000000 6.307677 7.584529 10.000000)</li>
<li>訓練數據為 “map2” 走一圈的訓練資訊，約為 500 筆。因為 “map0” (即本次作業給的地圖) 的複雜度不夠以至於無法充分表達原本設計的模糊系統。也就是根據當初模糊系統設計，收集的數據的多樣性和連續性不足。</li>
</ol>
<h3 id="實驗分析"><a href="#實驗分析" class="headerlink" title="實驗分析"></a>實驗分析</h3><p>根據 RBF 的神經元，這裡可以越少越好，在程式中，神經元個數(J) 設置 3 個。運行時採用輪盤式選擇，讓適應能力好的，具有較高的機會繁殖，採用一個隨機變數去挑選。而在基因方面使用實數型基因的形式。</p>
<ol>
<li>運行時，突變機率和突變比例相當重要，由於相同適應能力好的物種量很多，只保留其中一部分即可，因此可以將突變機率0.5 左右，太低則會造成進化速度太慢，太高則容易失去原本適應好的物種，導致整體適應度的震盪。</li>
<li>另外設置突變的比例，也就是該段實數值上下調整的比例。<br><code>g.getDNA()[i] = g.getDNA()[i] + ratio * Math.random() * g.getDNA()[i];</code><br>藉由上述的式子，將 ratio 設置成一個調變比例，來製造爆炸效應的規模。而在運行時，突變效果還能接受。</li>
<li>原本運行時，只將 DNA 片段的值任意放置，並且約束在不會超出函數的定義域，在收斂速度上有明顯加速。但為了符合作業需求，將每個參數約束在指定範圍內，在收斂速度慢了一截，在預期結果並沒有很好。</li>
<li>在不同地圖收集的預期資訊，會針對不同車子感測器的角度有所差異，因此不能拿不同型的感測數據，訓練出來的 RBF 不能給另外一台車子來使用，除非使用的感測器角度相當接近。</li>
<li>對於死路的轉彎，在神經元個數(J) 等於 2 的時候，運行結果較為不佳，但是在本次作業中，並不會有這種數據的出現，也不用考慮這種情況。但是當神經元個數少時，GA 算法的運行速度是相當快的。</li>
</ol>
<hr>
<h2 id="Lv-3-PSO"><a href="#Lv-3-PSO" class="headerlink" title="Lv. 3 PSO"></a>Lv. 3 PSO</h2><p>請利用Particle swarm optimization替換掉 GA 部分。</p>
<ul>
<li>AgentNum(粒子數)</li>
<li>IterationNum(疊代數),</li>
<li>MaxV(最大速度),</li>
<li>MaxX(最大值範圍),</li>
<li>Weights(兩個權重),</li>
<li>Convergent_Error(停止條件)</li>
<li>並畫出 fitness function 曲線變化 (每一次疊代的最佳fitness值)，最後訓練完成的F(x)當作規則 請跑出車子軌跡。</li>
</ul>
<h3 id="實驗分析-1"><a href="#實驗分析-1" class="headerlink" title="實驗分析"></a>實驗分析</h3><p>一開始參數為<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">int</span> sandSize = <span class="number">512</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">double</span> maxVelocity = <span class="number">0.5</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">double</span> maxXposition = <span class="number">0.5</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">double</span> weightOfCognition = <span class="number">0.5</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">double</span> weightOfSocial = <span class="number">0.5</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">double</span> nearRatio = <span class="number">0.5</span>;</div></pre></td></tr></table></figure></p>
<p><img src="/img/hw-ci-11.png" alt="PSO 1"></p>
<p><img src="/img/hw-ci-12.png" alt="PSO 2"></p>
<ul>
<li><p>基本上 <code>maxXposition</code> 沒有用到，調整其他比例可以發現端倪。</p>
</li>
<li><p>從圖 <code>PSO 2</code> 中可以發現到，PSO 與 GA 最大的不同在於，如果 GA 調用部分突變的情況下，很高的機率會發現適應曲線是嚴格遞減的，但是在 PSO 由於會飛來飛去，有可能會來回震盪。</p>
</li>
<li><p>當所有粒子逼近最佳解時，仍會以原本的速度繼續飛行，而原本屬於最佳位置的點也會開始模仿其他粒子飛行，如此一來就會造成震盪。</p>
</li>
</ul>
<p><img src="/img/hw-ci-14.png" alt="PSO 3"></p>
<ul>
<li><p>其震盪的高低決定於鄰近模仿的權重，如果鄰近的粒子效果不好，模仿的權重高的時候，會導致整個最佳解有嚴重的偏離。由 <code>PSO 3</code> 中可以驗證這個震盪問題。</p>
</li>
<li><p>如果對於全局模仿權重調高，很容易造成處於群聚粒子不容易分離，也就是很難在早到其他的區域最佳解，會在很快的時間內進入某一個區域最佳解，從這一點中可以發現 PSO 真的具有快速收斂的性質。</p>
</li>
<li><p>設定 <code>maxVelocity</code> 是將整個向量長度 (歐幾里得距離) 壓縮，這將可以控制查找的精密度，如果設定太小會導致收斂速度明顯下降。將 <code>maxVelocity = 10</code> 時，適應函數看起來會有比較高的進展，由於會將每個參數約束，只要速度不是太小影響就不大。</p>
</li>
<li><p>當速度上限增加時，粒子碰到牆的機會也會上升，由於搜索範圍的可能性涵蓋邊界的情況增加，如果最佳解在邊界，在這樣的情況就會更好。</p>
</li>
<li><p>在代碼中，鄰近的定義為最近粒子中排名前 20% 的最佳解。如果採用對於常數長度，這種情況上不容易觀察，也就是說不能直接找到鄰近模仿的規模該定義在何處。</p>
</li>
<li><p>運行結果 J = 3, p = 3<br>( ,w1 , w2 ,.., wJ , m11, m12,.., m1p, m21, m22,.., m2p,.., mJ1, mJ2,…, mJp, σ1, σ2, …, σJ) = (0.117271 1.270048 0.000000 0.805823 15.845525 0.000000 21.613452 13.509075 0.000000 0.000000 30.000000 0.000000 10.505934 10.000000 10.000000 5.238101)</p>
</li>
</ul>
<h1 id="Github-Download"><a href="#Github-Download" class="headerlink" title="Github Download"></a>Github Download</h1><p><a href="https://github.com/morris821028/hw-FuzzySystem" target="_blank" rel="external">Download</a></p>
<p><a href="http://morris821028.github.io/2014/05/19/hw-computational-intelligence/">Blog</a></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/79/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/78/">78</a><a class="page-number" href="/page/79/">79</a><span class="page-number current">80</span><a class="page-number" href="/page/81/">81</a><a class="page-number" href="/page/82/">82</a><span class="space">&hellip;</span><a class="page-number" href="/page/86/">86</a><a class="extend next" rel="next" href="/page/81/">Next &raquo;</a>
    </nav>
  
</section>
          
          
            <aside id="sidebar">
  <!-- <div id="ukagaka_panel"></div> -->
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">115</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算機圖學/">計算機圖學</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/">工作應用</a><span class="category-list-count">38</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Java/">Java</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Meme/">Meme</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/其他/">其他</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/可持久化/">可持久化</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/鬼故事/">鬼故事</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">49</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">633</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">483</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">77</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">45</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2021/10/28/diary-202110-encrypt/">
              
                <i class="icon-file-o"></i> 
              
            《批改娘串起得那段經歷·序》</a>
          </li>
        
          <li>
            <a class="text" href="/2021/10/28/diary-202110/">
              
                <i class="icon-file-o"></i> 
              
            好多個 28 在這個時刻</a>
          </li>
        
          <li>
            <a class="text" href="/2021/10/28/work/company-ghost-story-14/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 14</a>
          </li>
        
          <li>
            <a class="text" href="/2021/09/12/work/appreciation-letter/">
              
                <i class="icon-file-o"></i> 
              
            Shiny People 感謝</a>
          </li>
        
          <li>
            <a class="text" href="/2021/09/12/work/company-ghost-story-13/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 13</a>
          </li>
        
          <li>
            <a class="text" href="/2021/08/15/diary-202108/">
              
                <i class="icon-file-o"></i> 
              
            被預告要開始管人的我，今天開始學管理？</a>
          </li>
        
          <li>
            <a class="text" href="/2021/08/14/work/company-ghost-story-12/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 12</a>
          </li>
        
          <li>
            <a class="text" href="/2021/07/29/java/java-jni-tls-error-2/">
              
                <i class="icon-file-o"></i> 
              
            Java JNI GC Thread Error (EINVAL)</a>
          </li>
        
          <li>
            <a class="text" href="/2021/07/29/work/company-ghost-story-11/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 11</a>
          </li>
        
          <li>
            <a class="text" href="/2021/06/21/diary-202106/">
              
                <i class="icon-file-o"></i> 
              
            疫情下的工作變化</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
        <ul>
          <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
        </ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
  
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2021 Shiang-Yun Yang 
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>