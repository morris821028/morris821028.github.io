<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Morris&#39; Blog">
<meta property="og:url" content="http://morris821028.github.io/page/6/index.html">
<meta property="og:site_name" content="Morris&#39; Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris&#39; Blog">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
  <!-- <link rel="import" href="/bower_components/app-layout/app-layout.html"> --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          
          <section id="main">
  
    <article id="post-zj-e021" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/16/zj-e021/" class="article-date">
  <time datetime="2019-02-16T01:11:22.000Z" itemprop="datePublished">2019-02-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/16/zj-e021/">動態幾何 史蒂芙的泡泡 (解法 2)</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2019/02/16/zj-e021/" data-id="ckvd6e8ia01599cvncls9ik92" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2019/02/16/zj-e021/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pbds/">pbds</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rope/">rope</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>在處理完數以百計的政事後，受盡折磨的史蒂芙，打算回家好好地休息。 拖著疲倦的身軀，再也無法再容納任何一點複雜計算。從王宮走回寢居的路上， 發現身邊所見的事物都不再圓滑，看起來就像是粗糙的幾何多邊形構成的一切。</p>
<p>打算享受著泡泡浴的史蒂芙，看著眼前的多邊形泡泡，失去原本應有的色澤，那透涼的心境更蒙上了一層灰影</p>
<p>「為什麼是我呢？」感嘆道</p>
<p>伸出手戳著眼前的泡泡，卻飄了過去</p>
<p>「區區的泡泡也跟我作對，嗚嗚」</p>
<p>將一個泡泡視為一個簡單多邊形 <span>$A$</span><!-- Has MathJax -->，方便起見用一個序列 <span>$a_0, a_1, ..., a_{n-1}$</span><!-- Has MathJax --> 表示多邊形 <span>$A$</span><!-- Has MathJax --> 的每一個頂點，則會有 <span>$n$</span><!-- Has MathJax --> 個線段 <span>$\overline{a_0 a_1}, \overline{a_1 a_2}, \cdots, \overline{a_{n-1} a_0}$</span><!-- Has MathJax -->。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">5 14</div><div class="line"></div><div class="line">0 0</div><div class="line">10 0 </div><div class="line">10 10</div><div class="line">0 10</div><div class="line">5 5</div><div class="line"></div><div class="line">1 0 0</div><div class="line">1 1 0</div><div class="line">1 2 1</div><div class="line">1 3 2</div><div class="line">3 5.5 5</div><div class="line">3 10 -1</div><div class="line">3 10 5</div><div class="line">1 4 1</div><div class="line">3 5.5 5</div><div class="line">3 10 -1</div><div class="line">3 10 5</div><div class="line">2 3</div><div class="line">3 5 7.5</div><div class="line">3 5 2.5</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">1</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>參閱 <a href="/2019/01/26/mproblem-dynamic-point-in-polygon/" title="動態幾何 史蒂芙的泡泡  (解法 1)">動態幾何 史蒂芙的泡泡  (解法 1)</a></p>
<p>相較於先前的解法 <span>$\mathcal{O}(\log n) - \mathcal{O}(\ast \sqrt{n})$</span><!-- Has MathJax -->，相當不穩定的嵌套 KD-BRH 的解法，實際上如果單純針對這一題，可以拋開 region search 的操作，只有完全的詢問點是否在多邊形內部，則可以做到 <span>$\mathcal{O}(\log^2 n)$</span><!-- Has MathJax -->。</p>
<p>如同一般的射線法，對詢問點拉出無限延長的線，找到與多邊形的邊相交個數。如果單純把每一條邊拿出來看，最暴力的複雜度為 <span>$\mathcal{O}(n)$</span><!-- Has MathJax -->，現在要減少查閱的邊數，且透過 rank tree 在 <span>$\mathcal{O}(\log n)$</span><!-- Has MathJax --> 累計相交數量。</p>
<p>由於給定的座標不需要動態，則著手離散化 <span>$X = x_0, x_1, \cdots, x_n$</span><!-- Has MathJax -->，線段樹中的每一個點 <span>$u$</span><!-- Has MathJax --> 維護一個 rank tree，把包含者個區段 <span>$[x_l, x_r]$</span><!-- Has MathJax --> 的線段通通放入，且保證放入的線段彼此之間不相交 (除了兩端點)。如此一來，當詢問一個點，需要探訪 <span>$\mathcal{O}(\log n)$</span><!-- Has MathJax --> 個節點，每個節點 <span>$u$</span><!-- Has MathJax --> 需要 <span>$\mathcal{O}(\log n)$</span><!-- Has MathJax --> 時間來計算相交數量，最後詢問的複雜度為 <span>$\mathcal{O}(\log^2 n)$</span><!-- Has MathJax -->。同理，修改點的操作也會在 <span>$\mathcal{O}(\log^2 n)$</span><!-- Has MathJax -->。</p>
<p>實作時，特別注意到與射線方向相同的線段不予處理，按照下面的寫法則是不處理垂直的線段，一來是射線法也不會去計算，二來是線段樹劃分的時候會造成一些邊界問題，由於我們對於點離散，父節點 <span>$[x_l, x_r]$</span><!-- Has MathJax -->，左右子樹控制的分別為 <span>$[x_l, x_\text{mid}]$</span><!-- Has MathJax -->、<span>$[x_\text{mid}, x_r]$</span><!-- Has MathJax -->，劃分時會共用中間點。</p>
<p>即使有了上述的概念來解題，我們仍需要維護 <a href="https://en.wikipedia.org/wiki/Rope_(data_structure" target="_blank" rel="external">rope data structrue</a> 來維護節點的相鄰關係，可以自己實作任何的 binary tree 來達到 <span>$\mathcal{O}(\log n)$</span><!-- Has MathJax -->，這裡採用 splay tree 示範。</p>
<hr>
<p>接下來介紹內建黑魔法 PBDS (policy-based data structure) 和 rope。很多人都提及到這些非正式的 STL 函式庫，只有在 gcc/g++ 裡面才有附錄，如果是 clang 等其他編譯器可能是沒有辦法的。所以上傳相關代碼要看 OJ 是否採用純正的 gcc/g++。</p>
<p>參考資料：</p>
<ul>
<li><a href="https://codeforces.com/blog/entry/11080" target="_blank" rel="external">C++ STL: Policy based data structures - Codeforces</a></li>
<li><a href="https://www.luogu.org/blog/Chanis/gnu-pbds" target="_blank" rel="external">比STL还STL？——平板电视</a></li>
<li><a href="http://www.martinbroadhurst.com/stl/Rope.html" target="_blank" rel="external">C++ STL: SGI rope</a></li>
</ul>
<p>PBDS 比較常用在 rank tree 和 heap，由於代碼量非常多，用內建防止 code length exceed limitation 的出現，也不妨是個好辦法。用 rank tree 的每一個詢問操作皆在 <span>$\mathcal{O}(\log n)$</span><!-- Has MathJax -->，而 heap 選擇 thin heap 或 pairing heap，除了 pop 操作外，皆為 <span>$\mathcal{O}(1)$</span><!-- Has MathJax -->，在對最短路徑問題上別有優勢。</p>
<p>而這一題不太適用 SGI rope，原因在於雖為 <span>$\mathcal{O}(\log n)$</span><!-- Has MathJax --> 操作，但它原本就為了仿作 string 而強迫變成可持久化的引數結構，導致每一個操作需要額外的開銷來減少內存使用。由於此題經常在單一元素上操作，SGI rope 對於單一元素效能不彰，以造成嚴重的逾時。</p>
<p>這裡仍提及和示範這些概念的資料結構，哪天正式編入標準函式庫，想必效能問題都已解決。</p>
<hr>
<ul>
<li>KD BRH AC(0.2s, 10 MB)</li>
<li>PBDS + SPLAY AC(0.3s, 38 MB)</li>
<li>PBDS + SGI rope AC(0.5s, 41 MB)<br>本機 MINGW gcc 4.9 c++ 11 編譯完運行最大的測資需要 20 倍慢於其他寫法，但是上傳到 ZJ 的 gcc 7 又追回去了。於是下載 CYGWIN gcc 7 測試結果與 ZJ 運行結果相當，對於需要調適的人，建議在新版上測試。</li>
</ul>
<p>用 splay tree 模擬 rope 的時候，會遇到循序非遞減的走訪，這時候若不斷地旋轉至根，會在之後的操作造成退化，常數稍微大一點，雖然在迭代過程中造就好的快取效能，很快地在 <span>$\mathcal{O}(1)$</span><!-- Has MathJax --> 訪問到相鄰的節點，卻在下一次的插入/刪除操作中變慢。一些變異的版本中，如只在插入/刪除操作中旋轉至根，在查找操作中不旋轉，或者限制旋轉的深度。雖然有一些特別的退化操作，splay 仍舊是某些 OS 場景中使用的資料結構，現實總是很特別的。</p>
<blockquote><p>In 2000, Danny Sleator and Robert Tarjan won the ACM Kanellakis Theory and Practice Award for their papers on splay trees and amortized analysis.  Splay trees are used in Windows NT (in the virtual memory, networking, and file system code), the gcc compiler and GNU C++ library, the sed string editor, Fore Systems network routers, the most popular implementation of Unix malloc, Linux loadable kernel modules, and in much other software.</p>
<footer><strong>Berkeley eecs April 23, 2014</strong><cite><a href="https://people.eecs.berkeley.edu/~jrs/61b/lec/36" target="_blank" rel="external">people.eecs.berkeley.edu/~jrs/61b/lec/36</a></cite></footer></blockquote>
<h3 id="PBDS-SPLAY"><a href="#PBDS-SPLAY" class="headerlink" title="PBDS + SPLAY"></a>PBDS + SPLAY</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ext/pb_ds/assoc_container.hpp&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ext/pb_ds/tree_policy.hpp&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_pbds;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Mesh</span> &#123;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>;</div><div class="line">    <span class="keyword">int</span> pt[MAXN][<span class="number">2</span>];</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; X;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;pt[i][<span class="number">0</span>], &amp;pt[i][<span class="number">1</span>]);</div><div class="line">        X.clear(); X.reserve(n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            X.push_back(pt[i][<span class="number">0</span>]);</div><div class="line">        sort(X.begin(), X.end());</div><div class="line">        X.erase(unique(X.begin(), X.end()), X.end());</div><div class="line">    &#125;</div><div class="line">&#125; mesh;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SplayTree</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">        Node *ch[<span class="number">2</span>], *fa;</div><div class="line">        <span class="keyword">int</span> size; <span class="keyword">int</span> data;</div><div class="line">        Node() &#123;</div><div class="line">            ch[<span class="number">0</span>] = ch[<span class="number">1</span>] = fa = <span class="literal">NULL</span>;</div><div class="line">            size = <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">is_root</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> fa-&gt;ch[<span class="number">0</span>] != <span class="keyword">this</span> &amp;&amp; fa-&gt;ch[<span class="number">1</span>] != <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    Node *root, *EMPTY;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(Node *u)</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (u-&gt;ch[<span class="number">0</span>] != EMPTY)	pushdown(u-&gt;ch[<span class="number">0</span>]);</div><div class="line">        <span class="keyword">if</span> (u-&gt;ch[<span class="number">1</span>] != EMPTY)	pushdown(u-&gt;ch[<span class="number">1</span>]);</div><div class="line">        u-&gt;size = <span class="number">1</span> + u-&gt;ch[<span class="number">0</span>]-&gt;size + u-&gt;ch[<span class="number">1</span>]-&gt;size;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setch</span><span class="params">(Node *p, Node *u, <span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (p != EMPTY)	p-&gt;ch[i] = u;</div><div class="line">        <span class="keyword">if</span> (u != EMPTY)	u-&gt;fa = p;</div><div class="line">    &#125;</div><div class="line">    SplayTree() &#123;</div><div class="line">        EMPTY = <span class="keyword">new</span> Node();</div><div class="line">        EMPTY-&gt;fa = EMPTY-&gt;ch[<span class="number">0</span>] = EMPTY-&gt;ch[<span class="number">1</span>] = EMPTY;</div><div class="line">        EMPTY-&gt;size = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        root = EMPTY;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</div><div class="line">        Node *u = <span class="keyword">new</span> Node();</div><div class="line">        u-&gt;fa = u-&gt;ch[<span class="number">0</span>] = u-&gt;ch[<span class="number">1</span>] = EMPTY;</div><div class="line">        <span class="keyword">return</span> u;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(Node *x)</span> </span>&#123;</div><div class="line">        Node *y;</div><div class="line">        <span class="keyword">int</span> d;</div><div class="line">        y = x-&gt;fa, d = y-&gt;ch[<span class="number">1</span>] == x ? <span class="number">1</span> : <span class="number">0</span>;</div><div class="line">        x-&gt;ch[d^<span class="number">1</span>]-&gt;fa = y, y-&gt;ch[d] = x-&gt;ch[d^<span class="number">1</span>];</div><div class="line">        x-&gt;ch[d^<span class="number">1</span>] = y;</div><div class="line">        <span class="keyword">if</span> (!y-&gt;is_root())</div><div class="line">            y-&gt;fa-&gt;ch[y-&gt;fa-&gt;ch[<span class="number">1</span>] == y] = x;</div><div class="line">        x-&gt;fa = y-&gt;fa, y-&gt;fa = x;</div><div class="line">        pushup(y);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deal</span><span class="params">(Node *x)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!x-&gt;is_root())	deal(x-&gt;fa);</div><div class="line">        pushdown(x);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(Node *x, Node *below)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (x == EMPTY)	<span class="keyword">return</span> ;</div><div class="line">        Node *y, *z;</div><div class="line">        deal(x);</div><div class="line">        <span class="keyword">while</span> (!x-&gt;is_root() &amp;&amp; x-&gt;fa != below) &#123;</div><div class="line">            y = x-&gt;fa, z = y-&gt;fa;</div><div class="line">            <span class="keyword">if</span> (!y-&gt;is_root() &amp;&amp; y-&gt;fa != below) &#123;</div><div class="line">                <span class="keyword">if</span> (y-&gt;ch[<span class="number">0</span>] == x ^ z-&gt;ch[<span class="number">0</span>] == y)</div><div class="line">                    rotate(x);</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    rotate(y);</div><div class="line">            &#125;</div><div class="line">            rotate(x);</div><div class="line">        &#125;</div><div class="line">        pushup(x);</div><div class="line">        <span class="keyword">if</span> (x-&gt;fa == EMPTY)	root = x;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">prevNode</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        splay(u, EMPTY);</div><div class="line">        <span class="keyword">return</span> maxNode(u-&gt;ch[<span class="number">0</span>]);</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">nextNode</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        splay(u, EMPTY);</div><div class="line">        <span class="keyword">return</span> minNode(u-&gt;ch[<span class="number">1</span>]);</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">minNode</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        Node *p = u-&gt;fa;</div><div class="line">        <span class="keyword">for</span> (; pushdown(u), u-&gt;ch[<span class="number">0</span>] != EMPTY; u = u-&gt;ch[<span class="number">0</span>]);</div><div class="line">        splay(u, p);</div><div class="line">        <span class="keyword">return</span> u;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">maxNode</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        Node *p = u-&gt;fa;</div><div class="line">        <span class="keyword">for</span> (; pushdown(u), u-&gt;ch[<span class="number">1</span>] != EMPTY; u = u-&gt;ch[<span class="number">1</span>]);</div><div class="line">        splay(u, p);</div><div class="line">        <span class="keyword">return</span> u;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">findPos</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123; <span class="comment">// [0...]</span></div><div class="line">        <span class="keyword">for</span> (Node *u = root; u != EMPTY;) &#123;</div><div class="line">            pushdown(u);</div><div class="line">            <span class="keyword">int</span> t = u-&gt;ch[<span class="number">0</span>]-&gt;size;</div><div class="line">            <span class="keyword">if</span> (t == pos) &#123;</div><div class="line">                splay(u, EMPTY);</div><div class="line">                <span class="keyword">return</span> u;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (t &gt; pos)</div><div class="line">                u = u-&gt;ch[<span class="number">0</span>];</div><div class="line">            <span class="keyword">else</span></div><div class="line">                u = u-&gt;ch[<span class="number">1</span>], pos -= t + <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> EMPTY;</div><div class="line">    &#125;</div><div class="line">    tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; insert(<span class="keyword">int</span> data, <span class="keyword">int</span> pos) &#123;	<span class="comment">// make [pos] = data</span></div><div class="line">        Node *p, *q = findPos(pos);</div><div class="line">        Node *x = newNode(); x-&gt;data = data;</div><div class="line">        <span class="keyword">if</span> (q == EMPTY) &#123;</div><div class="line">            p = maxNode(root), splay(p, EMPTY);</div><div class="line">            setch(x, p, <span class="number">0</span>);</div><div class="line">            splay(x, EMPTY);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            splay(q, EMPTY), p = q-&gt;ch[<span class="number">0</span>];</div><div class="line">            setch(x, p, <span class="number">0</span>), setch(x, q, <span class="number">1</span>);</div><div class="line">            setch(q, EMPTY, <span class="number">0</span>);</div><div class="line">            splay(q, EMPTY);</div><div class="line">            p = prevNode(x);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (p == EMPTY)	p = maxNode(root);</div><div class="line">        <span class="keyword">if</span> (q == EMPTY)	q = minNode(root);</div><div class="line">        <span class="keyword">return</span> make_tuple(p-&gt;data, data, q-&gt;data);</div><div class="line">    &#125;</div><div class="line">    tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; remove(<span class="keyword">int</span> pos) &#123;</div><div class="line">        Node *x = findPos(pos), *p, *q;</div><div class="line">        p = prevNode(x), q = nextNode(x);</div><div class="line">        <span class="keyword">if</span> (p != EMPTY &amp;&amp; q != EMPTY) &#123;</div><div class="line">            setch(p, q, <span class="number">1</span>);</div><div class="line">            p-&gt;fa = EMPTY, splay(q, EMPTY);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p != EMPTY) &#123;</div><div class="line">            p-&gt;fa = EMPTY, root = p;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            q-&gt;fa = EMPTY, root = q;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> del = x-&gt;data;</div><div class="line">        <span class="keyword">delete</span> x;</div><div class="line">        <span class="keyword">if</span> (p == EMPTY)	p = maxNode(root);</div><div class="line">        <span class="keyword">if</span> (q == EMPTY)	q = minNode(root);</div><div class="line">        <span class="keyword">return</span> make_tuple(p-&gt;data, del, q-&gt;data);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> root == EMPTY ? <span class="number">0</span> : root-&gt;size;</div><div class="line">    &#125;</div><div class="line">&#125; mlist;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pt</span> &#123;</span></div><div class="line">    <span class="keyword">double</span> x, y;</div><div class="line">    Pt() &#123;&#125;</div><div class="line">    Pt(<span class="keyword">int</span> xy[]):Pt(xy[<span class="number">0</span>], xy[<span class="number">1</span>]) &#123;&#125;</div><div class="line">    Pt(<span class="keyword">double</span> x, <span class="keyword">double</span> y):x(x), y(y) &#123;&#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Pt &amp;o) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">if</span> (x != o.x)	<span class="keyword">return</span> x &lt; o.x;</div><div class="line">        <span class="keyword">return</span> y &lt; o.y;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PtP</span> &#123;</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">double</span> x;</div><div class="line">    Pt p, q;</div><div class="line">    PtP(Pt a, Pt b) &#123;</div><div class="line">        p = a, q = b;</div><div class="line">        <span class="keyword">if</span> (q &lt; p)</div><div class="line">            swap(p, q);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">interpolate</span><span class="params">(<span class="keyword">const</span> Pt&amp; p1, <span class="keyword">const</span> Pt&amp; p2, <span class="keyword">double</span>&amp; x)</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (p1.x == p2.x) <span class="keyword">return</span> min(p1.y, p2.y);</div><div class="line">        <span class="keyword">return</span> p1.y + (p2.y - p1.y) / (p2.x - p1.x) * (x - p1.x);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> PtP &amp;o) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> interpolate(p, q, x) &lt; interpolate(o.p, o.q, x);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">double</span> PtP::x = <span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegSeg</span> &#123;</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">        Node *lson, *rson;</div><div class="line">        tree&lt;pair&lt;PtP, <span class="keyword">int</span>&gt;, null_type, less&lt;pair&lt;PtP, <span class="keyword">int</span>&gt;&gt;, rb_tree_tag, tree_order_statistics_node_update&gt; segs;</div><div class="line">        Node() &#123;</div><div class="line">            lson = rson = <span class="literal">NULL</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    Node *root;</div><div class="line">    <span class="keyword">int</span> xn;</div><div class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Node();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">freeNode</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        <span class="built_in">free</span>(u);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        root = <span class="literal">NULL</span>;</div><div class="line">        xn = mesh.X.size();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; e)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> p, q, r; tie(p, q, r) = e;</div><div class="line">        remove(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;PtP(Pt(mesh.pt[p]), Pt(mesh.pt[r])), r&#125;);</div><div class="line">        insert(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;PtP(Pt(mesh.pt[p]), Pt(mesh.pt[q])), q&#125;);</div><div class="line">        insert(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;PtP(Pt(mesh.pt[q]), Pt(mesh.pt[r])), r&#125;);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; e)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> p, q, r; tie(p, q, r) = e;</div><div class="line">        remove(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;PtP(Pt(mesh.pt[p]), Pt(mesh.pt[q])), q&#125;);</div><div class="line">        remove(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;PtP(Pt(mesh.pt[q]), Pt(mesh.pt[r])), r&#125;);</div><div class="line">        insert(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;PtP(Pt(mesh.pt[p]), Pt(mesh.pt[r])), r&#125;);</div><div class="line">    &#125;	</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">inside</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> </span>&#123;</div><div class="line">        PtP::x = x;</div><div class="line">        <span class="keyword">return</span> count(root, <span class="number">0</span>, xn<span class="number">-1</span>, x, y)&amp;<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">count</span><span class="params">(Node* u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span> ((mesh.X[l] &gt; x) != (mesh.X[r] &gt; x))</div><div class="line">            ret += u-&gt;segs.order_of_key(&#123;PtP(Pt(x, y), Pt(x, y)), <span class="number">-1</span>&#125;);</div><div class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</div><div class="line">        <span class="keyword">if</span> (x &lt;= mesh.X[m])</div><div class="line">            ret += count(u-&gt;lson, l, m, x, y);</div><div class="line">        <span class="keyword">if</span> (x &gt;= mesh.X[m])</div><div class="line">            ret += count(u-&gt;rson, m, r, x, y);</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, pair&lt;PtP, <span class="keyword">int</span>&gt; s)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (s.first.p.x != s.first.q.x)</div><div class="line">            insert(root, l, r, s);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, pair&lt;PtP, <span class="keyword">int</span>&gt; s)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (s.first.p.x != s.first.q.x)</div><div class="line">            remove(root, l, r, s);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Node* &amp;u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, pair&lt;PtP, <span class="keyword">int</span>&gt; s)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</div><div class="line">            u = newNode();</div><div class="line">        <span class="keyword">if</span> (s.first.p.x &lt;= mesh.X[l] &amp;&amp; mesh.X[r] &lt;= s.first.q.x) &#123;</div><div class="line">            PtP::x = (mesh.X[l] + mesh.X[r])/<span class="number">2.0</span>;</div><div class="line">            u-&gt;segs.insert(s);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</div><div class="line">        <span class="keyword">if</span> (s.first.q.x &lt;= mesh.X[m])			insert(u-&gt;lson, l, m, s);</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s.first.p.x &gt;= mesh.X[m])	insert(u-&gt;rson, m, r, s);</div><div class="line">        <span class="keyword">else</span>	insert(u-&gt;lson, l, m, s), insert(u-&gt;rson, m, r, s);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(Node* u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, pair&lt;PtP, <span class="keyword">int</span>&gt; s)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        <span class="keyword">if</span> (s.first.p.x &lt;= mesh.X[l] &amp;&amp; mesh.X[r] &lt;= s.first.q.x) &#123;</div><div class="line">            PtP::x = (mesh.X[l] + mesh.X[r])/<span class="number">2.0</span>;</div><div class="line">            u-&gt;segs.erase(s);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</div><div class="line">        <span class="keyword">if</span> (s.first.q.x &lt;= mesh.X[m])			remove(u-&gt;lson, l, m, s);</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s.first.p.x &gt;= mesh.X[m])	remove(u-&gt;rson, m, r, s);</div><div class="line">        <span class="keyword">else</span>	remove(u-&gt;lson, l, m, s), remove(u-&gt;rson, m, r, s);</div><div class="line">    &#125;</div><div class="line">&#125; mbrh;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n, m, cmd, x, pos;</div><div class="line">    <span class="keyword">double</span> px, py;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;n, &amp;m);</div><div class="line">    mesh.read(n);</div><div class="line">    mlist.init(), mbrh.init();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;cmd);</div><div class="line">        <span class="keyword">if</span> (cmd == <span class="number">1</span>) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;x, &amp;pos);</div><div class="line">            mbrh.insert(mlist.insert(x, pos));</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">2</span>) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x);</div><div class="line">            mbrh.remove(mlist.remove(x));</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%lf %lf"</span>, &amp;px, &amp;py);</div><div class="line">            <span class="built_in">puts</span>(mbrh.inside(px, py) ? <span class="string">"1"</span> : <span class="string">"0"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="PBDS-ROPE"><a href="#PBDS-ROPE" class="headerlink" title="PBDS + ROPE"></a>PBDS + ROPE</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ext/rope&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_cxx;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ext/pb_ds/assoc_container.hpp&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ext/pb_ds/tree_policy.hpp&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_pbds;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Mesh</span> &#123;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>;</div><div class="line">    <span class="keyword">int</span> pt[MAXN][<span class="number">2</span>];</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; X;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;pt[i][<span class="number">0</span>], &amp;pt[i][<span class="number">1</span>]);</div><div class="line">        X.clear(); X.reserve(n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            X.push_back(pt[i][<span class="number">0</span>]);</div><div class="line">        sort(X.begin(), X.end());</div><div class="line">        X.erase(unique(X.begin(), X.end()), X.end());</div><div class="line">    &#125;</div><div class="line">&#125; mesh;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rope</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    rope&lt;<span class="keyword">int</span>&gt; r;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        r.clear();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">next</span><span class="params">(rope&lt;<span class="keyword">int</span>&gt;::const_iterator it)</span> </span>&#123;</div><div class="line">        it++;</div><div class="line">        <span class="keyword">if</span> (it == r.end())</div><div class="line">            <span class="keyword">return</span> *r.begin();</div><div class="line">        <span class="keyword">return</span> *it;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">prev</span><span class="params">(rope&lt;<span class="keyword">int</span>&gt;::const_iterator it)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (it == r.begin())</div><div class="line">            <span class="keyword">return</span> *r.rbegin();</div><div class="line">        it--;</div><div class="line">        <span class="keyword">return</span> *it;</div><div class="line">    &#125;</div><div class="line">    tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; insert(<span class="keyword">int</span> data, <span class="keyword">int</span> pos) &#123;</div><div class="line">        r.insert(pos, data);</div><div class="line">        <span class="keyword">auto</span> it = r.begin() + pos;</div><div class="line">        <span class="keyword">int</span> p = prev(it);</div><div class="line">        <span class="keyword">int</span> q = next(it);</div><div class="line">        <span class="keyword">return</span> make_tuple(p, data, q);</div><div class="line">    &#125;</div><div class="line">    tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; remove(<span class="keyword">int</span> pos) &#123;</div><div class="line">        <span class="keyword">auto</span> it = r.begin() + pos;</div><div class="line">        <span class="keyword">int</span> del = *it;</div><div class="line">        <span class="keyword">int</span> p = prev(it);</div><div class="line">        <span class="keyword">int</span> q = next(it);</div><div class="line">        r.erase(pos, <span class="number">1</span>);</div><div class="line">        <span class="keyword">return</span> make_tuple(p, del, q);</div><div class="line">    &#125;</div><div class="line">&#125; mlist;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pt</span> &#123;</span></div><div class="line">    <span class="keyword">double</span> x, y;</div><div class="line">    Pt() &#123;&#125;</div><div class="line">    Pt(<span class="keyword">int</span> xy[]):Pt(xy[<span class="number">0</span>], xy[<span class="number">1</span>]) &#123;&#125;</div><div class="line">    Pt(<span class="keyword">double</span> x, <span class="keyword">double</span> y):x(x), y(y) &#123;&#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Pt &amp;o) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">if</span> (x != o.x)	<span class="keyword">return</span> x &lt; o.x;</div><div class="line">        <span class="keyword">return</span> y &lt; o.y;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PtP</span> &#123;</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">double</span> x;</div><div class="line">    Pt p, q;</div><div class="line">    PtP(Pt a, Pt b) &#123;</div><div class="line">        p = a, q = b;</div><div class="line">        <span class="keyword">if</span> (q &lt; p)</div><div class="line">            swap(p, q);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">interpolate</span><span class="params">(<span class="keyword">const</span> Pt&amp; p1, <span class="keyword">const</span> Pt&amp; p2, <span class="keyword">double</span>&amp; x)</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (p1.x == p2.x) <span class="keyword">return</span> min(p1.y, p2.y);</div><div class="line">        <span class="keyword">return</span> p1.y + (p2.y - p1.y) / (p2.x - p1.x) * (x - p1.x);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> PtP &amp;o) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> interpolate(p, q, x) &lt; interpolate(o.p, o.q, x);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">double</span> PtP::x = <span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegSeg</span> &#123;</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">        Node *lson, *rson;</div><div class="line">        tree&lt;pair&lt;PtP, <span class="keyword">int</span>&gt;, null_type, less&lt;pair&lt;PtP, <span class="keyword">int</span>&gt;&gt;, rb_tree_tag, tree_order_statistics_node_update&gt; segs;</div><div class="line">        Node() &#123;</div><div class="line">            lson = rson = <span class="literal">NULL</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    Node *root;</div><div class="line">    <span class="keyword">int</span> xn;</div><div class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Node();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        root = <span class="literal">NULL</span>;</div><div class="line">        xn = mesh.X.size();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; e)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> p, q, r; tie(p, q, r) = e;</div><div class="line">        remove(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;PtP(Pt(mesh.pt[p]), Pt(mesh.pt[r])), r&#125;);</div><div class="line">        insert(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;PtP(Pt(mesh.pt[p]), Pt(mesh.pt[q])), q&#125;);</div><div class="line">        insert(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;PtP(Pt(mesh.pt[q]), Pt(mesh.pt[r])), r&#125;);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; e)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> p, q, r; tie(p, q, r) = e;</div><div class="line">        remove(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;PtP(Pt(mesh.pt[p]), Pt(mesh.pt[q])), q&#125;);</div><div class="line">        remove(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;PtP(Pt(mesh.pt[q]), Pt(mesh.pt[r])), r&#125;);</div><div class="line">        insert(<span class="number">0</span>, xn<span class="number">-1</span>, &#123;PtP(Pt(mesh.pt[p]), Pt(mesh.pt[r])), r&#125;);</div><div class="line">    &#125;	</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">inside</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> </span>&#123;</div><div class="line">        PtP::x = x;</div><div class="line">        <span class="keyword">return</span> count(root, <span class="number">0</span>, xn<span class="number">-1</span>, x, y)&amp;<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">count</span><span class="params">(Node* u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span> ((mesh.X[l] &gt; x) != (mesh.X[r] &gt; x))</div><div class="line">            ret += u-&gt;segs.order_of_key(&#123;PtP(Pt(x, y), Pt(x, y)), <span class="number">-1</span>&#125;);</div><div class="line">        <span class="keyword">if</span> (l == r)</div><div class="line">            <span class="keyword">return</span> ret;</div><div class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</div><div class="line">        <span class="keyword">if</span> (x &lt;= mesh.X[m])</div><div class="line">            ret += count(u-&gt;lson, l, m, x, y);</div><div class="line">        <span class="keyword">if</span> (x &gt;= mesh.X[m])</div><div class="line">            ret += count(u-&gt;rson, m, r, x, y);</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, pair&lt;PtP, <span class="keyword">int</span>&gt; s)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (s.first.p.x != s.first.q.x)</div><div class="line">            insert(root, l, r, s);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, pair&lt;PtP, <span class="keyword">int</span>&gt; s)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (s.first.p.x != s.first.q.x)</div><div class="line">            remove(root, l, r, s);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Node* &amp;u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, pair&lt;PtP, <span class="keyword">int</span>&gt; s)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</div><div class="line">            u = newNode();</div><div class="line">        <span class="keyword">if</span> (s.first.p.x &lt;= mesh.X[l] &amp;&amp; mesh.X[r] &lt;= s.first.q.x) &#123;</div><div class="line">            PtP::x = (mesh.X[l] + mesh.X[r])/<span class="number">2.0</span>;</div><div class="line">            u-&gt;segs.insert(s);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (l == r)</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</div><div class="line">        <span class="keyword">if</span> (s.first.q.x &lt;= mesh.X[m])			insert(u-&gt;lson, l, m, s);</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s.first.p.x &gt;= mesh.X[m])	insert(u-&gt;rson, m, r, s);</div><div class="line">        <span class="keyword">else</span>	insert(u-&gt;lson, l, m, s), insert(u-&gt;rson, m, r, s);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(Node* &amp;u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, pair&lt;PtP, <span class="keyword">int</span>&gt; s)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        <span class="keyword">if</span> (s.first.p.x &lt;= mesh.X[l] &amp;&amp; mesh.X[r] &lt;= s.first.q.x) &#123;</div><div class="line">            PtP::x = (mesh.X[l] + mesh.X[r])/<span class="number">2.0</span>;</div><div class="line">            u-&gt;segs.erase(s);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (l == r)</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</div><div class="line">        <span class="keyword">if</span> (s.first.q.x &lt;= mesh.X[m])			remove(u-&gt;lson, l, m, s);</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s.first.p.x &gt;= mesh.X[m])	remove(u-&gt;rson, m, r, s);</div><div class="line">        <span class="keyword">else</span>	remove(u-&gt;lson, l, m, s), remove(u-&gt;rson, m, r, s);</div><div class="line">    &#125;</div><div class="line">&#125; mbrh;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n, m, cmd, x, pos;</div><div class="line">    <span class="keyword">double</span> px, py;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;n, &amp;m);</div><div class="line">    mesh.read(n);</div><div class="line">    mlist.init(), mbrh.init();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;cmd);</div><div class="line">        <span class="keyword">if</span> (cmd == <span class="number">1</span>) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;x, &amp;pos);</div><div class="line">            mbrh.insert(mlist.insert(x, pos));</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">2</span>) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x);</div><div class="line">            mbrh.remove(mlist.remove(x));</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%lf %lf"</span>, &amp;px, &amp;py);</div><div class="line">            <span class="built_in">puts</span>(mbrh.inside(px, py) ? <span class="string">"1"</span> : <span class="string">"0"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-diary-201901" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/27/diary-201901/" class="article-date">
  <time datetime="2019-01-27T10:57:20.000Z" itemprop="datePublished">2019-01-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="https://i.imgur.com/Klod0Cb.jpg" rel="gallery_ckvd6e82j00429cvnhilfkyqj">
        <img src="https://i.imgur.com/Klod0Cb.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/27/diary-201901/">敲落的聲響</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2019/01/27/diary-201901/" data-id="ckvd6e82j00429cvnhilfkyqj" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2019/01/27/diary-201901/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="那一刻"><a href="#那一刻" class="headerlink" title="那一刻"></a>那一刻</h2><p>2019 年的開始，研發替代役過去一年三個月，迎來人生巔峰的二十五歲。曾經努力積賺的學習，在這個當下不斷地被提取，已經無法再次追逐那夢想中的人生，那等跨不過的門檻，對於不斷地分析計算的我，早已算不出任何的可能性。</p>
<p><img src="https://i.imgur.com/zfcbnb3.jpg" alt="「全新投入工作中，過著非常平凡順遂的生活。監視著表面的自己是否有不斷地往前進，責怪著那個自己，為什麼沒有好好面對眼前的重要事物。」－《秒速 5 厘米》"></p>
<p>倘若停止督促自己這般前進的動力，又如何面對過去，原本希望在未來有所成就的自己。也許要有所改變，正也因為過去的累積才造就現在的我，如果可以這麼輕易地改變，那思考方式就像徹底換了個人似的，四分五裂。</p>
<p><img src="https://i.imgur.com/SDGBwqx.jpg" alt="「過去，一直抱持著專一的新。對於無法維持這種想法的自己，一直以來都無法釋懷。」－《秒速 5 厘米》"></p>
<p>即使有了工作，認識了新的同事，那無非也只是個工作，社交禮儀下的對談。彼此之間都過著各自的生活，每當論及自己的話題時，總是不知道要從哪裡找出，不受蜚言蜚語的內容。因為總是過著這樣的生活，每天走著兩點一線的路線，不曾偏離的軌跡要怎麼聊著好幾個日子。</p>
<p>要在外頭活出有趣的日子，那是如此困難的題目，每踏一步就是數以百萬的分枝，一個人也許走到哪算到哪，但總是無法歸納一個「樂」的結語。編出讓其他人能夠理解的話語，不斷地瞞騙自己，事實上並沒有這樣子的感受吧。我們之間並沒有好聊的，沒有交集的交流，就不要增添麻煩給彼此了。</p>
<p><img src="https://i.imgur.com/TBdU59l.jpg" alt="「總覺得…已經很久沒有跟人說過話了。」－《秒速 5 厘米》"></p>
<p>講講你喜歡的事情吧。無法輕易地說出喜歡，但從你們看來，擺明就是喜歡某些事情，才至於身邊都是這種事物的存在。這種老是亂下評論的人。若從口中道出「喜歡」兩個字，是否又可以增加對方強而有力的定論。身邊只有那些選項時，也只能從那些裡選，不斷地選了下去，那還能稱作「喜歡」的事物，而不是受到「束縛」的體現嗎？</p>
<p><img src="https://i.imgur.com/9USt2Yi.jpg" alt="「&quot;喜歡&quot; 是一個束縛的詞」－《終將成為你》"></p>
<h2 id="前一刻"><a href="#前一刻" class="headerlink" title="前一刻"></a>前一刻</h2><p>投入工作的那一年裡，不斷地翻盤革新，交付著重大包袱，那些面臨到不得不再次攤開的問題，早已沒有人可以述說那段歷史，而現在束手無撤的工程師們，無疑地想邁向全新的架構，到底要怎麼寫才可以銜接原本的需求，有多少人願意花時間去理解，而又有多少人願意花時間等你，不斷地估算那種看不到結局的日子有多遠，又細數著下一個里程有多近。那種龐大的壓迫，能不斷地走出下一步的策略在哪？</p>
<p><img src="https://i.imgur.com/JNNgnuJ.jpg" alt="「我該成為怎樣的人，來度過餘生」－《終將成為你》"></p>
<p>把畢生所學的技術填充進去，那樣就可以解決了嗎？發現有所缺陷的解法，想著問題以不同方式分解，再以不同方式擊破。想不出來就去休息吧。解解別的題目，再回來思考，重置於不同狀態的思維出發，就有機會看到問題的另一面。</p>
<p>然而，過著不斷轉換的日子，發現也來到了三千五百題，這令人羞於心的數字，表示了閒與宅的程度。而真正聰明的人，理應用最少的工具解決最多的問題，也就是以最少的題數，達成最好的成就。試圖從那些題目中淬煉新想法，果然還太愚笨了些，僅僅只是知道的比人多，卻沒有好好地比任何人都深入了解。</p>
<p><img src="https://i.imgur.com/RclLca4.jpg" alt="「但是我沒辦法在其他人面前，不做特別的自己」－《終將成為你》"></p>
<h2 id="下一刻"><a href="#下一刻" class="headerlink" title="下一刻"></a>下一刻</h2><p>一年的過去，收到一些學長們的問候，馬上就猜到是來拉人換工作的。現在的我，有那種能力獲得青睞嗎？而現在的位子，是否只是被人感受到這傢伙堪用？算了一算，那些提及的工作內容與薪水，到底以什麼樣的比例才算活得心安，能否不為了下一個日子前進而煩惱。原本應屬於我的日子，是哪一種？</p>
<p><img src="https://i.imgur.com/hrj6F6r.png" alt="「雖然很遺憾，才能這種東西是有個體差別的，若用鳥類來舉例，我的羽翼是靠腳踏驅動的那種」－《３月的獅子》"></p>
<p><img src="https://i.imgur.com/YldpTdf.png" alt="「如果，不像惡鬼般地逼迫自己，滿身大汗地蹬下去，一瞬間就會墜落地面」－《３月的獅子》"></p>
<p><img src="https://i.imgur.com/LQ2uoXb.png" alt="「如果停止蹬踏的話，若是將能量用再其他的事情上面，就算只是百分之幾，雖不至於墜下去，高度也會降低」－《３月的獅子》"></p>
<p>親人、同學、同事，每一個像是完成里程碑地一一度過了關卡，看到自己的下一關只剩下工作，也不知道工作的下一步是為了生活，而生活要去煩惱工作。如果只是這樣子不斷地循環，定義的輪廓已有了雛形，明瞭一切的那時也到了盡頭。如此地羨慕有目標走到下一步，而我只是在等待事情的落幕。</p>
<p>現在的處境到底是雞生蛋，還是蛋生雞？</p>
<p><img src="https://i.imgur.com/lTzsB7v.jpg" alt="「我們要一直活下去哦」－《盾之勇者成名錄》"></p>
<p><img src="https://i.imgur.com/5nx7lkn.jpg" alt="「我接受了現實，回歸平靜」－《我想吃掉你的胰臟》"></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-mproblem-dynamic-point-in-polygon" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/26/mproblem-dynamic-point-in-polygon/" class="article-date">
  <time datetime="2019-01-26T12:49:22.000Z" itemprop="datePublished">2019-01-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/出題解題/">出題解題</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/26/mproblem-dynamic-point-in-polygon/">動態幾何 史蒂芙的泡泡  (解法 1)</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2019/01/26/mproblem-dynamic-point-in-polygon/" data-id="ckvd6e85200at9cvnb26xz60n" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2019/01/26/mproblem-dynamic-point-in-polygon/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BRH/">BRH</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Splay-tree/">Splay tree</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kd-tree/">kd-tree</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/射線法/">射線法</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <blockquote>
<p>題目描述請至 Zerojudge e021: 史蒂芙的泡泡 查閱詳細內容</p>
</blockquote>
<h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>在處理完數以百計的政事後，受盡折磨的史蒂芙，打算回家好好地休息。 拖著疲倦的身軀，再也無法再容納任何一點複雜計算。從王宮走回寢居的路上， 發現身邊所見的事物都不再圓滑，看起來就像是粗糙的幾何多邊形構成的一切。</p>
<p>打算享受著泡泡浴的史蒂芙，看著眼前的多邊形泡泡，失去原本應有的色澤，那透涼的心境更蒙上了一層灰影</p>
<p>「為什麼是我呢？」感嘆道</p>
<p>伸出手戳著眼前的泡泡，卻飄了過去</p>
<p>「區區的泡泡也跟我作對，嗚嗚」</p>
<p>將一個泡泡視為一個簡單多邊形 <span>$A$</span><!-- Has MathJax -->，方便起見用一個序列 <span>$a_0, a_1, ..., a_{n-1}$</span><!-- Has MathJax --> 表示多邊形 <span>$A$</span><!-- Has MathJax --> 的每一個頂點，則會有 <span>$n$</span><!-- Has MathJax --> 個線段 <span>$\overline{a_0 a_1}, \overline{a_1 a_2}, \cdots, \overline{a_{n-1} a_0}$</span><!-- Has MathJax -->。</p>
<h2 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h2><p>從能找到的論文「A Unified Approach to Dynamic Point Location, Ray Shooting, and Shortest Paths in Planar Maps」 得知操作更新 <span>$\mathcal{O}(\log^3 n)$</span><!-- Has MathJax -->，詢問操作 <span>$\mathcal{O}(\log n)$</span><!-- Has MathJax -->，這一個實作難度估計沒辦法在 10K 限制下完成 (代碼上傳長度上限)。</p>
<p>從動態梯形剖分開始，複雜度就相當高了，而論文後要有類似輕重鏈剖分的概念，將對偶圖產生的節點以輕重邊保存，接著再維護雙線輪廓，讓相連的連續重邊可以保存左右兩側的輪廓，… 資訊量龐大，想到一些可能未提及的邊界案例，實作相當困難。而從其他題目的經驗中，當設計到 <span>$\mathcal{O}(\log^2 n)$</span><!-- Has MathJax --> 的操作時，由於操作常數大，運行時間可能無法匹敵 <span>$\mathcal{O}(\sqrt{n})$</span><!-- Has MathJax --> 的算法。</p>
<p>那麼有沒有其他的替代方案，只需要跑得比暴力法還要快就行？特別小心，暴力法找一個點是否在多邊形內，需要 <span>$\mathcal{O}(n)$</span><!-- Has MathJax --> 的時間，且快取效果非常好，很容易做到 SIMD 的平行技術。</p>
<p>首先，解決維護多邊形點集序列，可以使用任何的平衡樹完成，若採用 splay tree 在均攤 <span>$\text{Amortized} \; \mathcal{O}(\log n)$</span><!-- Has MathJax -->。使用 treap 也可以完成這類操作，還可以做到額外的持久化功能。接著，修改點的操作，可以轉換成替換一個點的下一個點，因此將點放在 KD tree 上，而維護下一個點相當於把每一個節點擴充成 BRH。</p>
<p>接著，當解決點是否在多邊形內時，可走訪 BRH 找射線穿過的交點個數，此時複雜度至少為 <span>$\mathcal{O}(\sqrt{n} + k)$</span><!-- Has MathJax -->，其中 <span>$k$</span><!-- Has MathJax --> 為交點個數。我們可以額外維護多邊形的順逆時針來優化搜尋空間，最後一個接觸的線段方向，額外提供奇偶數來判斷該點是否在內側，然後把射線縮短到交點到詢問點之間。不斷地縮短搜尋空間下，大部分的情況為 <span>$\mathcal{O}(\sqrt{n})$</span><!-- Has MathJax -->，拋開了原本存在的 <span>$k$</span><!-- Has MathJax -->。</p>
<p>由於是封閉的簡單多邊形，所以當邊的疏密程度不一時，KD tree 轉換 BRH 會造成額外的負擔，bounding box 無法有效提供分割空間的功能。那麼在實際搜尋情況，額外走訪的節點與平面分布有關，這部分就不好分析。如果有更好的想法，歡迎分享。</p>
<p>現在實作動態 KD tree 必須有替罪羊樹 Scapegoat tree 的概念，再掛上 BRH 的想法，提供了相對有效率的動態方法來查詢點是否在多邊形內部。若把維護點序列的 splay tree 換成 treap，便可以做到持久化的動態幾何操作，這便是一開始想要的目標。</p>
<p>如果梯形剖分也可以持久化？暫時還不想去思考，那思考的容器要多大呢？</p>
<h2 id="參考解法"><a href="#參考解法" class="headerlink" title="參考解法"></a>參考解法</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt; </span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Mesh</span> &#123;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>;</div><div class="line">    <span class="keyword">int</span> pt[MAXN][<span class="number">2</span>];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;pt[i][<span class="number">0</span>], &amp;pt[i][<span class="number">1</span>]);</div><div class="line">    &#125;</div><div class="line">&#125; mesh;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SplayTree</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">        Node *ch[<span class="number">2</span>], *fa;</div><div class="line">        <span class="keyword">int</span> size; <span class="keyword">int</span> data;</div><div class="line">        Node() &#123;</div><div class="line">            ch[<span class="number">0</span>] = ch[<span class="number">1</span>] = fa = <span class="literal">NULL</span>;</div><div class="line">            size = <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">is_root</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> fa-&gt;ch[<span class="number">0</span>] != <span class="keyword">this</span> &amp;&amp; fa-&gt;ch[<span class="number">1</span>] != <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    Node *root, *EMPTY;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(Node *u)</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (u-&gt;ch[<span class="number">0</span>] != EMPTY)	pushdown(u-&gt;ch[<span class="number">0</span>]);</div><div class="line">        <span class="keyword">if</span> (u-&gt;ch[<span class="number">1</span>] != EMPTY)	pushdown(u-&gt;ch[<span class="number">1</span>]);</div><div class="line">        u-&gt;size = <span class="number">1</span> + u-&gt;ch[<span class="number">0</span>]-&gt;size + u-&gt;ch[<span class="number">1</span>]-&gt;size;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setch</span><span class="params">(Node *p, Node *u, <span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (p != EMPTY)	p-&gt;ch[i] = u;</div><div class="line">        <span class="keyword">if</span> (u != EMPTY)	u-&gt;fa = p;</div><div class="line">    &#125;</div><div class="line">    SplayTree() &#123;</div><div class="line">        EMPTY = <span class="keyword">new</span> Node();</div><div class="line">        EMPTY-&gt;fa = EMPTY-&gt;ch[<span class="number">0</span>] = EMPTY-&gt;ch[<span class="number">1</span>] = EMPTY;</div><div class="line">        EMPTY-&gt;size = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        root = EMPTY;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</div><div class="line">        Node *u = <span class="keyword">new</span> Node();</div><div class="line">        u-&gt;fa = u-&gt;ch[<span class="number">0</span>] = u-&gt;ch[<span class="number">1</span>] = EMPTY;</div><div class="line">        <span class="keyword">return</span> u;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(Node *x)</span> </span>&#123;</div><div class="line">        Node *y;</div><div class="line">        <span class="keyword">int</span> d;</div><div class="line">        y = x-&gt;fa, d = y-&gt;ch[<span class="number">1</span>] == x ? <span class="number">1</span> : <span class="number">0</span>;</div><div class="line">        x-&gt;ch[d^<span class="number">1</span>]-&gt;fa = y, y-&gt;ch[d] = x-&gt;ch[d^<span class="number">1</span>];</div><div class="line">        x-&gt;ch[d^<span class="number">1</span>] = y;</div><div class="line">        <span class="keyword">if</span> (!y-&gt;is_root())</div><div class="line">            y-&gt;fa-&gt;ch[y-&gt;fa-&gt;ch[<span class="number">1</span>] == y] = x;</div><div class="line">        x-&gt;fa = y-&gt;fa, y-&gt;fa = x;</div><div class="line">        pushup(y);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deal</span><span class="params">(Node *x)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!x-&gt;is_root())	deal(x-&gt;fa);</div><div class="line">        pushdown(x);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(Node *x, Node *below)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (x == EMPTY)	<span class="keyword">return</span> ;</div><div class="line">        Node *y, *z;</div><div class="line">        deal(x);</div><div class="line">        <span class="keyword">while</span> (!x-&gt;is_root() &amp;&amp; x-&gt;fa != below) &#123;</div><div class="line">            y = x-&gt;fa, z = y-&gt;fa;</div><div class="line">            <span class="keyword">if</span> (!y-&gt;is_root() &amp;&amp; y-&gt;fa != below) &#123;</div><div class="line">                <span class="keyword">if</span> (y-&gt;ch[<span class="number">0</span>] == x ^ z-&gt;ch[<span class="number">0</span>] == y)</div><div class="line">                    rotate(x);</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    rotate(y);</div><div class="line">            &#125;</div><div class="line">            rotate(x);</div><div class="line">        &#125;</div><div class="line">        pushup(x);</div><div class="line">        <span class="keyword">if</span> (x-&gt;fa == EMPTY)	root = x;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">prevNode</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        splay(u, EMPTY);</div><div class="line">        <span class="keyword">return</span> maxNode(u-&gt;ch[<span class="number">0</span>]);</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">nextNode</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        splay(u, EMPTY);</div><div class="line">        <span class="keyword">return</span> minNode(u-&gt;ch[<span class="number">1</span>]);</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">minNode</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        Node *p = u-&gt;fa;</div><div class="line">        <span class="keyword">for</span> (; pushdown(u), u-&gt;ch[<span class="number">0</span>] != EMPTY; u = u-&gt;ch[<span class="number">0</span>]);</div><div class="line">        splay(u, p);</div><div class="line">        <span class="keyword">return</span> u;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">maxNode</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        Node *p = u-&gt;fa;</div><div class="line">        <span class="keyword">for</span> (; pushdown(u), u-&gt;ch[<span class="number">1</span>] != EMPTY; u = u-&gt;ch[<span class="number">1</span>]);</div><div class="line">        splay(u, p);</div><div class="line">        <span class="keyword">return</span> u;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">findPos</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123; <span class="comment">// [0...]</span></div><div class="line">        <span class="keyword">for</span> (Node *u = root; u != EMPTY;) &#123;</div><div class="line">            pushdown(u);</div><div class="line">            <span class="keyword">int</span> t = u-&gt;ch[<span class="number">0</span>]-&gt;size;</div><div class="line">            <span class="keyword">if</span> (t == pos) &#123;</div><div class="line">                splay(u, EMPTY);</div><div class="line">                <span class="keyword">return</span> u;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (t &gt; pos)</div><div class="line">                u = u-&gt;ch[<span class="number">0</span>];</div><div class="line">            <span class="keyword">else</span></div><div class="line">                u = u-&gt;ch[<span class="number">1</span>], pos -= t + <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> EMPTY;</div><div class="line">    &#125;</div><div class="line">    tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; insert(<span class="keyword">int</span> data, <span class="keyword">int</span> pos) &#123;	<span class="comment">// make [pos] = data</span></div><div class="line">        Node *p, *q = findPos(pos);</div><div class="line">        Node *x = newNode(); x-&gt;data = data;</div><div class="line">        <span class="keyword">if</span> (q == EMPTY) &#123;</div><div class="line">            p = maxNode(root), splay(p, EMPTY);</div><div class="line">            setch(x, p, <span class="number">0</span>);</div><div class="line">            splay(x, EMPTY);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            splay(q, EMPTY), p = q-&gt;ch[<span class="number">0</span>];</div><div class="line">            setch(x, p, <span class="number">0</span>), setch(x, q, <span class="number">1</span>);</div><div class="line">            setch(q, EMPTY, <span class="number">0</span>);</div><div class="line">            splay(q, EMPTY);</div><div class="line">            p = prevNode(x);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (p == EMPTY)	p = maxNode(root);</div><div class="line">        <span class="keyword">if</span> (q == EMPTY)	q = minNode(root);</div><div class="line">        <span class="keyword">return</span> make_tuple(p-&gt;data, data, q-&gt;data);</div><div class="line">    &#125;</div><div class="line">    tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; remove(<span class="keyword">int</span> pos) &#123;</div><div class="line">        Node *x = findPos(pos), *p, *q;</div><div class="line">        p = prevNode(x), q = nextNode(x);</div><div class="line">        <span class="keyword">if</span> (p != EMPTY &amp;&amp; q != EMPTY) &#123;</div><div class="line">            setch(p, q, <span class="number">1</span>);</div><div class="line">            p-&gt;fa = EMPTY, splay(q, EMPTY);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p != EMPTY) &#123;</div><div class="line">            p-&gt;fa = EMPTY, root = p;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            q-&gt;fa = EMPTY, root = q;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> del = x-&gt;data;</div><div class="line">        <span class="built_in">free</span>(x);</div><div class="line">        <span class="keyword">if</span> (p == EMPTY)	p = maxNode(root);</div><div class="line">        <span class="keyword">if</span> (q == EMPTY)	q = minNode(root);</div><div class="line">        <span class="keyword">return</span> make_tuple(p-&gt;data, del, q-&gt;data);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> root == EMPTY ? <span class="number">0</span> : root-&gt;size;</div><div class="line">    &#125;</div><div class="line">&#125; mlist;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">log2int</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">31</span> - __builtin_clz(x);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> int64_t <span class="title">h</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (<span class="keyword">int64_t</span>) mesh.pt[p][<span class="number">0</span>]*mesh.pt[q][<span class="number">1</span>] - (<span class="keyword">int64_t</span>) mesh.pt[p][<span class="number">1</span>]*mesh.pt[q][<span class="number">0</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">KDBRH</span> &#123;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">double</span> ALPHA = <span class="number">0.75</span>;</div><div class="line"><span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">double</span> LOG_ALPHA = log2(<span class="number">1.0</span> / ALPHA);</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Pt</span> &#123;</span></div><div class="line">        <span class="keyword">int</span> d[<span class="number">2</span>];</div><div class="line">        Pt() &#123;&#125;</div><div class="line">        Pt(<span class="keyword">int</span> xy[]):Pt(xy[<span class="number">0</span>], xy[<span class="number">1</span>]) &#123;&#125;</div><div class="line">        Pt(<span class="keyword">int</span> x, <span class="keyword">int</span> y) &#123;d[<span class="number">0</span>] = x, d[<span class="number">1</span>] = y;&#125;</div><div class="line">        <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> Pt &amp;x) <span class="keyword">const</span> &#123;</div><div class="line">            <span class="keyword">return</span> d[<span class="number">0</span>] == x.d[<span class="number">0</span>] &amp;&amp; d[<span class="number">1</span>] == x.d[<span class="number">1</span>];</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">static</span> Pt <span class="title">NaN</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> Pt(INT_MIN, INT_MIN);&#125;</div><div class="line">        <span class="function"><span class="keyword">int</span> <span class="title">isNaN</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> d[<span class="number">0</span>] == INT_MIN;&#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">PtP</span> &#123;</span></div><div class="line">        Pt p, q;</div><div class="line">        PtP(Pt p, Pt q): p(p), q(q) &#123;&#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">cmpAxis</span> &#123;</span></div><div class="line">        <span class="keyword">int</span> k;</div><div class="line">        cmpAxis(<span class="keyword">int</span> k): k(k) &#123;&#125;</div><div class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="keyword">const</span> PtP &amp;x, <span class="keyword">const</span> PtP &amp;y)</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> x.p.d[k] &lt; y.p.d[k];</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BBox</span> &#123;</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> KDMIN(a, b, c) &#123;a[0] = min(b[0], c[0]), a[1] = min(b[1], c[1]);&#125;</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> KDMAX(a, b, c) &#123;a[0] = max(b[0], c[0]), a[1] = max(b[1], c[1]);&#125;</span></div><div class="line">        <span class="keyword">int</span> l[<span class="number">2</span>], r[<span class="number">2</span>];</div><div class="line">        BBox() &#123;&#125;</div><div class="line">        BBox(<span class="keyword">int</span> a[], <span class="keyword">int</span> b[]) &#123;</div><div class="line">            KDMIN(l, a, b); KDMAX(r, a, b);</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">expand</span><span class="params">(Pt p)</span> </span>&#123;</div><div class="line">            KDMIN(l, l, p.d); KDMAX(r, r, p.d);</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">expand</span><span class="params">(BBox b)</span> </span>&#123;</div><div class="line">            KDMIN(l, l, b.l); KDMAX(r, r, b.r);</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">raycast</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> fx, <span class="keyword">double</span> y)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> l[<span class="number">1</span>] &lt;= y &amp;&amp; y &lt;= r[<span class="number">1</span>] &amp;&amp; r[<span class="number">0</span>] &gt;= x &amp;&amp; l[<span class="number">0</span>] &lt;= fx;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">static</span> BBox <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">            BBox b; b.l[<span class="number">0</span>] = b.l[<span class="number">1</span>] = INT_MAX, b.r[<span class="number">0</span>] = b.r[<span class="number">1</span>] = INT_MIN;</div><div class="line">            <span class="keyword">return</span> b;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">        Node *lson, *rson;</div><div class="line">        Pt pt, qt;</div><div class="line">        BBox box;</div><div class="line">        <span class="keyword">int</span> size; <span class="keyword">int8_t</span> used;</div><div class="line">        Node() &#123;&#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">            lson = rson = <span class="literal">NULL</span>;</div><div class="line">            size = <span class="number">1</span>, used = <span class="number">1</span>;</div><div class="line">            pt = qt = Pt::NaN();</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">hasBox</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> box.l[<span class="number">0</span>] &lt;= box.r[<span class="number">0</span>]; &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">()</span> </span>&#123;</div><div class="line">            size = used;</div><div class="line">            <span class="keyword">if</span> (lson)	size += lson-&gt;size;</div><div class="line">            <span class="keyword">if</span> (rson)	size += rson-&gt;size;</div><div class="line">            pushupBox();</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">pushupBox</span><span class="params">()</span> </span>&#123;</div><div class="line">            BBox t = BBox::init();</div><div class="line">            <span class="keyword">if</span> (!qt.isNaN())</div><div class="line">                t.expand(pt), t.expand(qt);</div><div class="line">            <span class="keyword">if</span> (lson &amp;&amp; lson-&gt;hasBox())</div><div class="line">                t.expand(lson-&gt;box);</div><div class="line">            <span class="keyword">if</span> (rson &amp;&amp; rson-&gt;hasBox())</div><div class="line">                t.expand(rson-&gt;box);</div><div class="line">            box = t;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">double</span> <span class="title">interpolate</span><span class="params">(<span class="keyword">double</span> y)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (pt.d[<span class="number">1</span>] == qt.d[<span class="number">1</span>])	<span class="keyword">return</span> pt.d[<span class="number">0</span>];</div><div class="line">            <span class="keyword">return</span> pt.d[<span class="number">0</span>] + (qt.d[<span class="number">0</span>] - pt.d[<span class="number">0</span>]) * (y - pt.d[<span class="number">1</span>]) / (qt.d[<span class="number">1</span>] - pt.d[<span class="number">1</span>]);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    Node *root;</div><div class="line">    <span class="built_in">vector</span>&lt;PtP&gt; A;</div><div class="line">    <span class="keyword">int64_t</span> area;</div><div class="line">    Node _mem[<span class="number">262144</span>];</div><div class="line">    <span class="keyword">int</span> gc[<span class="number">262144</span>], gci, memi;</div><div class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</div><div class="line">        Node *u = gci &gt;= <span class="number">0</span> ? &amp;_mem[gc[gci--]] : &amp;_mem[memi++];</div><div class="line">        u-&gt;init();</div><div class="line">        <span class="keyword">return</span> u;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">freeNode</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        gc[++gci] = u-_mem;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        root = <span class="literal">NULL</span>, area = <span class="number">0</span>;</div><div class="line">        gci = <span class="number">-1</span>, memi = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; e)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> p, q, r; tie(p, q, r) = e;</div><div class="line">        insert(root, <span class="number">0</span>, Pt(mesh.pt[q]), Pt(mesh.pt[p]), log2int(size()) / LOG_ALPHA);</div><div class="line">        changeNode(root, <span class="number">0</span>, Pt(mesh.pt[r]), Pt(mesh.pt[q]));</div><div class="line">        area += h(p, q) + h(q, r) - h(p, r);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; e)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> p, q, r; tie(p, q, r) = e;</div><div class="line">        remove(root, <span class="number">0</span>, Pt(mesh.pt[q]), log2int(size()) / LOG_ALPHA);</div><div class="line">        changeNode(root, <span class="number">0</span>, Pt(mesh.pt[r]), Pt(mesh.pt[p]));</div><div class="line">        area -= h(p, q) + h(q, r) - h(p, r);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> RAY_T;</div><div class="line">    <span class="keyword">double</span> RAY_X;</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt; X;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">inside</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (area == <span class="number">0</span>)	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        X.clear(), RAY_X = <span class="number">1e+12</span>, RAY_T = <span class="number">-1</span>;</div><div class="line">        raycast(root, x, y);</div><div class="line">        <span class="keyword">if</span> (RAY_T &lt; <span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> X.size()&amp;<span class="number">1</span>;</div><div class="line">        <span class="keyword">int</span> pass = (area &gt; <span class="number">0</span>) == RAY_T;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;x : X)</div><div class="line">            pass += x &lt;= RAY_X;</div><div class="line">        <span class="keyword">return</span> pass&amp;<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> root == <span class="literal">NULL</span> ? <span class="number">0</span> : root-&gt;size; &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">isbad</span><span class="params">(Node *u, Node *v)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (u == root)	<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">        <span class="keyword">int</span> l = v ? v-&gt;size : <span class="number">0</span>;</div><div class="line">        l = max(l, u-&gt;size-u-&gt;used-l);</div><div class="line">        <span class="keyword">return</span> l &gt; u-&gt;size * ALPHA;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">build</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (l &gt; r)	<span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">        <span class="keyword">int</span> mid = (l + r)&gt;&gt;<span class="number">1</span>;</div><div class="line">        Node *ret = newNode();</div><div class="line">        sort(A.begin()+l, A.begin()+r+<span class="number">1</span>, cmpAxis(k));</div><div class="line">        <span class="keyword">while</span> (mid &gt; l &amp;&amp; A[mid].p.d[k] == A[mid<span class="number">-1</span>].p.d[k])</div><div class="line">            mid--;</div><div class="line">        tie(ret-&gt;pt, ret-&gt;qt) = tie(A[mid].p, A[mid].q);</div><div class="line">        ret-&gt;lson = build(!k, l, mid<span class="number">-1</span>);</div><div class="line">        ret-&gt;rson = build(!k, mid+<span class="number">1</span>, r);</div><div class="line">        ret-&gt;pushup();</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">flatten</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!u)	<span class="keyword">return</span> ;</div><div class="line">        flatten(u-&gt;lson);</div><div class="line">        flatten(u-&gt;rson);</div><div class="line">        <span class="keyword">if</span> (u-&gt;used)	A.emplace_back(u-&gt;pt, u-&gt;qt);</div><div class="line">        freeNode(u);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">changeNode</span><span class="params">(Node *u, <span class="keyword">int</span> k, Pt x, Pt qt)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!u)	<span class="keyword">return</span>;</div><div class="line">        <span class="keyword">if</span> (x == u-&gt;pt) &#123;</div><div class="line">            u-&gt;qt = qt, u-&gt;pushupBox();</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        changeNode(x.d[k] &lt; u-&gt;pt.d[k] ? u-&gt;lson : u-&gt;rson, !k, x, qt);</div><div class="line">        u-&gt;pushupBox();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rebuild</span><span class="params">(Node* &amp;u, <span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">        A.clear(), A.reserve(u-&gt;size);</div><div class="line">        flatten(u);</div><div class="line">        u = build(k, <span class="number">0</span>, A.size()<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">insert</span><span class="params">(Node* &amp;u, <span class="keyword">int</span> k, Pt x, Pt y, <span class="keyword">int</span> d)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!u) &#123;</div><div class="line">            u = newNode(), u-&gt;pt = x, u-&gt;qt = y, u-&gt;pushup();</div><div class="line">            <span class="keyword">return</span> d &lt;= <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (x == u-&gt;pt) &#123;</div><div class="line">            u-&gt;used = <span class="number">1</span>, u-&gt;qt = y, u-&gt;pushup();</div><div class="line">            <span class="keyword">return</span> d &lt;= <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">auto</span> &amp;v = x.d[k] &lt; u-&gt;pt.d[k] ? u-&gt;lson : u-&gt;rson;</div><div class="line">        <span class="keyword">int</span> t = insert(v, !k, x, y, d<span class="number">-1</span>);</div><div class="line">        u-&gt;pushup();</div><div class="line">        <span class="keyword">if</span> (t &amp;&amp; !isbad(u, v))</div><div class="line">            <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (t)	rebuild(u, k);</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">remove</span><span class="params">(Node* &amp;u, <span class="keyword">int</span> k, Pt x, <span class="keyword">int</span> d)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!u)</div><div class="line">            <span class="keyword">return</span> d &lt;= <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span> (x == u-&gt;pt) &#123;</div><div class="line">            <span class="keyword">if</span> (u-&gt;lson || u-&gt;rson)</div><div class="line">                u-&gt;used = <span class="number">0</span>, u-&gt;qt = Pt::NaN(), u-&gt;pushup();</div><div class="line">            <span class="keyword">else</span></div><div class="line">                freeNode(u), u = <span class="literal">NULL</span>;</div><div class="line">            <span class="keyword">return</span> d &lt;= <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">auto</span> &amp;v = x.d[k] &lt; u-&gt;pt.d[k] ? u-&gt;lson : u-&gt;rson;</div><div class="line">        <span class="keyword">int</span> t = remove(v, !k, x, d<span class="number">-1</span>);</div><div class="line">        u-&gt;pushup();</div><div class="line">        <span class="keyword">if</span> (t &amp;&amp; !isbad(u, v))</div><div class="line">            <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (t)	rebuild(u, k);</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">cast</span><span class="params">(Node *u, <span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (u-&gt;qt.isNaN() || (u-&gt;pt.d[<span class="number">1</span>] &gt; y) == (u-&gt;qt.d[<span class="number">1</span>] &gt; y))</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        <span class="keyword">double</span> tx = u-&gt;interpolate(y);</div><div class="line">        <span class="keyword">if</span> (tx &lt;= x || tx &gt; RAY_X)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        RAY_X = tx, RAY_T = u-&gt;pt.d[<span class="number">1</span>] &lt; u-&gt;qt.d[<span class="number">1</span>];</div><div class="line">        X.emplace_back(tx);</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    Node* stk[<span class="number">128</span>];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">raycast</span><span class="params">(Node *u, <span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> </span>&#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> pushstk(u) &#123;*p++ = u;&#125;</span></div><div class="line">        Node **p = stk;</div><div class="line">        pushstk(u);</div><div class="line">        <span class="keyword">while</span> (p &gt; stk) &#123;</div><div class="line">            u = *--p;</div><div class="line">            <span class="keyword">if</span> (!u || !u-&gt;size || !u-&gt;box.raycast(x, RAY_X, y))</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            cast(u, x, y);</div><div class="line">            pushstk(u-&gt;rson);</div><div class="line">            pushstk(u-&gt;lson);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125; mbrh;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n, m, cmd, x, pos;</div><div class="line">    <span class="keyword">double</span> px, py;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;n, &amp;m);</div><div class="line">    mesh.read(n);</div><div class="line">    mlist.init(), mbrh.init();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;cmd);</div><div class="line">        <span class="keyword">if</span> (cmd == <span class="number">1</span>) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;x, &amp;pos);</div><div class="line">            mbrh.insert(mlist.insert(x, pos));</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">2</span>) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x);</div><div class="line">            mbrh.remove(mlist.remove(x));</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%lf %lf"</span>, &amp;px, &amp;py);</div><div class="line">            <span class="built_in">puts</span>(mbrh.inside(px, py) ? <span class="string">"1"</span> : <span class="string">"0"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-mproblem-dynamic-tree" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/26/mproblem-dynamic-tree/" class="article-date">
  <time datetime="2019-01-26T12:07:42.000Z" itemprop="datePublished">2019-01-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/出題解題/">出題解題</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/26/mproblem-dynamic-tree/">動態樹 樹形避難所</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2019/01/26/mproblem-dynamic-tree/" data-id="ckvd6e85300av9cvn1aouh2ry" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2019/01/26/mproblem-dynamic-tree/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LCT/">LCT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Link-Cut-Tree/">Link/Cut Tree</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <blockquote>
<p>題目描述請至 Zerojudge e003: 樹形避難所 I、e004: 樹形避難所 II 查閱詳細內容</p>
</blockquote>
<h2 id="樹形避難所-I"><a href="#樹形避難所-I" class="headerlink" title="樹形避難所 I"></a>樹形避難所 I</h2><p>在一個樹形避難所中有 $N$ 個房間，待在充滿監視器房間的你，透過監視器的顯示發現存在一些未知的入侵者出現在某些房間。為了保護同伴，你可以選擇開啟或關閉房間之間的通道，而你也會收到來自於某個房間的同伴求救訊號，此時給予所有可能遇見的入侵者數量，以便同伴做好萬全的作戰準備。然而，操縱通道的控制器已不受限制，你只能眼睜睜地看著同伴與入侵者對抗，現在的你 … 做好準備了嗎？</p>
<ul>
<li>操作 1 <span>$u$</span><!-- Has MathJax --> <span>$v$</span><!-- Has MathJax -->：將房間 <span>$u$</span><!-- Has MathJax --> 與 <span>$v$</span><!-- Has MathJax --> 的通道開啟</li>
<li>操作 2 <span>$u$</span><!-- Has MathJax --> <span>$v$</span><!-- Has MathJax -->：將房間 <span>$u$</span><!-- Has MathJax --> 與 <span>$v$</span><!-- Has MathJax --> 的通道關閉</li>
<li>操作 3 <span>$u$</span><!-- Has MathJax --> <span>$w$</span><!-- Has MathJax -->：更正房間 <span>$u$</span><!-- Has MathJax --> 為 <span>$w$</span><!-- Has MathJax --> 個入侵者</li>
<li>操作 4 <span>$u$</span><!-- Has MathJax -->：回答來自 <span>$u$</span><!-- Has MathJax --> 的求救信號，告知與其可能面臨到的入侵者個數</li>
</ul>
<h2 id="樹形避難所-II"><a href="#樹形避難所-II" class="headerlink" title="樹形避難所 II"></a>樹形避難所 II</h2><p>由於上一個樹形避難所已經不再安全，全員轉移到下一個避難所，新的地方將不再是先前的平面構造，新的避難所建構在地下水層中，每一個房間可以在水中移動，並且打通到上一層的某一個房間。不幸地，新的入侵者更加地難纏，想保護大家的你，想藉由破壞某一個房間，將其相連的下層房間的入侵者一同殲滅，情局不斷地變化，哪一個才是最好的破壞手段呢 …</p>
<ul>
<li>操作 1 <span>$u$</span><!-- Has MathJax --> <span>$v$</span><!-- Has MathJax -->：將房間 <span>$u$</span><!-- Has MathJax --> 與上層房間 <span>$v$</span><!-- Has MathJax --> 的通道開啟</li>
<li>操作 2 <span>$u$</span><!-- Has MathJax -->：關閉房間 <span>$u$</span><!-- Has MathJax --> 與上層的通道</li>
<li>操作 3 <span>$u$</span><!-- Has MathJax --> <span>$w$</span><!-- Has MathJax -->：更正房間 <span>$u$</span><!-- Has MathJax --> 為 <span>$w$</span><!-- Has MathJax --> 個入侵者</li>
<li>操作 4 <span>$u$</span><!-- Has MathJax -->：估算摧毀房間 <span>$u$</span><!-- Has MathJax -->，可以殲滅的入侵者個數</li>
</ul>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>這一題對於樹的操作，牽涉到修改邊，修改點權，詢問整個連通的樹大小、以及子樹大小。可以考慮使用 Link/Cut Tree 完成。也有高手使用了離線算法，對操作分治後計算答案，將一個邊的存在時間記錄在某個時間戳記上，整體落在 <span>$\mathcal{O}(M \log M)$</span><!-- Has MathJax -->，由上而下合併所有存在的邊來完成單一詢問，需要搭配啟發式合併，來指查找根造成的退化，這一點相當地聰明。若強制在線，仍需要使用動態樹完成之。</p>
<p>對於第一題，只有包含前三個操作，可以當作一個無根樹操作，因此在 LCT 中的 <span>$\text{MakeRoot}$</span><!-- Has MathJax --> 打上反轉標記，無視原本的父子關係，額外維護一個虛邊上的子樹大小，如此一來就可以計算整個子樹大小。其餘的點權修改就相較於容易許多。對於第二題，便要求有根樹，因此在轉到根節點時，不能打上反轉標記，此時的左子樹為父節點，扣除掉父節點的大小後，便可以得到子樹大小。</p>
<ul>
<li>動態樹解法：空間複雜度 <span>$\mathcal{O}(N)$</span><!-- Has MathJax -->，操作複雜度 <span>$\text{Amortized} \; \mathcal{O}(\log N)$</span><!-- Has MathJax --></li>
<li>離線解法：空間複雜度 <span>$\mathcal{O}(M \log M)$</span><!-- Has MathJax -->，整體時間複雜度 <span>$\mathcal{O}(M \log M)$</span><!-- Has MathJax --></li>
</ul>
<h2 id="延伸問題"><a href="#延伸問題" class="headerlink" title="延伸問題"></a>延伸問題</h2><p>如果子樹存在等價關係，意即他們會被一個操作同時受到影響，那麼更新會退化嗎？</p>
<p>如果這個問題能被解決，那麼使用相同的概念，便能解決更多的高壓縮架構問題。工作就能輕鬆一些了。</p>
<h2 id="參考解答"><a href="#參考解答" class="headerlink" title="參考解答"></a>參考解答</h2><h3 id="樹形避難所-I-1"><a href="#樹形避難所-I-1" class="headerlink" title="樹形避難所 I"></a>樹形避難所 I</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line">  </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LCT</span> &#123;</span> <span class="comment">// Link-Cut Tree</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">30005</span>;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>;</span></div><div class="line">    <span class="keyword">static</span> Node *EMPTY;</div><div class="line">    <span class="keyword">static</span> Node _mem[MAXN];</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> bufIdx;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">        Node *ch[<span class="number">2</span>], *fa;</div><div class="line">        <span class="keyword">int</span> rev;</div><div class="line">        <span class="keyword">int</span> vsize, size, val;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">            ch[<span class="number">0</span>] = ch[<span class="number">1</span>] = fa = <span class="literal">NULL</span>;</div><div class="line">            size = <span class="number">0</span>, vsize = <span class="number">0</span>, rev = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">is_root</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> fa-&gt;ch[<span class="number">0</span>] != <span class="keyword">this</span> &amp;&amp; fa-&gt;ch[<span class="number">1</span>] != <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">()</span> </span>&#123;</div><div class="line">        	<span class="keyword">if</span> (rev) &#123;</div><div class="line">        		ch[<span class="number">0</span>]-&gt;rev ^= <span class="number">1</span>;</div><div class="line">                ch[<span class="number">1</span>]-&gt;rev ^= <span class="number">1</span>;</div><div class="line">        		swap(ch[<span class="number">0</span>], ch[<span class="number">1</span>]);</div><div class="line">        		rev = <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">()</span> </span>&#123;</div><div class="line">        	<span class="keyword">if</span> (<span class="keyword">this</span> == EMPTY)</div><div class="line">        		<span class="keyword">return</span>;</div><div class="line">        	size = ch[<span class="number">0</span>]-&gt;size + ch[<span class="number">1</span>]-&gt;size + val + vsize;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    LCT() &#123;</div><div class="line">        EMPTY = &amp;_mem[<span class="number">0</span>];</div><div class="line">        EMPTY-&gt;fa = EMPTY-&gt;ch[<span class="number">0</span>] = EMPTY-&gt;ch[<span class="number">1</span>] = EMPTY;</div><div class="line">        EMPTY-&gt;size = <span class="number">0</span>;</div><div class="line">        bufIdx = <span class="number">1</span>; </div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        bufIdx = <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</div><div class="line">        Node *u = &amp;_mem[bufIdx++];</div><div class="line">        u-&gt;init();</div><div class="line">        u-&gt;fa = u-&gt;ch[<span class="number">0</span>] = u-&gt;ch[<span class="number">1</span>] = EMPTY;</div><div class="line">        <span class="keyword">return</span> u;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(Node *x)</span> </span>&#123;</div><div class="line">        Node *y;</div><div class="line">        <span class="keyword">int</span> d;</div><div class="line">        y = x-&gt;fa, d = y-&gt;ch[<span class="number">1</span>] == x ? <span class="number">1</span> : <span class="number">0</span>;</div><div class="line">        x-&gt;ch[d^<span class="number">1</span>]-&gt;fa = y, y-&gt;ch[d] = x-&gt;ch[d^<span class="number">1</span>];</div><div class="line">        x-&gt;ch[d^<span class="number">1</span>] = y;</div><div class="line">        <span class="keyword">if</span> (!y-&gt;is_root())</div><div class="line">            y-&gt;fa-&gt;ch[y-&gt;fa-&gt;ch[<span class="number">1</span>] == y] = x;</div><div class="line">        x-&gt;fa = y-&gt;fa, y-&gt;fa = x;</div><div class="line">        y-&gt;pushup(), x-&gt;pushup();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deal</span><span class="params">(Node *x)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!x-&gt;is_root())   deal(x-&gt;fa);</div><div class="line">        x-&gt;pushdown();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(Node *x)</span> </span>&#123;</div><div class="line">        Node *y, *z;</div><div class="line">        deal(x);</div><div class="line">        <span class="keyword">while</span> (!x-&gt;is_root()) &#123;</div><div class="line">            y = x-&gt;fa, z = y-&gt;fa;</div><div class="line">            <span class="keyword">if</span> (!y-&gt;is_root()) &#123;</div><div class="line">                <span class="keyword">if</span> (y-&gt;ch[<span class="number">0</span>] == x ^ z-&gt;ch[<span class="number">0</span>] == y)</div><div class="line">                    rotate(x);</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    rotate(y);</div><div class="line">            &#125;</div><div class="line">            rotate(x);</div><div class="line">        &#125;</div><div class="line">        x-&gt;pushdown();</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">access</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        Node *v = EMPTY;</div><div class="line">        <span class="keyword">for</span> (; u != EMPTY; u = u-&gt;fa) &#123;</div><div class="line">            splay(u);</div><div class="line">            u-&gt;vsize += u-&gt;ch[<span class="number">1</span>] != EMPTY ? u-&gt;ch[<span class="number">1</span>]-&gt;size : <span class="number">0</span>;</div><div class="line">            u-&gt;vsize -= v != EMPTY ? v-&gt;size : <span class="number">0</span>;</div><div class="line">            u-&gt;ch[<span class="number">1</span>] = v;</div><div class="line">            u-&gt;pushup();</div><div class="line">            v = u;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> v;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">mk_root</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        access(u)-&gt;rev ^= <span class="number">1</span>, splay(u);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">cut</span><span class="params">(Node *x, Node *y)</span> </span>&#123;</div><div class="line">    	mk_root(x);</div><div class="line">    	access(y), splay(y);</div><div class="line"><span class="comment">//    	debug(10);</span></div><div class="line">    	assert(y-&gt;ch[<span class="number">0</span>] == x);</div><div class="line">        y-&gt;ch[<span class="number">0</span>] = x-&gt;fa = EMPTY;</div><div class="line">        y-&gt;pushup();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">link</span><span class="params">(Node *x, Node *y)</span> </span>&#123;</div><div class="line">    	mk_root(y);</div><div class="line">    	access(x), splay(x);</div><div class="line">        y-&gt;fa = x;</div><div class="line">        x-&gt;vsize += y-&gt;size;</div><div class="line">        x-&gt;pushup();</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">find</span><span class="params">(Node *x)</span> </span>&#123;</div><div class="line">        access(x), splay(x);</div><div class="line">        <span class="keyword">for</span> (; x-&gt;ch[<span class="number">0</span>] != EMPTY; x = x-&gt;ch[<span class="number">0</span>]);</div><div class="line">        <span class="keyword">return</span> x;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(Node *x, <span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">    	mk_root(x);</div><div class="line">    	x-&gt;val = val;</div><div class="line">    	x-&gt;pushup();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">    	mk_root(u);</div><div class="line">    	<span class="keyword">return</span> u-&gt;size;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">same</span><span class="params">(Node *x, Node *y)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> find(x) == find(y);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">        <span class="built_in">puts</span>(<span class="string">"=================="</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">            Node *u = &amp;_mem[i];</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"[%d] %d, %d %d, %d %d %d\n"</span>, i, u-&gt;fa-_mem, u-&gt;ch[<span class="number">0</span>]-_mem, u-&gt;ch[<span class="number">1</span>]-_mem, u-&gt;size, u-&gt;vsize, u-&gt;val);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125; lct;</div><div class="line">LCT::Node *LCT::EMPTY, LCT::_mem[LCT::MAXN];</div><div class="line"><span class="keyword">int</span> LCT::bufIdx;</div><div class="line">LCT::Node *node[LCT::MAXN];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n, m;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;n, &amp;m) == <span class="number">2</span>) &#123;</div><div class="line">        lct.init();</div><div class="line">        <span class="keyword">int</span> cmd, u, v, w;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;w);</div><div class="line">            node[i] = lct.newNode();</div><div class="line">            lct.<span class="built_in">set</span>(node[i], w);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;cmd);</div><div class="line">            <span class="keyword">if</span> (cmd == <span class="number">1</span>) &#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;u, &amp;v);</div><div class="line">                lct.link(node[u], node[v]);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">2</span>) &#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;u, &amp;v);</div><div class="line">                lct.cut(node[u], node[v]);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">3</span>) &#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;u, &amp;w);</div><div class="line">                lct.<span class="built_in">set</span>(node[u], w);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">4</span>) &#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;u);</div><div class="line">                <span class="keyword">int</span> p = lct.get(node[u]);</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, p);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;u, &amp;v);</div><div class="line">                <span class="keyword">int</span> f = lct.same(node[u], node[v]);</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, f);</div><div class="line">            &#125;</div><div class="line">            lct.debug(<span class="number">10</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="樹形避難所-II-1"><a href="#樹形避難所-II-1" class="headerlink" title="樹形避難所 II"></a>樹形避難所 II</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line">  </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LCT</span> &#123;</span> <span class="comment">// Link-Cut Tree</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">30005</span>;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>;</span></div><div class="line">    <span class="keyword">static</span> Node *EMPTY;</div><div class="line">    <span class="keyword">static</span> Node _mem[MAXN];</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> bufIdx;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">        Node *ch[<span class="number">2</span>], *fa;</div><div class="line">        <span class="keyword">int</span> vsize, size, val;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">            ch[<span class="number">0</span>] = ch[<span class="number">1</span>] = fa = <span class="literal">NULL</span>;</div><div class="line">            size = <span class="number">0</span>, vsize = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">is_root</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> fa-&gt;ch[<span class="number">0</span>] != <span class="keyword">this</span> &amp;&amp; fa-&gt;ch[<span class="number">1</span>] != <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">()</span> </span>&#123;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">()</span> </span>&#123;</div><div class="line">        	<span class="keyword">if</span> (<span class="keyword">this</span> == EMPTY)</div><div class="line">        		<span class="keyword">return</span>;</div><div class="line">        	size = ch[<span class="number">0</span>]-&gt;size + ch[<span class="number">1</span>]-&gt;size + val + vsize;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    LCT() &#123;</div><div class="line">        EMPTY = &amp;_mem[<span class="number">0</span>];</div><div class="line">        EMPTY-&gt;fa = EMPTY-&gt;ch[<span class="number">0</span>] = EMPTY-&gt;ch[<span class="number">1</span>] = EMPTY;</div><div class="line">        EMPTY-&gt;size = <span class="number">0</span>;</div><div class="line">        bufIdx = <span class="number">1</span>; </div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        bufIdx = <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</div><div class="line">        Node *u = &amp;_mem[bufIdx++];</div><div class="line">        u-&gt;init();</div><div class="line">        u-&gt;fa = u-&gt;ch[<span class="number">0</span>] = u-&gt;ch[<span class="number">1</span>] = EMPTY;</div><div class="line">        <span class="keyword">return</span> u;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(Node *x)</span> </span>&#123;</div><div class="line">        Node *y;</div><div class="line">        <span class="keyword">int</span> d;</div><div class="line">        y = x-&gt;fa, d = y-&gt;ch[<span class="number">1</span>] == x ? <span class="number">1</span> : <span class="number">0</span>;</div><div class="line">        x-&gt;ch[d^<span class="number">1</span>]-&gt;fa = y, y-&gt;ch[d] = x-&gt;ch[d^<span class="number">1</span>];</div><div class="line">        x-&gt;ch[d^<span class="number">1</span>] = y;</div><div class="line">        <span class="keyword">if</span> (!y-&gt;is_root())</div><div class="line">            y-&gt;fa-&gt;ch[y-&gt;fa-&gt;ch[<span class="number">1</span>] == y] = x;</div><div class="line">        x-&gt;fa = y-&gt;fa, y-&gt;fa = x;</div><div class="line">        y-&gt;pushup(), x-&gt;pushup();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deal</span><span class="params">(Node *x)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!x-&gt;is_root())   deal(x-&gt;fa);</div><div class="line">        x-&gt;pushdown();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(Node *x)</span> </span>&#123;</div><div class="line">        Node *y, *z;</div><div class="line">        deal(x);</div><div class="line">        <span class="keyword">while</span> (!x-&gt;is_root()) &#123;</div><div class="line">            y = x-&gt;fa, z = y-&gt;fa;</div><div class="line">            <span class="keyword">if</span> (!y-&gt;is_root()) &#123;</div><div class="line">                <span class="keyword">if</span> (y-&gt;ch[<span class="number">0</span>] == x ^ z-&gt;ch[<span class="number">0</span>] == y)</div><div class="line">                    rotate(x);</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    rotate(y);</div><div class="line">            &#125;</div><div class="line">            rotate(x);</div><div class="line">        &#125;</div><div class="line">        x-&gt;pushdown();</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">access</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        Node *v = EMPTY;</div><div class="line">        <span class="keyword">for</span> (; u != EMPTY; u = u-&gt;fa) &#123;</div><div class="line">            splay(u);</div><div class="line">            u-&gt;vsize += u-&gt;ch[<span class="number">1</span>] != EMPTY ? u-&gt;ch[<span class="number">1</span>]-&gt;size : <span class="number">0</span>;</div><div class="line">            u-&gt;vsize -= v != EMPTY ? v-&gt;size : <span class="number">0</span>;</div><div class="line">            u-&gt;ch[<span class="number">1</span>] = v;</div><div class="line">            u-&gt;pushup();</div><div class="line">            v = u;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> v;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">mk_root</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        access(u), splay(u);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">cut</span><span class="params">(Node *x)</span> </span>&#123;</div><div class="line">    	access(x), splay(x);</div><div class="line">    	x-&gt;ch[<span class="number">0</span>]-&gt;fa = EMPTY;</div><div class="line">        x-&gt;ch[<span class="number">0</span>] = EMPTY;</div><div class="line">        x-&gt;pushup();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">link</span><span class="params">(Node *x, Node *y)</span> </span>&#123;</div><div class="line">    	access(x), splay(x);</div><div class="line">    	access(y), splay(y);</div><div class="line">        x-&gt;fa = y;</div><div class="line">        y-&gt;vsize += x-&gt;size;</div><div class="line">        y-&gt;pushup();</div><div class="line">    &#125;</div><div class="line">    <span class="function">Node* <span class="title">find</span><span class="params">(Node *x)</span> </span>&#123;</div><div class="line">        access(x), splay(x);</div><div class="line">        <span class="keyword">for</span> (; x-&gt;ch[<span class="number">0</span>] != EMPTY; x = x-&gt;ch[<span class="number">0</span>]);</div><div class="line">        <span class="keyword">return</span> x;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(Node *x, <span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">    	mk_root(x);</div><div class="line">    	x-&gt;val = val;</div><div class="line">    	x-&gt;pushup();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">    	mk_root(u);</div><div class="line">    	<span class="keyword">int</span> ret = u-&gt;size;</div><div class="line">    	<span class="keyword">if</span> (u-&gt;ch[<span class="number">0</span>] != EMPTY)</div><div class="line">    		ret -= u-&gt;ch[<span class="number">0</span>]-&gt;size;</div><div class="line">    	<span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">same</span><span class="params">(Node *x, Node *y)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> find(x) == find(y);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">        <span class="built_in">puts</span>(<span class="string">"=================="</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">            Node *u = &amp;_mem[i];</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"[%d] %d, %d %d, %d %d %d\n"</span>, i, u-&gt;fa-_mem, u-&gt;ch[<span class="number">0</span>]-_mem, u-&gt;ch[<span class="number">1</span>]-_mem, u-&gt;size, u-&gt;vsize, u-&gt;val);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125; lct;</div><div class="line">LCT::Node *LCT::EMPTY, LCT::_mem[LCT::MAXN];</div><div class="line"><span class="keyword">int</span> LCT::bufIdx;</div><div class="line"></div><div class="line">    LCT::Node *node[LCT::MAXN];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n, m;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;n, &amp;m) == <span class="number">2</span>) &#123;</div><div class="line">        lct.init();</div><div class="line">        <span class="keyword">int</span> cmd, u, v, w;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;w);</div><div class="line">            node[i] = lct.newNode();</div><div class="line">            lct.<span class="built_in">set</span>(node[i], w);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;cmd);</div><div class="line">            <span class="keyword">if</span> (cmd == <span class="number">1</span>) &#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;u, &amp;v);</div><div class="line">                lct.link(node[u], node[v]);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">2</span>) &#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;u);</div><div class="line">                lct.cut(node[u]);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">3</span>) &#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;u, &amp;w);</div><div class="line">                lct.<span class="built_in">set</span>(node[u], w);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">4</span>) &#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;u);</div><div class="line">                <span class="keyword">int</span> p = lct.get(node[u]);</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, p);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;u, &amp;v);</div><div class="line">                <span class="keyword">int</span> f = lct.same(node[u], node[v]);</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, f);</div><div class="line">            &#125;</div><div class="line">            lct.debug(<span class="number">4</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-diary-201811" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/25/diary-201811/" class="article-date">
  <time datetime="2018-11-24T22:53:05.000Z" itemprop="datePublished">2018-11-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="https://i.imgur.com/rP2LtTm.jpg" rel="gallery_ckvd6e82k00449cvn0ju4xtpa">
        <img src="https://i.imgur.com/rP2LtTm.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/25/diary-201811/">波士頓出差 Cadence, Boston</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2018/11/25/diary-201811/" data-id="ckvd6e82k00449cvn0ju4xtpa" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2018/11/25/diary-201811/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="旅程前言"><a href="#旅程前言" class="headerlink" title="旅程前言"></a>旅程前言</h2><p>在碩二實習的時候，有碰到一次到美國波士頓出差的機會，有礙於那時候還是實習且研究生的身分，並沒有與團隊一起去。要是出國消失一周的話，指導教授大概會震怒吧，說不定就沒機會出現在 Cadence。</p>
<p>在 2016 那時，台灣的團隊才成立約一年，所以旅程的目的在於去學習，基本上就是產品架構的設計細節與概念、產品開發的流程。即使跟著去那兒，英文聽說都很糟糕的我，也只能看著投影片發呆吧。在這兩年中，團隊從四個人到七個人的成長，產品開發的控制越來越多到台灣團隊手上。因此，此行目的便不再是學習，要探討未來的發展和一些議題。</p>
<p>在出發之前，整理近幾個月的開發議題，手上有兩個舊有產品 OrbitIO 和 Allegro，修改了大幅度的效能問題，但舊有設計架構問題導致一些加速算法無法相容，光是想著這些設計問題，就不知道要怎麼與那邊的團隊討論，這些都是改動十幾年前的設計，我想代碼大多都朝著只增不減的方向邁進，這些問題很少人願意去著手，要去改那些需要十足的勇氣。然後，莫名其妙被加入了  Mission BraveHeart (<strong>任務代號：勇敢的心</strong>)，成功便成英雄。</p>
<p>另一個新產品的開發便是這次出發的壓軸，其內容跟公司的 EDM (Engineering Data Management) 產品有著異曲同工之妙，這困擾了我好幾個月，其概念就是強化版的批改娘，最大的不同在於多人協作的平台，要如何做得簡單好用「<strong>Simple is Better Than Complex</strong>」。</p>
<p><img src="https://i.imgur.com/vcOrnbq.jpg" alt="「我要做些什麼」－《昴宿七星》"></p>
<p>新產品的開發耗時將近一年，途中不斷地有新的工作要做，所以在好幾個產品跳來跳去。在 Java, C, Python, Javascript, HTML 跳來跳去，精神都快要達到臨界點。由於需求調整，一路上重新構造了好幾次架構，不斷地懷疑自己到底能不能把這個產品拉出來。由於公司與 DARPA (Defense Advanced Research Projects Agency, 國防高等研究計劃署)<br>的合作計畫，加速了這一個產品開發，在九月多時輪廓總算釐清了，目標在一個多月內把產品最低需求完成。</p>
<p>很多 EDA Tools 都經歷了好幾年的開發，如 OrbitIO 和 Allegro 更是幾十年的產品，支線需求直接在平台上開發比較沒什麼壓力。這次則要完全跳離所有依賴關係，團隊成員中沒有系統架構的經驗，而我這種半吊子只寫過一點點的網站，一點點的系統，一次就要走這麼遠，壓力不容小覷，這一段日子裡都不怎麼好睡。</p>
<p><img src="https://i.imgur.com/bJvPU50.jpg" alt="「感覺我好像越來越不行了」－《青春豬頭少年不會夢到兔女郎學姊》"></p>
<p>隔了一個多月，我們做到了嗎？做到哪裡？</p>
<p>開發過程中一直想找人來幫忙，面了一些高手，但面試的標準無從根據，導致錄取的進展不斷延後，於是先下定決心自己來吧，網頁後台各種從零開始，著手架構好的後台與前端網頁，試圖完成像 Github 與 git 這等偉大的目標。急急忙忙地切分模組出來給小夥伴開發，過程中又不斷地與其他成員說明系統的架構朝什麼發展，甚至一連開了整天的會議說明方向。</p>
<p>出發前一周仍然在調整各個模組的名稱，好讓介紹時快速切入要領。不得不佩服同事們的合作，介紹這方面的能力從以前開始都倚靠著別人，終於準備好上路了。</p>
<p><img src="https://i.imgur.com/MDmP4or.jpg" alt="「這個世界，沒有我的容身之地」－《異世界魔王與召喚少女的奴隸魔術》"></p>
<h2 id="啟程須知"><a href="#啟程須知" class="headerlink" title="啟程須知"></a>啟程須知</h2><p>給第二次出國的我 (第一次出國在泰國比賽)</p>
<p>礙於研發替代役的角色，出發前到外交部領事事務局申辦護照，不再是以前的三年版本，一次到手十年期限的護照。除了要額外帶著役男身分證外，其餘項目皆與一般申請護照無異，只需要一周的工作天，便可以領取護照。接著拿到新的護照，便向公司的 HR 發出出差申請，附上護照明細與旅途時間，通過後大約在一天左右，就可以從役政署的研發替代役網站列印許可通知書。接著，入境美國申請 ESTA，線上填妥細節繳費，列印好拿著這些就可以入境美國。</p>
<p>若需要國外駕車，可額外申請國際駕照，直接拿汽車駕照去監理站換發就好。不過國外租車的額外駕駛需要額外的保險，加一個額外駕駛就額外多一個費用，原則上對於我這種新手，最後沒有用到。</p>
<p>十一月初的波士頓到了將近攝氏零度的氣候，這一次旅程長達十四天，差不多要帶個六天的衣物，由於這麼冷的天氣基本上也不太需要太多外衣，內衣之類的還是需要帶多一點，直接在旅館內乾洗晾乾就好，大部分時間都有暖氣，所以只需要帶一件足夠厚的外套就行，也因為暖氣會不斷地除溼，保濕乳液之類的必須帶好。這次旅程意外地發現自己並不太怕冷，帶太多衣服穿不到，感覺有點傻了，毛襪不帶也沒關係，穿了反而不帶適應走路的步伐而不舒服。圍巾、手套帶著比較好，一下雪整個寒意就透過去。</p>
<h2 id="波士頓之旅"><a href="#波士頓之旅" class="headerlink" title="波士頓之旅"></a>波士頓之旅</h2><p>做了近 20 小時的飛機，終於到了美國波士頓，公司在比較偏遠的郊區 Chelmsford，隔天我們便到波士頓市中心附近的 MIT 和 Harvard 參觀，這時間點在感恩節前兩周，又正值假日，基本上都沒什麼學生。看著別人的生活環境，冷到一個很不舒服的季節。</p>
<p><img src="https://i.imgur.com/YEClMNn.jpg" alt="MIT"></p>
<p>在市中心晃了好一陣子，傍晚才前往到哈佛大學，然後開始排隊與那個金鞋合照。</p>
<p><img src="https://i.imgur.com/kea69zk.jpg" alt="Harvard University"></p>
<p>工作的第一天，聽著不太明白的產品與客戶發展介紹，第一次與 email 對面的人碰面聊天，上頭的上頭們全都來了，勉勉強強用殘破的英文亂說一通，還好有同事罩著，後面講的介紹一句也不懂，只能東猜猜西猜猜，猜出個什麼來再應付。下午便在討論「勇敢的心」細節，原則上是一個複雜度很難壓低的幾何計算，咱什麼時候變成幾何計算的顧問了？我其實也不算懂啊。</p>
<p>工作的第二天，兵分兩路被拆開到各自的主攻產品討論議題，陸陸續續邀請不同議題的相關成員會面，個人覺得是相當大的陣仗，區區的 Morris 開的議題邀了好幾個不同團隊的成員。由當地的同事主持會議，大多的時間都在聽他們討論，只花了幾分鐘介紹問題的原因、要解決的問題、可能的解決方向，為何需要這麼做？接著的應答就靠神一般同事翻譯。嗚嗚，<strong>我好沒用</strong>。晚上的時候，波士頓的第一場雪來了。</p>
<p><img src="https://i.imgur.com/NeSBcKB.jpg" alt="First Snow in Chelmsford"></p>
<p>工作的第三天，新產品決鬥的開始，Made in Taiwan 的武力展示，相當沒有信心去展示那些成果，大部分的架構還不確定能不能發展到那樣子，語言的特性決定發展能力，簡單、好用是否能兩全其美呢，覺得自己的眼界還不夠寬廣，深怕被那些非常非常資深的工程師擊飛，最後倖存！</p>
<p>工作的第四天，趕上公司的三十周年慶，公司租了一台遊艇在波士頓河岸繞了兩個小時，各個同事都在船上閒聊。結果我們台灣的都在玩船外的 table football 而忘了拍團體照 …</p>
<p><img src="https://i.imgur.com/W4cQZds.jpg" alt="Cadence 30th Celebration"></p>
<p>工作的第五天，討論要怎麼解決大數據的情況，數據一大只要會動就好，那麼效能就不再重要，但是舊有的操作又不能太慢，毫無用武之地的我，決定來個幻想之旅。最後一晚的聚餐，照片上的兇手替我點了 50 美元的龍蝦，看不懂菜單總是令人宰割。</p>
<p><img src="https://i.imgur.com/eLLHpA8.jpg" alt="$50 Lobster"></p>
<h2 id="紐約之旅"><a href="#紐約之旅" class="headerlink" title="紐約之旅"></a>紐約之旅</h2><p>在忙完一周的工作後，我們便到了第二周的紐約自由行。老實說，一開始的行程是回台灣休息，但是大部分的人都不在台灣，如果回台灣也處於無同事或目標的狀況，所以就跟著跑去紐約了。如此瘋狂的行程，大概就這一次！</p>
<p><img src="https://i.imgur.com/Tv2uioT.jpg" alt="「我真的沒有想做的事啊」－《來自繽紛世界的明日》"></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-uva-12254" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/19/uva-12254/" class="article-date">
  <time datetime="2018-08-19T00:31:33.000Z" itemprop="datePublished">2018-08-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/19/uva-12254/">UVa 12254 - Electricity Connection</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2018/08/19/uva-12254/" data-id="ckvd6e8a700ny9cvno60w8opt" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2018/08/19/uva-12254/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Steiner-tree/">Steiner tree</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dp/">dp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sse/">sse</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/常數優化/">常數優化</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/斯坦納樹/">斯坦納樹</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>給一個 <span>$8 \times 8$</span><!-- Has MathJax --> 平面圖，上面至多有八個住家，我們目標要從發電廠出發，牽電到所有的住家，拉線跨過水路的花費 <span>$pw$</span><!-- Has MathJax -->、一般陸路為 <span>$pl$</span><!-- Has MathJax -->，求最少花費。</p>
<p>經典的斯坦納樹問題，但有別於一般的平面圖，使用歐基里德距離或者曼哈頓距離作為花費函數。接著讓我們細談如何進行常數優化。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">2</div><div class="line">0 10</div><div class="line">H.W.WH..</div><div class="line">..W.W...</div><div class="line">..WGW...</div><div class="line">........</div><div class="line">........</div><div class="line">........</div><div class="line">........</div><div class="line">........</div><div class="line">0 0</div><div class="line">H.W.WH..</div><div class="line">..W.W...</div><div class="line">..WGW...</div><div class="line">........</div><div class="line">........</div><div class="line">........</div><div class="line">........</div><div class="line">........</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Case 1: 12</div><div class="line">Case 2: 7</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>斯坦納樹為 NP-hard 問題，因此沒有多項式解法，而要得到確切的最小化解，則必須透過動態規劃來完成。由於題目給定的範圍很小，首先將目標要連通完成的點集，壓縮成 <span>$N$</span><!-- Has MathJax --> 個位元，接著紀錄這個聯通元件的其中一個節點視為根。最後，得到狀態數為 <span>$M \cdot 2^N$</span><!-- Has MathJax -->，可以參考 <a href="http://sunmoon-template.blogspot.com/2017/04/steiner-tree-problem-in-graphs.html" target="_blank" rel="external">《「Steiner tree problem in graphs」斯坦納樹》 －日月卦長</a>　的說明。</p>
<p>公式可以拆成兩種情況，第一種為從子集合併中著手，另一種為拓展連通元件 (替換根節點，但不改變目前已經連到的目標集合)。定義 <code>dp[s][i]</code> 為根 <code>i</code>，連通集合 <code>s</code> 的最小花費</p>
<ul>
<li><span>$dp[S][i] = \min(dp[T][j]+dp[S&minus;T][j]+\text{dist}(i, j):j \in V,T \subset S)$</span><!-- Has MathJax --></li>
<li><span>$dp[S][i] = \min(dp[S][k] + \text{dist}(S, k))$</span><!-- Has MathJax -->
</li>
</ul>
<p>由上述的公式，我們便可知道複雜度為 <span>$O(M \cdot 3^N)$</span><!-- Has MathJax -->。</p>
<h3 id="實作細節"><a href="#實作細節" class="headerlink" title="實作細節"></a>實作細節</h3><ul>
<li><p>對於內存布局，有兩個選擇 <code>dp[2^N][M]</code> 或者是 <code>dp[M][2^N]</code>，其中以 <code>dp[2^N][M]</code> 最為適合，在撰寫迴圈的時候，最內層的迴圈為替換根，這麼一來 cache miss 的機會就非常低。更容易透過 unroll loop 和向量化來運作。</p>
<ul>
<li>如果內存布局使用 <code>dp[M][2^N]</code>，在撰寫向量化時，需要使用 gather 相關的指令，這部分只有在 AVX2 有，並不是每一個 online judge 都支援，而 latency 也算挺高的，等到哪天 CPU 架構換了，這解法可能才會快得起來。</li>
</ul>
</li>
<li><p>當我們窮舉子集合時，發現到公式有對稱性，便可只窮舉上半部。這樣可以加速 20% 的效能。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, h; i &lt; (<span class="number">1</span>&lt;&lt;n); i++) &#123;</div><div class="line">    <span class="keyword">if</span> ((i&amp;(-i)) == i)</div><div class="line">        h = i<span class="number">-1</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = (i<span class="number">-1</span>)&amp;i; k &gt; h; k = (k<span class="number">-1</span>)&amp;i) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">64</span>; j++)</div><div class="line">            dp[i][j] = min(dp[i][j], dp[k][j]+dp[i^k][j]-w[j]);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    relax(i);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="基礎篇"><a href="#基礎篇" class="headerlink" title="基礎篇"></a>基礎篇</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target(<span class="meta-string">"avx"</span>)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">"O3"</span>)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt; </span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">char</span> g[<span class="number">8</span>][<span class="number">16</span>], w[<span class="number">64</span>];</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> dx[] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">-1</span>&#125;;</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> dy[] = &#123;<span class="number">1</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</div><div class="line"><span class="keyword">static</span> <span class="keyword">int32_t</span> dp[<span class="number">1</span>&lt;&lt;<span class="number">8</span>][<span class="number">64</span>];</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">relax</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int8_t</span> Q[<span class="number">1024</span>];</div><div class="line">    <span class="keyword">uint64_t</span> inq = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> Qn = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (dp[s][i] != INF)</div><div class="line">            Q[Qn++] = i, inq |= <span class="number">1U</span>LL&lt;&lt;i;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Qn; i++) &#123;</div><div class="line">        <span class="keyword">int</span> u = Q[i];</div><div class="line">        <span class="keyword">int</span> x = u&gt;&gt;<span class="number">3</span>, y = u&amp;<span class="number">7</span>;</div><div class="line">        inq ^= <span class="number">1U</span>LL&lt;&lt;u;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">4</span>; k++) &#123;</div><div class="line">            <span class="keyword">int</span> tx = x+dx[k], ty = y+dy[k];</div><div class="line">            <span class="keyword">if</span> (tx &lt; <span class="number">0</span> || ty &lt; <span class="number">0</span> || tx &gt;= <span class="number">8</span> || ty &gt;= <span class="number">8</span>)</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            <span class="keyword">int</span> v = tx&lt;&lt;<span class="number">3</span>|ty;</div><div class="line">            <span class="keyword">if</span> (dp[s][v] &gt; dp[s][u]+<span class="number">1</span>+w[v]) &#123;</div><div class="line">                dp[s][v] = dp[s][u]+<span class="number">1</span>+w[v];</div><div class="line">                <span class="keyword">if</span> (((inq&gt;&gt;v)&amp;<span class="number">1</span>) == <span class="number">0</span>) &#123;</div><div class="line">                    inq |= <span class="number">1U</span>LL&lt;&lt;v;</div><div class="line">                    Q[Qn++] = v;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> pl, pw;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;pl, &amp;pw);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>, &amp;g[i]);</div><div class="line"></div><div class="line">        <span class="keyword">int</span> n = <span class="number">0</span>, root = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> A[<span class="number">8</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</div><div class="line">                <span class="keyword">int</span> u = i&lt;&lt;<span class="number">3</span>|j;</div><div class="line">                <span class="keyword">if</span> (g[i][j] == <span class="string">'H'</span>)</div><div class="line">                    A[n++] = u, w[u] = <span class="number">0</span>;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (g[i][j] == <span class="string">'G'</span>)</div><div class="line">                    w[u] = <span class="number">0</span>, root = u;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (g[i][j] == <span class="string">'W'</span>)</div><div class="line">                    w[u] = pw;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (g[i][j] == <span class="string">'.'</span>)</div><div class="line">                    w[u] = pl;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="built_in">memset</span>(dp, <span class="number">0x3f</span>, <span class="keyword">sizeof</span>(dp));</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            dp[<span class="number">1</span>&lt;&lt;i][A[i]] = <span class="number">0</span>;</div><div class="line">            </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, h; i &lt; (<span class="number">1</span>&lt;&lt;n); i++) &#123;</div><div class="line">            <span class="keyword">if</span> ((i&amp;(-i)) == i)</div><div class="line">                h = i<span class="number">-1</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = (i<span class="number">-1</span>)&amp;i; k &gt; h; k = (k<span class="number">-1</span>)&amp;i) &#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">64</span>; j++)</div><div class="line">                    dp[i][j] = min(dp[i][j], dp[k][j]+dp[i^k][j]-w[j]);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            relax(i);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> ret = dp[(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>][root];</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case %d: %d\n"</span>, ++cases, ret);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SSE-向量化"><a href="#SSE-向量化" class="headerlink" title="SSE 向量化"></a>SSE 向量化</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target(<span class="meta-string">"avx"</span>)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">"O3"</span>)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;x86intrin.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">char</span> g[<span class="number">8</span>][<span class="number">16</span>];</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> dx[] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">-1</span>&#125;;</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> dy[] = &#123;<span class="number">1</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">int32_t</span> w[<span class="number">64</span>] __attribute__ ((aligned(<span class="number">16</span>)));</div><div class="line"><span class="keyword">static</span> <span class="keyword">int32_t</span> dp[<span class="number">1</span>&lt;&lt;<span class="number">8</span>][<span class="number">64</span>] __attribute__ ((aligned(<span class="number">16</span>)));</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">relax</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int8_t</span> Q[<span class="number">1024</span>];</div><div class="line">    <span class="keyword">uint64_t</span> inq = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> Qn = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (dp[s][i] != INF)</div><div class="line">            Q[Qn++] = i, inq |= <span class="number">1U</span>LL&lt;&lt;i;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Qn; i++) &#123;</div><div class="line">        <span class="keyword">int</span> u = Q[i];</div><div class="line">        <span class="keyword">int</span> x = u&gt;&gt;<span class="number">3</span>, y = u&amp;<span class="number">7</span>;</div><div class="line">        inq ^= <span class="number">1U</span>LL&lt;&lt;u;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">4</span>; k++) &#123;</div><div class="line">            <span class="keyword">int</span> tx = x+dx[k], ty = y+dy[k];</div><div class="line">            <span class="keyword">if</span> (tx &lt; <span class="number">0</span> || ty &lt; <span class="number">0</span> || tx &gt;= <span class="number">8</span> || ty &gt;= <span class="number">8</span>)</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            <span class="keyword">int</span> v = tx&lt;&lt;<span class="number">3</span>|ty;</div><div class="line">            <span class="keyword">if</span> (dp[s][v] &gt; dp[s][u]+<span class="number">1</span>+w[v]) &#123;</div><div class="line">                dp[s][v] = dp[s][u]+<span class="number">1</span>+w[v];</div><div class="line">                <span class="keyword">if</span> (((inq&gt;&gt;v)&amp;<span class="number">1</span>) == <span class="number">0</span>) &#123;</div><div class="line">                    inq |= <span class="number">1U</span>LL&lt;&lt;v;</div><div class="line">                    Q[Qn++] = v;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> pl, pw;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;pl, &amp;pw);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>, &amp;g[i]);</div><div class="line"></div><div class="line">        <span class="keyword">int</span> n = <span class="number">0</span>, root = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> A[<span class="number">8</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</div><div class="line">                <span class="keyword">int</span> u = i&lt;&lt;<span class="number">3</span>|j;</div><div class="line">                <span class="keyword">if</span> (g[i][j] == <span class="string">'H'</span>)</div><div class="line">                    A[n++] = u, w[u] = <span class="number">0</span>;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (g[i][j] == <span class="string">'G'</span>)</div><div class="line">                    w[u] = <span class="number">0</span>, root = u;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (g[i][j] == <span class="string">'W'</span>)</div><div class="line">                    w[u] = pw;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (g[i][j] == <span class="string">'.'</span>)</div><div class="line">                    w[u] = pl;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="built_in">memset</span>(dp, <span class="number">0x3f</span>, <span class="keyword">sizeof</span>(dp));</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            dp[<span class="number">1</span>&lt;&lt;i][A[i]] = <span class="number">0</span>;</div><div class="line">            </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, h; i &lt; (<span class="number">1</span>&lt;&lt;n); i++) &#123;</div><div class="line">            <span class="keyword">if</span> ((i&amp;(-i)) == i)</div><div class="line">                h = i<span class="number">-1</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = (i<span class="number">-1</span>)&amp;i; k &gt; h; k = (k<span class="number">-1</span>)&amp;i) &#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j+<span class="number">4</span> &lt;= <span class="number">64</span>; j += <span class="number">4</span>) &#123;</div><div class="line">                    __m128i mv = _mm_load_si128((__m128i*) (dp[i]+j));</div><div class="line">                    __m128i a = _mm_load_si128((__m128i*) (dp[k]+j));</div><div class="line">                    __m128i b = _mm_load_si128((__m128i*) (dp[i^k]+j));</div><div class="line">                    __m128i tm = _mm_add_epi32(a, b);</div><div class="line">                    __m128i c = _mm_load_si128((__m128i*) (w+j));</div><div class="line">                    __m128i tn = _mm_sub_epi32(tm, c);</div><div class="line">                    __m128i mn = _mm_min_epi32(mv, tn);</div><div class="line">                    _mm_store_si128((__m128i*) (dp[i]+j), mn);</div><div class="line">                &#125;</div><div class="line"><span class="comment">//					dp[i][j] = min(dp[i][j], dp[k][j]+dp[i^k][j]-w[j]);</span></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            relax(i);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> ret = dp[(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>][root];</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case %d: %d\n"</span>, ++cases, ret);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="AVX2-Gather"><a href="#AVX2-Gather" class="headerlink" title="AVX2 Gather"></a>AVX2 Gather</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> It doesn't work at UVA 2018/08/13 because server CPU does not support </span></div><div class="line"><span class="comment"> AVX2 instruction set. Although we could pass the compiler, you still </span></div><div class="line"><span class="comment"> get runtime error during executing an illegal instruction.</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target(<span class="meta-string">"avx"</span>)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target(<span class="meta-string">"avx2"</span>)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">"O3"</span>)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;x86intrin.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;avx2intrin.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">char</span> g[<span class="number">8</span>][<span class="number">16</span>], w[<span class="number">64</span>];</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> dx[] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">-1</span>&#125;;</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> dy[] = &#123;<span class="number">1</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">int32_t</span> dp[<span class="number">64</span>][<span class="number">1</span>&lt;&lt;<span class="number">8</span>] __attribute__ ((aligned(<span class="number">16</span>)));</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">relax</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int8_t</span> Q[<span class="number">1024</span>];</div><div class="line">    <span class="keyword">uint64_t</span> inq = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> Qn = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (dp[i][s] != INF)</div><div class="line">            Q[Qn++] = i, inq |= <span class="number">1U</span>LL&lt;&lt;i;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Qn; i++) &#123;</div><div class="line">        <span class="keyword">int</span> u = Q[i];</div><div class="line">        <span class="keyword">int</span> x = u&gt;&gt;<span class="number">3</span>, y = u&amp;<span class="number">7</span>;</div><div class="line">        inq ^= <span class="number">1U</span>LL&lt;&lt;u;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">4</span>; k++) &#123;</div><div class="line">            <span class="keyword">int</span> tx = x+dx[k], ty = y+dy[k];</div><div class="line">            <span class="keyword">if</span> (tx &lt; <span class="number">0</span> || ty &lt; <span class="number">0</span> || tx &gt;= <span class="number">8</span> || ty &gt;= <span class="number">8</span>)</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            <span class="keyword">int</span> v = tx&lt;&lt;<span class="number">3</span>|ty;</div><div class="line">            <span class="keyword">if</span> (dp[v][s] &gt; dp[u][s]+<span class="number">1</span>+w[v]) &#123;</div><div class="line">                dp[v][s] = dp[u][s]+<span class="number">1</span>+w[v];</div><div class="line">                <span class="keyword">if</span> (((inq&gt;&gt;v)&amp;<span class="number">1</span>) == <span class="number">0</span>) &#123;</div><div class="line">                    inq |= <span class="number">1U</span>LL&lt;&lt;v;</div><div class="line">                    Q[Qn++] = v;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> pl, pw;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;pl, &amp;pw);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>, &amp;g[i]);</div><div class="line"></div><div class="line">        <span class="keyword">int</span> n = <span class="number">0</span>, root = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> A[<span class="number">8</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</div><div class="line">                <span class="keyword">int</span> u = i&lt;&lt;<span class="number">3</span>|j;</div><div class="line">                <span class="keyword">if</span> (g[i][j] == <span class="string">'H'</span>)</div><div class="line">                    A[n++] = u, w[u] = <span class="number">0</span>;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (g[i][j] == <span class="string">'G'</span>)</div><div class="line">                    w[u] = <span class="number">0</span>, root = u;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (g[i][j] == <span class="string">'W'</span>)</div><div class="line">                    w[u] = pw;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (g[i][j] == <span class="string">'.'</span>)</div><div class="line">                    w[u] = pl;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="built_in">memset</span>(dp, <span class="number">0x3f</span>, <span class="keyword">sizeof</span>(dp));</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            dp[A[i]][<span class="number">1</span>&lt;&lt;i] = <span class="number">0</span>;</div><div class="line">            </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, h; i &lt; (<span class="number">1</span>&lt;&lt;n); i++) &#123;</div><div class="line">            <span class="keyword">if</span> ((i&amp;(-i)) == i)</div><div class="line">                h = i<span class="number">-1</span>;</div><div class="line">            __attribute__ ((aligned(<span class="number">16</span>))) <span class="keyword">static</span> <span class="keyword">int</span> subset1[<span class="number">1</span>&lt;&lt;<span class="number">8</span>] = &#123;&#125;;</div><div class="line">            __attribute__ ((aligned(<span class="number">16</span>))) <span class="keyword">static</span> <span class="keyword">int</span> subset2[<span class="number">1</span>&lt;&lt;<span class="number">8</span>] = &#123;&#125;;</div><div class="line">            <span class="keyword">int</span> sn = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = (i<span class="number">-1</span>)&amp;i; k &gt; h; k = (k<span class="number">-1</span>)&amp;i)</div><div class="line">                subset1[sn] = k, subset2[sn] = i^k, sn++;</div><div class="line">            <span class="keyword">while</span> (sn&amp;<span class="number">4</span>)</div><div class="line">                subset1[sn] = <span class="number">0</span>, subset2[sn] = i, sn++;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">64</span>; j++) &#123;</div><div class="line">                <span class="keyword">int32_t</span> mn = dp[j][i]+w[j];</div><div class="line">                __m128i mv = _mm_setr_epi32(mn, mn, mn, mn);</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> t = <span class="number">0</span>; t &lt;= sn; t += <span class="number">4</span>) &#123;</div><div class="line">                    <span class="keyword">int</span> k;</div><div class="line">                    __m128i a = _mm_load_si128((__m128i*) subset1+t);</div><div class="line">                    __m128i b = _mm_load_si128((__m128i*) subset2+t);</div><div class="line">                    __m128i t1 = _mm_i32gather_epi32(dp[j], a, <span class="number">4</span>);</div><div class="line">                    __m128i t2 = _mm_i32gather_epi32(dp[j], b, <span class="number">4</span>);</div><div class="line">                    __m128i tm = _mm_add_epi32(t1, t2);</div><div class="line">                    mv = _mm_min_epi32(mv, tm);</div><div class="line">                &#125;</div><div class="line">                __attribute__ ((aligned(<span class="number">16</span>))) <span class="keyword">int32_t</span> mr[<span class="number">4</span>];</div><div class="line">                _mm_store_si128((__m128i*) mr, mv);</div><div class="line">                mn = min(min(mr[<span class="number">0</span>], mr[<span class="number">1</span>]), min(mr[<span class="number">2</span>], mr[<span class="number">3</span>]));</div><div class="line">                dp[j][i] = mn-w[j];</div><div class="line"><span class="comment">//				mn = min(mn, dp[j][k]+dp[j][i^k]-ww);</span></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            relax(i);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> ret = dp[root][(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>];</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case %d: %d\n"</span>, ++cases, ret);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-optimize-skill-sort" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/22/optimize-skill-sort/" class="article-date">
  <time datetime="2018-07-22T00:20:18.000Z" itemprop="datePublished">2018-07-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/22/optimize-skill-sort/">優化技巧 - 排序/優先隊列</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2018/07/22/optimize-skill-sort/" data-id="ckvd6e85z00d99cvn6igqbekw" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2018/07/22/optimize-skill-sort/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/基數排序/">基數排序</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/堆/">堆</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="主要問題"><a href="#主要問題" class="headerlink" title="主要問題"></a>主要問題</h2><p>在算法問題中，時常結合到排序，而排序的常數也大大影響到我們整體的效能。</p>
<h2 id="基數排序降低常數"><a href="#基數排序降低常數" class="headerlink" title="基數排序降低常數"></a>基數排序降低常數</h2><p>若是一般原始型別的排序，可以透過基數排序 (radix sort)。從排序的範圍來決定是否要劃分 8-bit 一組一組。若範圍介於可容忍的 <span>$[0, v]$</span><!-- Has MathJax -->，當 <span>$v &lt; n$</span><!-- Has MathJax --> 時，直接開 <span>$n$</span><!-- Has MathJax --> 個 bucket 的方式更好。因為大多數的複雜度都大於線性 <span>$O(n)$</span><!-- Has MathJax --></p>
<h3 id="非負整數基數排序"><a href="#非負整數基數排序" class="headerlink" title="非負整數基數排序"></a>非負整數基數排序</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> _radix_sort(Pt *A, <span class="keyword">int</span> n) &#123;</div><div class="line">    <span class="keyword">static</span> Pt _tmp[MAXN];</div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> CHUNK = <span class="number">256</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> C[CHUNK];</div><div class="line">    Pt *B = _tmp, *T;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; <span class="number">8</span>; x++) &#123;</div><div class="line">        <span class="keyword">const</span> <span class="keyword">int</span> d = x*<span class="number">8</span>;</div><div class="line">        <span class="built_in">memset</span>(C, <span class="number">0</span>, <span class="keyword">sizeof</span>(C));</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            C[(A[i].x&gt;&gt;d)&amp;(CHUNK<span class="number">-1</span>)]++;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; CHUNK; i++)</div><div class="line">            C[i] += C[i<span class="number">-1</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--)</div><div class="line">            B[--C[(A[i].x&gt;&gt;d)&amp;(CHUNK<span class="number">-1</span>)]] = A[i];</div><div class="line">        T = A, A = B, B = T;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="浮點數基數排序"><a href="#浮點數基數排序" class="headerlink" title="浮點數基數排序"></a>浮點數基數排序</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">radix_sort</span><span class="params">(Pt *A, <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">int32_t</span> &amp;v = *((<span class="keyword">int32_t</span> *) &amp;(A[i].s));</div><div class="line">        <span class="keyword">if</span> ((v&gt;&gt;<span class="number">31</span>)&amp;<span class="number">1</span>)</div><div class="line">            v = ~v;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            v = v | <span class="number">0x80000000</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">static</span> Pt _tmp[MAXN*<span class="number">2</span>];</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> CHUNK = <span class="number">256</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> C[<span class="number">1</span>&lt;&lt;<span class="number">8</span>];</div><div class="line">    Pt *B = _tmp, *T;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x++) &#123;</div><div class="line">        <span class="keyword">const</span> <span class="keyword">int</span> d = x*<span class="number">8</span>;</div><div class="line">        <span class="built_in">memset</span>(C, <span class="number">0</span>, <span class="keyword">sizeof</span>(C));</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            C[((*((<span class="keyword">int32_t</span> *) &amp;(A[i].s)))&gt;&gt;d)&amp;(CHUNK<span class="number">-1</span>)]++;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; CHUNK; i++)</div><div class="line">            C[i] += C[i<span class="number">-1</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--)</div><div class="line">            B[--C[((*((<span class="keyword">int32_t</span> *) &amp;(A[i].s)))&gt;&gt;d)&amp;(CHUNK<span class="number">-1</span>)]] = A[i];</div><div class="line">        T = A, A = B, B = T;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">int32_t</span> &amp;v = *((<span class="keyword">int32_t</span> *) &amp;(A[i].s));</div><div class="line">        <span class="keyword">if</span> ((v&gt;&gt;<span class="number">31</span>)&amp;<span class="number">1</span>)</div><div class="line">            v = v &amp; <span class="number">0x7fffffff</span>;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            v = ~v;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="慎選內建排序"><a href="#慎選內建排序" class="headerlink" title="慎選內建排序"></a>慎選內建排序</h2><p>內建排序常見的有 <code>qsort</code>, <code>sort</code>, <code>stable_sort</code>，我不推薦使用 <code>qsort</code>，因為它在很久以前找到了一個退化情況 <a href="https://news.ycombinator.com/item?id=10476466" target="_blank" rel="external">A Killer Adversary for Quicksort - 1995</a>，有些題目的測資會出這種特別案例，導致當年的萌新內心受創。除非只有 C 的情況，否則請避開 <code>qsort</code>。如果算法屬於調整某些元素後，再對整體進行排序，這時候 <code>sort</code> 比 <code>stable_sort</code> 慢很多。當情況非常接近已經排序的時候，就使用 <code>stable_sort</code>。</p>
<h2 id="優先隊列"><a href="#優先隊列" class="headerlink" title="優先隊列"></a>優先隊列</h2><p>使用 priority queue 的方法通常有三種 <code>set</code>, <code>priority_queue</code>, <code>heap</code>。</p>
<ul>
<li>功能最多的 <code>set</code>、次少的 <code>priority_queue</code>，最少的 <code>heap</code>。</li>
<li>效能方面則是 <code>heap</code> 最快、次著 <code>priority_queue</code>、最後 <code>set</code>。</li>
<li>代碼維護最容易的 <code>set</code>、最差的 <code>heap</code>。</li>
</ul>
<p>之前很排斥使用 <code>priority_queue</code>，原因在於撰寫 <code>operator&lt;</code> 與我的邏輯相反，因此都偏愛使用 <code>set</code>，但是效能被拉出來的時候，又必須退回類似 C 的 <code>make_heap</code>、<code>pop_heap</code> … 的接口。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-uva-12310" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/08/uva-12310/" class="article-date">
  <time datetime="2018-07-08T07:32:38.000Z" itemprop="datePublished">2018-07-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/08/uva-12310/">UVa 12310 - Point Location</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2018/07/08/uva-12310/" data-id="ckvd6e8a800o19cvnlq0gr0fw" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2018/07/08/uva-12310/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Point-Location/">Point Location</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kd-tree/">kd-tree</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/幾何/">幾何</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/線段樹/">線段樹</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/計算幾何/">計算幾何</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>給定一平面上 <span>$n$</span><!-- Has MathJax --> 個點，接著拉 <span>$m$</span><!-- Has MathJax --> 個線段拼湊成不相交的區域，並將標記數個點位置所在的區域。接著有數個詢問「點在哪一個先前標記的同一區域內」。</p>
<p>這一問題常在幾何處理中出現，詳細可查閱 <a href="https://en.wikipedia.org/wiki/Point_location" target="_blank" rel="external">Wikipedia - Point location</a>，在此不額外說明。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">14 16 5 5</div><div class="line">0 0</div><div class="line">30 0</div><div class="line">40 0</div><div class="line">60 0</div><div class="line">60 50</div><div class="line">0 50</div><div class="line">20 40</div><div class="line">10 10</div><div class="line">30 10</div><div class="line">30 20</div><div class="line">40 20</div><div class="line">50 30</div><div class="line">50 40</div><div class="line">30 40</div><div class="line">1 2</div><div class="line">2 9</div><div class="line">9 8</div><div class="line">8 7</div><div class="line">7 9</div><div class="line">9 10</div><div class="line">10 11</div><div class="line">11 3</div><div class="line">3 4</div><div class="line">4 5</div><div class="line">5 6</div><div class="line">6 1</div><div class="line">12 13</div><div class="line">13 14</div><div class="line">14 12</div><div class="line">2 3</div><div class="line">20 20</div><div class="line">10 20</div><div class="line">35 10</div><div class="line">45 39</div><div class="line">1 60</div><div class="line">28 11</div><div class="line">29 14</div><div class="line">34 7</div><div class="line">40 38</div><div class="line">70 1</div><div class="line">0 0 0 0</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><h3 id="Previously"><a href="#Previously" class="headerlink" title="Previously"></a>Previously</h3><p>在大學修計算幾何的時候，知道這一類的題目要透過梯形剖分的方式，搭配的資料結構類似四分樹，分隔的基準是一個線段，將線段兩個端點分別拉出無限延長的垂直線，但這方法對於線段本身是垂直時，處理情況比較複雜，那時構思了好幾天沒個底，只好放棄。現在，在 Cadence 公司上班快滿一年，解決幾何操作不在少數，成長的我應該能解決這一題了吧。</p>
<h3 id="Detail"><a href="#Detail" class="headerlink" title="Detail"></a>Detail</h3><ul>
<li>相關問題 <a href="http://www.csie.ntnu.edu.tw/~u91029/Triangulation.html#4" target="_blank" rel="external">演算法筆記 - Polygon Partition / Polygon Trapezoidalization</a></li>
</ul>
<p>題目已經保證給予的線段除了端點外，彼此之間不會相交任何一點。便可以對所有線段建立空間分割相關的資料結構，好讓我們對於解決，從詢問點出發往 <span>$y$</span><!-- Has MathJax --> 無窮遠的射線，最後會打到哪一個線段。</p>
<p>處理的流程如下：</p>
<p><img src="https://i.imgur.com/GO1qBfd.png" alt="Step 1. 輸入線段"></p>
<p><img src="https://i.imgur.com/lJNUxQd.png" alt="Step 2. 套上邊界，需要能包含所有詢問點"></p>
<p><img src="https://i.imgur.com/kRrihgw.png" alt="Step 3. 對每一個相連的線段集合，找出 $y$ 軸最高的點，放出輔助射線"></p>
<p><img src="https://i.imgur.com/LQfivUD.png" alt="Step 4. 對每一個頂點進行極角排序，進行繞行分組"></p>
<p>首先，對於幾何剖分的問題，為處理方便，都會套上一個無限大的外框，把所有頂點包在裡面。你可以透過 GeoGebra 這套數學軟體，將處理過程中的資料丟進去，方便你除錯。如果要批次輸入一大筆，請透過上方的建立按鈕 (Button)，將 command 的語法以行為單位放入，語法類似 javascript。</p>
<p>接著，我們需要對每一個線段集合的最高點放出輔助射線 (這部分已經縮減了不少，原則上對每一個頂點放出射線也可以)，這些輔助射線用來解決內部的孤立形，要把整個圖串成一個連通圖。否則，當詢問屬於內部的孤立形狀的外部時，我們會缺少足夠的資訊連到包含這個孤立形的外框。</p>
<p>最後，對每一個頂點相連的邊進行極角排序，接著才能決定相鄰的邊，而任兩個相鄰的邊所夾的區域屬於同一個集合，因此我們需要對每一個有方向的邊進行編號，將邊與邊合併到同一個集合。對於每一個詢問，只需要對詢問點放出射線找到接觸的線段，便可以知道所在的集合。</p>
<ul>
<li>若使用 KD tree，即使交替選擇 <span>$x$</span><!-- Has MathJax -->-<span>$y$</span><!-- Has MathJax --> 軸分割，也沒辦法保證樹高。因為處理的是線段，而不是點，每一次挑選的分隔軸，將會產生三個子樹，中間的子樹為與分隔軸相交的線段。在大部分的情況下，整體時間複雜度落在 <span>$O(n \log n)$</span><!-- Has MathJax -->，空間複雜度 <span>$O(n)$</span><!-- Has MathJax --> 。</li>
<li>若使用線段樹，將在 <span>$x$</span><!-- Has MathJax --> 軸上劃分，每一個線段至多被拆成 <span>$O(\log n)$</span><!-- Has MathJax --> 個，詢問射線第一個碰觸的線段時，單一詢問的時間複雜度 <span>$O(\log n)$</span><!-- Has MathJax -->，常數相較於 KD tree 多。整體時間複雜度落在 <span>$O(n \log n)$</span><!-- Has MathJax -->，空間複雜度 <span>$O(n \log n)$</span><!-- Has MathJax --> 。</li>
</ul>
<p>還有許多 spatial data structure 可以考慮，這裡只挑選兩個出來實驗，上述皆為在線算法。也可以將所有操作離線，這時候將套用掃描線算法，但對於垂直線段如何在算法中維護二元樹，目前遇到一些實作上的問題，這將在未來才能給各位參考。</p>
<h3 id="KD-tree"><a href="#KD-tree" class="headerlink" title="KD tree"></a>KD tree</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt; </span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">float</span> eps = <span class="number">1e-6</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">float</span> BOX_MX = <span class="number">2000000</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pt</span> &#123;</span></div><div class="line">    <span class="keyword">float</span> x, y;</div><div class="line">    Pt() &#123;&#125;</div><div class="line">    Pt(<span class="keyword">float</span> a, <span class="keyword">float</span> b): x(a), y(b) &#123;&#125;</div><div class="line">    Pt <span class="keyword">operator</span>-(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Pt(x - a.x, y - a.y); &#125;</div><div class="line">    Pt <span class="keyword">operator</span>+(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Pt(x + a.x, y + a.y); &#125;</div><div class="line">    Pt <span class="keyword">operator</span>*(<span class="keyword">const</span> <span class="keyword">double</span> a) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Pt(x * a, y * a);  &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">fabs</span>(x - a.x) &gt; eps)	<span class="keyword">return</span> x &lt; a.x;</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">fabs</span>(y - a.y) &gt; eps)	<span class="keyword">return</span> y &lt; a.y;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">fabs</span>(x - a.x) &lt; eps &amp;&amp; <span class="built_in">fabs</span>(y - a.y) &lt; eps;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">println</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">    	<span class="built_in">printf</span>(<span class="string">"(%lf, %lf)\n"</span>, x, y);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Seg</span> &#123;</span></div><div class="line">    Pt s, e;</div><div class="line">    <span class="keyword">int</span> i;</div><div class="line">    Seg() &#123;&#125;</div><div class="line">    Seg(Pt a, Pt b, <span class="keyword">int</span> i):s(a), e(b), i(i) &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">println</span><span class="params">()</span> </span>&#123;</div><div class="line">    	<span class="built_in">printf</span>(<span class="string">"Segment((%lf, %lf), (%lf, %lf))\n"</span>, s.x, s.y, e.x, e.y);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">dot</span><span class="params">(Pt a, Pt b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> a.x * b.x + a.y * b.y;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">cross</span><span class="params">(Pt o, Pt a, Pt b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (a.x-o.x)*(b.y-o.y)-(a.y-o.y)*(b.x-o.x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">cross2</span><span class="params">(Pt a, Pt b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> a.x * b.y - a.y * b.x;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">between</span><span class="params">(Pt a, Pt b, Pt c)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> dot(c - a, b - a) &gt;= -eps &amp;&amp; dot(c - b, a - b) &gt;= -eps;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">onSeg</span><span class="params">(Pt a, Pt b, Pt c)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> between(a, b, c) &amp;&amp; <span class="built_in">fabs</span>(cross(a, b, c)) &lt; eps;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmpZero</span><span class="params">(<span class="keyword">float</span> v)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="built_in">fabs</span>(v) &gt; eps) <span class="keyword">return</span> v &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">-1</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Pt <span class="title">getIntersect</span><span class="params">(Seg a, Seg b)</span> </span>&#123;</div><div class="line">    Pt u = a.s - b.s;</div><div class="line">    <span class="keyword">double</span> t = cross2(b.e - b.s, u)/cross2(a.e - a.s, b.e - b.s);</div><div class="line">    <span class="keyword">return</span> a.s + (a.e - a.s) * t;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AngleCmp</span> &#123;</span></div><div class="line">    Pt o;</div><div class="line">    AngleCmp(Pt o = Pt()):o(o) &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="keyword">const</span> pair&lt;Pt, <span class="keyword">int</span>&gt;&amp; ppa, <span class="keyword">const</span> pair&lt;Pt, <span class="keyword">int</span>&gt;&amp; ppb)</span> </span>&#123;</div><div class="line">        Pt pa = ppa.first, pb = ppb.first;</div><div class="line">        Pt p1 = pa - o, p2 = pb - o;</div><div class="line">        <span class="keyword">if</span> (p1.y == <span class="number">0</span> &amp;&amp; p2.y == <span class="number">0</span> &amp;&amp; p1.x * p2.x &lt;= <span class="number">0</span>) <span class="keyword">return</span> p1.x &gt; p2.x;</div><div class="line">        <span class="keyword">if</span> (p1.y == <span class="number">0</span> &amp;&amp; p1.x &gt;= <span class="number">0</span> &amp;&amp; p2.y != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">        <span class="keyword">if</span> (p2.y == <span class="number">0</span> &amp;&amp; p2.x &gt;= <span class="number">0</span> &amp;&amp; p1.y != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span> (p1.y * p2.y &lt; <span class="number">0</span>) <span class="keyword">return</span> p1.y &gt; p2.y;</div><div class="line">        <span class="keyword">double</span> c = cross2(p1, p2);</div><div class="line">        <span class="keyword">return</span> c &gt; <span class="number">0</span> || (c == <span class="number">0</span> &amp;&amp; <span class="built_in">fabs</span>(p1.x) &lt; <span class="built_in">fabs</span>(p2.x));</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">static</span> Pt pts[<span class="number">10005</span>];</div><div class="line"><span class="keyword">static</span> Seg segs[<span class="number">30005</span>];</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BSP</span> &#123;</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">60005</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXNODE = <span class="number">60005</span>;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">        <span class="keyword">float</span> lx, ly, rx, ry;</div><div class="line">        Node *ls, *ms, *rs;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">extend</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</div><div class="line">                <span class="keyword">return</span> ;</div><div class="line">            lx = min(lx, u-&gt;lx), ly = min(ly, u-&gt;ly);</div><div class="line">            rx = max(rx, u-&gt;rx), ry = max(ry, u-&gt;ry);</div><div class="line">        &#125;</div><div class="line">    &#125; nodes[MAXNODE];</div><div class="line">    <span class="keyword">int</span> sn[MAXNODE];</div><div class="line">    Seg *seg[MAXNODE];</div><div class="line">    <span class="keyword">float</span> axis[MAXN];</div><div class="line">    Node *root;</div><div class="line">    <span class="keyword">int</span> size;</div><div class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</div><div class="line">        Node *p = &amp;nodes[size++];</div><div class="line">        assert(size &lt; MAXNODE);</div><div class="line">        p-&gt;ls = p-&gt;ms = p-&gt;rs = <span class="literal">NULL</span>;</div><div class="line">        sn[p-nodes] = <span class="number">0</span>;</div><div class="line">        <span class="keyword">return</span> p;</div><div class="line">    &#125;</div><div class="line">    Node* _build(<span class="keyword">int</span> k, Seg segs[], <span class="keyword">int</span> n) &#123;</div><div class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">        <span class="keyword">if</span> (k == <span class="number">2</span>)</div><div class="line">            k = <span class="number">0</span>;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> Lsize = <span class="number">0</span>, Msize = <span class="number">0</span>, Rsize = <span class="number">0</span>;</div><div class="line">        Seg *L = <span class="literal">NULL</span>, *M = <span class="literal">NULL</span>, *R = <span class="literal">NULL</span>;</div><div class="line">        <span class="keyword">if</span> (k == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">                axis[i&lt;&lt;<span class="number">1</span>] = segs[i].s.x, axis[i&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] = segs[i].e.x;</div><div class="line">            nth_element(axis, axis+n, axis+<span class="number">2</span>*n);</div><div class="line">            <span class="keyword">const</span> <span class="keyword">float</span> mval = axis[n];</div><div class="line">            L = segs;</div><div class="line">            R = <span class="built_in">std</span>::partition(segs, segs+n, [mval](<span class="keyword">const</span> Seg &amp;s) &#123;</div><div class="line">            	<span class="keyword">return</span> max(s.s.x, s.e.x) &lt;= mval;</div><div class="line">        	&#125;);</div><div class="line">        	M = <span class="built_in">std</span>::partition(R, segs+n, [mval](<span class="keyword">const</span> Seg &amp;s) &#123;</div><div class="line">            	<span class="keyword">return</span> min(s.s.x, s.e.x) &lt;= mval;</div><div class="line">        	&#125;);</div><div class="line">        	Msize = segs+n - M;</div><div class="line">        	Rsize = M - R;</div><div class="line">        	Lsize = R - segs;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">                axis[i&lt;&lt;<span class="number">1</span>] = segs[i].s.y, axis[i&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] = segs[i].e.y;</div><div class="line">            nth_element(axis, axis+n, axis+<span class="number">2</span>*n);</div><div class="line">            <span class="keyword">const</span> <span class="keyword">float</span> mval = axis[n];</div><div class="line">            L = segs;</div><div class="line">            R = <span class="built_in">std</span>::partition(segs, segs+n, [mval](<span class="keyword">const</span> Seg &amp;s) &#123;</div><div class="line">            	<span class="keyword">return</span> max(s.s.y, s.e.y) &lt;= mval;</div><div class="line">        	&#125;);</div><div class="line">        	M = <span class="built_in">std</span>::partition(R, segs+n, [mval](<span class="keyword">const</span> Seg &amp;s) &#123;</div><div class="line">            	<span class="keyword">return</span> min(s.s.y, s.e.y) &lt;= mval;</div><div class="line">        	&#125;);</div><div class="line">        	Msize = segs+n - M;</div><div class="line">        	Rsize = M - R;</div><div class="line">        	Lsize = R - segs;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        Node *u = newNode();</div><div class="line">        u-&gt;lx = BOX_MX, u-&gt;ly = BOX_MX; </div><div class="line">        u-&gt;rx = -BOX_MX, u-&gt;ry = -BOX_MX;</div><div class="line">        <span class="keyword">if</span> (Lsize == n || Rsize == n || Msize == n) &#123;</div><div class="line">            sn[u - nodes] = n, seg[u - nodes] = segs;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">                u-&gt;lx = min(u-&gt;lx, min(segs[i].s.x, segs[i].e.x));</div><div class="line">                u-&gt;rx = max(u-&gt;rx, max(segs[i].s.x, segs[i].e.x));</div><div class="line">                u-&gt;ly = min(u-&gt;ly, min(segs[i].s.y, segs[i].e.y));</div><div class="line">                u-&gt;ry = max(u-&gt;ry, max(segs[i].s.y, segs[i].e.y));</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            u-&gt;ls = _build(k+<span class="number">1</span>, L, Lsize), u-&gt;extend(u-&gt;ls);</div><div class="line">            u-&gt;ms = _build(k+<span class="number">1</span>, M, Msize), u-&gt;extend(u-&gt;ms);</div><div class="line">            u-&gt;rs = _build(k+<span class="number">1</span>, R, Rsize), u-&gt;extend(u-&gt;rs);</div><div class="line">        &#125;		</div><div class="line">        <span class="keyword">return</span> u;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build_tree</span><span class="params">(Seg s[], <span class="keyword">int</span> m)</span> </span>&#123;</div><div class="line">        size = <span class="number">0</span>;</div><div class="line">        root = _build(<span class="number">0</span>, s, m);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    Pt q_st, q_ed;</div><div class="line">    <span class="keyword">int</span> q_si;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rayhit</span><span class="params">(Seg &amp;seg)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (seg.s.x == seg.e.x) &#123;</div><div class="line">            <span class="keyword">if</span> (cmpZero(seg.s.x - q_st.x) == <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">double</span> low = min(seg.s.y, seg.e.y);</div><div class="line">                <span class="keyword">if</span> (low &gt; q_st.y &amp;&amp; low &lt; q_ed.y) &#123;</div><div class="line">                    q_ed.y = low;</div><div class="line">                    q_si = seg.i;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (max(seg.s.x, seg.e.x) &lt; q_st.x || min(seg.s.x, seg.e.x) &gt; q_st.x)</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">float</span> y = seg.s.y + (<span class="keyword">float</span>) (seg.e.y - seg.s.y) * (q_st.x - seg.s.x) / (seg.e.x - seg.s.x);</div><div class="line">        <span class="keyword">if</span> (y &gt; q_st.y &amp;&amp; y &lt; q_ed.y) &#123;</div><div class="line">            q_ed.y = y;</div><div class="line">            q_si = seg.i;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">if</span> (u-&gt;lx &gt; q_st.x || u-&gt;rx &lt; q_st.x || u-&gt;ry &lt;= q_st.y || u-&gt;ly &gt;= q_ed.y)</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sn[u - nodes]; i++)</div><div class="line">            rayhit(seg[u - nodes][i]);</div><div class="line">        search(u-&gt;ls);</div><div class="line">        search(u-&gt;ms);</div><div class="line">        search(u-&gt;rs);</div><div class="line">    &#125;</div><div class="line">    pair&lt;<span class="keyword">int</span>, Pt&gt; raycast(Pt st) &#123;</div><div class="line">        q_st = st; </div><div class="line">        q_ed = Pt(st.x, BOX_MX+<span class="number">1</span>);</div><div class="line">        q_si = <span class="number">-1</span>;</div><div class="line">        search(root);</div><div class="line">        <span class="keyword">return</span> &#123;q_si, q_ed&#125;;</div><div class="line">    &#125;</div><div class="line">&#125; tree;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Disjoint</span> &#123;</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">65536</span>;</div><div class="line">    <span class="keyword">uint16_t</span> parent[MAXN], weight[MAXN];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (n &gt;= MAXN)</div><div class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++)</div><div class="line">            parent[i] = i, weight[i] = <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findp</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> parent[x] == x ? x : parent[x] = findp(parent[x]);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">joint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        x = findp(x), y = findp(y);</div><div class="line">        <span class="keyword">if</span> (weight[x] &gt;= weight[y])</div><div class="line">            parent[y] = x, weight[x] += weight[y];</div><div class="line">        <span class="keyword">else</span></div><div class="line">            parent[x] = y, weight[y] += weight[x];</div><div class="line">    &#125;	</div><div class="line">&#125; egroup, sgroup;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n, m, p, q;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d %d %d"</span>, &amp;n, &amp;m, &amp;p, &amp;q) == <span class="number">4</span> &amp;&amp; n) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            <span class="keyword">int</span> x, y;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;x, &amp;y);</div><div class="line">            pts[i] = Pt(x, y);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        sgroup.init(n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="keyword">int</span> st_i, ed_i;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;st_i, &amp;ed_i);</div><div class="line">            st_i--, ed_i--;</div><div class="line">            segs[i] = Seg(pts[st_i], pts[ed_i], i);</div><div class="line">            sgroup.joint(st_i, ed_i);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        segs[m] = Seg(Pt(BOX_MX, BOX_MX), Pt(BOX_MX, -BOX_MX), m), m++;</div><div class="line">        segs[m] = Seg(Pt(BOX_MX, -BOX_MX), Pt(-BOX_MX, -BOX_MX), m), m++;</div><div class="line">        segs[m] = Seg(Pt(-BOX_MX, -BOX_MX), Pt(-BOX_MX, BOX_MX), m), m++;</div><div class="line">        segs[m] = Seg(Pt(-BOX_MX, BOX_MX), Pt(BOX_MX, BOX_MX), m), m++;</div><div class="line">        </div><div class="line">        <span class="keyword">static</span> <span class="built_in">map</span>&lt;Pt, <span class="built_in">vector</span>&lt;pair&lt;Pt, <span class="keyword">uint8_t</span>&gt;&gt;&gt; g; g.clear();</div><div class="line">        <span class="keyword">static</span> <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;Pt&gt;&gt; on_seg; on_seg.clear(); on_seg.resize(m);</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            on_seg[segs[i].i].reserve(<span class="number">4</span>);</div><div class="line">            on_seg[segs[i].i].push_back(segs[i].s);</div><div class="line">            on_seg[segs[i].i].push_back(segs[i].e);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line"><span class="comment">//		for (int i = 0; i &lt; n; i++)</span></div><div class="line"><span class="comment">//			pts[i].println();</span></div><div class="line"><span class="comment">//		for (int i = 0; i &lt; m; i++)</span></div><div class="line"><span class="comment">//			segs[i].println();</span></div><div class="line"></div><div class="line">        tree.build_tree(segs, m);</div><div class="line">        &#123;</div><div class="line">            Pt top[<span class="number">10005</span>];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">                top[i] = pts[i];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">                <span class="keyword">int</span> gid = sgroup.findp(i);</div><div class="line">                <span class="keyword">if</span> (top[gid].y &lt; pts[i].y)</div><div class="line">                    top[gid] = pts[i];</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (sgroup.findp(i) != i)</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">auto</span> p = top[i];</div><div class="line">                <span class="keyword">auto</span> hit = tree.raycast(p);</div><div class="line">                <span class="keyword">if</span> (hit.first &gt;= <span class="number">0</span>) &#123;</div><div class="line">                    on_seg[hit.first].emplace_back(hit.second);</div><div class="line">                    g[p].emplace_back(hit.second, <span class="number">1</span>);</div><div class="line">                    g[hit.second].emplace_back(p, <span class="number">1</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="built_in">vector</span>&lt;Pt&gt; &amp;a = on_seg[i];</div><div class="line">            sort(a.begin(), a.end());</div><div class="line">            a.resize(unique(a.begin(), a.end()) - a.begin());</div><div class="line">            <span class="keyword">auto</span> *prev = &amp;g[a[<span class="number">0</span>]];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; a.size(); j++) &#123;</div><div class="line">                prev-&gt;emplace_back(a[j], <span class="number">0</span>);</div><div class="line">                prev = &amp;g[a[j]];</div><div class="line">                prev-&gt;emplace_back(a[j<span class="number">-1</span>], <span class="number">0</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : g)</div><div class="line">            sort(e.second.begin(), e.second.end(), AngleCmp(e.first));</div><div class="line">        </div><div class="line">        <span class="keyword">static</span> <span class="built_in">map</span>&lt;Pt, <span class="built_in">map</span>&lt;Pt, <span class="keyword">int</span>&gt;&gt; R; R.clear();</div><div class="line">        <span class="keyword">int</span> Rsize = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : g) &#123;</div><div class="line">            <span class="keyword">int</span> sz = e.second.size();</div><div class="line">            <span class="built_in">map</span>&lt;Pt, <span class="keyword">int</span>&gt; &amp;Rg = R[e.first];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;f : e.second) &#123;</div><div class="line">                <span class="keyword">int</span> &amp;eid = Rg[f.first];</div><div class="line">                <span class="keyword">if</span> (eid == <span class="number">0</span>)</div><div class="line">                    eid = ++Rsize;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        egroup.init(Rsize);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : g) &#123;</div><div class="line">            <span class="keyword">int</span> sz = e.second.size();</div><div class="line">            <span class="built_in">map</span>&lt;Pt, <span class="keyword">int</span>&gt; &amp;Rg = R[e.first];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = sz<span class="number">-1</span>, j = <span class="number">0</span>; j &lt; sz; i = j++) &#123;</div><div class="line">                <span class="keyword">int</span> l = R[e.second[i].first][e.first];</div><div class="line">                <span class="keyword">int</span> r = Rg[e.second[j].first];</div><div class="line">                egroup.joint(l, r);</div><div class="line">                <span class="keyword">if</span> (e.second[i].second != <span class="number">0</span>) &#123;</div><div class="line">                    r = Rg[e.second[i].first];</div><div class="line">                    assert(l &gt; <span class="number">0</span> &amp;&amp; r &gt; <span class="number">0</span>);</div><div class="line">                    egroup.joint(l, r);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : g) &#123;</div><div class="line">            <span class="keyword">int</span> sz = e.second.size();</div><div class="line">            <span class="keyword">int</span> n = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sz; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (e.second[i].second == <span class="number">0</span>)</div><div class="line">                    e.second[n++] = e.second[i];</div><div class="line">            &#125;</div><div class="line">            e.second.resize(n);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">static</span> <span class="keyword">int</span> region[<span class="number">65536</span>]; <span class="built_in">memset</span>(region, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="number">0</span>)*Rsize);</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p; i++) &#123;</div><div class="line">            <span class="keyword">float</span> x, y;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%f %f"</span>, &amp;x, &amp;y);</div><div class="line">            pair&lt;<span class="keyword">int</span>, Pt&gt; hit = tree.raycast(Pt(x, y));</div><div class="line">            <span class="keyword">if</span> (hit.first &lt; <span class="number">0</span>)</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">                </div><div class="line">            <span class="keyword">if</span> (g.find(hit.second) != g.end()) &#123;</div><div class="line">                <span class="keyword">auto</span> &amp;adj = g[hit.second];</div><div class="line">                <span class="function">AngleCmp <span class="title">cmp</span><span class="params">(hit.second)</span></span>;</div><div class="line">                <span class="keyword">int</span> pos = <span class="number">0</span>;</div><div class="line">                pair&lt;Pt, <span class="keyword">int</span>&gt; q(Pt(x, y), i+<span class="number">1</span>);</div><div class="line">                pos = lower_bound(adj.begin(), adj.end(), q, cmp) - adj.begin() - <span class="number">1</span>;</div><div class="line">                assert(pos &gt;= <span class="number">0</span>);</div><div class="line">                <span class="keyword">int</span> l = R[adj[pos].first][hit.second];</div><div class="line">                assert(l &gt; <span class="number">0</span>);</div><div class="line">                l = egroup.findp(l);</div><div class="line">                region[l] = i+<span class="number">1</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">auto</span> &amp;adj = on_seg[hit.first];</div><div class="line">                Pt lpt = adj[<span class="number">0</span>], rpt = adj[<span class="number">1</span>];</div><div class="line">                <span class="keyword">int</span> l;</div><div class="line">                <span class="keyword">if</span> (cmpZero(cross(lpt, rpt, Pt(x, y))) &lt;= <span class="number">0</span>)</div><div class="line">                    l = R[lpt][rpt];</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    l = R[rpt][lpt];</div><div class="line">                assert(l &gt; <span class="number">0</span>);</div><div class="line">                l = egroup.findp(l);</div><div class="line">                region[l] = i+<span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; q; i++) &#123;</div><div class="line">            <span class="keyword">float</span> x, y;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%f %f"</span>, &amp;x, &amp;y);</div><div class="line">            pair&lt;<span class="keyword">int</span>, Pt&gt; hit = tree.raycast(Pt(x, y));</div><div class="line">            <span class="keyword">if</span> (hit.first &lt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"0\n"</span>);</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">                </div><div class="line">            <span class="keyword">if</span> (g.find(hit.second) != g.end()) &#123;</div><div class="line">                <span class="keyword">auto</span> &amp;adj = g[hit.second];</div><div class="line">                <span class="function">AngleCmp <span class="title">cmp</span><span class="params">(hit.second)</span></span>;</div><div class="line">                <span class="keyword">int</span> pos = <span class="number">0</span>;</div><div class="line">                pair&lt;Pt, <span class="keyword">int</span>&gt; q(Pt(x, y), i+<span class="number">1</span>);</div><div class="line">                pos = lower_bound(adj.begin(), adj.end(), q, cmp) - adj.begin() - <span class="number">1</span>;</div><div class="line">                assert(pos &gt;= <span class="number">0</span>);</div><div class="line">                <span class="keyword">int</span> l = R[adj[pos].first][hit.second];</div><div class="line">                assert(l &gt; <span class="number">0</span>);</div><div class="line">                l = egroup.findp(l);</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, region[l]);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">auto</span> &amp;adj = on_seg[hit.first];</div><div class="line">                Pt lpt = adj[<span class="number">0</span>], rpt = adj[<span class="number">1</span>];</div><div class="line">                <span class="keyword">int</span> l;</div><div class="line">                <span class="keyword">if</span> (cmpZero(cross(lpt, rpt, Pt(x, y))) &lt;= <span class="number">0</span>)</div><div class="line">                    l = R[lpt][rpt];</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    l = R[rpt][lpt];</div><div class="line">                assert(l &gt; <span class="number">0</span>);</div><div class="line">                l = egroup.findp(l);</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, region[l]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="線段樹"><a href="#線段樹" class="headerlink" title="線段樹"></a>線段樹</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt; </span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-8</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">double</span> BOX_MX = (<span class="number">3000000</span>);</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> AUXID = <span class="number">200000</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pt</span> &#123;</span></div><div class="line">    <span class="keyword">double</span> x, y;</div><div class="line">    Pt(<span class="keyword">double</span> a = <span class="number">0</span>, <span class="keyword">double</span> b = <span class="number">0</span>): x(a), y(b) &#123;&#125;</div><div class="line">    Pt <span class="keyword">operator</span>-(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Pt(x - a.x, y - a.y); &#125;</div><div class="line">    Pt <span class="keyword">operator</span>+(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Pt(x + a.x, y + a.y); &#125;</div><div class="line">    Pt <span class="keyword">operator</span>*(<span class="keyword">const</span> <span class="keyword">double</span> a) <span class="keyword">const</span> &#123; <span class="keyword">return</span> Pt(x * a, y * a);  &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">fabs</span>(x - a.x) &gt; eps)	<span class="keyword">return</span> x &lt; a.x;</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">fabs</span>(y - a.y) &gt; eps)	<span class="keyword">return</span> y &lt; a.y;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">fabs</span>(x - a.x) &lt; eps &amp;&amp; <span class="built_in">fabs</span>(y - a.y) &lt; eps;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">println</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">    	<span class="built_in">printf</span>(<span class="string">"(%lf, %lf)\n"</span>, x, y);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Seg</span> &#123;</span></div><div class="line">    Pt s, e;</div><div class="line">    <span class="keyword">int</span> i;</div><div class="line">    Seg() &#123;&#125;</div><div class="line">    Seg(Pt a, Pt b, <span class="keyword">int</span> i):s(a), e(b), i(i) &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">println</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">    	<span class="built_in">printf</span>(<span class="string">"Segment((%lf, %lf), (%lf, %lf))\n"</span>, s.x, s.y, e.x, e.y);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">dot</span><span class="params">(Pt a, Pt b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> a.x * b.x + a.y * b.y;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">cross</span><span class="params">(Pt o, Pt a, Pt b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (a.x-o.x)*(b.y-o.y)-(a.y-o.y)*(b.x-o.x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">cross2</span><span class="params">(Pt a, Pt b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> a.x * b.y - a.y * b.x;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">between</span><span class="params">(Pt a, Pt b, Pt c)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> dot(c - a, b - a) &gt;= -eps &amp;&amp; dot(c - b, a - b) &gt;= -eps;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">onSeg</span><span class="params">(Pt a, Pt b, Pt c)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> between(a, b, c) &amp;&amp; <span class="built_in">fabs</span>(cross(a, b, c)) &lt; eps;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmpZero</span><span class="params">(<span class="keyword">double</span> v)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="built_in">fabs</span>(v) &gt; eps) <span class="keyword">return</span> v &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">-1</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Pt <span class="title">getIntersect</span><span class="params">(Seg a, Seg b)</span> </span>&#123;</div><div class="line">    Pt u = a.s - b.s;</div><div class="line">    <span class="keyword">double</span> t = cross2(b.e - b.s, u)/cross2(a.e - a.s, b.e - b.s);</div><div class="line">    <span class="keyword">return</span> a.s + (a.e - a.s) * t;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AngleCmp</span> &#123;</span></div><div class="line">    Pt o;</div><div class="line">    AngleCmp(Pt o = Pt()):o(o) &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="keyword">const</span> pair&lt;Pt, <span class="keyword">int</span>&gt;&amp; ppa, <span class="keyword">const</span> pair&lt;Pt, <span class="keyword">int</span>&gt;&amp; ppb)</span> </span>&#123;</div><div class="line">        Pt pa = ppa.first, pb = ppb.first;</div><div class="line">        Pt p1 = pa - o, p2 = pb - o;</div><div class="line">        <span class="keyword">if</span> (p1.y == <span class="number">0</span> &amp;&amp; p2.y == <span class="number">0</span> &amp;&amp; p1.x * p2.x &lt;= <span class="number">0</span>) <span class="keyword">return</span> p1.x &gt; p2.x;</div><div class="line">        <span class="keyword">if</span> (p1.y == <span class="number">0</span> &amp;&amp; p1.x &gt;= <span class="number">0</span> &amp;&amp; p2.y != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">        <span class="keyword">if</span> (p2.y == <span class="number">0</span> &amp;&amp; p2.x &gt;= <span class="number">0</span> &amp;&amp; p1.y != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span> (p1.y * p2.y &lt; <span class="number">0</span>) <span class="keyword">return</span> p1.y &gt; p2.y;</div><div class="line">        <span class="keyword">double</span> c = cross2(p1, p2);</div><div class="line">        <span class="keyword">return</span> c &gt; <span class="number">0</span> || (c == <span class="number">0</span> &amp;&amp; <span class="built_in">fabs</span>(p1.x) &lt; <span class="built_in">fabs</span>(p2.x));</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">static</span> Pt pts[<span class="number">10005</span>];</div><div class="line"><span class="keyword">static</span> Seg segs[<span class="number">30005</span>];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">double</span> <span class="title">interpolate</span><span class="params">(<span class="keyword">const</span> Pt&amp; p1, <span class="keyword">const</span> Pt&amp; p2, <span class="keyword">double</span>&amp; x)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (cmpZero(p1.x - p2.x) == <span class="number">0</span>) <span class="keyword">return</span> min(p1.y, p2.y);</div><div class="line">    <span class="keyword">return</span> p1.y + (<span class="keyword">double</span>)(p2.y - p1.y) / (p2.x - p1.x) * (x - p1.x);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CMP</span> &#123;</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">double</span> x;	    </div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="keyword">const</span> Seg &amp;i, <span class="keyword">const</span> Seg &amp;j)</span> </span>&#123;</div><div class="line">    	<span class="keyword">double</span> l = interpolate(i.s, i.e, x);</div><div class="line">    	<span class="keyword">double</span> r = interpolate(j.s, j.e, x);</div><div class="line">        <span class="keyword">return</span> l &lt; r;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">double</span> CMP::x;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BSP</span> &#123;</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">        <span class="keyword">double</span> ly, ry;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">            ly = BOX_MX, ry = -BOX_MX;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">extend</span><span class="params">(Node *u)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (u == <span class="literal">NULL</span>)</div><div class="line">                <span class="keyword">return</span> ;</div><div class="line">            ly = min(ly, u-&gt;ly);</div><div class="line">            ry = max(ry, u-&gt;ry);</div><div class="line">        &#125;</div><div class="line">    &#125; bbox[<span class="number">262144</span>];</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt; x;</div><div class="line">    <span class="built_in">set</span>&lt;Seg, CMP&gt; tree[<span class="number">524288</span>];</div><div class="line">    Seg segs[<span class="number">262144</span>];</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">        tree[k].clear();</div><div class="line">        bbox[k].init();</div><div class="line">        <span class="keyword">if</span> (l+<span class="number">1</span> &gt;= r)</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</div><div class="line">        clear(k&lt;&lt;<span class="number">1</span>, l, m);</div><div class="line">        clear(k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m, r);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Seg &amp;s, <span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (s.s.x &lt;= x[l] &amp;&amp; x[r] &lt;= s.e.x) &#123;</div><div class="line">            CMP::x = (x[l] + x[r])/<span class="number">2</span>;</div><div class="line">            tree[k].insert(s);</div><div class="line">            <span class="keyword">double</span> ly = interpolate(s.s, s.e, x[l]);</div><div class="line">            <span class="keyword">double</span> ry = interpolate(s.s, s.e, x[r]);</div><div class="line">            bbox[k].ly = min(bbox[k].ly, min(ly, ry));</div><div class="line">            bbox[k].ry = max(bbox[k].ry, max(ly, ry));</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (l+<span class="number">1</span> &gt;= r)</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</div><div class="line">        <span class="keyword">if</span> (s.s.x &lt;= x[m]) &#123;</div><div class="line">            insert(s, k&lt;&lt;<span class="number">1</span>, l, m);</div><div class="line">            bbox[k].extend(&amp;bbox[k&lt;&lt;<span class="number">1</span>]);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (s.e.x &gt; x[m]) &#123;</div><div class="line">            insert(s, k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m, r);</div><div class="line">            bbox[k].extend(&amp;bbox[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build_tree</span><span class="params">(Seg s[], <span class="keyword">int</span> m)</span> </span>&#123;</div><div class="line">        <span class="built_in">memcpy</span>(segs, s, <span class="keyword">sizeof</span>(segs[<span class="number">0</span>])*m);</div><div class="line">        </div><div class="line">        x.clear();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</div><div class="line">            x.push_back(segs[i].s.x), x.push_back(segs[i].e.x);</div><div class="line">        sort(x.begin(), x.end());</div><div class="line">        x.resize(unique(x.begin(), x.end()) - x.begin());</div><div class="line">        </div><div class="line">        clear(<span class="number">1</span>, <span class="number">0</span>, x.size()<span class="number">-1</span>);</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (segs[i].s.x &gt; segs[i].e.x)</div><div class="line">                swap(segs[i].s, segs[i].e);</div><div class="line">            <span class="keyword">if</span> (segs[i].s.x &lt; segs[i].e.x)</div><div class="line">                insert(segs[i], <span class="number">1</span>, <span class="number">0</span>, x.size()<span class="number">-1</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    Pt q_st, q_ed;</div><div class="line">    <span class="keyword">int</span> q_si;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (bbox[k].ly &gt;= q_ed.y || bbox[k].ry &lt;= q_st.y)</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">if</span> (x[l] &lt;= q_st.x &amp;&amp; q_st.x &lt;= x[r]) &#123;</div><div class="line">            CMP::x = q_st.x;</div><div class="line">            <span class="keyword">auto</span> it = tree[k].upper_bound(Seg(q_st, q_st, <span class="number">0</span>));</div><div class="line">            <span class="keyword">while</span> (it != tree[k].end()) &#123;</div><div class="line">                <span class="keyword">double</span> y = interpolate(it-&gt;s, it-&gt;e, CMP::x);</div><div class="line">                <span class="keyword">if</span> (y &gt; q_st.y) &#123;</div><div class="line">                    <span class="keyword">if</span> (y &lt; q_ed.y) &#123;</div><div class="line">                        q_ed.y = y;</div><div class="line">                        q_si = it-&gt;i;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                it++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (l+<span class="number">1</span> &gt;= r)</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</div><div class="line">        <span class="keyword">if</span> (q_st.x &lt;= x[m])</div><div class="line">            search(k&lt;&lt;<span class="number">1</span>, l, m);</div><div class="line">        <span class="keyword">if</span> (q_st.x &gt;= x[m])</div><div class="line">            search(k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m, r);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    pair&lt;<span class="keyword">int</span>, Pt&gt; raycast(Pt st) &#123;</div><div class="line">        q_st = st; </div><div class="line">        q_ed = Pt(st.x, BOX_MX+<span class="number">1</span>);</div><div class="line">        q_si = <span class="number">-1</span>;</div><div class="line">        search(<span class="number">1</span>, <span class="number">0</span>, x.size()<span class="number">-1</span>);</div><div class="line">        <span class="keyword">return</span> &#123;q_si, q_ed&#125;;</div><div class="line">    &#125;</div><div class="line">&#125; tree;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Disjoint</span> &#123;</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">65536</span>;</div><div class="line">    <span class="keyword">uint16_t</span> parent[MAXN], weight[MAXN];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (n &gt;= MAXN)</div><div class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++)</div><div class="line">            parent[i] = i, weight[i] = <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findp</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> parent[x] == x ? x : parent[x] = findp(parent[x]);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">joint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        x = findp(x), y = findp(y);</div><div class="line">        <span class="keyword">if</span> (weight[x] &gt;= weight[y])</div><div class="line">            parent[y] = x, weight[x] += weight[y];</div><div class="line">        <span class="keyword">else</span></div><div class="line">            parent[x] = y, weight[y] += weight[x];</div><div class="line">    &#125;	</div><div class="line">&#125; egroup, sgroup;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n, m, p, q;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d %d %d"</span>, &amp;n, &amp;m, &amp;p, &amp;q) == <span class="number">4</span> &amp;&amp; n) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            <span class="keyword">int</span> x, y;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;x, &amp;y);</div><div class="line">            pts[i] = Pt(x, y);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        sgroup.init(n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="keyword">int</span> st_i, ed_i;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;st_i, &amp;ed_i);</div><div class="line">            st_i--, ed_i--;</div><div class="line">            segs[i] = Seg(pts[st_i], pts[ed_i], i);</div><div class="line">            sgroup.joint(st_i, ed_i);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        segs[m] = Seg(Pt(BOX_MX, BOX_MX), Pt(BOX_MX, -BOX_MX), m), m++;</div><div class="line">        segs[m] = Seg(Pt(BOX_MX, -BOX_MX), Pt(-BOX_MX, -BOX_MX), m), m++;</div><div class="line">        segs[m] = Seg(Pt(-BOX_MX, -BOX_MX), Pt(-BOX_MX, BOX_MX), m), m++;</div><div class="line">        segs[m] = Seg(Pt(-BOX_MX, BOX_MX), Pt(BOX_MX, BOX_MX), m), m++;</div><div class="line">        </div><div class="line">        <span class="keyword">static</span> <span class="built_in">map</span>&lt;Pt, <span class="built_in">vector</span>&lt;pair&lt;Pt, <span class="keyword">uint8_t</span>&gt;&gt;&gt; g; g.clear();</div><div class="line">        <span class="keyword">static</span> <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;Pt&gt;&gt; on_seg; on_seg.clear(); on_seg.resize(m);</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            on_seg[segs[i].i].reserve(<span class="number">4</span>);</div><div class="line">            on_seg[segs[i].i].push_back(segs[i].s);</div><div class="line">            on_seg[segs[i].i].push_back(segs[i].e);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line"><span class="comment">//		for (int i = 0; i &lt; n; i++)</span></div><div class="line"><span class="comment">//			pts[i].println();</span></div><div class="line"><span class="comment">//		for (int i = 0; i &lt; m; i++)</span></div><div class="line"><span class="comment">//			segs[i].println();</span></div><div class="line"></div><div class="line">        tree.build_tree(segs, m);</div><div class="line">        &#123;</div><div class="line">            Pt top[<span class="number">10005</span>];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">                top[i] = pts[i];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">                <span class="keyword">int</span> gid = sgroup.findp(i);</div><div class="line">                <span class="keyword">if</span> (top[gid].y &lt; pts[i].y)</div><div class="line">                    top[gid] = pts[i];</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (sgroup.findp(i) != i)</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">auto</span> p = top[i];</div><div class="line">                <span class="keyword">auto</span> hit = tree.raycast(p);</div><div class="line">                <span class="keyword">if</span> (hit.first &gt;= <span class="number">0</span>) &#123;</div><div class="line">                    on_seg[hit.first].emplace_back(hit.second);</div><div class="line">                    g[p].emplace_back(hit.second, <span class="number">1</span>);</div><div class="line">                    g[hit.second].emplace_back(p, <span class="number">1</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="built_in">vector</span>&lt;Pt&gt; &amp;a = on_seg[i];</div><div class="line">            sort(a.begin(), a.end());</div><div class="line">            a.resize(unique(a.begin(), a.end()) - a.begin());</div><div class="line">            <span class="keyword">auto</span> *prev = &amp;g[a[<span class="number">0</span>]];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; a.size(); j++) &#123;</div><div class="line">                prev-&gt;emplace_back(a[j], <span class="number">0</span>);</div><div class="line">                prev = &amp;g[a[j]];</div><div class="line">                prev-&gt;emplace_back(a[j<span class="number">-1</span>], <span class="number">0</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : g)</div><div class="line">            sort(e.second.begin(), e.second.end(), AngleCmp(e.first));</div><div class="line">        </div><div class="line">        <span class="keyword">static</span> <span class="built_in">map</span>&lt;Pt, <span class="built_in">map</span>&lt;Pt, <span class="keyword">int</span>&gt;&gt; R; R.clear();</div><div class="line">        <span class="keyword">int</span> Rsize = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : g) &#123;</div><div class="line">            <span class="keyword">int</span> sz = e.second.size();</div><div class="line">            <span class="built_in">map</span>&lt;Pt, <span class="keyword">int</span>&gt; &amp;Rg = R[e.first];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;f : e.second) &#123;</div><div class="line">                <span class="keyword">int</span> &amp;eid = Rg[f.first];</div><div class="line">                <span class="keyword">if</span> (eid == <span class="number">0</span>)</div><div class="line">                    eid = ++Rsize;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        egroup.init(Rsize);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : g) &#123;</div><div class="line">            <span class="keyword">int</span> sz = e.second.size();</div><div class="line">            <span class="built_in">map</span>&lt;Pt, <span class="keyword">int</span>&gt; &amp;Rg = R[e.first];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = sz<span class="number">-1</span>, j = <span class="number">0</span>; j &lt; sz; i = j++) &#123;</div><div class="line">                <span class="keyword">int</span> l = R[e.second[i].first][e.first];</div><div class="line">                <span class="keyword">int</span> r = Rg[e.second[j].first];</div><div class="line">                egroup.joint(l, r);</div><div class="line">                <span class="keyword">if</span> (e.second[i].second != <span class="number">0</span>) &#123;</div><div class="line">                    r = Rg[e.second[i].first];</div><div class="line">                    assert(l &gt; <span class="number">0</span> &amp;&amp; r &gt; <span class="number">0</span>);</div><div class="line">                    egroup.joint(l, r);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : g) &#123;</div><div class="line">            <span class="keyword">int</span> sz = e.second.size();</div><div class="line">            <span class="keyword">int</span> n = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sz; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (e.second[i].second == <span class="number">0</span>)</div><div class="line">                    e.second[n++] = e.second[i];</div><div class="line">            &#125;</div><div class="line">            e.second.resize(n);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">static</span> <span class="keyword">int</span> region[<span class="number">65536</span>]; <span class="built_in">memset</span>(region, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="number">0</span>)*Rsize);</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p; i++) &#123;</div><div class="line">            <span class="keyword">float</span> x, y;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%f %f"</span>, &amp;x, &amp;y);</div><div class="line">            pair&lt;<span class="keyword">int</span>, Pt&gt; hit = tree.raycast(Pt(x, y));</div><div class="line">            <span class="keyword">if</span> (hit.first &lt; <span class="number">0</span>)</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">                </div><div class="line">            <span class="keyword">if</span> (g.find(hit.second) != g.end()) &#123;</div><div class="line">                <span class="keyword">auto</span> &amp;adj = g[hit.second];</div><div class="line">                <span class="function">AngleCmp <span class="title">cmp</span><span class="params">(hit.second)</span></span>;</div><div class="line">                <span class="keyword">int</span> pos = <span class="number">0</span>;</div><div class="line">                pair&lt;Pt, <span class="keyword">int</span>&gt; q(Pt(x, y), i+<span class="number">1</span>);</div><div class="line">                pos = lower_bound(adj.begin(), adj.end(), q, cmp) - adj.begin() - <span class="number">1</span>;</div><div class="line">                assert(pos &gt;= <span class="number">0</span>);</div><div class="line">                <span class="keyword">int</span> l = R[adj[pos].first][hit.second];</div><div class="line">                assert(l &gt; <span class="number">0</span>);</div><div class="line">                l = egroup.findp(l);</div><div class="line">                region[l] = i+<span class="number">1</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">auto</span> &amp;adj = on_seg[hit.first];</div><div class="line">                Pt lpt = adj[<span class="number">0</span>], rpt = adj[<span class="number">1</span>];</div><div class="line">                <span class="keyword">int</span> l;</div><div class="line">                <span class="keyword">if</span> (cmpZero(cross(lpt, rpt, Pt(x, y))) &lt;= <span class="number">0</span>)</div><div class="line">                    l = R[lpt][rpt];</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    l = R[rpt][lpt];</div><div class="line">                assert(l &gt; <span class="number">0</span>);</div><div class="line">                l = egroup.findp(l);</div><div class="line">                region[l] = i+<span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; q; i++) &#123;</div><div class="line">            <span class="keyword">float</span> x, y;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%f %f"</span>, &amp;x, &amp;y);</div><div class="line">            pair&lt;<span class="keyword">int</span>, Pt&gt; hit = tree.raycast(Pt(x, y));</div><div class="line">            <span class="keyword">if</span> (hit.first &lt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"0\n"</span>);</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">                </div><div class="line">            <span class="keyword">if</span> (g.find(hit.second) != g.end()) &#123;</div><div class="line">                <span class="keyword">auto</span> &amp;adj = g[hit.second];</div><div class="line">                <span class="function">AngleCmp <span class="title">cmp</span><span class="params">(hit.second)</span></span>;</div><div class="line">                <span class="keyword">int</span> pos = <span class="number">0</span>;</div><div class="line">                pair&lt;Pt, <span class="keyword">int</span>&gt; q(Pt(x, y), i+<span class="number">1</span>);</div><div class="line">                pos = lower_bound(adj.begin(), adj.end(), q, cmp) - adj.begin() - <span class="number">1</span>;</div><div class="line">                assert(pos &gt;= <span class="number">0</span>);</div><div class="line">                <span class="keyword">int</span> l = R[adj[pos].first][hit.second];</div><div class="line">                assert(l &gt; <span class="number">0</span>);</div><div class="line">                l = egroup.findp(l);</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, region[l]);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">auto</span> &amp;adj = on_seg[hit.first];</div><div class="line">                Pt lpt = adj[<span class="number">0</span>], rpt = adj[<span class="number">1</span>];</div><div class="line">                <span class="keyword">int</span> l;</div><div class="line">                <span class="keyword">if</span> (cmpZero(cross(lpt, rpt, Pt(x, y))) &lt;= <span class="number">0</span>)</div><div class="line">                    l = R[lpt][rpt];</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    l = R[rpt][lpt];</div><div class="line">                assert(l &gt; <span class="number">0</span>);</div><div class="line">                l = egroup.findp(l);</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, region[l]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-diary-201709-military-life" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/15/diary-201709-military-life/" class="article-date">
  <time datetime="2017-10-15T08:02:43.000Z" itemprop="datePublished">2017-10-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/15/diary-201709-military-life/">十二天軍旅生活 (前)</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/10/15/diary-201709-military-life/" data-id="ckvd6e82h003x9cvn4xukzz6i" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/10/15/diary-201709-military-life/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="畢業至當兵前"><a href="#畢業至當兵前" class="headerlink" title="畢業至當兵前"></a>畢業至當兵前</h2><p>結束研究所離校手續後，便回到家裡等兵單。某方面來說不算等兵單，研發替代役可以上網填入營日期，選擇適合自己的梯次入伍即可。彌補好幾個寒暑假都沒回家的罪過，於是跑去報名汽車駕訓班，沒想到現在學開車外加考照要一個多月，那麼先前填的入伍時間來不及，在確定報名的日期前修改即可，往後延了一個梯次，直到九月中才進去服<strong>十二天</strong>的新訓。</p>
<h3 id="駕訓班"><a href="#駕訓班" class="headerlink" title="駕訓班"></a>駕訓班</h3><p>在這一個多月間，駕訓班平均兩天上一次課，每天排課差不多都是早上八、九點，其中突然有一陣子沒辦法練車，因為有某一梯次的學員要進行考試，好幾天就空著練筆試。上班時期才去學開車也許是個艱難的選項，而我們花蓮的駕訓班排課好像只到晚上六點，想必下班也會來不及。與公司、役政署那邊確定好時間，也要把這一人生階段任務完成。</p>
<p>大家都說以前駕訓班就學手排車，於是一開始學手排車，後來發現對離合器的協調性不足，換自排車繼續學。開了手排車幾堂課，轉換到自排車就覺得相當簡單，自排車比較不會打錯檔位，也許是因為檔位設計的問題吧！哪天教練車高檔一點說不定就好辦了。咱這點自尊先捨棄吧。</p>
<p>不曉得其他駕訓班是怎麼教開車，背口訣打方向盤的圈數、看後照鏡與標線之間的關係，一開始總是憑感覺打方向盤，結果常常被教練說嘴。心想那些口訣換了車就不一樣，而且每個人坐在駕駛坐看到的視角關係也不致相同，我到底該信什麼才好？內心好煎熬啊。</p>
<p>有時開車兩個人輪流開一台車，兩個學員相互看開車的情況，也不知道為什麼幾乎都是女孩子，而且開車技術都還算不錯，像頭文字 D 那般的快速打檔，感覺平常就有開車，坐在一旁都好佩服。後來才發現教練幾乎都帶女生，怪不得安排上都是跟女生居多。開 S 灣的時候壓到線時，當一旁人的一言不發，腦補病患可承受不住的。</p>
<p>直到考試當日，當日早上八點集合帶去監理站考試，筆試背罰金額度的總是相當惱人，那一天死記活拚也弄了個 97.5 分，明明不該是這麼困難的項目，帶著沒拿到滿分的遺憾迎來下午的場內考試。場內考試依舊是各教練分開安排，排隊上車進行測驗，由於監理站人手不足，其他教練評分時仍有全程攝影，待考生坐在後座看前一個考生跑完全程，六十多個人坐在安全島上等待考試。各自帶開後，不出所料這島都是女生，而另一頭都是男生，教練們的合格率賭盤就開始了！不得不說，大部分人都是考自排車，非常少數的人考手排車，大部分上坡起步退場的也都是手排車。</p>
<p>一般而言，大家都以為這樣就結束。「不是的」，像我這種總是可以走到特殊路線的人而言，恰好多了<strong>道路駕駛</strong>考試，也就是在今年六月開始強制上路的考試，必須在外頭繞一圈合格後才能拿到駕照。好在是在花蓮考試，如果在台北考道路駕駛也許不堪設想。開車出去前要口頭報出車況，我永遠不能明白當初定說要檢查車底的高就在想什麼，要蹲下去看車底高喊「<strong>車底無異物</strong>」，並且是車子四個方位都要走過去喊，想必在外頭沒有一個人可以做到這一點。為了安全考量看一次，但看到四次只有強迫症患者做得到吧。</p>
<p>說起如何練習道路考試，那是一件很有趣的故事，一般人會想說教練會帶著進行<strong>第一次</strong>的練習，結果我們教練要求讓家長帶我們去開過一次考試路線，不是家長開給你開，而是你開給家長看。多嚇過幾輪後，教練才會帶你出去練車。然而，礙於其他因素就沒拜託老爸帶我去開。於是－第一次開車上路，沒有經驗的我開車載妹子出去啦，教練還說「把這當載老婆小孩，一句話都不會說，你得一個人開車。」，幸好平安落幕。隨後幾次練車，曾跟著奇葩一起，坐在後頭都會嚇死，教練說道「<strong>輕踩壓車減速</strong>」，心中吶喊「等等，咱們突然停在路上，停了，真的停了」，原來他沒有騎過機車、腳踏車上路的經驗，當初還以為大家都會騎機車才考汽車，這世界還是很奇妙的。</p>
<p>拉著老爸練了一周的車，考試當天等了三個多小時才輪到最後一個我，坐在前一個考生後頭時，從頭到尾一直在喊「饒了咱吧，快把你的雙手放開，疊在一起放在方向盤上搖來搖去，咱的心臟要受不了」一個急轉彎壓了慢車道過去，全程超速駕駛，考官全程也不能說話，不知道那樣子還算過嗎。等到我開完路線，監考官叫我多開一段路回駕訓班，那時教練們聚著才開始抱怨「現在的年輕人啊…」</p>
<p>老爸拉著我去開台9、台11線，中間繞光豐公路，練習在山路上轉方向盤，開車還要閃遊覽車之類的驚悚橋段，一旁就是山溝，還有道路坍方的單向道，想起來還是得再多多加強。要練到開山路不踩剎車，再開始載人？</p>
<h3 id="練身體"><a href="#練身體" class="headerlink" title="練身體"></a>練身體</h3><p>雖然這年頭研發替代役只有十二天的新訓，人生這一階段還是練練身體。每天下午跑去附近公園跑個六、七圈，順便拉著老爸去運動。</p>
<p>覺得慢跑的最重要因素還是腿部和腰部肌肉。高中時間肥到 76kg 時，跑個 1600m 都覺得辛苦，剛上大學覺得自己是個一無是處廢物，大一的生活就有固定跑到宿舍旁邊的操場運動，「因為太廢了，這八圈是懲罰」<br>。然而，轉學後就一陣子沒運動，直到大三開始跟轉學生學長一起住，瘋了才去跑校園兩圈練半半馬 10km，後來還真的跑去參加半半馬，一個人在人群中擠來擠去。但上了研究所兩年完全沒運動過，每天走三十分鐘往返學校而已。突然跑起 3000m 還是很刺激的，調個一周才讓大腿適應。</p>
<p>後來被老爸抓去<strong>花蓮太平洋公園</strong>旁的道路跑步，第一次在下午三點太陽正熱，即使有海風吹著跑起來還是相當折磨，單程約有 2km，來回跑就有四公里多，在海邊跑步如此現充？不對，觀光客騎腳踏車、機車超輕鬆的從你旁邊呼嘯而過，而你只有看著狹長的海岸線估算要以何種步伐才得以抵達盡頭的份。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-diary-201707" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/08/diary-201707/" class="article-date">
  <time datetime="2017-07-08T10:54:36.000Z" itemprop="datePublished">2017-07-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/shCb0QO.jpg" rel="gallery_ckvd6e82g003u9cvnwmfkku0j">
        <img src="http://i.imgur.com/shCb0QO.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/08/diary-201707/">吶，還記得我們的「約定」嗎</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/07/08/diary-201707/" data-id="ckvd6e82g003u9cvnwmfkku0j" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/07/08/diary-201707/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="長途跋涉"><a href="#長途跋涉" class="headerlink" title="長途跋涉"></a>長途跋涉</h2><p>碩二下的剩餘幾個月裡，一般情況在口試前一個月開始把實驗補齊，前一週才把論文寫完，隨後口試完，再花個兩三週把論文丟到圖書館後離校，以上是一般碩士生的的常態生活，而我可能就有一點特別。碩二上學期結束時把論文概要想完，過年把中文論文寫個草稿，下學期便耗費數幾個月與老師來來回回地改了好幾輪，一下子就來到了學期結束。</p>
<p><img src="http://i.imgur.com/Pdusran.jpg" alt="「長篇化就拜託你了」－《情色漫畫老師》"></p>
<p>不得不說，內容改了好幾個月，把一些不太想說明、為什麼要說的部分釐清變得相當困難，大部分不想說明的內容、晦暗不明的語句依依剝離出來，反反覆覆地增加了四十幾張圖片，使用 Tikz 這等套件畫圖，可說是相當痛苦得一件事情，一張圖片可能就要花一整個早上來完成。</p>
<p>細節實作的「道理」與其實驗結果，逐一補上「為什麼要這麼做」、「為什麼會快」、「為什麼選用這種方法」諸如此類的問題。在撰寫時只覺得這麼做是對的，感覺上沒有錯，實驗上可以驗證是對的，一被問起來仍是一臉茫然地不知如何說明，還得回去思考到底要怎麼說才能容易明白。</p>
<p><img src="http://i.imgur.com/lm5A5Ro.jpg" alt="「這不是超過 100 頁了嗎？」－《情色漫畫老師》"></p>
<p>一路寫到五月底，而六月初口試的當下，口試現場來了四個教授來聽，相較於學長那時的三人排場的確更盛大點。壓縮簡報內容至一百頁內的投影片，才可能在四十分鐘內講完呢。那些不想細講的內容，在論文裡不說又會被老師要求，口試的時候能不能不說？百感交集下，硬著頭皮一路殺下去講純資料結構和算法的改進，對於一般做計畫而生的論文，我的內容肯定很無趣吧。要是我能強一點就好了。</p>
<p><img src="http://i.imgur.com/CSVvyzf.jpg" alt="「要是我能更強就好了」－《夏目友人帳》"></p>
<p>講完近一個小時的成果發表，講累的我還一度沒聽懂要開離教室，等待委員商議是否能通過的會議，口試的評分表不知道是以怎麼方式運行，坐在教室外的我焦慮地等待，心想「是不是做的內容有些瑕疵，還是已經有人做過了？還是內容不足以作為一個碩士研究？」</p>
<p>教室那鎖不好的木門聲響起「嘣」一聲，老師從門口向著我說「下去把 XX 一起叫上來」，走下樓把一起口試的同學都叫來教室，才聽到「恭喜你們通過口試」，讀了兩年就等待這一句話，那究竟是怎麼樣的體驗，感覺有點不切實際，就這樣子了？</p>
<p><img src="http://i.imgur.com/QtLx3Ns.jpg" alt="「這是奇蹟」－《正解的卡多》"></p>
<p>儘管已經提早口試，內心再怎麼雀躍，也無法順心地馬上離開這裡，每天依舊來來學校做點雜事，「鈴～鈴～」實驗室電話一響，電話那一頭「有其他人在嗎？那個誰在嗎？麻煩上來一下」，早上十點半的我只能無奈地「誰也不在，現在只有我」，收到「好吧，那你上來」的日常似乎沒有太大的差異。</p>
<p>口試通過後，就該加緊腳步離校了對吧？離校的兩大關卡——口試審定書和離校同意書，過了一關後，還有一關無法通過，那要怎麼通過老師給的離校同意書呢？方法可說是千奇百種啊，男生的最終武器應該是兵單吧，不然總是問最晚什麼時候你才會離開而避開要簽離校，也許還有另一種可能，讓老師覺得「留你也沒用」，幻想著跟老師說「老師啊，就算沒有我，地球也照樣繼續轉，留我做什麼呢？」</p>
<p><img src="http://i.imgur.com/vxjEtv7.jpg" alt="「就算沒有我，地球也照樣繼續轉」—《櫻花任務》"></p>
<p>六月初那時，別老是問我「為什麼不走？」，心想「如果能走的話，早就離開了」，這麼能輕易明白的道理，在我身上就這麼難以理解，萬事皆有因，而螢幕前的你是否能理解我呢？看著行事曆上的工作吧，「六月十九日，校定期末考週」這下明白了吧，原本以為可以託付給學弟撐著弄分散式部分，沒想到碩一期末時期這麼忙碌，弄個作業就兩三天不見人影，實驗室好幾週進入三班工作制。</p>
<p>撐過了幾週的工作準備和實驗環境修整，期末考週終於可以好好休息，考題總要給老師弄好，助教輕鬆地去監考就行了。期末考當天監考完，由於沒有確切的參考答案，當下也不知道怎麼向同學描述怎麼寫才是對的，要提示到哪種地步，當下感慨萬分，「對不起，這裡你要自己想，我不清楚」。</p>
<p>原以為老師很快就可以改好考卷，沒想到突如其來的論文 deadline，使得改考卷一事被拖延，然而送成績又是一週後的事情，先放個三天讓老師去改。催一下進度，發現一題也沒改完，先改了兩題，剩下的題目再給老師改。在放個兩天，還是沒有太多的進展，再跟老師要了兩題來改，到最後還是由我改了大部分的題目，為 … 為什麼會變成那樣？</p>
<p><img src="http://i.imgur.com/2B6vJgj.jpg" alt="「為 ... 為什麼會變成那樣」－《情色漫畫老師》"></p>
<p>七月初到，仍然沒有辦法離開學校，事情接踵而來，弄完轉系考才能離開，又有實驗室經費要花，交代事情的當下只有我在學校，「嗯？怎麼？」對於研究生要在一早十點九點到實驗室，想必是個相當難的議題，學長們可是曾經全員不在而被叫上去罵呢，而我嘗試支持了一年多，電話從我座位旁響起到接起已成為最佳化的結果。在空無一人的早晨接電話，對於指定任務交代給尚未清醒的學弟等。買伺服器時，得再三催廠商寄送發票；買耗材時，得催學弟別忘記。</p>
<p><img src="http://i.imgur.com/OhT853a.jpg" alt="「太奇怪了」－《愛麗絲與藏六》"></p>
<p>終於到辦公室跟老師提了兵單，才從老師口中說出「下週會簽離校，順便回去實驗室跟他們說」一回到實驗室說，便聽到「為什麼老師不願意簽我離校啦」，說出「下週可以簽離校」，感覺同學得知這消息倍感高興。而在那週開會的結束時，跟老師報告做的事情時，僅剩下我一人了，順帶把離校同意書一起簽。</p>
<p>回到實驗室，滿是「可以離校了」「什麼時候清東西」的議題，這些話題平時離我太遠，使得我無法參與討論。學弟反過來問「那你什麼時候打算簽？」說起這個傷心事，原來我總是比較特別的部分對吧！我不知道要提些什麼，悄敲地回應「為什麼覺得我沒簽呢？」然而，在簽之前，比我晚口試的古學長早在前幾天拿到畢業證書，而我才剛拿到手。不經開始懷疑自己的能力與價值。要從口中說出「拿到了」，內心可說是五味雜陳地說不出啊。</p>
<p><img src="http://i.imgur.com/TRXEKGC.jpg" alt="「我拿到了」－《情色漫畫老師》"></p>
<h2 id="突襲再訪"><a href="#突襲再訪" class="headerlink" title="突襲再訪"></a>突襲再訪</h2><p><strong>敬請期待</strong></p>
<h2 id="再續故事"><a href="#再續故事" class="headerlink" title="再續故事"></a>再續故事</h2><p><strong>敬請期待</strong></p>
<h2 id="可能走向"><a href="#可能走向" class="headerlink" title="可能走向"></a>可能走向</h2><p><strong>敬請期待</strong></p>
<h2 id="誌謝"><a href="#誌謝" class="headerlink" title="誌謝"></a>誌謝</h2><blockquote>
<p>以下收錄於論文中</p>
</blockquote>
<p>能順利地完成這篇論文，首先，感謝劉邦鋒和吳真貞老師的指導，在論文架構和描<br>述手法的教導，才使得篇幅雜亂的初稿便得更加地易於理解，討論過程中更加地精<br>練專業知識，學生在此衷心感謝老師。</p>
<p>特別感謝中央大學的郭人維學長，拉拔在演算法及資料結構領域上的研究，其給予<br>的助力使得論文開花結果。更感謝在網路上許許多多來自各方的朋友分享研究心得<br>，讓彼此切磋茁壯。</p>
<p>在進入臺灣大學研究所的這兩年中，感謝實驗室學長們的鼓勵與支持，本對於學術<br>研究文化和自身能力的迷茫，接受學長們的啟示後，最終得以撐過第一學年。在第<br>二年中，感謝共同奮戰論文的古耕竹、古君葳、鄭以琳、吳軒衡等同學，彼此加油<br>打氣，使得在撰寫論文的路上並不孤單，督促進展、協助撰寫與驗證想法更加地順<br>利，願你們也能順利畢業、研究出滿意的成果。</p>
<p>在研究實驗上，感謝實驗室學弟張逸寧、林明璟、蔡慶源、朱清福的參與，被迫實<br>作出放置於批改娘系統上題目，這些題目原本為論文的一小部分，可透過不同資料<br>結構與算法解決，在本篇追求效能極致的路上貢獻了一份心力，為本實驗結果給予<br>更有信心的立論基礎。願你們在接下來的一年裡，經過老師指導與同學們相互引領<br>下順利畢業。</p>
<p>此外，特別感謝高中時期帶入門的溫健順老師，在選擇領域分組時，相信我在資訊<br>領域上的發展，拉近資訊組培養，經歷三年的教導後，才能順利走向這一條道路。</p>
<p>最後，感謝家人們一路相伴，進入資訊工程領域後，經歷大學轉學、延畢到研究所<br>的路上，對我的選擇給予支持。</p>
<p>感謝上述的各位與師長們一路上的支持與資助。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/5/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/86/">86</a><a class="extend next" rel="next" href="/page/7/">Next &raquo;</a>
    </nav>
  
</section>
          
          
            <aside id="sidebar">
  <!-- <div id="ukagaka_panel"></div> -->
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">115</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算機圖學/">計算機圖學</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/">工作應用</a><span class="category-list-count">38</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Java/">Java</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Meme/">Meme</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/其他/">其他</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/可持久化/">可持久化</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/鬼故事/">鬼故事</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">49</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">633</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">483</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">77</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">45</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2021/10/28/diary-202110-encrypt/">
              
                <i class="icon-file-o"></i> 
              
            《批改娘串起得那段經歷·序》</a>
          </li>
        
          <li>
            <a class="text" href="/2021/10/28/diary-202110/">
              
                <i class="icon-file-o"></i> 
              
            好多個 28 在這個時刻</a>
          </li>
        
          <li>
            <a class="text" href="/2021/10/28/work/company-ghost-story-14/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 14</a>
          </li>
        
          <li>
            <a class="text" href="/2021/09/12/work/appreciation-letter/">
              
                <i class="icon-file-o"></i> 
              
            Shiny People 感謝</a>
          </li>
        
          <li>
            <a class="text" href="/2021/09/12/work/company-ghost-story-13/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 13</a>
          </li>
        
          <li>
            <a class="text" href="/2021/08/15/diary-202108/">
              
                <i class="icon-file-o"></i> 
              
            被預告要開始管人的我，今天開始學管理？</a>
          </li>
        
          <li>
            <a class="text" href="/2021/08/14/work/company-ghost-story-12/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 12</a>
          </li>
        
          <li>
            <a class="text" href="/2021/07/29/java/java-jni-tls-error-2/">
              
                <i class="icon-file-o"></i> 
              
            Java JNI GC Thread Error (EINVAL)</a>
          </li>
        
          <li>
            <a class="text" href="/2021/07/29/work/company-ghost-story-11/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 11</a>
          </li>
        
          <li>
            <a class="text" href="/2021/06/21/diary-202106/">
              
                <i class="icon-file-o"></i> 
              
            疫情下的工作變化</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
        <ul>
          <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
        </ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
  
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2021 Shiang-Yun Yang 
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>