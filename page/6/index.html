<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Morris&#39; Blog">
<meta property="og:url" content="http://morris821028.github.io/page/6/index.html">
<meta property="og:site_name" content="Morris&#39; Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris&#39; Blog">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
  <!-- <link rel="import" href="/bower_components/app-layout/app-layout.html"> --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          
          <section id="main">
  
    <article id="post-diary-201707" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/08/diary-201707/" class="article-date">
  <time datetime="2017-07-08T10:54:36.000Z" itemprop="datePublished">2017-07-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/shCb0QO.jpg" rel="gallery_ckq8nvwai003vtkvn76awevuo">
        <img src="http://i.imgur.com/shCb0QO.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/08/diary-201707/">吶，還記得我們的「約定」嗎</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/07/08/diary-201707/" data-id="ckq8nvwai003vtkvn76awevuo" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/07/08/diary-201707/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="長途跋涉"><a href="#長途跋涉" class="headerlink" title="長途跋涉"></a>長途跋涉</h2><p>碩二下的剩餘幾個月裡，一般情況在口試前一個月開始把實驗補齊，前一週才把論文寫完，隨後口試完，再花個兩三週把論文丟到圖書館後離校，以上是一般碩士生的的常態生活，而我可能就有一點特別。碩二上學期結束時把論文概要想完，過年把中文論文寫個草稿，下學期便耗費數幾個月與老師來來回回地改了好幾輪，一下子就來到了學期結束。</p>
<p><img src="http://i.imgur.com/Pdusran.jpg" alt="「長篇化就拜託你了」－《情色漫畫老師》"></p>
<p>不得不說，內容改了好幾個月，把一些不太想說明、為什麼要說的部分釐清變得相當困難，大部分不想說明的內容、晦暗不明的語句依依剝離出來，反反覆覆地增加了四十幾張圖片，使用 Tikz 這等套件畫圖，可說是相當痛苦得一件事情，一張圖片可能就要花一整個早上來完成。</p>
<p>細節實作的「道理」與其實驗結果，逐一補上「為什麼要這麼做」、「為什麼會快」、「為什麼選用這種方法」諸如此類的問題。在撰寫時只覺得這麼做是對的，感覺上沒有錯，實驗上可以驗證是對的，一被問起來仍是一臉茫然地不知如何說明，還得回去思考到底要怎麼說才能容易明白。</p>
<p><img src="http://i.imgur.com/lm5A5Ro.jpg" alt="「這不是超過 100 頁了嗎？」－《情色漫畫老師》"></p>
<p>一路寫到五月底，而六月初口試的當下，口試現場來了四個教授來聽，相較於學長那時的三人排場的確更盛大點。壓縮簡報內容至一百頁內的投影片，才可能在四十分鐘內講完呢。那些不想細講的內容，在論文裡不說又會被老師要求，口試的時候能不能不說？百感交集下，硬著頭皮一路殺下去講純資料結構和算法的改進，對於一般做計畫而生的論文，我的內容肯定很無趣吧。要是我能強一點就好了。</p>
<p><img src="http://i.imgur.com/CSVvyzf.jpg" alt="「要是我能更強就好了」－《夏目友人帳》"></p>
<p>講完近一個小時的成果發表，講累的我還一度沒聽懂要開離教室，等待委員商議是否能通過的會議，口試的評分表不知道是以怎麼方式運行，坐在教室外的我焦慮地等待，心想「是不是做的內容有些瑕疵，還是已經有人做過了？還是內容不足以作為一個碩士研究？」</p>
<p>教室那鎖不好的木門聲響起「嘣」一聲，老師從門口向著我說「下去把 XX 一起叫上來」，走下樓把一起口試的同學都叫來教室，才聽到「恭喜你們通過口試」，讀了兩年就等待這一句話，那究竟是怎麼樣的體驗，感覺有點不切實際，就這樣子了？</p>
<p><img src="http://i.imgur.com/QtLx3Ns.jpg" alt="「這是奇蹟」－《正解的卡多》"></p>
<p>儘管已經提早口試，內心再怎麼雀躍，也無法順心地馬上離開這裡，每天依舊來來學校做點雜事，「鈴～鈴～」實驗室電話一響，電話那一頭「有其他人在嗎？那個誰在嗎？麻煩上來一下」，早上十點半的我只能無奈地「誰也不在，現在只有我」，收到「好吧，那你上來」的日常似乎沒有太大的差異。</p>
<p>口試通過後，就該加緊腳步離校了對吧？離校的兩大關卡——口試審定書和離校同意書，過了一關後，還有一關無法通過，那要怎麼通過老師給的離校同意書呢？方法可說是千奇百種啊，男生的最終武器應該是兵單吧，不然總是問最晚什麼時候你才會離開而避開要簽離校，也許還有另一種可能，讓老師覺得「留你也沒用」，幻想著跟老師說「老師啊，就算沒有我，地球也照樣繼續轉，留我做什麼呢？」</p>
<p><img src="http://i.imgur.com/vxjEtv7.jpg" alt="「就算沒有我，地球也照樣繼續轉」—《櫻花任務》"></p>
<p>六月初那時，別老是問我「為什麼不走？」，心想「如果能走的話，早就離開了」，這麼能輕易明白的道理，在我身上就這麼難以理解，萬事皆有因，而螢幕前的你是否能理解我呢？看著行事曆上的工作吧，「六月十九日，校定期末考週」這下明白了吧，原本以為可以託付給學弟撐著弄分散式部分，沒想到碩一期末時期這麼忙碌，弄個作業就兩三天不見人影，實驗室好幾週進入三班工作制。</p>
<p>撐過了幾週的工作準備和實驗環境修整，期末考週終於可以好好休息，考題總要給老師弄好，助教輕鬆地去監考就行了。期末考當天監考完，由於沒有確切的參考答案，當下也不知道怎麼向同學描述怎麼寫才是對的，要提示到哪種地步，當下感慨萬分，「對不起，這裡你要自己想，我不清楚」。</p>
<p>原以為老師很快就可以改好考卷，沒想到突如其來的論文 deadline，使得改考卷一事被拖延，然而送成績又是一週後的事情，先放個三天讓老師去改。催一下進度，發現一題也沒改完，先改了兩題，剩下的題目再給老師改。在放個兩天，還是沒有太多的進展，再跟老師要了兩題來改，到最後還是由我改了大部分的題目，為 … 為什麼會變成那樣？</p>
<p><img src="http://i.imgur.com/2B6vJgj.jpg" alt="「為 ... 為什麼會變成那樣」－《情色漫畫老師》"></p>
<p>七月初到，仍然沒有辦法離開學校，事情接踵而來，弄完轉系考才能離開，又有實驗室經費要花，交代事情的當下只有我在學校，「嗯？怎麼？」對於研究生要在一早十點九點到實驗室，想必是個相當難的議題，學長們可是曾經全員不在而被叫上去罵呢，而我嘗試支持了一年多，電話從我座位旁響起到接起已成為最佳化的結果。在空無一人的早晨接電話，對於指定任務交代給尚未清醒的學弟等。買伺服器時，得再三催廠商寄送發票；買耗材時，得催學弟別忘記。</p>
<p><img src="http://i.imgur.com/OhT853a.jpg" alt="「太奇怪了」－《愛麗絲與藏六》"></p>
<p>終於到辦公室跟老師提了兵單，才從老師口中說出「下週會簽離校，順便回去實驗室跟他們說」一回到實驗室說，便聽到「為什麼老師不願意簽我離校啦」，說出「下週可以簽離校」，感覺同學得知這消息倍感高興。而在那週開會的結束時，跟老師報告做的事情時，僅剩下我一人了，順帶把離校同意書一起簽。</p>
<p>回到實驗室，滿是「可以離校了」「什麼時候清東西」的議題，這些話題平時離我太遠，使得我無法參與討論。學弟反過來問「那你什麼時候打算簽？」說起這個傷心事，原來我總是比較特別的部分對吧！我不知道要提些什麼，悄敲地回應「為什麼覺得我沒簽呢？」然而，在簽之前，比我晚口試的古學長早在前幾天拿到畢業證書，而我才剛拿到手。不經開始懷疑自己的能力與價值。要從口中說出「拿到了」，內心可說是五味雜陳地說不出啊。</p>
<p><img src="http://i.imgur.com/TRXEKGC.jpg" alt="「我拿到了」－《情色漫畫老師》"></p>
<h2 id="突襲再訪"><a href="#突襲再訪" class="headerlink" title="突襲再訪"></a>突襲再訪</h2><p><strong>敬請期待</strong></p>
<h2 id="再續故事"><a href="#再續故事" class="headerlink" title="再續故事"></a>再續故事</h2><p><strong>敬請期待</strong></p>
<h2 id="可能走向"><a href="#可能走向" class="headerlink" title="可能走向"></a>可能走向</h2><p><strong>敬請期待</strong></p>
<h2 id="誌謝"><a href="#誌謝" class="headerlink" title="誌謝"></a>誌謝</h2><blockquote>
<p>以下收錄於論文中</p>
</blockquote>
<p>能順利地完成這篇論文，首先，感謝劉邦鋒和吳真貞老師的指導，在論文架構和描<br>述手法的教導，才使得篇幅雜亂的初稿便得更加地易於理解，討論過程中更加地精<br>練專業知識，學生在此衷心感謝老師。</p>
<p>特別感謝中央大學的郭人維學長，拉拔在演算法及資料結構領域上的研究，其給予<br>的助力使得論文開花結果。更感謝在網路上許許多多來自各方的朋友分享研究心得<br>，讓彼此切磋茁壯。</p>
<p>在進入臺灣大學研究所的這兩年中，感謝實驗室學長們的鼓勵與支持，本對於學術<br>研究文化和自身能力的迷茫，接受學長們的啟示後，最終得以撐過第一學年。在第<br>二年中，感謝共同奮戰論文的古耕竹、古君葳、鄭以琳、吳軒衡等同學，彼此加油<br>打氣，使得在撰寫論文的路上並不孤單，督促進展、協助撰寫與驗證想法更加地順<br>利，願你們也能順利畢業、研究出滿意的成果。</p>
<p>在研究實驗上，感謝實驗室學弟張逸寧、林明璟、蔡慶源、朱清福的參與，被迫實<br>作出放置於批改娘系統上題目，這些題目原本為論文的一小部分，可透過不同資料<br>結構與算法解決，在本篇追求效能極致的路上貢獻了一份心力，為本實驗結果給予<br>更有信心的立論基礎。願你們在接下來的一年裡，經過老師指導與同學們相互引領<br>下順利畢業。</p>
<p>此外，特別感謝高中時期帶入門的溫健順老師，在選擇領域分組時，相信我在資訊<br>領域上的發展，拉近資訊組培養，經歷三年的教導後，才能順利走向這一條道路。</p>
<p>最後，感謝家人們一路相伴，進入資訊工程領域後，經歷大學轉學、延畢到研究所<br>的路上，對我的選擇給予支持。</p>
<p>感謝上述的各位與師長們一路上的支持與資助。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-20021" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/01/jg-20021/" class="article-date">
  <time datetime="2017-07-01T07:38:49.000Z" itemprop="datePublished">2017-07-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/01/jg-20021/">批改娘 20021. Dynamic Range Sum</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/07/01/jg-20021/" data-id="ckq8nvwcr00a2tkvn9akk7k8p" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/07/01/jg-20021/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SIMD/">SIMD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>在二維平面上有 <span>$N$</span><!-- Has MathJax --> 個點，每一個點 <span>$p_i(x_i, y_i)$</span><!-- Has MathJax -->各自帶權重 <span>$w_i$</span><!-- Has MathJax -->，這些點不時會移動和改變權重。</p>
<p>現在 Morris 希望你幫忙撰寫線性搜索的函數，好讓他專注數據結構上的調整。函數詢問包含 </p>
<ul>
<li><span>$N$</span><!-- Has MathJax --> 個點的資訊 (以 SoA (Structure of Array) 的方式儲存，以達到最好的快取使用率) </li>
<li>詢問的矩形 <span>$\text{Rect}$</span><!-- Has MathJax --> (正交於兩軸)</li>
</ul>
<p>函數必須回傳在矩形內部的點權重和。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int32_t</span> search_range(Rect rect, <span class="keyword">int32_t</span> x[], <span class="keyword">int32_t</span> y[], <span class="keyword">int32_t</span> w[], <span class="keyword">int32_t</span> n);</div></pre></td></tr></table></figure>
<h3 id="main-c-測試用"><a href="#main-c-測試用" class="headerlink" title="main.c (測試用)"></a>main.c (測試用)</h3><ul>
<li>一開始，在二維空間 <span>$[0, R) \times [0, R)$</span><!-- Has MathJax --> 之間產生 <span>$N$</span><!-- Has MathJax --> 個點的資訊</li>
<li>接著，模擬 <span>$M$</span><!-- Has MathJax --> 次點的變化，並且呼叫 <code>search_range</code> </li>
<li>最後，將所有答案 HASH 輸出一個值</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"DRS.h"</span></span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> seed = <span class="number">0</span>;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">p_srand</span><span class="params">(<span class="keyword">uint32_t</span> x)</span> </span>&#123; seed = x;&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> uint32_t <span class="title">p_rand</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> seed = (seed*<span class="number">9301</span> + <span class="number">49297</span>);&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> *x, <span class="keyword">int</span> *y)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> tmp = *x;</div><div class="line">    *x = *y;</div><div class="line">    *y = tmp;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> Rect <span class="title">rand_rect</span><span class="params">(<span class="keyword">int</span> R)</span> </span>&#123;</div><div class="line">    Rect r;</div><div class="line">    r.lx = p_rand()%R;</div><div class="line">    r.ly = p_rand()%R;</div><div class="line">    r.rx = p_rand()%R;</div><div class="line">    r.ry = p_rand()%R;</div><div class="line">    <span class="keyword">if</span> (r.lx &gt; r.rx)	swap(&amp;r.lx, &amp;r.rx);</div><div class="line">    <span class="keyword">if</span> (r.ly &gt; r.ry)	swap(&amp;r.ly, &amp;r.ry);</div><div class="line">    <span class="keyword">return</span> r;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> R, <span class="keyword">int32_t</span> x[], <span class="keyword">int32_t</span> y[], <span class="keyword">int32_t</span> w[])</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">        x[i] = p_rand()%R;</div><div class="line">        y[i] = p_rand()%R;</div><div class="line">        w[i] = p_rand()%R;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">tick</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> R, <span class="keyword">int32_t</span> x[], <span class="keyword">int32_t</span> y[], <span class="keyword">int32_t</span> w[])</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)	&#123;</div><div class="line">        <span class="keyword">int</span> idx = p_rand()%N;</div><div class="line">        x[idx] = p_rand()%R;</div><div class="line">        y[idx] = p_rand()%R;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)	&#123;</div><div class="line">        <span class="keyword">int</span> idx = p_rand()%N;</div><div class="line">        w[idx] = p_rand()%R;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 1048576</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    p_srand(<span class="number">0</span>);</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int32_t</span> x[MAXN], y[MAXN], w[MAXN];</div><div class="line">    <span class="keyword">int</span> N = <span class="number">1000</span>, M = <span class="number">10000</span>, R = <span class="number">100</span>;</div><div class="line">    </div><div class="line">    init(N, R, x, y, w);</div><div class="line"></div><div class="line">    <span class="keyword">int32_t</span> hash = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> it = <span class="number">0</span>; it &lt; M; it++) &#123;</div><div class="line">        Rect rect = rand_rect(R);</div><div class="line">        <span class="keyword">int32_t</span> ret = search_range(rect, x, y, w, N);</div><div class="line">        hash ^= ret;</div><div class="line">        tick(N, R, x, y, w);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%"</span> PRIi32 <span class="string">"\n"</span>, hash);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="DRS-h"><a href="#DRS-h" class="headerlink" title="DRS.h"></a>DRS.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __DRS_H</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> __DRS_H</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Rect</span> &#123;</span></div><div class="line">    <span class="keyword">int32_t</span> lx, ly, rx, ry;</div><div class="line">&#125; Rect;</div><div class="line"></div><div class="line"><span class="keyword">int32_t</span> search_range(Rect rect, <span class="keyword">int32_t</span> x[], <span class="keyword">int32_t</span> y[], </div><div class="line">        <span class="keyword">int32_t</span> w[], <span class="keyword">int32_t</span> n);</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<h3 id="DRS-c"><a href="#DRS-c" class="headerlink" title="DRS.c"></a>DRS.c</h3><p>你的目標是要加速下述函數的計算，通過最低要求加速 2 倍以上。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"DRS.h"</span></span></div><div class="line"></div><div class="line"><span class="keyword">int32_t</span> search_range(Rect rect, <span class="keyword">int32_t</span> x[], <span class="keyword">int32_t</span> y[], </div><div class="line">        <span class="keyword">int32_t</span> w[], <span class="keyword">int32_t</span> n) &#123;</div><div class="line">    <span class="keyword">int32_t</span> ret = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (rect.lx &lt;= x[i] &amp;&amp; x[i] &lt;= rect.rx &amp;&amp;</div><div class="line">            rect.ly &lt;= y[i] &amp;&amp; y[i] &lt;= rect.ry) &#123;</div><div class="line">            ret += w[i];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="測資限制"><a href="#測資限制" class="headerlink" title="測資限制"></a>測資限制</h2><ul>
<li>$N \le 131072$</li>
<li>$R \le 32768$</li>
</ul>
<h2 id="範例輸入"><a href="#範例輸入" class="headerlink" title="範例輸入"></a>範例輸入</h2><p><strong><em>no input</em></strong></p>
<h2 id="範例輸出"><a href="#範例輸出" class="headerlink" title="範例輸出"></a>範例輸出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">8967</div></pre></td></tr></table></figure>
<h2 id="編譯參數"><a href="#編譯參數" class="headerlink" title="編譯參數"></a>編譯參數</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">all: main</div><div class="line"></div><div class="line">main: main.c</div><div class="line">    gcc -std=c99 -Ofast -march=native DRS.c -c -o DRS.o</div><div class="line">    gcc -std=c99 -Ofast -march=native main.c DRS.o -o main</div></pre></td></tr></table></figure>
<ul>
<li>當前測試機器 Intel CPU E5-2620v3</li>
<li><a href="https://software.intel.com/sites/landingpage/IntrinsicsGuide/#" target="_blank" rel="external">Intel Intrinsics Guide</a></li>
</ul>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>一般的線性作法，透過 <code>rect.lx &lt;= x[i] &amp;&amp; x[i] &lt;= rect.rx &amp;&amp; rect.ly &lt;= y[i] &amp;&amp; y[i] &lt;= rect.ry</code> 操作，翻譯成組合語言時，四次的 branch &amp; jump，在管線處理上的效能易受到影響。為了使這種 branch 減少而不使管線處理的效能下降，通常會使用查表法來完成，藉由并行的數值計算，在最後一步才進行 load/store 完成指定區塊的指令。</p>
<p>在這一題中，唯有條件式皆成立才執行，由於分枝操作上只有一種情況，故查表法就不適用於此。我們仍可以并行數個矩形判斷，並且存在至少一個矩形成立再運行 load 加總所需的資料，將會給予效能上的大幅提升。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"DRS.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;x86intrin.h&gt;</span></span></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">int32_t search_range(Rect rect, int32_t x[], int32_t y[], </span></div><div class="line"><span class="comment">		int32_t w[], int32_t n) &#123;</span></div><div class="line"><span class="comment">	int32_t ret = 0;</span></div><div class="line"><span class="comment">	for (int i = 0; i &lt; n; i++) &#123;</span></div><div class="line"><span class="comment">		if (rect.lx &lt;= x[i] &amp;&amp; x[i] &lt;= rect.rx &amp;&amp;</span></div><div class="line"><span class="comment">			rect.ly &lt;= y[i] &amp;&amp; y[i] &lt;= rect.ry) &#123;</span></div><div class="line"><span class="comment">			ret += w[i];</span></div><div class="line"><span class="comment">		&#125;</span></div><div class="line"><span class="comment">	&#125;</span></div><div class="line"><span class="comment">	return ret;</span></div><div class="line"><span class="comment">&#125;</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">int32_t</span> search_range(Rect rect, <span class="keyword">int32_t</span> x[], <span class="keyword">int32_t</span> y[], <span class="keyword">int32_t</span> w[], <span class="keyword">int32_t</span> n) &#123;</div><div class="line">    __m128i ret = _mm_set_epi32(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    rect.lx--, rect.ly--;</div><div class="line">    rect.rx++, rect.ry++;</div><div class="line">    __m128i lx = _mm_broadcastd_epi32(*((__m128i *) &amp;rect.lx));</div><div class="line">    __m128i ly = _mm_broadcastd_epi32(*((__m128i *) &amp;rect.ly));</div><div class="line">    __m128i rx = _mm_broadcastd_epi32(*((__m128i *) &amp;rect.rx));</div><div class="line">    __m128i ry = _mm_broadcastd_epi32(*((__m128i *) &amp;rect.ry));</div><div class="line">    __m128i zo = _mm_set_epi32(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    __m128i ic = _mm_set_epi32(<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>);</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i+<span class="number">4</span> &lt;= n; i += <span class="number">4</span>) &#123;</div><div class="line">        __m128i sx = _mm_load_si128((__m128i *) (x+i));</div><div class="line">        __m128i sy = _mm_load_si128((__m128i *) (y+i));</div><div class="line">        __m128i c1 = _mm_and_si128(_mm_cmplt_epi32(lx, sx), _mm_cmplt_epi32(sx, rx));</div><div class="line">        __m128i c2 = _mm_and_si128(_mm_cmplt_epi32(ly, sy), _mm_cmplt_epi32(sy, ry));</div><div class="line">        <span class="keyword">if</span> (_mm_testz_si128(c1, c2) == <span class="number">0</span>) &#123;</div><div class="line">            __m128i cc = _mm_and_si128(c1, c2);</div><div class="line">            __m128i vi = _mm_add_epi32(ic, _mm_set_epi32(i, i, i, i));</div><div class="line">            __m128i rs = _mm_mask_i32gather_epi32(zo, w+i, ic, cc, <span class="number">4</span>);</div><div class="line">            ret = _mm_add_epi32(ret, rs);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">int32_t</span> sum = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = (n&gt;&gt;<span class="number">2</span>)&lt;&lt;<span class="number">2</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (rect.lx &lt;= x[i] &amp;&amp; x[i] &lt;= rect.rx &amp;&amp;</div><div class="line">            rect.ly &lt;= y[i] &amp;&amp; y[i] &lt;= rect.ry) &#123;</div><div class="line">            sum += w[i];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int32_t</span> tmp[<span class="number">4</span>] __attribute__ ((aligned (<span class="number">16</span>)));</div><div class="line">    _mm_store_si128((__m128i*) &amp;tmp[<span class="number">0</span>], ret);</div><div class="line">    sum += tmp[<span class="number">0</span>] + tmp[<span class="number">1</span>] + tmp[<span class="number">2</span>] + tmp[<span class="number">3</span>];</div><div class="line">    <span class="keyword">return</span> sum;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-20020" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/01/jg-20020/" class="article-date">
  <time datetime="2017-07-01T05:47:41.000Z" itemprop="datePublished">2017-07-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/01/jg-20020/">批改娘 20020. Dot Product</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/07/01/jg-20020/" data-id="ckq8nvwcq009ytkvnozq3e8d2" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/07/01/jg-20020/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SIMD/">SIMD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>請嘗試使用 SIMD 技術 AVX/SSE/MMX 來加速以下的純數值計算。</p>
<h3 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h3><p>最低需求加速兩倍快</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">rotate_left</span><span class="params">(<span class="keyword">uint32_t</span> x, <span class="keyword">uint32_t</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span>  (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">encrypt</span><span class="params">(<span class="keyword">uint32_t</span> m, <span class="keyword">uint32_t</span> key)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (rotate_left(m, key&amp;<span class="number">31</span>) + key)^key;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">static</span> uint32_t <span class="title">f</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> off, <span class="keyword">uint32_t</span> key1, <span class="keyword">uint32_t</span> key2)</span> </span>&#123;</div><div class="line">    <span class="keyword">uint32_t</span> sum = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = off; i &lt; N; i++, j++)</div><div class="line">        sum += encrypt(j, key1) * encrypt(j, key2), i++, j++;</div><div class="line">    <span class="keyword">return</span> sum;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N;</div><div class="line">    <span class="keyword">uint32_t</span> key1, key2;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %"</span> PRIu32 <span class="string">" %"</span> PRIu32, &amp;N, &amp;key1, &amp;key2) == <span class="number">3</span>) &#123;</div><div class="line">        <span class="keyword">uint32_t</span> sum = f(N, <span class="number">0</span>, key1, key2);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%"</span> PRIu32 <span class="string">"\n"</span>, sum);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="輸入格式"><a href="#輸入格式" class="headerlink" title="輸入格式"></a>輸入格式</h2><p>有多組測資，每組一行包含三個整數 <span>$N, \; \text{key1}, \; \text{key2}$</span><!-- Has MathJax -->，表示向量長度 <span>$N$</span><!-- Has MathJax -->、向量 <span>$\vec{A}$</span><!-- Has MathJax --> 由亂數種子 <span>$\text{key1}$</span><!-- Has MathJax --> 產生、向量 <span>$\vec{B}$</span><!-- Has MathJax --> 由亂數種子 <span>$\text{key2}$</span><!-- Has MathJax --> 產生。</p>
<ul>
<li>$1 \le N \le 16777216$</li>
</ul>
<h2 id="輸出格式"><a href="#輸出格式" class="headerlink" title="輸出格式"></a>輸出格式</h2><p>對於每組測資輸出一行整數，為 <span>$\vec{A} \cdot \vec{B}$</span><!-- Has MathJax --> 的 unsigned 32-bit integer 結果。</p>
<h2 id="範例輸入"><a href="#範例輸入" class="headerlink" title="範例輸入"></a>範例輸入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">16777216 1 2</div><div class="line">16777216 3 5</div></pre></td></tr></table></figure>
<h2 id="範例輸出"><a href="#範例輸出" class="headerlink" title="範例輸出"></a>範例輸出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2885681152</div><div class="line">2147483648</div></pre></td></tr></table></figure>
<h2 id="編譯參數"><a href="#編譯參數" class="headerlink" title="編譯參數"></a>編譯參數</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc -std=c99 -O3 -march=native main.c -lm</div></pre></td></tr></table></figure>
<h2 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h2><ul>
<li>當前測試機器 Intel CPU E5-2620v3</li>
<li><a href="https://software.intel.com/sites/landingpage/IntrinsicsGuide/#" target="_blank" rel="external">Intel Intrinsics Guide</a></li>
</ul>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>對於數值計算時，SIMD 能充分地加速程序，每一個元素皆經過一連串的數學函數計算，那麼把一連串的數學式拆分，化成最簡的邏輯計算，並且找出常數向量存放到暫存器中。如在影像處理的程序，即使沒有 GPU 幫忙，搭配 SIMD 也是個不錯的選擇，可以加速 2~4 倍之多。</p>
<p>為了凸顯效能差異，題目設計時必須在計算單一元素結果上複雜些，防止大部分的加速效果是來自於減少 branch 操作 (loop unrolling)。</p>
<h3 id="AVX"><a href="#AVX" class="headerlink" title="AVX"></a>AVX</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;x86intrin.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">rotate_left</span><span class="params">(<span class="keyword">uint32_t</span> x, <span class="keyword">uint32_t</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span>  (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">encrypt</span><span class="params">(<span class="keyword">uint32_t</span> m, <span class="keyword">uint32_t</span> key)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (rotate_left(m, key&amp;<span class="number">31</span>) + key)^key;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> uint32_t <span class="title">SSE</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> off, <span class="keyword">uint32_t</span> key1, <span class="keyword">uint32_t</span> key2)</span> </span>&#123;</div><div class="line">    <span class="keyword">uint32_t</span> sum = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = (N&gt;&gt;<span class="number">3</span>)&lt;&lt;<span class="number">3</span>; i &lt; N; i++)</div><div class="line">        sum += encrypt(i+off, key1) * encrypt(i+off, key2);</div><div class="line">    __m256i s_i = _mm256_set_epi32(off, off+<span class="number">1</span>, off+<span class="number">2</span>, off+<span class="number">3</span>, off+<span class="number">4</span>, off+<span class="number">5</span>, off+<span class="number">6</span>, off+<span class="number">7</span>);</div><div class="line">    __m256i s_4 = _mm256_set_epi32(<span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>);</div><div class="line">    __m256i s_k1 = _mm256_set_epi32(key1, key1, key1, key1, key1, key1, key1, key1);</div><div class="line">    __m256i s_k2 = _mm256_set_epi32(key2, key2, key2, key2, key2, key2, key2, key2);</div><div class="line">    <span class="keyword">uint32_t</span> modk1 = key1&amp;<span class="number">31</span>;</div><div class="line">    <span class="keyword">uint32_t</span> modk2 = key2&amp;<span class="number">31</span>;</div><div class="line">    <span class="keyword">uint32_t</span> cmodk1 = <span class="number">32</span> - modk1;</div><div class="line">    <span class="keyword">uint32_t</span> cmodk2 = <span class="number">32</span> - modk2;</div><div class="line">    __m256i s_ret = _mm256_set_epi32(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    N &gt;&gt;= <span class="number">3</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> it = <span class="number">0</span>; it &lt; N; it++) &#123;</div><div class="line">        __m256i r_1 = _mm256_or_si256(_mm256_slli_epi32(s_i, modk1), _mm256_srli_epi32(s_i, cmodk1));</div><div class="line">        r_1 = _mm256_xor_si256(_mm256_add_epi32(r_1, s_k1), s_k1);</div><div class="line">        __m256i r_2 = _mm256_or_si256(_mm256_slli_epi32(s_i, modk2), _mm256_srli_epi32(s_i, cmodk2));</div><div class="line">        r_2 = _mm256_xor_si256(_mm256_add_epi32(r_2, s_k2), s_k2);</div><div class="line">        __m256i r_m = _mm256_mullo_epi32(r_1, r_2);</div><div class="line">        s_ret = _mm256_add_epi32(s_ret, r_m);</div><div class="line">        s_i = _mm256_add_epi32(s_i, s_4);</div><div class="line">    &#125;</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">int32_t</span> tmp[<span class="number">8</span>] __attribute__ ((aligned (<span class="number">32</span>)));</div><div class="line">        _mm256_store_si256((__m256i*) &amp;tmp[<span class="number">0</span>], s_ret);</div><div class="line">        sum += tmp[<span class="number">0</span>] + tmp[<span class="number">1</span>] + tmp[<span class="number">2</span>] + tmp[<span class="number">3</span>];</div><div class="line">        sum += tmp[<span class="number">4</span>] + tmp[<span class="number">5</span>] + tmp[<span class="number">6</span>] + tmp[<span class="number">7</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> sum;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N;</div><div class="line">    <span class="keyword">uint32_t</span> key1, key2;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %"</span> PRIu32 <span class="string">" %"</span> PRIu32, &amp;N, &amp;key1, &amp;key2) == <span class="number">3</span>) &#123;</div><div class="line">        <span class="keyword">uint32_t</span> sum = SSE(N, <span class="number">0</span>, key1, key2);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%"</span> PRIu32 <span class="string">"\n"</span>, sum);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SSE"><a href="#SSE" class="headerlink" title="SSE"></a>SSE</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;x86intrin.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">rotate_left</span><span class="params">(<span class="keyword">uint32_t</span> x, <span class="keyword">uint32_t</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span>  (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">encrypt</span><span class="params">(<span class="keyword">uint32_t</span> m, <span class="keyword">uint32_t</span> key)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (rotate_left(m, key&amp;<span class="number">31</span>) + key)^key;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> uint32_t <span class="title">SSE</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> off, <span class="keyword">uint32_t</span> key1, <span class="keyword">uint32_t</span> key2)</span> </span>&#123;</div><div class="line">    <span class="keyword">uint32_t</span> sum = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = N/<span class="number">4</span>*<span class="number">4</span>; i &lt; N; i++)</div><div class="line">        sum += encrypt(i+off, key1) * encrypt(i+off, key2);</div><div class="line">    __m128i s_i = _mm_set_epi32(off, off+<span class="number">1</span>, off+<span class="number">2</span>, off+<span class="number">3</span>);</div><div class="line">    __m128i s_4 = _mm_set_epi32(<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>);</div><div class="line">    __m128i s_k1 = _mm_set_epi32(key1, key1, key1, key1);</div><div class="line">    __m128i s_k2 = _mm_set_epi32(key2, key2, key2, key2);</div><div class="line">    <span class="keyword">uint32_t</span> modk1 = key1&amp;<span class="number">31</span>;</div><div class="line">    <span class="keyword">uint32_t</span> modk2 = key2&amp;<span class="number">31</span>;</div><div class="line">    <span class="keyword">uint32_t</span> cmodk1 = <span class="number">32</span> - modk1;</div><div class="line">    <span class="keyword">uint32_t</span> cmodk2 = <span class="number">32</span> - modk2;</div><div class="line">    __m128i s_ret = _mm_set_epi32(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    N &gt;&gt;= <span class="number">2</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> it = <span class="number">0</span>; it &lt; N; it++) &#123;</div><div class="line">        __m128i r_1 = _mm_or_si128(_mm_slli_epi32(s_i, modk1), _mm_srli_epi32(s_i, cmodk1));</div><div class="line">        r_1 = _mm_xor_si128(_mm_add_epi32(r_1, s_k1), s_k1);</div><div class="line">        __m128i r_2 = _mm_or_si128(_mm_slli_epi32(s_i, modk2), _mm_srli_epi32(s_i, cmodk2));</div><div class="line">        r_2 = _mm_xor_si128(_mm_add_epi32(r_2, s_k2), s_k2);</div><div class="line">        __m128i r_m = _mm_mullo_epi32(r_1, r_2);</div><div class="line">        s_ret = _mm_add_epi32(s_ret, r_m);</div><div class="line">        s_i = _mm_add_epi32(s_i, s_4);</div><div class="line">    &#125;</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">int32_t</span> tmp[<span class="number">4</span>] __attribute__ ((aligned (<span class="number">16</span>)));</div><div class="line">        _mm_store_si128((__m128i*) &amp;tmp[<span class="number">0</span>], s_ret);</div><div class="line">        sum += tmp[<span class="number">0</span>] + tmp[<span class="number">1</span>] + tmp[<span class="number">2</span>] + tmp[<span class="number">3</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> sum;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N;</div><div class="line">    <span class="keyword">uint32_t</span> key1, key2;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %"</span> PRIu32 <span class="string">" %"</span> PRIu32, &amp;N, &amp;key1, &amp;key2) == <span class="number">3</span>) &#123;</div><div class="line">        <span class="keyword">uint32_t</span> sum = SSE(N, <span class="number">0</span>, key1, key2);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%"</span> PRIu32 <span class="string">"\n"</span>, sum);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-20018" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/01/jg-20018/" class="article-date">
  <time datetime="2017-07-01T05:27:09.000Z" itemprop="datePublished">2017-07-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/01/jg-20018/">批改娘 20018. Square Root of Vector Elements</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/07/01/jg-20018/" data-id="ckq8nvwco009utkvns7aedurx" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/07/01/jg-20018/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SIMD/">SIMD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>Intel 公司在 X86 指令集上提供了 AVX (Advanced Vector Extensions)、SSE (Streaming SIMD Extensions) 的特殊指令，這些在 SIMD 指令上提供強力的加速。</p>
<h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>現在給你長度為 <span>$N$</span><!-- Has MathJax --> 的 32-bit floating point，分別將其開根號回傳。</p>
<ul>
<li>你可能會需要函數庫 <code>#include &lt;x86intrin.h&gt;</code></li>
<li>你可能會需要 AVX/SSE 開根指令 <a href="https://software.intel.com/en-us/cpp-compiler-18.0-developer-guide-and-reference-mm256-sqrt-ps" target="_blank" rel="external"><code>__m256 _mm256_sqrt_ps(__m256 a);</code></a></li>
</ul>
<h3 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"VSQRT.h"</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">float</span> a[<span class="number">1048576</span>], b[<span class="number">1048576</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</div><div class="line">        a[i] = i;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> it = <span class="number">0</span>; it &lt; <span class="number">20</span>; it++)</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">memcpy</span>(b, a, <span class="keyword">sizeof</span>(a[<span class="number">0</span>])*N);</div><div class="line">        <span class="keyword">clock_t</span> t = clock();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</div><div class="line">            sqrt2(b, b+N);</div><div class="line">        t = clock() - t;</div><div class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"It took me %f seconds.\n"</span>, ((<span class="keyword">float</span>) t)/CLOCKS_PER_SEC);</div><div class="line">        <span class="keyword">float</span> sum = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</div><div class="line">            sum += b[i];</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%f\n"</span>, sum);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="VSQRT-h"><a href="#VSQRT-h" class="headerlink" title="VSQRT.h"></a>VSQRT.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __VSQRT_H</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> __VSQRT_H</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sqrt2</span><span class="params">(<span class="keyword">float</span> *begin, <span class="keyword">float</span> *end)</span></span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<h3 id="VSQRT-c"><a href="#VSQRT-c" class="headerlink" title="VSQRT.c"></a>VSQRT.c</h3><p>請嘗試加速以下程式碼。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"VSQRT.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sqrt2</span><span class="params">(<span class="keyword">float</span> *begin, <span class="keyword">float</span> *end)</span> </span>&#123;</div><div class="line">     <span class="keyword">for</span> (; begin != end; begin++)</div><div class="line">         *begin = <span class="built_in">sqrt</span>(*begin);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Sample-Input-stdin"><a href="#Sample-Input-stdin" class="headerlink" title="Sample Input (stdin)"></a>Sample Input (stdin)</h2><p><strong><em> no input </em></strong></p>
<h2 id="Sample-Output-stdout"><a href="#Sample-Output-stdout" class="headerlink" title="Sample Output (stdout)"></a>Sample Output (stdout)</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div><div class="line"><span class="number">1051776.125000</span></div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>這裡我們使用 Intel CPU 撰寫 SIMD 指令時，透過編譯參數 <code>-msse -mavx ...</code> 指定相關的指令集進行調適。這些單一指令多資料處理的操作，使得在指定層級得到較高的平行度。</p>
<p>為了使用它們，我們需要較多的前置處理，例如要把資料載入和儲存時，必然要符合對齊的標準，若記憶體位址不是 32 的倍數 (AVX 的 256 bits) 或者 16 的倍數 (SSE 的 128 bits)，則系統會產生 trap，進而導致程式運行中斷而發生錯誤。這方面必須特別小心，有時編譯器恰好幫你對齊而正常運行，若增加其他變數時，對齊就有可能跑掉，這時候再去找錯誤會變得相當瑣碎。</p>
<p>通常些 SSE/AVX 加速指令，將會在 <code>gcc -Ofast</code> 中使用，而在 <code>-O3</code> 下仍有可能尚未開啟。而在 LLVM 中的 <code>clang -O2</code> 編譯下就會自動開啟 SSE。無論如何，要明白開啟這些的并行指令的代價，數據小造成運行效能低落，隨著資料量遽增才會明顯加速，若牽涉到浮點數計算，務必注意精準度的需求。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"VSQRT.h"</span></span></div><div class="line"> </div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;x86intrin.h&gt;</span></span></div><div class="line"> </div><div class="line"><span class="comment">//#undef __AVX__</span></div><div class="line"><span class="comment">//#undef __SSE__</span></div><div class="line"> </div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(__AVX__)</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sqrt2</span><span class="params">(<span class="keyword">float</span> *a, <span class="keyword">float</span> *end)</span> </span>&#123;</div><div class="line">    <span class="keyword">uint32_t</span> offset = ((<span class="keyword">void</span> *) a - (<span class="keyword">void</span> *) <span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span> (; a &lt; end &amp;&amp; (offset&amp;<span class="number">31</span>); a++, offset += <span class="keyword">sizeof</span>(<span class="keyword">float</span>))</div><div class="line">        *a = <span class="built_in">sqrt</span>(*a);</div><div class="line">    __m256* ptr = (__m256*) a;</div><div class="line">    <span class="keyword">for</span> (; a + <span class="number">8</span> &lt;= end; a += <span class="number">8</span>, ptr++)</div><div class="line">        _mm256_store_ps(a, _mm256_sqrt_ps(*ptr));</div><div class="line">    <span class="keyword">for</span> (; a &lt; end; a++)</div><div class="line">        *a = <span class="built_in">sqrt</span>(*a);</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__SSE__)</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sqrt2</span><span class="params">(<span class="keyword">float</span> *a, <span class="keyword">float</span> *end)</span> </span>&#123;</div><div class="line">    <span class="keyword">uint32_t</span> offset = ((<span class="keyword">void</span> *) a - (<span class="keyword">void</span> *) <span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span> (; a &lt; end &amp;&amp; (offset&amp;<span class="number">15</span>); a++, offset += <span class="keyword">sizeof</span>(<span class="keyword">float</span>))</div><div class="line">        *a = <span class="built_in">sqrt</span>(*a);</div><div class="line">    __m128* ptr = (__m128*) a;</div><div class="line">    <span class="keyword">for</span> (; a + <span class="number">4</span> &lt;= end; a += <span class="number">4</span>, ptr++)</div><div class="line">        _mm_store_ps(a, _mm_sqrt_ps(*ptr));</div><div class="line">    <span class="keyword">for</span> (; a &lt; end; a++)</div><div class="line">        *a = <span class="built_in">sqrt</span>(*a);</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sqrt2</span><span class="params">(<span class="keyword">float</span> *begin, <span class="keyword">float</span> *end)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (; begin != end; begin++)</div><div class="line">        *begin = sqrtf(*begin);</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-parallel-TA" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/01/parallel-TA/" class="article-date">
  <time datetime="2017-07-01T02:02:25.000Z" itemprop="datePublished">2017-07-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/W9PD2EB.jpg" rel="gallery_ckq8nvwdy00d4tkvnh6lsul5m">
        <img src="http://i.imgur.com/W9PD2EB.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/01/parallel-TA/">助教生涯－平行總結</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/07/01/parallel-TA/" data-id="ckq8nvwdy00d4tkvnh6lsul5m" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/07/01/parallel-TA/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/實作技巧/">實作技巧</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <p>從碩班入學開始的這兩年內，助教一職圍繞在身邊許久，不擅長教別人的我卻非得接下這份工作－「教練，我可以不當助教嗎？」一轉眼兩年過去，當了三個學期半的助教，兩年間也不過四個學期，我想這些經歷肯定對於其他人是特別的，甚至會覺得有博班學長跟你一起當助教。不幸地，沒人可以給你經驗學習當助教－「從今天開始，你就是課程助教了！」</p>
<h2 id="關於作業"><a href="#關於作業" class="headerlink" title="關於作業"></a>關於作業</h2><p>大部分的課程都會使用的相同作業，助教只需要發下去給同學們寫就好。若加點變化，這就讓助教苦了，那是為什麼呢？一個小小的更動將更新參考答案、增加檢測方法、準備應付學生難以理解題目的諮詢，單兵作業的情況下，要如何做到全面防守便是一場長期消耗戰。</p>
<p>在學校課程中，也只有幾堂課是週週出作業、交作業，那週週改作業是怎麼一回事！那麼就是一個完全的管線處理，一下子從期初忙到期末，作業格式要找老師檢查、課堂中督導學生撰寫、課後收作業批閱、收到補交作業批改、接獲隔週作業需求設計、進行初步實驗和作業規劃、郵件通知學生 … 等，每週這樣子循環，有時候在想要是突然生病或消失，會出什麼事情呢？好想知道，希望是個可以找個人接替的日子，那麼就能好好地做自己的事情。</p>
<p>永無止盡地思考——這樣的設計會不會出事？誰能來提供更好的解法，能不能再設計得更好了一些？你是否也有相同的煩惱呢？</p>
<h2 id="關於考試"><a href="#關於考試" class="headerlink" title="關於考試"></a>關於考試</h2><p>考試不像作業有一陣子的緩衝期，出題面向與準備方向需要跟老師確定，一旦沒有喬好，就會在學生和老師間被踢來踢去，要是讓學生準備方向錯誤，那麼一定會件很可怕的事情。檢查再檢查，還是會有一些描述在當下造成學生無法理解的部分。更擔心的是，知道考題內容也沒有附上參考答案和配分方法。當問答題時更為頭痛，總會有那些出乎意料的答題方法，學生考試當下詢問時，這要怎麼辦呢？例外處理要怎麼給分？</p>
<p>考卷批改又是另一回事，由老師改還是助教改呢？改完就要準備讓學生檢討「助教？為什麼這會錯？為什麼他寫那樣就會對，我寫就不對？」有時候，文字描述總是很可怕的，當我們充分理解這位仁兄時，看考卷的觀點會變成「假設你懂」相反地就是「假設你不懂」，通常都要以後者為主，但如果偏向實作課程時，對於那些實作能力很好，卻不想背誦專有名詞定義的高手而感到惋惜。</p>
<p>最好的解決方法，就是助教都認得出來每個學生和表現，這樣也許會好上一些，一個學期能不能認識一個班級的人呢？有些很少出現和表現的同學，到底要怎麼認識啊！</p>
<h2 id="關於環境架設"><a href="#關於環境架設" class="headerlink" title="關於環境架設"></a>關於環境架設</h2><p>在程式撰寫方面，替學生進行環境設定相當苦惱，因為有分成標準與不標準，像我這種非正規教育出來的，只知道一堆網路搜索的資訊結果，哪一種解決方法才是最好的，能帶到下一個運行版本下持續運作，長遠性的規劃！只發現以前課程所遺留下來的資料，大多都有一些毛病在，還有一些尚未描述清楚的部分。「咱很笨，能教教我嗎？上上上屆學長們，你們消失到哪了？」</p>
<p><img src="http://i.imgur.com/s8NlOr9.jpg" alt="「原來我之前什麼都不明白啊」—《正解的卡多 KADO》"></p>
<h2 id="雜言"><a href="#雜言" class="headerlink" title="雜言"></a>雜言</h2><p><img src="http://i.imgur.com/cBeZmFH.jpg" alt="「無言」－《從零開始的魔法書》"></p>
<p>當收到同學問程式，時常忘記給予任何嘗試的足跡，只有一份有錯的程序，接著就要助教幫忙通靈找錯誤，你先可以問問一起修課的同學嗎？每次都這樣子的話，咱已經受不了啊，一年、兩年過去，也疲於應付這些，我也想要屬於我自己的救贖啊！</p>
<p><img src="http://i.imgur.com/Rv1eT0c.jpg" alt="「」－《為美好的世界獻上祝福》"></p>
<p>每週跟課三個多小時，又要確定作業題目、生測資和測試，我自己也想鑽研作業，所追求的作業是沒有底的標準，能更好就更好，多給一點意見，讓我也能從中學習吧，為什麼都只有作業寫好就完事？有點傷心，不甘如此地結束，你能驚艷我的，對吧？</p>
<p>從系統環境架設、考試準備、通知學生和課程時替學生除錯，製作課程簡報，修正幾代學長遺留下來的錯誤，撰寫參考解答，追求更好的效能與算法，行政事項的準備，還有外來的委託架設。該經歷的都經歷了，只是一個人忙不太過來，也一直撐不住這麼多龐大的壓力。</p>
<p>然而，要準備離開學校的當下，信箱不時有一些待申請的大一新生信件，其中還會有外系學生想要使用我們課程中使用的系統來學習。系上的轉系考要我弄環境、考題，看來我的人生很不平靜呢 … 一些邏輯說不通的事情發生在身上時，過得是多麼無力呀。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-diary-201705-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/04/diary-201705-2/" class="article-date">
  <time datetime="2017-05-04T03:46:34.000Z" itemprop="datePublished">2017-05-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/BsbOqhH.jpg" rel="gallery_ckq8nvwaf003ntkvnti5t4qmq">
        <img src="http://i.imgur.com/BsbOqhH.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/04/diary-201705-2/">純粹 Part 2</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/05/04/diary-201705-2/" data-id="ckq8nvwaf003ntkvnti5t4qmq" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/05/04/diary-201705-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <p>接續上一篇所講，繼續說下去吧。</p>
<p>「神明曾向某個青年下了詛咒，那是看到悲傷之人就會全身感到痛苦的詛咒。青年為了避免自己痛苦，於是向所有悲傷的人伸出了援手 —— 神明著著他的樣子，仿製了一個外貌、動作與他一模一樣的假貨，他也像真正的青年一樣對所有悲傷的人伸出了援手。神明分別為他們起了名字 —— 一方為善，另一方為偽善。你覺得哪個是善，哪個是偽善？」－《重啟咲良田》</p>
<p>純粹究竟是什麼樣子？不帶有任何的自我意識，完全地無意識到周遭，更不會去評斷做了什麼，就只是去做，最終是好是壞那又是什麼？不是我們給予一個行為或結果的解釋嗎，都只是解釋的話，真相有必要探究嗎？若是純粹，那還可以被稱作人？還是被稱為機器人合適？</p>
<p>純粹地，想知道。</p>
<h2 id="日常篇"><a href="#日常篇" class="headerlink" title="日常篇"></a>日常篇</h2><p>原本只是想做一個簡單的平行算法，從趕 Conference 論文換成 Transaction 論文，原本 Conference 論文頁數不得超過十頁，導致很多提及的數據結構都不太想仔細說明，咱的指導老師只好先改其他人的論文投 Conference，而我被安排到投 Transaction，沒有任何時間壓力。</p>
<p>三月中是個分水嶺，同屆的只剩下我要寫論文，其他人已經不用到校 (只要不接助教工作，事實上不必總是到實驗室)，而我還接下了平行助教的工作，到學校等著論文修改的 on call，平常實驗室只剩下我和學弟們，不時跟他們討些作業來做，亦或者討論計畫所需要的算法。也許有人會想問，那實驗室的博班學長呢？只有 meeting 那一天有機會在實驗室見著，平常是完全的零交流，是非常平行的實驗室呢！</p>
<p>當助教的日子裡，就像去年一樣「我不知道該怎麼辦，但覺得這樣下去不太行。」，若跟其他人一樣顧好自己畢業，其他事都不管的話，這裡的許許多多事情終究會重複上演。設計題目出測資，看相關論文後，做個簡單的簡報，在每週跟課的時候跟同學說明，為了設計新的題目而調整系統，按照這個行程走，每天都有一些工作需要處理。</p>
<p><img src="http://i.imgur.com/KFoit6t.jpg" alt="「和其他人一起努力的話，很多問題可以迎刃而解」－《3月的獅子》"></p>
<p>然而，做的一切還會被同學嫌。要說這裡是台大嗎？讓我這個半吊子當助教本身就是錯的，我是來學習的，不是來工作的！真正值得學習的對象卻很少出現在我眼前給予我指導，曾經的我也好想在這裡永遠追隨某人、想和其他人一起努力，但每個人都有自己的規則和約束，能一起努力的機會就更少了，有著各自的工作與理念，即使在第一學府眾多的人群中，也未必能找到能共事的同事。</p>
<p>助教工作時看著自己專研過的算法和代碼，不時地仍會看著其他人的程序學習，儘管在運行上可能不是很有效率、邏輯不漂亮。別因為追不到我的程序就放棄努力，我仍然可以向妳學習「就差那麼一步，你的想法將會推翻整個局面，本該如此的美麗，卻少了最後那份信心。」《3月的獅子》，別過於相信我，我並沒你們想像中地強大。</p>
<p><img src="http://i.imgur.com/IiwHJgw.jpg" alt="「本應如此地美麗」－《3月的獅子》"></p>
<p>論文從十頁放寬到二十五頁的限制，能放置的圖表更加地豐富，老師要我從祖宗十八代的算法開始描述，必且要講得可以不查閱其他論文和資料就能閱讀，大部分的內容都被要求重寫，提及約十個算法、快二十張圖片說明，製圖耗費的經歷更加地多 (原因都來自於版本控制的需求，畫圖都像寫程式一般)，調整描寫順序，用最簡單的方法講清楚一件事情，於是一下子就到了快二十五頁。改我論文的痛苦已經充分展現在老師的臉書塗鴉牆，那大概是老師有生之年第一次這麼辛苦。</p>
<p><img src="http://i.imgur.com/moKcWOd.jpg" alt="「為了創作出傑作，我正在養精蓄銳」－《我的妹妹是黃漫老師》"></p>
<p>別太期待會有什麼特別的，自己覺得挺簡單的，可能還沒有什麼用呢。</p>
<h2 id="計畫篇"><a href="#計畫篇" class="headerlink" title="計畫篇"></a>計畫篇</h2><p>因為要回學校當助教又要改論文，暫時辭去了實習工作 (留職停薪？為什麼不打算讓我離職，怎麼想都很奇怪，這麼照顧我，真的辛苦你們了)，畢業之後又會到哪裡，做些什麼事情，不經讓我想起《秒速五釐米》的那段話，</p>
<p><img src="http://i.imgur.com/4HcqoP1.jpg" alt="「總之這幾年裡，我很想向前邁進，想觸及那無法觸及的事物，儘管不知道那具體指什麼。我不知道這份勉強的感情是從何處如何孕育而生，只能一味地工作，等回過神來，日漸喪失彈性的心靈是如此傷痛。接著某天早上，我意識到過去那份銘刻於心的感情已消失得無影無踪，我知道自己到了極限，於是辭去了工作。」─《秒速五釐米》"></p>
<p>那份心情到底要如何醞釀？為了什麼而活的心情？想等待著什麼樣的日子？太多太多的問題想要知道，還是不需要去想意義，若是每一件事情都去找意義，那就不能做事了，那先做看看吧，誰也不知道答案！當然，接受包養的情況也是可以接受的！</p>
<p><img src="http://i.imgur.com/GnoM6AI.jpg" alt="「請包養我！我真的不想去工作」－《不正經的魔術講師雨禁忌教典》"></p>
<h2 id="理念篇"><a href="#理念篇" class="headerlink" title="理念篇"></a>理念篇</h2><p>在台大讀研究所，有時會覺得佔了某人的位置，畢竟一開始的我並不在這裡，而應該出現在這裡的人卻又不怎麼出現，我出現在這裡合適嗎？如果合適的話，為什麼要這樣對我？如果不合適的話，又為什麼要這樣要求我？不得不去思考這些問題，否則就很難邁出下一步。</p>
<p><img src="http://i.imgur.com/B6QVTEZ.jpg" alt="「有時我會覺得佔了某人的位置，這讓我感到難過。比方說，活在世上就是一種浪費，霸佔了其他人的位置，他們也許能活出更有意義的人生」－《愛在來世》"></p>
<p>很想追祢，也很想追妳，在同一個次元也罷，不同次元也行，那是成為一般人且獲得認同的證明，對於我是如此地渴望。</p>
<p><img src="http://i.imgur.com/zNKmBDF.jpg" alt="「就算是距離無法縮短，也不能成為我不前進的理由」－《3月的獅子》"></p>
<p>人們說那種東西只是個雙保險，也許，只是害怕一個人待著，那晚的事情我還記得很清楚，晚上十點多寫完程式闔上筆電，跟家人說聲晚安，走上樓睡覺時，覺得今晚是如此地奇怪，總覺得從另一個視角看著自己，但什麼事情也沒發生，無疑地躺上床後，馬上被寫程式的疲累帶進夢裡。</p>
<p>半夜突然驚醒，正要拿起手機看時間，坐在床上都會倒下，在半夜裡無助地喊著，一邊思考著「是不是要結束人生了，我的腦已經要停止運作了嗎？」還好那時在家裡，半夜還能被送去急診，無力的我還得被推著輪椅進去，醫師只跟我說明是「腸胃炎」，那時的我不怎麼相信，畢竟腸胃炎都得過多少次了，都還沒遇過這種情況。</p>
<p>躺在上休息的我，吃不下也喝不下，就只是發呆著，等著可以分清楚方向，那時朋友仍用著我的帳號在臉書發圖文，家人還以為我已經好到可以用手機發文，誰都不知道、也沒發現早已陣亡的我，一如往常地回覆我。這才發現不需要我也可以正常運作，這世界的容錯能力很好，一瞬間就可以修正我這個錯誤。之後的我更沒想過會失去平衡一個多月，車也不敢騎，頭也不敢回，快速轉個頭可能就要跌倒，那究竟是什麼情況，至今還不清楚。</p>
<p><img src="http://i.imgur.com/6GEwa39.jpg" alt="「我十七歲的時候還在妄想著『自己會不會成為很厲害的人啊』」－《3月的獅子》"></p>
<p>曾經的幻想「自己會不會成為很厲害的人啊」，到了考大學的結果才發現一點也不行，有些東西就是學不來，真的學不來呀，怎麼樣追逐的速度都跟不上，只能在一旁一味地看著自己離大家越來越遠，最後吊了車尾。</p>
<p><img src="http://i.imgur.com/0xciq0c.jpg" alt="「想到要為了賺錢，埋首研究如何讓日常生活更便利，就受不了，我要為了思考而思考」－《世紀天才》"></p>
<p>我想要為了思考而思考，找了工作後，身旁的人就很在意薪水多高，不斷地吹捧那薪水價值，但我想那都不是重點，回顧一個常見的小故事——</p>
<p>〈說話的藝術〉的小故事「如果你說一個女大學生，晚上去夜總會陪酒，聽起來就不太好，可如果你說一個夜總會小姐，白天堅持去大學聽課，就滿滿的正能量了。如果你說你是一個學者，開了個公司，會被鄙視，認為你俗，真是斯文敗類。可是如果你說你是一個商人，經商之餘還專研學術，別人會肅然起敬，尊稱你為儒商。所以說話的時候，順序特別重要。」</p>
<p>我想說得差不多對照類似的意思，強調的順序反了！理念上感到非常奇怪的點。</p>
<blockquote>
<p>貼了圖不久，就收到了訊息<br>「你可以為了思考而思考」<br>「然後錢給我，幫你花！」</p>
</blockquote>
<p>此時，我的心情寫照</p>
<p><img src="http://i.imgur.com/V6SsDfC.jpg" alt="「你這麼說的話，不就是在表達想跟我永遠在一起嗎」－《從零開始的魔法書》"></p>
<p>儘管知道這只是純粹的話，仍必須好好地建造高牆，否則容易受到動搖。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-diary-201705" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/03/diary-201705/" class="article-date">
  <time datetime="2017-05-03T11:51:34.000Z" itemprop="datePublished">2017-05-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/QfgFMVC.jpg" rel="gallery_ckq8nvwag003qtkvnuqg2o9s6">
        <img src="http://i.imgur.com/QfgFMVC.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/03/diary-201705/">純粹 Part 1</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/05/03/diary-201705/" data-id="ckq8nvwag003qtkvnuqg2o9s6" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/05/03/diary-201705/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <p>從二月到五月這段日子，發生了許多事情，也有些不變的日常。其中，有一段疲於應付的日子過得水生火熱，又在其中穿插了幾段小趣事，獻給想到聽八卦的朋友們，接下來將分成感情、日常、計畫與理念四篇。</p>
<p>感情篇——在一月時已提及了大部分感情篇的要素，那些沒有後續的故事，通常不太想去提及、不想去談論，那是純粹的還是虛偽的感情？這些問題隨著這段日子不斷反覆思考著。</p>
<p>日常篇——講著大部分的實驗室的情況，我的日常不是一般的日常，回家就是睡，醒來就會在實驗室，說是一般的娛樂，也都是在學校度過。其原因可以歸納在「反正我沒有朋友、沒有女朋友，有著大把大把的時間可以去思考。」</p>
<p>計畫篇——計畫著下一階段要怎麼運行，一旦失去學生身份，就得開始履行當兵義務，而當完兵又是怎麼樣的日子，我應該要以什麼的理念活下去？</p>
<p>理念篇——從國小曾思考著「世界是否從我眼界下才開始構築」，到現在不斷地加深自己的理念，與其拓展到個方位上的思考轉換，那些思考有什麼意義？</p>
<h2 id="感情篇"><a href="#感情篇" class="headerlink" title="感情篇"></a>感情篇</h2><p>明白和揣測對方的想法，就像寫程序就能想到執行的預期結果是怎麼樣子，只要構築環境與每一步的指令都相當明確，那麼結果必然呼之欲出。這個能力用於寫程式很方便，一旦用到了感情上就不被接受。</p>
<p>當朋友身邊有著不錯的對象，也有著像漫畫劇情般那樣發展，在對方尚未開口的處境下，喜歡與不喜歡就決定於下一步，有可能錯過一個表明心意的機會，人生就差了十萬八千里遠。基於上述，學弟和朋友們開始喧鬧「不試著找個機會告白嗎？」「她應該在等你了吧」… 等。</p>
<p><img src="http://i.imgur.com/RPDNDzV.jpg" alt="「其實我不善與人交談」－《風夏》"></p>
<p>「別鬧了，你們不夠理解她，她本來就是這樣子的人 …」那些無法用語言表述的推測，明確地告訴我，對方本質加上輸入後的結果－不會成功、也不會失敗，沒有機會告白，也不會有機會告白，我試著將這些跟朋友說到，但是誰也不信我。</p>
<p>然後到了某天早晨，在意識不清的情況下，傳了一張圖片過去，上頭這麼寫著「我有著一種能力，喜歡的對象總會有男朋友」想著考慮要交男朋友的她，我的能力也許能幫上她，「妳交上男朋友了嗎？」如此地問道，收拾著包包去學校，在等十字路口紅綠燈時，看到走在一旁男女國中生們，才想起稍早些到底做了什麼蠢事 …</p>
<p>看著中午時，手機傳來了訊息通知，在開啟之前，內心感覺就像是考卷在發的過程中，在台下能明確地幻想到下五分鐘的未來，那種心境和感覺在此刻重現，「求你了，我所想的預測不要成真」忍了很久，開啟的第一句話大致上說明故事已經落幕，心裡早就知道的事情，真實呈現時的痛苦啊！</p>
<p><img src="http://i.imgur.com/4ETQPBD.jpg" alt="「雖然知道會這樣，不過還是很痛苦啊」－《清戀》"></p>
<p>沒事兒，至少在情人節之前挑戰過了，失敗就可以給各位朋友一個交代，心中也鬆了一口氣</p>
<p>「我已經不要緊了」「連我的心靈支柱 … 我以為的心靈支柱都這麼說 …」</p>
<p><img src="http://i.imgur.com/2kFa8WO.jpg" alt="「失敗就意味著挑戰過了」－《3月的獅子》"></p>
<hr>
<p>那件事情也過了一陣子，開學前就要忙於論文報告和助教工作的準備，這段忙碌的日子過了好一陣子</p>
<blockquote>
<p>「Hello, 我來了」在晚上九點多的實驗室門口傳來熟悉的聲音  </p>
<p>「Hello, 妳怎麼突然來了？」還來不及反應過來，只能隨手抓個詞應答道  </p>
<p>「剛 meeting 結束，過來看看你們」<br>「你還記得我的論文做些什麼嗎？」</p>
<p>「還記得些，我記得是運行 XXX YYYY 達到 XXXX」對於記憶有點信心，至少認為特別的或重要的事情不會忘</p>
<p>「沒錯！今天老師跟我說 …」</p>
</blockquote>
<p>憑藉著演算法的那些小伎倆，在不擅長的領域到指出自己的想法，希望我還可以派上用場！在這一晚，我想在一旁的學弟又會開始幻想些什麼，儘管在失敗後告誡他們別再拿我的蠢事開玩笑。想著沒有信心地講完後，又要無奈地應對他們，這一晚的關卡好難過。</p>
<p>又過了一陣子，某個晚上</p>
<blockquote>
<p>「Hello, 我來了」這種開場白，不知道為什麼總是這麼有趣<br>「你們實驗室有 XXX 可以借用一下嗎？急用」<br>「我們不是做那一領域的，不會有的，你有問過其他實驗室嗎？」<br>「沒耶，第一個想到的就是問你」</p>
<p>此時，我心中的寫照 <img src="http://i.imgur.com/jLbRRFQ.jpg" alt="《廢天使加百列》"><br>『妳這樣子說，等等我要怎麼跟學弟解釋啊』這個誤會嚴重影響到擅長腦補的朋友們啊！</p>
<p>四處問了下相關領域的學長們是否能租借，最後只能安慰著「明天老實跟老師說吧，沒關係的」</p>
</blockquote>
<p>又過了一陣子，某個下午</p>
<blockquote>
<p>「Hi」又聽到熟悉的聲音，但下午寫程序到了一半，暫時不想停止手邊的工作。<br>「你們實驗室有 XXX 可以借用一下嗎？」</p>
<p>學弟起身，翻著好久沒有整理的紙箱仍沒有結果。工作告一段落的我，加入搜尋的行列<br>「看起來是沒有，就算有，那可以用嗎？」</p>
<p>「應該可以吧？」</p>
<p>繼續翻著箱子說道「看起來是沒有耶」</p>
<p>「ㄟㄟ，你在寫些什麼？」走到我的位子上，稍微看著螢幕上的程序說道</p>
<p>「那個 … 我在寫學弟的作業」身為學長寫著學弟的作業，完全感受不到威嚴</p>
<p>「我的論文重要？還是學弟作業重要！」</p>
<p>突然間，實驗室的人都在竊笑，想必此生的我已經結束了，這跳進黃河也洗不清。<br><img src="http://i.imgur.com/Cv8vxz7.jpg" alt="《廢天使加百列》"></p>
</blockquote>
<hr>
<p>四月初仍忙著論文撰寫，在這修改的煎熬日子裡，不是等待回應，就是將描述手法改來改去。然後，之前在遊戲《楓之谷》認識的交大某數已經提早把論文寫完等畢業，週末突然問我要不要去拜月老，一個剛跟女友分手的正常人和一個從未正常交過女友的肥宅就這麼約著網友聚會去龍山寺拜月老。</p>
<p>不知道那天是怎了，想把手上的事情放掉，鐵了心想做了不同的事情，但是關於「出門拜月老？」這個出遊議題，在內心掙扎著「出門就輸了，若去的話就驗證我二十多年來的失敗 …」最終，由於沒有任何不去的理由，隔天一早就出發了。</p>
<p>當日頂著大太陽，什麼事前調查都沒準備，那麼拜也沒什麼效用，想著當作觀光之旅來看待。至於月老求姻緣的部分，秉持著平常心看待囉！好久沒有拿著香在寺廟裡晃來晃去，有拜學業、拜健康、拜姻緣還有拜商業 … 等。想到自己要來拜個姻緣？嗯，這種無法明確努力的項目，就像天生註定的，我想行為只是基因的載體，意識到自己從未有過，再想著有過與沒有過的差別，我的確不是那一型的個性，那麼沒有也是很正常的吧。</p>
<p>然而，都來了一趟，仍硬是要我問問關於姻緣，心想求姻緣要連續三個聖筊，這個的機率這麼低，如果沒有對於對象任何要求的話，我有機會嗎？先來個二分搜尋法，</p>
<blockquote>
<p>「五年內有機會遇的到嗎？」<br>「不會」神如此回應<br>「那 … 十年內遇的到嗎？」大膽突破點地詢問<br>「沒辦法」神明搖著頭說道<br>「二十年內呢？」作為人而言，我的想法太奢求了<br>「沒有」<br>「這一生有可能嗎？」人生要果斷點，也許才有機會<br>「沒有」</p>
</blockquote>
<p>內心憔悴，先來個中場休息吧。若是再擲下去，探究真理的我也許會想問「還需要活下去嗎？神」看著一旁有人頂著大太陽折騰了好幾十分鐘「兄弟呀，我理解機率是多麼地困難」</p>
<blockquote>
<p>「她跟我不同次元對吧？」換個說法看看吧，希望是找出來的<br>「對」<br>「這樣的我可以活得開心吧」淚水不斷地在內心流淌，原來神告訴我的真理是這個樣子，至今我都沒好好對待。<br>「可以」</p>
</blockquote>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-uva-13154" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/28/uva-13154/" class="article-date">
  <time datetime="2017-04-28T11:40:58.000Z" itemprop="datePublished">2017-04-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/28/uva-13154/">UVa 13154 - Extreme XOR Sum</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/04/28/uva-13154/" data-id="ckq8nvwkz00uotkvneq2kgdys" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/04/28/uva-13154/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/二項係數/">二項係數</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/優化輸入/">優化輸入</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/塊狀表/">塊狀表</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>給一長度為 <span>$N$</span><!-- Has MathJax --> 的整數序列，詢問任意區間的極端異或和 Extreme XOR Sum。</p>
<p>定義 Extreme XOR Sum 為一系列操作的最後一個值</p>
<ul>
<li>當長度 <span>$n&gt;1$</span><!-- Has MathJax --> 時，將陣列縮小為 <span>$n-1$</span><!-- Has MathJax --></li>
<li>對 <span>$[a_0, a_1, a_2, \cdots, a_{n-1}]$</span><!-- Has MathJax -->，每一個元素與後一個元素運行互斥或，將會被轉換成 <span>$[a_0 \oplus a_1, a_1\oplus a_2, a_2 \oplus  a_3, \cdots, a_{n-2}\oplus a_{n-1}]$</span><!-- Has MathJax --></li>
<li>直到只剩下一個元素，即為 Extreme XOR Sum</li>
</ul>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">5</div><div class="line">1  4  6  7  8</div><div class="line">3</div><div class="line">0  0</div><div class="line">0  1</div><div class="line">2  4</div></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Case 1:</div><div class="line">1</div><div class="line">5</div><div class="line">14</div></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>這題詢問次數非常多，一般運行將對每一個詢問達到 <span>$O(N)$</span><!-- Has MathJax --> 的複雜度，這很容易得到 TLE。從大多的數據結構，如線段樹、塊狀表 … 等，他們提供高效率的查找效能，但也必須符合某些條件才能使用。因此，在此題若要符合結合律將變得相當困難。</p>
<h3 id="觀察"><a href="#觀察" class="headerlink" title="觀察"></a>觀察</h3><p>假設要計算陣列 <span>$[1,  4,  6,  7,  8]$</span><!-- Has MathJax --> 的值時</p>
<ul>
<li>第一步，<span>$[1 \oplus 4,  4 \oplus 6,  6 \oplus 7,  7 \oplus 8]$</span><!-- Has MathJax --></li>
<li>第二步，<span>$[1 \oplus 4 \oplus 4 \oplus 6,  \cdots]$</span><!-- Has MathJax --></li>
<li>如此類推下去，XOR 有結合律，我們發現到各別使用了 1 次 <span>$a_0$</span><!-- Has MathJax -->、4 次 <span>$a_1$</span><!-- Has MathJax -->、6 次 <span>$a_2$</span><!-- Has MathJax -->、4 次 <span>$a_3$</span><!-- Has MathJax --> 和 1 次 <span>$a_4$</span><!-- Has MathJax --></li>
</ul>
<p>對於不同的長度，我們發現到是二項係數的配對情況。由於偶數次的 XOR 會互消，只需要計算出現奇數次的即可，因此我們列出二項次數模二的情況，進而得到 Sierpinski triangle/Sierpinski sieve。即使知道 Sierpinski sieve 是二項係數模二的結果，我們仍不知道要怎麼套用結合律達到剖分加速的條件。</p>
<p>二項係數的公式如下</p>
<span>$$\begin{align*}
\binom{n}{m} &amp;= \binom{n-1}{m-1} + \binom{n-1}{m} \\
&Tab;&Tab;&Tab;&amp;= \frac{n!}{m!(n-m)!}
\end{align*}$$</span><!-- Has MathJax -->
<p>階層運算在數學運算上的性質並不多，逼得我們只好往碎形上觀察，以下列出前幾項的結果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">1 1</div><div class="line">1 0 1</div><div class="line">1 1 1 1</div><div class="line">1 0 0 0 1</div><div class="line">1 1 0 0 1 1</div><div class="line">1 0 1 0 1 0 1</div><div class="line">1 1 1 1 1 1 1 1</div><div class="line">1 0 0 0 0 0 0 0 1</div><div class="line">1 1 0 0 0 0 0 0 1 1</div><div class="line">1 0 1 0 0 0 0 0 1 0 1</div><div class="line">1 1 1 1 0 0 0 0 1 1 1 1</div><div class="line">1 0 0 0 1 0 0 0 1 0 0 0 1</div><div class="line">1 1 0 0 1 1 0 0 1 1 0 0 1 1</div><div class="line">1 0 1 0 1 0 1 0 1 0 1 0 1 0 1</div><div class="line">1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</div></pre></td></tr></table></figure>
<p>發現它是一個很有趣的碎形，每個三角形大小都是以二的冪次的。我們按照 <span>$2^3 = 8$</span><!-- Has MathJax --> 切割一下上圖，並且把右邊斜的補上 0 得到下圖。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">1 1</div><div class="line">1 0 1</div><div class="line">1 1 1 1</div><div class="line">1 0 0 0 1</div><div class="line">1 1 0 0 1 1</div><div class="line">1 0 1 0 1 0 1</div><div class="line">1 1 1 1 1 1 1 1</div><div class="line">^---------------</div><div class="line">1 0 0 0 0 0 0 0 |1 0 0 0 0 0 0 0</div><div class="line">1 1 0 0 0 0 0 0 |1 1 0 0 0 0 0 0</div><div class="line">1 0 1 0 0 0 0 0 |1 0 1 0 0 0 0 0</div><div class="line">1 1 1 1 0 0 0 0 |1 1 1 1 0 0 0 0</div><div class="line">1 0 0 0 1 0 0 0 |1 0 0 0 1 0 0 0</div><div class="line">1 1 0 0 1 1 0 0 |1 1 0 0 1 1 0 0</div><div class="line">1 0 1 0 1 0 1 0 |1 0 1 0 1 0 1 0</div><div class="line">1 1 1 1 1 1 1 1 |1 1 1 1 1 1 1 1</div><div class="line">^----------------^--------------</div><div class="line">1 0 0 0 0 0 0 0 |0 0 0 0 0 0 0 0 |1 0 0 0 0 0 0 0</div><div class="line">1 1 0 0 0 0 0 0 |0 0 0 0 0 0 0 0 |1 1 0 0 0 0 0 0</div><div class="line">1 0 1 0 0 0 0 0 |0 0 0 0 0 0 0 0 |1 0 1 0 0 0 0 0</div><div class="line">1 1 1 1 0 0 0 0 |0 0 0 0 0 0 0 0 |1 1 1 1 0 0 0 0</div><div class="line">1 0 0 0 1 0 0 0 |0 0 0 0 0 0 0 0 |1 0 0 0 1 0 0 0</div><div class="line">1 1 0 0 1 1 0 0 |0 0 0 0 0 0 0 0 |1 1 0 0 1 1 0 0</div><div class="line">1 0 1 0 1 0 1 0 |0 0 0 0 0 0 0 0 |1 0 1 0 1 0 1 0</div><div class="line">1 1 1 1 1 1 1 1 |0 0 0 0 0 0 0 0 |1 1 1 1 1 1 1 1</div><div class="line">^                ^                ^ </div><div class="line">箭頭表示本身也是 Sierpinski sieve</div><div class="line"></div><div class="line">區塊縮影得到 miniature pattern 也是 Sierpinski sieve</div><div class="line">1</div><div class="line">1 1</div><div class="line">1 0 1</div></pre></td></tr></table></figure>
<p>得到數個一模一樣的子圖，上述全零和非零的區塊，又恰好構成 Sierpinski sieve。這告訴我們任何操作全都要以二的冪次為基準，且合併區段時須以二項係數為係數。設定 pattern 大小為 <span>$M=2^{\lceil \log_2 N\rceil}$</span><!-- Has MathJax -->，最後得到 miniature pattern。在同一層中，非零構成的條紋都是相同的模式，例如上述得圖中，最後一層的箭號組合必然是 101 或者是 000，最後得到下列公式計算條紋。</p>
<span>$A_{i, j} = A_{i-1}{j} \oplus A_{i-1,j+M}$</span><!-- Has MathJax -->
<p>接下來，我們將需要確定每一個條紋 (stripe) 是否使用全零或者非零，只需要查找 miniature pattern 相應的係數即可。</p>
<h3 id="如何在-Sierpinski-sieve-找到非零係數的位置"><a href="#如何在-Sierpinski-sieve-找到非零係數的位置" class="headerlink" title="如何在 Sierpinski sieve 找到非零係數的位置"></a>如何在 Sierpinski sieve 找到非零係數的位置</h3><p>若 <span>$\binom{n}{i} \mod 2 = 1$</span><!-- Has MathJax -->，必滿足 <span>$n\&amp;i = i$</span><!-- Has MathJax -->。其證明從數學歸納法來，由二冪次的長度碎形著手，移除最高位的 1 得到 <span>$i&apos;$</span><!-- Has MathJax -->，從 <span>$i&apos;$</span><!-- Has MathJax --> 舊有位置集合，保留此集合，並對每一個元素增加二的冪次得到碎形的另一邊。</p>
<p>故可利用下述算法，準確地找到每一個非零的係數位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">for (int pos = n; pos; pos = (pos-1)&amp;n)</div><div class="line">    C[n][pos] mod 2 = 1</div></pre></td></tr></table></figure>
<p>最後附上優化後得到 Rank 1 的程序 0.040 s</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> M = (<span class="number">1</span>&lt;&lt;<span class="number">7</span>);</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">10005</span>;</div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> A[M+<span class="number">1</span>][MAXN];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">miniature</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i*M &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j+i*M &lt; n; j++)</div><div class="line">            A[i][j] = A[i<span class="number">-1</span>][j] ^ A[i<span class="number">-1</span>][j+M];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">extract</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> n = r-l;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> m = n/M;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> o = n%M;</div><div class="line">    <span class="keyword">int</span> ret = A[m][l];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = o; i; i = (i<span class="number">-1</span>)&amp;o)</div><div class="line">        ret ^= A[m][l+i];</div><div class="line">    <span class="keyword">return</span> ret;	</div><div class="line">&#125;</div><div class="line"><span class="keyword">namespace</span> MM &#123;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readchar</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> buf[N];</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> *p = buf, *end = buf;</div><div class="line">        <span class="keyword">if</span>(p == end) &#123;</div><div class="line">            <span class="keyword">if</span>((end = buf + fread(buf, <span class="number">1</span>, N, <span class="built_in">stdin</span>)) == buf) <span class="keyword">return</span> EOF;</div><div class="line">            p = buf;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> *p++;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ReadInt</span><span class="params">(<span class="keyword">int</span> *x)</span> </span>&#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">char</span> c, neg;</div><div class="line">        <span class="keyword">while</span>((c = readchar()) &lt; <span class="string">'-'</span>)    &#123;<span class="keyword">if</span>(c == EOF) <span class="keyword">return</span> <span class="number">0</span>;&#125;</div><div class="line">        neg = (c == <span class="string">'-'</span>) ? <span class="number">-1</span> : <span class="number">1</span>;</div><div class="line">        *x = (neg == <span class="number">1</span>) ? c-<span class="string">'0'</span> : <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span>((c = readchar()) &gt;= <span class="string">'0'</span>)</div><div class="line">            *x = (*x &lt;&lt; <span class="number">3</span>) + (*x &lt;&lt; <span class="number">1</span>) + c-<span class="string">'0'</span>;</div><div class="line">        *x *= neg;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Print</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">        <span class="keyword">char</span> buf[N], *p, *end;</div><div class="line">        Print() &#123;</div><div class="line">            p = buf, end = buf + N - <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">printInt</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">char</span> padding)</span> </span>&#123;</div><div class="line">            <span class="keyword">static</span> <span class="keyword">char</span> stk[<span class="number">16</span>];</div><div class="line">            <span class="keyword">int</span> idx = <span class="number">0</span>;</div><div class="line">            stk[idx++] = padding;</div><div class="line">            <span class="keyword">if</span> (!x)	</div><div class="line">                stk[idx++] = <span class="string">'0'</span>;</div><div class="line">            <span class="keyword">while</span> (x)</div><div class="line">                stk[idx++] = x%<span class="number">10</span> + <span class="string">'0'</span>, x /= <span class="number">10</span>;</div><div class="line">            <span class="keyword">while</span> (idx) &#123;</div><div class="line">                <span class="keyword">if</span> (p == end) &#123;</div><div class="line">                    *p = <span class="string">'\0'</span>;</div><div class="line">                    <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf), p = buf;</div><div class="line">                &#125;</div><div class="line">                *p = stk[--idx], p++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">flush</span><span class="params">()</span> </span>&#123;</div><div class="line">        	*p = <span class="string">'\0'</span>, p = buf;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf);</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">online_printInt</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">            <span class="keyword">static</span> <span class="keyword">char</span> ch[<span class="number">16</span>];</div><div class="line">            <span class="keyword">static</span> <span class="keyword">int</span> idx;</div><div class="line">            idx = <span class="number">0</span>;</div><div class="line">            <span class="keyword">if</span> (x == <span class="number">0</span>)	ch[++idx] = <span class="number">0</span>;</div><div class="line">            <span class="keyword">while</span> (x &gt; <span class="number">0</span>) ch[++idx] = x % <span class="number">10</span>, x /= <span class="number">10</span>;</div><div class="line">            <span class="keyword">while</span> (idx) </div><div class="line">                <span class="built_in">putchar</span>(ch[idx--]+<span class="number">48</span>);</div><div class="line">        &#125;</div><div class="line">        ~Print() &#123;</div><div class="line">            *p = <span class="string">'\0'</span>;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf);</div><div class="line">        &#125;</div><div class="line">    &#125; bprint;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> n, m;</div><div class="line"><span class="comment">//	scanf("%d", &amp;testcase);</span></div><div class="line">    MM::ReadInt(&amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line"><span class="comment">//		scanf("%d", &amp;n);</span></div><div class="line">        MM::ReadInt(&amp;n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line"><span class="comment">//			scanf("%d", &amp;A[0][i]);</span></div><div class="line">            MM::ReadInt(&amp;A[<span class="number">0</span>][i]);</div><div class="line">        miniature(n);</div><div class="line"><span class="comment">//		scanf("%d", &amp;m);</span></div><div class="line">        MM::ReadInt(&amp;m);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case %d:\n"</span>, ++cases);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="keyword">int</span> l, r;</div><div class="line"><span class="comment">//			scanf("%d %d", &amp;l, &amp;r);</span></div><div class="line">            MM::ReadInt(&amp;l), MM::ReadInt(&amp;r);</div><div class="line"><span class="comment">//			printf("%d\n", extract(l, r));</span></div><div class="line">            MM::bprint.printInt(extract(l, r), <span class="string">'\n'</span>);</div><div class="line">        &#125;</div><div class="line">        MM::bprint.flush();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">1</span></div><div class="line"><span class="comment">5</span></div><div class="line"><span class="comment">1  4  6  7  8</span></div><div class="line"><span class="comment">3</span></div><div class="line"><span class="comment">0  0</span></div><div class="line"><span class="comment">0  1</span></div><div class="line"><span class="comment">2  4</span></div><div class="line"><span class="comment">*/</span></div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-big-integer-division" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/09/big-integer-division/" class="article-date">
  <time datetime="2017-04-09T08:13:14.000Z" itemprop="datePublished">2017-04-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/BuPUpad.jpg" rel="gallery_ckq8nvw9i0011tkvncracg5v2">
        <img src="http://i.imgur.com/BuPUpad.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/09/big-integer-division/">關於高效大數除法的那些事</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/04/09/big-integer-division/" data-id="ckq8nvw9i0011tkvncracg5v2" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/04/09/big-integer-division/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FFT/">FFT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/大數/">大數</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>從國小開始學起加減乘除，腦海裡計算加法比減法簡單，減法可以換成加法，乘法則可以換成數個加法。即使到了中國最強的利器——珠心算，我們學習這古老的快速運算時，也都採取這類方法，而除法最為複雜，需要去估算商，嘗試去扣完，再做細微調整。然而，當整數位數為 <span>$N$</span><!-- Has MathJax --> 時，加減法效能為 <span>$N$</span><!-- Has MathJax --> 基礎運算，而乘除法為 <span>$N^2$</span><!-- Has MathJax --> 次基礎運算，一次基礎運算通常定義在查表，例如背誦的九九乘法表，使得我們在借位和乘積運算達到非常快速。</p>
<p>這些方法在計算機發展後，硬體實作大致使用這些算法，直到了快速傅立葉 (FFT) 算法能在 <span>$O(N \log N)$</span><!-- Has MathJax --> 時間內完成旋積 (卷積) 計算，順利地解決了多項式乘法的問題，使得大數乘法能在 <span>$O(N \log N)$</span><!-- Has MathJax --> 時間內完成。</p>
<p>一開始我們知道乘法和除法都可以在 <span>$O(N^2)$</span><!-- Has MathJax --> 時間內完成，有了 FFT 之後，除法是不是也能跟乘法一樣在 <span>$O(N \log N)$</span><!-- Has MathJax --> 內完成？</p>
<h2 id="大數除法"><a href="#大數除法" class="headerlink" title="大數除法"></a>大數除法</h2><p>就目前研究來看，除法可以轉換成乘法運算，在數論的整數域中，若存在乘法反元素，除一個數相當於成一個數，而我們發展的計算機，有效運算為 32/64-bit，其超過的部分視為溢位 (overflow)，溢位則可視為模數。因此，早期 CPU 設計中，除法需要的運行次數比乘法多一些，編譯器會將除法轉換乘法運算 (企圖找到反元素)，來加速運算。現在，由於 intel 的黑魔法，導致幾乎一模一樣快而沒人注意到這些瑣事。</p>
<p>回過頭來，我們介紹一個藉由 FFT 達到的除法運算 <span>$O(N \log N \log N)$</span><!-- Has MathJax --> 的算法。而那多的 <span>$O(\log N)$</span><!-- Has MathJax --> 來自於牛頓迭代法。目標算出 <span>$C = \lfloor A/B \rfloor$</span><!-- Has MathJax -->，轉換成 <span>$C = \lfloor A \ast (1/B) \rfloor$</span><!-- Has MathJax -->，快速算出 <span>$1/B$</span><!-- Has MathJax --> 的值，採用牛頓迭代法。</p>
<p>額外要求整數長度 <span>$n = \text{length}(A)$</span><!-- Has MathJax -->、<span>$m = \text{length}(B)$</span><!-- Has MathJax -->，當計算 <span>$1/B$</span><!-- Has MathJax --> 時，要求精準度到小數點後 <span>$n$</span><!-- Has MathJax --> 位才行。</p>
<h3 id="牛頓迭代法"><a href="#牛頓迭代法" class="headerlink" title="牛頓迭代法"></a>牛頓迭代法</h3><p>目標求 <span>$f(x) = 0$</span><!-- Has MathJax --> 的一組解。</p>
<span>$$\begin{align}
x_{n+1} = x_n - \frac{f(x_n)}{f&apos;(x_n)}
\end{align}$$</span><!-- Has MathJax -->
<p>不斷地迭代逼近找解。若有多組解，則依賴初始值 <span>$x_0$</span><!-- Has MathJax --> 決定優先找到哪一組解。</p>
<blockquote>
<p>這部分也應用在快速開根號——反平方根快速演算法 <a href="https://en.wikipedia.org/wiki/Fast_inverse_square_root" target="_blank" rel="external">Fast inverse square root</a></p>
</blockquote>
<h3 id="倒數計算"><a href="#倒數計算" class="headerlink" title="倒數計算"></a>倒數計算</h3><p>藉由下述定義，找到 <span>$x = 1/B$</span><!-- Has MathJax --></p>
<span>$$\begin{align}
f(x) = \frac{1}{x} - B, \; f&apos;(x) = -\frac{1}{x^2}
\end{align}$$</span><!-- Has MathJax -->
<p>接著推導牛頓迭代法的公式</p>
<span>$$\begin{align}
x_{n+1} &amp;= x_n - \frac{f(x_n)}{f&apos;(x_n)} \\
&Tab;&Tab;&amp;= x_n - \frac{\frac{1}{x} - B}{-\frac{1}{x^2}} = (2 - x_n B) x_n
\end{align}$$</span><!-- Has MathJax -->
<h3 id="運行範例"><a href="#運行範例" class="headerlink" title="運行範例"></a>運行範例</h3><p>當 <span>$A = 7123456, \; B = 123$</span><!-- Has MathJax -->，計算倒數 <span>$1/B = 1/123$</span><!-- Has MathJax -->，由於 <span>$A$</span><!-- Has MathJax --> 為 <span>$n=7$</span><!-- Has MathJax --> 位數，小數點後精準 7 位，意即迭代比較小數點後 7 位不再變動時停止。</p>
<p>以下描述皆以 <strong>十進制</strong> (在程式運行時我們可能會偏向萬進制，甚至億進制來充分利用 32-bit 暫存器)</p>
<ul>
<li>決定 <span>$x_0$</span><!-- Has MathJax --> 是很重要的一步，這嚴重影響著迭代次數。</li>
<li><span>$x_0$</span><!-- Has MathJax --> 拿 <span>$B$</span><!-- Has MathJax --> 的最高位數 1 進行大數除小數，得到 <span>$x_0 = 0.01$</span><!-- Has MathJax --></li>
<li><span>$x_1 = (2 - x_0 \ast B) \ast x_0 = 0.0077$</span><!-- Has MathJax --></li>
<li><span>$x_2 = (2 - x_1 \ast B) \ast x_1 = 0.0081073$</span><!-- Has MathJax --></li>
<li><span>$x_3 = (2 - x_2 \ast B) \ast x_2 = 0.00813001$</span><!-- Has MathJax --></li>
<li><span>$x_4 = (2 - x_3 \ast B) \ast x_3 = 0.00813008$</span><!-- Has MathJax -->
</li>
</ul>
<p>接下來進行移位到整數部分，進行乘法後再移回去即可。</p>
<h3 id="實作細節"><a href="#實作細節" class="headerlink" title="實作細節"></a>實作細節</h3><h4 id="精準度"><a href="#精準度" class="headerlink" title="精準度"></a>精準度</h4><p>使用浮點數實作的 FFT，需要小心精準度，網路上有些代碼利用合角公式取代建表。這類型的優化，在精準度不需要很高的時候提供較好的效能，卻無法提供精準的值，誤差修正成了一道難題。</p>
<h4 id="牛頓迭代"><a href="#牛頓迭代" class="headerlink" title="牛頓迭代"></a>牛頓迭代</h4><p>由於有 FFT 造成的誤差，檢查收斂必須更加地保守，我們可能需要保留小數點下 <span>$n+10$</span><!-- Has MathJax --> 位，在收斂時檢查 <span>$n+5$</span><!-- Has MathJax --> 位確保收斂。通常收斂可以在 20 次左右完成，若發現迭代次數過多，有可能是第一個精準度造成的影響，盡可能使用內建函數得到的三角函數值。</p>
<h4 id="加速優化"><a href="#加速優化" class="headerlink" title="加速優化"></a>加速優化</h4><p>一般使用 IEEE-754 的浮點數格式，根據 FFT 的長度，要避開超過的震級，因此，在 Zerojudge b960 中，最多使用十萬進制進行加速。</p>
<h4 id="誤差修正"><a href="#誤差修正" class="headerlink" title="誤差修正"></a>誤差修正</h4><p>儘管算出的商 <span>$C=A \ast (1/B)$</span><!-- Has MathJax -->，得到的 <span>$C$</span><!-- Has MathJax --> 可能會差個 1，需要在後續乘法中檢驗。</p>
<h2 id="參考題目-資料"><a href="#參考題目-資料" class="headerlink" title="參考題目/資料"></a>參考題目/資料</h2><ul>
<li><a href="https://zerojudge.tw/ShowProblem?problemid=b960" target="_blank" rel="external">Zerojudge b960</a></li>
<li><a href="http://www.spoj.com/problems/VFDIV/" target="_blank" rel="external">SPOJ VFDIV - Very Fast Division</a></li>
<li><a href="http://edisonx.pixnet.net/blog/post/94569776-%5B%E5%A4%A7%E6%95%B8%5D-c-%E8%AA%9E%E8%A8%80%E5%A4%A7%E6%95%B8%E6%BC%94%E7%AE%97%E6%B3%95-for-general-(iii" target="_blank" rel="external">C 語言大數演算法 for general (III) - 大數除法 / Edison.X. Blog</a>—%E5%A4%A7%E6%95%B8)</li>
</ul>
<h2 id="b960-的亂碼"><a href="#b960-的亂碼" class="headerlink" title="b960 的亂碼"></a>b960 的亂碼</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="class"><span class="keyword">class</span> <span class="title">TOOL_FFT</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">complex</span> &#123;</span></div><div class="line">        T x, y;</div><div class="line">        <span class="keyword">complex</span>(T x = <span class="number">0</span>, T y = <span class="number">0</span>):</div><div class="line">            x(x), y(y) &#123;&#125;</div><div class="line">        <span class="keyword">complex</span> <span class="keyword">operator</span>+(<span class="keyword">const</span> <span class="keyword">complex</span> &amp;A) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">complex</span>(x+A.x,y+A.y);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">complex</span> <span class="keyword">operator</span>-(<span class="keyword">const</span> <span class="keyword">complex</span> &amp;A) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">complex</span>(x-A.x,y-A.y);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">complex</span> <span class="keyword">operator</span>*(<span class="keyword">const</span> <span class="keyword">complex</span> &amp;A) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">complex</span>(x*A.x-y*A.y,x*A.y+y*A.x);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    T PI;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span>&lt;&lt;<span class="number">17</span>;</div><div class="line">    <span class="keyword">complex</span> p[<span class="number">2</span>][MAXN];</div><div class="line">    <span class="keyword">int</span> reversePos[MAXN];</div><div class="line">    TOOL_FFT() &#123;</div><div class="line">        PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</div><div class="line">        preprocessing();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">NumberOfBitsNeeded</span><span class="params">(<span class="keyword">int</span> PowerOfTwo)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;; ++i) &#123;</div><div class="line">            <span class="keyword">if</span> (PowerOfTwo &amp; (<span class="number">1</span> &lt;&lt; i)) &#123;</div><div class="line">                <span class="keyword">return</span> i;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> uint32_t <span class="title">FastReverseBits</span><span class="params">(<span class="keyword">uint32_t</span> a, <span class="keyword">int</span> NumBits)</span> </span>&#123;</div><div class="line">        a = ( ( a &amp; <span class="number">0x55555555</span>U ) &lt;&lt; <span class="number">1</span> ) | ( ( a &amp; <span class="number">0xAAAAAAAA</span>U ) &gt;&gt; <span class="number">1</span> ) ;</div><div class="line">        a = ( ( a &amp; <span class="number">0x33333333</span>U ) &lt;&lt; <span class="number">2</span> ) | ( ( a &amp; <span class="number">0xCCCCCCCC</span>U ) &gt;&gt; <span class="number">2</span> ) ;</div><div class="line">        a = ( ( a &amp; <span class="number">0x0F0F0F0F</span>U ) &lt;&lt; <span class="number">4</span> ) | ( ( a &amp; <span class="number">0xF0F0F0F0</span>U ) &gt;&gt; <span class="number">4</span> ) ;</div><div class="line">        a = ( ( a &amp; <span class="number">0x00FF00FF</span>U ) &lt;&lt; <span class="number">8</span> ) | ( ( a &amp; <span class="number">0xFF00FF00</span>U ) &gt;&gt; <span class="number">8</span> ) ;</div><div class="line">        a = ( ( a &amp; <span class="number">0x0000FFFF</span>U ) &lt;&lt; <span class="number">16</span> ) | ( ( a &amp; <span class="number">0xFFFF0000</span>U ) &gt;&gt; <span class="number">16</span> ) ;</div><div class="line">        <span class="keyword">return</span> a &gt;&gt; (<span class="number">32</span> - NumBits);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">FFT</span><span class="params">(<span class="keyword">bool</span> InverseTransform, <span class="keyword">complex</span> In[], <span class="keyword">complex</span> Out[], <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="comment">// simultaneous data copy and bit-reversal ordering into outputs</span></div><div class="line">        <span class="keyword">int</span> NumSamples = n;</div><div class="line">        <span class="keyword">int</span> NumBits = NumberOfBitsNeeded(NumSamples);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NumSamples; ++i) </div><div class="line">            Out[reversePos[i]] = In[i];</div><div class="line">            </div><div class="line">        <span class="comment">// the FFT process</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= NumBits; i++) &#123;</div><div class="line">            <span class="keyword">int</span> BlockSize = <span class="number">1</span>&lt;&lt;i, BlockEnd = BlockSize&gt;&gt;<span class="number">1</span>, BlockCnt = NumSamples/BlockSize;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; NumSamples; j += BlockSize) &#123;</div><div class="line">                <span class="keyword">complex</span> *t = p[InverseTransform];</div><div class="line">                <span class="keyword">int</span> k = <span class="number">0</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UNLOOP_SIZE 8</span></div><div class="line">                <span class="keyword">for</span> (; k+UNLOOP_SIZE &lt; BlockEnd; ) &#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UNLOOP &#123; \</span></div><div class="line">    <span class="keyword">complex</span> a = (*t) * Out[k+j+BlockEnd]; \</div><div class="line">    Out[k+j+BlockEnd] = Out[k+j] - a; \</div><div class="line">    Out[k+j] = Out[k+j] + a;\</div><div class="line">    k++, t += BlockCnt;\</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UNLOOP4 &#123;UNLOOP UNLOOP UNLOOP UNLOOP;&#125;</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UNLOOP8 &#123;UNLOOP4 UNLOOP4;&#125;</span></div><div class="line">                    UNLOOP8;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">for</span> (; k &lt; BlockEnd;)</div><div class="line">                    UNLOOP;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// normalize if inverse transform</span></div><div class="line">        <span class="keyword">if</span> (InverseTransform) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NumSamples; ++i) &#123;</div><div class="line">                Out[i] = Out[i].x / NumSamples;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">convolution</span><span class="params">(T *a, T *b, <span class="keyword">int</span> n, T *c)</span> </span>&#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">complex</span> s[MAXN], d1[MAXN], d2[MAXN], y[MAXN];</div><div class="line">    	n = MAXN;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</div><div class="line">            s[i] = <span class="keyword">complex</span>(a[i], <span class="number">0</span>);</div><div class="line">        FFT(<span class="literal">false</span>, s, d1, n);</div><div class="line">        s[<span class="number">0</span>] = <span class="keyword">complex</span>(b[<span class="number">0</span>], <span class="number">0</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i)</div><div class="line">            s[i] = <span class="keyword">complex</span>(b[n - i], <span class="number">0</span>);</div><div class="line">        FFT(<span class="literal">false</span>, s, d2, n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</div><div class="line">            y[i] = d1[i] * d2[i];</div><div class="line">        FFT(<span class="literal">true</span>, y, s, n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</div><div class="line">            c[i] = s[i].x;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">preprocessing</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> n = MAXN;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i ++) &#123;</div><div class="line">            p[<span class="number">0</span>][i] = <span class="keyword">complex</span>(<span class="built_in">cos</span>(<span class="number">2</span>*i*PI / n), <span class="built_in">sin</span>(<span class="number">2</span>*i*PI / n));</div><div class="line">            p[<span class="number">1</span>][i] = <span class="keyword">complex</span>(p[<span class="number">0</span>][i].x, -p[<span class="number">0</span>][i].y);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> NumBits = NumberOfBitsNeeded(n);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">        	reversePos[i] = FastReverseBits(i, NumBits);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">TOOL_FFT&lt;<span class="keyword">double</span>&gt; tool;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BigInt</span> &#123;</span></div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> *v;</div><div class="line">    <span class="keyword">int</span> size;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> DIGITS = <span class="number">5</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span>&lt;&lt;<span class="number">17</span>;</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(<span class="keyword">const</span> BigInt a, <span class="keyword">const</span> BigInt b)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = MAXN<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">            <span class="keyword">if</span> (a.v[i] &lt; b.v[i])</div><div class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">            <span class="keyword">if</span> (a.v[i] &gt; b.v[i])</div><div class="line">                <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">str2int</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">long</span> <span class="keyword">long</span> buf[])</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> n = <span class="built_in">strlen</span>(s);</div><div class="line">        size = (n+DIGITS<span class="number">-1</span>) / DIGITS;</div><div class="line">        <span class="keyword">int</span> cnt = n%DIGITS == <span class="number">0</span> ? DIGITS : n%DIGITS;</div><div class="line">        <span class="keyword">int</span> x = <span class="number">0</span>, pos = size<span class="number">-1</span>;</div><div class="line">        v = buf;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            x = x*<span class="number">10</span> + s[i] - <span class="string">'0'</span>;</div><div class="line">            <span class="keyword">if</span> (--cnt == <span class="number">0</span>) &#123;</div><div class="line">                cnt = DIGITS;</div><div class="line">                v[pos--] = x, x = <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">println</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%lld"</span>, v[size<span class="number">-1</span>]);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> pos = size<span class="number">-2</span>; pos &gt;= <span class="number">0</span>; pos--)</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%05lld"</span>, v[pos]);</div><div class="line">        <span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function">BigInt <span class="title">multiply</span><span class="params">(<span class="keyword">const</span> BigInt &amp;other, <span class="keyword">long</span> <span class="keyword">long</span> buf[])</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> m = MAXN;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">double</span> na[MAXN], nb[MAXN];</div><div class="line">        <span class="keyword">static</span> <span class="keyword">double</span> tmp[MAXN];</div><div class="line">        <span class="built_in">memset</span>(na+size, <span class="number">0</span>, <span class="keyword">sizeof</span>(v[<span class="number">0</span>])*(m-size));</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</div><div class="line">            na[i] = v[i];</div><div class="line">        <span class="built_in">memset</span>(nb+<span class="number">1</span>, <span class="number">0</span>, <span class="keyword">sizeof</span>(v[<span class="number">0</span>])*(m-other.size));</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j = m<span class="number">-1</span>; i &lt; other.size; i++, j--)</div><div class="line">            nb[j] = other.v[i];</div><div class="line">        nb[<span class="number">0</span>] = other.v[<span class="number">0</span>];</div><div class="line">        tool.convolution(na, nb, m, tmp);</div><div class="line">        BigInt ret;</div><div class="line">        ret.size = m;</div><div class="line">        ret.v = buf;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</div><div class="line">        	buf[i] = (<span class="keyword">long</span> <span class="keyword">long</span>) (tmp[i] + <span class="number">1.5e-1</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">        	<span class="keyword">if</span> (buf[i] &gt;= <span class="number">100000</span>)</div><div class="line">        		buf[i+<span class="number">1</span>] += buf[i]/<span class="number">100000</span>, buf[i] %= <span class="number">100000</span>;</div><div class="line">        &#125;</div><div class="line">        ret.reduce();</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reduce</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (size &gt; <span class="number">1</span> &amp;&amp; <span class="built_in">fabs</span>(v[size<span class="number">-1</span>]) &lt; <span class="number">5e-1</span>)</div><div class="line">            size--;</div><div class="line">    &#125;</div><div class="line">    <span class="function">BigInt <span class="title">divide</span><span class="params">(<span class="keyword">const</span> BigInt &amp;other, <span class="keyword">long</span> <span class="keyword">long</span> buf[])</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">int</span> cmp = compare(*<span class="keyword">this</span>, other);</div><div class="line">            BigInt ret;</div><div class="line">            ret.size = MAXN<span class="number">-1</span>, ret.v = buf;</div><div class="line">            <span class="keyword">if</span> (cmp == <span class="number">0</span>) &#123;</div><div class="line">                <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf[<span class="number">0</span>])*MAXN);</div><div class="line">                buf[<span class="number">0</span>] = <span class="number">1</span>;</div><div class="line">                ret.reduce();</div><div class="line">                <span class="keyword">return</span> ret;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf[<span class="number">0</span>])*MAXN);</div><div class="line">                buf[<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line">                ret.reduce();</div><div class="line">                <span class="keyword">return</span> ret;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// A / B = A * (1/B)</span></div><div class="line">        <span class="comment">// x' = (2 - x * B) * x</span></div><div class="line">        <span class="keyword">int</span> m = MAXN;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">double</span> na[MAXN], nb[MAXN];</div><div class="line">        <span class="keyword">static</span> <span class="keyword">double</span> invB[MAXN], netB[MAXN], tmpB[MAXN];</div><div class="line">        <span class="keyword">static</span> <span class="keyword">long</span> <span class="keyword">long</span> bufB[MAXN];</div><div class="line">        <span class="keyword">int</span> PRECISION = size+<span class="number">10</span>;</div><div class="line">        <span class="built_in">memset</span>(nb+<span class="number">1</span>, <span class="number">0</span>, <span class="keyword">sizeof</span>(v[<span class="number">0</span>])*(m-other.size));</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j = m<span class="number">-1</span>; i &lt; other.size; i++, j--)</div><div class="line">            nb[j] = other.v[i];</div><div class="line">        nb[<span class="number">0</span>] = other.v[<span class="number">0</span>];</div><div class="line">        </div><div class="line">        <span class="built_in">memset</span>(invB, <span class="number">0</span>, <span class="keyword">sizeof</span>(invB[<span class="number">0</span>])*m);</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">long</span> <span class="keyword">long</span> t = <span class="number">100000</span>, a = other.v[other.size<span class="number">-1</span>];</div><div class="line">            <span class="keyword">if</span> (other.size<span class="number">-2</span> &gt;= <span class="number">0</span>)</div><div class="line">                t = t*<span class="number">100000</span>, a = a*<span class="number">100000</span>+other.v[other.size<span class="number">-2</span>];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = PRECISION-other.size; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">                invB[i] = t/a;</div><div class="line">                t = (t%a)*<span class="number">100000</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> it = <span class="number">0</span>; it &lt; <span class="number">100</span>; it++) &#123;</div><div class="line">            <span class="comment">// netB = xi * B</span></div><div class="line">            tool.convolution(invB, nb, m, netB);</div><div class="line">            <span class="keyword">long</span> <span class="keyword">long</span> carry = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= PRECISION*<span class="number">2</span>; i++) &#123;</div><div class="line">            	bufB[i] = carry + (<span class="keyword">long</span> <span class="keyword">long</span>) (netB[i] + <span class="number">1.5e-1</span>);</div><div class="line">            	<span class="keyword">if</span> (bufB[i] &gt;= <span class="number">100000</span>)</div><div class="line">            		carry = bufB[i]/<span class="number">100000</span>, bufB[i] %= <span class="number">100000</span>;</div><div class="line">            	<span class="keyword">else</span></div><div class="line">            		carry = <span class="number">0</span>;</div><div class="line">                bufB[i] = -bufB[i];</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// tmpB = 2 - xi * B</span></div><div class="line">            bufB[PRECISION] += <span class="number">2</span>;</div><div class="line">            <span class="built_in">memset</span>(tmpB, <span class="number">0</span>, <span class="keyword">sizeof</span>(tmpB[<span class="number">0</span>])*m);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= PRECISION*<span class="number">2</span>; i++) &#123;</div><div class="line">            	<span class="keyword">if</span> (bufB[i] &lt; <span class="number">0</span>)</div><div class="line">            		bufB[i] += <span class="number">100000</span>, bufB[i+<span class="number">1</span>]--;</div><div class="line">            	<span class="keyword">if</span> (i != <span class="number">0</span>)</div><div class="line">            		tmpB[m-i] = bufB[i];</div><div class="line">            	<span class="keyword">else</span></div><div class="line">            		tmpB[i] = bufB[i];</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// netB = tmpB * invB</span></div><div class="line">            tool.convolution(invB, tmpB, m, netB);</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">long</span> <span class="keyword">long</span> carry = <span class="number">0</span>;</div><div class="line">                <span class="built_in">memset</span>(bufB, <span class="number">0</span>, <span class="keyword">sizeof</span>(bufB[<span class="number">0</span>])*m);</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= PRECISION*<span class="number">2</span>; i++) &#123;</div><div class="line">                    bufB[i] = carry + (<span class="keyword">long</span> <span class="keyword">long</span>) (netB[i] + <span class="number">1.5e-1</span>);</div><div class="line">                    <span class="keyword">if</span> (bufB[i] &gt;= <span class="number">100000</span>)</div><div class="line">            			carry = bufB[i]/<span class="number">100000</span>, bufB[i] %= <span class="number">100000</span>;</div><div class="line">            		<span class="keyword">else</span></div><div class="line">            			carry = <span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            &#123;</div><div class="line">                <span class="keyword">int</span> same = <span class="number">1</span>;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = PRECISION; same &amp;&amp; i &gt;= <span class="number">5</span>; i--)</div><div class="line">                    same &amp;= ((<span class="keyword">long</span> <span class="keyword">long</span>) (invB[i]) == bufB[i+PRECISION]);</div><div class="line">                <span class="keyword">if</span> (same)</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">memset</span>(invB, <span class="number">0</span>, <span class="keyword">sizeof</span>(invB[<span class="number">0</span>])*m);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i+PRECISION &lt;= PRECISION*<span class="number">2</span>; i++)</div><div class="line">            	invB[i] = bufB[i+PRECISION];</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="built_in">memset</span>(na+<span class="number">1</span>, <span class="number">0</span>, <span class="keyword">sizeof</span>(v[<span class="number">0</span>])*(m-size));</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j = m<span class="number">-1</span>; i &lt; size; i++, j--)</div><div class="line">            na[j] = v[i];</div><div class="line">        na[<span class="number">0</span>] = v[<span class="number">0</span>];</div><div class="line">        tool.convolution(invB, na, m, netB);</div><div class="line">        </div><div class="line">        BigInt ret;</div><div class="line">        ret.size = m<span class="number">-1</span>;</div><div class="line">        ret.v = buf;</div><div class="line">        <span class="keyword">long</span> <span class="keyword">long</span> carry = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">        	buf[i] = carry + (<span class="keyword">long</span> <span class="keyword">long</span>) (netB[i] + <span class="number">1.5e-1</span>);</div><div class="line">        	<span class="keyword">if</span> (buf[i] &gt;= <span class="number">100000</span>)</div><div class="line">        		carry = buf[i]/<span class="number">100000</span>, buf[i] %= <span class="number">100000</span>;</div><div class="line">        	<span class="keyword">else</span></div><div class="line">        		carry = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i+PRECISION &lt; m; i++)</div><div class="line">            buf[i] = buf[i+PRECISION];</div><div class="line">        <span class="built_in">memset</span>(buf+PRECISION, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf[<span class="number">0</span>])*(m-PRECISION));</div><div class="line">        &#123;</div><div class="line">        	<span class="built_in">memset</span>(na, <span class="number">0</span>, <span class="keyword">sizeof</span>(na[<span class="number">0</span>])*m);</div><div class="line">        	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j = m<span class="number">-1</span>; i &lt; m<span class="number">-1</span>; i++, j--)</div><div class="line">                na[j] = buf[i];</div><div class="line">            na[<span class="number">0</span>] = buf[<span class="number">0</span>];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</div><div class="line">            	nb[i] = other.v[i];</div><div class="line">    		tool.convolution(nb, na, m, netB);</div><div class="line">    		<span class="keyword">long</span> <span class="keyword">long</span> carry = <span class="number">0</span>;</div><div class="line">    		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">    			bufB[i] = (carry + (<span class="keyword">long</span> <span class="keyword">long</span>) (netB[i] + <span class="number">1e-1</span>));</div><div class="line">            	<span class="keyword">if</span> (bufB[i] &gt;= <span class="number">100000</span>)</div><div class="line">            		carry = bufB[i]/<span class="number">100000</span>, bufB[i] %= <span class="number">100000</span>;</div><div class="line">            	<span class="keyword">else</span></div><div class="line">            		carry = <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">            carry = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">                bufB[i] = v[i] - bufB[i] + carry;</div><div class="line">                <span class="keyword">if</span> (bufB[i] &lt; <span class="number">0</span>)</div><div class="line">            		bufB[i] += <span class="number">100000</span>, carry = <span class="number">-1</span>;</div><div class="line">            	<span class="keyword">else</span></div><div class="line">            		carry = <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">            BigInt R;</div><div class="line">            R.size = m<span class="number">-1</span>, R.v = bufB;</div><div class="line">            <span class="keyword">if</span> (compare(other, R) &lt;= <span class="number">0</span>) &#123;</div><div class="line">                buf[<span class="number">0</span>]++;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; buf[i] &gt;= <span class="number">100000</span>; i++)</div><div class="line">                    buf[i+<span class="number">1</span>]++, buf[i] -= <span class="number">100000</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        ret.reduce();</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">char</span> sa[<span class="number">1</span>&lt;&lt;<span class="number">20</span>], sb[<span class="number">1</span>&lt;&lt;<span class="number">20</span>];</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%s %s"</span>, sa, sb) == <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">long</span> <span class="keyword">long</span> da[<span class="number">1</span>&lt;&lt;<span class="number">19</span>], db[<span class="number">1</span>&lt;&lt;<span class="number">19</span>], dc[<span class="number">1</span>&lt;&lt;<span class="number">19</span>];</div><div class="line">        </div><div class="line">        BigInt a, b, c;</div><div class="line">        a.str2int(sa, da);</div><div class="line">        b.str2int(sb, db);</div><div class="line">        c = a.divide(b, dc);</div><div class="line">        c.println();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-2017-google-code-jam-qr" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/09/2017-google-code-jam-qr/" class="article-date">
  <time datetime="2017-04-09T06:21:32.000Z" itemprop="datePublished">2017-04-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/KrHRAeT.jpg" rel="gallery_ckq8nvw9f000ttkvnaaljy7fo">
        <img src="http://i.imgur.com/KrHRAeT.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/09/2017-google-code-jam-qr/">2017 Google Code Jam Round QR</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/04/09/2017-google-code-jam-qr/" data-id="ckq8nvw9f000ttkvnaaljy7fo" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/04/09/2017-google-code-jam-qr/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/二分匹配/">二分匹配</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/數學/">數學</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/貪心/">貪心</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <p>「在 24 小時內想不到解法，就註定這一生為處男」－《解題暴君》</p>
<blockquote>
<p>感謝小夥伴們、茵可、妮可的提醒和翻譯，提醒要比賽，結果題目意思猜了一個下午 …</p>
</blockquote>
<h2 id="A-Oversized-Pancake-Flipper"><a href="#A-Oversized-Pancake-Flipper" class="headerlink" title="A. Oversized Pancake Flipper"></a>A. Oversized Pancake Flipper</h2><p>有 <span>$N$</span><!-- Has MathJax --> 個煎餅排成一列，每個煎餅有正反兩面，分別以 <code>+</code> 和 <code>-</code> 表示，現在有一個超大的煎餅翻轉氣，一次可以翻轉恰好連續 <span>$K$</span><!-- Has MathJax --> 個煎餅的狀態，若一次不滿 <span>$K$</span><!-- Has MathJax --> 視為無效操作。給予起始盤面，請問至少要操作幾次才能使其全部都成為正面。</p>
<p>由邊界開始觀察，最左的正面一定不再被翻，如果翻了必然為多一次操作，不斷地推移下去，只有最左邊的反面要依序翻轉，貪心模擬即可。</p>
<h2 id="B-Tidy-Numbers"><a href="#B-Tidy-Numbers" class="headerlink" title="B. Tidy Numbers"></a>B. Tidy Numbers</h2><p>要找到一種特別的數字，這些數字滿足從高位到低位的每一位呈現非嚴格遞減，請問從數字 <span>$1$</span><!-- Has MathJax --> 判斷到 <span>$N$</span><!-- Has MathJax --> 最後一個滿足的數字為何。</p>
<p>最直觀的方案就 <span>$N$</span><!-- Has MathJax --> 開始倒退過去找第一個符合的解。為解決大測資，<span>$N$</span><!-- Has MathJax --> 大到不太可能窮舉，即便很容易出現 <code>???999999</code> 的解，我們可以用更簡單的貪心算法找到這個小於等於 <span>$N$</span><!-- Has MathJax --> 的解。</p>
<ul>
<li>例如輸入為 423</li>
<li>從最高位開始窮舉，第一位不能放 4，其原因在於貪心 444 已經大於 423，退而求其次 333 是可行的一組解</li>
<li>接著再考慮下一位時，我們不必要求小於等於 2，因為前一次窮舉保證小於 423，直接從 9 開始嘗試 399 是否符合解 … 類推。</li>
</ul>
<p>這樣的解法效能為 <span>$O(m^2)$</span><!-- Has MathJax -->，由於位數很小，就可以偷懶地去寫它。</p>
<h2 id="C-Bathroom-Stalls"><a href="#C-Bathroom-Stalls" class="headerlink" title="C. Bathroom Stalls"></a>C. Bathroom Stalls</h2><p>在公共澡堂中，有 <span>$N$</span><!-- Has MathJax --> 個位子排成一列，最左和最右有守衛。現在 <span>$M$</span><!-- Has MathJax --> 名使用者依照順序進入澡堂，每一個人會遠則離其他人盡可能遠的位置，意即往左和往右到第一個人的距離最小值最大化，往左距離為 <span>$L_s$</span><!-- Has MathJax --> 往右為 <span>$R_s$</span><!-- Has MathJax -->，這樣的位置也許會有好幾個，這時候優先選擇 <span>$\max(L_s, R_s)$</span><!-- Has MathJax --> 最大的那一個 (也就是盡可能靠左側)。請問最後一個人的 <span>$\max(L_s, R_s)$</span><!-- Has MathJax --> 和 <span>$\min(L_s, R_s)$</span><!-- Has MathJax --> 分別為多少？</p>
<p>若使用純模擬，時間複雜度可能高達 <span>$O(NM)$</span><!-- Has MathJax -->，大測資是無法在時間內通過的。仔細觀察到題目並未要求找到最後一個人的所在位置，在數學推敲上並不要求太高，那麼我們轉向繼續連續為空的區段分別有多少個。</p>
<ul>
<li>例如一開始長度為 <span>$N=10$</span><!-- Has MathJax --></li>
<li>有一段長度為 10，第一個人必然會將這一個分成兩段 4 和 5</li>
<li>下一個人則會把 5 再分成 2 和 2</li>
<li>下一個人則會把 4 再分成 1 和 2</li>
</ul>
<p>計算過程中，我們按照長度高到低依序挑出，便可以知道最終的結果。為了加速運算，需要紀錄某個長度有多少個，一次統計會使用相同挑選方案的人，來逼近最終的 <span>$M$</span><!-- Has MathJax --> 個人。時間複雜度 <span>$O(\log N)$</span><!-- Has MathJax -->？</p>
<h2 id="D-Fashion-Show"><a href="#D-Fashion-Show" class="headerlink" title="D. Fashion Show"></a>D. Fashion Show</h2><p>在一個方型時尚展場中，我們可以放置 3 種不同的服裝，分別為 <code>+</code>, <code>x</code>, <code>o</code> 三種，其中 <code>+</code>, <code>x</code> 可以為展場增添 1 分，<code>o</code> 可以增添 2 分，我們希望按照下述的規則使得展場總分最高：</p>
<ul>
<li>對於同行或者同列的放置服裝，任兩個之中，至少要有一個為 <code>+</code></li>
<li>對於斜對角 45 度的放置服裝，任兩個之中，至少要有一個為 <code>x</code></li>
</ul>
<p>現在給予一個空的展場和一些已經放置服裝的位置，你只能升級 <code>+</code>, <code>x</code> 服裝為 <code>o</code> 和增加新的服裝在空位置上，使得分數最高，輸出其中一組解即可。</p>
<p>如果只看行列，通常我們可以轉換成二分匹配，其中 <code>(行 i) -- (列 j)</code> 表明了一種放置方案，而中間的匹配邊成為最終的放置選擇。現在多了斜對角，匹配成為最難處理的部份，</p>
<p>題目的規則可以轉換成，行列最多放置一個非 <code>+</code>，同理對角最多放置一個非 <code>x</code>。按照原先的匹配思路，如果放置 <code>x</code>，則相當於匹配某行某列。同理，放置 <code>+</code>，則相當於匹配某斜和某反斜。這裡我們發現如果同時匹配，則視為 <code>o</code>，其匹配數恰好符合題目要求的得分。</p>
<p>對於已經擺設上去的點，預先將其匹配，並且那些行、列、斜線及反斜的代表點則不再與其他節點匹配，最後，我們構造節點個數為 <span>$6N$</span><!-- Has MathJax --> 的二分匹配圖，運行匈牙利或者是最大流算法都可解決。</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><h3 id="A"><a href="#A" class="headerlink" title="A"></a>A</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>, K;</div><div class="line">    <span class="keyword">char</span> s[<span class="number">1024</span>];</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%s %d"</span>, s, &amp;K);</div><div class="line">        <span class="keyword">int</span> n = <span class="built_in">strlen</span>(s);</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>, valid = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (s[i] == <span class="string">'+'</span>)</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            <span class="keyword">if</span> (i+K &lt;= n) &#123;</div><div class="line">                ret++;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; K; j++) &#123;</div><div class="line">                    <span class="keyword">if</span> (s[i+j] == <span class="string">'-'</span>)</div><div class="line">                        s[i+j] = <span class="string">'+'</span>;</div><div class="line">                    <span class="keyword">else</span></div><div class="line">                        s[i+j] = <span class="string">'-'</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        valid = <span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            valid &amp;= s[i] == <span class="string">'+'</span>;</div><div class="line">        <span class="keyword">if</span> (valid)</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Case #%d: %d\n"</span>, ++cases, ret);</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Case #%d: IMPOSSIBLE\n"</span>, ++cases);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="B"><a href="#B" class="headerlink" title="B"></a>B</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="keyword">uint64_t</span> N;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="keyword">char</span> s[<span class="number">1024</span>];</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>, s);</div><div class="line">        <span class="built_in">sscanf</span>(s, <span class="string">"%llu"</span>, &amp;N);</div><div class="line">        <span class="keyword">int</span> n = <span class="built_in">strlen</span>(s);</div><div class="line">        <span class="keyword">uint64_t</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> begin_small = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            <span class="keyword">int</span> prev = ret%<span class="number">10</span>;</div><div class="line">            <span class="keyword">int</span> st = begin_small ? <span class="number">9</span> : (s[i]-<span class="string">'0'</span>);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = st; j &gt;= prev; j--) &#123;</div><div class="line">                <span class="keyword">uint64_t</span> test = ret;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = i; k &lt; n; k++)</div><div class="line">                    test = test*<span class="number">10</span> + j;</div><div class="line">                <span class="keyword">if</span> (test &lt;= N) &#123;</div><div class="line">                    <span class="keyword">if</span> (!begin_small &amp;&amp; j != s[i]-<span class="string">'0'</span>)</div><div class="line">                        begin_small = <span class="number">1</span>;</div><div class="line">                    ret = ret*<span class="number">10</span> + j;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d: %llu\n"</span>, ++cases, ret);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="C"><a href="#C" class="headerlink" title="C"></a>C</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="keyword">long</span> <span class="keyword">long</span> n, m;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%lld %lld"</span>, &amp;n, &amp;m);</div><div class="line">        <span class="built_in">map</span>&lt;<span class="keyword">long</span> <span class="keyword">long</span>, <span class="keyword">long</span> <span class="keyword">long</span>&gt; S;</div><div class="line">        S[n] = <span class="number">1</span>;</div><div class="line">        <span class="keyword">long</span> <span class="keyword">long</span> ret1 = <span class="number">-1</span>, ret2 = <span class="number">-1</span>;</div><div class="line">        <span class="keyword">while</span> (m) &#123;</div><div class="line">            pair&lt;<span class="keyword">long</span> <span class="keyword">long</span>, <span class="keyword">long</span> <span class="keyword">long</span>&gt; e = *S.rbegin();</div><div class="line">            S.erase(e.first);</div><div class="line">            <span class="keyword">if</span> (e.second &gt;= m) &#123;</div><div class="line">                ret1 = e.first/<span class="number">2</span>, ret2 = (e.first<span class="number">-1</span>)/<span class="number">2</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            m -= e.second;</div><div class="line">            <span class="keyword">if</span> (e.first%<span class="number">2</span>) &#123;</div><div class="line">                <span class="keyword">long</span> <span class="keyword">long</span> t = e.first/<span class="number">2</span>;</div><div class="line">                S[t] += <span class="number">2L</span>L*e.second;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">long</span> <span class="keyword">long</span> t = e.first/<span class="number">2</span>;</div><div class="line">                S[t] += e.second;</div><div class="line">                S[t<span class="number">-1</span>] += e.second;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d: %lld %lld\n"</span>, ++cases, ret1, ret2);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="D"><a href="#D" class="headerlink" title="D"></a>D</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">40010</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXE = MAXV * <span class="number">200</span> * <span class="number">2</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1</span>&lt;&lt;<span class="number">29</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> v, cap, flow;</div><div class="line">    Edge *next, *re;</div><div class="line">&#125; Edge;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MaxFlow</span> &#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">    Edge edge[MAXE], *adj[MAXV], *pre[MAXV], *arc[MAXV];</div><div class="line">    <span class="keyword">int</span> e, n, level[MAXV], lvCnt[MAXV], Q[MAXV];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">        n = x, e = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) adj[i] = <span class="literal">NULL</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Addedge</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> flow)</span></span>&#123;</div><div class="line">        edge[e].v = y, edge[e].cap = flow, edge[e].next = adj[x];</div><div class="line">        edge[e].re = &amp;edge[e+<span class="number">1</span>], adj[x] = &amp;edge[e++];</div><div class="line">        edge[e].v = x, edge[e].cap = <span class="number">0</span>, edge[e].next = adj[y];</div><div class="line">        edge[e].re = &amp;edge[e<span class="number">-1</span>], adj[y] = &amp;edge[e++];</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Bfs</span><span class="params">(<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">        <span class="keyword">int</span> front = <span class="number">0</span>, rear = <span class="number">0</span>, r = <span class="number">0</span>, dis = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) level[i] = n, lvCnt[i] = <span class="number">0</span>;</div><div class="line">        level[v] = <span class="number">0</span>, ++lvCnt[<span class="number">0</span>];</div><div class="line">        Q[rear++] = v;</div><div class="line">        <span class="keyword">while</span> (front != rear)&#123;</div><div class="line">            <span class="keyword">if</span> (front == r) ++dis, r = rear;</div><div class="line">            v = Q[front++];</div><div class="line">            <span class="keyword">for</span> (Edge *i = adj[v]; i != <span class="literal">NULL</span>; i = i-&gt;next) &#123;</div><div class="line">                <span class="keyword">int</span> t = i-&gt;v;</div><div class="line">                <span class="keyword">if</span> (level[t] == n) level[t] = dis, Q[rear++] = t, ++lvCnt[dis];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Maxflow</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span></span>&#123;</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>, i, j;</div><div class="line">        Bfs(t);</div><div class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) pre[i] = <span class="literal">NULL</span>, arc[i] = adj[i];</div><div class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; e; ++i) edge[i].flow = edge[i].cap;</div><div class="line">        i = s;</div><div class="line">        <span class="keyword">while</span> (level[s] &lt; n)&#123;</div><div class="line">            <span class="keyword">while</span> (arc[i] &amp;&amp; (level[i] != level[arc[i]-&gt;v]+<span class="number">1</span> || !arc[i]-&gt;flow)) </div><div class="line">                arc[i] = arc[i]-&gt;next;</div><div class="line">            <span class="keyword">if</span> (arc[i])&#123;</div><div class="line">                j = arc[i]-&gt;v;</div><div class="line">                pre[j] = arc[i];</div><div class="line">                i = j;</div><div class="line">                <span class="keyword">if</span> (i == t)&#123;</div><div class="line">                    <span class="keyword">int</span> update = INF;</div><div class="line">                    <span class="keyword">for</span> (Edge *p = pre[t]; p != <span class="literal">NULL</span>; p = pre[p-&gt;re-&gt;v])</div><div class="line">                        <span class="keyword">if</span> (update &gt; p-&gt;flow) update = p-&gt;flow;</div><div class="line">                    ret += update;</div><div class="line">                    <span class="keyword">for</span> (Edge *p = pre[t]; p != <span class="literal">NULL</span>; p = pre[p-&gt;re-&gt;v])</div><div class="line">                        p-&gt;flow -= update, p-&gt;re-&gt;flow += update;</div><div class="line">                    i = s;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span>&#123;</div><div class="line">                <span class="keyword">int</span> depth = n<span class="number">-1</span>;</div><div class="line">                <span class="keyword">for</span> (Edge *p = adj[i]; p != <span class="literal">NULL</span>; p = p-&gt;next)</div><div class="line">                    <span class="keyword">if</span> (p-&gt;flow &amp;&amp; depth &gt; level[p-&gt;v]) depth = level[p-&gt;v];</div><div class="line">                <span class="keyword">if</span> (--lvCnt[level[i]] == <span class="number">0</span>) <span class="keyword">return</span> ret;</div><div class="line">                level[i] = depth+<span class="number">1</span>;</div><div class="line">                ++lvCnt[level[i]];</div><div class="line">                arc[i] = adj[i];</div><div class="line">                <span class="keyword">if</span> (i != s) i = pre[i]-&gt;re-&gt;v;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">&#125; g;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span> (testcase--) &#123;</div><div class="line">        <span class="keyword">int</span> n, m;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;n, &amp;m);</div><div class="line">        </div><div class="line">        g.Init(<span class="number">6</span>*n+<span class="number">5</span>);</div><div class="line">        <span class="keyword">static</span> <span class="keyword">int</span> mm[<span class="number">800</span>][<span class="number">800</span>];</div><div class="line">        <span class="keyword">static</span> <span class="keyword">int</span> mmPos[<span class="number">800</span>][<span class="number">800</span>][<span class="number">2</span>];</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        <span class="built_in">memset</span>(mm, <span class="number">0</span>, <span class="keyword">sizeof</span>(mm));</div><div class="line">        <span class="keyword">int</span> source = <span class="number">6</span>*n+<span class="number">1</span>, sink = <span class="number">6</span>*n+<span class="number">2</span>;</div><div class="line">        <span class="keyword">int</span> board[<span class="number">128</span>][<span class="number">128</span>] = &#123;&#125;;</div><div class="line">        <span class="keyword">int</span> <span class="keyword">board_t</span>[<span class="number">128</span>][<span class="number">128</span>] = &#123;&#125;;</div><div class="line">        <span class="keyword">char</span> board_s[<span class="number">128</span>][<span class="number">128</span>] = &#123;&#125;;</div><div class="line">        <span class="keyword">int</span> ban[<span class="number">800</span>] = &#123;&#125;;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</div><div class="line">                mm[i][j+n] = <span class="number">1</span>;</div><div class="line">                mm[(i+j)+<span class="number">2</span>*n][(i-j+n<span class="number">-1</span>)+<span class="number">4</span>*n] = <span class="number">1</span>;</div><div class="line">                mmPos[i][j+n][<span class="number">0</span>] = i;</div><div class="line">                mmPos[i][j+n][<span class="number">1</span>] = j;</div><div class="line">                mmPos[(i+j)+<span class="number">2</span>*n][(i-j+n<span class="number">-1</span>)+<span class="number">4</span>*n][<span class="number">0</span>] = i;</div><div class="line">                mmPos[(i+j)+<span class="number">2</span>*n][(i-j+n<span class="number">-1</span>)+<span class="number">4</span>*n][<span class="number">1</span>] = j;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">            <span class="keyword">char</span> s[<span class="number">16</span>];</div><div class="line">            <span class="keyword">int</span> x, y;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%s %d %d"</span>, s, &amp;x, &amp;y);</div><div class="line">            x--, y--;</div><div class="line">            board_s[x][y] = s[<span class="number">0</span>];</div><div class="line">            <span class="keyword">if</span> (s[<span class="number">0</span>] == <span class="string">'o'</span>) &#123;</div><div class="line">                ret += <span class="number">2</span>, board[x][y] = <span class="number">2</span>;</div><div class="line">                ban[x] = <span class="number">1</span>, ban[y+n] = <span class="number">1</span>;</div><div class="line">                ban[(x+y)+(<span class="number">2</span>*n)] = <span class="number">1</span>;</div><div class="line">                ban[(x-y+n<span class="number">-1</span>)+<span class="number">4</span>*n] = <span class="number">1</span>;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[<span class="number">0</span>] == <span class="string">'+'</span>) &#123;</div><div class="line">                ret += <span class="number">1</span>, board[x][y] = <span class="number">1</span>;</div><div class="line">                ban[(x+y)+(<span class="number">2</span>*n)] = <span class="number">1</span>;</div><div class="line">                ban[(x-y+n<span class="number">-1</span>)+<span class="number">4</span>*n] = <span class="number">1</span>;</div><div class="line"><span class="comment">//				printf("%d %d\n", x+y+2*n, x-y+n-1+4*n);</span></div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[<span class="number">0</span>] == <span class="string">'x'</span>) &#123;</div><div class="line">                ret += <span class="number">1</span>, board[x][y] = <span class="number">1</span>;</div><div class="line">                ban[x] = <span class="number">1</span>, ban[y+n] = <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">memcpy</span>(<span class="keyword">board_t</span>, board, <span class="keyword">sizeof</span>(board));</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            g.Addedge(source, i, <span class="number">1</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>*n; i &lt; <span class="number">4</span>*n; i++)</div><div class="line">            g.Addedge(source, i, <span class="number">1</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &lt; <span class="number">2</span>*n; i++)</div><div class="line">            g.Addedge(i, sink, <span class="number">1</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">4</span>*n; i &lt; <span class="number">6</span>*n; i++)</div><div class="line">            g.Addedge(i, sink, <span class="number">1</span>);</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = n; j &lt; <span class="number">2</span>*n; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (ban[i] || ban[j] || !mm[i][j])</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                g.Addedge(i, j, <span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>*n; i &lt; <span class="number">4</span>*n<span class="number">-1</span>; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">4</span>*n; j &lt; <span class="number">6</span>*n<span class="number">-1</span>; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (ban[i] || ban[j] || !mm[i][j])</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                g.Addedge(i, j, <span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> flow = g.Maxflow(source, sink);</div><div class="line">        </div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (Edge *p = g.adj[i]; p != <span class="literal">NULL</span>; p = p-&gt;next) &#123;</div><div class="line">                <span class="keyword">if</span> (p-&gt;v &gt;= n &amp;&amp; p-&gt;v &lt; <span class="number">2</span>*n &amp;&amp; p-&gt;flow == <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">board_t</span>[mmPos[i][p-&gt;v][<span class="number">0</span>]][mmPos[i][p-&gt;v][<span class="number">1</span>]]++;</div><div class="line"><span class="comment">//					printf("---- %d %d\n", mmPos[i][p-&gt;v][0], mmPos[i][p-&gt;v][1]);</span></div><div class="line">                    board_s[mmPos[i][p-&gt;v][<span class="number">0</span>]][mmPos[i][p-&gt;v][<span class="number">1</span>]] = <span class="string">'x'</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>*n; i &lt; <span class="number">4</span>*n; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (Edge *p = g.adj[i]; p != <span class="literal">NULL</span>; p = p-&gt;next) &#123;</div><div class="line">                <span class="keyword">if</span> (p-&gt;v &gt;= <span class="number">4</span>*n &amp;&amp; p-&gt;v &lt; <span class="number">6</span>*n &amp;&amp; p-&gt;flow == <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">board_t</span>[mmPos[i][p-&gt;v][<span class="number">0</span>]][mmPos[i][p-&gt;v][<span class="number">1</span>]]++;</div><div class="line"><span class="comment">//					printf("---- %d %d\n", mmPos[i][p-&gt;v][0], mmPos[i][p-&gt;v][1]);</span></div><div class="line">                    board_s[mmPos[i][p-&gt;v][<span class="number">0</span>]][mmPos[i][p-&gt;v][<span class="number">1</span>]] = <span class="string">'+'</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">DD</span> &#123;</span></div><div class="line">            <span class="keyword">int</span> x, y;</div><div class="line">            <span class="keyword">char</span> val;</div><div class="line">            DD(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">char</span> val): x(x), y(y), val(val) &#123;&#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="built_in">vector</span>&lt;DD&gt; V;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (<span class="keyword">board_t</span>[i][j] != board[i][j]) &#123;</div><div class="line">                    <span class="keyword">if</span> (<span class="keyword">board_t</span>[i][j] == <span class="number">2</span>)</div><div class="line">                        V.push_back(DD(i+<span class="number">1</span>, j+<span class="number">1</span>, <span class="string">'o'</span>));</div><div class="line"><span class="comment">//						printf("o %d %d\n", i+1, j+1);</span></div><div class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">board_t</span>[i][j] == <span class="number">1</span>)</div><div class="line">                        V.push_back(DD(i+<span class="number">1</span>, j+<span class="number">1</span>, board_s[i][j]));</div><div class="line"><span class="comment">//						printf("%c %d %d\n", board_s[i][j], i+1, j+1);</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d: %d %d\n"</span>, ++cases, ret+flow, V.size());</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; V.size(); i++)</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%c %d %d\n"</span>, V[i].val, V[i].x, V[i].y);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/5/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/85/">85</a><a class="extend next" rel="next" href="/page/7/">Next &raquo;</a>
    </nav>
  
</section>
          
          
            <aside id="sidebar">
  <!-- <div id="ukagaka_panel"></div> -->
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">115</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算機圖學/">計算機圖學</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/">工作應用</a><span class="category-list-count">32</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Java/">Java</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Meme/">Meme</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/可持久化/">可持久化</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/鬼故事/">鬼故事</a><span class="category-list-count">10</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">633</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">483</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">77</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">45</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2021/06/21/diary-202106/">
              
                <i class="icon-file-o"></i> 
              
            疫情下的工作變化</a>
          </li>
        
          <li>
            <a class="text" href="/2021/06/21/work/company-ghost-story-10/">
              
                <i class="icon-file-o"></i> 
              
            Company Ghost Story 公司鬼故事 10</a>
          </li>
        
          <li>
            <a class="text" href="/2021/05/30/diary-202105/">
              
                <i class="icon-file-o"></i> 
              
            前思後想 新居落成</a>
          </li>
        
          <li>
            <a class="text" href="/2021/05/30/java/java-memory-optimization-2/">
              
                <i class="icon-file-o"></i> 
              
            Java 優化內存使用 組合篇</a>
          </li>
        
          <li>
            <a class="text" href="/2021/05/30/java/java-memory-optimization-1/">
              
                <i class="icon-file-o"></i> 
              
            Java 優化內存使用 結構篇</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/diary-202101/">
              
                <i class="icon-file-o"></i> 
              
            二八進展</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-file-extension/">
              
                <i class="icon-file-o"></i> 
              
            File Extension</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-globl-var/">
              
                <i class="icon-file-o"></i> 
              
            Global Variable</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-handover/">
              
                <i class="icon-file-o"></i> 
              
            Handover</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-interview-recursion/">
              
                <i class="icon-file-o"></i> 
              
            Interview &amp; Recursion</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
  
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2021 Shiang-Yun Yang 
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>