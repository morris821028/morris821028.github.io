<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Morris&#39; Blog">
<meta property="og:url" content="http://morris821028.github.io/page/23/index.html">
<meta property="og:site_name" content="Morris&#39; Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris&#39; Blog">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
  <link rel="import" href="/bower_components/app-layout/app-layout.html"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          
          <section id="main">
  
    <article id="post-zj-d476" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/25/zj-d476/" class="article-date">
  <time datetime="2015-06-24T23:05:28.000Z" itemprop="datePublished">2015-06-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/25/zj-d476/">d476. 區間查詢</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/25/zj-d476/" data-id="ckpaivcac00bxn8vn852ebryp" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/25/zj-d476/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/整體二分/">整體二分</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/離線處理/">離線處理</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>一個長度為 n 的序列，支持兩種操作：</p>
<ol>
<li>输出 <span>$[A, B]$</span><!-- Has MathJax --> 區間第 k 小的數 (從小到大排序後第 k 個)</li>
<li>修改第 I 個數為 W</li>
</ol>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">5 3</span><br><span class="line">1 2 3 4 5</span><br><span class="line">Q 1 4 2</span><br><span class="line">C 2 5</span><br><span class="line">Q 1 4 2</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>在討論用一些雜七雜八的樹類結構去跟莫隊算法搏鬥之餘，用了轉幾何方向去兜資料結構，隨後發現題目尋找的是 unique 而非計數，因此很多想法就垮台，當然出成另一道題目也是不錯。決定尋找其他想法！</p>
<h3 id="開始"><a href="#開始" class="headerlink" title="開始"></a>開始</h3><p>整體二分是什麼呢？假設操作只有修改、詢問，不包含插入、刪除，而且詢問是一個數值結果，這個數值結果可以藉由二分 + 掃描來完成，那就可以使用整體二分來離線支持。</p>
<p>對答案值域分治，將相關操作分治在一起，同時要保留順序性，分治過程中會不斷地累加每一個詢問的掃描數值，最後滿溢時紀錄答案。每一個操作最多在 <span>$\log \text{MAXV}$</span><!-- Has MathJax --> 層計算，因此複雜度是 <span>$O(Q \log \text{MAXV})$</span><!-- Has MathJax -->。</p>
<p>好處是可以用常數較低的結構，所以會比較快？</p>
<h4 id="應用"><a href="#應用" class="headerlink" title="應用"></a>應用</h4><p>這一道經典題有很多作法，如持久化線段樹、塊狀鏈表、歸併樹、劃分樹、 … 等。其中能支持修改的有塊狀鏈表、複雜的持久化線段樹 (主席樹)。</p>
<p>帶修改的區間 K 小，概略說明二分答案 <span>$x$</span><!-- Has MathJax -->，然後去查找小於等於 <span>$x$</span><!-- Has MathJax --> 的數字在區間 <span>$[l, r]$</span><!-- Has MathJax --> 內出現的次數是否大於等於 <span>$K$</span><!-- Has MathJax -->。然後修改元素有加入跟移除，二分答案 mid，要將加入、移除會影響的 <span>$A[i] \le mid$</span><!-- Has MathJax -->，加入或移除時對該數字的索引值 <span>$i$</span><!-- Has MathJax --> 建造統計方案。</p>
<p>對於(位置, 值) <span>$\left \langle i, A[i] \right \rangle$</span><!-- Has MathJax --> 來說，一開始的前 <span>$N$</span><!-- Has MathJax --> 個操作是加入 <span>$\left \langle i, A[i] \right \rangle$</span><!-- Has MathJax -->，二分答案時，用一個 binary indexed tree 去維護 index 的個數，也就是說，對於修改元素 <span>$\left \langle i, A[i] \right \rangle$</span><!-- Has MathJax --> 相當於在二分答案 mid 時，插入 <code>BIT.add(i, 1)</code>，那對於區間詢問，相當於查找 <code>BIT.query([l, r])</code> 如此一來就能知道區間 <span>$[l, r]$</span><!-- Has MathJax --> 在 mid 以內有幾個數字符合。</p>
<p>假設計數大於 k，詢問往左放，反之扣除已知 mid 以內的數量，詢問往右放，如此一來就完成了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">65536</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">65536</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Offline</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Event</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> x, y, k, qtype, qid;</span><br><span class="line">        <span class="keyword">int</span> calc; <span class="comment">//</span></span><br><span class="line">        <span class="built_in">Event</span>(<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>, <span class="keyword">int</span> d = <span class="number">0</span>, <span class="keyword">int</span> e = <span class="number">0</span>, <span class="keyword">int</span> f = <span class="number">0</span>):</span><br><span class="line">            <span class="built_in">x</span>(a), <span class="built_in">y</span>(b), <span class="built_in">k</span>(c), <span class="built_in">qtype</span>(d), <span class="built_in">qid</span>(e), <span class="built_in">calc</span>(f) &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    vector&lt;Event&gt; event;</span><br><span class="line">    <span class="keyword">int</span> N, ret[MAXQ];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;N = N;</span><br><span class="line">        event.<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addEvent</span><span class="params">(<span class="keyword">int</span> qtype, <span class="keyword">int</span> qid, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        event.<span class="built_in">push_back</span>(<span class="built_in">Event</span>(x, y, k, qtype, qid));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">DC</span>(<span class="number">0</span>, event.<span class="built_in">size</span>()<span class="number">-1</span>, <span class="number">0</span>, INF);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// buffer</span></span><br><span class="line">    <span class="keyword">int</span> buf[MAXQ];</span><br><span class="line">    Event ebuf1[MAXQ], ebuf2[MAXQ];</span><br><span class="line">    <span class="comment">// binary indexed tree</span></span><br><span class="line">    <span class="keyword">int</span> bit[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (x &lt;= N) &#123;</span><br><span class="line">            bit[x] += val;</span><br><span class="line">            x += (x)&amp;(-x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x) &#123;</span><br><span class="line">            ret += bit[x];</span><br><span class="line">            x -= (x)&amp;(-x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DC</span><span class="params">(<span class="keyword">int</span> q_l, <span class="keyword">int</span> q_r, <span class="keyword">int</span> val_l, <span class="keyword">int</span> val_r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (q_l &gt; q_r)	<span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span> (val_l == val_r) &#123;	<span class="comment">// find</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = q_l; i &lt;= q_r; i++)</span><br><span class="line">                <span class="keyword">if</span> (event[i].qtype == <span class="number">2</span>)</span><br><span class="line">                    ret[event[i].qid] = val_l;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> mid = (val_l + val_r)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = q_l; i &lt;= q_r; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (event[i].qtype == <span class="number">0</span> &amp;&amp; event[i].y &lt;= mid)</span><br><span class="line">                <span class="built_in">add</span>(event[i].x, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (event[i].qtype == <span class="number">1</span> &amp;&amp; event[i].y &lt;= mid)</span><br><span class="line">                <span class="built_in">add</span>(event[i].x, <span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (event[i].qtype == <span class="number">2</span>)</span><br><span class="line">                buf[i] = <span class="built_in">query</span>(event[i].y) - <span class="built_in">query</span>(event[i].x<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = q_l; i &lt;= q_r; i++) &#123; <span class="comment">// resume</span></span><br><span class="line">            <span class="keyword">if</span> (event[i].qtype == <span class="number">0</span> &amp;&amp; event[i].y &lt;= mid)</span><br><span class="line">                <span class="built_in">add</span>(event[i].x, <span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (event[i].qtype == <span class="number">1</span> &amp;&amp; event[i].y &lt;= mid)</span><br><span class="line">                <span class="built_in">add</span>(event[i].x, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> lidx = <span class="number">0</span>, ridx = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = q_l; i &lt;= q_r; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (event[i].qtype == <span class="number">0</span> || event[i].qtype == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (event[i].y &lt;= mid)</span><br><span class="line">                    ebuf1[lidx++] = event[i];</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    ebuf2[ridx++] = event[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (event[i].calc + buf[i] &gt; event[i].k - <span class="number">1</span>)</span><br><span class="line">                    ebuf1[lidx++] = event[i];</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    event[i].calc += buf[i];</span><br><span class="line">                    ebuf2[ridx++] = event[i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lidx; i++)</span><br><span class="line">            event[q_l+i] = ebuf1[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ridx; i++)</span><br><span class="line">            event[q_l+lidx+i] = ebuf2[i];</span><br><span class="line">        <span class="built_in">DC</span>(q_l, q_l+lidx<span class="number">-1</span>, val_l, mid);</span><br><span class="line">        <span class="built_in">DC</span>(q_l+lidx, q_r, mid+<span class="number">1</span>, val_r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; off;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m, x, y, k, v;</span><br><span class="line">    <span class="keyword">int</span> A[<span class="number">65536</span>];</span><br><span class="line">    <span class="keyword">char</span> cmd[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m) == <span class="number">2</span>) &#123;</span><br><span class="line">        off.<span class="built_in">init</span>(n);</span><br><span class="line">        <span class="comment">// qtype 0:add, 1:remove, 2: query</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;A[i]);</span><br><span class="line">            off.<span class="built_in">addEvent</span>(<span class="number">0</span>, <span class="number">0</span>, i, A[i], <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> qid = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, cmd);</span><br><span class="line">            <span class="keyword">if</span> (cmd[<span class="number">0</span>] == <span class="string">&#x27;Q&#x27;</span>) &#123;</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;x, &amp;y, &amp;k);</span><br><span class="line">                off.<span class="built_in">addEvent</span>(<span class="number">2</span>, qid++, x, y, k);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;v);</span><br><span class="line">                off.<span class="built_in">addEvent</span>(<span class="number">1</span>, <span class="number">0</span>, x, A[x], <span class="number">0</span>);</span><br><span class="line">                off.<span class="built_in">addEvent</span>(<span class="number">0</span>, <span class="number">0</span>, x, v, <span class="number">0</span>);</span><br><span class="line">                A[x] = v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        off.<span class="built_in">run</span>();		</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; qid; i++)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, off.ret[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-security-notes7" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/23/security-notes7/" class="article-date">
  <time datetime="2015-06-23T00:06:29.000Z" itemprop="datePublished">2015-06-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/資訊安全/">資訊安全</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/23/security-notes7/">近代加密 小額付費</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/23/security-notes7/" data-id="ckpaivc88004hn8vn4fas1srj" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/23/security-notes7/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/密碼學/">密碼學</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="關於小額付費"><a href="#關於小額付費" class="headerlink" title="關於小額付費"></a>關於小額付費</h2><p>另一個名稱為 ** 微支付 ** (Micropayment)，簡單來說提供顧客 (Consumer) - 銀行 (Broker) - 商家 (Vendor) 三方的交易。小額付費標明在交易金額小，因此交易成本也應該小，否則交易手續的計算能量就超過交易金額，更別說要扣除交易物品的成本。通常要在以下三點最小化</p>
<ul>
<li>計算資源：<br>在先前提到的加密算法中，key 的 bit-length 相當長，導致計算的能量消耗大。倘若只消費 1 元，耗電成本就佔了 1% 以上，甚至更多，那麼是划不來的。</li>
<li>儲存空間花費：<br>計算每一組交易明細所需要的空間要最小，例如記錄金額需要 32-bit，那麼 n 次交易就需要 n 個 32-bit 的空間，在其他細節中還需要紀錄額外的購買來源、 … 等。</li>
<li>管理成本：<br>第三方 (通常是銀行) 要管理顧客的金額花費、商家是否能取用顧客的錢。銀行要怎麼紀錄顧客的狀態、如何驗證商家真的有跟顧客交易 … 等。</li>
</ul>
<p>由於交易金額小，即使被破解對雙方的損失也不大。但通常破解手段需要的時間、資源往往超過交易金額，因此不太會有人去破解這個。</p>
<h2 id="應用層面"><a href="#應用層面" class="headerlink" title="應用層面"></a>應用層面</h2><h3 id="網路電子報："><a href="#網路電子報：" class="headerlink" title="網路電子報："></a>網路電子報：</h3><p>一份電子報可能有一些特別的標題內容，若要深入查閱內文，需要讀者付費觀看。這一部分更具有彈性，對於一份具有相當多面向的電子報而言，有些人只看幾個專欄就必須花費購買一整本的金額，有些時候是浪費的。</p>
<h3 id="網路期刊購買、資料庫詢問"><a href="#網路期刊購買、資料庫詢問" class="headerlink" title="網路期刊購買、資料庫詢問"></a>網路期刊購買、資料庫詢問</h3><p>網路學術期刊就跟電子報的情況一樣。資料庫詢問比較特別，花費小金額來交換資料庫服務的次數。</p>
<h3 id="廣告"><a href="#廣告" class="headerlink" title="廣告"></a>廣告</h3><p>互動式影片、廣告商為了誘拐大眾仔細觀看廣告，由廣告商付錢給觀看者。例如回答問卷回饋、機率性地抽獎回饋 … 等。</p>
<h3 id="網頁閱讀"><a href="#網頁閱讀" class="headerlink" title="網頁閱讀"></a>網頁閱讀</h3><p>類似向大眾徵文，鼓勵分享知識。徵求到的文章，由平台供應者支付。</p>
<h2 id="何時用"><a href="#何時用" class="headerlink" title="何時用"></a>何時用</h2><p>使用者付費，而非訂閱長時間的垃圾訊息或服務。在大多數的服務商中，會提供時間內無限使用或按照次數計費兩種方案，在大多數的情況下，時間內無限使用是對商家有利，可以預先得到使用者的投資，但使用者在後續時間內可能沒有去使用、或者沒時間去用。</p>
<p>不是 ** 按照次數計費全然好 **，就如 ** 電話費 **，打了多少通電話、講了多久，只有電信商知道，即便告訴花費相當多金額，通話明細也是由他們提供，很難證明到底花了多少，這是對使用者的不利。相較起來，小額付費比較接近投幣式的公共電話，投了多少就打多少，等到快沒有餘額時，再進行補充。</p>
<p>先付款給商家會對使用者不利，有可能取得不好的服務，後付款給商家會對商家不利，因為使用者可能沒有足夠的金額。正因為小額交易，適時地刷新狀態 (再投幣) 就能在之間達到平衡。</p>
<h2 id="數學"><a href="#數學" class="headerlink" title="數學"></a>數學</h2><p>由制定 RSA 那伙人 Rivest, Shamir 提供 Payword scheme 的方法。</p>
<p>首先，概念建立在假設不用數字儲存金額 (減少儲存空間、管理花費)，而是用運算次數來知道花費金額 (用簡單運算來完成，防止能源消耗過大)。金額花費是整數，由最小單位 1 元構成，如果是在通貨膨脹的國家，最小單位可能不一樣？</p>
<p>那麼可以建立一個儲值金額 n 元的串列如下。</p>
<span>$x_0 \leftarrow x_1 \leftarrow x_2 \leftarrow \text{ ... } \leftarrow x_{n-1} \leftarrow x_n$</span><!-- Has MathJax -->

<p>由使用者拿一個<span>$x_n$</span><!-- Has MathJax --> 初始化，接著利用 hash<span>$x_i = h(x_{i+1})$</span><!-- Has MathJax --> 得到每一個硬幣<span>$x_i$</span><!-- Has MathJax -->。用數學表示遞迴公式<span>$x_i = h^{n-i}(x_n)$</span><!-- Has MathJax -->。</p>
<p>當顧客跟商家交易時，簽一份簽章 (例如用 RSA 或者是 DSA 等方式) 給商家。簽章內容為</p>
<span>$\text{Sign}_C(\text{Merchant-ID} || x_0 || \text{Cert})$</span><!-- Has MathJax -->

<p>其中 <span>$\text{Cert}$</span><!-- Has MathJax --> 是由第三方信任銀行簽署給用戶的內容 (類似銀行帳戶的確認)。最後發送給商家資訊為</p>
<span>$\text{Sign}_C(\text{Merchant-ID} || x_0 || \text{Cert}), \text{Merchant-ID}, x_0, \text{Cert}$</span><!-- Has MathJax -->

<p>由商人去驗證 (檢查簽證內容、拿對方的 public key 打開，再去拿銀行的 public key 驗證 <span>$\text{Cert}$</span><!-- Has MathJax -->  是否正確) 是否是可信任的顧客或者是顧客是否存在。</p>
<p>接下來交易採用最笨的方案，每一次交易 1 元，交付 i 元時，顧客就告知<span>$x_i$</span><!-- Has MathJax --> 值給商家，這裡顧客得到硬幣方法為重新計算<span>$x_i = h^{n-i}(x_n)$</span><!-- Has MathJax -->，可以不事先用記憶體儲存<span>$[x_0, x_n]$</span><!-- Has MathJax -->，保留 <span>$n$</span><!-- Has MathJax --> 和<span>$x_n$</span><!-- Has MathJax --> 即可。</p>
<p>之後商家拿著 i 元<span>$x_i$</span><!-- Has MathJax --> 和<span>$\text{Sign}_C(\text{Merchant-ID} || x_0 || \text{Cert})$</span><!-- Has MathJax --> 的資訊給銀行，銀行計算 <span>$i$</span><!-- Has MathJax --> 次 hash<span>$x_0 = h^i(x_i)$</span><!-- Has MathJax --> 查看是否正確，若檢驗沒問題，則銀行從客戶存簿撥款給商家。</p>
<h3 id="為什麼可行"><a href="#為什麼可行" class="headerlink" title="為什麼可行"></a>為什麼可行</h3><p>運算過程中使用 hash，hash 提供不可逆的操作，因此商家無法有更多金額的索取，假設從顧客手中得到<span>$x_i$</span><!-- Has MathJax -->，無法計算出<span>$x_{i+1}$</span><!-- Has MathJax --> 究竟是什麼，具有一定安全性。而顧客必須由銀行索取簽證，來表示當前的狀態是合法的，顧客沒辦法竄改自己的狀態，使得自己有更多的金錢，銀行那裏會有最新一組的簽章在？應該是吧，銀行會在商家發送驗證資訊時發生異狀檢查顧客是否竄改。</p>
<p>數學之美。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-diary-20150622" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/23/diary-20150622/" class="article-date">
  <time datetime="2015-06-22T22:39:00.000Z" itemprop="datePublished">2015-06-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/Owisoua.png" rel="gallery_ckpaivc76000yn8vn6f2sayt1">
        <img src="http://i.imgur.com/Owisoua.png" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/23/diary-20150622/">服務學習心得指南系列 曾經何時 那份信任</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/23/diary-20150622/" data-id="ckpaivc76000yn8vn6f2sayt1" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/23/diary-20150622/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/中央大學/">中央大學</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/服務學習/">服務學習</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="真實短篇"><a href="#真實短篇" class="headerlink" title="真實短篇"></a>真實短篇</h2><p> 補繳外出活動證明走向服務中心，骨氣勇氣向工讀生說道<br>「上次繳交的證明是活動單位發錯了 … 這是一份新的。」</p>
<p>工讀生轉向交給後頭的領導，在那談了不久，我開始心有點緊張，也許是該結束了吧，那兒的領導走了過來，緩慢地說</p>
<p>「關於這份參加證明，後來有打電話去問，確定沒錯。」<br>「恩恩，我這個是補繳的。」</p>
<p>沒想到他們還主動聯絡，也許我要對它們改觀了，查證方面卻是格外的嚴格。但在百般愉悅之下，馬上迎來沉重的第二段話</p>
<p>「但是你寫的心得是抄網站上的，有同學參加那活動且心得寫得不錯。」<br>「沒這樣的吧，我根本沒注意活動官網上寫什麼。」</p>
<p>為什麼，難道就這樣子了嗎？原來我已經只剩下宣傳式海報的心得流了嗎？之前在辦公桌上，看到有人用字體 8 印出不到幾個字的心得，原來我就只有這樣啊。</p>
<p>「如果你有去的話，應該就能寫比較多吧，這個都是抄網站上的，這樣不行，要不然我開給你看看。」<br>「算了，好吧。」</p>
<p>挫折感是如此地沉重，我不想寫了，到底什麼是心得、至今我又寫了什麼。沮喪地走出服務台，沒想到走出這棟建築物是如此地困難 … 原來天已經這麼黑了 …</p>
<p>「不對！文章我有寫到動漫、美劇，這官網上不會有的吧。」</p>
<p>趕緊回頭再問個清楚，回到服務台招著手問「等等，你說的網站是哪一個？」</p>
<p>「正在印那個網站下來。」</p>
<p>聽著那列表機刷刷的聲音，已經預想到如果不在那個時間點回來，我的心得就會隨著那幾張紙釘起來拿去退件區存放。然後，曾經存在過的證明就消失了。</p>
<p>遞著剛印有網站內容的紙張給我「你看吧，這就是那個網站。」</p>
<p>「那是我的部落格 …」</p>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>這件事情他們也很辛苦，畢竟這個時間點的心得大多都是抄襲，平常不參加活動的宅宅為了畢業去弄心得繳交來獲得認可，而我就是其中一個。</p>
<p>非常不屑 ** 服務學習時數 ** 制度，不敢說自己有多麼深有感觸，也不能說具有完善的能力，這樣的制度一開始的用意是好的，相較於其他大學是 ** 完全自主 **，別的大學靠著修課參與就會滿足時數需求，中央大學是全台國立大學中最特別的一個。</p>
<p>曾經訪問過服務學習辦公室這件事情「有多少人會因為這個不能畢業」他們是這麼回答的「微乎其微」這此我又問了一個問題「心得審核中，聽說不少劣質內容也可以申請成功」他們是這麼回答的「這樣的事情應該是沒有，我們都有嚴格把關。」當時基於信任機制，就這麼相信他們說出的內容寫下報告繳交。</p>
<p>台灣之所以開始舉行「服務學習」為畢業門檻，原因是學老美那一套「** 它是一種『服務』與『學習』並重的經驗教育方式 **」那台灣現況又是如何呢？大約有五種類型如下描述</p>
<ul>
<li>有大學提供課程規劃完成時數認證</li>
<li>有大學提供導師課程，師生一起規劃</li>
<li>有大學不存在服務學習時數為畢業門檻</li>
<li>有大學不拿服務學習時數為畢業門檻，累積時數換通識課程學分</li>
<li>有大學提供全自主完成時數認證</li>
</ul>
<p>舉辦服務學習需要心力跟人力，因為要認證 ** 成長 ** 情況，所以內容就相當大眾才能被認可吧，寫一些奇葩的內容會被給予什麼評語呢？成腔濫調的成長是值得寫下的嗎？基於每一個人對自我成長的觀點不同，認可這件事情就成了奇怪的制度，自我的成長卻要由別人來劃分定奪。</p>
<p>就我看來，實際運行就是制度上，麻痺自我的簽名參加，就好像做了服務學習，若去問服務中心就會得到回答「** 這是自己選的，也有不少人參加活動是相當用心參與 **」反正在某些情況躺著過也是被認可的，如果要去就要做到好，要是預期做不好參與，那也沒有必要麻痺欺瞞自己去參加。如果四年內學到的是欺瞞制度，這股風氣就會延長吧。</p>
<p>這又讓我想到有門課「** 比起內容更注重報告 **」程式做了什麼不重要，即便你們做了很少，報告看起來很有料就是加分。問了其他學校的助理教授看法「報告吸引錢的方法，實作並不能。」心中頓悟，原來世界並不是想像中的理想。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-TIOJ-1475" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/22/TIOJ-1475/" class="article-date">
  <time datetime="2015-06-22T01:24:23.000Z" itemprop="datePublished">2015-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/22/TIOJ-1475/">TIOJ 1475 錄製專輯 (Record)</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/22/TIOJ-1475/" data-id="ckpaivc6z000in8vn9u3z0hu9" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/22/TIOJ-1475/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dp/">dp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/大數/">大數</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Jolin 是個愛唱歌的小孩，每次總喜歡邊唱邊用電腦把自己的歌聲錄下來，因此長久下來，在她的電腦裡，已儲存了為數不小的個人歌唱作品。由於耶誕節快要到了，為了準備一份特別的耶誕禮物給爸爸，Jolin 準備從電腦中儲存的個人歌唱作品，挑選幾首歌製成一張個人專輯 CD。由於每張 CD 的容量有限，而Jolin 的個人歌唱作品早已遠遠超過一張 CD 可收錄的容量，因此 Jolin 希望你可以幫她想辦法，讓她所製作的專輯中，能有數目最多的歌曲（請注意：每一首歌只能被收錄一次），同時必需剛好裝滿整張 CD，不留下任何未使用的空間。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">10 50 30 70 60</span><br><span class="line">80 </span><br><span class="line">5</span><br><span class="line">10 50 30 70 60</span><br><span class="line">20 </span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2 4</span><br><span class="line">0 0 </span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>實作 C++ 簡單的加法、乘法大數，直接把別提的拿過來用。</p>
<p>套用 0/1 背包問題，額外增加大數紀錄方法數，最後乘上 <span>$N!$</span><!-- Has MathJax --> 即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BigInteger</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;<span class="keyword">long</span> <span class="keyword">long</span>&gt; v;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> MAXC;</span><br><span class="line">    <span class="built_in">BigInteger</span>(<span class="keyword">int</span> x = <span class="number">0</span>) &#123;</span><br><span class="line">        v = vector&lt;<span class="keyword">long</span> <span class="keyword">long</span>&gt;(<span class="number">10</span>, <span class="number">0</span>);</span><br><span class="line">        v[<span class="number">0</span>] = x;</span><br><span class="line">        MAXC = <span class="number">100000000</span>;</span><br><span class="line">        <span class="built_in">normal</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    BigInteger <span class="keyword">operator</span>+(<span class="keyword">const</span> BigInteger &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="function">BigInteger <span class="title">r</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">        r.v.<span class="built_in">resize</span>(<span class="built_in">max</span>(v.<span class="built_in">size</span>(), x.v.<span class="built_in">size</span>()) + <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; v.<span class="built_in">size</span>(); i++)</span><br><span class="line">            r.v[i] += v[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; x.v.<span class="built_in">size</span>(); i++)</span><br><span class="line">            r.v[i] += x.v[i];</span><br><span class="line">        r.<span class="built_in">normal</span>();</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">    BigInteger <span class="keyword">operator</span>*(<span class="keyword">const</span> BigInteger &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="function">BigInteger <span class="title">r</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">        r.v.<span class="built_in">resize</span>(v.<span class="built_in">size</span>() + x.v.<span class="built_in">size</span>() + <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; v.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (v[i] == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; x.v.<span class="built_in">size</span>(); j++)</span><br><span class="line">                r.v[i+j] += v[i] * x.v[j];</span><br><span class="line">        &#125;</span><br><span class="line">        r.<span class="built_in">normal</span>();</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">normal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; v.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (v[i] &gt;= MAXC) &#123;</span><br><span class="line">                v[i+<span class="number">1</span>] += v[i] / MAXC;</span><br><span class="line">                v[i] %= MAXC;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> s = (<span class="keyword">int</span>) v.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (s &gt; <span class="number">0</span> &amp;&amp; v[s] == <span class="number">0</span>)</span><br><span class="line">            s--;</span><br><span class="line">        v.<span class="built_in">resize</span>(s+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isZero</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (v.<span class="built_in">size</span>() &gt; <span class="number">1</span>)   <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> v[<span class="number">0</span>] == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> BigInteger &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">    	<span class="keyword">if</span> (v.<span class="built_in">size</span>() != x.v.<span class="built_in">size</span>())</span><br><span class="line">    		<span class="keyword">return</span> v.<span class="built_in">size</span>() &lt; x.v.<span class="built_in">size</span>();</span><br><span class="line">    	<span class="keyword">for</span> (<span class="keyword">int</span> i = v.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    		<span class="keyword">if</span> (v[i] != x.v[i])</span><br><span class="line">    			<span class="keyword">return</span> v[i] &lt; x.v[i];</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> BigInteger &amp;x)  <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (v.<span class="built_in">size</span>() != x.v.<span class="built_in">size</span>())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = v.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            <span class="keyword">if</span> (v[i] != x.v[i])</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>, v[v.<span class="built_in">size</span>()<span class="number">-1</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = (<span class="keyword">int</span>) v.<span class="built_in">size</span>() - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%08lld&quot;</span>, v[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N, M, A[<span class="number">128</span>];</span><br><span class="line">    BigInteger f[<span class="number">128</span>] = &#123;&#125;;</span><br><span class="line">    f[<span class="number">0</span>] = <span class="built_in">BigInteger</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">128</span>; i++)</span><br><span class="line">        f[i] = f[i<span class="number">-1</span>] * <span class="built_in">BigInteger</span>(i);</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;N) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;A[i]);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;M);</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">sort</span>(A, A + N);</span><br><span class="line">        <span class="keyword">int</span> dp[<span class="number">10005</span>] = &#123;&#125;;</span><br><span class="line">        BigInteger dp2[<span class="number">10005</span>] = &#123;&#125;;</span><br><span class="line">        dp2[<span class="number">0</span>] = <span class="built_in">BigInteger</span>(<span class="number">1</span>), dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = A[i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = M; j &gt;= x; j--) &#123;</span><br><span class="line">                <span class="keyword">if</span> (dp[j] &lt; dp[j-x] + <span class="number">1</span> &amp;&amp; !dp2[j-x].<span class="built_in">isZero</span>())</span><br><span class="line">                    dp[j] = dp[j-x] + <span class="number">1</span>, dp2[j] = <span class="built_in">BigInteger</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">if</span> (dp[j] == dp[j-x] + <span class="number">1</span> &amp;&amp; !dp2[j-x].<span class="built_in">isZero</span>())</span><br><span class="line">                    dp2[j] = dp2[j] + dp2[j-x];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> a = dp[M];</span><br><span class="line">        BigInteger b = dp2[M] * f[a];</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, a);</span><br><span class="line">        b.<span class="built_in">print</span>();</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">10 50 30 70 60</span></span><br><span class="line"><span class="comment">20 </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-bzoj-2038" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/22/bzoj-2038/" class="article-date">
  <time datetime="2015-06-22T01:05:47.000Z" itemprop="datePublished">2015-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/22/bzoj-2038/">BZOJ 2038 小 Z 的袜子</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/22/bzoj-2038/" data-id="ckpaivc73000on8vnb3l5djep" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/22/bzoj-2038/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/莫隊算法/">莫隊算法</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/離線處理/">離線處理</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>給一個序列，詢問一個區間中任挑兩個數字，這兩個數字相同的機率為何，將答案化簡後輸出。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">6 4</span><br><span class="line">1 2 3 3 3 2</span><br><span class="line">2 6</span><br><span class="line">1 3</span><br><span class="line">3 5</span><br><span class="line">1 6</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2/5</span><br><span class="line">0/1</span><br><span class="line">1/1</span><br><span class="line">4/15</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>莫隊算法命名是莫濤隊伍想出來的，不算是特別算法命名，估計是比賽中想到，目前沒看到英文命名。</p>
<p>莫隊算法處理離線詢問，回答所有答案複雜度為 <span>$O(N^{1.5})$</span><!-- Has MathJax -->，其中 N 是區間索引值的範圍大小。概念在於分塊處理如下：</p>
<ul>
<li>對於每個詢問的左端點放置於同一塊去處理</li>
<li>每一次處理一個塊狀的所有詢問</li>
<li>對於同一塊，詢問的右端點嚴格遞增去處理，讓左端點不斷地移動</li>
</ul>
<p>發現到單獨看左端點指針的移動，約為 <span>$O(N^{1.5})$</span><!-- Has MathJax -->，只考慮同一塊，最多有 <span>$N$</span><!-- Has MathJax --> 的詢問，一個詢問會造成左端點移動 <span>$O(N^{0.5})$</span><!-- Has MathJax -->。而單獨看又端點指針的移動，約為 <span>$O(N^{1.5})$</span><!-- Has MathJax -->，由於只會有 <span>$O(N^{0.5})$</span><!-- Has MathJax --> 塊，每一塊最慘就是遞增的移動 <span>$O(N)$</span><!-- Has MathJax -->。</p>
<p>只要轉移區間 (維護區間的答案、計數，例如從 <code>[l, r]</code> 變成 <code>[l, r-1]</code> 的答案維護，把區間左右端點變大變小 1 的轉移計算) 的速度快，則複雜度約為 <span>$O(N^{1.5})$</span><!-- Has MathJax -->。有不少情況需要 <span>$O(\log N)$</span><!-- Has MathJax --> 的其他數據結構維護轉移，複雜度就會變成 <span>$O(N^{1.5} \log N)$</span><!-- Has MathJax -->，必要時使用塊狀表去作為數據結構進行轉移，當詢問次數 Q 與序列長度 N 呈線性關係，塊狀表支持 <span>$O(1)$</span><!-- Has MathJax --> 修改，<span>$O(N^{0.5})$</span><!-- Has MathJax --> 統計，那複雜度又能壓回 <span>$O(N^{1.5})$</span><!-- Has MathJax -->。</p>
<p>能使用莫隊算法的題目，其中也不少能使用持久化結構來完成，若不考慮空間使用量，持久化結構能支持離線預處理、在線詢問。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">50005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">50005</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Offline</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Event</span> &#123;</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> PILE;</span><br><span class="line">        <span class="keyword">int</span> l, r, qid;</span><br><span class="line">        <span class="built_in">Event</span>(<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>):</span><br><span class="line">            <span class="built_in">l</span>(a), <span class="built_in">r</span>(b), <span class="built_in">qid</span>(c) &#123;&#125;</span><br><span class="line">        <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Event &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (l / PILE != x.l / PILE)</span><br><span class="line">                <span class="keyword">return</span> l &lt; x.l;</span><br><span class="line">            <span class="keyword">return</span> r &lt; x.r; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">int</span> A[MAXN], N, qsize;</span><br><span class="line">    vector&lt;Event&gt; event;</span><br><span class="line">    vector&lt; pair&lt;<span class="keyword">long</span> <span class="keyword">long</span>, <span class="keyword">long</span> <span class="keyword">long</span>&gt; &gt; ret;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;N = N, qsize = <span class="number">0</span>;</span><br><span class="line">        event.<span class="built_in">clear</span>();</span><br><span class="line">        <span class="built_in">memset</span>(B, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(B));</span><br><span class="line">        <span class="keyword">for</span> (Event::PILE = <span class="number">1</span>; Event::PILE * Event::PILE &lt; N; Event::PILE &lt;&lt;= <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">q_add</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        event.<span class="built_in">push_back</span>(<span class="built_in">Event</span>(l, r, qsize));</span><br><span class="line">        qsize++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(event.<span class="built_in">begin</span>(), event.<span class="built_in">end</span>());</span><br><span class="line">        ret.<span class="built_in">resize</span>(event.<span class="built_in">size</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">1</span>, r = <span class="number">0</span>;</span><br><span class="line">        q_stat = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; event.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">while</span> (r &lt; event[i].r)	r++, <span class="built_in">update</span>(A[r], <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">while</span> (r &gt; event[i].r)	<span class="built_in">update</span>(A[r], <span class="number">-1</span>), r--;</span><br><span class="line">            <span class="keyword">while</span> (l &gt; event[i].l)	l--, <span class="built_in">update</span>(A[l], <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">while</span> (l &lt; event[i].l)	<span class="built_in">update</span>(A[l], <span class="number">-1</span>), l++;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> a, b, len = event[i].r - event[i].l + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (len &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                a = q_stat - len;</span><br><span class="line">                b = len * (len - <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                a = <span class="number">0</span>, b = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ret[event[i].qid] = <span class="built_in">make_pair</span>(a, b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> B[MAXV], q_stat;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        B[x] += val;</span><br><span class="line">        q_stat += val * <span class="number">2</span> * B[x] - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; off;</span><br><span class="line"><span class="keyword">int</span> Offline::Event::PILE = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">llgcd</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x, <span class="keyword">long</span> <span class="keyword">long</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> t;</span><br><span class="line">    <span class="keyword">while</span> (x%y)</span><br><span class="line">        t = x, x = y, y = t%y;</span><br><span class="line">    <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N, M, l, r;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;N, &amp;M) == <span class="number">2</span>) &#123;</span><br><span class="line">        off.<span class="built_in">init</span>(N);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;off.A[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; M; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;l, &amp;r);</span><br><span class="line">            off.<span class="built_in">q_add</span>(l, r);</span><br><span class="line">        &#125;</span><br><span class="line">        off.<span class="built_in">run</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; off.ret.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> a = off.ret[i].first;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> b = off.ret[i].second;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> g = <span class="built_in">llgcd</span>(a, b);</span><br><span class="line">            a /= g, b /= g;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld/%lld\n&quot;</span>, a, b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1 1</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">1 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-bzoj-3065" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/22/bzoj-3065/" class="article-date">
  <time datetime="2015-06-22T00:55:28.000Z" itemprop="datePublished">2015-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/22/bzoj-3065/">BZOJ 3065 帶插入區間 K 小值</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/22/bzoj-3065/" data-id="ckpaivc73000pn8vndg6n6qys" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/22/bzoj-3065/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/塊狀鏈表/">塊狀鏈表</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>詢問區間 K 小，額外支持插入一個元素到序列中。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">10 5 8 28 0 19 2 31 1 22 </span><br><span class="line">30</span><br><span class="line">I 6 9</span><br><span class="line">M 1 11</span><br><span class="line">I 8 17</span><br><span class="line">M 1 31</span><br><span class="line">M 6 26</span><br><span class="line">Q 2 7 6</span><br><span class="line">I 23 30</span><br><span class="line">M 31 7</span><br><span class="line">I 22 27</span><br><span class="line">M 26 18</span><br><span class="line">Q 26 17 31</span><br><span class="line">I 5 2</span><br><span class="line">I 18 13</span><br><span class="line">Q 3 3 3</span><br><span class="line">I 27 19</span><br><span class="line">Q 23 23 30</span><br><span class="line">Q 5 13 5</span><br><span class="line">I 3 0</span><br><span class="line">M 15 27</span><br><span class="line">Q 0 28 13</span><br><span class="line">Q 3 29 11</span><br><span class="line">M 2 8</span><br><span class="line">Q 12 5 7</span><br><span class="line">I 30 19</span><br><span class="line">M 11 19</span><br><span class="line">Q 17 8 29</span><br><span class="line">M 29 4</span><br><span class="line">Q 3 0 12</span><br><span class="line">I 7 18</span><br><span class="line">M 29 27</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">28</span><br><span class="line">2</span><br><span class="line">31</span><br><span class="line">0</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">14</span><br><span class="line">27</span><br><span class="line">15</span><br><span class="line">14</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>直接修改可持久化塊狀鏈表的那一題 Zerojudge b411 記憶中的序列 2，把可持久化的記憶體拔掉，這樣就免得記憶體需求過大。出題者是想用替罪羊樹掛另一個平衡樹下去做。應該沒設想到塊狀鏈表在此題的速度也不算差。時限 60 秒大概跑了 30 秒，還不比樹套樹來得慢。</p>
<p>因為有插入操作，不管是主席樹還是函數式線段樹 (這兩個應該是同一個傢伙)，都無法辦到，只能靠可插入的平衡樹。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">65536</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">262144</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnrolledLinkedList</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; A, B;</span><br><span class="line">        Node *next, *alias;</span><br><span class="line">        <span class="built_in">Node</span>() &#123;</span><br><span class="line">            A.<span class="built_in">clear</span>(), B.<span class="built_in">clear</span>(), next = alias = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">Node* <span class="title">real</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (alias)	<span class="keyword">return</span> alias;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (alias) &#123;</span><br><span class="line">                A = alias-&gt;A, B = alias-&gt;B;</span><br><span class="line">                alias = <span class="literal">NULL</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            A.<span class="built_in">insert</span>(A.<span class="built_in">begin</span>() + x, val);</span><br><span class="line">            B.<span class="built_in">resize</span>(A.<span class="built_in">size</span>());</span><br><span class="line">            B[A.<span class="built_in">size</span>()<span class="number">-1</span>] = val;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = (<span class="keyword">int</span>) A.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt; <span class="number">0</span> &amp;&amp; B[i] &lt; B[i<span class="number">-1</span>]; i--)</span><br><span class="line">                <span class="built_in">swap</span>(B[i], B[i<span class="number">-1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> val = A[x];</span><br><span class="line">            A.<span class="built_in">erase</span>(A.<span class="built_in">begin</span>()+x);</span><br><span class="line">            B.<span class="built_in">erase</span>(<span class="built_in">lower_bound</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>(), val));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> t = A[x];</span><br><span class="line">            A[x] = val;</span><br><span class="line">            B.<span class="built_in">erase</span>(<span class="built_in">lower_bound</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>(), t));</span><br><span class="line">            B.<span class="built_in">resize</span>(A.<span class="built_in">size</span>());</span><br><span class="line">            B[A.<span class="built_in">size</span>()<span class="number">-1</span>] = val;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = (<span class="keyword">int</span>) A.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt; <span class="number">0</span> &amp;&amp; B[i] &lt; B[i<span class="number">-1</span>]; i--)</span><br><span class="line">                <span class="built_in">swap</span>(B[i], B[i<span class="number">-1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">relax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            B = A;</span><br><span class="line">            <span class="built_in">sort</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">int</span> PSIZE;</span><br><span class="line">    stack&lt;Node*&gt; mem;</span><br><span class="line">    <span class="function">Node* <span class="title">init</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> n)</span> </span>&#123; <span class="comment">// A[1:n]</span></span><br><span class="line">        <span class="built_in">free</span>();</span><br><span class="line">        PSIZE = <span class="built_in">max</span>((<span class="keyword">int</span>) <span class="built_in">sqrt</span>(n), <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; ; i &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt;= PSIZE) &#123;</span><br><span class="line">                PSIZE = i;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Node *u, *v, *head;</span><br><span class="line">        </span><br><span class="line">        head = <span class="built_in">newNode</span>();</span><br><span class="line">        u = head, v = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (u-&gt;A.<span class="built_in">size</span>() == PSIZE) &#123;</span><br><span class="line">                u-&gt;next = <span class="built_in">newNode</span>();</span><br><span class="line">                v = u, u = u-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            u-&gt;A.<span class="built_in">push_back</span>(A[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (u = head; u != <span class="literal">NULL</span>; u = u-&gt;next)</span><br><span class="line">            u-&gt;<span class="built_in">relax</span>();</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Node* p = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">        mem.<span class="built_in">push</span>(p);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">cloneNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        Node *t = u-&gt;<span class="built_in">real</span>();</span><br><span class="line">        Node *p = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">        *p = *t, p-&gt;next = u-&gt;next, mem.<span class="built_in">push</span>(p);</span><br><span class="line">        <span class="keyword">return</span> p; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">aliasNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        Node *t = u-&gt;<span class="built_in">real</span>();</span><br><span class="line"><span class="comment">//		Node* p = new Node();</span></span><br><span class="line"><span class="comment">//		p-&gt;alias = t, p-&gt;next = u-&gt;next, mem.push(p);</span></span><br><span class="line"><span class="comment">//		return p;</span></span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">erase</span><span class="params">(Node *ver, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        Node *a, *b, *u, *v, *t;</span><br><span class="line">        u = ver, a = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r; u; l = r+<span class="number">1</span>, u = u-&gt;next) &#123;</span><br><span class="line">            r = l + u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (l &lt;= x &amp;&amp; x &lt;= r) &#123;</span><br><span class="line">                t = <span class="built_in">cloneNode</span>(u);</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = t, b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = t, b = b-&gt;next;</span><br><span class="line">                t-&gt;<span class="built_in">erase</span>(x - l);</span><br><span class="line">                t-&gt;next = u-&gt;next;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = <span class="built_in">aliasNode</span>(u), b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = <span class="built_in">aliasNode</span>(u), b = b-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">relaxList</span>(a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">insert</span><span class="params">(Node *ver, <span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        Node *a, *b, *u, *v, *t;</span><br><span class="line">        u = ver, a = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r; u; l = r+<span class="number">1</span>, u = u-&gt;next) &#123;</span><br><span class="line">            r = l + u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (l<span class="number">-1</span> &lt;= x &amp;&amp; x &lt;= r) &#123;</span><br><span class="line">                t = <span class="built_in">cloneNode</span>(u);</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = t, b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = t, b = b-&gt;next;</span><br><span class="line">                t-&gt;<span class="built_in">insert</span>(x - l + <span class="number">1</span>, val);</span><br><span class="line">                t-&gt;next = u-&gt;next;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = <span class="built_in">aliasNode</span>(u), b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = <span class="built_in">aliasNode</span>(u), b = b-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">relaxList</span>(a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">change</span><span class="params">(Node *ver, <span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        Node *a, *b, *u, *v, *t;</span><br><span class="line">        u = ver, a = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r; u; l = r+<span class="number">1</span>, u = u-&gt;next) &#123;</span><br><span class="line">            r = l + u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (l &lt;= x &amp;&amp; x &lt;= r) &#123;</span><br><span class="line">                t = <span class="built_in">cloneNode</span>(u);</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = t, b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = t, b = b-&gt;next;</span><br><span class="line">                t-&gt;<span class="built_in">change</span>(x - l, val);</span><br><span class="line">                t-&gt;next = u-&gt;next;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = <span class="built_in">aliasNode</span>(u), b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = <span class="built_in">aliasNode</span>(u), b = b-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findRank</span><span class="params">(Node *ver, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> val, <span class="keyword">int</span> threshold = INT_MAX)</span> </span>&#123;</span><br><span class="line">        Node *u, *v;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        u = ver;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r; u != <span class="literal">NULL</span>; u = u-&gt;next, l = r+<span class="number">1</span>) &#123;</span><br><span class="line">            r = l + u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">                ret += <span class="built_in">upper_bound</span>(u-&gt;<span class="built_in">real</span>()-&gt;B.<span class="built_in">begin</span>(), u-&gt;<span class="built_in">real</span>()-&gt;B.<span class="built_in">end</span>(), val) - u-&gt;<span class="built_in">real</span>()-&gt;B.<span class="built_in">begin</span>();</span><br><span class="line">                L = r + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((l &lt;= L &amp;&amp; L &lt;= r) || (l &lt;= R &amp;&amp; R &lt;= r)) &#123;</span><br><span class="line">                <span class="keyword">int</span> i = L - l;</span><br><span class="line">                <span class="keyword">while</span> (i &lt; u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &amp;&amp; L &lt;= R) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (u-&gt;<span class="built_in">real</span>()-&gt;A[i] &lt;= val)</span><br><span class="line">                        ret++;</span><br><span class="line">                    i++, L++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ret &gt;= threshold)	<span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(Node *ver, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> k)</span>  </span>&#123;	<span class="comment">// kth-number</span></span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="number">100005</span>, mid, t = <span class="number">0</span>; <span class="comment">// value in A[]</span></span><br><span class="line">        <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">            mid = (l + r)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">findRank</span>(ver, L, R, mid, k) &gt;= k)</span><br><span class="line">                r = mid - <span class="number">1</span>, t = mid;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">mergeNode</span><span class="params">(Node *u, Node *v)</span> </span>&#123;</span><br><span class="line">        Node *p, *q;</span><br><span class="line">        Node *a = <span class="built_in">newNode</span>();</span><br><span class="line">        p = u-&gt;<span class="built_in">real</span>(), q = v-&gt;<span class="built_in">real</span>();</span><br><span class="line">        a-&gt;next = v-&gt;next;</span><br><span class="line">        a-&gt;A.<span class="built_in">insert</span>(a-&gt;A.<span class="built_in">end</span>(), p-&gt;A.<span class="built_in">begin</span>(), p-&gt;A.<span class="built_in">end</span>());</span><br><span class="line">        a-&gt;A.<span class="built_in">insert</span>(a-&gt;A.<span class="built_in">end</span>(), q-&gt;A.<span class="built_in">begin</span>(), q-&gt;A.<span class="built_in">end</span>());</span><br><span class="line">        a-&gt;B.<span class="built_in">resize</span>(a-&gt;A.<span class="built_in">size</span>());</span><br><span class="line">        <span class="built_in">merge</span>(p-&gt;B.<span class="built_in">begin</span>(), p-&gt;B.<span class="built_in">end</span>(), q-&gt;B.<span class="built_in">begin</span>(), q-&gt;B.<span class="built_in">end</span>(), a-&gt;B.<span class="built_in">begin</span>());</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">splitNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        Node *t = u-&gt;<span class="built_in">real</span>();</span><br><span class="line">        Node *a = <span class="built_in">newNode</span>(), *b = <span class="built_in">newNode</span>();</span><br><span class="line">        <span class="keyword">int</span> n = t-&gt;A.<span class="built_in">size</span>()/<span class="number">2</span>;</span><br><span class="line">        a-&gt;next = b, b-&gt;next = u-&gt;next;</span><br><span class="line">        a-&gt;A.<span class="built_in">insert</span>(a-&gt;A.<span class="built_in">begin</span>(), t-&gt;A.<span class="built_in">begin</span>(), t-&gt;A.<span class="built_in">begin</span>()+n);</span><br><span class="line">        b-&gt;A.<span class="built_in">insert</span>(b-&gt;A.<span class="built_in">begin</span>(), t-&gt;A.<span class="built_in">begin</span>()+n, t-&gt;A.<span class="built_in">end</span>());</span><br><span class="line">        a-&gt;<span class="built_in">relax</span>(), b-&gt;<span class="built_in">relax</span>();</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">relaxList</span><span class="params">(Node *ver)</span> </span>&#123;</span><br><span class="line">        Node *a, *b, *u, *v, *t;</span><br><span class="line">        <span class="keyword">int</span> need = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (u = ver, a = <span class="literal">NULL</span>; !need &amp;&amp; u != <span class="literal">NULL</span>; u = u-&gt;next) &#123;</span><br><span class="line">            <span class="keyword">if</span> (u-&gt;next != <span class="literal">NULL</span> &amp;&amp; u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() + u-&gt;next-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &lt; (PSIZE&lt;&lt;<span class="number">1</span>)) <span class="comment">// merge</span></span><br><span class="line">            	need = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &gt; (PSIZE&lt;&lt;<span class="number">1</span>))	<span class="comment">// split</span></span><br><span class="line">            	need = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!need)</span><br><span class="line">        	<span class="keyword">return</span> ver;</span><br><span class="line">        stack&lt;Node*&gt; remove;	<span class="comment">// static used </span></span><br><span class="line">        <span class="keyword">for</span> (u = ver, a = <span class="literal">NULL</span>; u != <span class="literal">NULL</span>; u = u-&gt;next) &#123;</span><br><span class="line">            <span class="keyword">if</span> (u-&gt;next != <span class="literal">NULL</span> &amp;&amp; u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() + u-&gt;next-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &lt; (PSIZE&lt;&lt;<span class="number">1</span>)) &#123;	<span class="comment">// merge</span></span><br><span class="line">            	<span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">            		a = <span class="built_in">mergeNode</span>(u, u-&gt;next), b = a;</span><br><span class="line">            	<span class="keyword">else</span></span><br><span class="line">            		b-&gt;next = <span class="built_in">mergeNode</span>(u, u-&gt;next), b = b-&gt;next;</span><br><span class="line">            	remove.<span class="built_in">push</span>(u), remove.<span class="built_in">push</span>(u-&gt;next); <span class="comment">// static used  </span></span><br><span class="line">                u = u-&gt;next;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &gt; (PSIZE&lt;&lt;<span class="number">1</span>)) &#123;	<span class="comment">// split</span></span><br><span class="line">            	<span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">            		a = <span class="built_in">splitNode</span>(u), b = a-&gt;next;</span><br><span class="line">            	<span class="keyword">else</span></span><br><span class="line">            		b-&gt;next = <span class="built_in">splitNode</span>(u), b = b-&gt;next-&gt;next;</span><br><span class="line">            	remove.<span class="built_in">push</span>(u); <span class="comment">// static used  </span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            	<span class="keyword">if</span> (a == <span class="literal">NULL</span>)	</span><br><span class="line">                    a = <span class="built_in">aliasNode</span>(u), b = a;</span><br><span class="line">            	<span class="keyword">else</span>			</span><br><span class="line">                    b-&gt;next = <span class="built_in">aliasNode</span>(u), b = b-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (!remove.<span class="built_in">empty</span>()) &#123; <span class="comment">// static used  </span></span><br><span class="line">        	u = remove.<span class="built_in">top</span>(), remove.<span class="built_in">pop</span>();</span><br><span class="line">        	<span class="keyword">delete</span> u;</span><br><span class="line">        &#125;	    	</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(Node *head)</span> </span>&#123;</span><br><span class="line">        Node *u = head;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[&quot;</span>);</span><br><span class="line">    	<span class="keyword">while</span> (u != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>(); i++)</span><br><span class="line">            	<span class="built_in">printf</span>(<span class="string">&quot;%d%s&quot;</span>, u-&gt;<span class="built_in">real</span>()-&gt;A[i], i != u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>()<span class="number">-1</span> ? <span class="string">&quot; &quot;</span> : <span class="string">&quot; &quot;</span>);</span><br><span class="line">        	u = u-&gt;next;</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="built_in">puts</span>(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">free</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">while</span> (!mem.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            Node *u = mem.<span class="built_in">top</span>();</span><br><span class="line">            mem.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">delete</span> u;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; dream; </span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> A[MAXN], n, q;</span><br><span class="line">UnrolledLinkedList::Node *ver[MAXQ];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x, y, v;</span><br><span class="line">    <span class="keyword">char</span> cmd[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;A[i]);</span><br><span class="line">        ver[<span class="number">0</span>] = dream.<span class="built_in">init</span>(A, n);</span><br><span class="line"><span class="comment">//		dream.debug(ver[0]);</span></span><br><span class="line">        <span class="keyword">int</span> encrypt = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;q);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, cmd);</span><br><span class="line">            <span class="keyword">if</span> (cmd[<span class="number">0</span>] == <span class="string">&#x27;I&#x27;</span>) &#123;</span><br><span class="line">                <span class="comment">// insert A[x] = v</span></span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;v);</span><br><span class="line">                x ^= encrypt, v ^= encrypt;</span><br><span class="line">                ver[i] = dream.<span class="built_in">insert</span>(ver[i<span class="number">-1</span>], x<span class="number">-1</span>, v);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd[<span class="number">0</span>] == <span class="string">&#x27;Q&#x27;</span>) &#123;</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;x, &amp;y, &amp;v);</span><br><span class="line">                x ^= encrypt, y ^= encrypt, v ^= encrypt;</span><br><span class="line">                <span class="keyword">int</span> t = dream.<span class="built_in">find</span>(ver[i<span class="number">-1</span>], x, y, v);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, t);</span><br><span class="line">                encrypt = t;</span><br><span class="line">                ver[i] = ver[i<span class="number">-1</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd[<span class="number">0</span>] == <span class="string">&#x27;M&#x27;</span>) &#123;</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;v);</span><br><span class="line">                x ^= encrypt, v ^= encrypt;</span><br><span class="line">                ver[i] = dream.<span class="built_in">change</span>(ver[i<span class="number">-1</span>], x, v);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//			dream.debug(ver[i]);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">1 2 3 4 5</span></span><br><span class="line"><span class="comment">9999</span></span><br><span class="line"><span class="comment">4 1 5 2</span></span><br><span class="line"><span class="comment">1 2 1</span></span><br><span class="line"><span class="comment">4 1 5 2</span></span><br><span class="line"><span class="comment">0 1</span></span><br><span class="line"><span class="comment">4 1 5 2</span></span><br><span class="line"><span class="comment">2 1</span></span><br><span class="line"><span class="comment">1 0 5</span></span><br><span class="line"><span class="comment">3 3 9</span></span><br><span class="line"><span class="comment">4 1 1 1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-zj-b412" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/22/zj-b412/" class="article-date">
  <time datetime="2015-06-22T00:38:41.000Z" itemprop="datePublished">2015-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/22/zj-b412/">b412. 記憶中的并查集</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/22/zj-b412/" data-id="ckpaivca000aln8vn7acm5saj" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/22/zj-b412/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/可持久化/">可持久化</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/并查集/">并查集</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>維護一個並查集的操作，並且支持版本回溯。</p>
<ul>
<li>合併兩個堆</li>
<li>詢問兩個元素是否同堆</li>
<li>版本回溯</li>
</ul>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2 5</span><br><span class="line">2 1 2</span><br><span class="line">1 1 2</span><br><span class="line">2 1 2</span><br><span class="line">1 1</span><br><span class="line">3 0 3</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>持久化概念，相當於維護 <code>parent[]</code> 陣列的版本，這一點可以利用可持久化線段樹來維護。</p>
<p>並查集的查詢功能不修改 <code>parent[]</code> 陣列，合併操作卻有可能修改數個 <code>parent[]</code>，為了降低記憶體用量，盡可能少用路徑壓縮這個技巧，雖然在一般並查集都會使用這個來加速，否則很容易變很慢，是因為持久化是會拉低速度，因為持久化需要 <span>$O(\log N)$</span><!-- Has MathJax --> 的時間去更改 <code>parent[]</code>，單筆路徑壓縮長度為 <span>$M$</span><!-- Has MathJax --> 個點，需要 <span>$O(M \log N)$</span><!-- Has MathJax --> 的調整，<span>$M$</span><!-- Has MathJax --> 在並查集中是常數類。</p>
<p>詢問不多時用啟發式合併就好，將小堆的元素合併到大堆中。效能會比較好。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">3000000</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SegementTree</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        Node *lson, *rson;</span><br><span class="line">        pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; val;</span><br><span class="line">    &#125; nodes[MAXN];</span><br><span class="line">    <span class="keyword">int</span> nodesize, L, R;</span><br><span class="line">    <span class="function">Node* <span class="title">init</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        nodesize = <span class="number">0</span>;</span><br><span class="line">        L = l, R = r;</span><br><span class="line">        Node* root = <span class="built_in">build</span>(l, r);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nodesize &gt;= MAXN)</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> &amp;nodes[nodesize++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">cloneNode</span><span class="params">(Node *p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nodesize &gt;= MAXN)</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        Node* u = &amp;nodes[nodesize++];</span><br><span class="line">        *u = *p;</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">build</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l &gt; r)  <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        Node *u = <span class="built_in">newNode</span>();</span><br><span class="line">        u-&gt;lson = u-&gt;rson = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">            u-&gt;val = <span class="built_in">make_pair</span>(l, <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> m = (l + r)/<span class="number">2</span>;</span><br><span class="line">        	u-&gt;lson = <span class="built_in">build</span>(l, m);</span><br><span class="line">        	u-&gt;rson = <span class="built_in">build</span>(m+<span class="number">1</span>, r);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">change</span><span class="params">(Node *p, <span class="keyword">int</span> x, pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; val, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        Node *u = <span class="built_in">cloneNode</span>(p);</span><br><span class="line">        <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        	u-&gt;val = val;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        	<span class="keyword">int</span> mid = (l + r)/<span class="number">2</span>;</span><br><span class="line">        	<span class="keyword">if</span> (x &lt;= mid)</span><br><span class="line">            	u-&gt;lson = <span class="built_in">change</span>(p-&gt;lson, x, val, l, mid);</span><br><span class="line">        	<span class="keyword">else</span></span><br><span class="line">         		u-&gt;rson = <span class="built_in">change</span>(p-&gt;rson, x, val, mid+<span class="number">1</span>, r);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">change</span><span class="params">(Node *p, <span class="keyword">int</span> x, pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">change</span>(p, x, val, L, R);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">find</span><span class="params">(Node *ver, <span class="keyword">int</span> x, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">        	<span class="keyword">return</span> ver-&gt;val;</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= mid)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">find</span>(ver-&gt;lson, x, l, mid);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">find</span>(ver-&gt;rson, x, mid+<span class="number">1</span>, r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">find</span><span class="params">(Node *ver, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">find</span>(ver, x, L, R);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// disjoint set</span></span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">findp</span><span class="params">(Node *ver, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; p = <span class="built_in">find</span>(ver, x);</span><br><span class="line">        <span class="keyword">return</span> x == p.first ? p : <span class="built_in">findp</span>(ver, p.first);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">joint</span><span class="params">(Node *ver, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; a = <span class="built_in">findp</span>(ver, x);</span><br><span class="line">        pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; b = <span class="built_in">findp</span>(ver, y);</span><br><span class="line">        <span class="keyword">if</span> (a.first == b.first)</span><br><span class="line">            <span class="keyword">return</span> ver;</span><br><span class="line">        Node *u = ver;</span><br><span class="line">        <span class="keyword">if</span> (a.second &gt; b.second) &#123;</span><br><span class="line">            u = <span class="built_in">change</span>(u, b.first, <span class="built_in">make_pair</span>(a.first, b.second));</span><br><span class="line">            u = <span class="built_in">change</span>(u, a.first, <span class="built_in">make_pair</span>(a.first, a.second + b.second));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            u = <span class="built_in">change</span>(u, a.first, <span class="built_in">make_pair</span>(b.first, a.second));</span><br><span class="line">            u = <span class="built_in">change</span>(u, b.first, <span class="built_in">make_pair</span>(b.first, a.second + b.second));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; segTree;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">262144</span>;</span><br><span class="line">SegementTree::Node *ver[MAXQ];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m;</span><br><span class="line">    <span class="keyword">int</span> cmd, x, y, v;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m) == <span class="number">2</span>) &#123;</span><br><span class="line">        ver[<span class="number">0</span>] = segTree.<span class="built_in">init</span>(<span class="number">1</span>, n);</span><br><span class="line">        <span class="keyword">int</span> encrypt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;cmd);</span><br><span class="line">            cmd ^= encrypt;</span><br><span class="line">            <span class="keyword">if</span> (cmd == <span class="number">0</span>) &#123; 		<span class="comment">// back</span></span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;v);</span><br><span class="line">                v ^= encrypt;</span><br><span class="line">                ver[i] = ver[v];</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">1</span>) &#123;	<span class="comment">// joint</span></span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;y);</span><br><span class="line">                x ^= encrypt, y ^= encrypt; </span><br><span class="line">                ver[i] = segTree.<span class="built_in">joint</span>(ver[i<span class="number">-1</span>], x, y);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">2</span>) &#123;	<span class="comment">// find</span></span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;y);</span><br><span class="line">                x ^= encrypt, y ^= encrypt;</span><br><span class="line">                pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; a = segTree.<span class="built_in">findp</span>(ver[i<span class="number">-1</span>], x);</span><br><span class="line">                pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; b = segTree.<span class="built_in">findp</span>(ver[i<span class="number">-1</span>], y);</span><br><span class="line">                <span class="keyword">int</span> t = a.first == b.first;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, t);</span><br><span class="line">                ver[i] = ver[i<span class="number">-1</span>];</span><br><span class="line">                encrypt = t;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;WTF&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-zj-b411" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/22/zj-b411/" class="article-date">
  <time datetime="2015-06-22T00:28:54.000Z" itemprop="datePublished">2015-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/22/zj-b411/">b411. 記憶中的序列 2</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/22/zj-b411/" data-id="ckpaivca000akn8vn28b5akin" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/22/zj-b411/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/可持久化/">可持久化</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/塊狀鏈表/">塊狀鏈表</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>動態區間 K 小，有四種操作</p>
<ul>
<li>插入元素</li>
<li>刪除元素</li>
<li>修改元素</li>
<li>版本回溯</li>
<li>詢問某個區間的第 K 小元素</li>
</ul>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">1 2 3 4 5</span><br><span class="line">5</span><br><span class="line">4 1 5 2</span><br><span class="line">3 0 3</span><br><span class="line">6 3 7 0</span><br><span class="line">1 0</span><br><span class="line">5 0 4 3</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>每次操作最多增加 <span>$O(\sqrt{n})$</span><!-- Has MathJax --> 記憶體，需要針對節點作抽象化，修改節點時再進行實體化，如此一來不用針對搜索路徑上的每一節點都進行複製，一般持久化平衡樹進行時，會直接複製整個節點，但塊狀鏈表若是複製下去會退化成時間、空間都是 <span>$O(n)$</span><!-- Has MathJax --> 的情況。</p>
<p>詢問時仍然需要二分搜索答案，看答案是否符合 K 小元素，也就是說要得到某個元素在區間中的排名。</p>
<p>塊狀鏈表代碼很醜，看看就好。如果需要支持修改、增加元素的區間 K 小，雖然複雜度高，但常數小、記憶體快取優勢，速度不比二元樹類型的資料結構來得慢，不管需不需要持久化塊狀鏈表都是這類型不錯的選擇。</p>
<h3 id="另解"><a href="#另解" class="headerlink" title="另解"></a>另解</h3><p>假設詢問為 <span>$Q$</span><!-- Has MathJax --> 個，聽說可以用區間 <span>$[1, 2NQ]$</span><!-- Has MathJax --> 的線段樹之類的超大區間線段樹，必要的探訪時進行開花 (將子節點打開)，利用標記計算相對位置來進行查詢。相對位置計算大概會在邊緣情況崩潰。</p>
<p>至於柳柳州提到的替罪羊樹是樹套樹下去持久化，每一個節點表示一個區間，接著在節點中建造一個平衡樹來查找區間 K 小元素。這樣的做法一樣需要二分搜索答案。但塊狀鏈表在速度跟記憶體都贏了，因為樹套樹的常數比較大，增加的記憶體也多。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">32767</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">131072</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnrolledLinkedList</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; A, B;</span><br><span class="line">        Node *next, *alias;</span><br><span class="line">        <span class="built_in">Node</span>() &#123;</span><br><span class="line">            A.<span class="built_in">clear</span>(), B.<span class="built_in">clear</span>(), next = alias = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">Node* <span class="title">real</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (alias)	<span class="keyword">return</span> alias;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (alias) &#123;</span><br><span class="line">                A = alias-&gt;A, B = alias-&gt;B;</span><br><span class="line">                alias = <span class="literal">NULL</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            A.<span class="built_in">insert</span>(A.<span class="built_in">begin</span>() + x, val);</span><br><span class="line">            B.<span class="built_in">resize</span>(A.<span class="built_in">size</span>());</span><br><span class="line">            B[A.<span class="built_in">size</span>()<span class="number">-1</span>] = val;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = (<span class="keyword">int</span>) A.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt; <span class="number">0</span> &amp;&amp; B[i] &lt; B[i<span class="number">-1</span>]; i--)</span><br><span class="line">                <span class="built_in">swap</span>(B[i], B[i<span class="number">-1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> val = A[x];</span><br><span class="line">            A.<span class="built_in">erase</span>(A.<span class="built_in">begin</span>()+x);</span><br><span class="line">            B.<span class="built_in">erase</span>(<span class="built_in">lower_bound</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>(), val));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> t = A[x];</span><br><span class="line">            A[x] = val;</span><br><span class="line">            B.<span class="built_in">erase</span>(<span class="built_in">lower_bound</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>(), t));</span><br><span class="line">            B.<span class="built_in">resize</span>(A.<span class="built_in">size</span>());</span><br><span class="line">            B[A.<span class="built_in">size</span>()<span class="number">-1</span>] = val;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = (<span class="keyword">int</span>) A.<span class="built_in">size</span>()<span class="number">-1</span>; i &gt; <span class="number">0</span> &amp;&amp; B[i] &lt; B[i<span class="number">-1</span>]; i--)</span><br><span class="line">                <span class="built_in">swap</span>(B[i], B[i<span class="number">-1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">relax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            B = A;</span><br><span class="line">            <span class="built_in">sort</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">int</span> PSIZE;</span><br><span class="line">    stack&lt;Node*&gt; mem;</span><br><span class="line">    <span class="function">Node* <span class="title">init</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> n)</span> </span>&#123; <span class="comment">// A[1:n]</span></span><br><span class="line">        <span class="built_in">free</span>();</span><br><span class="line">        PSIZE = <span class="built_in">max</span>((<span class="keyword">int</span>) <span class="built_in">sqrt</span>(n), <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; ; i &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt;= PSIZE) &#123;</span><br><span class="line">                PSIZE = i;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Node *u, *v, *head;</span><br><span class="line">        </span><br><span class="line">        head = <span class="built_in">newNode</span>();</span><br><span class="line">        u = head, v = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (u-&gt;A.<span class="built_in">size</span>() == PSIZE) &#123;</span><br><span class="line">                u-&gt;next = <span class="built_in">newNode</span>();</span><br><span class="line">                v = u, u = u-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            u-&gt;A.<span class="built_in">push_back</span>(A[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (u = head; u != <span class="literal">NULL</span>; u = u-&gt;next)</span><br><span class="line">            u-&gt;<span class="built_in">relax</span>();</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">newNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Node* p = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">        mem.<span class="built_in">push</span>(p);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">cloneNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        Node *t = u-&gt;<span class="built_in">real</span>();</span><br><span class="line">        Node *p = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">        *p = *t, p-&gt;next = u-&gt;next, mem.<span class="built_in">push</span>(p);</span><br><span class="line">        <span class="keyword">return</span> p; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">aliasNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        Node *t = u-&gt;<span class="built_in">real</span>();</span><br><span class="line">        Node* p = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">        p-&gt;alias = t, p-&gt;next = u-&gt;next, mem.<span class="built_in">push</span>(p);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">erase</span><span class="params">(Node *ver, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        Node *a, *b, *u, *v, *t;</span><br><span class="line">        u = ver, a = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r; u; l = r+<span class="number">1</span>, u = u-&gt;next) &#123;</span><br><span class="line">            r = l + u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (l &lt;= x &amp;&amp; x &lt;= r) &#123;</span><br><span class="line">                t = <span class="built_in">cloneNode</span>(u);</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = t, b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = t, b = b-&gt;next;</span><br><span class="line">                t-&gt;<span class="built_in">erase</span>(x - l);</span><br><span class="line">                t-&gt;next = u-&gt;next;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = <span class="built_in">aliasNode</span>(u), b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = <span class="built_in">aliasNode</span>(u), b = b-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">relaxList</span>(a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">insert</span><span class="params">(Node *ver, <span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        Node *a, *b, *u, *v, *t;</span><br><span class="line">        u = ver, a = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r; u; l = r+<span class="number">1</span>, u = u-&gt;next) &#123;</span><br><span class="line">            r = l + u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (l<span class="number">-1</span> &lt;= x &amp;&amp; x &lt;= r) &#123;</span><br><span class="line">                t = <span class="built_in">cloneNode</span>(u);</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = t, b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = t, b = b-&gt;next;</span><br><span class="line">                t-&gt;<span class="built_in">insert</span>(x - l + <span class="number">1</span>, val);</span><br><span class="line">                t-&gt;next = u-&gt;next;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = <span class="built_in">aliasNode</span>(u), b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = <span class="built_in">aliasNode</span>(u), b = b-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">relaxList</span>(a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">change</span><span class="params">(Node *ver, <span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        Node *a, *b, *u, *v, *t;</span><br><span class="line">        u = ver, a = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r; u; l = r+<span class="number">1</span>, u = u-&gt;next) &#123;</span><br><span class="line">            r = l + u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (l &lt;= x &amp;&amp; x &lt;= r) &#123;</span><br><span class="line">                t = <span class="built_in">cloneNode</span>(u);</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = t, b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = t, b = b-&gt;next;</span><br><span class="line">                t-&gt;<span class="built_in">change</span>(x - l, val);</span><br><span class="line">                t-&gt;next = u-&gt;next;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">                    a = <span class="built_in">aliasNode</span>(u), b = a;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b-&gt;next = <span class="built_in">aliasNode</span>(u), b = b-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findRank</span><span class="params">(Node *ver, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> val, <span class="keyword">int</span> threshold = INT_MAX)</span> </span>&#123;</span><br><span class="line">        Node *u, *v;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        u = ver;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r; u != <span class="literal">NULL</span>; u = u-&gt;next, l = r+<span class="number">1</span>) &#123;</span><br><span class="line">            r = l + u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">                ret += <span class="built_in">upper_bound</span>(u-&gt;<span class="built_in">real</span>()-&gt;B.<span class="built_in">begin</span>(), u-&gt;<span class="built_in">real</span>()-&gt;B.<span class="built_in">end</span>(), val) - u-&gt;<span class="built_in">real</span>()-&gt;B.<span class="built_in">begin</span>();</span><br><span class="line">                L = r + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((l &lt;= L &amp;&amp; L &lt;= r) || (l &lt;= R &amp;&amp; R &lt;= r)) &#123;</span><br><span class="line">                <span class="keyword">int</span> i = L - l;</span><br><span class="line">                <span class="keyword">while</span> (i &lt; u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &amp;&amp; L &lt;= R) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (u-&gt;<span class="built_in">real</span>()-&gt;A[i] &lt;= val)</span><br><span class="line">                        ret++;</span><br><span class="line">                    i++, L++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ret &gt;= threshold)	<span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(Node *ver, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> k)</span>  </span>&#123;	<span class="comment">// kth-number</span></span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="number">100000</span>, mid, t = <span class="number">0</span>; <span class="comment">// value in A[]</span></span><br><span class="line">        <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">            mid = (l + r)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">findRank</span>(ver, L, R, mid, k) &gt;= k)</span><br><span class="line">                r = mid - <span class="number">1</span>, t = mid;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">mergeNode</span><span class="params">(Node *u, Node *v)</span> </span>&#123;</span><br><span class="line">        Node *p, *q;</span><br><span class="line">        Node *a = <span class="built_in">newNode</span>();</span><br><span class="line">        p = u-&gt;<span class="built_in">real</span>(), q = v-&gt;<span class="built_in">real</span>();</span><br><span class="line">        a-&gt;next = v-&gt;next;</span><br><span class="line">        a-&gt;A.<span class="built_in">insert</span>(a-&gt;A.<span class="built_in">end</span>(), p-&gt;A.<span class="built_in">begin</span>(), p-&gt;A.<span class="built_in">end</span>());</span><br><span class="line">        a-&gt;A.<span class="built_in">insert</span>(a-&gt;A.<span class="built_in">end</span>(), q-&gt;A.<span class="built_in">begin</span>(), q-&gt;A.<span class="built_in">end</span>());</span><br><span class="line">        a-&gt;B.<span class="built_in">resize</span>(a-&gt;A.<span class="built_in">size</span>());</span><br><span class="line">        <span class="built_in">merge</span>(p-&gt;B.<span class="built_in">begin</span>(), p-&gt;B.<span class="built_in">end</span>(), q-&gt;B.<span class="built_in">begin</span>(), q-&gt;B.<span class="built_in">end</span>(), a-&gt;B.<span class="built_in">begin</span>());</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">splitNode</span><span class="params">(Node *u)</span> </span>&#123;</span><br><span class="line">        Node *t = u-&gt;<span class="built_in">real</span>();</span><br><span class="line">        Node *a = <span class="built_in">newNode</span>(), *b = <span class="built_in">newNode</span>();</span><br><span class="line">        <span class="keyword">int</span> n = t-&gt;A.<span class="built_in">size</span>()/<span class="number">2</span>;</span><br><span class="line">        a-&gt;next = b, b-&gt;next = u-&gt;next;</span><br><span class="line">        a-&gt;A.<span class="built_in">insert</span>(a-&gt;A.<span class="built_in">begin</span>(), t-&gt;A.<span class="built_in">begin</span>(), t-&gt;A.<span class="built_in">begin</span>()+n);</span><br><span class="line">        b-&gt;A.<span class="built_in">insert</span>(b-&gt;A.<span class="built_in">begin</span>(), t-&gt;A.<span class="built_in">begin</span>()+n, t-&gt;A.<span class="built_in">end</span>());</span><br><span class="line">        a-&gt;<span class="built_in">relax</span>(), b-&gt;<span class="built_in">relax</span>();</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Node* <span class="title">relaxList</span><span class="params">(Node *ver)</span> </span>&#123;</span><br><span class="line">        Node *a, *b, *u, *v, *t;</span><br><span class="line">        <span class="keyword">int</span> need = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (u = ver, a = <span class="literal">NULL</span>; !need &amp;&amp; u != <span class="literal">NULL</span>; u = u-&gt;next) &#123;</span><br><span class="line">            <span class="keyword">if</span> (u-&gt;next != <span class="literal">NULL</span> &amp;&amp; u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() + u-&gt;next-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &lt; (PSIZE&lt;&lt;<span class="number">1</span>)) <span class="comment">// merge</span></span><br><span class="line">            	need = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &gt; (PSIZE&lt;&lt;<span class="number">1</span>))	<span class="comment">// split</span></span><br><span class="line">            	need = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!need)</span><br><span class="line">        	<span class="keyword">return</span> ver;</span><br><span class="line">        	</span><br><span class="line">        <span class="keyword">for</span> (u = ver, a = <span class="literal">NULL</span>; u != <span class="literal">NULL</span>; u = u-&gt;next) &#123;</span><br><span class="line">            <span class="keyword">if</span> (u-&gt;next != <span class="literal">NULL</span> &amp;&amp; u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() + u-&gt;next-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &lt; (PSIZE&lt;&lt;<span class="number">1</span>)) &#123;	<span class="comment">// merge</span></span><br><span class="line">            	<span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">            		a = <span class="built_in">mergeNode</span>(u, u-&gt;next), b = a;</span><br><span class="line">            	<span class="keyword">else</span></span><br><span class="line">            		b-&gt;next = <span class="built_in">mergeNode</span>(u, u-&gt;next), b = b-&gt;next;</span><br><span class="line">                u = u-&gt;next;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>() &gt; (PSIZE&lt;&lt;<span class="number">1</span>)) &#123;	<span class="comment">// split</span></span><br><span class="line">            	<span class="keyword">if</span> (a == <span class="literal">NULL</span>)</span><br><span class="line">            		a = <span class="built_in">splitNode</span>(u), b = a-&gt;next;</span><br><span class="line">            	<span class="keyword">else</span></span><br><span class="line">            		b-&gt;next = <span class="built_in">splitNode</span>(u), b = b-&gt;next-&gt;next;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            	<span class="keyword">if</span> (a == <span class="literal">NULL</span>)	</span><br><span class="line">                    a = <span class="built_in">aliasNode</span>(u), b = a;</span><br><span class="line">            	<span class="keyword">else</span>			</span><br><span class="line">                    b-&gt;next = <span class="built_in">aliasNode</span>(u), b = b-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(Node *head)</span> </span>&#123;</span><br><span class="line">        Node *u = head;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[&quot;</span>);</span><br><span class="line">    	<span class="keyword">while</span> (u != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>(); i++)</span><br><span class="line">            	<span class="built_in">printf</span>(<span class="string">&quot;%d%s&quot;</span>, u-&gt;<span class="built_in">real</span>()-&gt;A[i], i != u-&gt;<span class="built_in">real</span>()-&gt;A.<span class="built_in">size</span>()<span class="number">-1</span> ? <span class="string">&quot; &quot;</span> : <span class="string">&quot; &quot;</span>);</span><br><span class="line">        	u = u-&gt;next;</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="built_in">puts</span>(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">free</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (!mem.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            Node *u = mem.<span class="built_in">top</span>();</span><br><span class="line">            mem.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">delete</span> u;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; dream; </span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> A[MAXN], n, q;</span><br><span class="line">UnrolledLinkedList::Node *ver[MAXQ];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x, y, v, cmd;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;A[i]);</span><br><span class="line">        ver[<span class="number">0</span>] = dream.<span class="built_in">init</span>(A, n);</span><br><span class="line"><span class="comment">//		dream.debug(ver[0]);</span></span><br><span class="line">        <span class="keyword">int</span> encrypt = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;q);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;cmd);</span><br><span class="line">            cmd ^= encrypt;</span><br><span class="line">            <span class="keyword">if</span> (cmd == <span class="number">0</span>) &#123;			<span class="comment">// back version v</span></span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;v);</span><br><span class="line">                v ^= encrypt;</span><br><span class="line">                ver[i] = ver[v];</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">1</span>) &#123; 	<span class="comment">// insert A[x] = v</span></span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;v);</span><br><span class="line">                x ^= encrypt, v ^= encrypt;</span><br><span class="line">                ver[i] = dream.<span class="built_in">insert</span>(ver[i<span class="number">-1</span>], x, v);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">2</span>) &#123;	<span class="comment">// delete A[x]</span></span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">                x ^= encrypt;</span><br><span class="line">                ver[i] = dream.<span class="built_in">erase</span>(ver[i<span class="number">-1</span>], x);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">3</span>) &#123;	<span class="comment">// make A[x] = v</span></span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;v);</span><br><span class="line">                x ^= encrypt, v ^= encrypt;</span><br><span class="line">                ver[i] = dream.<span class="built_in">change</span>(ver[i<span class="number">-1</span>], x, v);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmd == <span class="number">4</span>) &#123;</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;x, &amp;y, &amp;v);</span><br><span class="line">                x ^= encrypt, y ^= encrypt, v ^= encrypt;</span><br><span class="line">                <span class="keyword">int</span> t = dream.<span class="built_in">find</span>(ver[i<span class="number">-1</span>], x, y, v);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, t);</span><br><span class="line">                encrypt = t;</span><br><span class="line">                ver[i] = ver[i<span class="number">-1</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;WTF&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//			dream.debug(ver[i]);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-security-notes6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/19/security-notes6/" class="article-date">
  <time datetime="2015-06-19T07:20:52.000Z" itemprop="datePublished">2015-06-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>/<a class="article-category-link" href="/categories/學校課程/資訊安全/">資訊安全</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/19/security-notes6/">近代加密 複習 續</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/19/security-notes6/" data-id="ckpaivc87004gn8vngu2xefxn" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/19/security-notes6/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/密碼學/">密碼學</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>幾乎是密碼學基礎數論，看來也走到這了。</p>
<h2 id="亂來"><a href="#亂來" class="headerlink" title="亂來"></a>亂來</h2><p>隨便寫寫，上課不專心真是抱歉。</p>
<ol>
<li><p>Given an integer <span>$x$</span><!-- Has MathJax -->, what is the requirement to let the multiplcative inverse <span>$x^{-1}$</span><!-- Has MathJax --> exist when modulo <span>$p$</span><!-- Has MathJax -->?  if <span>$x^{-1} \mod p$</span><!-- Has MathJax --> exists, please write down the equation (based on Fermat’s theorem) used to compute <span>$x^{-1} \mod p$</span><!-- Has MathJax -->. (5%)</p>
<ol>
<li>condition: <span>$gcd(x, p) = 1$</span><!-- Has MathJax --> for multiplcative inverse <span>$x^{-1}$</span><!-- Has MathJax --> exist when modulo <span>$p$</span><!-- Has MathJax --></li>
<li>Fermat’s theorem :   <span>$x^{p-1} = 1 \mod p \Rightarrow x^{p-2} \times x = 1 \mod p$</span><!-- Has MathJax -->
<span>$x^{-1} = x^{p-2} \mod p$</span><!-- Has MathJax --></li>
</ol>
</li>
<li><p>What is the Euler totient function <span>$\phi(n)$</span><!-- Has MathJax -->? Please answer <span>$\phi(77) = ?$</span><!-- Has MathJax --></p>
 <span>$\phi(n)$</span><!-- Has MathJax --> 表示 1 到 n 之內的整數，有多少與 n 互質的個數。
 <span>$\phi(77) = 77 \times (1 - 1 / 7) \times (1 - 1 / 11) = 60$</span><!-- Has MathJax --></li>
<li><p>Whais the discrete logarithm problem?   (5%)<br> 對於等式 <span>$y = x^a \mod p$</span><!-- Has MathJax -->，已知三整數 y, x, p，解出 a 的問題。詳見小步大步算法 baby-step-giant-step，複雜度 <span>$O(\sqrt p)$</span><!-- Has MathJax --></p>
</li>
<li><p>What is a hybrid cryptography?   (5%)<br>$<span>$\text{hybrid cryptosystem } = \text{ public-key cryptosystem } + \text{ symmetric-key cryptosystem}$</span><!-- Has MathJax -->$  </p>
</li>
</ol>
<ul>
<li>public-key cryptosystem<br>提供 key encapsulation，就是 key 的安全性和簽章認證，保護 key 傳輸、保管上的問題。</li>
<li>symmetric-key cryptosystem<br>提供 data encapsulation，提供高效率的加解密效能。</li>
</ul>
<ol start="5">
<li>What are the two primary reasons of using a cryptographic hash before signing a signature?   (5%)<br>cryptographic hash 密碼雜湊函數，通常會計算 <span>$hash(M)$</span><!-- Has MathJax --></li>
</ol>
<ul>
<li>單向不可逆<br>難以給定一個雜湊值，並且逆推得到當初輸入的數值。<ul>
<li>提供訊息修改檢查，相同的訊息進行雜湊，高機率會是不同。<span>$hash(M1) \neq hash(M2)$</span><!-- Has MathJax -->，如果 M1 和 M2 差異只有數個 bits 不同。</li>
<li>防止在傳輸過程中被竄改。對於簽章則更難竄改成相同雜湊值且具有 ** 意義 ** 的訊息 <span>$M&apos;$</span><!-- Has MathJax -->。</li>
</ul>
</li>
<li>容易計算<br>將一個長度很大的訊息，壓縮一個固定長度的數值，這數值方便後續算法計算用加密算法的部分。</li>
</ul>
<ol start="6">
<li><p>Please write down the RSA public key encryption and decryption process (including public key and private key generation process).   (10%)</p>
<ol>
<li><span>$N = p \times q$</span><!-- Has MathJax --></li>
<li><span>$\phi(N) = (p-1)(q-1)$</span><!-- Has MathJax --></li>
<li><span>$gcd(\phi(N), e) = 1, \phi(N) &gt; e &gt; 1$</span><!-- Has MathJax --></li>
<li><span>$d = e^{-1}, e \times d = 1 \mod &oslash;(N)$</span><!-- Has MathJax --></li>
<li>public <span>$e, N$</span><!-- Has MathJax --></li>
<li>private <span>$p, q, d$</span><!-- Has MathJax --></li>
</ol>
</li>
<li><p>Please develop a left-to-right binary exponentiation algorithm without “conditional jump” which is usually dangerous to some engineering attack. (10%)<br>Montgomery Ladder  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">R[0] = 1, R[1] = p</span><br><span class="line">for i = n-1 to 0, step = -1</span><br><span class="line">    R[1-a[i]] = R[0] * R[1]</span><br><span class="line">    R[a[i]] = R[a[i]] * R[a[i]]</span><br><span class="line">return R[0]</span><br></pre></td></tr></table></figure></li>
<li><p>Below is the DSA signature scheme in which <span>$p$</span><!-- Has MathJax --> is a large prime, <span>$q$</span><!-- Has MathJax --> is a 160-bit prime factor of (p - 1), <span>$g$</span><!-- Has MathJax --> is an integer of order <span>$q$</span><!-- Has MathJax --> modulo <span>$p$</span><!-- Has MathJax -->. Let <span>$x$</span><!-- Has MathJax --> be the signer’s private key and <span>$y = g^x \mod p$</span><!-- Has MathJax --> be the public key.  </p>
<ol>
<li><p>How to generate an integer <span>$g$</span><!-- Has MathJax --> ?   (5%)</p>
</li>
<li><p>Please complete the following nissing steps of the scheme.   (10%)</p>
</li>
<li><p>Please describe a trick for speeding up DSA’s on-line signing process. (5%)</p>
<pre><code>    _______________________________________________________________________
    Signing algorithm                 Verification algorithm
    _______________________________________________________________________
    r = (g^k mod p) mod q             w = s^-1 mod q
    k is a random integer             u1 = (SHA(m) * w) mod q
    s = ________________              u2 = (r * w) mod q
    m is the messgae                  v = _________________
    the signature is (s,r)            if v = r then the signature is correct
</code></pre>
</li>
</ol>
<ul>
<li><span>$g = h^{(p-1)/q} \mod p$</span><!-- Has MathJax --> ，其中隨機亂數 <span>$h$</span><!-- Has MathJax -->，滿足 <span>$g &gt; 1$</span><!-- Has MathJax --> 即可。  
<p>從費馬小定理中，有一個比較特別的計算來得到 order <span>$q$</span><!-- Has MathJax -->，所謂的 order <span>$q$</span><!-- Has MathJax --> 就是在前 <span>$q$</span><!-- Has MathJax --> 個 <span>$g^i \mod p$</span><!-- Has MathJax --> 下不會出現重複 (循環長度至少為 <span>$q$</span><!-- Has MathJax -->)，從觀察中得知循環長度 <span>$L$</span><!-- Has MathJax --> 滿足 <span>$L | p-1$</span><!-- Has MathJax -->，也就是說 <span>$L$</span><!-- Has MathJax --> 是 <span>$p-1$</span><!-- Has MathJax --> 的因數，<span>$q$</span><!-- Has MathJax --> 則是要找到一個大循環，讓攻擊者更難找到 <span>$x$</span><!-- Has MathJax -->，又因為 <span>$L$</span><!-- Has MathJax --> 是其因數，由於 <span>$q$</span><!-- Has MathJax --> 是 <span>$p-1$</span><!-- Has MathJax --> 的其中一個質因數，則保證是一個最小循環節的要求。</p>
</li>
<li><span>$s = k(SHA(m) + x \times r)$</span><!-- Has MathJax -->  
<span>$v = g^{u1} y^{u2}$</span><!-- Has MathJax -->  </li>
<li><p>可以 offline 去預處理隨機亂數 <span>$k$</span><!-- Has MathJax -->，事先計算一堆的 <span>$r$</span><!-- Has MathJax -->、<span>$z = k^{-1}x \times r$</span><!-- Has MathJax -->，那麼計算 <span>$s$</span><!-- Has MathJax --> 可以非常的快速，<span>$s = k^{-1} SHA(M) + z \mod p$</span><!-- Has MathJax -->，假設 hash 計算快速，只動用到一次乘法和加法，相較於 RSA 的簽章方法，少了指數次方運算。</p>
</li>
</ul>
</li>
<li><p>Under the following certificate hierarchy, please provide all the details of how end user A checking the correctness of end user C’s public key by verifying a sequence of certificates. Note: User A only knows X’s public key, but does NOT have the root Z’s public key directly.   (10%)<br> 若 A 要確認 C 給的 public key 是否正確，則依循以下步驟來確認</p>
<ol>
<li>C 拿出 <code>Y&lt;&lt;C&gt;&gt;</code>，拿 Y 的 public key 進行確認 C 的 public key。</li>
<li>再檢查 Y 的 public key，Y 拿出 <code>Z&lt;&lt;Y&gt;&gt;</code>，拿 Z 的 public key 進行確認 Y 的 public key。</li>
<li>再檢查 Z 的 public key，Z 拿出 <code>X&lt;&lt;Z&gt;&gt;</code>，拿 X 的 public key 進行確認 Z 的 public key。</li>
<li>由於我們知道 X 的 public key (藉由實地臨櫃面對面確認 X 的 public key)，最後驗證 C 給的是正確的 public key。<pre><code>                      Z
                    ／ ＼          Notation used
                   X     Y         X&lt;&lt;A&gt;&gt;:
                 ／ ＼    ＼       A&#39;s certificate issued by X
                A     B     C
</code></pre>
</li>
</ol>
</li>
<li><p>Pleasewrite down the Diffie-Hellman key exchange protocol (including the public key and private key generation process). (10%)  What is the man-in-middle (or the middle person) attack?   (5%)  </p>
<ul>
<li>共同決定一個大質數 <span>$p$</span><!-- Has MathJax --> 和一個基底 <span>$g$</span><!-- Has MathJax --> (全部人都知道)</li>
<li>每個人 A 擁有自己的 private key <span>$x_A$</span><!-- Has MathJax --> (<span>$x_A &lt; p - 1$</span><!-- Has MathJax -->)</li>
<li>每個人 A 計算自己的 public key <span>$y_A$</span><!-- Has MathJax --> (<span>$y_A = g^{x_A} \mod p$</span><!-- Has MathJax -->)</li>
</ul>
<p>假設有兩個人 A, B 要通訊，則把自己的 public key 交給對方，共同產生出一把暫時的 key <span>$K_{AB}$</span><!-- Has MathJax --> 進行通訊加密。</p>
<ul>
<li>對於 A 來說會接收到 <span>$y_B$</span><!-- Has MathJax -->，計算<span>$K_{AB} = (y_B)^{x_A} = g^{x_B \times x_A} \mod p$</span><!-- Has MathJax --></li>
<li>對於 B 來說會接收到 <span>$y_A$</span><!-- Has MathJax -->，計算<span>$K_{AB} = (y_A)^{x_B} = g^{x_A \times x_B} \mod p$</span><!-- Has MathJax --></li>
<li>由於離散對數是一個困難問題，很難藉由攔截紀錄來得到對方的 private key <span>$x_A$</span><!-- Has MathJax -->，因此有一定的安全性。</li>
</ul>
<p>假若現在要進行中間人 C 的攻擊，則會在一開始交換 <span>$K_{AB}$</span><!-- Has MathJax --> 的時候插入到其中通訊。</p>
<ul>
<li>A 發送 <span>$y_A$</span><!-- Has MathJax --> 給 B 時，受到 C 的攔截。</li>
<li>C 知道 A 想要跟 B 通訊，則把自己的 <span>$y_C$</span><!-- Has MathJax --> 發送給 B，並且也傳一份給 A。</li>
<li>B 以為是 A 要進行通訊，實質拿到 <span>$y_C$</span><!-- Has MathJax --> 而非 <span>$y_A$</span><!-- Has MathJax -->。</li>
<li>產生兩把 key<span>$K_{AC}, K_{CB}$</span><!-- Has MathJax -->，C 就偷偷在中間偷聽，並且作為中繼傳送訊息，需要解密 (拿<span>$K_{AC} \text{ or } K_{CB}$</span><!-- Has MathJax -->) 之後再進行加密<span>$K_{CB} \text{ or } K_{AC}$</span><!-- Has MathJax --> 送給另一方。</li>
</ul>
<p>如何防止中間人攻擊，大約有幾種方法，但牽涉到可信任第三方、計算速度。</p>
<ul>
<li>發送訊息上，計算時間的延遲不得超過一定限制，否則可能存在中間人攻擊。</li>
<li>藉由可信任第三方 CA (Certificate Authority) 來驗證彼此的 public key 歸屬於誰<br>由 CA 簽認<span>$Sign_{CA}(\text{public key || owner_id || expiration date || ...})$</span><!-- Has MathJax -->，如此一來如果存在 C 中間人，則轉交 <span>$y_C$</span><!-- Has MathJax --> 給 B 時，B 就會藉由 CA 驗證得到 <code>owner_id</code> 不是通訊對象 A。如果 CA 不可信任，則可以讓 C 簽一個<span>$Sign_{CA}(\text{public key C || owner_A || expiration date || ...})$</span><!-- Has MathJax --> 來欺騙 A 和 B，也就是說 CA 和 C 偷偷在私底下做了黑心勾當，那麼中間人攻擊仍是存在的。</li>
</ul>
</li>
<li><p>Both message authentication code (MAC) and digital signature can be used to provide the functionality of message origin and integrity check. Please briefly describe these two techniwues and compare percisely the difference between these two techniques.   (10%)<br>message authentication code (文件訊息鑑別) 顧名思義就是針對 message 進行驗證，確認發送者身分和資料完整性，相較於 digital signature (數位簽章) 也是做相同的事情，訊息量不同且產生出來的結果也大不相同。通常文件訊息鑑別會破壞儲存資訊，藉由雙方共享的 key 來進行身分認證，可用暫時性的 key，若採用非對稱式則需要額外的數位簽章來輔助驗證發送者。而數位簽章則是提供有效期限內的使用，這把驗證的 public key 必須存在比較長的時間。<br>數位簽章簽定時不知道對方怎麼簽，但能驗證是他簽的並且只有他簽得出來，文件訊息鑑別通常知道對方用什麼流程輸出一樣的數值。</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>類型\性質</th>
<th>加密類型</th>
<th>輸出訊息</th>
<th>碰撞情況</th>
<th>重複使用</th>
</tr>
</thead>
<tbody><tr>
<td>文件訊息鑑別</td>
<td>普遍上對稱式</td>
<td>不管多長都固定長度</td>
<td>存在</td>
<td>相同輸入 - 相同輸出</td>
</tr>
<tr>
<td>數位簽章</td>
<td>非對稱式</td>
<td>視情況而定</td>
<td>視情況而定</td>
<td>相同輸入 - 可能不同輸出</td>
</tr>
</tbody></table>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-speech-human-life" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/18/speech-human-life/" class="article-date">
  <time datetime="2015-06-17T23:25:50.000Z" itemprop="datePublished">2015-06-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手札日記/">手札日記</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/edoaM4Y.png" rel="gallery_ckpaivc88004jn8vnb3bp6zk8">
        <img src="http://i.imgur.com/edoaM4Y.png" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/18/speech-human-life/">人之何以為人、105 號公路 外出紀錄</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/18/speech-human-life/" data-id="ckpaivc88004jn8vnb3bp6zk8" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/18/speech-human-life/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/中央大學/">中央大學</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/服務學習/">服務學習</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>現在學校活動也告一段落，即將要進入淡季，因此對於活動時數認證會變得更加麻煩。學校活動大多都是剩下營隊，當然也只有工作人員才能參與來替換時數，只能參與一半的半吊子可是無法融入進去的。於是被催著去參加校外活動來補這一個門檻問題。</p>
<p>來到中壢，基本上也就只有在校園、火車站及租房地點三角範圍內行動，對於其他地點一概不知，在中壢的學校有中原、元智以及我們中央，之前有被學長帶去中原夜市，若要自行出發還算個挑戰，曾考慮騎車去參加活動，但在前幾天去演練騎車過去時，卻不知不覺繞回學校，中壢的環狀分布、高架橋之路線讓我卻步，看來還是搭公車較為妥當。</p>
<p>去過中原夜市，卻沒進過中原大學，去過元智大學參加程式競賽，卻不知道怎麼自行前往。早上聽完一場演講後，趕緊搭公車轉兩次過去，在一個小時內就抵達中原，比預期中還來得順暢。在提早到達後，走在不同的校園觀望，看看不同地方的感覺，也許是股錯覺，由於騎腳踏車的人少，顯得人群非常的多，而且相較於中央更容易在路上見到女生，想到畢業學長回來學校的時候說一句「怎麼一眼望過去幾乎都男生」突然有點感觸，即使每三個人就有一個人女生，只比中原少一點，在戶外的大椅上不少學生坐在哪裡，顯得更加地活絡。也許只是太少出門，對中央不慎了解吧。</p>
<ul>
<li>全人博雅講壇 「人之何以為人：一個20萬年的故事」－李家維</li>
<li>服務 X 學習 X 旅行 X 夢想 - 不做不會怎麼樣，做了我們很不一樣 「105 號公路-泰緬邊境」－黃婷鈺</li>
</ul>
<h2 id="場一狀態"><a href="#場一狀態" class="headerlink" title="場一狀態"></a>場一狀態</h2><p>在講座開始前就明顯地感受到不同的風氣，開幕前來個留外的音樂表演，同時也請學校校長來說本校的希望不要拿通識的營養學分，正是舉辦這一系列全人教育講座的目的，講座規模不大，卻有不少校外人士和同學入場，相信仍有不少同學是來混時數的，包括我自己。</p>
<p>「人之何以為人：一個 20 萬年的故事」這演講標題不外乎就是在描述人類演化的過程，這 20 萬年間的不斷地挖考出來的化石，訴說人類的起源，為什麼要知道自己的起源與文明發展？能在人類文明習慣中了解不少疑惑，如為什麼總是成對科學人雜誌 - 「** 演化路上夫妻同心 <strong>」、科學人雜誌 - 「</strong> 天天上網的靈長類 **」 … 等。</p>
<p>不少相似的化石指出，智人與其他類似的族群之間的相似程度，雖然基因只有一點點不同，造就體能、合作、學習、腦容量 … 等都有所差異，為了度過險惡的環境，單純體能良好的人種消失，會合作延續文明的種族存活下來，靠的只是一點點變異。這讓我想到動畫《攻殼機動隊》對於文明的看法，人類之所以能成長到這一個地步都是靠一個 ** 外部記憶體 ** - 文明，那我們真的是擁有自我嗎？還是順著文明的發展？但我想當人們不缺物質時，才能去想這些無關緊要的事情。</p>
<p><img src="http://i.imgur.com/fOUikM5.jpg" alt="《攻殼機動隊》"></p>
<p>到底該不該去怪罪努力、後天學習？還是去怪罪刻印在 DNA 上的排序？曾經為了存活繁衍導致的基因，而基因養成習慣。從計算機科學的廣義算法中的基因算法可以裡也到，人類之間的基因變異不算少，這有沒有影響呢？就如電影《蠢蛋進化論》中的基因變化，不見得聰明靈敏，只要適合生存即可。很多行為是沒有道理的，有些演化也是沒有道理的，在用現代的眼光去看待過去的演化價值時，本身就是件很奇怪的事情。</p>
<p><img src="http://i.imgur.com/cYpebvq.jpg" alt="《蠢蛋進化論》"></p>
<p><img src="http://i.imgur.com/mmrNQak.png" alt="《天佑美國》當我們不在意文明時，還需要文明嗎"></p>
<p>回過頭來看看講者提到的科學人雜誌，人耐不住寂寞也是因為曾經有段長久的日子需要彼此扶持，度過那段艱辛的冰河時期。現今環境還算充裕下，人可以不見到其他人，藉由上網交流資訊，雖然這可以交流資訊，但卻難以得到實質的幫助。從現在觀點來看，人其實也很單純，藉由學習外部遺留的文明來成長，所以才看起來聰明，大家也都知道若沒有傳承，人類根本走不到今日。</p>
<h3 id="場一心得"><a href="#場一心得" class="headerlink" title="場一心得"></a>場一心得</h3><p>中原講座的發問其實還挺有趣的，發問相當踴躍，原來在別校是這種情況，即使是一些課本上的內容、電視影集的科幻劇情都拿出來問，講者當然只能回答這不確定，至少不能斷言去否定。講者大部分的內容都可從國高中學的歷史中理解到，藉由後續學習的資訊也可以明白這些小道理，大部分都是在描述科學人雜誌上的資訊，有興趣可以去讀讀。</p>
<h2 id="場二狀態"><a href="#場二狀態" class="headerlink" title="場二狀態"></a>場二狀態</h2><blockquote>
<p>講者的描述有點囧，也許是狀態不好吧，可能尚未習得說話術，對於分享感覺是難以用文字去描述。儘管如此，藉由之前學到的文明與族群的通識課程，大概能猜到她想描述些什麼，就由我來說說吧！</p>
</blockquote>
<p>首先，講者在大學混了四年不感興趣的專業，在四年存夠了錢，前往泰緬邊境的難民營中去當國際志工，泰緬邊境難民營是因為兩個民族之間的糾紛導致。國際志工是什麼？國際志工能做什麼？到底是誰需要誰？還是在別人艱困的環境下，只是想要藉由別人的艱困來充實富足自己的知識？</p>
<p>我對於國際志工不甚了解，但對於文明與文明之間的隔閡有點認識，很多人就會用體驗、參觀的方式去遊走各地，因為旅行是跳脫環境最簡單的方法！想要跳脫環境就去存個錢吧，去別的環境了解自己有多麼無知且高傲，看著別人過著自認為窮困的生活，不了解當地的文化，卻又想幫忙他們的窘境。</p>
<p>對於這件事情，我的看法如下，常說「人只能自救」，國際志工去幫忙不少只是「** 偽善 **」瞧不起別人的文化、可憐他們的處境，去了那裏，只能觀察別人的生活，有時還需要當地人照顧生活。去那兒 ** 體驗 <strong>，就跟別人來家裡 ** 觀光 ** 的感覺一樣，尤其是在戰亂複雜的關係下，志工除了送物質協助無關戰爭的人外，請思考有沒有可能把他們牽涉進去，因為提供給對方敵人協助，那志工算不算敵人？這要特別小心，當我們在台灣成長，沒有那種經驗是很正常的，懵懂無知的情況下，被用另外一種方式教導「</strong> 幫助別人 **」是件好事，因此就把這套邏輯用到另一個國情上。</p>
<blockquote>
<p>請跟沒有計畫性的幫助說再見！</p>
</blockquote>
<p>之前在網路上看到一篇文章《本滿懷熱血的教山區孩童，學生竟對志工老師說：「叔叔阿姨，請你們不要再來我們這義教了…」 》<a href="http://tw.ptt01.cc/post_531">link</a>，開頭第一句「我們沾沾自喜著自己的偉大、奉獻。但是，我們到底為他們做了什麼？」正是描述志工的心境，也正是講者有提及到不少跟著一起去當志工的同學在那裏覺得自己的心很空虛，的確若沒有對自己夠了解時，突然用自己所謂的理解去理解別人時，回饋得到的那種失落感正是那股空虛。</p>
<p><img src="http://i.imgur.com/8hSCKlA.png" alt="《Fate/Stay UBW》這世代充斥著多餘之人"></p>
<p>學校教育是活在這個社會的學習過程，但不就是人類太多、過於群聚，相依彼此產生不少抽象式的職位，並非對物而是對人、對制度的職位，把偏鄉小孩帶來教育城市的生活技巧，對於他們能學到什麼實質內容？跟著大家一起進入城市搶那一鍋粥嗎？原始心中那股純樸到哪去了？講者描述到學校因為有一位長者去世而停課，學生們都跑去為那位長者送行，這是學校教育做到的嗎？還是生活教育體驗到的？</p>
<p>書本的內容可以協助他們理解這個世界，但並不是替他們指引出路的方法。教育這一舉動大多是為了未來生存技能存在，身為一個教育者是否又想過「教育是否又抹殺掉另外一種全然不同的世界觀」這是兩難的取捨，並不是往哪個目標走就是對的，而是要把這概念在教學的背後告訴學生吧。</p>
<h3 id="場二心得"><a href="#場二心得" class="headerlink" title="場二心得"></a>場二心得</h3><p>講者描述上還有趣的，想必是出國體驗後的衝擊巨大，有些事情無法用言語來描述吧。</p>
<p>並不是所有講者都能闡述有多成功的一面，或者是自己體驗多麼豐富的內容，這場演講充分地從講者身上看出那種衝擊，說話言之有物、做事持之以恆，君子不多話、默默做事，人的一生充滿困惑，很多事實無法二分化、二值化，去累積吧！也許有一天就能化作一生最美妙的道理。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/22/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="page-number" href="/page/22/">22</a><span class="page-number current">23</span><a class="page-number" href="/page/24/">24</a><a class="page-number" href="/page/25/">25</a><span class="space">&hellip;</span><a class="page-number" href="/page/85/">85</a><a class="extend next" rel="next" href="/page/24/">Next &raquo;</a>
    </nav>
  
</section>
          
          
            <aside id="sidebar">
  <!-- <div id="ukagaka_panel"></div> -->
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">115</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算機圖學/">計算機圖學</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/">工作應用</a><span class="category-list-count">30</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Java/">Java</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Meme/">Meme</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/可持久化/">可持久化</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/鬼故事/">鬼故事</a><span class="category-list-count">9</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">44</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">633</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">483</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">77</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">45</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2021/05/30/java/java-memory-optimization-1/">
              
                <i class="icon-file-o"></i> 
              
            Java 優化內存使用 結構篇</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/diary-202101/">
              
                <i class="icon-file-o"></i> 
              
            二八進展</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-file-extension/">
              
                <i class="icon-file-o"></i> 
              
            File Extension</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-globl-var/">
              
                <i class="icon-file-o"></i> 
              
            Global Variable</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-handover/">
              
                <i class="icon-file-o"></i> 
              
            Handover</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-interview-recursion/">
              
                <i class="icon-file-o"></i> 
              
            Interview &amp; Recursion</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-job-build/">
              
                <i class="icon-file-o"></i> 
              
            Job Build</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-lang/">
              
                <i class="icon-file-o"></i> 
              
            Programming Language Impostors</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-machine-learning-newbie/">
              
                <i class="icon-file-o"></i> 
              
            Machine Learning for Newbie</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-parallel-gc/">
              
                <i class="icon-file-o"></i> 
              
            Parallel &amp; Garbage Collection</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
<script type="text/javascript">
  $('#ukagaka_panel').ukagaka();
</script>
  
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2021 Shiang-Yun Yang 
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>