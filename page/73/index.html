<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Morris&#39; Blog">
<meta property="og:url" content="http://morris821028.github.io/page/73/index.html">
<meta property="og:site_name" content="Morris&#39; Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris&#39; Blog">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
  <link rel="import" href="/bower_components/app-layout/app-layout.html"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          
          <section id="main">
  
    <article id="post-oj/uva/uva-12176" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/06/oj/uva/uva-12176/" class="article-date">
  <time datetime="2014-07-06T07:01:15.000Z" itemprop="datePublished">2014-07-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/06/oj/uva/uva-12176/">UVa 12176 - Bring Your Own Horse</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/07/06/oj/uva/uva-12176/" data-id="ckpaivcc100ihn8vneu1b1ts7" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/07/06/oj/uva/uva-12176/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LCA/">LCA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MST/">MST</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>One of the essential activities of a knight is to compete in tournaments. Frequently, groups of knights gather around the country to compare their skills. On such a typical contest day, everyone has five hours to do ten disciplines, such as sword fighting, bow and arrow, and various forms of horseback riding. Needless to say, you have to bring your own horse.</p>
<p>This is not as easy as it seems. It often takes a knight several days to go from the castle where he lives to the place where a tournament is held. But horses sometimes are very, very stubborn. After having covered a certain distance on a single day, they sometimes simply stop and refuse to go any further. Luckily, they start anew on the next day. To make sure that the horse does not refuse service before the scheduled day trip is completed, a knight wants to choose an itinerary on which the longest day trip is as short as possible. Hence, a trip that takes many days with short distances is preferable over a shorter route that has the risk of a refusing horse.</p>
<p>Write a program which answers queries from knights spread all over the country about the best way to go from their castles to a tournament site. Given a description of the relevant places (i.e. castles, locations of tournaments, and hostels for overnight stays), the program should tell them the largest distance they have to cover on a single day so that this distance is minimal among all possible itineraries.</p>
<p>The places are designated by consecutive integers from 1 to <span>$N$</span><!-- Has MathJax -->, while a road is represented by three integers, namely its place of origin, its destination, and its length. Every road can be used in both directions, and there is at least one route (i.e. a sequence of roads) between any two places. The knights stick to the given roads while travelling and spend their nights only at one of the <span>$N$</span><!-- Has MathJax --> places.</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The first line contains the total number of test cases that follow.</p>
<p>Each test case begins with a line that first holds the number <span>$N$</span><!-- Has MathJax --> of places ( <span>$1 \le N \le 3000$</span><!-- Has MathJax --> ) followed by the number <span>$R$</span><!-- Has MathJax --> of roads ( <span>$1 \le R \le 100000$</span><!-- Has MathJax --> ). Then there are <span>$R$</span><!-- Has MathJax --> lines with three integers each (<span>$a$</span><!-- Has MathJax --> , <span>$b$</span><!-- Has MathJax --> , and <span>$l$</span><!-- Has MathJax --> ), each of which defines a road connecting the places <span>$a$</span><!-- Has MathJax --> and <span>$b$</span><!-- Has MathJax --> ( <span>$1 \le a, b \le N$</span><!-- Has MathJax --> ) with length <span>$l$</span><!-- Has MathJax --> ( <span>$1 \le l \le 1000000$</span><!-- Has MathJax --> ).</p>
<p>Thereafter, each test case continues with the number <span>$Q$</span><!-- Has MathJax --> of queries on a line by itself ( <span>$1 \le Q \le 1000$</span><!-- Has MathJax --> ). Each of the next <span>$Q$</span><!-- Has MathJax --> lines holds two integers <span>$k$</span><!-- Has MathJax --> and <span>$t$</span><!-- Has MathJax --> , indicating a query by a knight who lives at place <span>$k$</span><!-- Has MathJax --> and needs to go to a tournament at place <span>$t$</span><!-- Has MathJax --> ( <span>$1 \le k, t \le N$</span><!-- Has MathJax --> , <span>$k \neq t$</span><!-- Has MathJax --> ).</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For each test case output a line containing the word ``Case’’, a single space, and its serial number (starting with <span>$1$</span><!-- Has MathJax --> for the first test case). Then, print one line for each query in this test case, containing the smallest maximal day trip distance as described above. Print a blank line after each test case.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">4 4</span><br><span class="line">1 2 100</span><br><span class="line">2 3 100</span><br><span class="line">3 4 100</span><br><span class="line">4 1 200</span><br><span class="line">1</span><br><span class="line">1 4</span><br><span class="line">6 9</span><br><span class="line">2 4 5</span><br><span class="line">5 1 7</span><br><span class="line">3 6 6</span><br><span class="line">3 1 4</span><br><span class="line">2 3 2</span><br><span class="line">1 2 1</span><br><span class="line">6 5 42</span><br><span class="line">4 5 3</span><br><span class="line">4 6 5</span><br><span class="line">4</span><br><span class="line">1 3</span><br><span class="line">3 4</span><br><span class="line">5 4</span><br><span class="line">6 1</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Case 1</span><br><span class="line">100</span><br><span class="line"></span><br><span class="line">Case 2</span><br><span class="line">2</span><br><span class="line">5</span><br><span class="line">3</span><br><span class="line">5</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>** 題目描述： **</p>
<p>騎士每天活動只會從該點移動到盡可能短的路徑到下一個點，求從起點到終點之間的最小的最長路為何。</p>
<p>** 題目解法： **</p>
<p>由於詢問兩個點之間的路徑上的最小值最大邊，不外乎地可以先做一次最小成本樹，根據定義，拆分成 s - t 集合，最小成本樹的邊一定是 s - t 之間的最小邊。</p>
<p>接著詢問在樹上進行即可，因此每次詢問最慘會到 O(n)。</p>
<p>那我們稍微加速，採用 dp 的方式，將樹變成有根樹，記錄每一個節點向上攀升 1 個節點, 2 個節點, 4 個節點 …, 2^n 個節點的路徑上的最大最小值。</p>
<p>因此狀態會是 O(n log n), 建表也能在 O(n log n) 完成，接著調整兩個詢問節點的高度，先想辦法調整到兩個節點到水平高度，藉由之前的計算，高度不超過 n，因此理應可以在 O(log n) 時間內完成到調整到同一水平高度。</p>
<p>在同一水平下，還是需要知道 LCA 的所在高度，否則也可以水平線不斷地一步一步往上提，雖然最慘也許是 O(n) 但是經由之前的調整已經很加速很多。</p>
<p>本來應該套用 LCA Tarjan 的作法來加速，但是還沒有做到這樣的地步速度就很快。如果詢問次數再多一點就必須做到這一步。</p>
<p>有點懶惰 Orz。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">E</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> x, y, v;</span><br><span class="line">    <span class="built_in">E</span>(<span class="keyword">int</span> a=<span class="number">0</span>, <span class="keyword">int</span> b=<span class="number">0</span>, <span class="keyword">int</span> c=<span class="number">0</span>):</span><br><span class="line">        <span class="built_in">x</span>(a), <span class="built_in">y</span>(b), <span class="built_in">v</span>(c) &#123;&#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> E &amp;a) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span>  v &lt; a.v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">E D[<span class="number">100005</span>];</span><br><span class="line">vector&lt;E&gt; tree[<span class="number">3005</span>];</span><br><span class="line"><span class="keyword">int</span> p[<span class="number">3005</span>], rank[<span class="number">3005</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">findp</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> p[x] == x ? x : (p[x] = <span class="built_in">findp</span>(p[x]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">joint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    x = <span class="built_in">findp</span>(x), y = <span class="built_in">findp</span>(y);</span><br><span class="line">    <span class="keyword">if</span>(x == y)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(rank[x] &gt; rank[y])</span><br><span class="line">        rank[x] += rank[y], p[y] = x;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        rank[y] += rank[x], p[x] = y;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">kruscal</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">sort</span>(D, D+m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        p[i] = i, rank[i] = <span class="number">1</span>;</span><br><span class="line">        tree[i].<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">joint</span>(D[i].x, D[i].y)) &#123;</span><br><span class="line">        	sum += D[i].v;</span><br><span class="line">        	tree[D[i].x].<span class="built_in">push_back</span>(<span class="built_in">E</span>(D[i].x, D[i].y, D[i].v));</span><br><span class="line">        	tree[D[i].y].<span class="built_in">push_back</span>(<span class="built_in">E</span>(D[i].y, D[i].x, D[i].v));</span><br><span class="line"><span class="comment">//        	printf(&quot;mmm %d %d %d\n&quot;, D[i].x, D[i].y, D[i].v);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">4096</span>][<span class="number">20</span>], dpw[<span class="number">4096</span>][<span class="number">20</span>];</span><br><span class="line"><span class="keyword">int</span> treeLevel[<span class="number">4096</span>], treePath[<span class="number">4096</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> p, <span class="keyword">int</span> level)</span> </span>&#123;</span><br><span class="line">    treeLevel[u] = level, treePath[level] = u;	</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; (<span class="number">1</span>&lt;&lt;i) &lt; level; i++) &#123;</span><br><span class="line">        dp[u][i] = <span class="built_in">max</span>(dp[u][i<span class="number">-1</span>], dp[dpw[u][i<span class="number">-1</span>]][i<span class="number">-1</span>]);</span><br><span class="line">        dpw[u][i] = treePath[level-(<span class="number">1</span>&lt;&lt;i)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tree[u].<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = tree[u][i].y;</span><br><span class="line">        <span class="keyword">if</span>(v == p)	<span class="keyword">continue</span>;		</span><br><span class="line">        dp[v][<span class="number">0</span>] = tree[u][i].v;</span><br><span class="line">        dpw[v][<span class="number">0</span>] = u;</span><br><span class="line">        <span class="built_in">dfs</span>(v, u, level + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> hx = treeLevel[x], hy = treeLevel[y];</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x != y &amp;&amp; hx != hy) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">15</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">abs</span>(hx-hy) &gt;= (<span class="number">1</span>&lt;&lt;i)) &#123;</span><br><span class="line">                <span class="keyword">if</span>(hx &gt; hy) &#123;</span><br><span class="line">                    ret = <span class="built_in">max</span>(ret, dp[x][i]);</span><br><span class="line">                    x = dpw[x][i];</span><br><span class="line">                    hx -= (<span class="number">1</span>&lt;&lt;i);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    ret = <span class="built_in">max</span>(ret, dp[y][i]);</span><br><span class="line">                    y = dpw[y][i];</span><br><span class="line">                    hy -= (<span class="number">1</span>&lt;&lt;i); </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(x != y) &#123;</span><br><span class="line">        ret = <span class="built_in">max</span>(ret, dp[x][<span class="number">0</span>]);</span><br><span class="line">        x = dpw[x][<span class="number">0</span>];</span><br><span class="line">        hx -= (<span class="number">1</span>&lt;&lt;<span class="number">0</span>);</span><br><span class="line">        ret = <span class="built_in">max</span>(ret, dp[y][<span class="number">0</span>]);</span><br><span class="line">        y = dpw[y][<span class="number">0</span>];</span><br><span class="line">        hy -= (<span class="number">1</span>&lt;&lt;<span class="number">0</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//	freopen(&quot;in.txt&quot;, &quot;r+t&quot;, stdin);</span></span><br><span class="line"><span class="comment">//	freopen(&quot;out.txt&quot;, &quot;w+t&quot;, stdout); </span></span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span>(testcase--) &#123;</span><br><span class="line">        <span class="keyword">int</span> n, m, q, x, y;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        	<span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;D[i].x, &amp;D[i].y, &amp;D[i].v);        	</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> mstcost = <span class="built_in">kruscal</span>(n, m);</span><br><span class="line">        <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp));</span><br><span class="line">        <span class="built_in">memset</span>(dpw, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dpw));</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">1</span>, <span class="number">-1</span>, <span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line"><span class="comment">//		for(int i = 1; i &lt;= n; i++, puts(&quot;&quot;)) &#123;</span></span><br><span class="line"><span class="comment">//			printf(&quot;[%2d] :&quot;, i);</span></span><br><span class="line"><span class="comment">//			for(int j = 0; (1&lt;&lt;j) &lt;= n; j++)</span></span><br><span class="line"><span class="comment">//				printf(&quot;%d %d, &quot;, dp[i][j], dpw[i][j]);</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;q);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case %d\n&quot;</span>, ++cases);</span><br><span class="line">        <span class="keyword">while</span>(q--) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;y);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">query</span>(x, y));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">10 45</span></span><br><span class="line"><span class="comment">1 2 15</span></span><br><span class="line"><span class="comment">1 3 11</span></span><br><span class="line"><span class="comment">1 4 48</span></span><br><span class="line"><span class="comment">1 5 24</span></span><br><span class="line"><span class="comment">1 6 45</span></span><br><span class="line"><span class="comment">1 7 18</span></span><br><span class="line"><span class="comment">1 8 12</span></span><br><span class="line"><span class="comment">1 9 40</span></span><br><span class="line"><span class="comment">1 10 11</span></span><br><span class="line"><span class="comment">2 3 4</span></span><br><span class="line"><span class="comment">2 4 9</span></span><br><span class="line"><span class="comment">2 5 44</span></span><br><span class="line"><span class="comment">2 6 23</span></span><br><span class="line"><span class="comment">2 7 39</span></span><br><span class="line"><span class="comment">2 8 48</span></span><br><span class="line"><span class="comment">2 9 48</span></span><br><span class="line"><span class="comment">2 10 22</span></span><br><span class="line"><span class="comment">3 4 42</span></span><br><span class="line"><span class="comment">3 5 37</span></span><br><span class="line"><span class="comment">3 6 10</span></span><br><span class="line"><span class="comment">3 7 18</span></span><br><span class="line"><span class="comment">3 8 29</span></span><br><span class="line"><span class="comment">3 9 8</span></span><br><span class="line"><span class="comment">3 10 47</span></span><br><span class="line"><span class="comment">4 5 7</span></span><br><span class="line"><span class="comment">4 6 17</span></span><br><span class="line"><span class="comment">4 7 25</span></span><br><span class="line"><span class="comment">4 8 23</span></span><br><span class="line"><span class="comment">4 9 32</span></span><br><span class="line"><span class="comment">4 10 27</span></span><br><span class="line"><span class="comment">5 6 26</span></span><br><span class="line"><span class="comment">5 7 21</span></span><br><span class="line"><span class="comment">5 8 38</span></span><br><span class="line"><span class="comment">5 9 40</span></span><br><span class="line"><span class="comment">5 10 39</span></span><br><span class="line"><span class="comment">6 7 35</span></span><br><span class="line"><span class="comment">6 8 11</span></span><br><span class="line"><span class="comment">6 9 39</span></span><br><span class="line"><span class="comment">6 10 1</span></span><br><span class="line"><span class="comment">7 8 15</span></span><br><span class="line"><span class="comment">7 9 10</span></span><br><span class="line"><span class="comment">7 10 47</span></span><br><span class="line"><span class="comment">8 9 28</span></span><br><span class="line"><span class="comment">8 10 11</span></span><br><span class="line"><span class="comment">9 10 1</span></span><br><span class="line"><span class="comment">30</span></span><br><span class="line"><span class="comment">1 6</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">10 45</span></span><br><span class="line"><span class="comment">1 2 9</span></span><br><span class="line"><span class="comment">1 3 12</span></span><br><span class="line"><span class="comment">1 4 21</span></span><br><span class="line"><span class="comment">1 5 4</span></span><br><span class="line"><span class="comment">1 6 32</span></span><br><span class="line"><span class="comment">1 7 20</span></span><br><span class="line"><span class="comment">1 8 14</span></span><br><span class="line"><span class="comment">1 9 28</span></span><br><span class="line"><span class="comment">1 10 16</span></span><br><span class="line"><span class="comment">2 3 12</span></span><br><span class="line"><span class="comment">2 4 23</span></span><br><span class="line"><span class="comment">2 5 27</span></span><br><span class="line"><span class="comment">2 6 34</span></span><br><span class="line"><span class="comment">2 7 43</span></span><br><span class="line"><span class="comment">2 8 2</span></span><br><span class="line"><span class="comment">2 9 33</span></span><br><span class="line"><span class="comment">2 10 35</span></span><br><span class="line"><span class="comment">3 4 41</span></span><br><span class="line"><span class="comment">3 5 26</span></span><br><span class="line"><span class="comment">3 6 16</span></span><br><span class="line"><span class="comment">3 7 39</span></span><br><span class="line"><span class="comment">3 8 2</span></span><br><span class="line"><span class="comment">3 9 49</span></span><br><span class="line"><span class="comment">3 10 44</span></span><br><span class="line"><span class="comment">4 5 24</span></span><br><span class="line"><span class="comment">4 6 2</span></span><br><span class="line"><span class="comment">4 7 17</span></span><br><span class="line"><span class="comment">4 8 26</span></span><br><span class="line"><span class="comment">4 9 20</span></span><br><span class="line"><span class="comment">4 10 2</span></span><br><span class="line"><span class="comment">5 6 23</span></span><br><span class="line"><span class="comment">5 7 5</span></span><br><span class="line"><span class="comment">5 8 41</span></span><br><span class="line"><span class="comment">5 9 12</span></span><br><span class="line"><span class="comment">5 10 15</span></span><br><span class="line"><span class="comment">6 7 48</span></span><br><span class="line"><span class="comment">6 8 45</span></span><br><span class="line"><span class="comment">6 9 13</span></span><br><span class="line"><span class="comment">6 10 28</span></span><br><span class="line"><span class="comment">7 8 25</span></span><br><span class="line"><span class="comment">7 9 12</span></span><br><span class="line"><span class="comment">7 10 37</span></span><br><span class="line"><span class="comment">8 9 4</span></span><br><span class="line"><span class="comment">8 10 5</span></span><br><span class="line"><span class="comment">9 10 41</span></span><br><span class="line"><span class="comment">30</span></span><br><span class="line"><span class="comment">5 4</span></span><br><span class="line"><span class="comment">1 7</span></span><br><span class="line"><span class="comment">8 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-12045" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/06/oj/uva/uva-12045/" class="article-date">
  <time datetime="2014-07-06T06:00:52.000Z" itemprop="datePublished">2014-07-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/06/oj/uva/uva-12045/">UVa 12045 - Fun with Strings</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/07/06/oj/uva/uva-12045/" data-id="ckpaivcbx00i2n8vn293l4sm1" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/07/06/oj/uva/uva-12045/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/D-C/">D&C</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/矩陣/">矩陣</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Zibon just started his courses in Computer science. After having some lectures on programming courses he fell in love with strings. He started to play with strings and experiments on them. One day he started a string of arbitrary (of course positive) length consisting of only {a, b}. He considered it as 1st string and generated subsequent strings from it by replacing all the b’s with ab and all the a’s with b. For example, if he ith string is abab, (i+1)th string will be b(ab)b(ab) = babbab. He found that the Nth string has the length X and Mth string has the length Y. He wondered what will be length of the Kth string. Can you help him?</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The first line of the input file contains an integer T (T ≤ 1000) which denotes the total number of test cases. The description of each test case is given below:</p>
<p>Five integers N, X, M, Y and K where (0 &lt; N, M, X, Y, K &lt; 109 and N ≠ M).</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For each test case produce one line of output giving either the number which is desired length (modulo 1000000007) or the string “Impossible”. You output Impossible if the given input is not possible.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">3 16 5 42 6</span><br><span class="line">5 1 6 10 9</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">68</span><br><span class="line">Impossible</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>** 題目描述： **</p>
<p>一開始由 a, b 構成的字串，每一次操作會將 a 換成 b, 將 b 換成 ab。<br>在第 N 次之後長度為 X、第 M 次之後長度為 Y，求第 K 次之後長度為何？</p>
<p>** 題目解法： **</p>
<p>看到 a 換成 b, 將 b 換成 ab，其實只考量數量關係，很明顯是一個費式數列的關係。<br>因此，只要假設一開始有多少個 a，有多少個 b 在一開始的字串中，利用兩條方程式求解，之後再帶入費式數列的快速運算即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span> &#123;</span></span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> v[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">    <span class="built_in">Matrix</span>(<span class="keyword">long</span> <span class="keyword">long</span> a = <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(&amp;v, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(v));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">            v[i][i] = a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span> mod = <span class="number">1000000007LL</span>;</span><br><span class="line"><span class="function">Matrix <span class="title">multiply</span><span class="params">(Matrix x, Matrix y)</span> </span>&#123;</span><br><span class="line">    Matrix z;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">2</span>; j++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">2</span>; k++) &#123;</span><br><span class="line">                z.v[i][j] += x.v[i][k] * y.v[k][j] %mod;</span><br><span class="line">                z.v[i][j] %= mod;</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">return</span> z;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Matrix <span class="title">pow</span><span class="params">(Matrix x, <span class="keyword">long</span> <span class="keyword">long</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="function">Matrix <span class="title">v</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span>(y) &#123;</span><br><span class="line">        <span class="keyword">if</span>(y&amp;<span class="number">1</span>)</span><br><span class="line">            v = <span class="built_in">multiply</span>(v, x);</span><br><span class="line">        y = y&gt;&gt;<span class="number">1</span>, x = <span class="built_in">multiply</span>(x, x); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> N, X, M, Y, K;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span>(testcase--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld %lld %lld %lld %lld&quot;</span>, &amp;N, &amp;X, &amp;M, &amp;Y, &amp;K);</span><br><span class="line">        Matrix mm, na, nb, nc;</span><br><span class="line">        mm.v[<span class="number">0</span>][<span class="number">0</span>] = mm.v[<span class="number">0</span>][<span class="number">1</span>] = mm.v[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        na = <span class="built_in">pow</span>(mm, N);</span><br><span class="line">        nb = <span class="built_in">pow</span>(mm, M);</span><br><span class="line">        nc = <span class="built_in">pow</span>(mm, K);</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> a1, b1, c1, a2, b2, c2;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> d, dx, dy;</span><br><span class="line">        a1 = na.v[<span class="number">0</span>][<span class="number">0</span>], b1 = na.v[<span class="number">1</span>][<span class="number">0</span>], c1 = X;</span><br><span class="line">        a2 = nb.v[<span class="number">0</span>][<span class="number">0</span>], b2 = nb.v[<span class="number">1</span>][<span class="number">0</span>], c2 = Y;</span><br><span class="line">        d = a1 * b2 - a2 * b1;</span><br><span class="line">        dx = X * b2 - Y * b1, dy = a1 * Y - a2 * X;</span><br><span class="line">        <span class="keyword">if</span>(d == <span class="number">0</span> || dx%d || dy%d || dx/d &lt; <span class="number">0</span> || dy/d &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;Impossible&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> a = dx/d, b = dy/d;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, (a * nc.v[<span class="number">0</span>][<span class="number">0</span>]%mod + b * nc.v[<span class="number">1</span>][<span class="number">0</span>]%mod)%mod);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//		printf(&quot;%lld A + %lld B = %lld\n&quot;, na.v[0][0], na.v[1][0], X);</span></span><br><span class="line"><span class="comment">//		printf(&quot;%lld A + %lld B = %lld\n&quot;, nb.v[0][0], nb.v[1][0], Y);</span></span><br><span class="line"><span class="comment">//		printf(&quot;%lld A + %lld B = ????\n&quot;, nc.v[0][0], nc.v[1][0]);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-12042" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/06/oj/uva/uva-12042/" class="article-date">
  <time datetime="2014-07-06T05:45:42.000Z" itemprop="datePublished">2014-07-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/06/oj/uva/uva-12042/">UVa 12042 - Colorful Eggs</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/07/06/oj/uva/uva-12042/" data-id="ckpaivcbx00i1n8vn6n9s1mfz" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/07/06/oj/uva/uva-12042/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/D-C/">D&C</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/矩陣/">矩陣</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Little Mou is very fond of eggs. She has n baskets for keeping her colorful eggs. Each basket contains eggs of different colors. The baskets are numbered from 1 to n. She has a strange hobby about these eggs. On each day, she takes each basket starting from the nth basket. When she is doing this for basket i, she counts all eggs placed in baskets 1 to i (inclusive) and takes their sum. Let this value of sum be counti. She removes all old eggs from the ith basket and keeps counti new eggs in the ith basket. After that she puts all the old eggs of the ith basket in the (i-1)th basket removing the old eggs of the (i-1)th basket. As Mou is very fond of eggs, she eats all old eggs of the (i-1)th basket. And when she has finished eating, she repeats the work for this (i-1)th basket. If she reaches the 1st basket, she stops her work and doesn’t eat any more eggs and goes to sleep!</p>
<p>For example let Mou has 3 baskets at day 1. 1st basket contains 1 egg, 2nd basket contains 1 egg and the 3rd basket contains 2 eggs.</p>
<p>So simulation for day 3 follows:</p>
<p>Basket Index =&gt; 3 2 1</p>
<p>….. 略</p>
<p>Now the problem is given n, d and the number of eggs in each basket eggi, your job is to find the number of eggs in each basket after d days. As the number can be very big output answer modulo 1,000,000,007.</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The first line of the input file contains an integer T (T ≤ 111) which denotes the total number of test cases. The description of each test case is given below:</p>
<p>Two integers N (1 ≤ n ≤ 60) and d (1 ≤ d ≤ 1,000,000,000), followed by n integers denoting the number of eggs in each basket starting from 1 to n.<br>Output</p>
<p>For each test case print one line of output containing the number of eggs in each basket after d days have passed separated by single spaces between them. See the sample output for more details. As the numbers can be very big output answer modulo 1,000,000,007.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">3 7</span><br><span class="line">1 2 3</span><br><span class="line">2 2</span><br><span class="line">4 5</span><br><span class="line">2 1</span><br><span class="line">1 10</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">129 189 277</span><br><span class="line">5 9</span><br><span class="line">1 10</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>** 題目描述： **</p>
<p>一開始有 n 籃雞蛋，每一籃有各自個雞蛋數量。</p>
<p>每一次的操作從最右邊 (編號大的那籃開始) 進行，將所有比它小的編號的雞蛋總數加到這一籃，並且將原本的雞蛋總數指派給下一個籃。</p>
<p>問第 d 天後的結果。</p>
<p>** 題目解法： **</p>
<p>建造轉移矩陣，使用 D&amp;C 完成。</p>
<p>觀察一下可以發現，矩陣肯定長成這副德性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[1, 1, 1, ..., 1, 1, 1]</span><br><span class="line">[1, 0, 1, ..., 1, 1, 1]</span><br><span class="line">[1, 0, 0, 1, ..., 1, 1] = M</span><br><span class="line">[1, 0, 0, 0, ..., 1, 1]</span><br><span class="line">...</span><br><span class="line">[1, 0, 0, 0, ..., 0, 0]</span><br><span class="line"></span><br><span class="line">[an]</span><br><span class="line">[an-1]</span><br><span class="line">[an-2] = A(1)</span><br><span class="line">...</span><br><span class="line">[a1]</span><br><span class="line"></span><br><span class="line">M x A(1) = A(2)</span><br><span class="line">M x M x A(1) = A(3)</span><br></pre></td></tr></table></figure>


<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span> mod = <span class="number">1000000007LL</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span> &#123;</span></span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> v[<span class="number">64</span>][<span class="number">64</span>];</span><br><span class="line">    <span class="keyword">int</span> row, col; <span class="comment">// row x col</span></span><br><span class="line">    <span class="built_in">Matrix</span>(<span class="keyword">int</span> n, <span class="keyword">int</span> m, <span class="keyword">long</span> <span class="keyword">long</span> a = <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(v, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(v));</span><br><span class="line">        row = n, col = m;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; row &amp;&amp; i &lt; col; i++)</span><br><span class="line">            v[i][i] = a;</span><br><span class="line">    &#125;</span><br><span class="line">    Matrix <span class="keyword">operator</span>*(<span class="keyword">const</span> Matrix&amp; x) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="function">Matrix <span class="title">ret</span><span class="params">(row, x.col)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; row; i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; x.col; j++)</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; col; k++)</span><br><span class="line">                    ret.v[i][j] += v[i][k] * x.v[k][j] %mod,</span><br><span class="line">                    ret.v[i][j] %= mod;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    Matrix <span class="keyword">operator</span>^(<span class="keyword">const</span> <span class="keyword">int</span>&amp; n) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="function">Matrix <span class="title">ret</span><span class="params">(row, col, <span class="number">1</span>)</span>, x </span>= *<span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">int</span> y = n;</span><br><span class="line">        <span class="keyword">while</span>(y) &#123;</span><br><span class="line">            <span class="keyword">if</span>(y&amp;<span class="number">1</span>)	ret = ret * x;</span><br><span class="line">            y = y&gt;&gt;<span class="number">1</span>, x = x * x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, n, d, a[<span class="number">105</span>];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span>(testcase--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;d);</span><br><span class="line">        d--;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line">        <span class="function">Matrix <span class="title">x</span><span class="params">(n, n)</span>, <span class="title">A</span><span class="params">(n, <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            A.v[i][<span class="number">0</span>] = a[n-i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            x.v[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">                x.v[i][j] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            x.v[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Matrix y = x ^ d;</span><br><span class="line">        Matrix r = y * A;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = r.row<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123; </span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>, r.v[i][<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">if</span>(i)	<span class="built_in">putchar</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-12040" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/06/oj/uva/uva-12040/" class="article-date">
  <time datetime="2014-07-06T05:36:06.000Z" itemprop="datePublished">2014-07-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/06/oj/uva/uva-12040/">UVa 12040 - Again Lucky Numbers</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/07/06/oj/uva/uva-12040/" data-id="ckpaivcbx00i0n8vn0jtc7mag" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/07/06/oj/uva/uva-12040/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AC自動機/">AC自動機</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dp/">dp</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Some people believe that 13 is an unlucky number. So they always want to avoid the number 13. But I believe that 7 is an unlucky number and want to avoid it. So unlucky number is different for man to man. If 13 is an unlucky number and in a number there is no 13 (i.e. no ‘1’ is followed by a ‘3’) then we can call it a lucky number. For example, if we consider 13 as an unlucky number then 12345 is a lucky number. But if any number contains 13 then it is not a lucky number, such as 13254 and 21345 are not lucky numbers. Given the number of digits N in a number and the unlucky number M, you have to find out how many lucky numbers are possible with N digits considering that M is unlucky number. Note that leading 0’s are not allowed. So, 011 is not a valid three digit number.</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The first line of the input file contains an integer T (T ≤ 1000) which denotes the total number of test cases. The description of each test case is given below:</p>
<p>Two positive integers N (1 ≤ N ≤ 100), M (1 ≤ M ≤ 10100).</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For each test case print the number of lucky numbers of N digits considering that M is the unlucky number. The result may be very large. You have to output the result modulo 10000007.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">1 3</span><br><span class="line">2 13</span><br><span class="line">2 1</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">9</span><br><span class="line">89</span><br><span class="line">72</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>** 題目描述： **</p>
<p>找到長度為 n 的數字，並且數字中不會出現指定的數字為 substring，求符合數字的總數。</p>
<p>** 題目解法： **</p>
<p>特別考慮以 0 開頭的情況 (n 位數字前導不可為 0，但 n = 1 位數字可以是 0)。<br>最後，建造一台 AC 自動機，接著對於每一個節點著手 dp 轉移。</p>
<p>也就是考慮再將字串進行 AC 自動機匹配時所會遇到的所有轉移情況，因此我們要避免出現指定的字符串時，在結尾處標記不可轉移即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://mypaper.pchome.com.tw/zerojudge/post/1324462879</span></span><br><span class="line"><span class="comment">// AC 自動機 DP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    Node *next[<span class="number">10</span>], *fail, *prev;</span><br><span class="line">    <span class="keyword">int</span> eos;<span class="comment">//prefix has a string end</span></span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> dp[<span class="number">105</span>]; <span class="comment">// [string length]</span></span><br><span class="line">    <span class="keyword">int</span> ASCII;</span><br><span class="line">    <span class="built_in">Node</span>() &#123;</span><br><span class="line">        fail = <span class="literal">NULL</span>, prev = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="built_in">memset</span>(next, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(next));</span><br><span class="line">        <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp));</span><br><span class="line">        eos = <span class="number">0</span>;</span><br><span class="line">        ASCII = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insertTrie</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> str[], Node *root, <span class="keyword">int</span> label)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Node *p;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i, idx, eos;</span><br><span class="line">    p = root, eos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; str[i]; i++) &#123;</span><br><span class="line">        idx = str[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(p-&gt;next[idx] == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            p-&gt;next[idx] = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">            p-&gt;next[idx]-&gt;prev = p;</span><br><span class="line">            p-&gt;next[idx]-&gt;ASCII = idx;</span><br><span class="line">        &#125;</span><br><span class="line">        eos |= p-&gt;eos;</span><br><span class="line">        p = p-&gt;next[idx];</span><br><span class="line">        p-&gt;eos |= eos;</span><br><span class="line">    &#125;</span><br><span class="line">    p-&gt;eos |= label;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">freeTrie</span><span class="params">(Node *root)</span> </span>&#123;</span><br><span class="line">    queue&lt;Node*&gt; Q;</span><br><span class="line">    Node *nd;</span><br><span class="line">    Q.<span class="built_in">push</span>(root);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        nd = Q.<span class="built_in">front</span>(), Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(nd-&gt;next[i] != <span class="literal">NULL</span>)</span><br><span class="line">                Q.<span class="built_in">push</span>(nd-&gt;next[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">delete</span> nd;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">buildACautomation</span><span class="params">(Node *root)</span> </span>&#123;</span><br><span class="line">    queue&lt;Node*&gt; Q;</span><br><span class="line">    Node *nd, *p;</span><br><span class="line">    root-&gt;fail = <span class="literal">NULL</span>;</span><br><span class="line">    Q.<span class="built_in">push</span>(root);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        nd = Q.<span class="built_in">front</span>(), Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(nd-&gt;next[i] == <span class="literal">NULL</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            Q.<span class="built_in">push</span>(nd-&gt;next[i]);</span><br><span class="line">            p = nd-&gt;fail;</span><br><span class="line">            <span class="keyword">while</span>(p != <span class="literal">NULL</span> &amp;&amp; p-&gt;next[i] == <span class="literal">NULL</span>)</span><br><span class="line">                p = p-&gt;fail;</span><br><span class="line">            <span class="keyword">if</span>(p == <span class="literal">NULL</span>)</span><br><span class="line">                nd-&gt;next[i]-&gt;fail = root;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                nd-&gt;next[i]-&gt;fail = p-&gt;next[i];</span><br><span class="line">                nd-&gt;next[i]-&gt;eos |= p-&gt;next[i]-&gt;eos;<span class="comment">//special for dp</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">10000007</span>;</span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">dp</span><span class="params">(Node *root, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    queue&lt;Node*&gt; Q;</span><br><span class="line">    Node *nd, *p;</span><br><span class="line">    root-&gt;dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> k, i, j;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ans, ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(k = <span class="number">0</span>; k &lt;= len; k++) &#123;</span><br><span class="line">        Q.<span class="built_in">push</span>(root);</span><br><span class="line">        ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            nd = Q.<span class="built_in">front</span>(), Q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span>(i = (k == <span class="number">0</span>); i &lt; <span class="number">10</span>; i++) &#123; <span class="comment">// leading 0&#x27;s are not allowed</span></span><br><span class="line">                <span class="keyword">if</span>(nd-&gt;next[i] != <span class="literal">NULL</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(nd-&gt;next[i]-&gt;eos)</span><br><span class="line">                        <span class="keyword">continue</span>;<span class="comment">//not safe</span></span><br><span class="line">                    nd-&gt;next[i]-&gt;dp[k+<span class="number">1</span>] += nd-&gt;dp[k];</span><br><span class="line">                    nd-&gt;next[i]-&gt;dp[k+<span class="number">1</span>] %= mod;</span><br><span class="line">                    Q.<span class="built_in">push</span>(nd-&gt;next[i]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p = nd;</span><br><span class="line">                    <span class="keyword">while</span>(p != root &amp;&amp; p-&gt;next[i] == <span class="literal">NULL</span>)</span><br><span class="line">                        p = p-&gt;fail;</span><br><span class="line">                    p = p-&gt;next[i];</span><br><span class="line">                    <span class="keyword">if</span>(p == <span class="literal">NULL</span>) <span class="comment">// error message</span></span><br><span class="line">                        <span class="built_in">puts</span>(<span class="string">&quot;NULL&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span>(p-&gt;eos)</span><br><span class="line">                        <span class="keyword">continue</span>;<span class="comment">//not safe</span></span><br><span class="line">                    p-&gt;dp[k+<span class="number">1</span>] += nd-&gt;dp[k];</span><br><span class="line">                    p-&gt;dp[k+<span class="number">1</span>] %= mod;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            ans += nd-&gt;dp[k];</span><br><span class="line">            ans %= mod;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(k == len) &#123;</span><br><span class="line">            ret += ans;</span><br><span class="line">            ret %= mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, p, i;</span><br><span class="line">    <span class="keyword">int</span> cases = <span class="number">0</span>, testcase;</span><br><span class="line">    <span class="keyword">char</span> pattern[<span class="number">105</span>], s[<span class="number">105</span>];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span>(testcase--) &#123;</span><br><span class="line">        Node *root = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %s&quot;</span>, &amp;n, pattern);</span><br><span class="line">        <span class="built_in">insertTrie</span>(pattern, root, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        	s[<span class="number">0</span>] = i + <span class="string">&#x27;0&#x27;</span>, s[<span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        	<span class="built_in">insertTrie</span>(s, root, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">buildACautomation</span>(root);</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="built_in">dp</span>(root, n);</span><br><span class="line">        <span class="built_in">freeTrie</span>(root);</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">1</span> &amp;&amp; <span class="built_in">strcmp</span>(<span class="string">&quot;0&quot;</span>, pattern))</span><br><span class="line">        	ret++;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">1 3</span></span><br><span class="line"><span class="comment">2 13</span></span><br><span class="line"><span class="comment">2 1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-12010" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/06/oj/uva/uva-12010/" class="article-date">
  <time datetime="2014-07-06T05:26:33.000Z" itemprop="datePublished">2014-07-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/06/oj/uva/uva-12010/">UVa 12010 - Boring Homework</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/07/06/oj/uva/uva-12010/" data-id="ckpaivcbv00hvn8vna973f8nj" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/07/06/oj/uva/uva-12010/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/模擬/">模擬</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Professor Z. always gives his students lots of boring homework. Last week, after explaining binary search trees (BSTs), he asked his students to draw a picture of BST according to the list of numbers inserted into the tree sequentially. Maryanna spent so much time playing the game “Starcraft II” that she can’t finish her homework in time. She needs your help.</p>
<ul>
<li>A binary search tree, which may sometimes also be called ordered or sorted binary tree, is a node-based binary tree data structure which has the following properties: </li>
<li>The left subtree of a node contains only nodes with keys less than the node’s key.</li>
<li>The right subtree of a node contains only nodes with keys greater than the node’s key.</li>
<li>Both the left and right subtrees must also be binary search trees.</li>
</ul>
<p>-from Wikipedia </p>
<p>To draw a picture of BST, you may follow the rules listed below:</p>
<ul>
<li>The picture of a 1-node BST, whose size is 1*1, is a single ‘o’ (15th small Latin letter).</li>
<li>If a BST has a non-empty subtree, draw a single ‘|’ just above the subtree’s root, and a single ‘+’ just above previous drawn ‘|’. Finally, in the row of ‘+’, use the least number (including 0) of ‘-‘s to connect ‘+’ (denoting the left subtree and right subtree) and ‘o’ (denoting the parent node of the subtree)</li>
<li>The left subtree (if exists) must be drawn on the left side of its parent. Similarly, the right subtree (if exists) must be drawn on the right side of its parent.</li>
<li>The column of the BST’s root must not contain any character from left subtree or right subtree.</li>
<li>Any column containing any characters from BST’s left subtree must not contain any characters from BST’s right subtree, and vice versa. That is, for a node of the BST, the picture of its left subtree and the picture of its right subtree do not share common columns in the picture of the whole tree.</li>
</ul>
<p>The sample output may give a clear clarification about the format of the picture.</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The first line contains T ( T<span>$\le$</span><!-- Has MathJax -->2500), the number of test cases. T lines follow. Each line contains a positive integer N (N &lt; 80), followed by N integers - a permutation of 1 to N. The permutation indicates the insert order for the BST.</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For each test case:</p>
<p>Output the case number counting from 1 in the first line. The next lines should be the image described above without any trailing spaces. See the sample for more format details.</p>
<p>Note: Notice that no trailing whitespaces after the last visible characters of each line are allowed.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">3 3 1 2</span><br><span class="line">6 4 5 6 1 3 2</span><br><span class="line">5 3 4 5 2 1</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Case #1:</span><br><span class="line">+-o</span><br><span class="line">|</span><br><span class="line">o+</span><br><span class="line"> |</span><br><span class="line"> o</span><br><span class="line">Case #2:</span><br><span class="line">+--o+</span><br><span class="line">|   |</span><br><span class="line">o-+ o+</span><br><span class="line">  |  |</span><br><span class="line"> +o  o</span><br><span class="line"> |</span><br><span class="line"> o</span><br><span class="line">Case #3:</span><br><span class="line"> +o+</span><br><span class="line"> | |</span><br><span class="line">+o o+</span><br><span class="line">|   |</span><br><span class="line">o   o</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>** 題目描述： **</p>
<p>請先依序插入節點，並且建造一棵二分搜尋樹，接著打印出來。</p>
<p>以 <code>o</code> 表示節點，而用 <code>+</code> 表示左右子樹的存在，並且用 <code>-</code> 來移動其位置。盡可能用最少的 <code>-</code> 來完成。並且每一列 (縱向) 只會有一個 <code>o</code> 存在。</p>
<p>** 題目解法： **</p>
<p>根據中序搜索，可以得到由左至右的打印節點順序，根據這個打印順序著手左右的 <code>-</code> 計算。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, l, r, porder;</span><br><span class="line">&#125;;</span><br><span class="line">Node BST[<span class="number">128</span>];</span><br><span class="line"><span class="keyword">char</span> g[<span class="number">256</span>][<span class="number">128</span>];</span><br><span class="line"><span class="keyword">int</span> porder = <span class="number">0</span>, mxdep;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> nd, <span class="keyword">int</span> dep)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dep &gt; mxdep)	mxdep = dep;</span><br><span class="line">    <span class="keyword">if</span>(BST[nd].l != <span class="number">-1</span>)</span><br><span class="line">        <span class="built_in">build</span>(BST[nd].l, dep+<span class="number">2</span>);</span><br><span class="line">    BST[nd].porder = porder++;	</span><br><span class="line">    <span class="keyword">if</span>(BST[nd].r != <span class="number">-1</span>)</span><br><span class="line">        <span class="built_in">build</span>(BST[nd].r, dep+<span class="number">2</span>);</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span>(BST[nd].l != <span class="number">-1</span>) &#123;</span><br><span class="line">        g[dep][BST[BST[nd].l].porder] = <span class="string">&#x27;+&#x27;</span>;</span><br><span class="line">        g[dep+<span class="number">1</span>][BST[BST[nd].l].porder] = <span class="string">&#x27;|&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = BST[BST[nd].l].porder + <span class="number">1</span>; i &lt; BST[nd].porder; i++)</span><br><span class="line">            g[dep][i] = <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    g[dep][BST[nd].porder] = <span class="string">&#x27;o&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(BST[nd].r != <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = BST[BST[nd].r].porder - <span class="number">1</span>; i &gt; BST[nd].porder; i--)</span><br><span class="line">            g[dep][i] = <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">        g[dep][BST[BST[nd].r].porder] = <span class="string">&#x27;+&#x27;</span>;</span><br><span class="line">        g[dep+<span class="number">1</span>][BST[BST[nd].r].porder] = <span class="string">&#x27;|&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>, N;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span>(testcase--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;N);</span><br><span class="line">        <span class="built_in">memset</span>(BST, <span class="number">-1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(BST));</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;BST[<span class="number">0</span>].v);</span><br><span class="line">        <span class="keyword">int</span> size = <span class="number">1</span>, x;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">            <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(x &lt; BST[idx].v) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(BST[idx].l != <span class="number">-1</span>)</span><br><span class="line">                        idx = BST[idx].l;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        BST[idx].l = size, BST[size++].v = x, idx = <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(BST[idx].r != <span class="number">-1</span>)</span><br><span class="line">                        idx = BST[idx].r;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        BST[idx].r = size, BST[size++].v = x, idx = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">while</span>(idx);</span><br><span class="line">        &#125;</span><br><span class="line">        porder = <span class="number">0</span>, mxdep = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(g, <span class="string">&#x27; &#x27;</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(g));</span><br><span class="line">        <span class="built_in">build</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case #%d:\n&quot;</span>, ++cases);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= mxdep; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = N; g[i][j] == <span class="string">&#x27; &#x27;</span>; j--)</span><br><span class="line">                g[i][j] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, g[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-11990" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/06/oj/uva/uva-11990/" class="article-date">
  <time datetime="2014-07-06T05:12:05.000Z" itemprop="datePublished">2014-07-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/06/oj/uva/uva-11990/">UVa 11990 - ``Dynamic&#39;&#39; Inversion</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/07/06/oj/uva/uva-11990/" data-id="ckpaivcbv00hun8vn5l5a4730" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/07/06/oj/uva/uva-11990/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BIT/">BIT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ST/">ST</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/樹套樹/">樹套樹</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/線段樹/">線段樹</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>You are given a permutation {1,2,3,…,n}. Remove m of them one by one, and output the number of inversion pairs before each removal. The number of inversion pairs of an array A is the number of ordered pairs (i,j) such that i &lt; j and A[i] &gt; A[j].</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The input contains several test cases. The first line of each case contains two integers n and m (1&lt;=n&lt;=200,000, 1&lt;=m&lt;=100,000). After that, n lines follow, representing the initial permutation. Then m lines follow, representing the removed integers, in the order of the removals. No integer will be removed twice. The input is terminated by end-of-file (EOF). The size of input file does not exceed 5MB.</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For each removal, output the number of inversion pairs before it.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">5 4</span><br><span class="line">1</span><br><span class="line">5</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">2</span><br><span class="line">5</span><br><span class="line">1</span><br><span class="line">4</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<h2 id="Output-for-the-Sample-Input"><a href="#Output-for-the-Sample-Input" class="headerlink" title="Output for the Sample Input"></a>Output for the Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<h2 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h2><p>(1,5,3,4,2)-&gt;(1,3,4,2)-&gt;(3,4,2)-&gt;(3,2)-&gt;(3)</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>** 題目描述： **</p>
<p>找尋一維數列的逆序對總數，每一次詢問請輸出當時的逆序對個數，隨後將該數字從數列中移除。</p>
<p>** 題目解法： **</p>
<p>一開始可以利用傳統的 D&amp;C 或者是線段樹之類的區間查詢來完成全部的逆序對總數。</p>
<p>隨後要移除某個特定的數字時，要查找該數字前面有多少比它大的數字，以及後面有多少比它小的數字。也就是說，找尋前綴大於某個數字的個數，和找尋後綴小於某個數字的個數，算出有多少對逆序對減少。</p>
<p>這裡使用類似歸併樹的做法，類似合併排序，將會切分成數個區間做排序。並且在每一個區間中會建立一棵離散化後的 binary indexed tree，如果一來記憶體可以在 O(n log n) 解決。</p>
<p>由於我們只需要前綴和後綴的操作，所以說是線段樹可能還有所不及。</p>
<p>每次將前綴拆分成線段樹的數個區間，利用 binary indexed tree，查找當前有多少小於該數字 x 數字被刪除，得到有多少小於 x 的數字還存在 … 之後就可以得到需要的個數。</p>
<p>詳見代碼。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 200005</span></span><br><span class="line"><span class="keyword">int</span> N, M, DEL;</span><br><span class="line"><span class="keyword">int</span> ST[<span class="number">20</span>][MAXN], BIT[<span class="number">20</span>][MAXN];</span><br><span class="line"><span class="keyword">int</span> MP[MAXN];</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> invPair;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modifySUM</span><span class="params">(<span class="keyword">int</span> BIT[], <span class="keyword">int</span> x, <span class="keyword">int</span> v, <span class="keyword">int</span> L)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(x &lt;= L) &#123;</span><br><span class="line">        BIT[x] += v;</span><br><span class="line">        x += x&amp;(-x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">querySUM</span><span class="params">(<span class="keyword">int</span> BIT[], <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x) &#123;</span><br><span class="line">        ret += BIT[x];</span><br><span class="line">        x -= x&amp;(-x); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">buildST</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> dep)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = l; i &lt;= r; i++)</span><br><span class="line">        ST[dep][i] = ST[dep<span class="number">-1</span>][i], BIT[dep][i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &gt;= r)	<span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">int</span> m = (l + r)/<span class="number">2</span>;</span><br><span class="line">    <span class="built_in">buildST</span>(k&lt;&lt;<span class="number">1</span>, l, m, dep+<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">buildST</span>(k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m+<span class="number">1</span>, r, dep+<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">sort</span>(ST[dep] + l, ST[dep] + r+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">queryPrefix</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> dep, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x &lt;= l &amp;&amp; r &lt;= y) &#123;</span><br><span class="line">        <span class="keyword">int</span> pos = <span class="built_in">upper_bound</span>(ST[dep] + l, ST[dep] + r+<span class="number">1</span>, val) - ST[dep];</span><br><span class="line">        <span class="keyword">int</span> pre = <span class="built_in">querySUM</span>(BIT[dep]+l<span class="number">-1</span>, pos - l);</span><br><span class="line">        invPair -= (r - pos + <span class="number">1</span>) - (<span class="built_in">querySUM</span>(BIT[dep]+l<span class="number">-1</span>, r-l + <span class="number">1</span>) - pre);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(l &gt;= r)	<span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">int</span> m = (l + r)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>(x &lt;= m)</span><br><span class="line">        <span class="built_in">queryPrefix</span>(k&lt;&lt;<span class="number">1</span>, l, m, dep+<span class="number">1</span>, x, y, val);</span><br><span class="line">    <span class="keyword">if</span>(y &gt; m)</span><br><span class="line">        <span class="built_in">queryPrefix</span>(k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m+<span class="number">1</span>, r, dep+<span class="number">1</span>, x, y, val);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">querySuffix</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> dep, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x &lt;= l &amp;&amp; r &lt;= y) &#123;</span><br><span class="line">        <span class="keyword">int</span> pos = <span class="built_in">upper_bound</span>(ST[dep] + l, ST[dep] + r+<span class="number">1</span>, val) - ST[dep];</span><br><span class="line">        <span class="keyword">int</span> pre = <span class="built_in">querySUM</span>(BIT[dep]+l<span class="number">-1</span>, pos - l);</span><br><span class="line">        invPair -= (pos - l) - pre;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(l &gt;= r)	<span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">int</span> m = (l + r)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>(x &lt;= m)</span><br><span class="line">        <span class="built_in">querySuffix</span>(k&lt;&lt;<span class="number">1</span>, l, m, dep+<span class="number">1</span>, x, y, val);</span><br><span class="line">    <span class="keyword">if</span>(y &gt; m)</span><br><span class="line">        <span class="built_in">querySuffix</span>(k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m+<span class="number">1</span>, r, dep+<span class="number">1</span>, x, y, val);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> dep, <span class="keyword">int</span> x, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">        <span class="built_in">modifySUM</span>(BIT[dep]+l<span class="number">-1</span>, <span class="number">1</span>, <span class="number">1</span>, r-l+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(l &gt;= r)	<span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">int</span> m = (l + r)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>(x &lt;= m)</span><br><span class="line">        <span class="built_in">update</span>(k&lt;&lt;<span class="number">1</span>, l, m, dep+<span class="number">1</span>, x, val);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">update</span>(k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m+<span class="number">1</span>, r, dep+<span class="number">1</span>, x, val);</span><br><span class="line">    <span class="keyword">int</span> pos = <span class="built_in">lower_bound</span>(ST[dep] + l, ST[dep] + r+<span class="number">1</span>, val) - ST[dep];</span><br><span class="line">    <span class="built_in">modifySUM</span>(BIT[dep]+l<span class="number">-1</span>, pos - l + <span class="number">1</span>, <span class="number">1</span>, r-l+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;N, &amp;M) == <span class="number">2</span>) &#123;</span><br><span class="line">        invPair = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++)</span><br><span class="line">            BIT[<span class="number">0</span>][i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;ST[<span class="number">0</span>][i]);</span><br><span class="line">            MP[ST[<span class="number">0</span>][i]] = i;</span><br><span class="line">            invPair += i - <span class="number">1</span> - <span class="built_in">querySUM</span>(BIT[<span class="number">0</span>], ST[<span class="number">0</span>][i]);</span><br><span class="line">            <span class="built_in">modifySUM</span>(BIT[<span class="number">0</span>], ST[<span class="number">0</span>][i], <span class="number">1</span>, N);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">buildST</span>(<span class="number">1</span>, <span class="number">1</span>, N, <span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(M--) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;DEL);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, invPair);</span><br><span class="line">            <span class="built_in">queryPrefix</span>(<span class="number">1</span>, <span class="number">1</span>, N, <span class="number">1</span>, <span class="number">1</span>, MP[DEL] - <span class="number">1</span>, DEL);</span><br><span class="line">            <span class="built_in">querySuffix</span>(<span class="number">1</span>, <span class="number">1</span>, N, <span class="number">1</span>, MP[DEL] + <span class="number">1</span>, N, DEL);</span><br><span class="line">            <span class="built_in">update</span>(<span class="number">1</span>, <span class="number">1</span>, N, <span class="number">1</span>, MP[DEL], DEL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 4</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-11722" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/06/oj/uva/uva-11722/" class="article-date">
  <time datetime="2014-07-06T03:49:56.000Z" itemprop="datePublished">2014-07-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/06/oj/uva/uva-11722/">UVa 11722 - Joining with Friend</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/07/06/oj/uva/uva-11722/" data-id="ckpaivcbn00h1n8vn2m791osg" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/07/06/oj/uva/uva-11722/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/凸包交集/">凸包交集</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/幾何/">幾何</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/概率/">概率</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>You are going from Dhaka to Chittagong by train and you came to know one of your old friends is going from city Chittagong to Sylhet. You also know that both the trains will have a stoppage at junction Akhaura at almost same time. You wanted to see your friend there. But the system of the country is not that good. The times of reaching to Akhaura for both trains are not fixed. In fact your train can reach in any time within the interval [t1, t2] with equal probability. The other one will reach in any time within the interval [s1, s2] with equal probability. Each of the trains will stop for w minutes after reaching the junction.  You can only see your friend, if in some time both of the trains is present in the station. Find the probability that you can see your friend. </p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The first line of input will denote the number of cases T (T &lt; 500). Each of the following T line will contain 5 integers t1, t2, s1, s2, w (360 ≤ t1 &lt; t2 &lt; 1080, 360 ≤ s1 &lt; s2 &lt; 1080 and 1 ≤ w ≤ 90). All inputs t1, t2, s1, s2 and w are given in minutes and t1, t2, s1, s2 are minutes since midnight 00:00.</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For each test case print one line of output in the format “Case #k: p” Here k is the case number and p is the probability of seeing your friend. Up to 1e-6 error in your output will be acceptable.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">1000 1040 1000 1040 20</span><br><span class="line">720 750 730 760 16</span><br></pre></td></tr></table></figure>
<h2 id="Output-for-Sample-Input"><a href="#Output-for-Sample-Input" class="headerlink" title="Output for Sample Input"></a>Output for Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Case #1: 0.75000000</span><br><span class="line">Case #2: 0.67111111</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>** 題目描述： **</p>
<p>有兩位朋友，分別在 [t1, t2] 和 [s1, s2] 之間內可能會抵達，並且在那邊最多停留 w 單位時間。</p>
<p>問兩個人碰面的機率為何。</p>
<p>** 題目解法： **</p>
<p>將兩個人分別至於 X Y 軸，利用幾何面積找到概率。</p>
<p>對於面積 [t1, t2]x[s1, s2] 只要符合 |t - s| &lt;= w 的面積比例。</p>
<p>由於排容上可能不好理解，直接套用凸包交集的算法，兩個凸包交一定也是凸包。</p>
<p><img src="/img/p11722.png" alt="p11722.png"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> eps 1e-8</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pt</span> &#123;</span></span><br><span class="line">    <span class="keyword">double</span> x, y;</span><br><span class="line">    <span class="built_in">Pt</span>(<span class="keyword">double</span> a = <span class="number">0</span>, <span class="keyword">double</span> b = <span class="number">0</span>):</span><br><span class="line">    	<span class="built_in">x</span>(a), <span class="built_in">y</span>(b) &#123;&#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">fabs</span>(x-a.x) &gt; eps)	<span class="keyword">return</span> x &lt; a.x;</span><br><span class="line">        <span class="keyword">return</span> y &lt; a.y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">fabs</span>(x-a.x) &lt; eps &amp;&amp; <span class="built_in">fabs</span>(y-a.y) &lt; eps;</span><br><span class="line">    &#125;</span><br><span class="line">    Pt <span class="keyword">operator</span>+(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Pt</span>(x + a.x, y + a.y);</span><br><span class="line">    &#125;</span><br><span class="line">    Pt <span class="keyword">operator</span>-(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Pt</span>(x - a.x, y - a.y);</span><br><span class="line">    &#125;</span><br><span class="line">    Pt <span class="keyword">operator</span>/(<span class="keyword">const</span> <span class="keyword">double</span> val) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Pt</span>(x / val, y / val);</span><br><span class="line">    &#125;</span><br><span class="line">    Pt <span class="keyword">operator</span>*(<span class="keyword">const</span> <span class="keyword">double</span> val) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Pt</span>(x * val, y * val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> Pt Vector;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">dist</span><span class="params">(Pt a, Pt b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">hypot</span>(a.x - b.x, a.y - b.y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">dot</span><span class="params">(Pt a, Pt b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.x * b.x + a.y * b.y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">cross2</span><span class="params">(Pt a, Pt b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.x * b.y - a.y * b.x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">cross</span><span class="params">(Pt o, Pt a, Pt b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a.x-o.x)*(b.y-o.y)-(a.y-o.y)*(b.x-o.x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">between</span><span class="params">(Pt a, Pt b, Pt c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dot</span>(c - a, b - a) &gt;= <span class="number">0</span> &amp;&amp; <span class="built_in">dot</span>(c - b, a - b) &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">onSeg</span><span class="params">(Pt a, Pt b, Pt c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">between</span>(a, b, c) &amp;&amp; <span class="built_in">fabs</span>(<span class="built_in">cross</span>(a, b, c)) &lt; eps;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Seg</span> &#123;</span></span><br><span class="line">    Pt s, e;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calcIntersection</span><span class="params">(Seg a, Seg b, Pt &amp;p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> a1, b1, c1, a2, b2, c2;</span><br><span class="line">    <span class="keyword">double</span> d, dx, dy;</span><br><span class="line">    a1 = a.s.y-a.e.y, b1 = -a.s.x+a.e.x;</span><br><span class="line">    a2 = b.s.y-b.e.y, b2 = -b.s.x+b.e.x;</span><br><span class="line">    c1 = a1*a.s.x + b1*a.s.y;</span><br><span class="line">    c2 = a2*b.s.x + b2*b.s.y;</span><br><span class="line">    d = a1*b2 - a2*b1;</span><br><span class="line">    dx = c1*b2 - c2*b1;</span><br><span class="line">    dy = a1*c2 - a2*c1;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">fabs</span>(d) &lt; eps) <span class="comment">// NONE or LINE</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    p.x = dx / d, p.y = dy / d;</span><br><span class="line">    <span class="comment">/*printf(&quot;%lf %lf - %lf %lf\n&quot;, a.s.x, a.s.y, a.e.x, a.e.y);</span></span><br><span class="line"><span class="comment">    printf(&quot;%lf %lf - %lf %lf\n&quot;, b.s.x, b.s.y, b.e.x, b.e.y);</span></span><br><span class="line"><span class="comment">    printf(&quot;%lf %lf\n&quot;, p.x, p.y);*/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">onSeg</span>(a.s, a.e, p) &amp;&amp; <span class="built_in">onSeg</span>(b.s, b.e, p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">inPolygon</span><span class="params">(Pt p[], <span class="keyword">int</span> n, Pt q)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j, cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>, j = n<span class="number">-1</span>; i &lt; n; j = i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(p[i].y &gt; q.y != p[j].y &gt; q.y &amp;&amp;</span><br><span class="line">           q.x &lt; (p[j].x-p[i].x)*(q.y-p[i].y)/(p[j].y-p[i].y) + p[i].x)</span><br><span class="line">           cnt++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt&amp;<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">calcArea</span><span class="params">(Pt p[], <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n &lt; <span class="number">3</span>)   <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">double</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    p[n] = p[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        ret += p[i].x * p[i+<span class="number">1</span>].y - p[i].y * p[i+<span class="number">1</span>].x;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fabs</span>(ret)/<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">monotone</span><span class="params">(<span class="keyword">int</span> n, Pt p[], Pt ch[])</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(p, p+n);</span><br><span class="line">    <span class="keyword">int</span> i, m = <span class="number">0</span>, t;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">while</span>(m &gt;= <span class="number">2</span> &amp;&amp; <span class="built_in">cross</span>(ch[m<span class="number">-2</span>], ch[m<span class="number">-1</span>], p[i]) &lt;= <span class="number">0</span>)</span><br><span class="line">            m--;</span><br><span class="line">        ch[m++] = p[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(i = n<span class="number">-1</span>, t = m+<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">while</span>(m &gt;= t &amp;&amp; <span class="built_in">cross</span>(ch[m<span class="number">-2</span>], ch[m<span class="number">-1</span>], p[i]) &lt;= <span class="number">0</span>)</span><br><span class="line">            m--;</span><br><span class="line">        ch[m++] = p[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> m<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Pt a[<span class="number">64</span>], b[<span class="number">64</span>], ret[<span class="number">64</span>], ch[<span class="number">64</span>];</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span>(testcase--) &#123;</span><br><span class="line">    	<span class="keyword">int</span> t1, t2, s1, s2, w;</span><br><span class="line">    	<span class="keyword">int</span> n = <span class="number">4</span>, m = <span class="number">4</span>, q;</span><br><span class="line">    	<span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d %d %d&quot;</span>, &amp;t1, &amp;t2, &amp;s1, &amp;s2, &amp;w);</span><br><span class="line">    	a[<span class="number">0</span>] = <span class="built_in">Pt</span>(t1, s1), a[<span class="number">1</span>] = <span class="built_in">Pt</span>(t2, s1);</span><br><span class="line">    	a[<span class="number">2</span>] = <span class="built_in">Pt</span>(t2, s2), a[<span class="number">3</span>] = <span class="built_in">Pt</span>(t1, s2);</span><br><span class="line">    	b[<span class="number">0</span>] = <span class="built_in">Pt</span>(<span class="number">0</span>, w), b[<span class="number">1</span>] = <span class="built_in">Pt</span>(<span class="number">0</span>, -w);</span><br><span class="line">    	b[<span class="number">2</span>] = <span class="built_in">Pt</span>(t2, t2-w), b[<span class="number">3</span>] = <span class="built_in">Pt</span>(t2, t2+w);</span><br><span class="line">        Seg seg1, seg2;</span><br><span class="line">        <span class="keyword">int</span> retN = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>, j = n<span class="number">-1</span>; i &lt; n; j = i++) &#123;</span><br><span class="line">            seg1.s = a[i], seg1.e = a[j];</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> p = <span class="number">0</span>, q = m<span class="number">-1</span>; p &lt; m; q = p++) &#123;</span><br><span class="line">                seg2.s = b[p], seg2.e = b[q];</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">calcIntersection</span>(seg1, seg2, ret[retN])) &#123;</span><br><span class="line">                    retN++;</span><br><span class="line">                    <span class="comment">/*printf(&quot;%lf %lf - %lf %lf\n&quot;, s1.s.x, s1.s.y, s1.e.x, s1.e.y);</span></span><br><span class="line"><span class="comment">                    printf(&quot;%lf %lf - %lf %lf +++\n&quot;, s2.s.x, s2.s.y, s2.e.x, s2.e.y);*/</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">inPolygon</span>(b, m, a[i]))</span><br><span class="line">                ret[retN++] = a[i];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">inPolygon</span>(a, n, b[i]))</span><br><span class="line">                ret[retN++] = b[i];</span><br><span class="line">        q = <span class="built_in">monotone</span>(retN, ret, ch);</span><br><span class="line">        <span class="keyword">double</span> area = <span class="built_in">calcArea</span>(ch, q);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %.8lf\n&quot;</span>, ++cases, area / ((t2 - t1) * (s2 - s1)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-11266" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/06/oj/uva/uva-11266/" class="article-date">
  <time datetime="2014-07-06T03:32:22.000Z" itemprop="datePublished">2014-07-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/06/oj/uva/uva-11266/">UVa 11266 - Equations</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/07/06/oj/uva/uva-11266/" data-id="ckpaivcbi00gen8vngzd3eppv" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/07/06/oj/uva/uva-11266/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dp/">dp</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Find the number of solutions, the equation ∑Xi = s have, if Ai≤Xi≤Bi for each i = 1…n.</p>
<p>For example,</p>
<pre><code>        X1 + X2 + X3 = 10

        -1 ≤ X1 ≤ 3

        2 ≤ X2 ≤ 4

        6 ≤ X3 ≤ 7
</code></pre>
<p>The above set of equations has 6 solutions. They are: {1,4,7}, {0,3,7}, {0,4,6}, {1,2,7}, {1,3,6} and {2,2,6}.</p>
<p>You are given n the number of variables and the range of them. Your task is to calculate the number of solutions of that equation.</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>First line of the Input contains T (≤50) the number of test cases. Then T test cases follow. First line of each test case contains 2 integer n (1≤n≤10) and s (-50000 ≤ s ≤ 50000).  Next n lines each contain 2 integers describing the range of each variable. The ith line Ai and Bi (10000 ≤ Ai ≤ Bi ≤10000). Xi can take any integral value in the range [Ai, Bi].</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output:"></a>Output:</h2><p>For each test case output contains one integer denoting the number of solutions of the given equations. Output the value modulo 200003.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">3 10</span><br><span class="line">-1 3</span><br><span class="line">2 4</span><br><span class="line">6 7	</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">6</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>** 題目描述： **</p>
<p>對於每一個變數範圍，找到符合等式的解個數。</p>
<p>** 題目解法： **</p>
<p>直接著手動態規劃，對於 <code>dp[i][j]</code> 定義為使用前 i 個變數，總合為 j 的方法數。</p>
<p>為了加快迴圈操作，必須修改成滑動窗口，為了省記憶體，又使用滾動數組。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> shift = <span class="number">100000</span>;</span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">2</span>][<span class="number">200005</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, n, s;</span><br><span class="line">    <span class="keyword">int</span> A[<span class="number">16</span>], B[<span class="number">16</span>];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span>(testcase--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;s);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;A[i], &amp;B[i]);</span><br><span class="line">            </span><br><span class="line">        <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = A[<span class="number">0</span>]; i &lt;= B[<span class="number">0</span>]; i++)</span><br><span class="line">            dp[<span class="number">0</span>][i + shift] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> f = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="built_in">memset</span>(dp[f], <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp[f]));</span><br><span class="line">            <span class="keyword">int</span> l = -B[i], r = -A[i], sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span> - B[i]; j &lt;= <span class="number">0</span> - A[i]; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(j &lt; <span class="number">0</span> || j &gt;= <span class="number">200005</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                sum += dp[!f][j];</span><br><span class="line">                sum %= <span class="number">200003</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">200005</span>; j++) &#123;</span><br><span class="line">                dp[f][j] = sum;</span><br><span class="line">                <span class="keyword">if</span>(l &gt;= <span class="number">0</span> &amp;&amp; l &lt; <span class="number">200005</span>)</span><br><span class="line">                    sum -= dp[!f][l];</span><br><span class="line">                <span class="keyword">if</span>(r + <span class="number">1</span> &gt;= <span class="number">0</span> &amp;&amp; r + <span class="number">1</span> &lt; <span class="number">200005</span>)</span><br><span class="line">                    sum += dp[!f][r+<span class="number">1</span>];</span><br><span class="line"><span class="comment">//				if(sum)</span></span><br><span class="line"><span class="comment">//					printf(&quot;%d %d %d\n&quot;, i, j - shift, sum);</span></span><br><span class="line">                sum %= <span class="number">200003</span>;</span><br><span class="line">                l++, r++;</span><br><span class="line">            &#125;</span><br><span class="line">            f = !f;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, (dp[!f][s + shift] + <span class="number">200003</span>)%<span class="number">200003</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-11243" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/06/oj/uva/uva-11243/" class="article-date">
  <time datetime="2014-07-06T03:13:33.000Z" itemprop="datePublished">2014-07-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/06/oj/uva/uva-11243/">UVa 11243 - Texas Trip</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/07/06/oj/uva/uva-11243/" data-id="ckpaivcbh00gcn8vn5ojq1imb" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/07/06/oj/uva/uva-11243/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/三分/">三分</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/最小覆蓋正方形/">最小覆蓋正方形</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>After a day trip with his friend Dick, Harry noticed a strange pattern of tiny holes in the door of his SUV. The local American Tire store sells fiberglass patching material only in square sheets. What is the smallest patch that Harry needs to fix his door?</p>
<p>Assume that the holes are points on the integer lattice in the plane. Your job is to find the area of the smallest square that will cover all the holes.</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The first line of input contains a single integer T expressed in decimal with no leading zeroes, denoting the number of test cases to follow. The subsequent lines of input describe the test cases.</p>
<p>Each test case begins with a single line, containing a single integer n expressed in decimal with no leading zeroes, the number of points to follow; each of the following n lines contains two integers x and y, both expressed in decimal with no leading zeroes, giving the coordinates of one of your points.</p>
<p>You are guaranteed that T &lt;= 30 and that no data set contains more than 30 points. All points in each data set will be no more than 500 units away from (0,0).</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>Print, on a single line with two decimal places of precision, the area of the smallest square containing all of your points. An answer will be accepted if it lies within 0.1 of the correct answer.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">4</span><br><span class="line">-1 -1</span><br><span class="line">1 -1</span><br><span class="line">1 1</span><br><span class="line">-1 1</span><br><span class="line">4</span><br><span class="line">10 1</span><br><span class="line">10 -1</span><br><span class="line">-10 1</span><br><span class="line">-10 -1</span><br></pre></td></tr></table></figure>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4.00</span><br><span class="line">242.00</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>** 題目描述： **</p>
<p>給平面上 N 個點，找到最小面積的正方形覆蓋所有點。</p>
<p>** 題目解法： **</p>
<p>做一次凸包，得到逆時針的點順序，對於每一個凸包頂點進行，使用三分搜索找到相對應的寬。</p>
<p>進行三分搜索的線段為如下圖所示</p>
<p><img src="/img/p11243.png" alt="p11243.png"></p>
<p>對於通過 B 點的所有線段，考慮與下一個凸包頂點所夾的角度( &lt; 180 度)，如圖範例所示即三分再 45 度的區域之中。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> eps 1e-8</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pt</span> &#123;</span></span><br><span class="line">    <span class="keyword">double</span> x, y;</span><br><span class="line">    <span class="built_in">Pt</span>(<span class="keyword">double</span> a = <span class="number">0</span>, <span class="keyword">double</span> b = <span class="number">0</span>):</span><br><span class="line">    	<span class="built_in">x</span>(a), <span class="built_in">y</span>(b) &#123;&#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">fabs</span>(x-a.x) &gt; eps)	<span class="keyword">return</span> x &lt; a.x;</span><br><span class="line">        <span class="keyword">return</span> y &lt; a.y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">fabs</span>(x-a.x) &lt; eps &amp;&amp; <span class="built_in">fabs</span>(y-a.y) &lt; eps;</span><br><span class="line">    &#125;</span><br><span class="line">    Pt <span class="keyword">operator</span>+(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Pt</span>(x + a.x, y + a.y);</span><br><span class="line">    &#125;</span><br><span class="line">    Pt <span class="keyword">operator</span>-(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Pt</span>(x - a.x, y - a.y);</span><br><span class="line">    &#125;</span><br><span class="line">    Pt <span class="keyword">operator</span>/(<span class="keyword">const</span> <span class="keyword">double</span> val) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Pt</span>(x / val, y / val);</span><br><span class="line">    &#125;</span><br><span class="line">    Pt <span class="keyword">operator</span>*(<span class="keyword">const</span> <span class="keyword">double</span> val) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Pt</span>(x * val, y * val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> Pt Vector;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">dist</span><span class="params">(Pt a, Pt b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">hypot</span>(a.x - b.x, a.y - b.y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">dot</span><span class="params">(Pt a, Pt b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.x * b.x + a.y * b.y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">cross2</span><span class="params">(Pt a, Pt b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.x * b.y - a.y * b.x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">cross</span><span class="params">(Pt o, Pt a, Pt b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a.x-o.x)*(b.y-o.y)-(a.y-o.y)*(b.x-o.x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">between</span><span class="params">(Pt a, Pt b, Pt c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dot</span>(c - a, b - a) &gt;= <span class="number">0</span> &amp;&amp; <span class="built_in">dot</span>(c - b, a - b) &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">onSeg</span><span class="params">(Pt a, Pt b, Pt c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">between</span>(a, b, c) &amp;&amp; <span class="built_in">fabs</span>(<span class="built_in">cross</span>(a, b, c)) &lt; eps;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">distProjection</span><span class="params">(Pt as, Pt at, Pt s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> a, b, c;</span><br><span class="line">    a = at.y - as.y;</span><br><span class="line">    b = as.x - at.x;</span><br><span class="line">    c = - (a * as.x + b * as.y);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fabs</span>(a * s.x + b * s.y + c) / <span class="built_in">hypot</span>(a, b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Seg</span> &#123;</span></span><br><span class="line">    Pt s, e;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calcIntersection</span><span class="params">(Seg a, Seg b, Pt &amp;p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> a1, b1, c1, a2, b2, c2;</span><br><span class="line">    <span class="keyword">double</span> d, dx, dy;</span><br><span class="line">    a1 = a.s.y-a.e.y, b1 = -a.s.x+a.e.x;</span><br><span class="line">    a2 = b.s.y-b.e.y, b2 = -b.s.x+b.e.x;</span><br><span class="line">    c1 = a1*a.s.x + b1*a.s.y;</span><br><span class="line">    c2 = a2*b.s.x + b2*b.s.y;</span><br><span class="line">    d = a1*b2 - a2*b1;</span><br><span class="line">    dx = c1*b2 - c2*b1;</span><br><span class="line">    dy = a1*c2 - a2*c1;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">fabs</span>(d) &lt; eps) <span class="comment">// NONE or LINE</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    p.x = dx / d, p.y = dy / d;</span><br><span class="line">    <span class="comment">/*printf(&quot;%lf %lf - %lf %lf\n&quot;, a.s.x, a.s.y, a.e.x, a.e.y);</span></span><br><span class="line"><span class="comment">    printf(&quot;%lf %lf - %lf %lf\n&quot;, b.s.x, b.s.y, b.e.x, b.e.y);</span></span><br><span class="line"><span class="comment">    printf(&quot;%lf %lf\n&quot;, p.x, p.y);*/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">onSeg</span>(a.s, a.e, p) &amp;&amp; <span class="built_in">onSeg</span>(b.s, b.e, p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">inPolygon</span><span class="params">(Pt p[], <span class="keyword">int</span> n, Pt q)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j, cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>, j = n<span class="number">-1</span>; i &lt; n; j = i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(p[i].y &gt; q.y != p[j].y &gt; q.y &amp;&amp;</span><br><span class="line">           q.x &lt; (p[j].x-p[i].x)*(q.y-p[i].y)/(p[j].y-p[i].y) + p[i].x)</span><br><span class="line">           cnt++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt&amp;<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">calcArea</span><span class="params">(Pt p[], <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n &lt; <span class="number">3</span>)   <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">double</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    p[n] = p[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        ret += p[i].x * p[i+<span class="number">1</span>].y - p[i].y * p[i+<span class="number">1</span>].x;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fabs</span>(ret)/<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">monotone</span><span class="params">(<span class="keyword">int</span> n, Pt p[], Pt ch[])</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(p, p+n);</span><br><span class="line">    <span class="keyword">int</span> i, m = <span class="number">0</span>, t;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">while</span>(m &gt;= <span class="number">2</span> &amp;&amp; <span class="built_in">cross</span>(ch[m<span class="number">-2</span>], ch[m<span class="number">-1</span>], p[i]) &lt;= <span class="number">0</span>)</span><br><span class="line">            m--;</span><br><span class="line">        ch[m++] = p[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(i = n<span class="number">-1</span>, t = m+<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">while</span>(m &gt;= t &amp;&amp; <span class="built_in">cross</span>(ch[m<span class="number">-2</span>], ch[m<span class="number">-1</span>], p[i]) &lt;= <span class="number">0</span>)</span><br><span class="line">            m--;</span><br><span class="line">        ch[m++] = p[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> m<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 1e+30 </span></span><br><span class="line"><span class="comment">// ternary search</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">calcSquare</span><span class="params">(<span class="keyword">double</span> m, Pt p, Pt ch[], <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> a, b, c, lab;</span><br><span class="line">    <span class="keyword">double</span> w = <span class="number">0</span>, hl = <span class="number">0</span>, hr = <span class="number">0</span>, h;</span><br><span class="line">    a = <span class="built_in">sin</span>(m), b = -<span class="built_in">cos</span>(m), c = - (a * p.x + b * p.y), lab = <span class="built_in">hypot</span>(a, b);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> pp = <span class="number">0</span>, qq = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">double</span> d = <span class="built_in">fabs</span>(a * ch[i].x + b * ch[i].y + c) / lab;</span><br><span class="line">        w = <span class="built_in">max</span>(w, d);</span><br><span class="line">        <span class="keyword">if</span>(a * ch[i].x + b * ch[i].y + c &lt; - <span class="number">1e-6</span>)</span><br><span class="line">            pp++;</span><br><span class="line">        <span class="keyword">if</span>(a * ch[i].x + b * ch[i].y + c &gt; <span class="number">1e-6</span>)</span><br><span class="line">            qq++;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//	printf(&quot;%d %d\n&quot;, pp, qq);</span></span><br><span class="line">    a = <span class="built_in">cos</span>(m), b = <span class="built_in">sin</span>(m), c = - (a * p.x + b * p.y), lab = <span class="built_in">hypot</span>(a, b);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">double</span> d = <span class="built_in">fabs</span>(a * ch[i].x + b * ch[i].y + c) / lab;</span><br><span class="line">        <span class="keyword">if</span>(a * ch[i].x + b * ch[i].y + c &lt; <span class="number">0</span>)</span><br><span class="line">            hl = <span class="built_in">max</span>(hl, d);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            hr = <span class="built_in">max</span>(hr, d);</span><br><span class="line">    &#125;</span><br><span class="line">    h = hl + hr;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>(w, h) * <span class="built_in">max</span>(w, h);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> pi = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">ternary_search</span><span class="params">(<span class="keyword">double</span> l, <span class="keyword">double</span> r, Pt p, Pt ch[], <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> mid, midmid, md, mmd;</span><br><span class="line">    <span class="keyword">double</span> ret = INF;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">fabs</span>(l-r) &gt; eps) &#123;</span><br><span class="line">        mid = (l+r)/<span class="number">2</span>;</span><br><span class="line">        midmid = (mid+r)/<span class="number">2</span>;</span><br><span class="line">        md = <span class="built_in">calcSquare</span>(mid, p, ch, n);</span><br><span class="line">        mmd = <span class="built_in">calcSquare</span>(midmid, p, ch, n);</span><br><span class="line">        ret = <span class="built_in">min</span>(ret, md);</span><br><span class="line">        ret = <span class="built_in">min</span>(ret, mmd);</span><br><span class="line">        <span class="keyword">if</span>(md &lt; mmd)</span><br><span class="line">            r = midmid;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            l = mid;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//	printf(&quot;best %lf %lf\n&quot;, l / pi * 180, ret);</span></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">smallSquare</span><span class="params">(<span class="keyword">int</span> n, Pt ch[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> ret = INF;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>, j = n<span class="number">-1</span>; i &lt; n; j = i++) &#123;</span><br><span class="line"><span class="comment">//		printf(&quot;pt[%lf %lf]\n&quot;, ch[i].x, ch[i].y);</span></span><br><span class="line">        <span class="keyword">double</span> l = <span class="built_in">atan2</span>(ch[j].y - ch[i].y, ch[j].x - ch[i].x);</span><br><span class="line">        <span class="keyword">double</span> r = <span class="built_in">atan2</span>(ch[(i+<span class="number">1</span>)].y - ch[i].y, ch[(i+<span class="number">1</span>)].x - ch[i].x) - pi;</span><br><span class="line"><span class="comment">//		printf(&quot;l r [%lf %lf]\n&quot;, l, r);</span></span><br><span class="line">        r = l + <span class="built_in">fmod</span>(<span class="built_in">fmod</span>(r - l, <span class="number">2</span> * pi) + <span class="number">2</span> * pi, <span class="number">2</span> * pi);</span><br><span class="line">        <span class="keyword">if</span>(l &lt;= r) &#123;</span><br><span class="line">            ret = <span class="built_in">min</span>(ret, <span class="built_in">ternary_search</span>(l, r, ch[i], ch, n));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ret = <span class="built_in">min</span>(ret, <span class="built_in">ternary_search</span>(l, pi, ch[i], ch, n));</span><br><span class="line">            ret = <span class="built_in">min</span>(ret, <span class="built_in">ternary_search</span>(-pi, r, ch[i], ch, n));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Pt p[<span class="number">2048</span>], ch[<span class="number">2048</span>];</span><br><span class="line">    <span class="keyword">int</span> n, m;</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span>(testcase--) &#123;</span><br><span class="line">    	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    		<span class="built_in">scanf</span>(<span class="string">&quot;%lf %lf&quot;</span>, &amp;p[i].x, &amp;p[i].y);</span><br><span class="line">        m = <span class="built_in">monotone</span>(n, p, ch);</span><br><span class="line"><span class="comment">//        for(int i = 0; i &lt; m; i++)</span></span><br><span class="line"><span class="comment">//        	printf(&quot;%lf %lf\n&quot;, ch[i].x, ch[i].y);</span></span><br><span class="line">    	</span><br><span class="line">    	<span class="keyword">if</span>(m == <span class="number">1</span>) &#123;</span><br><span class="line">    		<span class="built_in">printf</span>(<span class="string">&quot;%.2lf\n&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    		<span class="keyword">continue</span>;</span><br><span class="line">    	&#125;</span><br><span class="line">        <span class="keyword">double</span> ret = <span class="built_in">smallSquare</span>(m, ch);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%.2lf\n&quot;</span>, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-11215" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/06/oj/uva/uva-11215/" class="article-date">
  <time datetime="2014-07-06T03:05:05.000Z" itemprop="datePublished">2014-07-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/06/oj/uva/uva-11215/">UVa 11215 - How Many Numbers</a>
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/07/06/oj/uva/uva-11215/" data-id="ckpaivcbh00gbn8vnder4e33x" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/07/06/oj/uva/uva-11215/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dp/">dp</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>You might have heard the game of 24: given 4 integers, you’re to make an expression to get the number 24. For example, given 4, 4, 10, 10, you can write (10*10-4)/4=24, given 1, 5, 5, 5, you can write (5-1/5)*5=24.</p>
<p>In this problem, your task is a little bit harder: count the number of numbers that can be made. Don’t forget to count negative numbers and non-integers. You can use binary additions, subtractions, multiplications and divisions with parenthesis (unary operations are not allowed). Numbers cannot be concatenated to form a larger number (e.g. you cannot concatenate 1 and 2 to get 12).</p>
<p>For example, given two 1’s, exactly 3 numbers can be made: 1+1=2, 1-1=0, 1*1=1. You cannot get 11 or -1.</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The input consists of at most 30 test cases. Each case begins with a line containing a single integer n (1 &lt; n &lt; 7), the number of integers given. The next line contains n non-negative integers not greater than 10. The last case is followed by a single zero, which should not be processed.</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For each test case, print the case number and the number of numbers that can be made.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">1 1</span><br><span class="line">3</span><br><span class="line">1 4 7</span><br><span class="line">4</span><br><span class="line">1 2 3 5</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h2 id="Output-for-the-Sample-Input"><a href="#Output-for-the-Sample-Input" class="headerlink" title="Output for the Sample Input"></a>Output for the Sample Input</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Case 1: 3</span><br><span class="line">Case 2: 47</span><br><span class="line">Case 3: 255</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>** 題目描述： **</p>
<p>對於給定的數字，考慮所有加減乘除括號的所有計算方案，計算出有多少不同種的運算結果。</p>
<p>** 題目解法： **</p>
<p>類似矩陣鏈乘積，考量每一種排列方式。</p>
<p>對於其中一種排列方式，紀錄狀態 [l, r] 之間所有可能的運算結果，當要合併兩個區間時，枚舉兩個區間的所有可能，並且將其兩兩合併。</p>
<p><code>[l, r] = [l, k](+-*/)[k+1, r]</code></p>
<p>使用 <code>double</code> 以為小數點誤差影響不太，但怎麼做都 WA，最後直接用分數的方式進行計算，最後拿了很慢的 AC。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> eps 1e-3</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Fraction</span> &#123;</span></span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> a, b;</span><br><span class="line">    <span class="built_in">Fraction</span>(<span class="keyword">long</span> <span class="keyword">long</span> x=<span class="number">0</span>, <span class="keyword">long</span> <span class="keyword">long</span> y=<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> g = __gcd(x, y);</span><br><span class="line">        a = x / g;</span><br><span class="line">        b = y / g;</span><br><span class="line">        <span class="keyword">if</span>(b &lt; <span class="number">0</span>)	a = -a, b = -b;</span><br><span class="line">    &#125;</span><br><span class="line">    Fraction <span class="keyword">operator</span>+(<span class="keyword">const</span> Fraction &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Fraction</span>(a * x.b + x.a * b, b * x.b);</span><br><span class="line">    &#125;</span><br><span class="line">    Fraction <span class="keyword">operator</span>-(<span class="keyword">const</span> Fraction &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Fraction</span>(a * x.b - x.a * b, b * x.b);</span><br><span class="line">    &#125;</span><br><span class="line">    Fraction <span class="keyword">operator</span>*(<span class="keyword">const</span> Fraction &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Fraction</span>(a * x.a, b * x.b);</span><br><span class="line">    &#125;</span><br><span class="line">    Fraction <span class="keyword">operator</span>/(<span class="keyword">const</span> Fraction &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Fraction</span>(a * x.b, b * x.a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Fraction &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a * x.b &lt; b * x.a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, cases = <span class="number">0</span>, A[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) == <span class="number">1</span> &amp;&amp; n) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;A[i]);</span><br><span class="line"></span><br><span class="line">        set&lt;Fraction&gt; ret;</span><br><span class="line">        <span class="built_in">sort</span>(A, A+n);</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            set&lt;Fraction&gt; dp[<span class="number">10</span>][<span class="number">10</span>];</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">                dp[i][i].<span class="built_in">insert</span>(<span class="built_in">Fraction</span>(A[i]));</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; i + j &lt; n; j++) &#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> k = j; k &lt; j+i; k++) &#123;</span><br><span class="line">                        <span class="keyword">for</span>(set&lt;Fraction&gt;::iterator it = dp[j][k].<span class="built_in">begin</span>();</span><br><span class="line">                            it != dp[j][k].<span class="built_in">end</span>(); it++)</span><br><span class="line">                        <span class="keyword">for</span>(set&lt;Fraction&gt;::iterator jt = dp[k+<span class="number">1</span>][j+i].<span class="built_in">begin</span>();</span><br><span class="line">                            jt != dp[k+<span class="number">1</span>][j+i].<span class="built_in">end</span>(); jt++) &#123;</span><br><span class="line">                            Fraction a = *it, b = *jt;</span><br><span class="line">                            dp[j][j+i].<span class="built_in">insert</span>(a+b);</span><br><span class="line">                            dp[j][j+i].<span class="built_in">insert</span>(a-b);</span><br><span class="line">                            dp[j][j+i].<span class="built_in">insert</span>(a*b);</span><br><span class="line">                            <span class="keyword">if</span>(b.a)</span><br><span class="line">                                dp[j][j+i].<span class="built_in">insert</span>(a/b);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(set&lt;Fraction&gt;::iterator it = dp[<span class="number">0</span>][n<span class="number">-1</span>].<span class="built_in">begin</span>();</span><br><span class="line">                it != dp[<span class="number">0</span>][n<span class="number">-1</span>].<span class="built_in">end</span>(); it++)</span><br><span class="line">                ret.<span class="built_in">insert</span>(*it);</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="built_in">next_permutation</span>(A, A+n));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case %d: %d\n&quot;</span>, ++cases, ret.<span class="built_in">size</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/72/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/71/">71</a><a class="page-number" href="/page/72/">72</a><span class="page-number current">73</span><a class="page-number" href="/page/74/">74</a><a class="page-number" href="/page/75/">75</a><span class="space">&hellip;</span><a class="page-number" href="/page/85/">85</a><a class="extend next" rel="next" href="/page/74/">Next &raquo;</a>
    </nav>
  
</section>
          
          
            <aside id="sidebar">
  <!-- <div id="ukagaka_panel"></div> -->
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">115</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算機圖學/">計算機圖學</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/">工作應用</a><span class="category-list-count">30</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Java/">Java</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/Meme/">Meme</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/可持久化/">可持久化</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作應用/鬼故事/">鬼故事</a><span class="category-list-count">9</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">44</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">633</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">483</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">77</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">45</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2021/05/30/java/java-memory-optimization-1/">
              
                <i class="icon-file-o"></i> 
              
            Java 優化內存使用 結構篇</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/diary-202101/">
              
                <i class="icon-file-o"></i> 
              
            二八進展</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-file-extension/">
              
                <i class="icon-file-o"></i> 
              
            File Extension</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-globl-var/">
              
                <i class="icon-file-o"></i> 
              
            Global Variable</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-handover/">
              
                <i class="icon-file-o"></i> 
              
            Handover</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-interview-recursion/">
              
                <i class="icon-file-o"></i> 
              
            Interview &amp; Recursion</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-job-build/">
              
                <i class="icon-file-o"></i> 
              
            Job Build</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-lang/">
              
                <i class="icon-file-o"></i> 
              
            Programming Language Impostors</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-machine-learning-newbie/">
              
                <i class="icon-file-o"></i> 
              
            Machine Learning for Newbie</a>
          </li>
        
          <li>
            <a class="text" href="/2021/01/31/work/meme-parallel-gc/">
              
                <i class="icon-file-o"></i> 
              
            Parallel &amp; Garbage Collection</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
<script type="text/javascript">
  $('#ukagaka_panel').ukagaka();
</script>
  
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2021 Shiang-Yun Yang 
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>