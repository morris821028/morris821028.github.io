<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>關於高效大數除法的那些事 | Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前情提要從國小開始學起加減乘除，腦海裡計算加法比減法簡單，減法可以換成加法，乘法則可以換成數個加法。即使到了中國最強的利器——珠心算，我們學習這古老的快速運算時，也都採取這類方法，而除法最為複雜，需要去估算商，嘗試去扣完，再做細微調整。然而，當整數位數為 $N$ 時，加減法效能為 $N$ 基礎運算，而乘除法為 $N^2$ 次基礎運算，一次基礎運算通常定義在查表，例如背誦的九九乘法表，使得我們在借位">
<meta name="keywords" content="大數,FFT">
<meta property="og:type" content="article">
<meta property="og:title" content="關於高效大數除法的那些事">
<meta property="og:url" content="http://morris821028.github.io/2017/04/09/big-integer-division/index.html">
<meta property="og:site_name" content="Morris&#39; Blog">
<meta property="og:description" content="前情提要從國小開始學起加減乘除，腦海裡計算加法比減法簡單，減法可以換成加法，乘法則可以換成數個加法。即使到了中國最強的利器——珠心算，我們學習這古老的快速運算時，也都採取這類方法，而除法最為複雜，需要去估算商，嘗試去扣完，再做細微調整。然而，當整數位數為 $N$ 時，加減法效能為 $N$ 基礎運算，而乘除法為 $N^2$ 次基礎運算，一次基礎運算通常定義在查表，例如背誦的九九乘法表，使得我們在借位">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://i.imgur.com/BuPUpad.jpg">
<meta property="og:updated_time" content="2021-05-30T02:04:42.493Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="關於高效大數除法的那些事">
<meta name="twitter:description" content="前情提要從國小開始學起加減乘除，腦海裡計算加法比減法簡單，減法可以換成加法，乘法則可以換成數個加法。即使到了中國最強的利器——珠心算，我們學習這古老的快速運算時，也都採取這類方法，而除法最為複雜，需要去估算商，嘗試去扣完，再做細微調整。然而，當整數位數為 $N$ 時，加減法效能為 $N$ 基礎運算，而乘除法為 $N^2$ 次基礎運算，一次基礎運算通常定義在查表，例如背誦的九九乘法表，使得我們在借位">
<meta name="twitter:image" content="http://i.imgur.com/BuPUpad.jpg">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
  <link rel="import" href="/bower_components/app-layout/app-layout.html"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          
          <section id="main" style="width: 95%"><article id="post-big-integer-division" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/09/big-integer-division/" class="article-date">
  <time datetime="2017-04-09T08:13:14.000Z" itemprop="datePublished">2017-04-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>/<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/BuPUpad.jpg" rel="gallery_ckpaivc6z000jn8vn6thogo40">
        <img src="http://i.imgur.com/BuPUpad.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      關於高效大數除法的那些事
    </h1>
  

      </header>
    
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2017/04/09/big-integer-division/" data-id="ckpaivc6z000jn8vn6thogo40" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2017/04/09/big-integer-division/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FFT/">FFT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/大數/">大數</a></li></ul>

    </footer>
    <div class="article-entry " itemprop="articleBody">
      
          
              <div id="toc" class="toc-article">
              <h2 class="toc-title"><span>contents</span></h2>
              
                  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前情提要"><span class="toc-number">1.</span> <span class="toc-text">前情提要</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#大數除法"><span class="toc-number">2.</span> <span class="toc-text">大數除法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#牛頓迭代法"><span class="toc-number">2.1.</span> <span class="toc-text">牛頓迭代法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#倒數計算"><span class="toc-number">2.2.</span> <span class="toc-text">倒數計算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#運行範例"><span class="toc-number">2.3.</span> <span class="toc-text">運行範例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#實作細節"><span class="toc-number">2.4.</span> <span class="toc-text">實作細節</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#精準度"><span class="toc-number">2.4.1.</span> <span class="toc-text">精準度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#牛頓迭代"><span class="toc-number">2.4.2.</span> <span class="toc-text">牛頓迭代</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#加速優化"><span class="toc-number">2.4.3.</span> <span class="toc-text">加速優化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#誤差修正"><span class="toc-number">2.4.4.</span> <span class="toc-text">誤差修正</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#參考題目-資料"><span class="toc-number">3.</span> <span class="toc-text">參考題目/資料</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#b960-的亂碼"><span class="toc-number">4.</span> <span class="toc-text">b960 的亂碼</span></a></li></ol>
              
              </div>
          
        
          <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>從國小開始學起加減乘除，腦海裡計算加法比減法簡單，減法可以換成加法，乘法則可以換成數個加法。即使到了中國最強的利器——珠心算，我們學習這古老的快速運算時，也都採取這類方法，而除法最為複雜，需要去估算商，嘗試去扣完，再做細微調整。然而，當整數位數為 <span>$N$</span><!-- Has MathJax --> 時，加減法效能為 <span>$N$</span><!-- Has MathJax --> 基礎運算，而乘除法為 <span>$N^2$</span><!-- Has MathJax --> 次基礎運算，一次基礎運算通常定義在查表，例如背誦的九九乘法表，使得我們在借位和乘積運算達到非常快速。</p>
<p>這些方法在計算機發展後，硬體實作大致使用這些算法，直到了快速傅立葉 (FFT) 算法能在 <span>$O(N \log N)$</span><!-- Has MathJax --> 時間內完成旋積 (卷積) 計算，順利地解決了多項式乘法的問題，使得大數乘法能在 <span>$O(N \log N)$</span><!-- Has MathJax --> 時間內完成。</p>
<p>一開始我們知道乘法和除法都可以在 <span>$O(N^2)$</span><!-- Has MathJax --> 時間內完成，有了 FFT 之後，除法是不是也能跟乘法一樣在 <span>$O(N \log N)$</span><!-- Has MathJax --> 內完成？</p>
<h2 id="大數除法"><a href="#大數除法" class="headerlink" title="大數除法"></a>大數除法</h2><p>就目前研究來看，除法可以轉換成乘法運算，在數論的整數域中，若存在乘法反元素，除一個數相當於成一個數，而我們發展的計算機，有效運算為 32/64-bit，其超過的部分視為溢位 (overflow)，溢位則可視為模數。因此，早期 CPU 設計中，除法需要的運行次數比乘法多一些，編譯器會將除法轉換乘法運算 (企圖找到反元素)，來加速運算。現在，由於 intel 的黑魔法，導致幾乎一模一樣快而沒人注意到這些瑣事。</p>
<p>回過頭來，我們介紹一個藉由 FFT 達到的除法運算 <span>$O(N \log N \log N)$</span><!-- Has MathJax --> 的算法。而那多的 <span>$O(\log N)$</span><!-- Has MathJax --> 來自於牛頓迭代法。目標算出 <span>$C = \lfloor A/B \rfloor$</span><!-- Has MathJax -->，轉換成 <span>$C = \lfloor A \ast (1/B) \rfloor$</span><!-- Has MathJax -->，快速算出 <span>$1/B$</span><!-- Has MathJax --> 的值，採用牛頓迭代法。</p>
<p>額外要求整數長度 <span>$n = \text{length}(A)$</span><!-- Has MathJax -->、<span>$m = \text{length}(B)$</span><!-- Has MathJax -->，當計算 <span>$1/B$</span><!-- Has MathJax --> 時，要求精準度到小數點後 <span>$n$</span><!-- Has MathJax --> 位才行。</p>
<h3 id="牛頓迭代法"><a href="#牛頓迭代法" class="headerlink" title="牛頓迭代法"></a>牛頓迭代法</h3><p>目標求 <span>$f(x) = 0$</span><!-- Has MathJax --> 的一組解。</p>
<span>$$\begin{align}
x_{n+1} = x_n - \frac{f(x_n)}{f&apos;(x_n)}
\end{align}$$</span><!-- Has MathJax -->

<p>不斷地迭代逼近找解。若有多組解，則依賴初始值 <span>$x_0$</span><!-- Has MathJax --> 決定優先找到哪一組解。</p>
<blockquote>
<p>這部分也應用在快速開根號——反平方根快速演算法 <a href="https://en.wikipedia.org/wiki/Fast_inverse_square_root">Fast inverse square root</a></p>
</blockquote>
<h3 id="倒數計算"><a href="#倒數計算" class="headerlink" title="倒數計算"></a>倒數計算</h3><p>藉由下述定義，找到 <span>$x = 1/B$</span><!-- Has MathJax --></p>
<span>$$\begin{align}
f(x) = \frac{1}{x} - B, \; f&apos;(x) = -\frac{1}{x^2}
\end{align}$$</span><!-- Has MathJax -->

<p>接著推導牛頓迭代法的公式</p>
<span>$$\begin{align}
x_{n+1} &amp;= x_n - \frac{f(x_n)}{f&apos;(x_n)} \\
&Tab;&Tab;&amp;= x_n - \frac{\frac{1}{x} - B}{-\frac{1}{x^2}} = (2 - x_n B) x_n
\end{align}$$</span><!-- Has MathJax -->

<h3 id="運行範例"><a href="#運行範例" class="headerlink" title="運行範例"></a>運行範例</h3><p>當 <span>$A = 7123456, \; B = 123$</span><!-- Has MathJax -->，計算倒數 <span>$1/B = 1/123$</span><!-- Has MathJax -->，由於 <span>$A$</span><!-- Has MathJax --> 為 <span>$n=7$</span><!-- Has MathJax --> 位數，小數點後精準 7 位，意即迭代比較小數點後 7 位不再變動時停止。</p>
<p>以下描述皆以 <strong>十進制</strong> (在程式運行時我們可能會偏向萬進制，甚至億進制來充分利用 32-bit 暫存器)</p>
<ul>
<li>決定 <span>$x_0$</span><!-- Has MathJax --> 是很重要的一步，這嚴重影響著迭代次數。</li>
<li><span>$x_0$</span><!-- Has MathJax --> 拿 <span>$B$</span><!-- Has MathJax --> 的最高位數 1 進行大數除小數，得到 <span>$x_0 = 0.01$</span><!-- Has MathJax --></li>
<li><span>$x_1 = (2 - x_0 \ast B) \ast x_0 = 0.0077$</span><!-- Has MathJax --></li>
<li><span>$x_2 = (2 - x_1 \ast B) \ast x_1 = 0.0081073$</span><!-- Has MathJax --></li>
<li><span>$x_3 = (2 - x_2 \ast B) \ast x_2 = 0.00813001$</span><!-- Has MathJax --></li>
<li><span>$x_4 = (2 - x_3 \ast B) \ast x_3 = 0.00813008$</span><!-- Has MathJax --></li>
</ul>
<p>接下來進行移位到整數部分，進行乘法後再移回去即可。</p>
<h3 id="實作細節"><a href="#實作細節" class="headerlink" title="實作細節"></a>實作細節</h3><h4 id="精準度"><a href="#精準度" class="headerlink" title="精準度"></a>精準度</h4><p>使用浮點數實作的 FFT，需要小心精準度，網路上有些代碼利用合角公式取代建表。這類型的優化，在精準度不需要很高的時候提供較好的效能，卻無法提供精準的值，誤差修正成了一道難題。</p>
<h4 id="牛頓迭代"><a href="#牛頓迭代" class="headerlink" title="牛頓迭代"></a>牛頓迭代</h4><p>由於有 FFT 造成的誤差，檢查收斂必須更加地保守，我們可能需要保留小數點下 <span>$n+10$</span><!-- Has MathJax --> 位，在收斂時檢查 <span>$n+5$</span><!-- Has MathJax --> 位確保收斂。通常收斂可以在 20 次左右完成，若發現迭代次數過多，有可能是第一個精準度造成的影響，盡可能使用內建函數得到的三角函數值。</p>
<h4 id="加速優化"><a href="#加速優化" class="headerlink" title="加速優化"></a>加速優化</h4><p>一般使用 IEEE-754 的浮點數格式，根據 FFT 的長度，要避開超過的震級，因此，在 Zerojudge b960 中，最多使用十萬進制進行加速。</p>
<h4 id="誤差修正"><a href="#誤差修正" class="headerlink" title="誤差修正"></a>誤差修正</h4><p>儘管算出的商 <span>$C=A \ast (1/B)$</span><!-- Has MathJax -->，得到的 <span>$C$</span><!-- Has MathJax --> 可能會差個 1，需要在後續乘法中檢驗。</p>
<h2 id="參考題目-資料"><a href="#參考題目-資料" class="headerlink" title="參考題目/資料"></a>參考題目/資料</h2><ul>
<li><a href="https://zerojudge.tw/ShowProblem?problemid=b960">Zerojudge b960</a></li>
<li><a href="http://www.spoj.com/problems/VFDIV/">SPOJ VFDIV - Very Fast Division</a></li>
<li><a href="http://edisonx.pixnet.net/blog/post/94569776-%5B%E5%A4%A7%E6%95%B8%5D-c-%E8%AA%9E%E8%A8%80%E5%A4%A7%E6%95%B8%E6%BC%94%E7%AE%97%E6%B3%95-for-general-(iii)---%E5%A4%A7%E6%95%B8">C 語言大數演算法 for general (III) - 大數除法 / Edison.X. Blog</a></li>
</ul>
<h2 id="b960-的亂碼"><a href="#b960-的亂碼" class="headerlink" title="b960 的亂碼"></a>b960 的亂碼</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="class"><span class="keyword">class</span> <span class="title">TOOL_FFT</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">complex</span> &#123;</span></span><br><span class="line">        T x, y;</span><br><span class="line">        <span class="built_in">complex</span>(T x = <span class="number">0</span>, T y = <span class="number">0</span>):</span><br><span class="line">            <span class="built_in">x</span>(x), <span class="built_in">y</span>(y) &#123;&#125;</span><br><span class="line">        complex <span class="keyword">operator</span>+(<span class="keyword">const</span> complex &amp;A) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">complex</span>(x+A.x,y+A.y);</span><br><span class="line">        &#125;</span><br><span class="line">        complex <span class="keyword">operator</span>-(<span class="keyword">const</span> complex &amp;A) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">complex</span>(x-A.x,y-A.y);</span><br><span class="line">        &#125;</span><br><span class="line">        complex <span class="keyword">operator</span>*(<span class="keyword">const</span> complex &amp;A) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">complex</span>(x*A.x-y*A.y,x*A.y+y*A.x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    T PI;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span>&lt;&lt;<span class="number">17</span>;</span><br><span class="line">    complex p[<span class="number">2</span>][MAXN];</span><br><span class="line">    <span class="keyword">int</span> reversePos[MAXN];</span><br><span class="line">    <span class="built_in">TOOL_FFT</span>() &#123;</span><br><span class="line">        PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">preprocessing</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">NumberOfBitsNeeded</span><span class="params">(<span class="keyword">int</span> PowerOfTwo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (PowerOfTwo &amp; (<span class="number">1</span> &lt;&lt; i)) &#123;</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">uint32_t</span> <span class="title">FastReverseBits</span><span class="params">(<span class="keyword">uint32_t</span> a, <span class="keyword">int</span> NumBits)</span> </span>&#123;</span><br><span class="line">        a = ( ( a &amp; <span class="number">0x55555555</span>U ) &lt;&lt; <span class="number">1</span> ) | ( ( a &amp; <span class="number">0xAAAAAAAA</span>U ) &gt;&gt; <span class="number">1</span> ) ;</span><br><span class="line">        a = ( ( a &amp; <span class="number">0x33333333</span>U ) &lt;&lt; <span class="number">2</span> ) | ( ( a &amp; <span class="number">0xCCCCCCCC</span>U ) &gt;&gt; <span class="number">2</span> ) ;</span><br><span class="line">        a = ( ( a &amp; <span class="number">0x0F0F0F0F</span>U ) &lt;&lt; <span class="number">4</span> ) | ( ( a &amp; <span class="number">0xF0F0F0F0</span>U ) &gt;&gt; <span class="number">4</span> ) ;</span><br><span class="line">        a = ( ( a &amp; <span class="number">0x00FF00FF</span>U ) &lt;&lt; <span class="number">8</span> ) | ( ( a &amp; <span class="number">0xFF00FF00</span>U ) &gt;&gt; <span class="number">8</span> ) ;</span><br><span class="line">        a = ( ( a &amp; <span class="number">0x0000FFFF</span>U ) &lt;&lt; <span class="number">16</span> ) | ( ( a &amp; <span class="number">0xFFFF0000</span>U ) &gt;&gt; <span class="number">16</span> ) ;</span><br><span class="line">        <span class="keyword">return</span> a &gt;&gt; (<span class="number">32</span> - NumBits);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">FFT</span><span class="params">(<span class="keyword">bool</span> InverseTransform, complex In[], complex Out[], <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// simultaneous data copy and bit-reversal ordering into outputs</span></span><br><span class="line">        <span class="keyword">int</span> NumSamples = n;</span><br><span class="line">        <span class="keyword">int</span> NumBits = <span class="built_in">NumberOfBitsNeeded</span>(NumSamples);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NumSamples; ++i) </span><br><span class="line">            Out[reversePos[i]] = In[i];</span><br><span class="line">            </span><br><span class="line">        <span class="comment">// the FFT process</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= NumBits; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> BlockSize = <span class="number">1</span>&lt;&lt;i, BlockEnd = BlockSize&gt;&gt;<span class="number">1</span>, BlockCnt = NumSamples/BlockSize;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; NumSamples; j += BlockSize) &#123;</span><br><span class="line">                complex *t = p[InverseTransform];</span><br><span class="line">                <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UNLOOP_SIZE 8</span></span><br><span class="line">                <span class="keyword">for</span> (; k+UNLOOP_SIZE &lt; BlockEnd; ) &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UNLOOP &#123; \</span></span><br><span class="line"><span class="meta">	complex a = (*t) * Out[k+j+BlockEnd]; \</span></span><br><span class="line"><span class="meta">    Out[k+j+BlockEnd] = Out[k+j] - a; \</span></span><br><span class="line"><span class="meta">    Out[k+j] = Out[k+j] + a;\</span></span><br><span class="line"><span class="meta">    k++, t += BlockCnt;\</span></span><br><span class="line"><span class="meta">&#125;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UNLOOP4 &#123;UNLOOP UNLOOP UNLOOP UNLOOP;&#125;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UNLOOP8 &#123;UNLOOP4 UNLOOP4;&#125;</span></span><br><span class="line">                    UNLOOP8;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (; k &lt; BlockEnd;)</span><br><span class="line">                    UNLOOP;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// normalize if inverse transform</span></span><br><span class="line">        <span class="keyword">if</span> (InverseTransform) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NumSamples; ++i) &#123;</span><br><span class="line">                Out[i] = Out[i].x / NumSamples;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">convolution</span><span class="params">(T *a, T *b, <span class="keyword">int</span> n, T *c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> complex s[MAXN], d1[MAXN], d2[MAXN], y[MAXN];</span><br><span class="line">    	n = MAXN;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">            s[i] = <span class="built_in">complex</span>(a[i], <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">FFT</span>(<span class="literal">false</span>, s, d1, n);</span><br><span class="line">        s[<span class="number">0</span>] = <span class="built_in">complex</span>(b[<span class="number">0</span>], <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i)</span><br><span class="line">            s[i] = <span class="built_in">complex</span>(b[n - i], <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">FFT</span>(<span class="literal">false</span>, s, d2, n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">            y[i] = d1[i] * d2[i];</span><br><span class="line">        <span class="built_in">FFT</span>(<span class="literal">true</span>, y, s, n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">            c[i] = s[i].x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">preprocessing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = MAXN;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i ++) &#123;</span><br><span class="line">            p[<span class="number">0</span>][i] = <span class="built_in">complex</span>(<span class="built_in">cos</span>(<span class="number">2</span>*i*PI / n), <span class="built_in">sin</span>(<span class="number">2</span>*i*PI / n));</span><br><span class="line">            p[<span class="number">1</span>][i] = <span class="built_in">complex</span>(p[<span class="number">0</span>][i].x, -p[<span class="number">0</span>][i].y);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> NumBits = <span class="built_in">NumberOfBitsNeeded</span>(n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        	reversePos[i] = <span class="built_in">FastReverseBits</span>(i, NumBits);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">TOOL_FFT&lt;<span class="keyword">double</span>&gt; tool;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BigInt</span> &#123;</span></span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> *v;</span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> DIGITS = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span>&lt;&lt;<span class="number">17</span>;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(<span class="keyword">const</span> BigInt a, <span class="keyword">const</span> BigInt b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = MAXN<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a.v[i] &lt; b.v[i])</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">if</span> (a.v[i] &gt; b.v[i])</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">str2int</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">long</span> <span class="keyword">long</span> buf[])</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = <span class="built_in">strlen</span>(s);</span><br><span class="line">        size = (n+DIGITS<span class="number">-1</span>) / DIGITS;</span><br><span class="line">        <span class="keyword">int</span> cnt = n%DIGITS == <span class="number">0</span> ? DIGITS : n%DIGITS;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">0</span>, pos = size<span class="number">-1</span>;</span><br><span class="line">        v = buf;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            x = x*<span class="number">10</span> + s[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (--cnt == <span class="number">0</span>) &#123;</span><br><span class="line">                cnt = DIGITS;</span><br><span class="line">                v[pos--] = x, x = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">println</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>, v[size<span class="number">-1</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> pos = size<span class="number">-2</span>; pos &gt;= <span class="number">0</span>; pos--)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%05lld&quot;</span>, v[pos]);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">BigInt <span class="title">multiply</span><span class="params">(<span class="keyword">const</span> BigInt &amp;other, <span class="keyword">long</span> <span class="keyword">long</span> buf[])</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> m = MAXN;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">double</span> na[MAXN], nb[MAXN];</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">double</span> tmp[MAXN];</span><br><span class="line">        <span class="built_in">memset</span>(na+size, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(v[<span class="number">0</span>])*(m-size));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">            na[i] = v[i];</span><br><span class="line">        <span class="built_in">memset</span>(nb+<span class="number">1</span>, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(v[<span class="number">0</span>])*(m-other.size));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j = m<span class="number">-1</span>; i &lt; other.size; i++, j--)</span><br><span class="line">            nb[j] = other.v[i];</span><br><span class="line">        nb[<span class="number">0</span>] = other.v[<span class="number">0</span>];</span><br><span class="line">        tool.<span class="built_in">convolution</span>(na, nb, m, tmp);</span><br><span class="line">        BigInt ret;</span><br><span class="line">        ret.size = m;</span><br><span class="line">        ret.v = buf;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">        	buf[i] = (<span class="keyword">long</span> <span class="keyword">long</span>) (tmp[i] + <span class="number">1.5e-1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        	<span class="keyword">if</span> (buf[i] &gt;= <span class="number">100000</span>)</span><br><span class="line">        		buf[i+<span class="number">1</span>] += buf[i]/<span class="number">100000</span>, buf[i] %= <span class="number">100000</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ret.<span class="built_in">reduce</span>();</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reduce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (size &gt; <span class="number">1</span> &amp;&amp; <span class="built_in">fabs</span>(v[size<span class="number">-1</span>]) &lt; <span class="number">5e-1</span>)</span><br><span class="line">            size--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">BigInt <span class="title">divide</span><span class="params">(<span class="keyword">const</span> BigInt &amp;other, <span class="keyword">long</span> <span class="keyword">long</span> buf[])</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> cmp = <span class="built_in">compare</span>(*<span class="keyword">this</span>, other);</span><br><span class="line">            BigInt ret;</span><br><span class="line">            ret.size = MAXN<span class="number">-1</span>, ret.v = buf;</span><br><span class="line">            <span class="keyword">if</span> (cmp == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(buf[<span class="number">0</span>])*MAXN);</span><br><span class="line">                buf[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">                ret.<span class="built_in">reduce</span>();</span><br><span class="line">                <span class="keyword">return</span> ret;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(buf[<span class="number">0</span>])*MAXN);</span><br><span class="line">                buf[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">                ret.<span class="built_in">reduce</span>();</span><br><span class="line">                <span class="keyword">return</span> ret;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// A / B = A * (1/B)</span></span><br><span class="line">        <span class="comment">// x&#x27; = (2 - x * B) * x</span></span><br><span class="line">        <span class="keyword">int</span> m = MAXN;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">double</span> na[MAXN], nb[MAXN];</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">double</span> invB[MAXN], netB[MAXN], tmpB[MAXN];</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">long</span> <span class="keyword">long</span> bufB[MAXN];</span><br><span class="line">        <span class="keyword">int</span> PRECISION = size+<span class="number">10</span>;</span><br><span class="line">        <span class="built_in">memset</span>(nb+<span class="number">1</span>, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(v[<span class="number">0</span>])*(m-other.size));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j = m<span class="number">-1</span>; i &lt; other.size; i++, j--)</span><br><span class="line">            nb[j] = other.v[i];</span><br><span class="line">        nb[<span class="number">0</span>] = other.v[<span class="number">0</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">memset</span>(invB, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(invB[<span class="number">0</span>])*m);</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> t = <span class="number">100000</span>, a = other.v[other.size<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">if</span> (other.size<span class="number">-2</span> &gt;= <span class="number">0</span>)</span><br><span class="line">                t = t*<span class="number">100000</span>, a = a*<span class="number">100000</span>+other.v[other.size<span class="number">-2</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = PRECISION-other.size; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">                invB[i] = t/a;</span><br><span class="line">                t = (t%a)*<span class="number">100000</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> it = <span class="number">0</span>; it &lt; <span class="number">100</span>; it++) &#123;</span><br><span class="line">            <span class="comment">// netB = xi * B</span></span><br><span class="line">            tool.<span class="built_in">convolution</span>(invB, nb, m, netB);</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> carry = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= PRECISION*<span class="number">2</span>; i++) &#123;</span><br><span class="line">            	bufB[i] = carry + (<span class="keyword">long</span> <span class="keyword">long</span>) (netB[i] + <span class="number">1.5e-1</span>);</span><br><span class="line">            	<span class="keyword">if</span> (bufB[i] &gt;= <span class="number">100000</span>)</span><br><span class="line">            		carry = bufB[i]/<span class="number">100000</span>, bufB[i] %= <span class="number">100000</span>;</span><br><span class="line">            	<span class="keyword">else</span></span><br><span class="line">            		carry = <span class="number">0</span>;</span><br><span class="line">                bufB[i] = -bufB[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// tmpB = 2 - xi * B</span></span><br><span class="line">            bufB[PRECISION] += <span class="number">2</span>;</span><br><span class="line">            <span class="built_in">memset</span>(tmpB, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(tmpB[<span class="number">0</span>])*m);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= PRECISION*<span class="number">2</span>; i++) &#123;</span><br><span class="line">            	<span class="keyword">if</span> (bufB[i] &lt; <span class="number">0</span>)</span><br><span class="line">            		bufB[i] += <span class="number">100000</span>, bufB[i+<span class="number">1</span>]--;</span><br><span class="line">            	<span class="keyword">if</span> (i != <span class="number">0</span>)</span><br><span class="line">            		tmpB[m-i] = bufB[i];</span><br><span class="line">            	<span class="keyword">else</span></span><br><span class="line">            		tmpB[i] = bufB[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// netB = tmpB * invB</span></span><br><span class="line">            tool.<span class="built_in">convolution</span>(invB, tmpB, m, netB);</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">long</span> <span class="keyword">long</span> carry = <span class="number">0</span>;</span><br><span class="line">                <span class="built_in">memset</span>(bufB, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(bufB[<span class="number">0</span>])*m);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= PRECISION*<span class="number">2</span>; i++) &#123;</span><br><span class="line">                    bufB[i] = carry + (<span class="keyword">long</span> <span class="keyword">long</span>) (netB[i] + <span class="number">1.5e-1</span>);</span><br><span class="line">                    <span class="keyword">if</span> (bufB[i] &gt;= <span class="number">100000</span>)</span><br><span class="line">            			carry = bufB[i]/<span class="number">100000</span>, bufB[i] %= <span class="number">100000</span>;</span><br><span class="line">            		<span class="keyword">else</span></span><br><span class="line">            			carry = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> same = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = PRECISION; same &amp;&amp; i &gt;= <span class="number">5</span>; i--)</span><br><span class="line">                    same &amp;= ((<span class="keyword">long</span> <span class="keyword">long</span>) (invB[i]) == bufB[i+PRECISION]);</span><br><span class="line">                <span class="keyword">if</span> (same)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">memset</span>(invB, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(invB[<span class="number">0</span>])*m);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i+PRECISION &lt;= PRECISION*<span class="number">2</span>; i++)</span><br><span class="line">            	invB[i] = bufB[i+PRECISION];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">memset</span>(na+<span class="number">1</span>, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(v[<span class="number">0</span>])*(m-size));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j = m<span class="number">-1</span>; i &lt; size; i++, j--)</span><br><span class="line">            na[j] = v[i];</span><br><span class="line">        na[<span class="number">0</span>] = v[<span class="number">0</span>];</span><br><span class="line">        tool.<span class="built_in">convolution</span>(invB, na, m, netB);</span><br><span class="line">        </span><br><span class="line">        BigInt ret;</span><br><span class="line">        ret.size = m<span class="number">-1</span>;</span><br><span class="line">        ret.v = buf;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> carry = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        	buf[i] = carry + (<span class="keyword">long</span> <span class="keyword">long</span>) (netB[i] + <span class="number">1.5e-1</span>);</span><br><span class="line">        	<span class="keyword">if</span> (buf[i] &gt;= <span class="number">100000</span>)</span><br><span class="line">        		carry = buf[i]/<span class="number">100000</span>, buf[i] %= <span class="number">100000</span>;</span><br><span class="line">        	<span class="keyword">else</span></span><br><span class="line">        		carry = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i+PRECISION &lt; m; i++)</span><br><span class="line">            buf[i] = buf[i+PRECISION];</span><br><span class="line">        <span class="built_in">memset</span>(buf+PRECISION, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(buf[<span class="number">0</span>])*(m-PRECISION));</span><br><span class="line">        &#123;</span><br><span class="line">        	<span class="built_in">memset</span>(na, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(na[<span class="number">0</span>])*m);</span><br><span class="line">        	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j = m<span class="number">-1</span>; i &lt; m<span class="number">-1</span>; i++, j--)</span><br><span class="line">                na[j] = buf[i];</span><br><span class="line">            na[<span class="number">0</span>] = buf[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">            	nb[i] = other.v[i];</span><br><span class="line">    		tool.<span class="built_in">convolution</span>(nb, na, m, netB);</span><br><span class="line">    		<span class="keyword">long</span> <span class="keyword">long</span> carry = <span class="number">0</span>;</span><br><span class="line">    		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">    			bufB[i] = (carry + (<span class="keyword">long</span> <span class="keyword">long</span>) (netB[i] + <span class="number">1e-1</span>));</span><br><span class="line">            	<span class="keyword">if</span> (bufB[i] &gt;= <span class="number">100000</span>)</span><br><span class="line">            		carry = bufB[i]/<span class="number">100000</span>, bufB[i] %= <span class="number">100000</span>;</span><br><span class="line">            	<span class="keyword">else</span></span><br><span class="line">            		carry = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            carry = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">                bufB[i] = v[i] - bufB[i] + carry;</span><br><span class="line">                <span class="keyword">if</span> (bufB[i] &lt; <span class="number">0</span>)</span><br><span class="line">            		bufB[i] += <span class="number">100000</span>, carry = <span class="number">-1</span>;</span><br><span class="line">            	<span class="keyword">else</span></span><br><span class="line">            		carry = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            BigInt R;</span><br><span class="line">            R.size = m<span class="number">-1</span>, R.v = bufB;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">compare</span>(other, R) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                buf[<span class="number">0</span>]++;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; buf[i] &gt;= <span class="number">100000</span>; i++)</span><br><span class="line">                    buf[i+<span class="number">1</span>]++, buf[i] -= <span class="number">100000</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ret.<span class="built_in">reduce</span>();</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> sa[<span class="number">1</span>&lt;&lt;<span class="number">20</span>], sb[<span class="number">1</span>&lt;&lt;<span class="number">20</span>];</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%s %s&quot;</span>, sa, sb) == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">long</span> <span class="keyword">long</span> da[<span class="number">1</span>&lt;&lt;<span class="number">19</span>], db[<span class="number">1</span>&lt;&lt;<span class="number">19</span>], dc[<span class="number">1</span>&lt;&lt;<span class="number">19</span>];</span><br><span class="line">        </span><br><span class="line">        BigInt a, b, c;</span><br><span class="line">        a.<span class="built_in">str2int</span>(sa, da);</span><br><span class="line">        b.<span class="built_in">str2int</span>(sb, db);</span><br><span class="line">        c = a.<span class="built_in">divide</span>(b, dc);</span><br><span class="line">        c.<span class="built_in">println</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
      
    </div>

  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/04/28/uva-13154/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          UVa 13154 - Extreme XOR Sum
        
      </div>
    </a>
  
  
    <a href="/2017/04/09/2017-google-code-jam-qr/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">2017 Google Code Jam Round QR</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
          
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2021 Shiang-Yun Yang 
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  var disqus_url = 'http://morris821028.github.io/2017/04/09/big-integer-division/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>